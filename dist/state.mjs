var re=function(e,r){let l=Math.min(e.length,r.length),f=e.slice(0,l),u=r.slice(0,l),E=0,m=0;for(;m<l&&E==0;)E=Math.sign(f[m]-u[m]),m++;return E},R=function(e=""){this.name=e,this.pool=[],this.point=function(r,l=!1){if(this.pool.length>0){let f=this.pool.length,u=1<<Math.floor(Math.log2(f)),E=u,m=64;for(;u>=1&&m>=0;){if(m<=0)throw new Error("TTL reached.");if(E==f)E-=u;else{let t=re(r,this.pool[E]);switch(t){case 0:{m=0;break}case 1:{E+u<=f&&(E+=u);break}case-1:{E!=0&&(E-=u);break}default:console.warn(`Unexpected result ${t}.`)}}u=u>>1,m--}let v=!0;if(E>=this.pool.length)v=!1;else{let t=this;this.pool[E].forEach(function(n,d,a){v&&n!=r[d]&&(v=!1)}),!v&&re(r,this.pool[E])>0&&E++}return v||l?E:-1}else return l?0:-1},this.add=function(r,l){return r.data=l,this.pool.splice(this.point(r,!0),0,r),this},this.default=function(r){console.warn(`No match in "${this.name||"(unknown)"}" for "${r}". Default action not defined.`)},this.get=function(r){let l=this.point(r);if(l>-1)return this.pool[l].data;this.default(r)},this.run=function(r,...l){let f=this.point(r);f>-1?r.subarray?this.pool[f].data(r.subarray(this.pool[f].length),...l):this.pool[f].data(r.slice(this.pool[f].length),...l):this.default(r,...l)}};var ae=class{#t={};addEventListener(e,r){this.#t[e]||(this.#t[e]=[]),this.#t[e].unshift(r)}removeEventListener(e,r){if(this.#t[e]){let l=this.#t[e].indexOf(r);l>-1&&this.#t[e].splice(l,1),this.#t[e].length<1&&delete this.#t[e]}}dispatchEvent(e,r){let l=new Event(e),f=this;l.data=r,this.#t[e]?.length>0&&this.#t[e].forEach(function(u){try{u?.call(f,l)}catch(E){console.error(E)}}),this[`on${e}`]&&this[`on${e}`](l)}};var ke=["MSB","PRG","LSB","NME","ELC","DRM","LVL"],we={krs:"KR",s90es:"ES",motif:"ES"},xe={krs:"Kr",s90es:"SE",motif:"ME"},Q=function(e){let r=Math.floor(e/10),l=e%10;return`${r.toString(16)}${l}`},W=class{#t;get bankInfo(){return this.#t}strictMode=!1;get(e=0,r=0,l=0,f,u=0){let E=[e,r,l],m,v=1,t=0,n,d,a=Array.from(arguments);switch(f){case"xg":{switch(e){case 0:{l==126?a[2]=125:l==127&&(a[2]=0);break}case 16:{l==126&&(a[2]=0);break}case 32:{l>125&&(a[2]=0),a[2]+=4;break}case 33:{(l>125||l==3)&&(a[2]=0),a[2]+=5;break}case 34:case 35:case 36:{l>125&&(a[2]=0),a[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:a[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{l==126&&(a[2]=0);break}case 48:case 64:case 126:case 127:{l==126&&(e==127&&r==0||(a[2]=0));break}}break}case"gs":case"sc":{e==0&&l<5?a[0]=49:e>125&&l<5&&l!=2&&(a[2]=e,a[0]=49);break}case"mt32":{e==0&&(a[0]=49);break}case"sd":{switch(e){case 121:{a[0]=96;break}case 120:{a[0]=104;break}}a[0]>>1==40?a[2]|=16:a[0]>95&&a[0]<100&&(a[2]|=16,r>>4==7&&(a[0]=96));break}case"g2":{e>>1==40?a[2]|=16:e>95&&e<100&&(a[2]|=16,r>>4==7&&(a[0]=96));break}case"sg":{e==8&&l==0&&(a[2]=5);break}case"05rw":case"x5d":{e&&e<56&&(a[0]=56);break}case"s90es":{if(e==0)break;l<8?a[2]+=17:l<32?a[2]+=13:a[2]=(a[2]>>3)+19;break}case"motif":{if(e==0)break;l<8?a[2]+=28:l<32?a[2]+=13:a[2]=(a[2]>>3)+19;break}}let c=" ",s="M",i="",h=0,o=0;switch(a[0]){case 0:{switch(a[2]){case 127:{s="GM-a";break}case 126:{s="GM-n";break}case 7:{s="GM-k",i="GLX";break}case 5:{s="SG-a",i="000";break}case 4:{f=="gs"||f=="sc"?(s="GM-a",i="000"):(s="SP-l",i="C/M");break}case 3:case 2:case 1:{(f=="gs"||f=="sc")&&(s="GM-a",i="000");break}case 0:{s="GM-a";break}default:s="y",h=3}break}case 8:{f=="sg"?s="GM-s":s="r:";break}case 32:case 33:case 34:case 35:case 36:{f=="xg"&&(s=`${["AP","VL","PF","DX","AN"][e&7]}-${"abcdefgh"[l]}`,h=3);break}case 48:{i=`M${(a[2]>>3).toString().padStart(2,"0")}`,s=`y${i}`,h=1;break}case 49:{a[2]>>1==63?(s=`MT-${"ba"[a[2]&1]}`,i=`C${"-/"[a[2]&1]}M`):(s="GM-a",i="000");break}case 56:{s="GM-b";break}case 57:s=["yDOC","QY10","QY20"][a[2]-112]||"yMxv",i=["DOC","QY1","QY2"][a[2]-112]||"057";case 61:case 120:{s="rDrm";break}case 62:{s="kDrm";break}case 63:{if(a[2]<17){let k=a[2];s=k<10?"kP:":"kC:",s+=k%10}else a[2]<34?s=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][a[2]-17]:s="Ds";h=1;break}case 64:{s="ySFX",i="SFX";break}case 67:{s="DX:S";break}case 80:case 81:case 82:case 83:{s=`Prg${"UABC"[a[0]-80]}`;break}case 88:case 89:case 90:case 91:{s=`Cmb${"UABC"[a[0]-88]}`;break}case 95:{s=`${["DR","PC"][a[2]]}-d`;break}case 96:{s=a[2]==106?"AP-a":a[2]>>4==1?"SDg":"PF",a[2]>63?o=63:a[2]>>4==1&&(o=16),h=3;break}case 97:{s=a[2]>>4==1?"SDa":"VL:",h=3,a[2]>>4==1?o=16:o=112;break}case 98:{s=a[2]>>4==1?"SDb":"SG-a",h=3,o=16;break}case 99:{s=a[2]>>4==1?"SDc":"DX",a[2]>63?o=63:a[2]>>4==1&&(o=16),h=3;break}case 100:{s="AN",a[2]>63?o=63:a[2]>>4==1&&(o=16),h=3;break}case 104:case 105:case 106:case 107:{s="SDd",o=104;break}case 121:{s=`GM-${a[2]?"":"a"}`,h=3;break}case 122:{s="lDrm";break}case 126:{s="yDrS";break}case 127:{a[2]==127?s="rDrm":s="yDrm";break}default:a[0]<48?s="r:":s="M"}s.length<4&&(s+=`${[e,l,a[0],a[2]][h]-o}`.padStart(4-s.length,"0")),i.length<3&&(i+=`${[e,l,e,l][h]}`.padStart(3-i.length,"0")),f=="xg"&&(e==0?a[2]<100?s=s.replace("y0","y:"):a[2]==125&&(s="y126"):e==16?(m=`Voice${((a[2]<<7)+a[1]+1).toString().padStart(3,"0")}`,c=" "):e==35&&l>>1==2&&(m=`DXCH_${(((a[2]&1)<<7)+r+1).toString().padStart(3,"0")}`,c=" "));let b=[a[0],a[1],a[2]];for(;!(m?.length>=0);)if(m=this.#t[a[1]||0][(a[0]<<8)+a[2]]?.name,m){let k=this.#t[a[1]||0][(a[0]<<8)+a[2]];v=k?.poly||v,t=k?.type||t,n=k?.drum,d=k?.level}else if(this.strictMode)m="",c="?";else if(a[0]==0&&a[1]==0&&a[2]==0)m="Unloaded";else if(this.#t[a[1]||0][a[0]<<8])a[0]==0?(a[2]=0,c="^"):a[2]<1?(a[0]=0,c="*"):(a[2]--,c="^");else if(e==48)a[0]=0,a[2]=0,c="!";else if(e==62)a[1]--,c=" ",a[1]<1&&!m?.length&&(a[0]=0,c="!");else if(e<63)a[0]==0?(a[2]=0,c="^"):a[2]<1?(a[0]=0,c="*"):a[2]--;else if(e==80)m=`PrgU:${r.toString().padStart(3,"0")}`,c="!";else if(e==88)m=`CmbU:${r.toString().padStart(3,"0")}`,c="!";else if(e==121)m=`GM2Vox0${l}`,c="#";else if(e==122)if(a[1]==32?a[1]==0:a[1]%=7,m=this.#t[a[1]||0][(a[0]<<8)+a[2]]?.name,m){c=" ";let k=this.#t[a[1]||0][(a[0]<<8)+a[2]];v=k?.poly||v,t=k?.type||t,n=k?.drum,d=k?.level}else m="",c="*";else a[1]==0?(m=`${e.toString().padStart(3,"0")} ${r.toString().padStart(3,"0")} ${l.toString().padStart(3,"0")}`,c="!"):a[0]==0?(a[2]=0,c="^"):a[2]>0?a[2]--:a[1]>0?(a[1]=0,c="!"):(a[0]=0,c="?");let y=[a[0],a[1],a[2]];switch(c){case"^":{switch(f){case"gs":case"sc":case"ns5r":{c=" ";break}}e==127&&c=="^"&&(c=" ");break}}let C="??";switch(a[0]){case 0:{a[2]==0?C="GM":a[2]==5||a[2]==7?C="KG":a[2]<126&&(C="XG");break}case 32:case 33:case 35:case 36:{a[2]>4?C=["AP","VL","PF","DX","AN"][a[0]-32]:C="GS";break}case 48:{C="MU";break}case 49:{a[2]>>1==63?C="MT":a[2]<5&&(C="GM");break}case 56:{C="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{C="AI";break}case 62:case 82:case 90:{C="XD";break}case 63:{a[2]<17?C="KR":a[2]<34?C="ES":C="DS";break}case 64:case 126:{C="XG";break}case 67:case 99:{C=a[2]>>4==1?"SD":"DX";break}case 81:{C="RW";break}case 95:{C=["DR","PC"][a[2]];break}case 96:{C=a[2]==106?"AP":a[2]>>4==1?"SD":"PF";break}case 97:{C=a[2]>>4==1?"SD":"VL";break}case 98:{C=a[2]>>4==1?"SD":"SG";break}case 100:{C="AN";break}case 104:case 105:case 106:case 107:{C="SD";break}case 120:{C="GS";break}case 121:{C=a[2]?"G2":"GM";break}case 122:{C="KG";break}case 127:{C=a[2]==127?"MT":r==0?"GM":"XG";break}default:a[0]<48&&(a[0]==16&&f=="xg"?C="XG":C="GS")}if(c!=" ")switch(f){case"krs":case"s90es":case"motif":{m="",C=we[f];break}default:self.debugMode&&(m="")}return{name:m||`${xe[f]||f.toUpperCase()}${Q(e||0)}${Q(r||0)}${Q(l||0)}`,poly:v,type:t,drum:n,level:d,iid:b,eid:y,sid:E,ending:c,sect:s,bank:i,standard:C,mode:f}}async load(e,r,l="(internal)",f){let u=this,E=[],m=0,v=0,t=0;e.split(`
`).forEach(function(n,d){let a=n.split("	"),c=[];if(d==0){if(a.forEach(function(s,i){E[ke.indexOf(s)]=i}),E.length<4){console.debug("Debugger launched.");debugger}}else{let s=0,i=0,h=0,o,b=1,y=0,C,k;a.forEach(function(M,N){switch(N){case E[0]:{s=parseInt(M);break}case E[1]:{i=parseInt(M);break}case E[2]:{h=parseInt(M);break}case E[3]:{o=M;break}case E[4]:{M=parseInt(M),M<16?b=M+1:(y=(M&15)+1,b=y);break}case E[5]:{k=M;break}case E[6]:{M?.constructor&&(C=parseInt(M));break}}}),u.#t[i]=u.#t[i]||[];let T=u.#t[i],A={msb:s,prg:i,lsb:h,name:o,poly:b,type:y,drum:k,level:C,priority:f},K=!1;f<T[s<<8|h]?.priority&&(K=!0,t++),(!T[s<<8|h]||K||r)&&(T[s<<8|h]=A,m++),v++}}),r||console.debug(`Map "${l}": ${v} total, ${m} loaded (${m-t} + ${t}).`)}clearRange(e){let r=e.prg!=null?e.prg.constructor==Array?e.prg:[e.prg,e.prg]:[0,127],l=e.msb!=null?e.msb.constructor==Array?e.msb:[e.msb,e.msb]:[0,127],f=e.lsb!=null?e.lsb.constructor==Array?e.lsb:[e.lsb,e.lsb]:[0,127];for(let u=l[0];u<=l[1];u++){let E=u<<8;for(let m=f[0];m<=f[1];m++){let v=E+m;for(let t=r[0];t<=r[1];t++)delete this.#t[t][v]}}}init(){this.#t=[];for(let e=0;e<128;e++)this.#t.push([""])}async loadFiles(...e){this.init();let r=this;e.forEach(async function(l,f){try{r.load(await(await fetch(`./data/bank/${l}.tsv`)).text(),!1,l,f)}catch{console.error(`Failed loading "${l}.tsv".`)}})}constructor(...e){this.loadFiles(...e)}};var se=class{#t={};context;set(e,r){this.#t[e]=r}has(e){return!!this.#t[e]}async read(e,r){if(!this.has(e))throw new Error(`No decoder registered for "${e}"`);return await this.#t[e].call(this.context||this,r)}};var Se=function(e,r){let l=!0;return r.forEach((f,u)=>{l=l&&e[u]==f}),l},I=function(e){let r=0;return e.forEach(l=>{r*=256,r+=l}),r},L=new TextDecoder,G=new se;G.set("s7e",async function(e){let r=new Uint8Array(await e.slice(0,65536).arrayBuffer()),l="MSB	LSB	PRG	NME",f=[0,0,0,0],u=32,E=0,m=0,v=!0,t=[],n=0;for(;v;){let d=r.subarray(E);([()=>{L.decode(d.subarray(0,4))=="YSFC"?(E+=80,m=1):E++},()=>{if(Se(d.subarray(0,4),f))t.forEach((a,c,s)=>{let i=I(r.subarray(a.start+4,a.start+8));a.length=i}),m=2;else{let a=L.decode(d.subarray(0,4)),c=I(d.subarray(4,8));t.push({type:a,start:c}),E+=8}},()=>{let a=t[n],c=r.subarray(a.start,a.start+a.length),s=32;switch(a.type){case"ENVC":{let i=u;for(;i<c.length;){let h=c.subarray(i,i+s),o=L.decode(h.subarray(0,10)).trimEnd();o.slice(0,5)=="Init "&&(o=""),o&&(l+=`
063	${(h[17]+13).toString().padStart(3,"0")}	${h[19].toString().padStart(3,"0")}	${o}`),i+=s}break}case"EDVC":{let i=u;for(;i<c.length;){let h=c.subarray(i,i+s),o=L.decode(h.subarray(0,10)).trimEnd();o.slice(0,5)=="Init "&&(o=""),o&&(l+=`
063	024	${h[19].toString().padStart(3,"0")}	${o}`),i+=s}break}case"EPVC":{let i=32,h=u;for(;h<c.length;){let o=c.subarray(h,h+i),b=L.decode(o.subarray(0,10)).trimEnd();b=="----------"&&(b=""),b&&(l+=`
063	${(o[17]+1).toString().padStart(3,"0")}	${o[19].toString().padStart(3,"0")}	${b}`),h+=i}break}}n++,n>=t.length&&(m=3,v=!1)}][m]||(()=>{v=!1}))()}return l});G.set("pcg",async function(e){let r=new Uint8Array(await e.arrayBuffer()),l="MSB	LSB	PRG	NME",f=100,u=0,E=0,m=!0,v=[],t=0;for(;m;){let n=r.subarray(f);([()=>{m=L.decode(n.subarray(0,4))=="INI2",E=n[15],f+=16,u=1},()=>{let d=L.decode(n.subarray(0,4)),a=n[5],c=n[7],s=n[11],i=I(n.subarray(12,16)),h=I(n.subarray(16,20)),o=I(n.subarray(36,40)),b=L.decode(n.subarray(44,44+s));v.push({type:d,tipMsb:a,tipLsb:c,nameLen:s,length:i,start:h,entryLen:o,name:b}),f+=64,E--,E<1&&(u=2)},()=>{let d=v[t],a=r.subarray(d.start,d.start+d.length);switch(d.type){case"PRG1":break;case"PBK1":{let c=63,s=(d.tipMsb?6:0)+d.tipLsb;for(let i=0;i<128;i++){let h=i*d.entryLen,o=a.subarray(h,h+d.entryLen),b=L.decode(o.subarray(0,24)).trimEnd().replace("InitProg","");b.length&&s>5&&(l+=`
${c.toString().padStart(3,"0")}	${s.toString().padStart(3,"0")}	${i.toString().padStart(3,"0")}	${b}`)}break}case"CBK1":{let c=63,s=(d.tipMsb?3:0)+d.tipLsb+10;for(let i=0;i<128;i++){let h=i*d.entryLen,o=a.subarray(h,h+d.entryLen),b=L.decode(o.subarray(0,24)).trimEnd().replace("InitCombi","");b.length&&s>12&&(l+=`
${c.toString().padStart(3,"0")}	${s.toString().padStart(3,"0")}	${i.toString().padStart(3,"0")}	${b}`)}break}}t++,t>=v.length&&(u=3,m=!1)}][u]||(()=>{m=!1}))()}return l});var _=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),X=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],Te=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],B=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],ie=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],ce=function(e){let r=.1,l=-.3;return e>66?(r=5,l=315):e>56?(r=1,l=47):e>46&&(r=.5,l=18.5),r*e-l},ne=function(e){return e>105?Te[e-106]:e>100?e*1.1-100:e/10},oe=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),Y={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,ㇺ
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,ゐ
we,ゑ
wo,を
nga,か゚
ngi,き゚
ngu,く゚
nge,け゚
ngo,こ゚
ngy,き゚!
ng,ン
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,𛀁
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(e=>{let r=e.split(",");Y[r[0]]=r[1]});var le=function(e){let r=e;e[0]=="*"&&(r=r.slice(1)),["aa","ii","uu","ee","oo"].forEach(f=>{for(;r.indexOf(f)>-1;)r=r.replace(f,f[0])});for(let f in Y)r=r.replaceAll(f,Y[f]);r.indexOf("ん")==0&&r.length>1&&(r=r.slice(1));let l=r.indexOf("!");return l>-1&&r.length>1&&(r=r.slice(l+1)),r},he=function(e){return e?e<96?`cc${e}`:["aftertouch","velocity","pitch bend"][e-96]:"off"};var j=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],de=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],fe=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var Me={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},Pe={66307:["drive"],66309:["vowel",e=>"aiueo"[e]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",e=>["off","LPF","HPF"][e]],94984:["noise type",e=>["white","pink"][e]],94987:["disc type",e=>["LP","SP","EP","RND"]],94990:["hum type",e=>`${e+5}0Hz`],94993:["M/S",e=>["mono","stereo"][e]]},J=function(e){return Me[(e[0]-32<<8)+e[1]]||`0x${e[0].toString(16).padStart(2,"0")}${e[1].toString(16).padStart(2,"0")}`},ue=function(e,r,l){let f=(e[0]-32<<16)+(e[1]<<8)+r,u=Pe[f]||{},E=u[0];if(E?.length)return E+=`: ${(u[1]||function(){})(l)||l}`,E},Z=[68,48,95,78,41,3,110,122,0];var P=function(e=64){return Math.round(2e3*Math.log10(e/64))/100};var U=function(e){let r=0;return e.forEach(l=>{r+=l,r=r&127}),~r+1&127},D=function(e,r){let l=0,f=0;for(let u=0;u<e.length;u++){let E=u%8-1,m=(f>>E&1)<<7,v=e[u];v+=m,u%8!=0?(r(v,l,e),l++):f=e[u]}};var V=function(e){let r=Math.floor(e*14.2);return r<128?r:0},w=function(){return!!self.Bun||self.debugMode||!1};var S=["?","gm","gs","sc","xg","g2","mt32","doc","qy10","qy20","ns5r","x5d","05rw","k11","sg","sd","pa","krs","s90es","motif","trin"],Re={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es",trinity:"trin","tr-rack":"trin"},De=["melodic","drum","menu"],pe={"?":[0,0,120,0,0],gm:[0,0,127,0,0],gs:[0,0,120,0,0],sc:[0,0,120,0,0],xg:[0,0,127,0,0],g2:[0,0,120,0,0],mt32:[0,127,127,0,127],doc:[57,112,127,57,112],qy10:[57,113,127,57,113],qy20:[57,114,127,57,114],ns5r:[0,0,61,0,0],x5d:[82,0,62,56,0],"05rw":[81,0,62,56,0],k11:[0,0,122,0,0],sg:[0,0,122,0,0],sd:[97,0,105,0,0],krs:[121,0,120,0,0],s90es:[0,0,127,0,0],motif:[0,0,127,0,0],trin:[0,0,127,0,0]},Oe=[9,25,41,57,73,89,105,121],Ae=[0,3,81,84,88],be={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},ge={0:0,1:1,2:3,5:4},Ee={0:0,1:1,2:2,5:3},ye=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],te=[36,37,48,49,52,53],q=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],me={26:127,29:0,30:0,31:0,52:12,53:54},H=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,128,12,13,16,17,18,19,14,15,20,21,26,28,22,80,81,82,83,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],Le=[2,4,12,13,14,15,16,17,18,19,20,21,80,81,83,136,130,131,132,133,134,135,137,138,139,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],Ue=[33,102,99,32,100,8,9,10],$e=[0,16,25,40,32,64,24,48],$={};S.forEach((e,r)=>{$[e]=r});var g={length:H.length};H.forEach((e,r)=>{g[e]=r});var O={length:q.length};q.forEach((e,r)=>{O[e]=r});var He={};De.forEach((e,r)=>{He[e]=r});var Ne=function(e){let r=[],l=0;return e?.forEach(function(f,u){f==247?r.push(e.subarray(l,u)):f==240&&(l=u+1)}),r.length||r.push(e.subarray(0)),w()&&console.debug(r),r};var ee=8,p={port:ee,ch:ee<<4,chShift:Math.ceil(Math.log2(ee))+4,cc:H.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,nrpn:te.length,ace:8,drm:8,dpn:q.length,dnc:128,ext:3,efx:7,cvn:12,redir:32,vxPrim:3,invalidCh:255};p.chcc=p.cc*p.ch;var F={bank0:128},x=new Uint16Array(p.ch),z=new Uint16Array(p.ch),Be=new Uint16Array(p.ch),Ie=new Uint16Array(p.ch),ve=new Uint16Array(p.ch),Ce=new Array(p.drm);for(let e=0;e<p.ch;e++)x[e]=e*p.cc,z[e]=e*p.rpn,Be[e]=e*p.nrpn,Ie[e]=e*p.ace,ve[e]=e*p.ext;for(let e=0;e<p.drm;e++){Ce[e]=new Uint16Array(p.dpn);let r=e*p.dpn*p.dnc;for(let l=0;l<p.dpn;l++)Ce[e][l]=r+l*p.dnc}var dt=class extends ae{NOTE_IDLE=0;NOTE_ATTACK=1;NOTE_DECAY=2;NOTE_SUSTAIN=3;NOTE_HELD=4;NOTE_RELEASE=5;NOTE_SOSTENUTO_ATTACK=8;NOTE_SOSTENUTO_DECAY=9;NOTE_SOSTENUTO_SUSTAIN=10;NOTE_SOSTENUTO_HELD=11;CH_MELODIC=0;CH_DRUMS=1;CH_DRUM1=2;CH_DRUM2=3;CH_DRUM3=4;CH_DRUM4=5;CH_DRUM5=6;CH_DRUM6=7;CH_DRUM7=8;CH_DRUM8=9;DUMP_ALL=0;DUMP_ONCE=1;DUMP_MODE=2;EXT_NONE=0;EXT_VL=1;EXT_DX=3;VLBC_BRTHEXPR=1;VLBC_VELOINIT=2;VLBC_VELOALL=3;CH_INACTIVE=0;CH_ACTIVE=1;CH_DISABLED=2;#t=0;#g=0;#M=0;#H=new Array(11);get#$(){return this.#H[this.#g]}set#$(e){this.#H[this.#g]=e}#C=new Uint8Array(p.ch);#f=new Uint8Array(p.ch);#r=new Uint8Array(p.ch);#e=new Uint8Array(p.chcc<<1);#E=new Uint8Array(p.ch*p.ace);#s=new Uint8Array(p.ch*p.vxPrim);#u=new Uint8Array(p.ch*p.nn);#v=new Uint8Array(p.ch);#p=new Uint16Array(p.pl);#b=new Uint8Array(p.pl);#N=new Int16Array(p.ch);#O=new Uint8Array(p.ch);#F=new Uint8Array(p.ch);#k=new Uint8Array(p.ch*p.ext);#a=new Uint8Array(p.ch*p.rpn);#c=new Uint8Array(p.ch*p.rpnt);#te=new Int8Array(p.ch*te.length);#m=new Uint8Array(p.drm*p.dpn*p.dnc);#P=new Uint8Array(p.drm*2);#w=new Uint8Array(p.efx*3);#re=new Uint8Array(p.ch);#K=new Uint8Array(p.ch*p.redir);#l=new Uint8Array(p.port);#z=new Uint8Array(p.ch);#R=new Uint8Array(p.ch);#ne=new Uint8Array(p.ch*p.cvn);#I=new Uint8Array(128);#D=new Uint8Array(p.cmt*8);#ae=new Uint8Array(1024);#G=new Uint8Array(p.cmt*64);#h={};modelEx={sc:{showBar:!0,invBar:!1,invDisp:!1,peakHold:1}};#i;#A;#oe;#n=100;#q=0;#se=500;#ie=0;#_="";#X=0;#le=0;#ce=0;#L=!0;#o=!1;#fe=1;#he;#Q=new Array(p.ch);#x=[];#B=new Uint8Array(p.ch);#V=new Uint8Array(p.tr);baseBank=new W("gm2","ns5r","xg","gs","sd","gmega","plg-vl","plg-pf","plg-dx","plg-an","plg-dr","plg-sg","kross","s90es");userBank=new W("gm");initOnReset=!1;aiEfxName="";chRedir(e,r,l){let f=this;if(f.#V[r])return(f.#V[r]-1)*16+e;if(f.#t==$.sc||f.#t==$.sd){if(l==1)return e;let u=0,E=!0;for(;E;)f.#B[e+u]==0?(f.#B[e+u]=r,console.debug(`Assign track ${r} to channel ${e+u+1}.`),E=!1):this.#B[e+u]==r?E=!1:(u+=16,u>=128&&(u=0,E=!1));return e+u}else return e}getTrackPort(e){return this.chRedir(0,e,!0)>>4}forceVoiceRefresh(){for(let e=0;e<p.ch;e++)this.#C[e]&&this.dispatchEvent("voice",{part:e})}#y=[];#W;#d={nOff:(e,r)=>{let l=e*128+r,f=this.#p.lastIndexOf(l);if(f>-1)if(this.getChCc(e,64)>>6)this.#b[f]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:r,velo:this.#u[l],state:this.NOTE_HELD});else if(this.getChCc(e,66)>>6&&this.#b[f]==this.NOTE_SOSTENUTO_SUSTAIN)this.#b[f]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:r,velo:this.#u[l],state:this.NOTE_SOSTENUTO_HELD});else{this.#p[f]=0,this.#u[l]=0,this.#b[f]=this.NOTE_IDLE;let u=this.getExt(e)[1];(u==this.VLBC_VELOINIT||u==this.VLBC_VELOALL)&&this.setChCc(e,129,0),this.dispatchEvent("note",{part:e,note:r,velo:0,state:this.NOTE_IDLE})}},nOn:(e,r,l)=>{let f=e*128+r,u=0;for(this.#v[e]&&this.#d.ano(e);this.#b[u]>0&&this.#p[u]!=f;)u++;if(u<p.pl){this.#p[u]=f,this.#u[f]=l,this.#b[u]=this.NOTE_SUSTAIN,this.#O[e]<l&&(this.#O[e]=l);let E=this.getExt(e)[1];(E==this.VLBC_VELOINIT||E==this.VLBC_VELOALL)&&this.setChCc(e,129,l),this.dispatchEvent("note",{part:e,note:r,velo:l,state:this.NOTE_SUSTAIN})}else console.error("Polyphony exceeded.")},nAt:(e,r,l)=>{},cAt:(e,r)=>{},hoOf:e=>{this.#b.forEach((r,l)=>{if(r==this.NOTE_HELD){let f=this.#p[l],u=f>>7;e==u&&(this.#b[l]=this.NOTE_IDLE,this.#p[l]=0,this.#u[f]=0,this.dispatchEvent("note",{part:e,note:f&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{this.#b.forEach((r,l)=>{let f;switch(r){case this.NOTE_ATTACK:{f=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{f=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{f=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(f){this.#b[l]=f;let u=this.#p[l];this.dispatchEvent("note",{part:e,note:u&127,velo:this.#u[u],state:f})}})},soOf:e=>{this.#b.forEach((r,l)=>{if(r==this.NOTE_SOSTENUTO_HELD){let f=this.#p[l],u=f>>7;e==u&&(this.#b[l]=this.NOTE_IDLE,this.#p[l]=0,this.#u[f]=0,this.dispatchEvent("note",{part:e,note:f&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{this.#p.forEach((r,l,f)=>{let u=r>>7,E=r&127;r==0&&this.#u[0]==0||u==e&&this.#d.nOff(u,E)})}};#de={8:function(e){let r=e.channel,l=e.data[0];this.#d.nOff(r,l)},9:function(e){let r=e.channel,l=this;if(l.getChModeId(r)==$.xg&&l.#r[r]>1){let E=l.getChDrumFirstWrite(r);E[0]&&E[1]!=p.invalidCh&&!l.#C[r]&&(l.copyChSetup(E[1],r),l.dispatchEvent("voice",{part:r}),console.debug(`Part CH${r+1} copied from CH${E[1]}.`))}l.setChActive(r,1);let f=e.data[0],u=e.data[1];u>0?l.#d.nOn(r,f,u):l.#d.nOff(r,f)},10:function(e){let r=e.channel,l=r*128+e.data[0];this.#p.indexOf(l)>-1&&(this.#u[l]=data[1],this.getExt(r)[1]==this.VLBC_VELOALL&&this.setChCc(r,129,data[1]),this.dispatchEvent("note",{part:r,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let r=e.channel,l=this,f=this.#Q[r],u=f[e.data[0]];u&&(e.data[0]=u),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(this.#t){case $.s90es:case $.motif:{if(e.data[0]==0){[0,63].indexOf(e.data[1])>-1&&this.setChActive(r,1);break}e.data[1]&&this.setChActive(r,1);break}default:{this.setChActive(r,1);break}}})();let E=r*p.ext,m=this.getChModeId(r);switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{this.#d.ano(r),this.#N[r]=0,l.resetChCc(r,1,0),l.resetChCc(r,5,0),l.resetChCc(r,64,0),l.resetChCc(r,65,0),l.resetChCc(r,66,0),l.resetChCc(r,67,0),l.resetChCc(r,11,127),l.resetChCc(r,101,127),l.resetChCc(r,100,127),l.resetChCc(r,99,127),l.resetChCc(r,98,127);return}case 123:{this.#d.ano(r);return}case 124:{this.#d.ano(r);return}case 125:{this.#d.ano(r);return}case 126:{this.#v[r]=1,this.#d.ano(r);return}case 127:{this.#v[r]=0,this.#d.ano(r);return}}if(g[e.data[0]]==null)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(Le.indexOf(e.data[0])>-1&&this.allocateAce(r,e.data[0]),e.data[0]){case 0:{switch(w()&&console.debug(`${S[this.#t]}, CH${r+1}: ${e.data[1]}`),this.#t==0?e.data[1]<48?(this.#r[r]>0&&(e.data[1]=this.getChPrimitive(r,1,!1),e.data[1]=120,console.debug(`Forced channel ${r+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]==56?this.switchMode(this.#i.x5==82?"x5d":"05rw"):e.data[1]==62?this.switchMode(this.#i.x5==82?"x5d":"05rw"):e.data[1]==63?this.switchMode(S[this.#i.ds]):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg"):this.#t==$.gs||this.#t==$.sc?e.data[1]<56&&this.#r[r]>0&&(e.data[1]=this.getChPrimitive(r,1,!1),e.data[1]=120,console.debug(`Forced channel ${r+1} to stay drums.`)):this.#t==$.gm&&(e.data[1]<48?this.#r[r]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${r+1} to stay drums.`)):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg",!0)),this.#t){case $.xg:{[79,95,126,127].indexOf(e.data[1])>-1?this.#r[r]==0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):this.#r[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?this.#k[E]=this.EXT_VL:[35,67,83,99].indexOf(e.data[1])>-1?this.#k[E]=this.EXT_DX:this.#k[E]=this.EXT_NONE;break}case $["05rw"]:case $.x5d:case $.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?this.#r[r]==this.CH_MELODIC&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):[80,81,82,83].indexOf(e.data[1])>-1||this.#r[r]!=this.CH_MELODIC&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case $.sd:{[104,105,106,107].indexOf(e.data[1])>-1?this.#r[r]==0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):this.#r[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case $.g2:{e.data[1]==120?this.#r[r]==0&&(this.setChType(r,this.CH_DRUMS),console.debug(`CH${r+1} set to drums by MSB.`)):this.#r[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}}break}case 2:{this.getExt(r)[1]==this.VLBC_BRTHEXPR&&this.setChCc(r,129,e.data[1]);break}case 6:{if(this.#F[r]){[$.xg,$.gs,$.sc,$.ns5r].indexOf(this.#t)<0&&console.warn(`NRPN commits are not available under "${S[this.#t]}" mode, even when they are supported in Octavia.`);let v=this.getChCc(r,99),t=this.getChCc(r,98);if(v==1){let n=Ue.indexOf(t);if(n>-1)this.setChCc(r,71+n,e.data[1]),w()&&console.debug(`Redirected NRPN 1 ${t} to cc${71+n}.`),this.dispatchEvent("cc",{part:r,cc:71+n,data:e.data[1]});else{let d=te.indexOf(t);d>-1?this.#te[r*10+d]=e.data[1]-64:console.warn(`NRPN 0x01${t.toString(16).padStart(2,"0")} is not supported.`),w()&&console.debug(`CH${r+1} voice NRPN ${t} commit`)}}else{if(q.indexOf(v)<0){let d=`NRPN 0x${v.toString(16).padStart(2,"0")}${t.toString(16).padStart(2,"0")} `;v==127?console.warn(`${d}is not necessary. Consider removing it.`):console.warn(`${d}is not supported.`)}else{let d=this.#r[r]-2;d<0?console.warn(`CH${r+1} cannot accept drum NRPN as type ${X[this.#r[r]]}.`):this.#m[(d*p.dpn+O[v])*p.dnc+t]=e.data[1]}w()&&console.debug(`CH${r+1} (${X[this.#r[r]]}) drum NRPN ${v} commit`)}}else{let v=ge[this.getChCc(r,100)],t=Ee[this.getChCc(r,100)];if(this.getChCc(r,101)==0&&v!=null)switch(w()&&console.debug(`CH${r+1} RPN 0 ${this.getChCc(r,100)} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],ye[v][0]),ye[v][1]),this.#a[r*p.rpn+v]=e.data[1],this.#c[r*p.rpnt+t]=1,m){case $.xg:case $.gs:case $.sc:case $.mt32:case $.s90es:case $.motif:{switch(this.getChCc(r,100)){case 1:case 2:{this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)});break}}break}default:this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)})}}break}case 32:{switch(w()&&console.debug(`${S[this.#t]}, CH${r+1} LSB: ${e.data[1]}`),this.#t){case $.s90es:case $.motif:{this.setChType(r,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,this.#t,!0);break}}this.getExt(r)[0]==this.EXT_DX;break}case 38:{if(!this.#F[r]){let v=ge[this.getChCc(r,100)],t=Ee[this.getChCc(r,100)];this.getChCc(r,101)==0&&v!=null&&(this.#a[r*p.rpn+v+1]=e.data[1],this.#c[r*p.rpnt+t]=1)}break}case 64:{e.data[1]<64&&this.#d.hoOf(r);break}case 66:{e.data[1]>>6?this.#d.soOn(r):this.#d.soOf(r);break}case 98:case 99:{this.#F[r]=1;break}case 100:case 101:{this.#F[r]=0;break}}this.setChCc(r,e.data[0],e.data[1]),this.dispatchEvent("cc",{part:r,cc:e.data[0],data:e.data[1]})}l.getChModeId(r)==$.xg&&l.#r[r]&&l.setDrumFirstWrite(r)},12:function(e){let r=e.channel,l=this;switch(l.#t){case $.s90es:case $.motif:{e.data&&l.setChActive(r,1);break}default:l.setChActive(r,1)}let f=x[r];switch(l.getExt(r)[0]){case l.EXT_VL:break}l.#s[r]=e.data,l.#R[r]=0,l.pushChPrimitives(r),w()&&console.debug(`T:${e.track} C:${r} P:${e.data}`),l.dispatchEvent("voice",{part:r}),l.getChModeId(r)==$.xg&&l.#r[r]&&l.setDrumFirstWrite(r)},13:function(e){let r=this,l=e.channel;this.#p.forEach(function(f){let u=f>>7;l==u&&(r.#u[f]=e.data,r.dispatchEvent("note",{part:l,note:f&127,velo:e.data,state:r.NOTE_SUSTAIN}))})},14:function(e){let r=e.channel;this.#N[r]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)})},15:function(e){Ne(e.data).forEach(r=>{let l=r[0],f=r[1];(this.#ue[l]||function(){console.debug(`Unknown manufacturer ${l}.`)})(f,r.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(this.#y[e.meta]||function(l,f,u){}).call(this,e.data,e.track,e.meta),e.meta!=32&&(this.#q=0);let r=Ae.indexOf(e.meta)>-1;if(w()&&console.debug(e),r)return e.reply="meta",e}};#ue={64:(e,r,l)=>{this.#J.run(r,l,e)},65:(e,r,l)=>{if(r[0]<16)if(r[1]==72){let f=r[r.length-1],u=U(r.subarray(3,r.length-1));f==u?this.#T.run(r.subarray(0,r.length-1),l,e):console.warn(`Bad SD checksum ${f} - should be ${u}.`)}else this.#T.run(r,l,e);else{let f=r[r.length-1],u=U(r.subarray(2,r.length-1));f==u?this.#T.run(r.subarray(0,r.length-1),l,e):console.warn(`Bad GS checksum ${f} - should be ${u}.`)}},66:(e,r,l)=>{this.#U.run(r,l,e)},67:(e,r,l)=>{this.#S.run(r,l,e)},68:(e,r,l)=>{this.#ee.run(r,l,e)},71:(e,r,l)=>{this.#Z.run(r,l,e)},126:(e,r,l)=>{this.#Y.run(r,l,e)},127:(e,r,l)=>{this.switchMode("gm"),this.#j.run(r,l,e)}};#Y;#j;#S;#T;#U;#J;#Z;#ee;buildRchTree(){let e=[];this.#f.forEach((r,l)=>{r<p.ch&&(e[r]?.constructor||(e[r]=[]),e[r].push(l))}),this.#he=e}buildRccMap(){let e=this;for(let r=0;r<p.ch;r++)e.#Q[r]={};e.#K.forEach((r,l)=>{r&&(e.#Q[Math.floor(l/p.redir)][r]=l%p.redir|128)}),w()&&console.debug(e.#Q)}getActive(){return this.#C}getChActive(e){return this.#C[e]}getCc(e){if(typeof e!="number"||e<0||e>=p.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let r=this,l=x[e];return r.#e.subarray(l,l+p.cc)}getChCc(e,r){let l=this;if(H.indexOf(r)<0)throw new Error("CC number not accepted");return l.#e[x[e]+g[r]]}setChCc(e=0,r,l){let f=this;if(H.indexOf(r)<0)throw new Error("CC number not accepted");if(l?.constructor!=Number)throw new TypeError("Expected numbers for value");let u=l&255,E=x[e]+g[r];f.#e[E]=u,f.#e[E+p.chcc]=1,f.dispatchEvent("cc",{part:e,cc:r,data:u})}getCcAll(){return this.#e.slice()}resetCc(e){}resetChCc(e,r,l){let f=this;l?.constructor&&f.setChCc(e,r,l),f.#e[x[e]+g[r]+p.chcc]=0}resetCcAll(){}isChCcWritten(e,r){if(H.indexOf(r)<0)throw new Error("CC number not accepted");return upThis.#e[x[e]+g[r]+p.chcc]}getChSource(){return this.#f}getChType(){return this.#r}setChType(e,r,l=0,f=!1){r&=15;let u=this;l=l||u.getChModeId(e),u.#r[e]=r,r>0&&!f&&(u.setChCc(e,0,u.#h[l][2]),u.pushChPrimitives(e))}setChActive(e,r=0){this.#C[e]!=r&&this.dispatchEvent("channeltoggle",{part:e,active:r}),this.#C[e]=r}getExt(e){let r=p.ext*e,l=this.#k.subarray(r,r+p.ext),f=new Uint8Array(l.length);return f.set(l),f[1]=f[1]||this.#fe,f}getPitch(){return this.#N}getProgram(){return this.#s}getTexts(){return this.#x.slice()}getVel(e){let r=new Map,l=this;return l.#p.forEach(function(f,u){let E=f>>7,m=f&127;e==E&&l.#u[f]>0&&r.set(m,{v:l.#u[f],s:l.#b[u]})}),r}getBitmap(){return{bitmap:this.#$,expire:this.#M}}getLetter(){return{text:this.#_,set:this.#le,expire:this.#X}}getMode(){return S[this.#t]}getMaster(){return{volume:this.#n}}getRawStrength(){let e=this;return this.#p.forEach(function(r){let l=r>>7;e.#u[r]>e.#O[l]&&(e.#O[l]=e.#u[r])}),this.#O}getStrength(){let e=[],r=this;return this.getRawStrength().forEach(function(l,f){e[f]=Math.floor(l*r.getChCc(f,7)*r.getChCc(f,11)*r.#n/803288)}),e}getRpn(){return this.#a}getNrpn(){return this.#te}getSubDb(){return self?.structuredClone(this.#h)}getDetect(){return self?.structuredClone(this.#i)}getVoice(e,r,l,f="?"){let u=this;$[f]?.constructor||(f="?");let E=$[f],m=e||u.#h[E][0],v=r,t=l||u.#h[E][1];m==F.bank0&&(m=0),t==F.bank0&&(t=0),f=="ns5r"&&m>0&&m<56&&(t=3);let n=u.userBank.get(m,v,t,f);if(f=="mt32"&&n.name.indexOf("MT-m:")==0){let d=parseInt(n.name.slice(5)),a=d*p.cmt,c="";u.#G.subarray(a,a+10).forEach(i=>{i>31&&(c+=String.fromCharCode(i))});let s=`MSB	LSB	PRG	NME
49	127	${v}	${c}`;u.userBank.load(s,!0),n.name=c,n.ending=" "}return(n.ending!=" "||!n.name.length)&&(n=u.baseBank.get(m,v,t,f)),n}getChPrimitive(e,r,l){if(r>=p.vxPrim||r?.constructor!=Number)throw new RangeError(`Invalid voice primitive component "${r}"`);if(typeof e!="number"||e<0||e>=p.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let f=this,u=f.#s[r<<p.chShift|e];switch(r){case 1:case 2:{l&&(u=u||f.#h[f.getChModeId(e)][r-1]),u==F.bank0&&(u=0);break}}return u}getChPrimitives(e,r){let l=this,f=new Uint8Array(3);return f[1]=l.#s[e],f[0]=l.getChPrimitive(e,1,r),f[2]=l.getChPrimitive(e,2,r),f}pushChPrimitives(e){let r=this;r.#s[1<<p.chShift|e]=r.getChCc(e,0),r.#s[2<<p.chShift|e]=r.getChCc(e,32),r.dispatchEvent("voice",{part:e})}getChVoice(e){let r=this,l=r.getVoice(...r.getChPrimitives(e),r.getChMode(e));if(r.#R[e]){let f="";switch(r.#t){case $.mt32:{r.#D.subarray(p.cmt*(e-1),p.cmt*(e-1)+10).forEach(u=>{f+=String.fromCharCode(Math.max(u,32))}),f=f.trimRight();break}default:{let u=p.cvn*e;r.#ne.subarray(u,u+p.cvn).forEach(E=>{f+=String.fromCharCode(Math.max(E,32))}),f=f.trimRight()}}f.length&&(l.ending="~",l.name=f)}return l}getRawPitch(){return this.#N}getPitchShift(e){let r=this,l=e*p.rpn,f=r.#a[l];return r.#c[e*p.rpnt]||r.#t==$.mt32&&(f=12),r.#N[e]/8192*f+(r.#a[l+3]-64)+((r.#a[l+1]<<7)+r.#a[l+2]-8192)/8192}getEffectType(e=0){let r=3*e+1;return this.#w.subarray(r,r+2)}setEffectTypeRaw(e=0,r,l){let f=3*e;this.#w[f]=1,this.#w[f+1+ +r]=l}setEffectType(e=0,r,l){this.setEffectTypeRaw(e,!1,r),this.setEffectTypeRaw(e,!0,l)}getEffectSink(){return this.#re}setLetterDisplay(e,r,l=0,f=3200){let u=this,E;u.#_=" ".repeat(l),e.forEach(m=>{u.#_+=String.fromCharCode(m>31?m:32),m<32&&(E=E||new Set,E.add(m))}),u.#le=Date.now(),u.#X=Date.now()+f,u.dispatchEvent("letter"),E&&(E=Array.from(E),E.forEach((m,v,t)=>{t[v]=m.toString(16).padStart(2,"0")}),console.warn(`${r}${r?" ":""}invalid code point${E.length>1?"s":""}: 0x${E.join(", 0x")}`))}setDetectionTargets(e="?",r=0){let l=this,f=-1;switch(e.replaceAll(", ",",").split(",").forEach(u=>{u=u.toLowerCase();let E=S.indexOf(Re[u]||u);w()&&console.debug(`Mapped mode "${u}" to ID "${E}".`),E>-1&&(f=E)}),w()&&console.debug(`Set detection target to ID "${f}".`),f>0&&(l.#i.x5=82,l.#i.ds=$.krs),f){case $["05rw"]:{l.#i.x5=81;break}case $.s90es:l.#i.ds=$.s90es,l.#i.smotif=$.s90es;case $.motif:l.#i.ds=$.motif,l.#i.smotif=$.motif}}setGsTargets(e=!1,r=4){if(!r)r=e?3:4;else{if(r>4||r<0)throw new Error(`Invalid GS level ${r}`);if(e&&r>>1!=1)throw new Error(`Invalid SC level ${r}`)}let l=this;l.#i[e?"sc":"gs"]=r,l.#h[$[e?"sc":"gs"]][1]=r,l.forceVoiceRefresh()}getConfigs(){return this.#oe}setDumpLimit(e){if(e>2||e<0)throw new RangeError("Invalid dump limit.");this.#A.dumpLimit=e}allocateAce(e=0,r){let l=this;if(!r||r<128&&r>95){console.warn(`cc${r} cannot be allocated as an active custom effect.`);return}let f=!0,u=0,E=p.ace*e;for(;f&&u<p.ace;)l.#E[u+E]==r?f=!1:l.#E[u+E]||(f=!1,l.#E[u+E]=r,console.info(`Allocated cc${r} to ACE slot ${u} in CH${e+1}.`)),u++;u>=p.ace&&console.warn(`ACE slots are full in CH${e+1}.`)}allocateAceAll(e){let r=this;if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}for(let l=0;l<p.ch;l++){let f=!0,u=0,E=p.ace*l;for(;f&&u<p.ace;)r.#E[u+E]==e?f=!1:r.#E[u+E]||(f=!1,r.#E[u+E]=e),u++;u>=p.ace&&console.warn(`ACE slots are full in CH${l+1}.`)}}releaseAce(e=0,r){let l=!0,f=p.ace*e,u=f+p.ace;for(;l&&f<u;)this.#E[f]==r&&(this.#E[f]=0,l=!1),f++;l&&w()&&console.debug(`No ACE slot was allocated to cc${r} in CH${e+1}.`)}resetAce(){this.#E.fill(0),console.info("All ACE slots have been reset.")}getAce(){return this.#E}getChAce(e=0,r=0){if(r<0||r>=p.ace)throw new RangeError("No such ACE slot");let l=this.#E[p.ace*e+r];if(l){if(H.indexOf(l)>=0)return this.getChCc(e,l);throw new Error(`Invalid ACE source in CH${e+1}: ${l}`)}else return 0}initDrums(){let e=this;e.#m.fill(64);for(let r=0;r<p.drm;r++){let l=r*p.dpn;for(let f in me){let u=me[f],E=(l+O[f])*p.dnc;e.#m.subarray(E,E+p.dnc).fill(u)}}}init(e=0){let r=this;r.#q=0,r.#h[$.xg][1]=0,r.dispatchEvent("banklevel",{mode:"xg",data:0}),r.#C.fill(0),r.#e.fill(0),r.#E.fill(0),r.#s.fill(0),r.#u.fill(0),r.#p.fill(0),r.#v.fill(0),r.#O.fill(0),r.#N.fill(0),r.#te.fill(0),r.#c.fill(0),r.#k.fill(0),r.#l.fill(0),r.#z.fill(0),r.#K.fill(0),r.#n=100,r.#x=[],r.#se=500,r.#ie=0,r.#M=0,r.#g=0,r.#$.fill(0),r.#o=!1,r.#ce=0,r.#L=!0,r.initDrums(),r.#f.forEach(function(l,f,u){u[f]=f}),e==0&&(r.dispatchEvent("mode","?"),r.#t=0,r.#B.fill(0),r.#V.fill(0),r.#X=0,r.#_=""),Oe.forEach(l=>{r.setChCc(l,0,r.#h[r.getChModeId(l)][2])}),r.#r.fill(r.CH_MELODIC),r.#r[9]=r.CH_DRUM1,r.#r[25]=r.CH_DRUM3,r.#r[41]=r.CH_DRUMS,r.#r[57]=r.CH_DRUMS,r.#r[73]=r.CH_DRUM5,r.#r[89]=r.CH_DRUM7,r.#r[105]=r.CH_DRUMS,r.#r[121]=r.CH_DRUMS;for(let l=0;l<p.drm;l++)r.#P[l<<1]=0,r.#P[l<<1|1]=p.invalidCh;r.#ae.fill(0),r.#G.fill(0),r.#I.fill(0),r.#D.fill(0),r.#R.fill(0),r.#w.fill(0),r.#re.fill(0),r.aiEfxName="",r.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),r.modelEx.sc.showBar=!0,r.modelEx.sc.invBar=!1,r.modelEx.sc.invDisp=!1,r.modelEx.sc.peakHold=1;for(let l=0;l<p.ch;l++){let f=x[l];r.#e[f+g[7]]=100,r.#e[f+g[11]]=127,r.#e[f+g[2]]=127,r.#e[f+g[10]]=64,r.#e.subarray(f+g[71],f+g[71]+8).fill(64),r.#e[f+g[128]]=127,r.#e.subarray(f+g[130],f+g[157]+1).fill(64),r.#e[f+g[91]]=40,r.#e[f+g[101]]=127,r.#e[f+g[100]]=127,r.#e[f+g[99]]=127,r.#e[f+g[98]]=127;let u=l*p.rpn;r.#a[u]=2,r.#a[u+1]=64,r.#a[u+2]=0,r.#a[u+3]=64,r.#a[u+4]=0,r.#a[u+5]=0;let E=l*p.ext;r.#k[E+1]=r.VLBC_BRTHEXPR;let m=l*p.redir;r.#K[m+8]=13}r.buildRchTree(),r.buildRccMap(),r.dispatchEvent("mastervolume",r.#n),r.dispatchEvent("efxreverb",r.getEffectType(0)),r.dispatchEvent("efxchorus",r.getEffectType(1)),r.dispatchEvent("efxdelay",r.getEffectType(2)),r.dispatchEvent("efxinsert0",r.getEffectType(3)),r.dispatchEvent("efxinsert1",r.getEffectType(4)),r.dispatchEvent("efxinsert2",r.getEffectType(5)),r.dispatchEvent("efxinsert3",r.getEffectType(6)),r.dispatchEvent("reset"),r.switchMode("?")}setChMode(e,r){let l=this;if(typeof e!="number"||e<0||e>=p.ch)throw new RangeError(`Invalid part number: CH${e+1}`);if(port<0||r>=S.length)throw new RangeError(`Invalid mode ID ${r}`);l.#z[e]=r,l.dispatchEvent("chmode",{part:e,id:r,mode:S[r]}),l.dispatchEvent("voice",{part:e})}getChMode(e,r){return S[this.getChModeId(e,r)]}getChModeId(e,r){return r?this.#z[e]||this.#l[e>>4]:this.#z[e]||this.#l[e>>4]||this.#t}setPortMode(e,r,l){let f=this;if(e<0||e>=p.ch>>4)throw new RangeError(`Invalid port ${e+1}`);if(r<1)throw new RangeError("Range must be a positive integer");if(e+r>=p.ch>>4)throw new RangeError("Range must be in bound");if(e<0||l>=S.length)throw new RangeError(`Invalid mode ID ${l}`);for(let u=e;u<e+r;u++){f.#l[u]=l;for(let E=u<<4;E<u+1<<4;E++)f.dispatchEvent("chmode",{part:E,id:l,mode:S[l]}),f.dispatchEvent("voice",{part:E})}}copyChSetup(e,r,l){if(e==r){console.warn(`Failed attempt at overwriting CH${e+1} with its own data.`);return}let f=this;if(l&&f.#C[r]){console.warn(`Failed attempt at copying setup data from CH${e+1} to CH${r+1}.`);return}let u=x[e],E=x[r];f.#s[r]=f.#s[e],f.#e.set(f.#e.subarray(u,u+p.cc),E),f.pushChPrimitives(r)}setDrumFirstWrite(e,r){let l=this,f=l.#r[e];if(f<2)return;let u=f-2;if(l.#P[u<<1])if(r)l.#P[u<<1]=0,w()&&console.debug(`First write part for drum set ${u+1} has been reset.`);else return;else r?console.warn(`First write part for drum set ${u+1} is already blank.`):(l.#P[u<<1]=1,l.#P[u<<1|1]=e,console.debug(`First write part for drum set ${u+1} is set to CH${e+1}.`))}getChDrumFirstWrite(e){let r=this,l=r.#r[e];if(l<2)return;let f=l-2;return r.#P.subarray(f<<1,f+1<<1)}getDrumFirstWrite(e){if(e>=0&&e<p.drm)return this.#P.subarray(e<<1,e+1<<1)}switchMode(e,r=!1,l=!1){let f=this,u=$[e];if(u>-1){if(f.#t==0||r){f.initOnReset&&r&&this.init(1),f.#t=u,f.#g=0;for(let m=0;m<p.ch;m++){let v=f.getChModeId(m,!0);f.#r[m]>0&&v==$["?"]&&(f.setChCc(m,0,f.#h[u][2]),w()&&console.debug(`CH${m+1} (${f.#r[m]}) (${f.getChMode(m)}), ${S[v]} (${f.#h[v][2]}) -> ${S[u]} (${f.#h[u][2]})`),f.pushChPrimitives(m))}switch(u){case $.mt32:{Z.forEach((m,v)=>{let t=v+1;f.#C[t]||(f.#s[t]=m,f.setChCc(t,91,127),f.pushChPrimitives(t))});for(let m=1;m<10;m++)f.dispatchEvent("voice",{part:m});break}}let E;switch(u){case $["?"]:case $.g2:{E=[52,4,52,18,0,0,0,0];break}case $.xg:{E=[1,0,65,0,5,0,0,0];break}case $.gm:case $.gs:case $.sc:{E=[40,4,40,18,40,32,32,0];break}case $.sd:{E=[58,0,60,0,61,0,61,0];break}case $["05rw"]:case $.x5d:case $.ns5r:{E=[44,1,44,19,44,0,44,0];break}case $.k11:case $.sg:{E=[24,0,0,0,0,0,0,0];break}case $.mt32:{E=[40,4,0,0,0,0,0,0];break}case $.doc:{E=[24,16,0,0,0,0,0,0];break}case $.motif:case $.s90es:{E=[113,0,117,0,114,0,0,0];break}default:E=[0,0,0,0,0,0,0,0]}for(let m=0;m<p.efx;m++)!f.#w[3*m]&&E[m<<1]?.constructor&&(f.#w[3*m+1]=E[2*m],f.#w[3*m+2]=E[2*m+1],f.dispatchEvent(`efx${["reverb","chorus","delay","insert0"][m]}`,f.getEffectType(m)));l&&f.setDetectionTargets(e),f.dispatchEvent("mode",e),f.forceVoiceRefresh()}}else throw new Error(`Unknown mode ${e}`)}newStrength(){this.#O.fill(0)}runJson(e){if(e.type>14)return e.type==15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),this.#de[e.type].call(this,e);{let r=this.chRedir(e.part,e.track),l=!1;this.#he[r]?.forEach(f=>{e.channel=f,l=!0,this.#de[e.type].call(this,e)}),l||console.warn(`${be[e.type]?be[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${r+1} without any recipient.`)}this.#x.length>100&&this.#x.splice(100,this.#x.length-99)}runRaw(e){}async loadBank(e,r){let l=this;switch(e=e.toLowerCase(),e){case"s7e":{l.userBank.clearRange({msb:63,lsb:[21,22]}),l.userBank.clearRange({msb:63,lsb:[24,27]});break}case"pcg":{l.userBank.clearRange({msb:63,lsb:[6,9]}),l.userBank.clearRange({msb:63,lsb:[13,16]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":case"pcg":{G.context=this,await l.userBank.load(await G.read(e,r),!1);break}}l.forceVoiceRefresh()}constructor(){super();let e=this;e.#$=new Uint8Array(256),e.#H[10]=new Uint8Array(512),e.#W=new R,e.#i={x5:82,ds:$.krs,smotif:$.s90es,gs:4,sc:3},e.#A={dumpLimit:e.DUMP_MODE},e.#oe=new Proxy(e.#A,{set:()=>{}});for(let t in pe){let n=$[t];n==null?console.debug(`SubDB build error: "${t}" does not exist`):e.#h[n]=new Uint8Array(pe[t])}e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(t){let{data:n}=t;e.#x[0]?.type==n.type&&e.#x[0]?.amend?(e.#x[0].amend=n.amend,e.#x[0].data+=n.data):e.#x.unshift(n)}),e.#y[1]=function(t){switch(t=t.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),t.slice(0,2)){case"@I":{this.#o=!0,this.dispatchEvent("metacommit",{type:"Kar.Info",data:t.slice(2)?.trimLeft()});break}case"@K":{this.#o=!0,this.dispatchEvent("metacommit",{type:"Kar.Mode",data:t.slice(2)?.trimLeft()}),console.debug(`Karaoke mode active: ${t.slice(2)}`);break}case"@L":{this.#o=!0,this.dispatchEvent("metacommit",{type:"Kar.Lang",data:t.slice(2)?.trimLeft()});break}case"@T":{this.#o=!0,this.dispatchEvent("metacommit",{type:"KarTitle",data:t.slice(2)?.trimLeft()});break}case"@V":{this.#o=!0,this.dispatchEvent("metacommit",{type:"Kar.Ver.",data:t.slice(2)?.trimLeft()});break}case"XF":{let n=t.slice(2).split(":");switch(n[0]){case"hd":{n.slice(1).forEach((d,a)=>{d.length&&this.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][a],data:d})});break}case"ln":{n.slice(1).forEach((d,a)=>{d.length&&this.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][a],data:d})});break}default:this.dispatchEvent("metacommit",{type:"XfUnData",data:t})}break}default:this.#o?t[0]=="\\"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:t.slice(1),amend:!0})):t[0]=="/"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:t.slice(1),mask:!0,amend:!0})):this.dispatchEvent("metacommit",{type:"KarLyric",data:t,amend:!0}):t.split(`
`).forEach((n,d)=>{this.dispatchEvent("metacommit",{type:"Cmn.Text",data:n,mask:d!=0})})}},e.#y[2]=function(t){this.dispatchEvent("metacommit",{type:"Copyrite",data:t})},e.#y[3]=function(t,n){n<1&&this.#q<1&&this.dispatchEvent("metacommit",{type:"TrkTitle",data:t})},e.#y[4]=function(t,n){this.dispatchEvent("metacommit",{type:"Instrmnt",data:t})},e.#y[5]=function(t){t.trim()==""?this.dispatchEvent("metacommit",{type:"C.Lyrics",data:"",amend:!1}):this.dispatchEvent("metacommit",{type:"C.Lyrics",data:t,amend:!0})},e.#y[6]=function(t){this.dispatchEvent("metacommit",{type:"C.Marker",data:t})},e.#y[7]=function(t){this.dispatchEvent("metacommit",{type:"CuePoint",data:t})},e.#y[32]=function(t){this.#q=t[0]+1},e.#y[33]=function(t,n){w()&&console.debug(`Track ${n} requests to get assigned to output ${t}.`),e.#V[n]=t+1},e.#y[81]=function(t,n){e.#se=t/1e3},e.#y[127]=function(t,n){e.#W.run(t,n)},e.#W.default=function(t){console.warn(`Unrecognized sequencer-specific byte sequence: ${t}`)},e.#W.add([67,0,1],function(t,n){w()&&console.debug(`XGworks requests assigning track ${n} to output ${t[0]}.`),e.#V[n]=t[0]+1}),e.#Y=new R("universal non-realtime"),e.#j=new R("universal realtime"),e.#S=new R("Yamaha"),e.#T=new R("Roland"),e.#U=new R("Korg"),e.#J=new R("Kawai"),e.#Z=new R("Akai"),e.#ee=new R("Casio");let r=new R("DX7+ Dump"),l=function(t){console.info(`Unrecognized SysEx in "${this.name}" set.
%o`,t)};e.#Y.default=l,e.#j.default=l,e.#S.default=l,e.#T.default=l,e.#U.default=l,e.#J.default=l,e.#Z.default=l,e.#ee.default=l,r.default=l,e.#Y.add([9],(t,n,d)=>{e.switchMode(["gm","?","g2"][t[0]-1],!0),e.setPortMode(e.getTrackPort(n),1,$[["gm","?","g2"][t[0]-1]]),e.#o=e.#o||!1,console.info(`MIDI reset: ${["GM","Init","GM2"][t[0]-1]}`),t[0]==2&&e.init()}),e.#j.add([4,1],(t,n,d)=>{e.dispatchEvent("mupromptex"),e.#n=((t[1]<<7)+t[0])/16383*100,e.dispatchEvent("mastervolume",e.#n)}).add([4,3],(t,n,d)=>((t[1]<<7)+t[0]-8192)/8192).add([4,4],(t,n,d)=>t[1]-64).add([4,5],(t,n,d)=>{e.dispatchEvent("mupromptex");let a=t[0],c=t[1],s=t[2],i=3,h=i+(a<<1),o=h+c;if(a!=1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${a})!
`,t);return}let b=0,y=0,C=0;switch(t.subarray(i,h).forEach(k=>{b=b<<7,b|=k}),t.subarray(h,o).forEach((k,T)=>{y|=k<<T*7}),t.subarray(o).forEach((k,T)=>{C|=k<<T*7}),w()&&console.debug(`GM2 global parameter: (${t.subarray(3,h)}; p: ${y}, v: ${C})`),b){case 129:{y==0&&(e.setEffectType(0,52,C),e.dispatchEvent("efxreverb",e.getEffectType(0)));break}case 130:{y==0&&(e.setEffectType(1,52,C|16),e.dispatchEvent("efxchorus",e.getEffectType(1)));break}default:w()&&console.debug("GM2 global paramater slot path unknown.")}}),this.#S.add([76,0,0],(t,n,d)=>{switch(t[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset: ${t}`);break}case 126:{e.switchMode("xg",!0),e.setPortMode(e.getTrackPort(n),4,$.xg),e.#o=!1,console.info("MIDI reset: XG");break}default:{e.dispatchEvent("mupromptex");let a=[0,0,0,0],c=(s,i)=>{a[i]=s};if(t.subarray(1).forEach((s,i)=>{let h=i+t[0];([c,c,c,c,o=>{this.#n=o*129/16383*100,e.dispatchEvent("mastervolume",e.#n)},o=>{},o=>{}][h]||(()=>{}))(s,i)}),t[0]<4){let s=0;a.forEach(i=>{s=s<<4,s+=i}),s-=1024}}}}).add([76,2,1],(t,n,d)=>{e.dispatchEvent("mupromptex");let a="XG ";t[0]<32?(a+="reverb ",t.subarray(1).forEach((c,s)=>{([i=>{e.setEffectTypeRaw(0,!1,i),console.info(`${a}main type: ${_[i]}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},i=>{e.setEffectTypeRaw(0,!0,i),console.debug(`${a}sub type: ${i+1}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},i=>{console.debug(`${a}time: ${ce(i)}s`)},i=>{console.debug(`${a}diffusion: ${i}`)},i=>{console.debug(`${a}initial delay: ${i}`)},i=>{console.debug(`${a}HPF cutoff: ${B[i]}Hz`)},i=>{console.debug(`${a}LPF cutoff: ${B[i]}Hz`)},i=>{console.debug(`${a}width: ${i}`)},i=>{console.debug(`${a}height: ${i}`)},i=>{console.debug(`${a}depth: ${i}`)},i=>{console.debug(`${a}wall type: ${i}`)},i=>{console.debug(`${a}dry/wet: ${i}`)},i=>{console.debug(`${a}send: ${P(i)}dB`)},i=>{console.debug(`${a}pan: ${i-64}`)},!1,!1,i=>{console.debug(`${a}delay: ${i}`)},i=>{console.debug(`${a}density: ${i}`)},i=>{console.debug(`${a}balance: ${i}`)},i=>{},i=>{console.debug(`${a}feedback: ${i}`)},i=>{}][t[0]+s]||function(){console.warn(`Unknown XG reverb address: ${t[0]}.`)})(c)})):t[0]<64?(a+="chorus ",t.subarray(1).forEach((c,s)=>{([i=>{e.setEffectTypeRaw(1,!1,i),console.info(`${a}main type: ${_[i]}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},i=>{e.setEffectTypeRaw(1,!0,i),console.debug(`${a}sub type: ${i+1}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},i=>{console.debug(`${a}LFO: ${ie[i]}Hz`)},i=>{},i=>{console.debug(`${a}feedback: ${i}`)},i=>{console.debug(`${a}delay offset: ${ne(i)}ms`)},i=>{},i=>{console.debug(`${a}low: ${B[i]}Hz`)},i=>{console.debug(`${a}low: ${i-64}dB`)},i=>{console.debug(`${a}high: ${B[i]}Hz`)},i=>{console.debug(`${a}high: ${i-64}dB`)},i=>{console.debug(`${a}dry/wet: ${i}`)},i=>{console.debug(`${a}send: ${P(i)}dB`)},i=>{console.debug(`${a}pan: ${i-64}`)},i=>{console.debug(`${a}to reverb: ${P(i)}dB`)},!1,i=>{},i=>{},i=>{},i=>{console.debug(`${a}LFO phase diff: ${(i-64)*3}deg`)},i=>{console.debug(`${a}input mode: ${i?"stereo":"mono"}`)},i=>{}][t[0]-32+s]||function(){console.warn(`Unknown XG chorus address: ${t[0]}.`)})(c)})):t[0]<86?(a+="variation ",t.subarray(1).forEach((c,s)=>{([i=>{e.setEffectTypeRaw(2,!1,i),console.info(`${a}main type: ${_[i]}`),e.dispatchEvent("efxdelay",e.getEffectType(2))},i=>{e.setEffectTypeRaw(2,!0,i),console.debug(`${a}sub type: ${i+1}`),e.dispatchEvent("efxdelay",e.getEffectType(2))}][t[0]-64+s]||function(){})(c)})):t[0]<97?(a+="variation ",t.subarray(1).forEach((c,s)=>{[i=>{console.debug(`${a}send: ${P(i)}dB`)},i=>{console.debug(`${a}pan: ${i-64}`)},i=>{console.debug(`${a}to reverb: ${P(i)}dB`)},i=>{console.debug(`${a}to chorus: ${P(i)}dB`)},i=>{console.debug(`${a}connection: ${i?"system":"insertion"}`)},i=>{console.debug(`${a}channel: CH${i+1}`)},i=>{console.debug(`${a}mod wheel: ${i-64}`)},i=>{console.debug(`${a}bend wheel: ${i-64}`)},i=>{console.debug(`${a}channel after touch: ${i-64}`)},i=>{console.debug(`${a}AC1: ${i-64}`)},i=>{console.debug(`${a}AC2: ${i-64}`)}][t[0]-86+s](c)})):t[0]>111&&t[0]<118?a+="variation ":console.warn(`Unknown XG variation address: ${t[0]}`)}).add([76,2,64],(t,n,d)=>{t.subarray(1).forEach((a,c)=>{let s=c+t[0];if(s==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][a]}`);else{let i=s-1>>2,h=s-1&3,o=`XG EQ ${i} ${["gain","freq","Q","shape"][h]}: `;[()=>{console.debug(`${o}${a-64}dB`)},()=>{console.debug(`${o}${a} (raw)`)},()=>{console.debug(`${o}${a/10}`)},()=>{console.debug(`${o}${["shelf","peak"][+!!a]}`)}][h]()}})}).add([76,3],(t,n,d)=>{e.dispatchEvent("mupromptex");let a=t[0],c=t[1],s=`XG Insertion ${t[0]+1} `;t.subarray(2).forEach((i,h)=>{([o=>{e.setEffectTypeRaw(3+a,!1,o),console.info(`${s}main type: ${_[o]}`),e.dispatchEvent(`efxinsert${a}`,e.getEffectType(3+a))},o=>{e.setEffectTypeRaw(3+a,!0,o),console.debug(`${s}sub type: ${o+1}`),e.dispatchEvent(`efxinsert${a}`,e.getEffectType(3+a))}][c+h]||function(){})(i)})}).add([76,6,0],(t,n,d)=>{let a=t[0];a<64?e.setLetterDisplay(t.subarray(1),"XG letter display",a):e.#X=Date.now()}).add([76,7,0],(t,n,d)=>{let a=t[0];e.#g=0,e.#M=Date.now()+3200,e.#$.fill(0);let c=t.subarray(1);for(let s=0;s<a;s++)c.unshift(0);c.forEach(function(s,i){let h=Math.floor(i/16),o=i%16,b=(o*3+h)*7,y=7,C=0;for(b-=o*5,h==2&&(y=2);C<y;)e.#$[b+C]=s>>6-C&1,C++})}).add([76,8],(t,n)=>{e.dispatchEvent("mupromptex");let d=e.chRedir(t[0],n,!0),a=t[1],c=x[d],s=`XG CH${d+1} `,i=`Unknown XG part address ${a}.`,h=!0;t.subarray(2).forEach((o,b)=>{h=!0,a<1?console.debug(i):a<41?([()=>{e.setChCc(d,0,o),e.pushChPrimitives(d),e.dispatchEvent("voice",{part:d})},()=>{e.setChCc(d,32,o),e.pushChPrimitives(d),e.dispatchEvent("voice",{part:d})},()=>{e.#s[d]=o,e.dispatchEvent("voice",{part:d})},()=>{h=!1;let y=e.chRedir(o,n,!0);e.#f[d]=y,d!=y&&(e.buildRchTree(),console.info(`${s}receives from CH${y+1}`)),e.#C[d]||(e.copyChSetup(y,d,!0),console.debug(`${s}copied from CH${y+1}.`),e.setChActive(d,1),e.dispatchEvent("voice",{part:d}))},()=>{e.#v[d]=+!o},()=>{},()=>{h=!1,e.setChType(d,o,$.xg),console.debug(`${s}type: ${X[o]||o}`),e.dispatchEvent("voice",{part:d})},()=>{e.#a[p.rpn*d+3]=o,e.#c[p.rpnt*d+2]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)})},!1,!1,()=>{e.setChCc(d,7,o)},!1,!1,()=>{e.setChCc(d,10,o||128)},!1,!1,()=>{e.setChCc(d,128,o),e.allocateAce(d,128)},()=>{e.setChCc(d,93,o)},()=>{e.setChCc(d,91,o)},()=>{e.setChCc(d,94,o)},()=>{e.setChCc(d,76,o)},()=>{e.setChCc(d,77,o)},()=>{e.setChCc(d,78,o)},()=>{e.setChCc(d,74,o)},()=>{e.setChCc(d,71,o)},()=>{e.setChCc(d,73,o)},()=>{e.setChCc(d,75,o)},()=>{e.setChCc(d,72,o)}][a+b-1]||(()=>{}))():a<48?console.debug(i):a<111?a>102&&a<105&&e.setChCc(d,[5,65][a&1],o):a<114?console.debug(i):a<116?console.debug(`${s}EQ ${["bass","treble"][a&1]} gain: ${o-64}dB`):a<118?console.debug(i):a<120?console.debug(`${s}EQ ${["bass","treble"][a&1]} freq: ${o}`):console.debug(i)}),h&&e.#r[d]>1&&e.setDrumFirstWrite(d)}).add([76,9],(t,n)=>{let d=e.chRedir(t[0],n,!0),a=t[1],c=x[d],s=`PLG-VL CH${d+1} `;t.subarray(2).forEach((i,h)=>{let o=h+a;switch(o){case 1:{console.info(`${s}breath mode: ${["system","breath","velocity","touch EG"][i]}`);break}case 0:case 27:case 28:break;default:if(o<27){let b=o-3>>1,y=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][b];o&1?o<23?(console.debug(`${s}${y} control source: ${he(i)}`),i&&i<96&&e.allocateAce(d,130+b),e.#K[p.redir*d+b+2]=i,e.buildRccMap()):console.debug(`${s}${y} scale break point: ${i}`):(console.debug(`${s}${y} depth: ${i-64}`),e.setChCc(d,130+b,i))}}})}).add([76,10],(t,n,d)=>{}).add([76,16],(t,n,d)=>{}).add([76,17,0,0],(t,n,d)=>{}).add([76,112],(t,n,d)=>{switch(console.debug(`XG enable PLG-${["VL","SG","DX","AN","PF","DR","PC","AP"][t[0]]} for CH${t[2]+1}.`),t[0]){case 0:{e.#k[p.ext*t[2]]=e.EXT_VL;break}case 2:{e.#k[p.ext*t[2]]=e.EXT_DX;break}default:e.#k[p.ext*t[2]]=e.EXT_NONE}}).add([73,0,0],(t,n)=>{let d=t[0],a="MU1000 System - ";t.subarray(1).forEach((c,s)=>{let i=d+s;i==8?console.debug(`${a}LCD contrast: ${c}.`):i==18?(e.#h[$.xg][1]=c?126:0,console.debug(`${a}default bank: ${c?"MU100 Native":"MU Basic"}.`),e.dispatchEvent("banklevel",{mode:"xg",data:+!!c}),e.forceVoiceRefresh()):i>=64&&i<69&&[()=>{e.dispatchEvent("channelactive",c)},()=>{c<8?(e.dispatchEvent("channelmin",c<<4),console.debug(`Octavia System: Minimum CH${(c<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{c<8?(e.dispatchEvent("channelmax",(c<<4)+15),console.debug(`Octavia System: Maximum CH${(c<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{e.#L=!!c,console.info(`Octavia System: RS receiving ${["dis","en"][c]}abled.`)}][i-64]()})}).add([73,10,0],(t,n)=>{let d=t[0],a=`MU1000 RS${e.#L?"":" (ignored)"}: `;if(d<16)switch(d){case 2:{let c=e.chRedir(0,n,!0);e.#L&&(e.dispatchEvent("portrange",4),e.dispatchEvent("portstart",c)),console.info(`${a}Show CH${c+1}~CH${c+64}`);break}case 3:{let c=e.chRedir(t[1]<<5,n,!0);e.#L&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",c)),console.info(`${a}Show CH${c+1}~CH${c+32}`);break}default:console.debug(`${a}unknown switch ${d} invoked.`)}else if(d<32){if(e.#L){let c=e.chRedir(d-16+(e.#ce<<4),n,!0);e.dispatchEvent("channelactive",c)}}else if(d<36){let c=e.chRedir(d-32<<4,n,!0);e.#L&&(e.dispatchEvent("portrange",1),e.dispatchEvent("portstart",c>>4),e.#ce=d-32),console.info(`${a}Show CH${c+1}~CH${c+16}`)}}).add([73,11,0],(t,n)=>{let d="MU1000 System - channel ",a="Octavia System - channel ",c=t[0];t.subarray(1).forEach((s,i)=>{let h=c+i;([()=>{e.setChActive(s,1),e.dispatchEvent("channelactive",s),w()&&console.debug(`${d}current part: CH${s+1}`)},()=>{s<5?(e.dispatchEvent("portrange",1<<s),console.debug(`${d}port range: ${1<<s} port(s)`)):(e.dispatchEvent("portrange",0),console.debug(`${d}port range: reset`))},()=>{s<16?(e.dispatchEvent("portstart",s),console.debug(`${a}start port: ${"ABCDEFGHIJKLMNOP"[s]}`)):(e.dispatchEvent("portstart",255),console.debug(`${a}start port: reset`))}][h]||(()=>{console.debug(`${d}unknown address: ${h}`)}))()})}).add([93,3],(t,n)=>{let d=e.chRedir(t[0],n,!0),a=`PLG-SG CH${d+1} `,c=Date.now();if(t[1]==0){let s="",i=0;t.subarray(2).forEach((h,o)=>{o%2==0?s+=oe[h]||h.toString().padStart("0"):i+=h*13}),c>=e.#ie&&this.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"SGLyrics",data:`${le(s)}`,amend:!0}),e.#ie=c+Math.ceil(i/2)+e.#se,w()&&console.debug(`${a}vocals: ${s}`)}else console.warn(`Unknown PLG-SG data: ${t}`)}).add([98,0],(t,n,d)=>{e.dispatchEvent("mupromptex");let a=t[0],c=t.length-5,s=t.length-1;if(a!=c){console.info(`PLG-DX native dump size mismatch! Gave ${a} instead of ${t.length-5}.`);return}let i=U(t.subarray(4,s));if(i!=t[s]){console.info(`Bad PLG-DX checksum ${t[s]} - should be ${i}.`);return}t[0]=98,e.#S.run(t.subarray(0,s),n,d,{noAce:!0})}).add([98,96],(t,n,d,a)=>{let c=e.chRedir(t[0],n,!0),s=x[c],i=t[1];t.subarray(2).forEach((h,o)=>{let b=i+o;if(!(b<10)){if(b==10)e.resetAce();else if(b<27){let y=b+131;a?.noAce||e.allocateAce(c,y),e.setChCc(c,y,h),e.dispatchEvent("cc",{part:c,cc:y,data:h})}}})}).add([100,0],(t,n,d)=>{let a=t.subarray(0,t.length-1);if(t[0]+5!=t.length){console.warn(`Yamaha DX7+ dump SysEx size mismatch! Expected ${t.length}, but got ${t[0]}:
`,t);return}let c=U(a),s=t[t.length-1];if(c!=s){console.warn(`Yamaha DX7+ dump SysEx checksum mismatch! Expected ${c}, but got ${s}:
`,t);return}r.run(a.subarray(1))}).add([100,76],(t,n,d)=>{let a=t[0]>>4,c=t[0]&15,s=t[1];switch(a){case 2:{let i=e.chRedir(c,n,!0),h=x[i];t.subarray(2).forEach((o,b)=>{let y=b+s;if(!(y<7)){if(y<23){let C=y+135;e.allocateAce(i,C),e.setChCc(i,C,o),e.dispatchEvent("cc",{part:i,cc:C,data:o})}}});break}default:console.info("Unknown DX7+ multipart: %o",t)}}).add([1,20],(t,n,d)=>{d==115?(e.switchMode("doc",!0),e.setPortMode(e.getTrackPort(n),1,$.doc),console.info("MIDI reset: DOC")):console.debug(`Unknown Yamaha SysEx: 67, ${d}, ${t.join(", ")}`)}).add([1,17,15,89],(t,n,d)=>{d==115?(e.setEffectType(0,24,t[0]|16),e.dispatchEvent("efxreverb",e.getEffectType(0))):console.debug(`Unknown Yamaha SysEx: 67, ${d}, ${t.join(", ")}`)}).add([1,24],(t,n,d)=>{if(d==115){for(let a=0;a<16;a++){let c=e.chRedir(a,n,!0);e.setChCc(c,91,127)}console.info("DOC Global Reverb: on")}else console.debug(`Unknown Yamaha SysEx: 67, ${d}, ${t.join(", ")}`)}),r.add([14,31],(t,n,d)=>{e.setChCc(t[0],64,0),e.#d.ano(t[0]),e.switchMode("xg"),e.setPortMode(e.getTrackPort(n),1,$.xg),e.resetAce(),console.debug(`Yamaha DX7+ reset CH${t[0]+1}.`)}).add([76,112],async t=>{let n=t[0],d=x[n],a=ve[n],c=p.cvn*n;e.#k[a]=e.EXT_DX,e.#R[n]=1;let s=e.#ne.subarray(c,c+p.cvn);s.fill(32),t.subarray(1).forEach((i,h)=>{if(h<10)s[h]=Math.max(i,32);else if(!(h<40)){if(h<56){let o=h+102;e.setChCc(n,o,i),e.dispatchEvent("cc",{part:n,cc:o,data:i})}}}),e.#s[n]=n&127,e.setChCc(n,0,35),e.setChCc(n,32,n>>7|4),e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n}),console.debug(`DX7+ CH${n+1} dump: %o`,t)});let f=function(t,n,d,a){},u=function(t,n){e.dispatchEvent("mupromptex");let d=t*p.dpn,a=n[0],c=n[1];n.subarray(2).forEach((s,i)=>{let h=i+c,o=-1;h<16?([()=>{o=24},()=>{o=25},()=>{o=26},()=>{},()=>{o=28},()=>{o=29},()=>{o=30},()=>{o=31},()=>{},()=>{},()=>{},()=>{o=20},()=>{o=21},()=>{o=22},()=>{o=23},()=>{}][h]||(()=>{console.debug(`Unknown XG-style drum param ${h} on set ${t+1}.`)}))():h<32||(h<40?([()=>{o=48},()=>{o=49},!1,!1,()=>{o=52},()=>{o=53}][h-32]||(()=>{console.debug(`Unknown XG-style drum param ${h} on set ${t+1}.`)}))():h<80||([()=>{o=36}][h-80]||(()=>{console.debug(`Unknown XG-style drum param ${h} on set ${t+1}.`)}))()),o>=0?(w()&&console.debug(d,o,a,s),e.#m[(d+O[o])*p.dnc+a]=s):w()&&console.debug(`XG-style drum param ${h} has no writes.`)})},E=function(t,n,d){e.dispatchEvent("mupromptex");let a=t*p.dpn,c=(n<<7)+d[0];d.subarray(1).forEach((s,i)=>{let h=i+c,o=h&127,b=h>>7,y=-1;b>1&&([()=>{y=26},()=>{},()=>{y=28},()=>{y=29},()=>{y=30},()=>{},()=>{},()=>{y=31}][b-2]||(()=>{console.debug(`Unknown GS-style drum param ${b} on set ${t+1}.`)}))(),y>-1?(w()&&console.debug(a,y,o,s),e.#m[(a+O[y])*p.dnc+o]=s):w()&&console.debug(`GS-style drum param ${b} has no writes.`)})};this.#S.add([76,48],(t,n,d)=>{u(0,t)}).add([76,49],(t,n,d)=>{u(1,t)}).add([76,50],(t,n,d)=>{u(2,t)}).add([76,51],(t,n,d)=>{u(3,t)}).add([76,52],(t,n,d)=>{u(4,t)}).add([76,53],(t,n,d)=>{u(5,t)}).add([76,54],(t,n,d)=>{u(6,t)}).add([76,55],(t,n,d)=>{u(7,t)}),this.#S.add([89,0],(t,n,d)=>{if(e.eprom){let a=t[0],c=(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);w()&&console.debug(`MU1000 EPROM trail to 0x${c.toString(16).padStart(6,"0")}, ${a} bytes.`);let s=e.eprom.data;t.subarray(4).forEach((i,h)=>{let o=h>>3,b=h&7;if(b==7)for(let y=0;y<7;y++)s[c+7*o+y]+=(i>>6-y&1)<<7;else s[c+7*o+b]=i})}}).add([89,1],(t,n,d)=>{let a=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3];w()&&console.debug(`MU1000 EPROM jump to 0x${a.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=a)}).add([89,2],(t,n,d)=>{if(e.eprom){let a=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);w()&&console.debug(`MU1000 EPROM write to 0x${a.toString(16).padStart(6,"0")}.`);let c=e.eprom.data;t.subarray(4).forEach((s,i)=>{let h=i>>3,o=i&7;if(o==7)for(let b=0;b<7;b++)c[a+7*h+b]+=(s>>6-b&1)<<7;else c[a+7*h+o]=s})}}).add([89,3],(t,n,d)=>{}),this.#S.add([39,48],(t,n,d)=>{}).add([43,0,0],(t,n,d)=>{e.dispatchEvent("mupromptex");let a=[0,0,0,0],c=(s,i)=>{a[i]=s};if(t.subarray(1).forEach((s,i)=>{let h=i+t[0];[c,c,c,c,()=>{this.#n=s*129/16383*100,e.dispatchEvent("mastervolume",e.#n)},()=>s-64,()=>s||128,()=>s,()=>s,()=>{console.debug(`TG300 variation on cc${s}.`)}][h](s,h)}),t[0]<4){let s=0;a.forEach(i=>{s=s<<4,s+=i}),s-=1024}}).add([43,1,0],(t,n,d)=>{e.dispatchEvent("mupromptex")}).add([43,2],(t,n,d)=>{e.dispatchEvent("mupromptex");let a=e.chRedir(t[0],n,!0),c=t[1],s=x[a],i=`TG300 CH${a+1} `;t.subarray(2).forEach((h,o)=>{o<5?([()=>{},()=>{e.setChCc(a,0,h),e.pushChPrimitives(a),e.dispatchEvent("voice",{part:a})},()=>{e.setChCc(a,32,h),e.pushChPrimitives(a),e.dispatchEvent("voice",{part:a})},()=>{e.#s[a]=h,e.dispatchEvent("voice",{part:a})},()=>{let b=e.chRedir(h,n,!0);e.#f[a]=b,a!=b&&(e.buildRchTree(),console.info(`${i}receives from CH${b+1}`))}][o+c]||(()=>{}))(h,o+c):o<21||(o<47?([()=>{e.#v[a]=+!h},()=>{},()=>{},()=>{e.#a[p.rpn*a+3]=h,e.#c[p.rpnt*a+2]=1,e.dispatchEvent("pitch",{part:a,pitch:e.getPitchShift(a)})},()=>{},()=>{e.setChCc(a,7,h)},!1,!1,()=>{e.setChCc(a,10,h||128)},!1,!1,()=>{console.debug(`${i} AC1 at cc${h}`)},()=>{console.debug(`${i} AC2 at cc${h}`)},()=>{e.#e[s+g[128]]=h,e.allocateAce(a,128)},()=>{e.#e[s+g[93]]=h},()=>{e.#e[s+g[91]]=h},()=>{e.#e[s+g[94]]=h},()=>{e.#e[s+g[76]]=h},()=>{e.#e[s+g[77]]=h},()=>{e.#e[s+g[74]]=h},()=>{e.#e[s+g[71]]=h},()=>{e.#e[s+g[73]]=h},()=>{e.#e[s+g[75]]=h},()=>{e.#e[s+g[72]]=h},()=>{e.#e[s+g[78]]=h}][o+c-21]||(()=>{}))(h,o+c):o<95||([()=>{e.#e[s+g[65]]=h},()=>{e.#e[s+g[5]]=h}][o+c-95]||(()=>{}))(h,o+c))})}).add([43,7,0],(t,n,d)=>{let a=t[0];e.setLetterDisplay(t.subarray(1),"TG300 letter display",a)}).add([43,7,1],(t,n,d)=>{e.#g=0,e.#M=Date.now()+3200,e.#$.fill(0),t.forEach(function(a,c){let s=Math.floor(c/16),i=c%16,h=(i*3+s)*7,o=7,b=0;for(h-=i*5,s==2&&(o=2);b<o;)e.#$[h+b]=a>>6-b&1,b++})}),this.#T.add([66,18,0,0,127],(t,n,d)=>{e.switchMode("sc",!0),e.setPortMode(e.getTrackPort(n),2,$.sc),e.#h[$.sc][1]=e.#i.sc,e.#o=!1,e.#B.fill(0),console.info(`GS system to ${["single","dual"][t[0]]} mode.`)}).add([66,18,64,0],(t,n,d)=>{switch(t[0]){case 127:{e.switchMode("gs",!0),e.setPortMode(e.getTrackPort(n),2,$.gs),e.#h[$.gs][1]=e.#i.gs,e.#o=!1,e.#B.fill(0),console.info("MIDI reset: GS");break}default:{e.dispatchEvent("mupromptex");let a=[0,0,0,0],c=(s,i)=>{a[i]=s};if(t.subarray(1).forEach((s,i)=>{let h=i+t[0];[c,c,c,c,o=>{this.#n=o*129/16383*100,e.dispatchEvent("mastervolume",e.#n)},o=>{},o=>{}][h](s,i)}),t[0]<4){let s=0;a.forEach(i=>{s=s<<4,s+=i}),s-=1024}}}}).add([66,18,64,1],(t,n,d)=>{e.dispatchEvent("mupromptex");let a=t[0];if(a<16){let c="".padStart(a," ");t.subarray(1).forEach((s,i)=>{c+=String.fromCharCode(Math.max(32,s))}),c=c.padEnd(16," "),console.debug(`GS patch name: ${c}`)}else a<48||(a<65?t.subarray(1).forEach((c,s)=>{let i=`GS ${a+s>55?"chorus":"reverb"} `;([()=>{console.info(`${i}type: ${j[c]}`),e.setEffectType(0,40,c),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${i}predelay: ${c}ms`)},()=>{console.info(`${i}type: ${de[c]}`),e.setEffectType(1,40,16+c),e.dispatchEvent("efxchorus",e.getEffectType(1))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${i}to reverb: ${P(c)}`)},()=>{console.debug(`${i}to delay: ${P(c)}`)}][a+s-48]||(()=>{}))()}):a<80?console.debug(`Unknown GS patch address: ${a}`):a<91?t.subarray(1).forEach((c,s)=>{let i="GS delay ";([()=>{console.info(`${i}type: ${fe[c]}`),e.setEffectType(2,40,32+c),e.dispatchEvent("efxdelay",e.getEffectType(2))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${i}to reverb: ${P(c)}`)}][a+s-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${a}`))}).add([66,18,64,2],(t,n,d)=>{let a="GS EQ ";t.subarray(1).forEach((c,s)=>{([()=>{console.debug(`${a}low freq: ${[200,400][c]}Hz`)},()=>{console.debug(`${a}low gain: ${c-64}dB`)},()=>{console.debug(`${a}high freq: ${[3e3,6e3][c]}Hz`)},()=>{console.debug(`${a}high gain: ${c-64}dB`)}][t[0]+s]||function(){console.warn(`Unknown GS EQ address: ${t[0]+s}`)})()})}).add([66,18,64,3],(t,n,d)=>{e.dispatchEvent("mupromptex");let a="GS EFX ",c=function(s,i){let h=ue(e.#w.subarray(10,12),i,s);h&&console.debug(`${a}${J(e.#w.subarray(10,12))} ${h}`)};t.subarray(1).forEach((s,i)=>{([()=>{e.setEffectTypeRaw(3,!1,32+s),e.dispatchEvent("efxinsert0",e.getEffectType(3))},()=>{e.setEffectTypeRaw(3,!0,s),console.info(`${a}type: ${J(e.#w.subarray(10,12))}`),e.dispatchEvent("efxinsert0",e.getEffectType(3))},!1,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,()=>{console.debug(`${a}to reverb: ${P(s)}dB`)},()=>{console.debug(`${a}to chorus: ${P(s)}dB`)},()=>{console.debug(`${a}to delay: ${P(s)}dB`)},!1,()=>{console.debug(`${a}1 source: ${s}`),s&&s<96&&e.allocateAceAll(s)},()=>{console.debug(`${a}1 depth: ${s-64}`)},()=>{console.debug(`${a}2 source: ${s}`),s&&s<96&&e.allocateAceAll(s)},()=>{console.debug(`${a}2 depth: ${s-64}`)},()=>{console.debug(`${a}to EQ: ${s?"ON":"OFF"}`)}][t[0]+i]||function(h,o){console.warn(`Unknown GS EFX address: ${o}`)})(s,t[0]+i)})}).add([66,18,65],(t,n,d)=>{E((t[0]>>4)+1<<1,t[0]&15,t.subarray(1))}).add([69,18,16],(t,n,d)=>{switch(t[0]){case 0:{let a=t[1];e.setLetterDisplay(t.subarray(2),"GS display text",a);break}case 8:{let a=t[1],c=e.modelEx.sc;t.subarray(2).forEach((s,i)=>{([()=>{c.showBar=!(s&1),c.invBar=s>>1&1,c.invDisp=s>>2&1},()=>{c.peakHold=s<4?s:1}][i+a]||(()=>{console.debug("Unsupported GS display type SysEx.")}))()});break}case 32:{e.#M=Date.now()+3200,t[1]==0&&(t[2]?(e.#g=Math.max(Math.min(t[2]-1,9),0),w()&&console.debug(`GS switch display page ${t[2]-1}.`)):(e.#g=0,e.#M=Date.now(),w()&&console.debug("GS disable display page.")));break}default:if(t[0]<6){e.#g>9&&(e.#g=0);let a=t[0]-1<<1|t[1]>>6;e.#g==a&&(e.#M=Date.now()+3200),e.#H[a]?.length||(e.#H[a]=new Uint8Array(256));let c=e.#H[a];w()&&console.debug(`GS frame draw page ${a}.`);let s=t[1]&63;c.fill(0),t.subarray(2).forEach(function(h,o){let b=o+s,y=Math.floor(b/16),C=b%16,k=(C*4+y)*5,T=5,A=0;for(k-=C*4,y==3&&(T=1);A<T;)c[k+A]=h>>4-A&1,A++})}else console.warn(`Unknown GS display section: ${t[0]}`)}}).add([69,18,32],(t,n,d)=>{let a=t[0],c=t[1],s=t.subarray(2);if(a>>4){console.warn(`SC-8850 partial screen dump out of bounds: invalid bundle.
`,t);return}let i=c+s.length,h=c*6-(c*2428>>16<<1),o=i*6-(i*2428>>16<<1);if(h>640){console.warn(`SC-8850 partial screen dump out of bounds: invalid buffer range.
`,t);return}o>640&&(console.info(`SC-8850 partial screen dump out of bounds: invalid buffer end, automatically restricted.
`,t),o=640);let b=new Uint8Array(o-h);s.forEach((k,T)=>{let A=T+c,K=(A*2428&65535)*27>>16==26,M=A*6-(A*2428>>16<<1),N=K?2:0;for(;N<6;)b[M+(5-N)]=k>>N&1,N++});let y=a*108+c,C=y*6-(y*2428>>16<<1);e.dispatchEvent("screen",{type:"sc8850",offset:C,data:b}),w()&&console.debug(`SC-8850 screen dump: bundle ${a+1}, range ${h}~${o}`)});let m=function(t,n,d){e.dispatchEvent("mupromptex");let a=t[0],c=x[n],s=z[n],i=`GS CH${n+1} `;a<3?(t.subarray(1).forEach((h,o)=>{[()=>{e.#e[c+g[0]]=h,e.pushChPrimitives(n)},()=>{e.#s[n]=h},()=>{let b=0;h<16?b=e.chRedir(h,d,!0):b=p.ch,e.#f[n]=b,n!=b&&(e.buildRchTree(),console.info(`${i}receives from CH${b+1}`))}][a+o]()}),e.dispatchEvent("voice",{part:n})):a<19||(a<44?t.subarray(1).forEach((h,o)=>{([()=>{e.#v[n]=+!h},!1,()=>{e.setChType(n,h<<1,$.gs),console.debug(`${i}type: ${h?"drum ":"melodic"}${h||""}`)},()=>{e.#a[s+3]=h,e.#c[p.rpnt*n+2]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},!1,()=>{e.#e[c+g[7]]=h},!1,!1,()=>{e.#e[c+g[10]]=h||128},!1,!1,()=>{console.debug(`${i}CC 1: cc${h}`)},()=>{console.debug(`${i}CC 2: cc${h}`)},()=>{e.#e[c+g[93]]=h},()=>{e.#e[c+g[91]]=h},!1,!1,()=>{e.#a[s+1]=h,e.#c[p.rpnt*n+1]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{e.#a[s+2]=h,e.#c[p.rpnt*n+1]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{e.#e[c+g[94]]=h}][a+o-19]||(()=>{}))()}):a<76||console.debug(`Unknown GS part address: ${a}`))},v=function(t,n){let d=t[0],a=`GS CH${n+1} `;d<2?t.subarray(1).forEach((c,s)=>{[()=>{e.setChCc(n,32,c)},()=>{}][d+s]()}):d<32?console.warn(`Unknown GS misc address: ${d}`):d<35?t.subarray(1).forEach((c,s)=>{[()=>{console.debug(`${a}EQ: o${["ff","n"][c]}`)},()=>{},()=>{console.debug(`${a}EFX: o${["ff","n"][c]}`),e.#re[n]=c,e.dispatchEvent("partefxtoggle",{part:n,active:c})}][d+s-32]()}):console.warn(`Unknown GS misc address: ${d}`)};this.#T.add([66,18,64,16],(t,n)=>{m(t,e.chRedir(9,n,!0),n)}).add([66,18,64,17],(t,n)=>{m(t,e.chRedir(0,n,!0),n)}).add([66,18,64,18],(t,n)=>{m(t,e.chRedir(1,n,!0),n)}).add([66,18,64,19],(t,n)=>{m(t,e.chRedir(2,n,!0),n)}).add([66,18,64,20],(t,n)=>{m(t,e.chRedir(3,n,!0),n)}).add([66,18,64,21],(t,n)=>{m(t,e.chRedir(4,n,!0),n)}).add([66,18,64,22],(t,n)=>{m(t,e.chRedir(5,n,!0),n)}).add([66,18,64,23],(t,n)=>{m(t,e.chRedir(6,n,!0),n)}).add([66,18,64,24],(t,n)=>{m(t,e.chRedir(7,n,!0),n)}).add([66,18,64,25],(t,n)=>{m(t,e.chRedir(8,n,!0),n)}).add([66,18,64,26],(t,n)=>{m(t,e.chRedir(10,n,!0),n)}).add([66,18,64,27],(t,n)=>{m(t,e.chRedir(11,n,!0),n)}).add([66,18,64,28],(t,n)=>{m(t,e.chRedir(12,n,!0),n)}).add([66,18,64,29],(t,n)=>{m(t,e.chRedir(13,n,!0),n)}).add([66,18,64,30],(t,n)=>{m(t,e.chRedir(14,n,!0),n)}).add([66,18,64,31],(t,n)=>{m(t,e.chRedir(15,n,!0),n)}).add([66,18,64,64],(t,n)=>{v(t,e.chRedir(9,n,!0))}).add([66,18,64,65],(t,n)=>{v(t,e.chRedir(0,n,!0))}).add([66,18,64,66],(t,n)=>{v(t,e.chRedir(1,n,!0))}).add([66,18,64,67],(t,n)=>{v(t,e.chRedir(2,n,!0))}).add([66,18,64,68],(t,n)=>{v(t,e.chRedir(3,n,!0))}).add([66,18,64,69],(t,n)=>{v(t,e.chRedir(4,n,!0))}).add([66,18,64,70],(t,n)=>{v(t,e.chRedir(5,n,!0))}).add([66,18,64,71],(t,n)=>{v(t,e.chRedir(6,n,!0))}).add([66,18,64,72],(t,n)=>{v(t,e.chRedir(7,n,!0))}).add([66,18,64,73],(t,n)=>{v(t,e.chRedir(8,n,!0))}).add([66,18,64,74],(t,n)=>{v(t,e.chRedir(10,n,!0))}).add([66,18,64,75],(t,n)=>{v(t,e.chRedir(11,n,!0))}).add([66,18,64,76],(t,n)=>{v(t,e.chRedir(12,n,!0))}).add([66,18,64,77],(t,n)=>{v(t,e.chRedir(13,n,!0))}).add([66,18,64,78],(t,n)=>{v(t,e.chRedir(14,n,!0))}).add([66,18,64,79],(t,n)=>{v(t,e.chRedir(15,n,!0))}),this.#U.add([54,65],(t,n)=>{let d=e.#i.x5=="81"?"05rw":"x5d";e.switchMode(d,!0),e.setPortMode(e.getTrackPort(n),1,$[d]);let a=t[t.length-1],c=t.subarray(0,t.length-1),s=U(c);s!=a&&(console.info(`X5D multi parameters checksum mismatch! Expected ${s}, got ${a}.`),console.debug(t));let i=(t[1]<<7)+t[0],h=(t[3]<<7)+t[2],o=e.chRedir(i&15,n,!0),b=x[o];[()=>{h<1||(h<101?(e.setChType(o,e.CH_MELODIC,$.x5d),e.#s[o]=h-1,e.#e[b+g[0]]=e.#i.x5):h<229?(e.setChType(o,e.CH_MELODIC,$.x5d),e.#s[o]=h-101,e.#e[b+g[0]]=56):(e.setChType(o,e.CH_DRUMS,$.x5d),e.#s[o]=$e[h-229]||0,e.#e[b+g[0]]=62)),e.pushChPrimitives(o),e.dispatchEvent("voice",{part:o})},()=>{e.#e[b+g[7]]=h},()=>{h<31&&(e.#e[b+g[10]]=Math.round((h-15)*4.2+64))},()=>{e.#e[b+g[93]]=V(h)},()=>{e.#e[b+g[91]]=V(h)},()=>{e.#a[o*p.rpn+3]=h>8191?h-16320:64+h,e.#c[p.rpnt*o+2]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)})},()=>{e.#a[o*p.rpn+1]=h>8191?h-16320:64+h,e.#c[p.rpnt*o+1]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)})},()=>{h>0&&(e.#a[o*p.rpn]=h,e.#c[p.rpnt*o]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)}))},()=>{}][i>>4]()}).add([54,76,0],(t,n)=>{e.dispatchEvent("mupromptex");let d=e.#i.x5=="81"?"05rw":"x5d";e.switchMode(d),e.setPortMode(e.getTrackPort(n),1,$[d]);let a="",c=e.#i.x5,s=0,i=0,h="MSB	PRG	LSB	NME";D(t,function(o,b){if(b<16400){let y=b%164;switch(!0){case y<10:{o>31&&(a+=String.fromCharCode(o));break}case y==10:break;case y==11:{h+=`
${c}	${s}	${i}	${a.trim().replace("Init Voice","")}`,s++,a="";break}}s>99&&(c=90,s=0)}}),e.userBank.clearRange({msb:e.#i.x5,prg:[0,99],lsb:0}),e.userBank.load(h),w()&&console.debug(h),e.forceVoiceRefresh()}).add([54,77,0],(t,n)=>{e.dispatchEvent("mupromptex");let d=e.#i.x5=="81"?"05rw":"x5d";e.switchMode(d),e.setPortMode(e.getTrackPort(n),1,$[d]);let a="",c=90,s=0,i=0,h="MSB	PRG	LSB	NME";D(t,function(o,b){if(b<13600){let y=b%136;switch(!0){case y<10:{o>31&&(a+=String.fromCharCode(o));break}case y==11:{h+=`
${c}	${s}	${i}	${a.trim().replace("Init Combi","")}`,s++,a="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(h),w()&&console.debug(h),e.forceVoiceRefresh()}).add([54,78],(t,n)=>{let d=e.#i.x5=="81"?"05rw":"x5d";e.switchMode(d),e.setPortMode(e.getTrackPort(n),1,$[d]),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][t[0]]} mode.`)}).add([54,85],(t,n)=>{e.dispatchEvent("mupromptex");let d=e.#i.x5=="81"?"05rw":"x5d";e.switchMode(d),e.setPortMode(e.getTrackPort(n),1,$[d]),D(t,(a,c)=>{c>0&&c<3&&(e.setEffectType(c-1,44,a),e.dispatchEvent(`efx${["reverb","chorus"][c-1]}`,e.getEffectType(c-1)))})}).add([54,104],(t,n)=>{e.dispatchEvent("mupromptex");let d=e.#i.x5=="81"?"05rw":"x5d";e.switchMode(d,!0);let a=e.getTrackPort(n);if(e.#l[a]&&e.#l[a]!=$[d])if(e.#A.dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${n}. Port ${String.fromCharCode(65+a)} mode "${S[e.#l[a]]}" mismatch, should be "${d}".`);return}else console.info(`Track ${n} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+a)}.`);e.setPortMode(a,1,$[d]),D(t,function(c,s,i,h){if(s<192){let o=e.chRedir(Math.floor(s/12),n,!0),b=x[o];switch(s%12){case 0:{c<128?(e.setChType(o,e.CH_MELODIC,$.x5d),e.#e[b+g[0]]=e.#i.x5,e.#s[o]=c):(e.setChType(o,e.CH_DRUMS,$.x5d),e.#e[b+g[0]]=62,e.#s[o]=$e[c-128]),c>0&&e.setChActive(o,1),e.pushChPrimitives(o),e.dispatchEvent("voice",{part:o});break}case 1:{e.#e[b+g[7]]=c;break}case 2:{e.#a[o*p.rpn+3]=c>127?c-192:64+c,e.#c[p.rpnt*o+2]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)});break}case 3:{e.#a[o*p.rpn+1]=c>127?c-192:64+c,e.#c[p.rpnt*o+1]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)});break}case 4:{c<31&&(e.#e[b+g[10]]=Math.round((c-15)*4.2+64));break}case 5:{let y=c>>4,C=c&15;e.#e[b+g[91]]=V(C),e.#e[b+g[93]]=V(y);break}case 10:{e.#r[o]||(e.#e[b+g[0]]=c>>6?56:e.#i.x5,e.pushChPrimitives(o),e.dispatchEvent("voice",{part:o}));break}case 11:{let y=e.chRedir(c&15,n,!0),C=c>>4;e.#f[o]=c,(y!=o||C)&&(console.info(`X5D Part CH${o+1} receives from CH${y+1}.`),e.buildRchTree())}}}else{let o=e.chRedir(s-192,n,!0)}})}),this.#T.add([22,18,127],(t,n,d)=>{e.switchMode("mt32",!0),e.setPortMode(e.getTrackPort(n),1,$.mt32),e.#o=!1,e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(t,n,d)=>{e.switchMode("mt32");let a=e.chRedir(d,n,!0),c=t[1];t.subarray(2).forEach((s,i)=>{let h=i+c;e.#I[h+(a-1)*16]=s,([!1,()=>{let o=e.#I[a-1<<4];if(o<3){if(e.#R[a]=1,o==2)for(let b=0;b<name.length;b++)e.#D[(a-1)*p.cmt+b]=e.#G[s*p.cmt+b];else{let b=e.baseBank.get(0,s+(o<<6),127,"mt32").name;for(let y=0;y<b.length;y++)e.#D[(a-1)*p.cmt+y]=b.charCodeAt(y)}e.dispatchEvent("voice",{part:a})}},()=>{e.#a[a*p.rpn+3]=s+40,e.#c[p.rpnt*a+2]=1},()=>{e.#a[a*p.rpn+1]=s+14,e.#c[p.rpnt*a+1]=1},()=>{e.#a[a*p.rpn]=s,e.#c[p.rpnt*a]=1},!1,()=>{e.setChCc(a,91,s?127:0)},!1,()=>{e.setChCc(a,7,s)},()=>{e.setChCc(a,10,Math.ceil(s*9.05))}][h]||(()=>{}))()})}).add([22,18,1],(t,n,d)=>{e.switchMode("mt32");let a=d&7;console.debug(`MT-32 slot #${d+1} Drum: ${t}`);let c=t[0]<<7|t[1];t.subarray(2).forEach((s,i)=>{let h=i+c,o=(h>>2)+24,b=h&3,y=a*p.dpn;if(w()&&console.debug(`MT-32 temp drum note ${o} param ${b}: ${s}`),o<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${o}`);return}[()=>{},()=>{e.#m[(y+O[26])*p.dnc+o]=Math.round(s*1.27)},()=>{e.#m[(y+O[26])*p.dnc+o]=s*9+1&127},()=>{e.#m[(y+O[26])*p.dnc+o]=s?127:0}][b]()})}).add([22,18,2],(t,n,d)=>{e.switchMode("mt32");let a=e.chRedir(d,n,!0),c=t[1]+(t[0]<<7);c<10&&(e.#R[a]=1),t.subarray(2).forEach((s,i)=>{let h=i+c;h<14&&(e.#D[(a-1)*p.cmt+h]=s)}),e.dispatchEvent("voice",{part:a})}).add([22,18,3],(t,n,d)=>{e.switchMode("mt32");let a=d&7;if(t[0]){let c=(t[0]-1<<7)+t[1]-16;t.subarray(2).forEach((s,i)=>{let h=i+c,o=(h>>2)+24,b=h&3,y=a*p.dpn;if(w()&&console.debug(`MT-32 dev drum note ${o} param ${b}: ${s}`),o<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${o}`);return}[()=>{},()=>{e.#m[(y+O[26])*p.dnc+o]=Math.round(s*1.27)},()=>{e.#m[(y+O[26])*p.dnc+o]=s*9+1&127},()=>{e.#m[(y+O[26])*p.dnc+o]=s?127:0}][b]()})}else{let c=t[1];t.subarray(2).forEach((s,i)=>{let h=i+c;e.#I[h]=s;let o=e.chRedir(1+(h>>4),n,!0),b=h&15;([!1,()=>{let y=e.#I[o-1<<4];if(y<3)if(e.#R[o]=1,y==2)for(let C=0;C<name.length;C++)e.#D[(o-1)*p.cmt+C]=e.#G[s*p.cmt+C];else{let C=e.baseBank.get(0,s+(y<<6),127,"mt32").name;for(let k=0;k<C.length;k++)e.#D[(o-1)*p.cmt+k]=C.charCodeAt(k)}e.dispatchEvent("voice",{part:o})},()=>{e.#a[o*p.rpn+3]=s+40,e.#c[p.rpnt*o+2]=1},()=>{e.#a[o*p.rpn+1]=s+14,e.#c[p.rpnt*o+1]=1},()=>{e.#a[o*p.rpn]=s,e.#c[p.rpnt*o]=1},!1,()=>{e.setChCc(o,91,s?127:0)},!1,()=>{e.setChCc(o,7,s)},()=>{e.setChCc(o,10,Math.ceil(s*9.05))}][b]||(()=>{}))()})}}).add([22,18,4],(t,n,d)=>{e.switchMode("mt32");let a=t[1]+(t[0]<<7),c=[];t.subarray(2).forEach((s,i)=>{let h=i+a,o=e.chRedir(Math.floor(h/246+1),n,!0),b=h%246;b<14&&(e.#D[(o-1)*p.cmt+b]=s),b<10&&(e.#R[o]=1),c.indexOf(o)<0&&c.push(o)}),c.forEach(s=>{e.dispatchEvent("voice",{part:s})})}).add([22,18,5],(t,n,d)=>{e.switchMode("mt32");let a=(t[0]<<7)+t[1];t.subarray(2).forEach((c,s)=>{let i=a+s,h=Math.floor(i/8),o=i&7,b=h*8;e.#ae[i]=c,([!1,()=>{let y=e.#ae[b];if(y<3){let C="";if(y==2){let T=p.cmt*h;C=`MT-m:${c.toString().padStart(3,"0")}`}else C=e.baseBank.get(0,c+(y<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:h});let k=`MSB	LSB	PRG	NME
49	127	${h}	${C}`;e.userBank.load(k,!0)}}][o]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(t,n,d)=>{e.switchMode("mt32");let a=((t[0]&1)<<7)+t[1],c=t[0]>>1,s=!1;if(t.subarray(2).forEach((i,h)=>{let o=a+h;o<p.cmt&&(e.#G[c*p.cmt+o]=i,s=!0)}),s){e.userBank.clearRange({msb:0,lsb:127,prg:c});let i=`MSB	LSB	PRG	NME
49	127	${c}	MT-m:${c}`;e.userBank.load(i,!0)}e.forceVoiceRefresh()}).add([22,18,16],(t,n,d)=>{e.switchMode("mt32");let a=t[1],c=!1,s=function(i,h){e.#f[h-12]=i,c=!0};t.subarray(2).forEach((i,h)=>{let o=h+a;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,s,s,s,s,s,s,s,s,s,()=>{e.#n=i,e.dispatchEvent("mastervolume",e.#n)}][o]||(()=>{}))(i,h)}),c&&e.buildRchTree()}).add([22,18,32],(t,n,d)=>{e.switchMode("mt32");let a=t[1],c=" ".repeat(a);t.subarray(2).forEach(s=>{s>31?c+=String.fromCharCode(s):c+=" "}),e.#_=c.padStart(20," "),e.#X=Date.now()+3200}).add([22,18,82],(t,n)=>{let d=e.chRedir(0,n,!0);for(let a=0;a<16;a++)e.#d.ano(d+a),a&&a<10&&(e.#s[d+a]=Z[a-1]);console.info("MT-32 alt reset complete.")}),this.#U.add([66,0],(t,n)=>{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(n),2,$.ns5r),e.#o=!1,console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][t[0]]} mode.`)}).add([66,1],(t,n)=>{let d=["ns5r","05rw"][t[0]];e.switchMode(d,!0),e.setPortMode(e.getTrackPort(n),2,$[d]),e.#o=!1}).add([66,18,0,0],(t,n)=>{let d=t[0];switch(d){case 124:case 126:case 127:{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(n),2,$.ns5r),e.#o=!1;break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset: ${t}`);break}default:if(d<10){let a=[0,0,0,0],c=(s,i)=>{a[i]=s};if(t.subarray(1).forEach((s,i)=>{[c,c,c,c,()=>{e.#n=s*129/16383*100,e.dispatchEvent("mastervolume",e.#n)},()=>s-64,()=>s-64,()=>{},()=>{},()=>{}][d+i]()}),t[0]<4){let s=0;a.forEach(i=>{s=s<<4,s+=i}),s-=1024}}}}).add([66,18,0,1],(t,n)=>{}).add([66,18,0,2],(t,n)=>{}).add([66,18,1],(t,n)=>{e.dispatchEvent("mupromptex");let d=e.chRedir(t[0],n,!0),a=x[d],c=t[1],s=`NS5R CH${d+1} `;t.subarray(2).forEach((i,h)=>{let o=c+h;o<3?([()=>{e.#e[a+g[0]]=i||F.bank0,e.pushChPrimitives(d)},()=>{e.#e[a+g[32]]=i,e.pushChPrimitives(d)},()=>{e.#s[d]=i}][o](),e.dispatchEvent("voice",{part:d})):o<8||(o<14?[()=>{let b=e.chRedir(i,n,!0);e.#f[d]=b,d!=b&&(e.buildRchTree(),console.info(`${s}receives from CH${b+1}`))},()=>{e.#v[d]=+!i},()=>{e.setChType(d,i,$.ns5r),console.debug(`${s}type: ${X[i]}`)},()=>{e.#a[p.rpn*d+3]=i,e.#c[p.rpnt*d+2]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)})},()=>{},()=>{}][o-8]():o<16||(o<33?[()=>{e.#e[a+g[7]]=i},()=>{e.#e[a+g[11]]=i},()=>{},()=>{},()=>{e.#e[a+g[10]]=i||128},()=>{},()=>{},()=>{e.#e[a+g[93]]=i},()=>{e.#e[a+g[91]]=i},()=>{e.#e[a+g[76]]=i},()=>{e.#e[a+g[77]]=i},()=>{e.#e[a+g[78]]=i},()=>{e.#e[a+g[74]]=i},()=>{e.#e[a+g[71]]=i},()=>{e.#e[a+g[73]]=i},()=>{e.#e[a+g[75]]=i},()=>{e.#e[a+g[72]]=i}][o-16]():o<112||o<114&&[()=>{e.#e[a+g[5]]=i},()=>{e.#e[a+g[65]]=i}][o-112]()))})}).add([66,18,8,0],(t,n)=>{let d=t[0];if(d<32)e.setLetterDisplay(t.subarray(1,33),"NS5R letter display");else{let a=d-32;e.#M=Date.now()+3200,e.#g=10,e.#$.fill(0);let c=t.subarray(1),s=4;c.forEach(function(i,h){let o=h+a,b=o>>4,y=o&15;if(o<80){let C=b<s?i:i>>3,k=0,T=b<s?6:3;for(;C>0;)e.#$[y*32+b*7+(T-k)]=C&1,C=C>>1,k++}})}}).add([66,18,48],(t,n,d)=>{u(0,t)}).add([66,18,49],(t,n,d)=>{u(1,t)}).add([66,18,50],(t,n,d)=>{u(2,t)}).add([66,18,51],(t,n,d)=>{u(3,t)}).add([66,18,52],(t,n,d)=>{u(4,t)}).add([66,18,53],(t,n,d)=>{u(5,t)}).add([66,18,54],(t,n,d)=>{u(6,t)}).add([66,18,55],(t,n,d)=>{u(7,t)}).add([66,52],(t,n)=>{e.switchMode("ns5r"),e.#o=!1;let d="";D(t,(a,c)=>{c<8?(a>31&&(d+=String.fromCharCode(a)),c==7&&(e.aiEfxName=d)):c<10&&(e.setEffectType(c-8,44,a),e.dispatchEvent(`efx${["reverb","chorus"][c-8]}`,e.getEffectType(c-8)))})}).add([66,53],(t,n)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r"),e.#o=!1;let d="",a=t[t.length-1],c=t.subarray(0,t.length-1),s=U(c);s!=a&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${s}, got ${a}.`),console.debug(t));let i=e.getTrackPort(n);if(e.#l[i]&&e.#l[i]!=$.ns5r)if(e.#A.dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${n}. Port ${String.fromCharCode(65+i)} mode "${S[e.#l[i]]}" mismatch, should be "ns5r".`);return}else console.info(`Track ${n} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);e.setPortMode(i,2,$.ns5r),D(c,function(h,o){switch(!0){case o<2944:{let b=e.chRedir(Math.floor(o/92),n,!0),y=x[b];switch(o%92){case 0:{e.#e[y+g[0]]=h,e.pushChPrimitives(b),e.dispatchEvent("voice",{part:b});break}case 1:{e.#e[y+g[32]]=h,!h&&!e.#e[y+g[0]]&&(e.#e[y+g[0]]=F.bank0),e.pushChPrimitives(b),e.dispatchEvent("voice",{part:b});break}case 2:{e.#s[b]=h,h>0&&e.setChActive(b,1),e.dispatchEvent("voice",{part:b});break}case 3:{let C=e.chRedir(h,n,!0);e.#f[b]=C,b!=C&&(console.info(`NS5R CH${b+1} receives from CH${C+1}.`),e.buildRchTree());break}case 7:{e.#r[b]=h,e.dispatchEvent("voice",{part:b});break}case 8:{e.#a[b*p.rpn+3]=h<40||h>88?h+(h>63?-192:64):h,e.#c[p.rpnt*b+2]=1,e.dispatchEvent("pitch",{part:b,pitch:e.getPitchShift(b)});break}case 9:case 10:{e.#e[y+g[7]]=h;break}case 11:{e.#e[y+g[11]]=h;break}case 14:{e.#e[y+g[10]]=h||128;break}case 19:{e.#e[y+g[93]]=h;break}case 20:{e.#e[y+g[91]]=h;break}case 84:{e.#e[y+g[65]]=h;break}case 85:{e.#e[y+g[5]]=h;break}}break}case o<3096:break;case o<3134:{let b=o-3096;b<8?(h>31&&(d+=String.fromCharCode(h)),b==7&&(e.aiEfxName=d)):b<10&&(e.setEffectType(b-8,44,h),e.dispatchEvent(`efx${["reverb","chorus"][b-8]}`,e.getEffectType(b-8)));break}case o<8566:break}})}).add([66,54],(t,n)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r");let d="",a=80,c=0,s=0,i="MSB	PRG	LSB	NME";D(t,function(h,o){let b=o%158;switch(!0){case b<10:{h>31&&(d+=String.fromCharCode(h));break}case b==10:break;case b==11:{a=h&127;break}case b==12:{s=h&127;break}case b==13:{i+=`
${a}	${c}	${s}	${d.trim().replace("Init Voice","")}`,c++,d="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(i),w()&&console.debug(i),e.forceVoiceRefresh()}).add([66,55],(t,n)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r");let d="",a=88,c=0,s=0,i="MSB	PRG	LSB	NME";D(t,function(h,o){let b=o%126;switch(!0){case b<10:{h>31&&(d+=String.fromCharCode(h));break}case b==11:break;case b==12:break;case b==13:{i+=`
${a}	${c}	${s}	${d.trim().replace("Init Combi","")}`,c++,d="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(i),w()&&console.debug(i),e.forceVoiceRefresh()}).add([66,125],(t,n,d)=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][t[0]]||"white")}).add([66,127],(t,n,d)=>{let a=t[t.length-1],c=t.subarray(0,t.length-1),s=U(c);s!=a&&(console.info(`NS5R screen dump checksum mismatch! Expected ${s}, got ${a}.`),console.debug(t));let i=new Uint8Array(5760);D(t,(h,o,b)=>{if(o<720)for(let y=0;y<8;y++)i[o*8+y]=h>>7-y&1}),e.dispatchEvent("screen",{type:"ns5r",data:i})}).add([76],(t,n,d)=>{e.#U.run([66,...t],n,d)}),this.#J.add([16,0,8,0],(t,n,d)=>{let a=(t[2]<<4)+t[3],c="K11 ";([()=>{e.switchMode("k11",!0),e.setPortMode(e.getTrackPort(n),2,$.k11),e.#o=!1,e.#h[$.k11][1]=a?4:0,console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,a),console.debug(`${c}reverb type: ${a}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{console.debug(`${c}reverb time: ${a}`)},()=>{console.debug(`${c}reverb time: ${a}`)},()=>{console.debug(`${c}reverb predelay: ${a}`)},()=>{console.debug(`${c}reverb predelay: ${a}`)},()=>{console.debug(`${c}depth high: ${a}`)},()=>{console.debug(`${c}depth high: ${a}`)},()=>{console.debug(`${c}depth low: ${a}`)},()=>{console.debug(`${c}depth low: ${a}`)}][t[0]]||(()=>{}))()}).add([16,0,8,1],(t,n,d)=>{e.dispatchEvent("mupromptex");let a=e.chRedir(t[1],n,!0),c=x[a],s=z[a],i=(t[3]<<4)+t[4],h=`K11 CH${a+1} `;([()=>{i<128?(e.setChType(a,e.CH_MELODIC,$.k11),e.#e[c+g[0]]=0,e.#s[a]=i):(e.setChType(a,e.CH_DRUMS,$.k11),e.#s[a]=i-128),e.pushChPrimitives(a),e.dispatchEvent("voice",{part:a})},()=>{let o=e.chRedir(i,n,!0);e.#f[a]=o,a!=o&&(e.buildRchTree(),console.info(`${h}receives from CH${o+1}`))},()=>{e.#e[c+g[7]]=i},()=>{uupThis.setChActive(a,i)},()=>{e.#e[c+g[10]]=i},()=>{e.#a[s+3]=i+40,e.#c[p.rpnt*a+2]=1,e.dispatchEvent("pitch",{part:a,pitch:e.getPitchShift(a)})},()=>{e.#a[s+1]=i>>1,e.#a[s+2]=i&1,e.#c[p.rpnt*a+1]=1,e.dispatchEvent("pitch",{part:a,pitch:e.getPitchShift(a)})},()=>{e.#e[c+g[91]]=i?127:0},()=>{},()=>{e.#e[c+g[74]]=i},()=>{e.#e[c+g[73]]=i},()=>{e.#e[c+g[72]]=i}][t[0]]||(()=>{}))()}).add([16,0,9,0],(t,n,d)=>{e.dispatchEvent("mupromptex");let a=(t[2]<<4)+t[3],c="GMLX ";([()=>{console.debug(`${c}reverb type: ${a}`)},()=>{console.debug(`${c}reverb time: ${a}`)},()=>{console.debug(`${c}reverb predelay: ${a}`)},()=>{console.debug(`${c}depth high: ${a}`)},()=>{console.debug(`${c}depth low: ${a}`)}][t[0]]||(()=>{}))()}).add([16,0,9,3],(t,n,d)=>{e.dispatchEvent("mupromptex");let a=(t[2]<<4)+t[3],c=e.chRedir(t[1],n,!0),s=x[c];[()=>{a<128?(e.setChType(c,e.CH_MELODIC,$.k11),e.#e[s+g[0]]=0,e.#e[s+g[32]]=0,e.#s[c]=a):a<160?(e.setChType(c,e.CH_MELODIC,$.k11),e.#e[s+g[0]]=0,e.#e[s+g[32]]=7,e.#s[c]=a-100):(e.setChType(c,e.CH_DRUMS,$.k11),e.#e[s+g[0]]=122,e.#e[s+g[32]]=0,e.#s[c]=a-160),e.pushChPrimitives(c),e.dispatchEvent("voice",{part:c})},()=>{let i=e.chRedir(a,n,!0);e.#f[c]=i,c!=i&&(e.buildRchTree(),console.info(`GMLX CH${c+1} receives from CH${i+1}`))}][t[0]]()}).add([16,0,9,4],(t,n,d)=>{e.dispatchEvent("mupromptex");let a=(t[2]<<4)+t[3],c=e.chRedir(t[1],n,!0),s=x[c],i=z[c],h=`GMLX CH${c+1} `;[()=>{e.setChActive(c,a)},()=>{e.#e[s+g[7]]=a},()=>{e.#e[s+g[10]]=a},()=>{e.#e[s+g[91]]=a?127:0},()=>{e.#a[i+3]=a+40,e.#c[p.rpnt*c+2]=1,e.dispatchEvent("pitch",{part:c,pitch:e.getPitchShift(c)})},()=>{e.#a[i+1]=a,e.#c[p.rpnt*c+1]=1,e.dispatchEvent("pitch",{part:c,pitch:e.getPitchShift(c)})},()=>{e.#a[i]=a,e.#c[p.rpnt*c]=1,e.dispatchEvent("pitch",{part:c,pitch:e.getPitchShift(c)})},()=>{}][t[0]]()}),this.#Z.add([66,93,64],(t,n,d)=>{let a=t[2];switch(t[0]){case 0:{switch(t[1]){case 4:{e.dispatchEvent("mupromptex"),e.#n=a*129/16383*100,e.dispatchEvent("mastervolume",e.#n);break}case 5:{e.dispatchEvent("mupromptex"),a-64;break}case 6:{e.dispatchEvent("mupromptex"),console.debug(`SG global reverb: ${a?"on":"off"}`);break}case 127:{e.switchMode("sg",!0),e.setPortMode(e.getTrackPort(n),1,$.sg);break}}break}case 1:{switch(t[1]){case 48:{e.dispatchEvent("mupromptex"),console.debug(`SG reverb type: ${j[a]}`);break}}break}default:if(t[0]>>4==1){e.dispatchEvent("mupromptex");let c=e.chRedir(t[0]&15,n,!0);if(t[1]==2){let s=e.chRedir(a,n,!0);e.#f[c]=s,c!=s&&(e.buildRchTree(),console.info(`SG CH${c+1} receives from CH${s+1}`))}else t[1]==19&&e.setChCc(c,7,a)}else console.warn(`Unknown AKAI SG SysEx: ${t}`)}}),this.#ee.add([9],(t,n,d)=>{e.dispatchEvent("mupromptex"),console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremolo","phaser","rotary speaker","enhancer","flanger","EQ"][t[0]]||"off"}`)}),this.#S.add([127,0],(t,n,d)=>{e.switchMode("motif");let a=new Uint8Array([127,1,...t]);e.#S.run(a,n,d)}).add([127,1,0,0],(t,n,d)=>{e.switchMode("s90es");let a="S90/Motif ES system ",c=t[0];t.subarray(1).forEach((s,i)=>{([()=>{e.#n=s*12900/16383,e.dispatchEvent("mastervolume",e.#n)}][c+i]||(()=>{console.info(`Unrecognized ${a}ID: ${c+i}`)}))()})}).add([127,1,0,36,54,1],(t,n,d)=>{e.switchMode("s90es");let a="S90/Motif ES reverb ",c=t[0];t.subarray(1).forEach((s,i)=>{([()=>{e.setEffectTypeRaw(0,!1,s&15|112)},()=>{e.setEffectTypeRaw(0,!0,s)}][c+i]||(()=>{}))()}),e.dispatchEvent("efxreverb",e.getEffectType(0))}).add([127,1,0,37,54,2],(t,n,d)=>{e.switchMode("s90es");let a="S90/Motif ES chorus ",c=t[0];t.subarray(1).forEach((s,i)=>{([()=>{e.setEffectTypeRaw(1,!1,s&15|112)},()=>{e.setEffectTypeRaw(1,!0,s)}][c+i]||(()=>{}))()}),e.dispatchEvent("efxchorus",e.getEffectType(1))}).add([127,1,0,34,54,3],(t,n,d)=>{e.switchMode("s90es");let a="S90/Motif ES insert 1 ",c=t[0];t.subarray(1).forEach((s,i)=>{([()=>{e.setEffectTypeRaw(3,!1,s&15|112)},()=>{e.setEffectTypeRaw(3,!0,s)}][c+i]||(()=>{}))()}),e.dispatchEvent("efxinsert0",e.getEffectType(3))}).add([127,1,0,34,54,4],(t,n,d)=>{e.switchMode("s90es");let a="S90/Motif ES insert 2 ",c=t[0];t.subarray(1).forEach((s,i)=>{([()=>{e.setEffectTypeRaw(4,!1,s&15|112)},()=>{e.setEffectTypeRaw(4,!0,s)}][c+i]||(()=>{}))()}),e.dispatchEvent("efxinsert1",e.getEffectType(4))}).add([127,1,0,35,54,17],(t,n,d)=>{e.switchMode("s90es");let a="S90/Motif ES variation ",c=t[0];t.subarray(1).forEach((s,i)=>{([()=>{e.setEffectTypeRaw(2,!1,s&15|112)},()=>{e.setEffectTypeRaw(2,!0,s)}][c+i]||(()=>{}))()}),e.dispatchEvent("efxdelay",e.getEffectType(2))}).add([127,1,0,58,55],(t,n,d)=>{e.dispatchEvent("mupromptex"),e.switchMode("s90es");let a=e.getTrackPort(n);if(e.#l[a]&&e.#l[a]!=e.#i.smotif)if(e.#A.dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${n}. Port ${String.fromCharCode(65+a)} mode "${S[e.#l[a]]}" mismatch, should be "${S[e.#i.smotif]}".`);return}else console.info(`Track ${n} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+a)}.`);let c=e.chRedir(t[0],n,!0),s=x[c],i=t[1];t[0]>15&&(c=t[0]+32);let h=`Track ${n} S90/Motif ES bulk CH${c<128?c+1:"U"+(c-127)} `;console.debug(h,t),!(t[0]>15)&&t.subarray(2).forEach((o,b)=>{([()=>{e.#e[s+g[0]]=o,e.pushChPrimitives(c),e.dispatchEvent("voice",{part:c})},()=>{o&&e.setChActive(c,1),e.#e[s+g[32]]=o,e.getChPrimitive(c,1)==63&&e.setChType(c,[32,40].indexOf(o)>-1?e.CH_DRUMS:e.CH_MELODIC,e.#t,!0),e.pushChPrimitives(c),e.dispatchEvent("voice",{part:c})},()=>{o&&e.setChActive(c,1),e.#s[c]=o,e.dispatchEvent("voice",{part:c})},()=>{let y=e.chRedir(o,n,!0);e.#f[c]=y,c!=y&&(e.buildRchTree(),console.info(`${h}receives from CH${y+1}`))},()=>{e.#v[c]=o?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{o!=100&&e.setChActive(c,1),e.#e[s+g[7]]=o},()=>{o!=64&&e.setChActive(c,1),e.#e[s+g[10]]=o},!1,!1,!1,()=>{e.#e[s+g[91]]=o},()=>{o&&e.setChActive(c,1),e.#e[s+g[93]]=o},()=>{o&&e.setChActive(c,1),e.#e[s+g[94]]=o},()=>{o!=127&&e.setChActive(c,1),e.#e[s+g[128]]=o,e.allocateAce(c,128)},()=>{},()=>{o!=64&&e.setChActive(c,1),e.#e[s+g[74]]=o},()=>{o!=64&&e.setChActive(c,1),e.#e[s+g[71]]=o},!1,()=>{e.#e[s+g[65]]=o},()=>{e.#e[s+g[5]]=o},()=>{}][i+b]||(()=>{}))()})}).add([127,1,54,16],(t,n,d)=>{e.switchMode("s90es");let a=t[0];t.subarray(1).forEach((c,s)=>{let h=`S90/Motif ES EQ${(s>>2)+1} `;([()=>{let o=c-64},()=>{let o=B[c]},()=>{let o=c/10},()=>{let o=c}][a+s&3]||(()=>{}))()})}),this.#T.add([0,72,18,0,0,0,0],(t,n,d)=>{e.switchMode("sd",!0),e.setPortMode(e.getTrackPort(n),2,$.sd),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(t,n,d)=>{e.dispatchEvent("mupromptex");let a=t[0]>>5,c=t[0]&31;switch(a){case 0:{let s=t[0]>>1,i=t[1];switch(s){case 1:{t.subarray(2).forEach((h,o,b)=>{let y=o+i;switch(y){case 0:{h&&(e.setEffectType(1,60,h-1),e.dispatchEvent("efxchorus",e.getEffectType(1)),console.debug(`SD MFX Cho: ${y} - ${h}`));break}}});break}case 2:{t.subarray(2).forEach((h,o)=>{let b=o+i;switch(b){case 0:{h&&(e.setEffectType(0,55+h,0),e.dispatchEvent("efxreverb",e.getEffectType(0)),console.debug(`SD MFX Rev: ${b} - ${h}`));break}}});break}case 3:case 4:case 5:{let h=s-1;t.subarray(2).forEach((o,b)=>{let y=b+i;switch(console.debug(`SD MFX ${h-2}: ${y} - ${o}`),y){case 0:{e.setEffectTypeRaw(h,62,o),e.dispatchEvent(`efx${h>2?"delay":"insert"+(h-4)}`,e.getEffectType(h));break}}}),console.debug(`SD MFX message:
%o`,t);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,t)}break}case 1:{let s=e.chRedir(c,n,!0),i=t[1],h=x[s];t.subarray(2).forEach((o,b)=>{let y=i+b;y<37?([()=>{},()=>{},0,()=>{},()=>{switch(e.#e[h+g[0]]=o,o){case 104:case 105:case 106:case 107:case 120:{e.#r[s]||e.setChType(s,e.CH_DRUMS);break}default:e.#r[s]&&e.setChType(s,e.CH_MELODIC)}e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{e.#e[h+g[32]]=o,e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{e.#s[s]=o,e.dispatchEvent("voice",{part:s})},()=>{e.#e[h+g[7]]=o},()=>{e.#e[h+g[10]]=o},()=>{},()=>{},()=>{o<2&&(e.#v[s]=o)},()=>{o<2&&(e.#e[h+g[68]]=o?127:0)},()=>{},()=>{o<2&&(e.#e[h+g[65]]=o?127:0)},()=>{e.#e[h+g[5]]=o&15<<4|e.#e[h+g[5]]&15},()=>{e.#e[h+g[5]]=o&15|(e.#e[h+g[5]]&240)>>4},()=>{e.#e[h+g[74]]=o},()=>{e.#e[h+g[71]]=o},()=>{e.#e[h+g[73]]=o},()=>{e.#e[h+g[72]]=o},0,0,0,0,0,0,0,()=>{e.#e[h+g[128]]=o,e.allocateAce(128)},()=>{e.#e[h+g[93]]=o},()=>{e.#e[h+g[91]]=o},0,0,()=>{e.#e[h+g[75]]=o},()=>{e.#e[h+g[76]]=o},()=>{e.#e[h+g[77]]=o},()=>{e.#e[h+g[78]]=o}][y]||(()=>{}))():y<63||(y<64?(e.#r[s]?(e.#e[h+g[0]]=104|o,e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})):(e.#e[h+g[0]]=96|o,e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})),e.dispatchEvent("voice",{part:s})):console.debug(`Unknown SD-90 global CH${s+1} param setup message:
%o`,t))});break}case 2:{let s=e.chRedir(c,n,!0),i=t[1];console.debug(`Unknown SD-90 global CH${s+1} MIDI setup message:
%o`,t.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,t)}}),e.#U.add([0,1,73,78],(t,n,d)=>{e.switchMode("krs"),e.setPortMode(e.getTrackPort(n),1,$.krs),console.debug("Might be KORG KROSS 2 mode reset... Not sure.")}).add([0,1,73,117,2,37],(t,n,d)=>{e.switchMode("krs");let a=e.getTrackPort(n);if(e.#l[a]&&e.#l[a]!=$.krs)if(e.#A.dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled. Port ${String.fromCharCode(65+a)} mode "${S[e.#l[a]]}" mismatch, should be "krs".`);return}else console.info(`Track ${n} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+a)}.`);e.setPortMode(e.getTrackPort(n),1,$.krs);let c="KROSS 2 BMT1 ",s="";D(t,(i,h)=>{if(h<24)s+=String.fromCharCode(Math.max(32,i));else if(!(h<1276)){let o=h-1276,b=e.chRedir(Math.floor(o/44),n,!0),y=o%44,C=x[b];y<15?([()=>{i&&e.setChActive(b,1),e.#s[b]=i,e.dispatchEvent("voice",{part:b})},()=>{i&&e.setChActive(b,1),i<10?(e.#e[C+g[0]]=63,e.#e[C+g[32]]=i):i<20?(e.#e[C+g[0]]=121,e.#e[C+g[32]]=i-10):i<24&&(e.#e[C+g[0]]=[120,0,56,62][i-20],e.#e[C+g[32]]=0),e.pushChPrimitives(b),e.dispatchEvent("voice",{part:b})},()=>{let k=e.chRedir(i&15,n,!0);e.#f[b]=k,console.info(`${c}CH${b+1} receives from CH${k+1}`)},!1,!1,()=>{e.#e[C+g[7]]=i},!1,()=>{},()=>{},!1,!1,!1,!1,!1,()=>{e.#e[C+g[10]]=i||128}][y]||(()=>{}))():y<36||([()=>{e.#e[C+g[74]]=(i+128&255)-64},()=>{e.#e[C+g[71]]=(i+128&255)-64},!1,!1,()=>{e.#e[C+g[73]]=(i+128&255)-64},()=>{e.#e[C+g[75]]=(i+128&255)-64},!1,()=>{e.#e[C+g[72]]=(i+128&255)-64}][y]||(()=>{}))()}}),s=s.trimRight(),e.dispatchEvent("metacommit",{type:"EORTitle",data:s})})}};export{dt as OctaviaDevice,p as allocated,g as ccToPos,O as dnToPos,w as getDebugState,F as overrides};
