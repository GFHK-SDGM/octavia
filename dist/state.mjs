var W=function(e,a){let l=Math.min(e.length,a.length),h=e.slice(0,l),g=a.slice(0,l),E=0,$=0;for(;$<l&&E==0;)E=Math.sign(h[$]-g[$]),$++;return E},T=function(e=""){this.name=e,this.pool=[],this.point=function(a,l=!1){if(this.pool.length>0){let h=this.pool.length,g=1<<Math.floor(Math.log2(h)),E=g,$=64;for(;g>=1&&$>=0;){if($<=0)throw new Error("TTL reached.");if(E==h)E-=g;else{let t=W(a,this.pool[E]);switch(t){case 0:{$=0;break}case 1:{E+g<=h&&(E+=g);break}case-1:{E!=0&&(E-=g);break}default:console.warn(`Unexpected result ${t}.`)}}g=g>>1,$--}let v=!0;if(E>=this.pool.length)v=!1;else{let t=this;this.pool[E].forEach(function(r,f,s){v&&r!=a[f]&&(v=!1)}),!v&&W(a,this.pool[E])>0&&E++}return v||l?E:-1}else return l?0:-1},this.add=function(a,l){return a.data=l,this.pool.splice(this.point(a,!0),0,a),this},this.default=function(a){console.warn(`No match in "${this.name||"(unknown)"}" for "${a}". Default action not defined.`)},this.get=function(a){let l=this.point(a);if(l>-1)return this.pool[l].data;this.default(a)},this.run=function(a,...l){let h=this.point(a);h>-1?a.subarray?this.pool[h].data(a.subarray(this.pool[h].length),...l):this.pool[h].data(a.slice(this.pool[h].length),...l):this.default(a,...l)}};var Y=class{#t={};addEventListener(e,a){this.#t[e]||(this.#t[e]=[]),this.#t[e].unshift(a)}removeEventListener(e,a){if(this.#t[e]){let l=this.#t[e].indexOf(a);l>-1&&this.#t[e].splice(l,1),this.#t[e].length<1&&delete this.#t[e]}}dispatchEvent(e,a){let l=new Event(e),h=this;l.data=a,this.#t[e]?.length>0&&this.#t[e].forEach(function(g){try{g?.call(h,l)}catch(E){console.error(E)}}),this[`on${e}`]&&this[`on${e}`](l)}};var Ee=["MSB","PRG","LSB","NME","ELC","DRM"],V=function(e){let a=Math.floor(e/10),l=e%10;return`${a.toString(16)}${l}`},F=class{#t;strictMode=!1;get(e=0,a=0,l=0,h){let g=[e,a,l],E,$=1,v=0,t,r=Array.from(arguments);switch(h){case"xg":{switch(e){case 0:{l==126?r[2]=125:l==127&&(r[2]=0);break}case 16:{l==126&&(r[2]=0);break}case 32:{l>125&&(r[2]=0),r[2]+=4;break}case 33:case 34:case 35:case 36:{l>125&&(r[2]=0),r[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:r[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{l==126&&(r[2]=0);break}case 48:case 64:case 126:case 127:{l==126&&(r[2]=0);break}}break}case"gs":case"sc":{e==0&&l<5?r[2]=0:e>125&&l<5&&l!=2&&(r[2]=e,r[0]=0);break}case"g2":case"sd":{e>>1==40?r[2]|=16:e>95&&e<100&&(r[2]|=16,a>>4==7&&(r[0]=96));break}case"sg":{e==8&&l==0&&(r[2]=5);break}case"s90es":{l<8?r[2]+=17:l<32?r[2]+=13:r[2]=(r[2]>>3)+19;break}case"motif":{l<8?r[2]+=28:l<32?r[2]+=13:r[2]=(r[2]>>3)+19;break}}let f=" ",s="M",i="",n=0,c=0;switch(r[0]){case 0:{switch(r[2]){case 127:{h=="xg"?s="GM-a":(s="MT-a",i="C/M");break}case 126:{h=="xg"?s="GM-n":(s="MT-b",i="C/M");break}case 7:{s="GM-k",i="GLX";break}case 5:{s="SG-a",i="000";break}case 4:{h=="gs"||h=="sc"?(s="GM-a",i="000"):(s="SP-l",i="C/M");break}case 3:case 2:case 1:{(h=="gs"||h=="sc")&&(s="GM-a",i="000");break}case 0:{s="GM-a";break}default:s="y",n=3}break}case 8:{h=="sg"?s="GM-s":s="r:";break}case 32:case 33:case 34:case 35:case 36:{h=="xg"&&(s=`${["AP","VL","PF","DX","AN"][e&7]}-${"abcdefgh"[l]}`,n=3);break}case 48:{i=`M${(r[2]>>3).toString().padStart(2,"0")}`,s=`y${i}`,n=1;break}case 56:{s="GM-b";break}case 57:s=["yDOC","QY10","QY20"][r[2]-112]||"yMxv",i=["DOC","QY1","QY2"][r[2]-112]||"057";case 61:case 120:{s="rDrm";break}case 62:{s="kDrm";break}case 63:{if(r[2]<17){let y=r[2];s=y<10?"kP:":"kC:",s+=y%10}else r[2]<34?s=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][r[2]-17]:s="Ds";n=1;break}case 64:{s="ySFX",i="SFX";break}case 67:{s="DX:S";break}case 80:case 81:case 82:case 83:{s=`Prg${"UABC"[r[0]-80]}`;break}case 88:case 89:case 90:case 91:{s=`Cmb${"UABC"[r[0]-88]}`;break}case 95:{s=`${["DR","PC"][r[2]]}-d`;break}case 96:{s=r[2]==106?"AP-a":r[2]>>4==1?"SDg":"PF",r[2]>63?c=63:r[2]>>4==1&&(c=16),n=3;break}case 97:{s=r[2]>>4==1?"SDa":"VL:",n=3,r[2]>>4==1?c=16:c=112;break}case 98:{s=r[2]>>4==1?"SDb":"SG-a",n=3,c=16;break}case 99:{s=r[2]>>4==1?"SDc":"DX",r[2]>63?c=63:r[2]>>4==1&&(c=16),n=3;break}case 100:{s="AN",r[2]>63?c=63:r[2]>>4==1&&(c=16),n=3;break}case 104:case 105:case 106:case 107:{s="SDd",c=104;break}case 121:{s=`GM-${r[2]?"":"a"}`,n=3;break}case 122:{s="lDrm";break}case 126:{s="yDrS";break}case 127:{r[2]==127?s="rDrm":s="yDrm";break}default:r[0]<48?s="r:":s="M"}s.length<4&&(s+=`${[e,l,r[0],r[2]][n]-c}`.padStart(4-s.length,"0")),i.length<3&&(i+=`${[e,l,e,l][n]}`.padStart(3-i.length,"0")),h=="xg"&&(e==0?r[2]<100?s=s.replace("y0","y:"):r[2]==125&&(s="y126"):e==16?(E=`Voice${((r[2]<<7)+r[1]+1).toString().padStart(3,"0")}`,f=" "):e==35&&l>>1==2&&(E=`DXCH_${(((r[2]&1)<<7)+a+1).toString().padStart(3,"0")}`,f=" "));let d=[r[0],r[1],r[2]];for(;!(E?.length>=0);)if(E=this.#t[r[1]||0][(r[0]<<7)+r[2]]?.name,E){let y=this.#t[r[1]||0][(r[0]<<7)+r[2]];$=y?.poly||$,v=y?.type||v,t=y?.drum}else if(this.strictMode)E="",f="?";else if(r[0]==0&&r[1]==0&&r[2]==0)E="Unloaded";else if(this.#t[r[1]||0][r[0]<<7])r[0]==0?(r[2]=0,f="^"):r[2]<1?(r[0]=0,f="*"):(r[2]--,f="^");else if(e==48)r[0]=0,r[2]=0,f="!";else if(e==62)r[1]--,f=" ",r[1]<1&&!E?.length&&(r[0]=0,f="!");else if(e<63)r[0]==0?(r[2]=0,f="^"):r[2]<1?(r[0]=0,f="*"):r[2]--;else if(e==80)E=`PrgU:${a.toString().padStart(3,"0")}`,f="!";else if(e==88)E=`CmbU:${a.toString().padStart(3,"0")}`,f="!";else if(e==121)E=`GM2Vox0${l}`,f="#";else if(e==122)if(r[1]==32?r[1]==0:r[1]%=7,E=this.#t[r[1]||0][(r[0]<<7)+r[2]]?.name,E){f=" ";let y=this.#t[r[1]||0][(r[0]<<7)+r[2]];$=y?.poly||$,v=y?.type||v,t=y?.drum}else E="",f="*";else r[1]==0?(E=`${e.toString().padStart(3,"0")} ${a.toString().padStart(3,"0")} ${l.toString().padStart(3,"0")}`,f="!"):r[0]==0?(r[2]=0,f="^"):r[2]>0?r[2]--:r[1]>0?(r[1]=0,f="!"):(r[0]=0,f="?");let o=[r[0],r[1],r[2]];switch(f){case"^":{switch(h){case"gs":case"sc":case"ns5r":{f=" ";break}}e==127&&f=="^"&&(f=" ");break}}let b="??";switch(r[0]){case 0:{r[2]==0?b="GM":r[2]==5||r[2]==7?b="KG":r[2]<126?b="XG":r[2]==127&&(b="MT");break}case 32:case 33:case 35:case 36:{r[2]>4?b=["AP","VL","PF","DX","AN"][r[0]-32]:b="GS";break}case 48:{b="MU";break}case 56:{b="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{b="AI";break}case 62:case 82:case 90:{b="XD";break}case 63:{r[2]<17?b="KR":r[2]<34?b="ES":b="DS";break}case 64:case 126:{b="XG";break}case 67:case 99:{b=r[2]>>4==1?"SD":"DX";break}case 81:{b="RW";break}case 95:{b=["DR","PC"][r[2]];break}case 96:{b=r[2]==106?"AP":r[2]>>4==1?"SD":"PF";break}case 97:{b=r[2]>>4==1?"SD":"VL";break}case 98:{b=r[2]>>4==1?"SD":"SG";break}case 100:{b="AN";break}case 104:case 105:case 106:case 107:{b="SD";break}case 120:{b="GS";break}case 121:{b=r[2]?"G2":"GM";break}case 122:{b="KG";break}case 127:{b=r[2]==127?"MT":a==0?"GM":"XG";break}default:r[0]<48&&(r[0]==16&&h=="xg"?b="XG":b="GS")}return f!=" "&&(h=="krs"||self.debugMode)&&(E="",b="KR"),{name:E||`${V(e||0)} ${V(a||0)} ${V(l||0)}`,poly:$,type:v,drum:t,iid:d,eid:o,sid:g,ending:f,sect:s,bank:i,standard:b,mode:h}}async load(e,a,l="(internal)"){let h=this,g=[],E=0,$=0;e.split(`
`).forEach(function(v,t){let r=v.split("	"),f=[];if(t==0){if(r.forEach(function(s,i){g[Ee.indexOf(s)]=i}),g.length<4){console.debug("Debugger launched.");debugger}}else{let s=0,i=0,n=0,c,d=1,o=0,b;r.forEach(async function(k,x){switch(x){case g[0]:{s=parseInt(k);break}case g[1]:{i=parseInt(k);break}case g[2]:{n=parseInt(k);break}case g[3]:{c=k;break}case g[4]:{k=parseInt(k),k<16?d=k+1:o=(k&15)+1;break}case g[5]:{b=k;break}}}),h.#t[i]=h.#t[i]||[];let y=h.#t[i];if(!y[s<<7|n]||a){let k={msb:s,prg:i,lsb:n,name:c,poly:d,type:o,drum:b};y[s<<7|n]=k,E++}$++}}),a||console.debug(`Map "${l}": ${$} total, ${E} loaded.`)}clearRange(e){let a=e.prg!=null?e.prg.constructor==Array?e.prg:[e.prg,e.prg]:[0,127],l=e.msb!=null?e.msb.constructor==Array?e.msb:[e.msb,e.msb]:[0,127],h=e.lsb!=null?e.lsb.constructor==Array?e.lsb:[e.lsb,e.lsb]:[0,127];for(let g=l[0];g<=l[1];g++){let E=g<<7;for(let $=h[0];$<=h[1];$++){let v=E+$;for(let t=a[0];t<=a[1];t++)delete this.#t[t][v]}}}init(){this.#t=[];for(let e=0;e<128;e++)this.#t.push([""])}async loadFiles(...e){this.init();let a=this;e.forEach(async function(l){try{await fetch(`./data/bank/${l}.tsv`).then(function(h){return h.text()}).then(h=>{a.load(h,!1,l)})}catch{console.error(`Failed loading "${l}.tsv".`)}})}constructor(...e){this.loadFiles(...e)}};var j=class{#t={};context;set(e,a){this.#t[e]=a}has(e){return!!this.#t[e]}async read(e,a){if(!this.has(e))throw new Error(`No decoder registered for "${e}"`);return await this.#t[e].call(this.context||this,a)}};var ye=function(e,a){let l=!0;return a.forEach((h,g)=>{l=l&&e[g]==h}),l},U=function(e){let a=0;return e.forEach(l=>{a*=256,a+=l}),a},D=new TextDecoder,H=new j;H.set("s7e",async function(e){let a=new Uint8Array(await e.slice(0,65536).arrayBuffer()),l="MSB	LSB	PRG	NME",h=[0,0,0,0],g=32,E=0,$=0,v=!0,t=[],r=0;for(;v;){let f=a.subarray(E);([()=>{D.decode(f.subarray(0,4))=="YSFC"?(E+=80,$=1):E++},()=>{if(ye(f.subarray(0,4),h))t.forEach((s,i,n)=>{let c=U(a.subarray(s.start+4,s.start+8));s.length=c}),$=2;else{let s=D.decode(f.subarray(0,4)),i=U(f.subarray(4,8));t.push({type:s,start:i}),E+=8}},()=>{let s=t[r],i=a.subarray(s.start,s.start+s.length),n=32;switch(s.type){case"ENVC":{let c=g;for(;c<i.length;){let d=i.subarray(c,c+n),o=D.decode(d.subarray(0,10)).trimEnd();o.slice(0,5)=="Init "&&(o=""),o&&(l+=`
063	${(d[17]+13).toString().padStart(3,"0")}	${d[19].toString().padStart(3,"0")}	${o}`),c+=n}break}case"EDVC":{let c=g;for(;c<i.length;){let d=i.subarray(c,c+n),o=D.decode(d.subarray(0,10)).trimEnd();o.slice(0,5)=="Init "&&(o=""),o&&(l+=`
063	024	${d[19].toString().padStart(3,"0")}	${o}`),c+=n}break}case"EPVC":{let c=32,d=g;for(;d<i.length;){let o=i.subarray(d,d+c),b=D.decode(o.subarray(0,10)).trimEnd();b=="----------"&&(b=""),b&&(l+=`
063	${(o[17]+1).toString().padStart(3,"0")}	${o[19].toString().padStart(3,"0")}	${b}`),d+=c}break}}r++,r>=t.length&&($=3,v=!1)}][$]||(()=>{v=!1}))()}return l});H.set("pcg",async function(e){let a=new Uint8Array(await e.arrayBuffer()),l="MSB	LSB	PRG	NME",h=100,g=0,E=0,$=!0,v=[],t=0;for(;$;){let r=a.subarray(h);([()=>{$=D.decode(r.subarray(0,4))=="INI2",E=r[15],h+=16,g=1},()=>{let f=D.decode(r.subarray(0,4)),s=r[5],i=r[7],n=r[11],c=U(r.subarray(12,16)),d=U(r.subarray(16,20)),o=U(r.subarray(36,40)),b=D.decode(r.subarray(44,44+n));v.push({type:f,tipMsb:s,tipLsb:i,nameLen:n,length:c,start:d,entryLen:o,name:b}),h+=64,E--,E<1&&(g=2)},()=>{let f=v[t],s=a.subarray(f.start,f.start+f.length);switch(f.type){case"PRG1":break;case"PBK1":{let i=63,n=(f.tipMsb?6:0)+f.tipLsb;for(let c=0;c<128;c++){let d=c*f.entryLen,o=s.subarray(d,d+f.entryLen),b=D.decode(o.subarray(0,24)).trimEnd().replace("InitProg","");b.length&&n>5&&(l+=`
${i.toString().padStart(3,"0")}	${n.toString().padStart(3,"0")}	${c.toString().padStart(3,"0")}	${b}`)}break}case"CBK1":{let i=63,n=(f.tipMsb?3:0)+f.tipLsb+10;for(let c=0;c<128;c++){let d=c*f.entryLen,o=s.subarray(d,d+f.entryLen),b=D.decode(o.subarray(0,24)).trimEnd().replace("InitCombi","");b.length&&n>12&&(l+=`
${i.toString().padStart(3,"0")}	${n.toString().padStart(3,"0")}	${c.toString().padStart(3,"0")}	${b}`)}break}}t++,t>=v.length&&(g=3,$=!1)}][g]||(()=>{$=!1}))()}return l});var N=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),I=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],me=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],L=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],J=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],Z=function(e){let a=.1,l=-.3;return e>66?(a=5,l=315):e>56?(a=1,l=47):e>46&&(a=.5,l=18.5),a*e-l},ee=function(e){return e>105?me[e-106]:e>100?e*1.1-100:e/10},te=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),K={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,うぃ
we,うぇ
wo,を
nga,ガ
ngi,ギ
ngu,グ
nge,ゲ
ngo,ゴ
ngy,ギ!
ng,
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,いぇ
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(e=>{let a=e.split(",");K[a[0]]=a[1]});var ae=function(e){let a=e;e[0]=="*"&&(a=a.slice(1)),["aa","ii","uu","ee","oo"].forEach(h=>{for(;a.indexOf(h)>-1;)a=a.replace(h,h[0])});for(let h in K)a=a.replaceAll(h,K[h]);a.indexOf("ん")==0&&a.length>1&&(a=a.slice(1));let l=a.indexOf("!");return l>-1&&a.length>1&&(a=a.slice(l+1)),a},re=function(e){return e?e<96?`cc${e}`:["aftertouch","velocity","pitch bend"][e-96]:"off"};var z=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],se=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],ie=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var $e={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},ve={66307:["drive"],66309:["vowel",e=>"aiueo"[e]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",e=>["off","LPF","HPF"][e]],94984:["noise type",e=>["white","pink"][e]],94987:["disc type",e=>["LP","SP","EP","RND"]],94990:["hum type",e=>`${e+5}0Hz`],94993:["M/S",e=>["mono","stereo"][e]]},q=function(e){return $e[(e[0]-32<<8)+e[1]]||`0x${e[0].toString(16).padStart(2,"0")}${e[1].toString(16).padStart(2,"0")}`},ce=function(e,a,l){let h=(e[0]-32<<16)+(e[1]<<8)+a,g=ve[h]||{},E=g[0];if(E?.length)return E+=`: ${(g[1]||function(){})(l)||l}`,E},Q=[68,48,95,78,41,3,110,122,0];var C=function(e=64){return Math.round(2e3*Math.log10(e/64))/100};var O=function(e){let a=0;return e.forEach(l=>{a+=l,a=a&127}),~a+1&127},M=function(e,a){let l=0,h=0;for(let g=0;g<e.length;g++){let E=g%8-1,$=(h>>E&1)<<7,v=e[g];v+=$,g%8!=0?(a(v,l,e),l++):h=e[g]}};var G=function(e){let a=Math.floor(e*14.2);return a<128?a:0},w=function(){return!!self.Bun||self.debugMode||!1};var S=["?","gm","gs","sc","xg","g2","mt32","doc","qy10","qy20","ns5r","x5d","05rw","k11","sg","sd","krs","s90es","motif","trin"],ke={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es",trinity:"trin","tr-rack":"trin"},we=["melodic","drum","menu"],ne={"?":[0,0,120],gm:[0,0,127],gs:[0,0,120],sc:[0,0,120],xg:[0,0,127],g2:[0,0,120],mt32:[0,127,127],doc:[57,112,127],qy10:[57,113,127],qy20:[57,114,127],ns5r:[0,0,61],x5d:[82,0,62],"05rw":[81,0,62],k11:[0,0,122],sg:[0,0,122],sd:[97,0,105],krs:[121,0,120],s90es:[0,0,127],motif:[0,0,127],trin:[0,0,127]},oe=[9,25,41,57,73,89,105,121],xe=[0,3,81,84,88],le={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},de={0:0,1:1,2:3,5:4},fe={0:0,1:1,2:2,5:3},he=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],ue=[36,37,48,49,52,53],X=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],pe={26:127,29:0,30:0,31:0,52:12,53:54},B=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,128,12,13,16,17,18,19,14,15,20,21,26,28,80,81,83,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],Se=[2,12,13,14,15,16,17,18,19,20,21,80,81,83,136,130,131,132,133,134,135,137,138,139,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],Ce=[33,99,100,32,102,8,9,10],be=[0,16,25,40,32,64,26,48],m={};S.forEach((e,a)=>{m[e]=a});var p={length:B.length};B.forEach((e,a)=>{p[e]=a});var R={length:X.length};X.forEach((e,a)=>{R[e]=a});var Te={};we.forEach((e,a)=>{Te[e]=a});var Me=function(e){let a=[],l=0;return e?.forEach(function(h,g){h==247?a.push(e.subarray(l,g)):h==240&&(l=g+1)}),a.length||a.push(e.subarray(0)),w()&&console.debug(a),a};var ge=8,u={port:ge,ch:ge<<4,cc:B.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,ace:8,drm:8,dpn:X.length,dnc:128,ext:3,efx:7,cvn:12,redir:32,invalidCh:255},A={bank0:128},et=class extends Y{NOTE_IDLE=0;NOTE_ATTACK=1;NOTE_DECAY=2;NOTE_SUSTAIN=3;NOTE_HELD=4;NOTE_RELEASE=5;NOTE_SOSTENUTO_ATTACK=8;NOTE_SOSTENUTO_DECAY=9;NOTE_SOSTENUTO_SUSTAIN=10;NOTE_SOSTENUTO_HELD=11;CH_MELODIC=0;CH_DRUMS=1;CH_DRUM1=2;CH_DRUM2=3;CH_DRUM3=4;CH_DRUM4=5;CH_DRUM5=6;CH_DRUM6=7;CH_DRUM7=8;CH_DRUM8=9;DUMP_ALL=0;DUMP_ONCE=1;DUMP_MODE=2;EXT_NONE=0;EXT_VL=1;EXT_DX=3;VLBC_BRTHEXPR=1;VLBC_VELOINIT=2;VLBC_VELOALL=3;CH_INACTIVE=0;CH_ACTIVE=1;CH_DISABLED=2;#t=0;#g=0;#M=0;#H=new Array(11);get#$(){return this.#H[this.#g]}set#$(e){this.#H[this.#g]=e}#C=new Uint8Array(u.ch);#h=new Uint8Array(u.ch);#r=new Uint8Array(u.ch);#e=new Uint8Array(u.ch*u.cc);#E=new Uint8Array(u.ch*u.ace);#s=new Uint8Array(u.ch);#u=new Uint8Array(u.ch*u.nn);#v=new Uint8Array(u.ch);#p=new Uint16Array(u.pl);#b=new Uint8Array(u.pl);#N=new Int16Array(u.ch);#O=new Uint8Array(u.ch);#K=new Uint8Array(u.ch);#k=new Uint8Array(u.ch*u.ext);#a=new Uint8Array(u.ch*u.rpn);#i=new Uint8Array(u.ch*u.rpnt);#te=new Int8Array(u.ch*ue.length);#m=new Uint8Array(u.drm*u.dpn*u.dnc);#R=new Uint8Array(u.drm*2);#w=new Uint8Array(u.efx*3);#ae=new Uint8Array(u.ch);#z=new Uint8Array(u.ch*u.redir);#d=new Uint8Array(u.port);#G=new Uint8Array(u.ch);#D=new Uint8Array(u.ch);#ne=new Uint8Array(u.ch*u.cvn);#B=new Uint8Array(128);#P=new Uint8Array(u.cmt*8);#re=new Uint8Array(1024);#_=new Uint8Array(u.cmt*64);#o={};#c;#A;#oe;#n=100;#q=0;#se=500;#ie=0;#X="";#V=0;#le=0;#ce=0;#L=!0;#l=!1;#he=1;#de;#Q=new Array(u.ch);#x=[];#I=new Uint8Array(u.ch);#F=new Uint8Array(u.tr);baseBank=new F("gm","gm2","xg","gs","ns5r","sd","gmega","plg-vl","plg-pf","plg-dx","plg-an","plg-dr","plg-sg","kross","s90es");userBank=new F("gm");initOnReset=!1;aiEfxName="";chRedir(e,a,l){let h=this;if(h.#F[a])return(h.#F[a]-1)*16+e;if(h.#t==m.sc){if(l==1)return e;let g=0,E=!0;for(;E;)h.#I[e+g]==0?(h.#I[e+g]=a,console.debug(`Assign track ${a} to channel ${e+g+1}.`),E=!1):this.#I[e+g]==a?E=!1:(g+=16,g>=128&&(g=0,E=!1));return e+g}else return e}getTrackPort(e){return this.chRedir(0,e,!0)>>4}forceVoiceRefresh(){for(let e=0;e<u.ch;e++)this.#C[e]&&this.dispatchEvent("voice",{part:e})}#y=[];#W;#f={nOff:(e,a)=>{let l=e*128+a,h=this.#p.lastIndexOf(l);if(h>-1)if(this.#e[u.cc*e+p[64]]>63)this.#b[h]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:a,velo:this.#u[l],state:this.NOTE_HELD});else if(this.#e[u.cc*e+p[66]]>63&&this.#b[h]==this.NOTE_SOSTENUTO_SUSTAIN)this.#b[h]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:a,velo:this.#u[l],state:this.NOTE_SOSTENUTO_HELD});else{this.#p[h]=0,this.#u[l]=0,this.#b[h]=this.NOTE_IDLE;let g=this.getExt(e)[1];(g==this.VLBC_VELOINIT||g==this.VLBC_VELOALL)&&(this.#e[u.cc*e+p[129]]=0),this.dispatchEvent("note",{part:e,note:a,velo:0,state:this.NOTE_IDLE})}},nOn:(e,a,l)=>{let h=e*128+a,g=0;for(this.#v[e]&&this.#f.ano(e);this.#b[g]>0&&this.#p[g]!=h;)g++;if(g<u.pl){this.#p[g]=h,this.#u[h]=l,this.#b[g]=this.NOTE_SUSTAIN,this.#O[e]<l&&(this.#O[e]=l);let E=this.getExt(e)[1];(E==this.VLBC_VELOINIT||E==this.VLBC_VELOALL)&&(this.#e[u.cc*e+p[129]]=l),this.dispatchEvent("note",{part:e,note:a,velo:l,state:this.NOTE_SUSTAIN})}else console.error("Polyphony exceeded.")},nAt:(e,a,l)=>{},cAt:(e,a)=>{},hoOf:e=>{this.#b.forEach((a,l)=>{if(a==this.NOTE_HELD){let h=this.#p[l],g=h>>7;e==g&&(this.#b[l]=this.NOTE_IDLE,this.#p[l]=0,this.#u[h]=0,this.dispatchEvent("note",{part:e,note:h&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{this.#b.forEach((a,l)=>{let h;switch(a){case this.NOTE_ATTACK:{h=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{h=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{h=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(h){this.#b[l]=h;let g=this.#p[l];this.dispatchEvent("note",{part:e,note:g&127,velo:this.#u[g],state:h})}})},soOf:e=>{this.#b.forEach((a,l)=>{if(a==this.NOTE_SOSTENUTO_HELD){let h=this.#p[l],g=h>>7;e==g&&(this.#b[l]=this.NOTE_IDLE,this.#p[l]=0,this.#u[h]=0,this.dispatchEvent("note",{part:e,note:h&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{this.#p.forEach((a,l,h)=>{let g=a>>7,E=a&127;a==0&&this.#u[0]==0||g==e&&this.#f.nOff(g,E)})}};#fe={8:function(e){let a=e.channel,l=e.data[0];this.#f.nOff(a,l)},9:function(e){let a=e.channel,l=this;if(l.getChModeId(a)==m.xg&&l.#r[a]>1){let E=l.getChDrumFirstWrite(a);E[0]&&E[1]!=u.invalidCh&&!l.#C[a]&&(l.copyChSetup(E[1],a),l.dispatchEvent("voice",{part:a}),console.debug(`Part CH${a+1} copied from CH${E[1]}.`))}l.setChActive(a,1);let h=e.data[0],g=e.data[1];g>0?l.#f.nOn(a,h,g):l.#f.nOff(a,h)},10:function(e){let a=e.channel,l=a*128+e.data[0];this.#p.indexOf(l)>-1&&(this.#u[l]=data[1],this.getExt(a)[1]==this.VLBC_VELOALL&&(this.#e[u.cc*a+p[129]]=data[1]),this.dispatchEvent("note",{part:a,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let a=e.channel,l=this,h=this.#Q[a],g=h[e.data[0]];g&&(e.data[0]=g),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(this.#t){case m.s90es:case m.motif:{if(e.data[0]==0){[0,63].indexOf(e.data[1])>-1&&this.setChActive(a,1);break}e.data[1]&&this.setChActive(a,1);break}default:{this.setChActive(a,1);break}}})();let E=a*u.cc,$=a*u.ext,v=this.getChModeId(a);switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{this.#f.ano(a),this.#N[a]=0,this.#e[E+p[1]]=0,this.#e[E+p[5]]=0,this.#e[E+p[64]]=0,this.#e[E+p[65]]=0,this.#e[E+p[66]]=0,this.#e[E+p[67]]=0,this.#e[E+p[11]]=127,this.#e[E+p[101]]=127,this.#e[E+p[100]]=127,this.#e[E+p[99]]=127,this.#e[E+p[98]]=127;return}case 123:{this.#f.ano(a);return}case 124:{this.#f.ano(a);return}case 125:{this.#f.ano(a);return}case 126:{this.#v[a]=1,this.#f.ano(a);return}case 127:{this.#v[a]=0,this.#f.ano(a);return}}if(p[e.data[0]]==null)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(Se.indexOf(e.data[0])>-1&&this.allocateAce(a,e.data[0]),e.data[0]){case 0:{switch(w()&&console.debug(`${S[this.#t]}, CH${a+1}: ${e.data[1]}`),this.#t==0?e.data[1]<48?(this.#r[a]>0&&(e.data[1]=this.#e[E],e.data[1]=120,console.debug(`Forced channel ${a+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]==56?this.switchMode(this.#c.x5==82?"x5d":"05rw"):e.data[1]==62?this.switchMode(this.#c.x5==82?"x5d":"05rw"):e.data[1]==63?this.switchMode(S[this.#c.ds]):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg"):this.#t==m.gs||this.#t==m.sc?e.data[1]<56&&this.#r[a]>0&&(e.data[1]=this.#e[E],e.data[1]=120,console.debug(`Forced channel ${a+1} to stay drums.`)):this.#t==m.gm&&(e.data[1]<48?this.#r[a]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${a+1} to stay drums.`)):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg",!0)),this.#t){case m.xg:{[79,95,126,127].indexOf(e.data[1])>-1?this.#r[a]==0&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):this.#r[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?this.#k[$]=this.EXT_VL:[35,67,83,99].indexOf(e.data[1])>-1?this.#k[$]=this.EXT_DX:this.#k[$]=this.EXT_NONE;break}case m["05rw"]:case m.x5d:case m.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?this.#r[a]==this.CH_MELODIC&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):[80,81,82,83].indexOf(e.data[1])>-1||this.#r[a]!=this.CH_MELODIC&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}case m.sd:{[104,105,106,107].indexOf(e.data[1])>-1?this.#r[a]==0&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):this.#r[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}case m.g2:{e.data[1]==120?this.#r[a]==0&&(this.setChType(a,this.CH_DRUMS),console.debug(`CH${a+1} set to drums by MSB.`)):this.#r[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}}this.dispatchEvent("voice",{part:a});break}case 2:{this.getExt(a)[1]==this.VLBC_BRTHEXPR&&(this.#e[E+p[129]]=e.data[1]);break}case 6:{if(this.#K[a]){[m.xg,m.gs,m.sc,m.ns5r].indexOf(this.#t)<0&&console.warn(`NRPN commits are not available under "${S[this.#t]}" mode, even when they are supported in Octavia.`);let t=this.#e[E+p[99]],r=this.#e[E+p[98]];if(t==1){let f=Ce.indexOf(r);if(f>-1)this.#e[E+p[71+f]]=e.data[1],w()&&console.debug(`Redirected NRPN 1 ${r} to cc${71+f}.`),this.dispatchEvent("cc",{part:a,cc:71+f,data:e.data[1]});else{let s=ue.indexOf(r);s>-1?this.#te[a*10+s]=e.data[1]-64:console.warn(`NRPN 0x01${r.toString(16).padStart(2,"0")} is not supported.`),w()&&console.debug(`CH${a+1} voice NRPN ${r} commit`)}}else{if(X.indexOf(t)<0){let s=`NRPN 0x${t.toString(16).padStart(2,"0")}${r.toString(16).padStart(2,"0")} `;t==127?console.warn(`${s}is not necessary. Consider removing it.`):console.warn(`${s}is not supported.`)}else{let s=this.#r[a]-2;s<0?console.warn(`CH${a+1} cannot accept drum NRPN as type ${I[this.#r[a]]}.`):this.#m[(s*u.dpn+R[t])*u.dnc+r]=e.data[1]}w()&&console.debug(`CH${a+1} (${I[this.#r[a]]}) drum NRPN ${t} commit`)}}else{let t=de[this.#e[E+p[100]]],r=fe[this.#e[E+p[100]]];if(this.#e[E+p[101]]==0&&t!=null)switch(w()&&console.debug(`CH${a+1} RPN 0 ${this.#e[E+p[100]]} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],he[t][0]),he[t][1]),this.#a[a*u.rpn+t]=e.data[1],this.#i[a*u.rpnt+r]=1,v){case m.xg:case m.gs:case m.sc:case m.mt32:case m.s90es:case m.motif:{switch(this.#e[E+p[100]]){case 1:case 2:{this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)});break}}break}default:this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)})}}break}case 32:{switch(w()&&console.debug(`${S[this.#t]}, CH${a+1} LSB: ${e.data[1]}`),this.#t){case m.s90es:case m.motif:{this.setChType(a,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,this.#t,!0);break}}this.getExt(a)[0]==this.EXT_DX,this.dispatchEvent("voice",{part:a});break}case 38:{if(!this.#K[a]){let t=de[this.#e[E+100]],r=fe[this.#e[E+100]];this.#e[E+101]==0&&t!=null&&(this.#a[a*u.rpn+t+1]=e.data[1],this.#i[a*u.rpnt+r]=1)}break}case 64:{e.data[1]<64&&this.#f.hoOf(a);break}case 66:{e.data[1]>>6?this.#f.soOn(a):this.#f.soOf(a);break}case 98:case 99:{this.#K[a]=1;break}case 100:case 101:{this.#K[a]=0;break}}this.#e[E+p[e.data[0]]]=e.data[1],this.dispatchEvent("cc",{part:a,cc:e.data[0],data:e.data[1]})}l.getChModeId(a)==m.xg&&l.#r[a]&&l.setDrumFirstWrite(a)},12:function(e){let a=e.channel,l=this;switch(l.#t){case m.s90es:case m.motif:{e.data&&l.setChActive(a,1);break}default:l.setChActive(a,1)}if(l.getExt(a)[0]==l.EXT_DX){let h=u.cc*a}l.#s[a]=e.data,l.#D[a]=0,w()&&console.debug(`T:${e.track} C:${a} P:${e.data}`),l.dispatchEvent("voice",{part:a}),l.getChModeId(a)==m.xg&&l.#r[a]&&l.setDrumFirstWrite(a)},13:function(e){let a=this,l=e.channel;this.#p.forEach(function(h){let g=h>>7;l==g&&(a.#u[h]=e.data,a.dispatchEvent("note",{part:l,note:h&127,velo:e.data,state:a.NOTE_SUSTAIN}))})},14:function(e){let a=e.channel;this.#N[a]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)})},15:function(e){Me(e.data).forEach(a=>{let l=a[0],h=a[1];(this.#ue[l]||function(){console.debug(`Unknown manufacturer ${l}.`)})(h,a.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(this.#y[e.meta]||function(l,h,g){}).call(this,e.data,e.track,e.meta),e.meta!=32&&(this.#q=0);let a=xe.indexOf(e.meta)>-1;if(w()&&console.debug(e),a)return e.reply="meta",e}};#ue={64:(e,a,l)=>{this.#J.run(a,l,e)},65:(e,a,l)=>{if(a[0]<16)if(a[1]==72){let h=a[a.length-1],g=O(a.subarray(3,a.length-1));h==g?this.#T.run(a.subarray(0,a.length-1),l,e):console.warn(`Bad SD checksum ${h} - should be ${g}.`)}else this.#T.run(a,l,e);else{let h=a[a.length-1],g=O(a.subarray(2,a.length-1));h==g?this.#T.run(a.subarray(0,a.length-1),l,e):console.warn(`Bad GS checksum ${h} - should be ${g}.`)}},66:(e,a,l)=>{this.#U.run(a,l,e)},67:(e,a,l)=>{this.#S.run(a,l,e)},68:(e,a,l)=>{this.#ee.run(a,l,e)},71:(e,a,l)=>{this.#Z.run(a,l,e)},126:(e,a,l)=>{this.#Y.run(a,l,e)},127:(e,a,l)=>{this.switchMode("gm"),this.#j.run(a,l,e)}};#Y;#j;#S;#T;#U;#J;#Z;#ee;buildRchTree(){let e=[];this.#h.forEach((a,l)=>{a<u.ch&&(e[a]?.constructor||(e[a]=[]),e[a].push(l))}),this.#de=e}buildRccMap(){let e=this;for(let a=0;a<u.ch;a++)e.#Q[a]={};e.#z.forEach((a,l)=>{a&&(e.#Q[Math.floor(l/u.redir)][a]=l%u.redir|128)}),w()&&console.debug(e.#Q)}getActive(){return this.#C}getCc(e){let a=this,l=e*u.cc,h=a.#e.subarray(l,l+u.cc);return h[p[0]]=h[p[0]]||a.#o[a.getChModeId(e)][0],h[p[32]]=h[p[32]]||a.#o[a.getChModeId(e)][1],h[p[0]]==A.bank0&&(h[p[0]]=0),h}getCcCh(e,a){let l=this;if(B.indexOf(a)<0)throw new Error("CC number not accepted");let h=l.#e[u.cc*e+p[a]];switch(a){case 0:{h=h||l.#o[l.getChModeId(e)][0],h==A.bank0&&(h=0);break}case 32:{h=h||l.#o[l.getChModeId(e)][1];break}}return h}getCcAll(){let e=this,a=e.#e.slice();for(let l=0;l<u.ch;l++){let h=l*u.cc;a[h+p[0]]=a[h+p[0]]||e.#o[e.getChModeId(l)][0],a[h+p[32]]=a[h+p[32]]||e.#o[e.getChModeId(l)][1],a[p[0]]==A.bank0&&(a[p[0]]=0)}return a}getChSource(){return this.#h}getChType(){return this.#r}setChType(e,a,l=0,h=!1){a&=15;let g=this;l=l||g.getChModeId(e),g.#r[e]=a,a>0&&!h&&(g.#e[e*u.cc+p[0]]=g.#o[l][2])}setChActive(e,a=0){this.#C[e]!=a&&this.dispatchEvent("channeltoggle",{part:e,active:a}),this.#C[e]=a}getExt(e){let a=u.ext*e,l=this.#k.subarray(a,a+u.ext),h=new Uint8Array(l.length);return h.set(l),h[1]=h[1]||this.#he,h}getPitch(){return this.#N}getProgram(){return this.#s}getTexts(){return this.#x.slice()}getVel(e){let a=new Map,l=this;return l.#p.forEach(function(h,g){let E=Math.floor(h/128),$=h%128;e==E&&l.#u[h]>0&&a.set($,{v:l.#u[h],s:l.#b[g]})}),a}getBitmap(){return{bitmap:this.#$,expire:this.#M}}getLetter(){return{text:this.#X,set:this.#le,expire:this.#V}}getMode(){return S[this.#t]}getMaster(){return{volume:this.#n}}getRawStrength(){let e=this;return this.#p.forEach(function(a){let l=Math.floor(a/128);e.#u[a]>e.#O[l]&&(e.#O[l]=e.#u[a])}),this.#O}getStrength(){let e=[],a=this;return this.getRawStrength().forEach(function(l,h){e[h]=Math.floor(l*a.#e[h*u.cc+p[7]]*a.#e[h*u.cc+p[11]]*a.#n/803288)}),e}getRpn(){return this.#a}getNrpn(){return this.#te}getSubDb(){return self?.structuredClone(this.#o)}getVoice(e,a,l,h="?"){let g=this;m[h]?.constructor||(h="?");let E=m[h],$=e||g.#o[E][0],v=a,t=l||g.#o[E][1];$==A.bank0&&($=0),t==A.bank0&&(t=0),h=="ns5r"&&$>0&&$<56&&(t=3);let r=g.userBank.get($,v,t,h);if(h=="mt32"&&r.name.indexOf("MT-m:")==0){let f=parseInt(r.name.slice(5)),s=f*u.cmt,i="";g.#_.subarray(s,s+10).forEach(c=>{c>31&&(i+=String.fromCharCode(c))});let n=`MSB	LSB	PRG	NME
0	127	${v}	${i}`;g.userBank.load(n,!0),r.name=i,r.ending=" "}return(r.ending!=" "||!r.name.length)&&(r=g.baseBank.get($,v,t,h)),r}getChVoice(e){let a=this,l=a.getVoice(a.getCcCh(e,0),a.#s[e],a.getCcCh(e,32),a.getChMode(e));if(a.#D[e]){let h="";switch(a.#t){case m.mt32:{a.#P.subarray(u.cmt*(e-1),u.cmt*(e-1)+10).forEach(g=>{h+=String.fromCharCode(Math.max(g,32))}),h=h.trimRight();break}default:{let g=u.cvn*e;a.#ne.subarray(g,g+u.cvn).forEach(E=>{h+=String.fromCharCode(Math.max(E,32))}),h=h.trimRight()}}h.length&&(l.ending="~",l.name=h)}return l}getRawPitch(){return this.#N}getPitchShift(e){let a=this,l=e*u.rpn,h=a.#a[l];return a.#i[e*u.rpnt]||a.#t==m.mt32&&(h=12),a.#N[e]/8192*h+(a.#a[l+3]-64)+((a.#a[l+1]<<7)+a.#a[l+2]-8192)/8192}getEffectType(e=0){let a=3*e+1;return this.#w.subarray(a,a+2)}setEffectTypeRaw(e=0,a,l){let h=3*e;this.#w[h]=1,this.#w[h+1+ +a]=l}setEffectType(e=0,a,l){this.setEffectTypeRaw(e,!1,a),this.setEffectTypeRaw(e,!0,l)}getEffectSink(){return this.#ae}setLetterDisplay(e,a,l=0,h=3200){let g=this,E;g.#X=" ".repeat(l),e.forEach($=>{g.#X+=String.fromCharCode($>31?$:32),$<32&&(E=E||new Set,E.add($))}),g.#le=Date.now(),g.#V=Date.now()+h,E&&(E=Array.from(E),E.forEach(($,v,t)=>{t[v]=$.toString(16).padStart(2,"0")}),console.warn(`${a}${a?" ":""}invalid code point${E.length>1?"s":""}: 0x${E.join(", 0x")}`))}setDetectionTargets(e="?",a=0){let l=this,h=-1;switch(e.replaceAll(", ",",").split(",").forEach(g=>{g=g.toLowerCase();let E=S.indexOf(ke[g]||g);w()&&console.debug(`Mapped mode "${g}" to ID "${E}".`),E>-1&&(h=E)}),w()&&console.debug(`Set detection target to ID "${h}".`),h>0&&(l.#c.x5=82,l.#c.ds=m.krs),h){case m["05rw"]:{l.#c.x5=81;break}case m.s90es:l.#c.ds=m.s90es,l.#c.smotif=m.s90es;case m.motif:l.#c.ds=m.motif,l.#c.smotif=m.motif}}setGsTargets(e=!1,a=4){if(!a)a=e?3:4;else{if(a>4||a<0)throw new Error(`Invalid GS level ${a}`);if(e&&a>>1!=1)throw new Error(`Invalid SC level ${a}`)}let l=this;l.#c[e?"sc":"gs"]=a,l.#o[m[e?"sc":"gs"]][1]=a,l.forceVoiceRefresh()}getConfigs(){return this.#oe}setDumpLimit(e){if(e>2||e<0)throw new RangeError("Invalid dump limit.");this.#A.dumpLimit=e}allocateAce(e=0,a){let l=this;if(!a||a<128&&a>95){console.warn(`cc${a} cannot be allocated as an active custom effect.`);return}let h=!0,g=0,E=u.ace*e;for(;h&&g<u.ace;)l.#E[g+E]==a?h=!1:l.#E[g+E]||(h=!1,l.#E[g+E]=a,console.info(`Allocated cc${a} to ACE slot ${g} in CH${e+1}.`)),g++;g>=u.ace&&console.warn(`ACE slots are full in CH${e+1}.`)}allocateAceAll(e){let a=this;if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}for(let l=0;l<u.ch;l++){let h=!0,g=0,E=u.ace*l;for(;h&&g<u.ace;)a.#E[g+E]==e?h=!1:a.#E[g+E]||(h=!1,a.#E[g+E]=e),g++;g>=u.ace&&console.warn(`ACE slots are full in CH${l+1}.`)}}releaseAce(e=0,a){let l=!0,h=u.ace*e,g=h+u.ace;for(;l&&h<g;)this.#E[h]==a&&(this.#E[h]=0,l=!1),h++;l&&w()&&console.debug(`No ACE slot was allocated to cc${a} in CH${e+1}.`)}resetAce(){this.#E.fill(0),console.info("All ACE slots have been reset.")}getAce(){return this.#E}getChAce(e=0,a=0){if(a<0||a>=u.ace)throw new RangeError("No such ACE slot");let l=this.#E[u.ace*e+a];if(l){if(B.indexOf(l)>=0)return this.#e[e*u.cc+p[l]];throw new Error(`Invalid ACE source in CH${e+1}: ${l}`)}else return 0}initDrums(){let e=this;e.#m.fill(64);for(let a=0;a<u.drm;a++){let l=a*u.dpn;for(let h in pe){let g=pe[h],E=(l+R[h])*u.dnc;e.#m.subarray(E,E+u.dnc).fill(g)}}}init(e=0){let a=this;a.#q=0,a.#o[m.xg][1]=0,a.dispatchEvent("banklevel",{mode:"xg",data:0}),a.#C.fill(0),a.#e.fill(0),a.#E.fill(0),a.#s.fill(0),a.#u.fill(0),a.#p.fill(0),a.#v.fill(0),a.#O.fill(0),a.#N.fill(0),a.#te.fill(0),a.#i.fill(0),a.#k.fill(0),a.#d.fill(0),a.#G.fill(0),a.#z.fill(0),a.#n=100,a.#x=[],a.#se=500,a.#ie=0,a.#M=0,a.#g=0,a.#$.fill(0),a.#l=!1,a.#ce=0,a.#L=!0,a.initDrums(),a.#h.forEach(function(l,h,g){g[h]=h}),e==0&&(a.dispatchEvent("mode","?"),a.#t=0,a.#I.fill(0),a.#F.fill(0),a.#V=0,a.#X=""),oe.forEach(l=>{a.#e[u.cc*l]=a.#o[a.getChModeId(l)][2]}),a.#r.fill(a.CH_MELODIC),a.#r[9]=a.CH_DRUM1,a.#r[25]=a.CH_DRUM3,a.#r[41]=a.CH_DRUMS,a.#r[57]=a.CH_DRUMS,a.#r[73]=a.CH_DRUM5,a.#r[89]=a.CH_DRUM7,a.#r[105]=a.CH_DRUMS,a.#r[121]=a.CH_DRUMS;for(let l=0;l<u.drm;l++)a.#R[l<<1]=0,a.#R[l<<1|1]=u.invalidCh;a.#re.fill(0),a.#_.fill(0),a.#B.fill(0),a.#P.fill(0),a.#D.fill(0),a.#w.fill(0),a.#ae.fill(0),a.aiEfxName="",a.userBank.clearRange({msb:0,lsb:127,prg:[0,127]});for(let l=0;l<u.ch;l++){let h=l*u.cc;a.#e[h+p[7]]=100,a.#e[h+p[11]]=127,a.#e[h+p[2]]=127,a.#e[h+p[10]]=64,a.#e.subarray(h+p[71],h+p[71]+8).fill(64),a.#e[h+p[128]]=127,a.#e.subarray(h+p[130],h+p[157]+1).fill(64),a.#e[h+p[91]]=40,a.#e[h+p[101]]=127,a.#e[h+p[100]]=127,a.#e[h+p[99]]=127,a.#e[h+p[98]]=127;let g=l*u.rpn;a.#a[g]=2,a.#a[g+1]=64,a.#a[g+2]=0,a.#a[g+3]=64,a.#a[g+4]=0,a.#a[g+5]=0;let E=l*u.ext;a.#k[E+1]=a.VLBC_BRTHEXPR;let $=l*u.redir;a.#z[$+8]=13}a.buildRchTree(),a.buildRccMap(),a.dispatchEvent("mastervolume",a.#n),a.dispatchEvent("efxreverb",a.getEffectType(0)),a.dispatchEvent("efxchorus",a.getEffectType(1)),a.dispatchEvent("efxdelay",a.getEffectType(2)),a.dispatchEvent("efxinsert0",a.getEffectType(3)),a.dispatchEvent("efxinsert1",a.getEffectType(4)),a.dispatchEvent("efxinsert2",a.getEffectType(5)),a.dispatchEvent("efxinsert3",a.getEffectType(6)),a.dispatchEvent("reset"),a.switchMode("?")}setChMode(e,a){let l=this;if(e<0||e>=u.ch)throw new RangeError(`Invalid CH${e+1}`);if(port<0||a>=S.length)throw new RangeError(`Invalid mode ID ${a}`);l.#G[e]=a,l.dispatchEvent("voice",{part:e})}getChMode(e,a){return S[this.getChModeId(e,a)]}getChModeId(e,a){return a?this.#G[e]||this.#d[e>>4]:this.#G[e]||this.#d[e>>4]||this.#t}setPortMode(e,a,l){let h=this;if(e<0||e>=u.ch>>4)throw new RangeError(`Invalid port ${e+1}`);if(a<1)throw new RangeError("Range must be a positive integer");if(e+a>=u.ch>>4)throw new RangeError("Range must be in bound");if(e<0||l>=S.length)throw new RangeError(`Invalid mode ID ${l}`);for(let g=e;g<e+a;g++){h.#d[g]=l;for(let E=g<<4;E<g+1<<4;E++)h.dispatchEvent("voice",{part:E})}}copyChSetup(e,a,l){if(e==a){console.warn(`Failed attempt at overwriting CH${e+1} with its own data.`);return}let h=this;if(l&&h.#C[a]){console.warn(`Failed attempt at copying setup data from CH${e+1} to CH${a+1}.`);return}let g=u.cc*e,E=u.cc*a;h.#s[a]=h.#s[e],h.#e.set(h.#e.subarray(g,g+u.cc),E)}setDrumFirstWrite(e,a){let l=this,h=l.#r[e];if(h<2)return;let g=h-2;if(l.#R[g<<1])if(a)l.#R[g<<1]=0,w()&&console.debug(`First write part for drum set ${g+1} has been reset.`);else return;else a?console.warn(`First write part for drum set ${g+1} is already blank.`):(l.#R[g<<1]=1,l.#R[g<<1|1]=e,console.debug(`First write part for drum set ${g+1} is set to CH${e+1}.`))}getChDrumFirstWrite(e){let a=this,l=a.#r[e];if(l<2)return;let h=l-2;return a.#R.subarray(h<<1,h+1<<1)}getDrumFirstWrite(e){if(e>=0&&e<u.drm)return this.#R.subarray(e<<1,e+1<<1)}switchMode(e,a=!1,l=!1){let h=this,g=m[e];if(g>-1){if(h.#t==0||a){let E=h.#t;h.initOnReset&&a&&(this.init(1),E=m["?"]),h.#t=g,h.#g=0;for(let v=0;v<u.ch;v++)h.#r[v]>0&&h.#G[v]==0&&(h.#e[v*u.cc]=h.#o[g][2]);switch(g){case m.mt32:{Q.forEach((v,t)=>{let r=t+1;h.#C[r]||(h.#s[r]=v,h.#e[r*u.cc+p[91]]=127)});for(let v=1;v<10;v++)h.dispatchEvent("voice",{part:v});break}}let $;switch(g){case m["?"]:case m.g2:{$=[52,4,52,18,0,0,0,0];break}case m.xg:{$=[1,0,65,0,5,0,0,0];break}case m.gm:case m.gs:case m.sc:{$=[40,4,40,18,40,32,32,0];break}case m.sd:{$=[58,0,60,0,61,0,61,0];break}case m["05rw"]:case m.x5d:case m.ns5r:{$=[44,1,44,19,44,0,44,0];break}case m.k11:case m.sg:{$=[24,0,0,0,0,0,0,0];break}case m.mt32:{$=[40,4,0,0,0,0,0,0];break}case m.doc:{$=[24,16,0,0,0,0,0,0];break}case m.motif:case m.s90es:{$=[113,0,117,0,114,0,0,0];break}default:$=[0,0,0,0,0,0,0,0]}for(let v=0;v<u.efx;v++)!h.#w[3*v]&&$[v<<1]?.constructor&&(h.#w[3*v+1]=$[2*v],h.#w[3*v+2]=$[2*v+1],h.dispatchEvent(`efx${["reverb","chorus","delay","insert0"][v]}`,h.getEffectType(v)));l&&h.setDetectionTargets(e),h.dispatchEvent("mode",e),h.forceVoiceRefresh(),oe.forEach(v=>{h.dispatchEvent("voice",{part:v})})}}else throw new Error(`Unknown mode ${e}`)}newStrength(){this.#O.fill(0)}runJson(e){if(e.type>14)return e.type==15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),this.#fe[e.type].call(this,e);{let a=this.chRedir(e.part,e.track),l=!1;this.#de[a]?.forEach(h=>{e.channel=h,l=!0,this.#fe[e.type].call(this,e)}),l||console.warn(`${le[e.type]?le[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${a+1} without any recipient.`)}this.#x.length>100&&this.#x.splice(100,this.#x.length-99)}runRaw(e){}async loadBank(e,a){let l=this;switch(e=e.toLowerCase(),e){case"s7e":{l.userBank.clearRange({msb:63,lsb:[21,22]}),l.userBank.clearRange({msb:63,lsb:[24,27]});break}case"pcg":{l.userBank.clearRange({msb:63,lsb:[6,9]}),l.userBank.clearRange({msb:63,lsb:[13,16]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":case"pcg":{H.context=this,await l.userBank.load(await H.read(e,a),!1);break}}l.forceVoiceRefresh()}constructor(){super();let e=this;e.#$=new Uint8Array(256),e.#H[10]=new Uint8Array(512),e.#W=new T,e.#c={x5:82,ds:m.krs,smotif:m.s90es,gs:4,sc:3},e.#A={dumpLimit:e.DUMP_MODE},e.#oe=new Proxy(e.#A,{set:()=>{}});for(let t in ne){let r=m[t];r==null?console.debug(`SubDB build error: "${t}" does not exist`):e.#o[r]=new Uint8Array(ne[t])}e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(t){let{data:r}=t;e.#x[0]?.type==r.type&&e.#x[0]?.amend?(e.#x[0].amend=r.amend,e.#x[0].data+=r.data):e.#x.unshift(r)}),e.#y[1]=function(t){switch(t=t.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),t.slice(0,2)){case"@I":{this.#l=!0,this.dispatchEvent("metacommit",{type:"Kar.Info",data:t.slice(2)?.trimLeft()});break}case"@K":{this.#l=!0,this.dispatchEvent("metacommit",{type:"Kar.Mode",data:t.slice(2)?.trimLeft()}),console.debug(`Karaoke mode active: ${t.slice(2)}`);break}case"@L":{this.#l=!0,this.dispatchEvent("metacommit",{type:"Kar.Lang",data:t.slice(2)?.trimLeft()});break}case"@T":{this.#l=!0,this.dispatchEvent("metacommit",{type:"KarTitle",data:t.slice(2)?.trimLeft()});break}case"@V":{this.#l=!0,this.dispatchEvent("metacommit",{type:"Kar.Ver.",data:t.slice(2)?.trimLeft()});break}case"XF":{let r=t.slice(2).split(":");switch(r[0]){case"hd":{r.slice(1).forEach((f,s)=>{f.length&&this.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][s],data:f})});break}case"ln":{r.slice(1).forEach((f,s)=>{f.length&&this.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][s],data:f})});break}default:this.dispatchEvent("metacommit",{type:"XfUnData",data:t})}break}default:this.#l?t[0]=="\\"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:t.slice(1),amend:!0})):t[0]=="/"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:t.slice(1),mask:!0,amend:!0})):this.dispatchEvent("metacommit",{type:"KarLyric",data:t,amend:!0}):t.split(`
`).forEach((r,f)=>{this.dispatchEvent("metacommit",{type:"Cmn.Text",data:r,mask:f!=0})})}},e.#y[2]=function(t){this.dispatchEvent("metacommit",{type:"Copyrite",data:t})},e.#y[3]=function(t,r){r<1&&this.#q<1&&this.dispatchEvent("metacommit",{type:"TrkTitle",data:t})},e.#y[4]=function(t,r){this.dispatchEvent("metacommit",{type:"Instrmnt",data:t})},e.#y[5]=function(t){t.trim()==""?this.dispatchEvent("metacommit",{type:"C.Lyrics",data:"",amend:!1}):this.dispatchEvent("metacommit",{type:"C.Lyrics",data:t,amend:!0})},e.#y[6]=function(t){this.dispatchEvent("metacommit",{type:"C.Marker",data:t})},e.#y[7]=function(t){this.dispatchEvent("metacommit",{type:"CuePoint",data:t})},e.#y[32]=function(t){this.#q=t[0]+1},e.#y[33]=function(t,r){w()&&console.debug(`Track ${r} requests to get assigned to output ${t}.`),e.#F[r]=t+1},e.#y[81]=function(t,r){e.#se=t/1e3},e.#y[127]=function(t,r){e.#W.run(t,r)},e.#W.default=function(t){console.warn(`Unrecognized sequencer-specific byte sequence: ${t}`)},e.#W.add([67,0,1],function(t,r){w()&&console.debug(`XGworks requests assigning track ${r} to output ${t[0]}.`),e.#F[r]=t[0]+1}),e.#Y=new T("universal non-realtime"),e.#j=new T("universal realtime"),e.#S=new T("Yamaha"),e.#T=new T("Roland"),e.#U=new T("Korg"),e.#J=new T("Kawai"),e.#Z=new T("Akai"),e.#ee=new T("Casio");let a=new T("DX7+ Dump"),l=function(t){console.info(`Unrecognized SysEx in "${this.name}" set.
%o`,t)};e.#Y.default=l,e.#j.default=l,e.#S.default=l,e.#T.default=l,e.#U.default=l,e.#J.default=l,e.#Z.default=l,e.#ee.default=l,a.default=l,e.#Y.add([9],(t,r,f)=>{e.switchMode(["gm","?","g2"][t[0]-1],!0),e.setPortMode(e.getTrackPort(r),1,m[["gm","?","g2"][t[0]-1]]),e.#l=e.#l||!1,console.info(`MIDI reset: ${["GM","Init","GM2"][t[0]-1]}`),t[0]==2&&e.init()}),e.#j.add([4,1],(t,r,f)=>{e.dispatchEvent("mupromptex"),e.#n=((t[1]<<7)+t[0])/16383*100,e.dispatchEvent("mastervolume",e.#n)}).add([4,3],(t,r,f)=>((t[1]<<7)+t[0]-8192)/8192).add([4,4],(t,r,f)=>t[1]-64).add([4,5],(t,r,f)=>{e.dispatchEvent("mupromptex");let s=t[0],i=t[1],n=t[2],c=3,d=c+(s<<1),o=d+i;if(s!=1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${s})!
`,t);return}let b=0,y=0,k=0;switch(t.subarray(c,d).forEach(x=>{b=b<<7,b|=x}),t.subarray(d,o).forEach((x,P)=>{y|=x<<P*7}),t.subarray(o).forEach((x,P)=>{k|=x<<P*7}),w()&&console.debug(`GM2 global parameter: (${t.subarray(3,d)}; p: ${y}, v: ${k})`),b){case 129:{y==0&&(e.setEffectType(0,52,k),e.dispatchEvent("efxreverb",e.getEffectType(0)));break}case 130:{y==0&&(e.setEffectType(1,52,k|16),e.dispatchEvent("efxchorus",e.getEffectType(1)));break}default:w()&&console.debug("GM2 global paramater slot path unknown.")}}),this.#S.add([76,0,0],(t,r,f)=>{switch(t[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset: ${t}`);break}case 126:{e.switchMode("xg",!0),e.setPortMode(e.getTrackPort(r),4,m.xg),e.#l=!1,console.info("MIDI reset: XG");break}default:{e.dispatchEvent("mupromptex");let s=[0,0,0,0],i=(n,c)=>{s[c]=n};if(t.subarray(1).forEach((n,c)=>{let d=c+t[0];([i,i,i,i,o=>{this.#n=o*129/16383*100,e.dispatchEvent("mastervolume",e.#n)},o=>{},o=>{}][d]||(()=>{}))(n,c)}),t[0]<4){let n=0;s.forEach(c=>{n=n<<4,n+=c}),n-=1024}}}}).add([76,2,1],(t,r,f)=>{e.dispatchEvent("mupromptex");let s="XG ";t[0]<32?(s+="reverb ",t.subarray(1).forEach((i,n)=>{([c=>{e.setEffectTypeRaw(0,!1,c),console.info(`${s}main type: ${N[c]}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},c=>{e.setEffectTypeRaw(0,!0,c),console.debug(`${s}sub type: ${c+1}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},c=>{console.debug(`${s}time: ${Z(c)}s`)},c=>{console.debug(`${s}diffusion: ${c}`)},c=>{console.debug(`${s}initial delay: ${c}`)},c=>{console.debug(`${s}HPF cutoff: ${L[c]}Hz`)},c=>{console.debug(`${s}LPF cutoff: ${L[c]}Hz`)},c=>{console.debug(`${s}width: ${c}`)},c=>{console.debug(`${s}height: ${c}`)},c=>{console.debug(`${s}depth: ${c}`)},c=>{console.debug(`${s}wall type: ${c}`)},c=>{console.debug(`${s}dry/wet: ${c}`)},c=>{console.debug(`${s}send: ${C(c)}dB`)},c=>{console.debug(`${s}pan: ${c-64}`)},!1,!1,c=>{console.debug(`${s}delay: ${c}`)},c=>{console.debug(`${s}density: ${c}`)},c=>{console.debug(`${s}balance: ${c}`)},c=>{},c=>{console.debug(`${s}feedback: ${c}`)},c=>{}][t[0]+n]||function(){console.warn(`Unknown XG reverb address: ${t[0]}.`)})(i)})):t[0]<64?(s+="chorus ",t.subarray(1).forEach((i,n)=>{([c=>{e.setEffectTypeRaw(1,!1,c),console.info(`${s}main type: ${N[c]}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},c=>{e.setEffectTypeRaw(1,!0,c),console.debug(`${s}sub type: ${c+1}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},c=>{console.debug(`${s}LFO: ${J[c]}Hz`)},c=>{},c=>{console.debug(`${s}feedback: ${c}`)},c=>{console.debug(`${s}delay offset: ${ee(c)}ms`)},c=>{},c=>{console.debug(`${s}low: ${L[c]}Hz`)},c=>{console.debug(`${s}low: ${c-64}dB`)},c=>{console.debug(`${s}high: ${L[c]}Hz`)},c=>{console.debug(`${s}high: ${c-64}dB`)},c=>{console.debug(`${s}dry/wet: ${c}`)},c=>{console.debug(`${s}send: ${C(c)}dB`)},c=>{console.debug(`${s}pan: ${c-64}`)},c=>{console.debug(`${s}to reverb: ${C(c)}dB`)},!1,c=>{},c=>{},c=>{},c=>{console.debug(`${s}LFO phase diff: ${(c-64)*3}deg`)},c=>{console.debug(`${s}input mode: ${c?"stereo":"mono"}`)},c=>{}][t[0]-32+n]||function(){console.warn(`Unknown XG chorus address: ${t[0]}.`)})(i)})):t[0]<86?(s+="variation ",t.subarray(1).forEach((i,n)=>{([c=>{e.setEffectTypeRaw(2,!1,c),console.info(`${s}main type: ${N[c]}`),e.dispatchEvent("efxdelay",e.getEffectType(2))},c=>{e.setEffectTypeRaw(2,!0,c),console.debug(`${s}sub type: ${c+1}`),e.dispatchEvent("efxdelay",e.getEffectType(2))}][t[0]-64+n]||function(){})(i)})):t[0]<97?(s+="variation ",t.subarray(1).forEach((i,n)=>{[c=>{console.debug(`${s}send: ${C(c)}dB`)},c=>{console.debug(`${s}pan: ${c-64}`)},c=>{console.debug(`${s}to reverb: ${C(c)}dB`)},c=>{console.debug(`${s}to chorus: ${C(c)}dB`)},c=>{console.debug(`${s}connection: ${c?"system":"insertion"}`)},c=>{console.debug(`${s}channel: CH${c+1}`)},c=>{console.debug(`${s}mod wheel: ${c-64}`)},c=>{console.debug(`${s}bend wheel: ${c-64}`)},c=>{console.debug(`${s}channel after touch: ${c-64}`)},c=>{console.debug(`${s}AC1: ${c-64}`)},c=>{console.debug(`${s}AC2: ${c-64}`)}][t[0]-86+n](i)})):t[0]>111&&t[0]<118?s+="variation ":console.warn(`Unknown XG variation address: ${t[0]}`)}).add([76,2,64],(t,r,f)=>{t.subarray(1).forEach((s,i)=>{let n=i+t[0];if(n==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][s]}`);else{let c=n-1>>2,d=n-1&3,o=`XG EQ ${c} ${["gain","freq","Q","shape"][d]}: `;[()=>{console.debug(`${o}${s-64}dB`)},()=>{console.debug(`${o}${s} (raw)`)},()=>{console.debug(`${o}${s/10}`)},()=>{console.debug(`${o}${["shelf","peak"][+!!s]}`)}][d]()}})}).add([76,3],(t,r,f)=>{e.dispatchEvent("mupromptex");let s=t[0],i=t[1],n=`XG Insertion ${t[0]+1} `;t.subarray(2).forEach((c,d)=>{([o=>{e.setEffectTypeRaw(3+s,!1,o),console.info(`${n}main type: ${N[o]}`),e.dispatchEvent(`efxinsert${s}`,e.getEffectType(3+s))},o=>{e.setEffectTypeRaw(3+s,!0,o),console.debug(`${n}sub type: ${o+1}`),e.dispatchEvent(`efxinsert${s}`,e.getEffectType(3+s))}][i+d]||function(){})(c)})}).add([76,6,0],(t,r,f)=>{let s=t[0];s<64?e.setLetterDisplay(t.subarray(1),"XG letter display",s):e.#V=Date.now()}).add([76,7,0],(t,r,f)=>{let s=t[0];e.#g=0,e.#M=Date.now()+3200,e.#$.fill(0);let i=t.subarray(1);for(let n=0;n<s;n++)i.unshift(0);i.forEach(function(n,c){let d=Math.floor(c/16),o=c%16,b=(o*3+d)*7,y=7,k=0;for(b-=o*5,d==2&&(y=2);k<y;)e.#$[b+k]=n>>6-k&1,k++})}).add([76,8],(t,r)=>{e.dispatchEvent("mupromptex");let f=e.chRedir(t[0],r,!0),s=t[1],i=u.cc*f,n=`XG CH${f+1} `,c=`Unknown XG part address ${s}.`,d=!0;t.subarray(2).forEach((o,b)=>{d=!0,s<1?console.debug(c):s<41?([()=>{e.#e[i+p[0]]=o,e.dispatchEvent("voice",{part:f})},()=>{e.#e[i+p[32]]=o,e.dispatchEvent("voice",{part:f})},()=>{e.#s[f]=o,e.dispatchEvent("voice",{part:f})},()=>{d=!1;let y=e.chRedir(o,r,!0);e.#h[f]=y,f!=y&&(e.buildRchTree(),console.info(`${n}receives from CH${y+1}`)),e.#C[f]||(e.copyChSetup(y,f,!0),console.debug(`${n}copied from CH${y+1}.`),e.setChActive(f,1),e.dispatchEvent("voice",{part:f}))},()=>{e.#v[f]=+!o},()=>{},()=>{d=!1,e.setChType(f,o,m.xg),console.debug(`${n}type: ${I[o]||o}`),e.dispatchEvent("voice",{part:f})},()=>{e.#a[u.rpn*f+3]=o,e.#i[u.rpnt*f+2]=1,e.dispatchEvent("pitch",{part:f,pitch:e.getPitchShift(f)})},!1,!1,()=>{e.#e[i+p[7]]=o},!1,!1,()=>{e.#e[i+p[10]]=o||128},!1,!1,()=>{e.#e[i+p[128]]=o,e.allocateAce(f,128)},()=>{e.#e[i+p[93]]=o},()=>{e.#e[i+p[91]]=o},()=>{e.#e[i+p[94]]=o},()=>{e.#e[i+p[76]]=o},()=>{e.#e[i+p[77]]=o},()=>{e.#e[i+p[78]]=o},()=>{e.#e[i+p[74]]=o},()=>{e.#e[i+p[71]]=o},()=>{e.#e[i+p[73]]=o},()=>{e.#e[i+p[75]]=o},()=>{e.#e[i+p[72]]=o}][s+b-1]||(()=>{}))():s<48?console.debug(c):s<111?s>102&&s<105&&(e.#e[i+p[[5,65][s&1]]]=o):s<114?console.debug(c):s<116?console.debug(`${n}EQ ${["bass","treble"][s&1]} gain: ${o-64}dB`):s<118?console.debug(c):s<120?console.debug(`${n}EQ ${["bass","treble"][s&1]} freq: ${o}`):console.debug(c)}),d&&e.#r[f]>1&&e.setDrumFirstWrite(f)}).add([76,9],(t,r)=>{let f=e.chRedir(t[0],r,!0),s=t[1],i=u.cc*f,n=`PLG-VL CH${f+1} `;t.subarray(2).forEach((c,d)=>{let o=d+s;switch(o){case 1:{console.info(`${n}breath mode: ${["system","breath","velocity","touch EG"][c]}`);break}case 0:case 27:case 28:break;default:if(o<27){let b=o-3>>1,y=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][b];o&1?o<23?(console.debug(`${n}${y} control source: ${re(c)}`),c&&c<96&&e.allocateAce(f,130+b),e.#z[u.redir*f+b+2]=c,e.buildRccMap()):console.debug(`${n}${y} scale break point: ${c}`):(console.debug(`${n}${y} depth: ${c-64}`),e.#e[i+p[130+b]]=c)}}})}).add([76,10],(t,r,f)=>{}).add([76,16],(t,r,f)=>{}).add([76,17,0,0],(t,r,f)=>{}).add([76,112],(t,r,f)=>{switch(console.debug(`XG enable PLG-${["VL","SG","DX","AN","PF","DR","PC","AP"][t[0]]} for CH${t[2]+1}.`),t[0]){case 0:{e.#k[u.ext*t[2]]=e.EXT_VL;break}case 2:{e.#k[u.ext*t[2]]=e.EXT_DX;break}default:e.#k[u.ext*t[2]]=e.EXT_NONE}}).add([73,0,0],(t,r)=>{let f=t[0],s="MU1000 System - ";t.subarray(1).forEach((i,n)=>{let c=f+n;c==8?console.debug(`${s}LCD contrast: ${i}.`):c==18?(e.#o[m.xg][1]=i?126:0,console.debug(`${s}default bank: ${i?"MU100 Native":"MU Basic"}.`),e.dispatchEvent("banklevel",{mode:"xg",data:+!!i}),e.forceVoiceRefresh()):c>=64&&c<69&&[()=>{e.dispatchEvent("channelactive",i)},()=>{i<8?(e.dispatchEvent("channelmin",i<<4),console.debug(`Octavia System: Minimum CH${(i<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{i<8?(e.dispatchEvent("channelmax",(i<<4)+15),console.debug(`Octavia System: Maximum CH${(i<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{e.#L=!!i,console.info(`Octavia System: RS receiving ${["dis","en"][i]}abled.`)}][c-64]()})}).add([73,10,0],(t,r)=>{let f=t[0],s=`MU1000 RS${e.#L?"":" (ignored)"}: `;if(f<16)switch(f){case 2:{let i=e.chRedir(0,r,!0);e.#L&&(e.dispatchEvent("portrange",4),e.dispatchEvent("portstart",i)),console.info(`${s}Show CH${i+1}~CH${i+64}`);break}case 3:{let i=e.chRedir(t[1]<<5,r,!0);e.#L&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",i)),console.info(`${s}Show CH${i+1}~CH${i+32}`);break}default:console.debug(`${s}unknown switch ${f} invoked.`)}else if(f<32){if(e.#L){let i=e.chRedir(f-16+(e.#ce<<4),r,!0);e.dispatchEvent("channelactive",i)}}else if(f<36){let i=e.chRedir(f-32<<4,r,!0);e.#L&&(e.dispatchEvent("portrange",1),e.dispatchEvent("portstart",i>>4),e.#ce=f-32),console.info(`${s}Show CH${i+1}~CH${i+16}`)}}).add([73,11,0],(t,r)=>{let f="MU1000 System - channel ",s="Octavia System - channel ",i=t[0];t.subarray(1).forEach((n,c)=>{let d=i+c;([()=>{e.setChActive(n,1),e.dispatchEvent("channelactive",n),w()&&console.debug(`${f}current part: CH${n+1}`)},()=>{n<5?(e.dispatchEvent("portrange",1<<n),console.debug(`${f}port range: ${1<<n} port(s)`)):(e.dispatchEvent("portrange",0),console.debug(`${f}port range: reset`))},()=>{n<16?(e.dispatchEvent("portstart",n),console.debug(`${s}start port: ${"ABCDEFGHIJKLMNOP"[n]}`)):(e.dispatchEvent("portstart",255),console.debug(`${s}start port: reset`))}][d]||(()=>{console.debug(`${f}unknown address: ${d}`)}))()})}).add([93,3],(t,r)=>{let f=e.chRedir(t[0],r,!0),s=`PLG-SG CH${f+1} `,i=Date.now();if(t[1]==0){let n="",c=0;t.subarray(2).forEach((d,o)=>{o%2==0?n+=te[d]||d.toString().padStart("0"):c+=d*13}),i>=e.#ie&&this.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"SGLyrics",data:`${ae(n)}`,amend:!0}),e.#ie=i+Math.ceil(c/2)+e.#se,w()&&console.debug(`${s}vocals: ${n}`)}else console.warn(`Unknown PLG-SG data: ${t}`)}).add([98,0],(t,r,f)=>{e.dispatchEvent("mupromptex");let s=t[0],i=t.length-5,n=t.length-1;if(s!=i){console.info(`PLG-DX native dump size mismatch! Gave ${s} instead of ${t.length-5}.`);return}let c=O(t.subarray(4,n));if(c!=t[n]){console.info(`Bad PLG-DX checksum ${t[n]} - should be ${c}.`);return}t[0]=98,e.#S.run(t.subarray(0,n),r,f,{noAce:!0})}).add([98,96],(t,r,f,s)=>{let i=e.chRedir(t[0],r,!0),n=u.cc*i,c=t[1];t.subarray(2).forEach((d,o)=>{let b=c+o;if(!(b<10)){if(b==10)e.resetAce();else if(b<27){let y=b+131;s?.noAce||e.allocateAce(i,y),e.#e[n+p[y]]=d,e.dispatchEvent("cc",{part:i,cc:y,data:d})}}})}).add([100,0],(t,r,f)=>{let s=t.subarray(0,t.length-1);if(t[0]+5!=t.length){console.warn(`Yamaha DX7+ dump SysEx size mismatch! Expected ${t.length}, but got ${t[0]}:
`,t);return}let i=O(s),n=t[t.length-1];if(i!=n){console.warn(`Yamaha DX7+ dump SysEx checksum mismatch! Expected ${i}, but got ${n}:
`,t);return}a.run(s.subarray(1))}).add([100,76],(t,r,f)=>{let s=t[0]>>4,i=t[0]&15,n=t[1];switch(s){case 2:{let c=e.chRedir(i,r,!0),d=u.cc*c;t.subarray(2).forEach((o,b)=>{let y=b+n;if(!(y<7)){if(y<23){let k=y+135;e.allocateAce(c,k),e.#e[d+p[k]]=o,e.dispatchEvent("cc",{part:c,cc:k,data:o})}}});break}default:console.info("Unknown DX7+ multipart: %o",t)}}).add([1,20],(t,r,f)=>{f==115?(e.switchMode("doc",!0),e.setPortMode(e.getTrackPort(r),1,m.doc),console.info("MIDI reset: DOC")):console.debug(`Unknown Yamaha SysEx: 67, ${f}, ${t.join(", ")}`)}).add([1,17,15,89],(t,r,f)=>{f==115?(e.setEffectType(0,24,t[0]|16),e.dispatchEvent("efxreverb",e.getEffectType(0))):console.debug(`Unknown Yamaha SysEx: 67, ${f}, ${t.join(", ")}`)}).add([1,24],(t,r,f)=>{if(f==115){for(let s=0;s<16;s++){let i=e.chRedir(s,r,!0);e.#e[i*u.cc+p[91]]=127}console.info("DOC Global Reverb: on")}else console.debug(`Unknown Yamaha SysEx: 67, ${f}, ${t.join(", ")}`)}),a.add([14,31],(t,r,f)=>{e.#e[u.cc*t[0]+p[64]]=0,e.#f.ano(t[0]),e.switchMode("xg"),e.setPortMode(e.getTrackPort(r),1,m.xg),e.resetAce(),console.debug(`Yamaha DX7+ reset CH${t[0]+1}.`)}).add([76,112],async t=>{let r=t[0],f=u.cc*r,s=u.ext*r,i=u.cvn*r;e.#k[s]=e.EXT_DX,e.#D[r]=1;let n=e.#ne.subarray(i,i+u.cvn);n.fill(32),t.subarray(1).forEach((c,d)=>{if(d<10)n[d]=Math.max(c,32);else if(!(d<40)){if(d<56){let o=d+102;e.#e[f+p[o]]=c,e.dispatchEvent("cc",{part:r,cc:o,data:c})}}}),e.#s[r]=r&127,e.#e[u.cc*r+p[0]]=35,e.#e[u.cc*r+p[32]]=r>>7|4,e.dispatchEvent("voice",{part:r}),console.debug(`DX7+ CH${r+1} dump: %o`,t)});let h=function(t,r,f,s){},g=function(t,r){e.dispatchEvent("mupromptex");let f=t*u.dpn,s=r[0],i=r[1];r.subarray(2).forEach((n,c)=>{let d=c+i,o=-1;d<16?([()=>{o=24},()=>{o=25},()=>{o=26},()=>{},()=>{o=28},()=>{o=29},()=>{o=30},()=>{o=31},()=>{},()=>{},()=>{},()=>{o=20},()=>{o=21},()=>{o=22},()=>{o=23},()=>{}][d]||(()=>{console.debug(`Unknown XG-style drum param ${d} on set ${t+1}.`)}))():d<32||(d<40?([()=>{o=48},()=>{o=49},!1,!1,()=>{o=52},()=>{o=53}][d-32]||(()=>{console.debug(`Unknown XG-style drum param ${d} on set ${t+1}.`)}))():d<80||([()=>{o=36}][d-80]||(()=>{console.debug(`Unknown XG-style drum param ${d} on set ${t+1}.`)}))()),o>=0?(w()&&console.debug(f,o,s,n),e.#m[(f+R[o])*u.dnc+s]=n):w()&&console.debug(`XG-style drum param ${d} has no writes.`)})},E=function(t,r,f){e.dispatchEvent("mupromptex");let s=t*u.dpn,i=(r<<7)+f[0];f.subarray(1).forEach((n,c)=>{let d=c+i,o=d&127,b=d>>7,y=-1;b>1&&([()=>{y=26},()=>{},()=>{y=28},()=>{y=29},()=>{y=30},()=>{},()=>{},()=>{y=31}][b-2]||(()=>{console.debug(`Unknown GS-style drum param ${b} on set ${t+1}.`)}))(),y>-1?(w()&&console.debug(s,y,o,n),e.#m[(s+R[y])*u.dnc+o]=n):w()&&console.debug(`GS-style drum param ${b} has no writes.`)})};this.#S.add([76,48],(t,r,f)=>{g(0,t)}).add([76,49],(t,r,f)=>{g(1,t)}).add([76,50],(t,r,f)=>{g(2,t)}).add([76,51],(t,r,f)=>{g(3,t)}).add([76,52],(t,r,f)=>{g(4,t)}).add([76,53],(t,r,f)=>{g(5,t)}).add([76,54],(t,r,f)=>{g(6,t)}).add([76,55],(t,r,f)=>{g(7,t)}),this.#S.add([89,0],(t,r,f)=>{if(e.eprom){let s=t[0],i=(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);w()&&console.debug(`MU1000 EPROM trail to 0x${i.toString(16).padStart(6,"0")}, ${s} bytes.`);let n=e.eprom.data;t.subarray(4).forEach((c,d)=>{let o=d>>3,b=d&7;if(b==7)for(let y=0;y<7;y++)n[i+7*o+y]+=(c>>6-y&1)<<7;else n[i+7*o+b]=c})}}).add([89,1],(t,r,f)=>{let s=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3];w()&&console.debug(`MU1000 EPROM jump to 0x${s.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=s)}).add([89,2],(t,r,f)=>{if(e.eprom){let s=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);w()&&console.debug(`MU1000 EPROM write to 0x${s.toString(16).padStart(6,"0")}.`);let i=e.eprom.data;t.subarray(4).forEach((n,c)=>{let d=c>>3,o=c&7;if(o==7)for(let b=0;b<7;b++)i[s+7*d+b]+=(n>>6-b&1)<<7;else i[s+7*d+o]=n})}}).add([89,3],(t,r,f)=>{}),this.#S.add([39,48],(t,r,f)=>{}).add([43,0,0],(t,r,f)=>{e.dispatchEvent("mupromptex");let s=[0,0,0,0],i=(n,c)=>{s[c]=n};if(t.subarray(1).forEach((n,c)=>{let d=c+t[0];[i,i,i,i,()=>{this.#n=n*129/16383*100,e.dispatchEvent("mastervolume",e.#n)},()=>n-64,()=>n||128,()=>n,()=>n,()=>{console.debug(`TG300 variation on cc${n}.`)}][d](n,d)}),t[0]<4){let n=0;s.forEach(c=>{n=n<<4,n+=c}),n-=1024}}).add([43,1,0],(t,r,f)=>{e.dispatchEvent("mupromptex")}).add([43,2],(t,r,f)=>{e.dispatchEvent("mupromptex");let s=e.chRedir(t[0],r,!0),i=t[1],n=u.cc*s,c=`TG300 CH${s+1} `;t.subarray(2).forEach((d,o)=>{o<5?([()=>{},()=>{e.#e[n+p[0]]=d,e.dispatchEvent("voice",{part:s})},()=>{e.#e[n+p[32]]=d,e.dispatchEvent("voice",{part:s})},()=>{e.#s[s]=d,e.dispatchEvent("voice",{part:s})},()=>{let b=e.chRedir(d,r,!0);e.#h[s]=b,s!=b&&(e.buildRchTree(),console.info(`${c}receives from CH${b+1}`))}][o+i]||(()=>{}))(d,o+i):o<21||(o<47?([()=>{e.#v[s]=+!d},()=>{},()=>{},()=>{e.#a[u.rpn*s+3]=d,e.#i[u.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{},()=>{e.#e[n+p[7]]=d},!1,!1,()=>{e.#e[n+p[10]]=d||128},!1,!1,()=>{console.debug(`${c} AC1 at cc${d}`)},()=>{console.debug(`${c} AC2 at cc${d}`)},()=>{e.#e[n+p[128]]=d,e.allocateAce(s,128)},()=>{e.#e[n+p[93]]=d},()=>{e.#e[n+p[91]]=d},()=>{e.#e[n+p[94]]=d},()=>{e.#e[n+p[76]]=d},()=>{e.#e[n+p[77]]=d},()=>{e.#e[n+p[74]]=d},()=>{e.#e[n+p[71]]=d},()=>{e.#e[n+p[73]]=d},()=>{e.#e[n+p[75]]=d},()=>{e.#e[n+p[72]]=d},()=>{e.#e[n+p[78]]=d}][o+i-21]||(()=>{}))(d,o+i):o<95||([()=>{e.#e[n+p[65]]=d},()=>{e.#e[n+p[5]]=d}][o+i-95]||(()=>{}))(d,o+i))})}).add([43,7,0],(t,r,f)=>{let s=t[0];e.setLetterDisplay(t.subarray(1),"TG300 letter display",s)}).add([43,7,1],(t,r,f)=>{e.#g=0,e.#M=Date.now()+3200,e.#$.fill(0),t.forEach(function(s,i){let n=Math.floor(i/16),c=i%16,d=(c*3+n)*7,o=7,b=0;for(d-=c*5,n==2&&(o=2);b<o;)e.#$[d+b]=s>>6-b&1,b++})}),this.#T.add([66,18,0,0,127],(t,r,f)=>{e.switchMode("sc",!0),e.setPortMode(e.getTrackPort(r),2,m.sc),e.#e[u.cc*9]=120,e.#e[u.cc*25]=120,e.#e[u.cc*41]=120,e.#e[u.cc*57]=120,e.#o[m.sc][1]=e.#c.sc,e.#l=!1,e.#I.fill(0),console.info(`GS system to ${["single","dual"][t[0]]} mode.`)}).add([66,18,64,0],(t,r,f)=>{switch(t[0]){case 127:{e.switchMode("gs",!0),e.setPortMode(e.getTrackPort(r),2,m.gs),e.#o[m.gs][1]=e.#c.gs,e.#e[u.cc*9]=120,e.#e[u.cc*25]=120,e.#e[u.cc*41]=120,e.#e[u.cc*57]=120,e.#l=!1,e.#I.fill(0),console.info("MIDI reset: GS");break}default:{e.dispatchEvent("mupromptex");let s=[0,0,0,0],i=(n,c)=>{s[c]=n};if(t.subarray(1).forEach((n,c)=>{let d=c+t[0];[i,i,i,i,o=>{this.#n=o*129/16383*100,e.dispatchEvent("mastervolume",e.#n)},o=>{},o=>{}][d](n,c)}),t[0]<4){let n=0;s.forEach(c=>{n=n<<4,n+=c}),n-=1024}}}}).add([66,18,64,1],(t,r,f)=>{e.dispatchEvent("mupromptex");let s=t[0];if(s<16){let i="".padStart(s," ");t.subarray(1).forEach((n,c)=>{i+=String.fromCharCode(Math.max(32,n))}),i=i.padEnd(16," "),console.debug(`GS patch name: ${i}`)}else s<48||(s<65?t.subarray(1).forEach((i,n)=>{let c=`GS ${s+n>55?"chorus":"reverb"} `;([()=>{console.info(`${c}type: ${z[i]}`),e.setEffectType(0,40,i),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${c}predelay: ${i}ms`)},()=>{console.info(`${c}type: ${se[i]}`),e.setEffectType(1,40,16+i),e.dispatchEvent("efxchorus",e.getEffectType(1))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${c}to reverb: ${C(i)}`)},()=>{console.debug(`${c}to delay: ${C(i)}`)}][s+n-48]||(()=>{}))()}):s<80?console.debug(`Unknown GS patch address: ${s}`):s<91?t.subarray(1).forEach((i,n)=>{let c="GS delay ";([()=>{console.info(`${c}type: ${ie[i]}`),e.setEffectType(2,40,32+i),e.dispatchEvent("efxdelay",e.getEffectType(2))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${c}to reverb: ${C(i)}`)}][s+n-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${s}`))}).add([66,18,64,2],(t,r,f)=>{let s="GS EQ ";t.subarray(1).forEach((i,n)=>{([()=>{console.debug(`${s}low freq: ${[200,400][i]}Hz`)},()=>{console.debug(`${s}low gain: ${i-64}dB`)},()=>{console.debug(`${s}high freq: ${[3e3,6e3][i]}Hz`)},()=>{console.debug(`${s}high gain: ${i-64}dB`)}][t[0]+n]||function(){console.warn(`Unknown GS EQ address: ${t[0]+n}`)})()})}).add([66,18,64,3],(t,r,f)=>{e.dispatchEvent("mupromptex");let s="GS EFX ",i=function(n,c){let d=ce(e.#w.subarray(10,12),c,n);d&&console.debug(`${s}${q(e.#w.subarray(10,12))} ${d}`)};t.subarray(1).forEach((n,c)=>{([()=>{e.setEffectTypeRaw(3,!1,32+n),e.dispatchEvent("efxinsert0",e.getEffectType(3))},()=>{e.setEffectTypeRaw(3,!0,n),console.info(`${s}type: ${q(e.#w.subarray(10,12))}`),e.dispatchEvent("efxinsert0",e.getEffectType(3))},!1,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,()=>{console.debug(`${s}to reverb: ${C(n)}dB`)},()=>{console.debug(`${s}to chorus: ${C(n)}dB`)},()=>{console.debug(`${s}to delay: ${C(n)}dB`)},!1,()=>{console.debug(`${s}1 source: ${n}`),n&&n<96&&e.allocateAceAll(n)},()=>{console.debug(`${s}1 depth: ${n-64}`)},()=>{console.debug(`${s}2 source: ${n}`),n&&n<96&&e.allocateAceAll(n)},()=>{console.debug(`${s}2 depth: ${n-64}`)},()=>{console.debug(`${s}to EQ: ${n?"ON":"OFF"}`)}][t[0]+c]||function(d,o){console.warn(`Unknown GS EFX address: ${o}`)})(n,t[0]+c)})}).add([66,18,65],(t,r,f)=>{E((t[0]>>4)+1<<1,t[0]&15,t.subarray(1))}).add([69,18,16],(t,r,f)=>{switch(t[0]){case 0:{let s=t[1];e.setLetterDisplay(t.subarray(2),"GS display text",s);break}case 32:{e.#M=Date.now()+3200,t[1]==0&&(t[2]?(e.#g=Math.max(Math.min(t[2]-1,9),0),w()&&console.debug(`GS switch display page ${t[2]-1}.`)):(e.#g=0,e.#M=Date.now(),w()&&console.debug("GS disable display page.")));break}default:if(t[0]<6){e.#g>9&&(e.#g=0);let s=t[0]-1<<1|t[1]>>6;e.#g==s&&(e.#M=Date.now()+3200),e.#H[s]?.length||(e.#H[s]=new Uint8Array(256));let i=e.#H[s];w()&&console.debug(`GS frame draw page ${s}.`);let n=t[1]&63;i.fill(0),t.subarray(2).forEach(function(d,o){let b=o+n,y=Math.floor(b/16),k=b%16,x=(k*4+y)*5,P=5,_=0;for(x-=k*4,y==3&&(P=1);_<P;)i[x+_]=d>>4-_&1,_++})}else console.warn(`Unknown GS display section: ${t[0]}`)}});let $=function(t,r,f){e.dispatchEvent("mupromptex");let s=t[0],i=u.cc*r,n=u.rpn*r,c=`GS CH${r+1} `;s<3?(t.subarray(1).forEach((d,o)=>{[()=>{e.#e[i+p[0]]=d},()=>{e.#s[r]=d},()=>{let b=0;d<16?b=e.chRedir(d,f,!0):b=u.ch,e.#h[r]=b,r!=b&&(e.buildRchTree(),console.info(`${c}receives from CH${b+1}`))}][s+o]()}),e.dispatchEvent("voice",{part:r})):s<19||(s<44?t.subarray(1).forEach((d,o)=>{([()=>{e.#v[r]=+!d},!1,()=>{e.setChType(r,d<<1,m.gs),console.debug(`${c}type: ${d?"drum ":"melodic"}${d||""}`)},()=>{e.#a[n+3]=d,e.#i[u.rpnt*r+2]=1,e.dispatchEvent("pitch",{part:r,pitch:e.getPitchShift(r)})},!1,()=>{e.#e[i+p[7]]=d},!1,!1,()=>{e.#e[i+p[10]]=d||128},!1,!1,()=>{console.debug(`${c}CC 1: cc${d}`)},()=>{console.debug(`${c}CC 2: cc${d}`)},()=>{e.#e[i+p[93]]=d},()=>{e.#e[i+p[91]]=d},!1,!1,()=>{e.#a[n+1]=d,e.#i[u.rpnt*r+1]=1,e.dispatchEvent("pitch",{part:r,pitch:e.getPitchShift(r)})},()=>{e.#a[n+2]=d,e.#i[u.rpnt*r+1]=1,e.dispatchEvent("pitch",{part:r,pitch:e.getPitchShift(r)})},()=>{e.#e[i+p[94]]=d}][s+o-19]||(()=>{}))()}):s<76||console.debug(`Unknown GS part address: ${s}`))},v=function(t,r){let f=t[0],s=`GS CH${r+1} `;f<2?t.subarray(1).forEach((i,n)=>{[()=>{e.#e[u.cc*r+p[32]]=i},()=>{}][f+n]()}):f<32?console.warn(`Unknown GS misc address: ${f}`):f<35?t.subarray(1).forEach((i,n)=>{[()=>{console.debug(`${s}EQ: o${["ff","n"][i]}`)},()=>{},()=>{console.debug(`${s}EFX: o${["ff","n"][i]}`),e.#ae[r]=i,e.dispatchEvent("partefxtoggle",{part:r,active:i})}][f+n-32]()}):console.warn(`Unknown GS misc address: ${f}`)};this.#T.add([66,18,64,16],(t,r)=>{$(t,e.chRedir(9,r,!0),r)}).add([66,18,64,17],(t,r)=>{$(t,e.chRedir(0,r,!0),r)}).add([66,18,64,18],(t,r)=>{$(t,e.chRedir(1,r,!0),r)}).add([66,18,64,19],(t,r)=>{$(t,e.chRedir(2,r,!0),r)}).add([66,18,64,20],(t,r)=>{$(t,e.chRedir(3,r,!0),r)}).add([66,18,64,21],(t,r)=>{$(t,e.chRedir(4,r,!0),r)}).add([66,18,64,22],(t,r)=>{$(t,e.chRedir(5,r,!0),r)}).add([66,18,64,23],(t,r)=>{$(t,e.chRedir(6,r,!0),r)}).add([66,18,64,24],(t,r)=>{$(t,e.chRedir(7,r,!0),r)}).add([66,18,64,25],(t,r)=>{$(t,e.chRedir(8,r,!0),r)}).add([66,18,64,26],(t,r)=>{$(t,e.chRedir(10,r,!0),r)}).add([66,18,64,27],(t,r)=>{$(t,e.chRedir(11,r,!0),r)}).add([66,18,64,28],(t,r)=>{$(t,e.chRedir(12,r,!0),r)}).add([66,18,64,29],(t,r)=>{$(t,e.chRedir(13,r,!0),r)}).add([66,18,64,30],(t,r)=>{$(t,e.chRedir(14,r,!0),r)}).add([66,18,64,31],(t,r)=>{$(t,e.chRedir(15,r,!0),r)}).add([66,18,64,64],(t,r)=>{v(t,e.chRedir(9,r,!0))}).add([66,18,64,65],(t,r)=>{v(t,e.chRedir(0,r,!0))}).add([66,18,64,66],(t,r)=>{v(t,e.chRedir(1,r,!0))}).add([66,18,64,67],(t,r)=>{v(t,e.chRedir(2,r,!0))}).add([66,18,64,68],(t,r)=>{v(t,e.chRedir(3,r,!0))}).add([66,18,64,69],(t,r)=>{v(t,e.chRedir(4,r,!0))}).add([66,18,64,70],(t,r)=>{v(t,e.chRedir(5,r,!0))}).add([66,18,64,71],(t,r)=>{v(t,e.chRedir(6,r,!0))}).add([66,18,64,72],(t,r)=>{v(t,e.chRedir(7,r,!0))}).add([66,18,64,73],(t,r)=>{v(t,e.chRedir(8,r,!0))}).add([66,18,64,74],(t,r)=>{v(t,e.chRedir(10,r,!0))}).add([66,18,64,75],(t,r)=>{v(t,e.chRedir(11,r,!0))}).add([66,18,64,76],(t,r)=>{v(t,e.chRedir(12,r,!0))}).add([66,18,64,77],(t,r)=>{v(t,e.chRedir(13,r,!0))}).add([66,18,64,78],(t,r)=>{v(t,e.chRedir(14,r,!0))}).add([66,18,64,79],(t,r)=>{v(t,e.chRedir(15,r,!0))}),this.#U.add([54,65],(t,r)=>{let f=e.#c.x5=="81"?"05rw":"x5d";e.switchMode(f,!0),e.setPortMode(e.getTrackPort(r),1,m[f]);let s=t[t.length-1],i=t.subarray(0,t.length-1),n=O(i);n!=s&&(console.info(`X5D multi parameters checksum mismatch! Expected ${n}, got ${s}.`),console.debug(t));let c=(t[1]<<7)+t[0],d=(t[3]<<7)+t[2],o=e.chRedir(c&15,r,!0),b=u.cc*o;[()=>{d<1||(d<101?(e.setChType(o,e.CH_MELODIC,m.x5d),e.#s[o]=d-1,e.#e[b+p[0]]=e.#c.x5):d<229?(e.setChType(o,e.CH_MELODIC,m.x5d),e.#s[o]=d-101,e.#e[b+p[0]]=56):(e.setChType(o,e.CH_DRUMS,m.x5d),e.#s[o]=be[d-229]||0,e.#e[b+p[0]]=62)),e.dispatchEvent("voice",{part:o})},()=>{e.#e[b+p[7]]=d},()=>{d<31&&(e.#e[b+p[10]]=Math.round((d-15)*4.2+64))},()=>{e.#e[b+p[93]]=G(d)},()=>{e.#e[b+p[91]]=G(d)},()=>{e.#a[o*u.rpn+3]=d>8191?d-16320:64+d,e.#i[u.rpnt*o+2]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)})},()=>{e.#a[o*u.rpn+1]=d>8191?d-16320:64+d,e.#i[u.rpnt*o+1]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)})},()=>{d>0&&(e.#a[o*u.rpn]=d,e.#i[u.rpnt*o]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)}))},()=>{}][c>>4]()}).add([54,76,0],(t,r)=>{e.dispatchEvent("mupromptex");let f=e.#c.x5=="81"?"05rw":"x5d";e.switchMode(f),e.setPortMode(e.getTrackPort(r),1,m[f]);let s="",i=e.#c.x5,n=0,c=0,d="MSB	PRG	LSB	NME";M(t,function(o,b){if(b<16400){let y=b%164;switch(!0){case y<10:{o>31&&(s+=String.fromCharCode(o));break}case y==10:break;case y==11:{d+=`
${i}	${n}	${c}	${s.trim().replace("Init Voice","")}`,n++,s="";break}}n>99&&(i=90,n=0)}}),e.userBank.clearRange({msb:e.#c.x5,prg:[0,99],lsb:0}),e.userBank.load(d),w()&&console.debug(d),e.forceVoiceRefresh()}).add([54,77,0],(t,r)=>{e.dispatchEvent("mupromptex");let f=e.#c.x5=="81"?"05rw":"x5d";e.switchMode(f),e.setPortMode(e.getTrackPort(r),1,m[f]);let s="",i=90,n=0,c=0,d="MSB	PRG	LSB	NME";M(t,function(o,b){if(b<13600){let y=b%136;switch(!0){case y<10:{o>31&&(s+=String.fromCharCode(o));break}case y==11:{d+=`
${i}	${n}	${c}	${s.trim().replace("Init Combi","")}`,n++,s="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(d),w()&&console.debug(d),e.forceVoiceRefresh()}).add([54,78],(t,r)=>{let f=e.#c.x5=="81"?"05rw":"x5d";e.switchMode(f),e.setPortMode(e.getTrackPort(r),1,m[f]),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][t[0]]} mode.`)}).add([54,85],(t,r)=>{e.dispatchEvent("mupromptex");let f=e.#c.x5=="81"?"05rw":"x5d";e.switchMode(f),e.setPortMode(e.getTrackPort(r),1,m[f]),M(t,(s,i)=>{i>0&&i<3&&(e.setEffectType(i-1,44,s),e.dispatchEvent(`efx${["reverb","chorus"][i-1]}`,e.getEffectType(i-1)))})}).add([54,104],(t,r)=>{e.dispatchEvent("mupromptex");let f=e.#c.x5=="81"?"05rw":"x5d";e.switchMode(f,!0);let s=e.getTrackPort(r);if(e.#d[s]&&e.#d[s]!=m[f])if(e.#A.dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${r}. Port ${String.fromCharCode(65+s)} mode "${S[e.#d[s]]}" mismatch, should be "${f}".`);return}else console.info(`Track ${r} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);e.setPortMode(s,1,m[f]),M(t,function(i,n,c,d){if(n<192){let o=e.chRedir(Math.floor(n/12),r,!0),b=o*u.cc;switch(n%12){case 0:{i<128?(e.setChType(o,e.CH_MELODIC,m.x5d),e.#e[b+p[0]]=e.#c.x5,e.#s[o]=i):(e.setChType(o,e.CH_DRUMS,m.x5d),e.#e[b+p[0]]=62,e.#s[o]=be[i-128]),i>0&&e.setChActive(o,1),e.dispatchEvent("voice",{part:o});break}case 1:{e.#e[b+p[7]]=i;break}case 2:{e.#a[o*u.rpn+3]=i>127?i-192:64+i,e.#i[u.rpnt*o+2]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)});break}case 3:{e.#a[o*u.rpn+1]=i>127?i-192:64+i,e.#i[u.rpnt*o+1]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)});break}case 4:{i<31&&(e.#e[b+p[10]]=Math.round((i-15)*4.2+64));break}case 5:{let y=i>>4,k=i&15;e.#e[b+p[91]]=G(k),e.#e[b+p[93]]=G(y);break}case 10:break;case 11:{let y=e.chRedir(i&15,r,!0),k=i>>4;e.#h[o]=i,(y!=o||k)&&(console.info(`X5D Part CH${o+1} receives from CH${y+1}.`),e.buildRchTree())}}}else{let o=e.chRedir(n-192,r,!0)}})}),this.#T.add([22,18,127],(t,r,f)=>{e.switchMode("mt32",!0),e.setPortMode(e.getTrackPort(r),1,m.mt32),e.#l=!1,e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(t,r,f)=>{e.switchMode("mt32");let s=e.chRedir(f,r,!0),i=t[1];t.subarray(2).forEach((n,c)=>{let d=c+i;e.#B[d+(s-1)*16]=n,([!1,()=>{let o=e.#B[s-1<<4];if(o<3){if(e.#D[s]=1,o==2)for(let b=0;b<name.length;b++)e.#P[(s-1)*u.cmt+b]=e.#_[n*u.cmt+b];else{let b=e.baseBank.get(0,n+(o<<6),127,"mt32").name;for(let y=0;y<b.length;y++)e.#P[(s-1)*u.cmt+y]=b.charCodeAt(y)}e.dispatchEvent("voice",{part:s})}},()=>{e.#a[s*u.rpn+3]=n+40,e.#i[u.rpnt*s+2]=1},()=>{e.#a[s*u.rpn+1]=n+14,e.#i[u.rpnt*s+1]=1},()=>{e.#a[s*u.rpn]=n,e.#i[u.rpnt*s]=1},!1,()=>{e.#e[u.cc*s+p[91]]=n?127:0},!1,()=>{e.#e[u.cc*s+p[7]]=n},()=>{e.#e[u.cc*s+p[10]]=Math.ceil(n*9.05)}][d]||(()=>{}))()})}).add([22,18,1],(t,r,f)=>{e.switchMode("mt32");let s=f&7;console.debug(`MT-32 slot #${f+1} Drum: ${t}`);let i=t[0]<<7|t[1];t.subarray(2).forEach((n,c)=>{let d=c+i,o=(d>>2)+24,b=d&3,y=s*u.dpn;if(w()&&console.debug(`MT-32 temp drum note ${o} param ${b}: ${n}`),o<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${o}`);return}[()=>{},()=>{e.#m[(y+R[26])*u.dnc+o]=Math.round(n*1.27)},()=>{e.#m[(y+R[26])*u.dnc+o]=n*9+1&127},()=>{e.#m[(y+R[26])*u.dnc+o]=n?127:0}][b]()})}).add([22,18,2],(t,r,f)=>{e.switchMode("mt32");let s=e.chRedir(f,r,!0),i=t[1]+(t[0]<<7);i<10&&(e.#D[s]=1),t.subarray(2).forEach((n,c)=>{let d=c+i;d<14&&(e.#P[(s-1)*u.cmt+d]=n)}),e.dispatchEvent("voice",{part:s})}).add([22,18,3],(t,r,f)=>{e.switchMode("mt32");let s=f&7;if(t[0]){let i=(t[0]-1<<7)+t[1]-16;t.subarray(2).forEach((n,c)=>{let d=c+i,o=(d>>2)+24,b=d&3,y=s*u.dpn;if(w()&&console.debug(`MT-32 dev drum note ${o} param ${b}: ${n}`),o<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${o}`);return}[()=>{},()=>{e.#m[(y+R[26])*u.dnc+o]=Math.round(n*1.27)},()=>{e.#m[(y+R[26])*u.dnc+o]=n*9+1&127},()=>{e.#m[(y+R[26])*u.dnc+o]=n?127:0}][b]()})}else{let i=t[1];t.subarray(2).forEach((n,c)=>{let d=c+i;e.#B[d]=n;let o=e.chRedir(1+(d>>4),r,!0),b=d&15;([!1,()=>{let y=e.#B[o-1<<4];if(y<3)if(e.#D[o]=1,y==2)for(let k=0;k<name.length;k++)e.#P[(o-1)*u.cmt+k]=e.#_[n*u.cmt+k];else{let k=e.baseBank.get(0,n+(y<<6),127,"mt32").name;for(let x=0;x<k.length;x++)e.#P[(o-1)*u.cmt+x]=k.charCodeAt(x)}e.dispatchEvent("voice",{part:o})},()=>{e.#a[o*u.rpn+3]=n+40,e.#i[u.rpnt*o+2]=1},()=>{e.#a[o*u.rpn+1]=n+14,e.#i[u.rpnt*o+1]=1},()=>{e.#a[o*u.rpn]=n,e.#i[u.rpnt*o]=1},!1,()=>{e.#e[u.cc*o+p[91]]=n?127:0},!1,()=>{e.#e[u.cc*o+p[7]]=n},()=>{e.#e[u.cc*o+p[10]]=Math.ceil(n*9.05)}][b]||(()=>{}))()})}}).add([22,18,4],(t,r,f)=>{e.switchMode("mt32");let s=t[1]+(t[0]<<7),i=[];t.subarray(2).forEach((n,c)=>{let d=c+s,o=e.chRedir(Math.floor(d/246+1),r,!0),b=d%246;b<14&&(e.#P[(o-1)*u.cmt+b]=n),b<10&&(e.#D[o]=1),i.indexOf(o)<0&&i.push(o)}),i.forEach(n=>{e.dispatchEvent("voice",{part:n})})}).add([22,18,5],(t,r,f)=>{e.switchMode("mt32");let s=(t[0]<<7)+t[1];t.subarray(2).forEach((i,n)=>{let c=s+n,d=Math.floor(c/8),o=c&7,b=d*8;e.#re[c]=i,([!1,()=>{let y=e.#re[b];if(y<3){let k="";if(y==2){let P=u.cmt*d;k=`MT-m:${i.toString().padStart(3,"0")}`}else k=e.baseBank.get(0,i+(y<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:d});let x=`MSB	LSB	PRG	NME
000	127	${d}	${k}`;e.userBank.load(x,!0)}}][o]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(t,r,f)=>{e.switchMode("mt32");let s=((t[0]&1)<<7)+t[1],i=t[0]>>1,n=!1;if(t.subarray(2).forEach((c,d)=>{let o=s+d;o<u.cmt&&(e.#_[i*u.cmt+o]=c,n=!0)}),n){e.userBank.clearRange({msb:0,lsb:127,prg:i});let c=`MSB	LSB	PRG	NME
000	127	${i}	MT-m:${i}`;e.userBank.load(c,!0)}e.forceVoiceRefresh()}).add([22,18,16],(t,r,f)=>{e.switchMode("mt32");let s=t[1],i=!1,n=function(c,d){e.#h[d-12]=c,i=!0};t.subarray(2).forEach((c,d)=>{let o=d+s;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,n,n,n,n,n,n,n,n,n,()=>{e.#n=c,e.dispatchEvent("mastervolume",e.#n)}][o]||(()=>{}))(c,d)}),i&&e.buildRchTree()}).add([22,18,32],(t,r,f)=>{e.switchMode("mt32");let s=t[1],i=" ".repeat(s);t.subarray(2).forEach(n=>{n>31?i+=String.fromCharCode(n):i+=" "}),e.#X=i.padStart(20," "),e.#V=Date.now()+3200}).add([22,18,82],(t,r)=>{let f=e.chRedir(0,r,!0);for(let s=0;s<16;s++)e.#f.ano(f+s),s&&s<10&&(e.#s[f+s]=Q[s-1]);console.info("MT-32 alt reset complete.")}),this.#U.add([66,0],(t,r)=>{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(r),2,m.ns5r),e.#l=!1,console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][t[0]]} mode.`)}).add([66,1],(t,r)=>{let f=["ns5r","05rw"][t[0]];e.switchMode(f,!0),e.setPortMode(e.getTrackPort(r),2,m[f]),e.#l=!1}).add([66,18,0,0],(t,r)=>{let f=t[0];switch(f){case 124:case 126:case 127:{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(r),2,m.ns5r),e.#l=!1;break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset: ${t}`);break}default:if(f<10){let s=[0,0,0,0],i=(n,c)=>{s[c]=n};if(t.subarray(1).forEach((n,c)=>{[i,i,i,i,()=>{e.#n=n*129/16383*100,e.dispatchEvent("mastervolume",e.#n)},()=>n-64,()=>n-64,()=>{},()=>{},()=>{}][f+c]()}),t[0]<4){let n=0;s.forEach(c=>{n=n<<4,n+=c}),n-=1024}}}}).add([66,18,0,1],(t,r)=>{}).add([66,18,0,2],(t,r)=>{}).add([66,18,1],(t,r)=>{e.dispatchEvent("mupromptex");let f=e.chRedir(t[0],r,!0),s=f*u.cc,i=t[1],n=`NS5R CH${f+1} `;t.subarray(2).forEach((c,d)=>{let o=i+d;o<3?([()=>{e.#e[s+p[0]]=c||A.bank0},()=>{e.#e[s+p[32]]=c},()=>{e.#s[f]=c}][o](),e.dispatchEvent("voice",{part:f})):o<8||(o<14?[()=>{let b=e.chRedir(c,r,!0);e.#h[f]=b,f!=b&&(e.buildRchTree(),console.info(`${n}receives from CH${b+1}`))},()=>{e.#v[f]=+!c},()=>{e.setChType(f,c,m.ns5r),console.debug(`${n}type: ${I[c]}`)},()=>{e.#a[u.rpn*f+3]=c,e.#i[u.rpnt*f+2]=1,e.dispatchEvent("pitch",{part:f,pitch:e.getPitchShift(f)})},()=>{},()=>{}][o-8]():o<16||(o<33?[()=>{e.#e[s+p[7]]=c},()=>{e.#e[s+p[11]]=c},()=>{},()=>{},()=>{e.#e[s+p[10]]=c||128},()=>{},()=>{},()=>{e.#e[s+p[93]]=c},()=>{e.#e[s+p[91]]=c},()=>{e.#e[s+p[76]]=c},()=>{e.#e[s+p[77]]=c},()=>{e.#e[s+p[78]]=c},()=>{e.#e[s+p[74]]=c},()=>{e.#e[s+p[71]]=c},()=>{e.#e[s+p[73]]=c},()=>{e.#e[s+p[75]]=c},()=>{e.#e[s+p[72]]=c}][o-16]():o<112||o<114&&[()=>{e.#e[s+p[5]]=c},()=>{e.#e[s+p[65]]=c}][o-112]()))})}).add([66,18,8,0],(t,r)=>{let f=t[0];if(f<32)e.setLetterDisplay(t.subarray(1,33),"NS5R letter display");else{let s=f-32;e.#M=Date.now()+3200,e.#g=10,e.#$.fill(0);let i=t.subarray(1),n=4;i.forEach(function(c,d){let o=d+s,b=o>>4,y=o&15;if(o<80){let k=b<n?c:c>>3,x=0,P=b<n?6:3;for(;k>0;)e.#$[y*32+b*7+(P-x)]=k&1,k=k>>1,x++}})}}).add([66,18,48],(t,r,f)=>{g(0,t)}).add([66,18,49],(t,r,f)=>{g(1,t)}).add([66,18,50],(t,r,f)=>{g(2,t)}).add([66,18,51],(t,r,f)=>{g(3,t)}).add([66,18,52],(t,r,f)=>{g(4,t)}).add([66,18,53],(t,r,f)=>{g(5,t)}).add([66,18,54],(t,r,f)=>{g(6,t)}).add([66,18,55],(t,r,f)=>{g(7,t)}).add([66,52],(t,r)=>{e.switchMode("ns5r"),e.#l=!1;let f="";M(t,(s,i)=>{i<8?(s>31&&(f+=String.fromCharCode(s)),i==7&&(e.aiEfxName=f)):i<10&&(e.setEffectType(i-8,44,s),e.dispatchEvent(`efx${["reverb","chorus"][i-8]}`,e.getEffectType(i-8)))})}).add([66,53],(t,r)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r"),e.#l=!1;let f="",s=t[t.length-1],i=t.subarray(0,t.length-1),n=O(i);n!=s&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${n}, got ${s}.`),console.debug(t));let c=e.getTrackPort(r);if(e.#d[c]&&e.#d[c]!=m.ns5r)if(e.#A.dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${r}. Port ${String.fromCharCode(65+c)} mode "${S[e.#d[c]]}" mismatch, should be "ns5r".`);return}else console.info(`Track ${r} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+c)}.`);e.setPortMode(c,2,m.ns5r),M(i,function(d,o){switch(!0){case o<2944:{let b=e.chRedir(Math.floor(o/92),r,!0),y=b*u.cc;switch(o%92){case 0:{e.#e[y+p[0]]=d,e.dispatchEvent("voice",{part:b});break}case 1:{e.#e[y+p[32]]=d,!d&&!e.#e[y+p[0]]&&(e.#e[y+p[0]]=A.bank0),e.dispatchEvent("voice",{part:b});break}case 2:{e.#s[b]=d,d>0&&e.setChActive(b,1),e.dispatchEvent("voice",{part:b});break}case 3:{let k=e.chRedir(d,r,!0);e.#h[b]=k,b!=k&&(console.info(`NS5R CH${b+1} receives from CH${k+1}.`),e.buildRchTree());break}case 7:{e.#r[b]=d,e.dispatchEvent("voice",{part:b});break}case 8:{e.#a[b*u.rpn+3]=d<40||d>88?d+(d>63?-192:64):d,e.#i[u.rpnt*b+2]=1,e.dispatchEvent("pitch",{part:b,pitch:e.getPitchShift(b)});break}case 9:case 10:{e.#e[y+p[7]]=d;break}case 11:{e.#e[y+p[11]]=d;break}case 14:{e.#e[y+p[10]]=d||128;break}case 19:{e.#e[y+p[93]]=d;break}case 20:{e.#e[y+p[91]]=d;break}case 84:{e.#e[y+p[65]]=d;break}case 85:{e.#e[y+p[5]]=d;break}}break}case o<3096:break;case o<3134:{let b=o-3096;b<8?(d>31&&(f+=String.fromCharCode(d)),b==7&&(e.aiEfxName=f)):b<10&&(e.setEffectType(b-8,44,d),e.dispatchEvent(`efx${["reverb","chorus"][b-8]}`,e.getEffectType(b-8)));break}case o<8566:break}})}).add([66,54],(t,r)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r");let f="",s=80,i=0,n=0,c="MSB	PRG	LSB	NME";M(t,function(d,o){let b=o%158;switch(!0){case b<10:{d>31&&(f+=String.fromCharCode(d));break}case b==10:break;case b==11:{s=d&127;break}case b==12:{n=d&127;break}case b==13:{c+=`
${s}	${i}	${n}	${f.trim().replace("Init Voice","")}`,i++,f="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(c),w()&&console.debug(c),e.forceVoiceRefresh()}).add([66,55],(t,r)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r");let f="",s=88,i=0,n=0,c="MSB	PRG	LSB	NME";M(t,function(d,o){let b=o%126;switch(!0){case b<10:{d>31&&(f+=String.fromCharCode(d));break}case b==11:break;case b==12:break;case b==13:{c+=`
${s}	${i}	${n}	${f.trim().replace("Init Combi","")}`,i++,f="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(c),w()&&console.debug(c),e.forceVoiceRefresh()}).add([66,125],(t,r,f)=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][t[0]]||"white")}).add([66,127],(t,r,f)=>{let s=t[t.length-1],i=t.subarray(0,t.length-1),n=O(i);n!=s&&(console.info(`NS5R screen dump checksum mismatch! Expected ${n}, got ${s}.`),console.debug(t));let c=new Uint8Array(5760);M(t,(d,o,b)=>{if(o<720)for(let y=0;y<8;y++)c[o*8+y]=d>>7-y&1}),e.dispatchEvent("screen",{type:"ns5r",data:c})}).add([76],(t,r,f)=>{e.#U.run([66,...t],r,f)}),this.#J.add([16,0,8,0],(t,r,f)=>{let s=(t[2]<<4)+t[3],i="K11 ";([()=>{e.switchMode("k11",!0),e.setPortMode(e.getTrackPort(r),2,m.k11),e.#l=!1,e.#o[m.k11][1]=s?4:0,console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,s),console.debug(`${i}reverb type: ${s}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{console.debug(`${i}reverb time: ${s}`)},()=>{console.debug(`${i}reverb time: ${s}`)},()=>{console.debug(`${i}reverb predelay: ${s}`)},()=>{console.debug(`${i}reverb predelay: ${s}`)},()=>{console.debug(`${i}depth high: ${s}`)},()=>{console.debug(`${i}depth high: ${s}`)},()=>{console.debug(`${i}depth low: ${s}`)},()=>{console.debug(`${i}depth low: ${s}`)}][t[0]]||(()=>{}))()}).add([16,0,8,1],(t,r,f)=>{e.dispatchEvent("mupromptex");let s=e.chRedir(t[1],r,!0),i=u.cc*s,n=u.rpn*s,c=(t[3]<<4)+t[4],d=`K11 CH${s+1} `;([()=>{c<128?(e.setChType(s,e.CH_MELODIC,m.k11),e.#e[i+p[0]]=0,e.#s[s]=c):(e.setChType(s,e.CH_DRUMS,m.k11),e.#s[s]=c-128),e.dispatchEvent("voice",{part:s})},()=>{let o=e.chRedir(c,r,!0);e.#h[s]=o,s!=o&&(e.buildRchTree(),console.info(`${d}receives from CH${o+1}`))},()=>{e.#e[i+p[7]]=c},()=>{uupThis.setChActive(s,c)},()=>{e.#e[i+p[10]]=c},()=>{e.#a[n+3]=c+40,e.#i[u.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{e.#a[n+1]=c>>1,e.#a[n+2]=c&1,e.#i[u.rpnt*s+1]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{e.#e[i+p[91]]=c?127:0},()=>{},()=>{e.#e[i+p[74]]=c},()=>{e.#e[i+p[73]]=c},()=>{e.#e[i+p[72]]=c}][t[0]]||(()=>{}))()}).add([16,0,9,0],(t,r,f)=>{e.dispatchEvent("mupromptex");let s=(t[2]<<4)+t[3],i="GMLX ";([()=>{console.debug(`${i}reverb type: ${s}`)},()=>{console.debug(`${i}reverb time: ${s}`)},()=>{console.debug(`${i}reverb predelay: ${s}`)},()=>{console.debug(`${i}depth high: ${s}`)},()=>{console.debug(`${i}depth low: ${s}`)}][t[0]]||(()=>{}))()}).add([16,0,9,3],(t,r,f)=>{e.dispatchEvent("mupromptex");let s=(t[2]<<4)+t[3],i=e.chRedir(t[1],r,!0),n=i*u.cc;[()=>{s<128?(e.setChType(i,e.CH_MELODIC,m.k11),e.#e[n+p[0]]=0,e.#e[n+p[32]]=0,e.#s[i]=s):s<160?(e.setChType(i,e.CH_MELODIC,m.k11),e.#e[n+p[0]]=0,e.#e[n+p[32]]=7,e.#s[i]=s-100):(e.setChType(i,e.CH_DRUMS,m.k11),e.#e[n+p[0]]=122,e.#e[n+p[32]]=0,e.#s[i]=s-160),e.dispatchEvent("voice",{part:i})},()=>{let c=e.chRedir(s,r,!0);e.#h[i]=c,i!=c&&(e.buildRchTree(),console.info(`GMLX CH${i+1} receives from CH${c+1}`))}][t[0]]()}).add([16,0,9,4],(t,r,f)=>{e.dispatchEvent("mupromptex");let s=(t[2]<<4)+t[3],i=e.chRedir(t[1],r,!0),n=i*u.cc,c=i*u.rpn,d=`GMLX CH${i+1} `;[()=>{e.setChActive(i,s)},()=>{e.#e[n+p[7]]=s},()=>{e.#e[n+p[10]]=s},()=>{e.#e[n+p[91]]=s?127:0},()=>{e.#a[c+3]=s+40,e.#i[u.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{e.#a[c+1]=s,e.#i[u.rpnt*i+1]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{e.#a[c]=s,e.#i[u.rpnt*i]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{}][t[0]]()}),this.#Z.add([66,93,64],(t,r,f)=>{let s=t[2];switch(t[0]){case 0:{switch(t[1]){case 4:{e.dispatchEvent("mupromptex"),e.#n=s*129/16383*100,e.dispatchEvent("mastervolume",e.#n);break}case 5:{e.dispatchEvent("mupromptex"),s-64;break}case 6:{e.dispatchEvent("mupromptex"),console.debug(`SG global reverb: ${s?"on":"off"}`);break}case 127:{e.switchMode("sg",!0),e.setPortMode(e.getTrackPort(r),1,m.sg);break}}break}case 1:{switch(t[1]){case 48:{e.dispatchEvent("mupromptex"),console.debug(`SG reverb type: ${z[s]}`);break}}break}default:if(t[0]>>4==1){e.dispatchEvent("mupromptex");let i=e.chRedir(t[0]&15,r,!0);if(t[1]==2){let n=e.chRedir(s,r,!0);e.#h[i]=n,i!=n&&(e.buildRchTree(),console.info(`SG CH${i+1} receives from CH${n+1}`))}else t[1]==19&&(e.#e[u.cc*i+p[7]]=s)}else console.warn(`Unknown AKAI SG SysEx: ${t}`)}}),this.#ee.add([9],(t,r,f)=>{e.dispatchEvent("mupromptex"),console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremolo","phaser","rotary speaker","enhancer","flanger","EQ"][t[0]]||"off"}`)}),this.#S.add([127,0],(t,r,f)=>{e.switchMode("motif");let s=new Uint8Array([127,1,...t]);e.#S.run(s,r,f)}).add([127,1,0,0],(t,r,f)=>{e.switchMode("s90es");let s="S90/Motif ES system ",i=t[0];t.subarray(1).forEach((n,c)=>{([()=>{e.#n=n*12900/16383,e.dispatchEvent("mastervolume",e.#n)}][i+c]||(()=>{console.info(`Unrecognized ${s}ID: ${i+c}`)}))()})}).add([127,1,0,36,54,1],(t,r,f)=>{e.switchMode("s90es");let s="S90/Motif ES reverb ",i=t[0];t.subarray(1).forEach((n,c)=>{([()=>{e.setEffectTypeRaw(0,!1,n&15|112)},()=>{e.setEffectTypeRaw(0,!0,n)}][i+c]||(()=>{}))()}),e.dispatchEvent("efxreverb",e.getEffectType(0))}).add([127,1,0,37,54,2],(t,r,f)=>{e.switchMode("s90es");let s="S90/Motif ES chorus ",i=t[0];t.subarray(1).forEach((n,c)=>{([()=>{e.setEffectTypeRaw(1,!1,n&15|112)},()=>{e.setEffectTypeRaw(1,!0,n)}][i+c]||(()=>{}))()}),e.dispatchEvent("efxchorus",e.getEffectType(1))}).add([127,1,0,34,54,3],(t,r,f)=>{e.switchMode("s90es");let s="S90/Motif ES insert 1 ",i=t[0];t.subarray(1).forEach((n,c)=>{([()=>{e.setEffectTypeRaw(3,!1,n&15|112)},()=>{e.setEffectTypeRaw(3,!0,n)}][i+c]||(()=>{}))()}),e.dispatchEvent("efxinsert0",e.getEffectType(3))}).add([127,1,0,34,54,4],(t,r,f)=>{e.switchMode("s90es");let s="S90/Motif ES insert 2 ",i=t[0];t.subarray(1).forEach((n,c)=>{([()=>{e.setEffectTypeRaw(4,!1,n&15|112)},()=>{e.setEffectTypeRaw(4,!0,n)}][i+c]||(()=>{}))()}),e.dispatchEvent("efxinsert1",e.getEffectType(4))}).add([127,1,0,35,54,17],(t,r,f)=>{e.switchMode("s90es");let s="S90/Motif ES variation ",i=t[0];t.subarray(1).forEach((n,c)=>{([()=>{e.setEffectTypeRaw(2,!1,n&15|112)},()=>{e.setEffectTypeRaw(2,!0,n)}][i+c]||(()=>{}))()}),e.dispatchEvent("efxdelay",e.getEffectType(2))}).add([127,1,0,58,55],(t,r,f)=>{e.dispatchEvent("mupromptex"),e.switchMode("s90es");let s=e.getTrackPort(r);if(e.#d[s]&&e.#d[s]!=e.#c.smotif)if(e.#A.dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${r}. Port ${String.fromCharCode(65+s)} mode "${S[e.#d[s]]}" mismatch, should be "${S[e.#c.smotif]}".`);return}else console.info(`Track ${r} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);let i=e.chRedir(t[0],r,!0),n=u.cc*i,c=t[1];t[0]>15&&(i=t[0]+32);let d=`Track ${r} S90/Motif ES bulk CH${i<128?i+1:"U"+(i-127)} `;console.debug(d,t),!(t[0]>15)&&t.subarray(2).forEach((o,b)=>{([()=>{e.#e[n+p[0]]=o,e.dispatchEvent("voice",{part:i})},()=>{o&&e.setChActive(i,1),e.#e[n+p[32]]=o,e.setChType(i,[32,40].indexOf(o)>-1?e.CH_DRUMS:e.CH_MELODIC,e.#t,!0),e.dispatchEvent("voice",{part:i})},()=>{o&&e.setChActive(i,1),e.#s[i]=o,e.dispatchEvent("voice",{part:i})},()=>{let y=e.chRedir(o,r,!0);e.#h[i]=y,i!=y&&(e.buildRchTree(),console.info(`${d}receives from CH${y+1}`))},()=>{e.#v[i]=o?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{o!=100&&e.setChActive(i,1),e.#e[n+p[7]]=o},()=>{o!=64&&e.setChActive(i,1),e.#e[n+p[10]]=o},!1,!1,!1,()=>{e.#e[n+p[91]]=o},()=>{o&&e.setChActive(i,1),e.#e[n+p[93]]=o},()=>{o&&e.setChActive(i,1),e.#e[n+p[94]]=o},()=>{o!=127&&e.setChActive(i,1),e.#e[n+p[128]]=o,e.allocateAce(i,128)},()=>{},()=>{o!=64&&e.setChActive(i,1),e.#e[n+p[74]]=o},()=>{o!=64&&e.setChActive(i,1),e.#e[n+p[71]]=o},!1,()=>{e.#e[n+p[65]]=o},()=>{e.#e[n+p[5]]=o},()=>{}][c+b]||(()=>{}))()})}).add([127,1,54,16],(t,r,f)=>{e.switchMode("s90es");let s=t[0];t.subarray(1).forEach((i,n)=>{let d=`S90/Motif ES EQ${(n>>2)+1} `;([()=>{let o=i-64},()=>{let o=L[i]},()=>{let o=i/10},()=>{let o=i}][s+n&3]||(()=>{}))()})}),this.#T.add([0,72,18,0,0,0,0],(t,r,f)=>{e.switchMode("sd",!0),e.setPortMode(e.getTrackPort(r),2,m.sd),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(t,r,f)=>{e.dispatchEvent("mupromptex");let s=t[0]>>5,i=t[0]&31;switch(s){case 0:{let n=t[0]>>1,c=t[1];switch(n){case 1:{t.subarray(2).forEach((d,o,b)=>{let y=o+c;switch(y){case 0:{d&&(e.setEffectType(1,60,d-1),e.dispatchEvent("efxchorus",e.getEffectType(1)),console.debug(`SD MFX Cho: ${y} - ${d}`));break}}});break}case 2:{t.subarray(2).forEach((d,o)=>{let b=o+c;switch(b){case 0:{d&&(e.setEffectType(0,55+d,0),e.dispatchEvent("efxreverb",e.getEffectType(0)),console.debug(`SD MFX Rev: ${b} - ${d}`));break}}});break}case 3:case 4:case 5:{let d=n-1;t.subarray(2).forEach((o,b)=>{let y=b+c;switch(console.debug(`SD MFX ${d-2}: ${y} - ${o}`),y){case 0:{e.setEffectTypeRaw(d,62,o),e.dispatchEvent(`efx${d>2?"delay":"insert"+(d-4)}`,e.getEffectType(d));break}}}),console.debug(`SD MFX message:
%o`,t);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,t)}break}case 1:{let n=e.chRedir(i,r,!0),c=t[1],d=n*u.cc;t.subarray(2).forEach((o,b)=>{let y=c+b;y<37?([()=>{},()=>{},0,()=>{},()=>{switch(e.#e[d+p[0]]=o,o){case 104:case 105:case 106:case 107:case 120:{e.#r[n]||e.setChType(n,e.CH_DRUMS);break}default:e.#r[n]&&e.setChType(n,e.CH_MELODIC)}e.dispatchEvent("voice",{part:n})},()=>{e.#e[d+p[32]]=o,e.dispatchEvent("voice",{part:n})},()=>{e.#s[n]=o,e.dispatchEvent("voice",{part:n})},()=>{e.#e[d+p[7]]=o},()=>{e.#e[d+p[10]]=o},()=>{},()=>{},()=>{o<2&&(e.#v[n]=o)},()=>{o<2&&(e.#e[d+p[68]]=o?127:0)},()=>{},()=>{o<2&&(e.#e[d+p[65]]=o?127:0)},()=>{e.#e[d+p[5]]=o&15<<4|e.#e[d+p[5]]&15},()=>{e.#e[d+p[5]]=o&15|(e.#e[d+p[5]]&240)>>4},()=>{e.#e[d+p[74]]=o},()=>{e.#e[d+p[71]]=o},()=>{e.#e[d+p[73]]=o},()=>{e.#e[d+p[72]]=o},0,0,0,0,0,0,0,()=>{e.#e[d+p[128]]=o,e.allocateAce(128)},()=>{e.#e[d+p[93]]=o},()=>{e.#e[d+p[91]]=o},0,0,()=>{e.#e[d+p[75]]=o},()=>{e.#e[d+p[76]]=o},()=>{e.#e[d+p[77]]=o},()=>{e.#e[d+p[78]]=o}][y]||(()=>{}))():y<63||(y<64?(e.#r[n]?e.#e[d+p[0]]=104|o:e.#e[d+p[0]]=96|o,e.dispatchEvent("voice",{part:n})):console.debug(`Unknown SD-90 global CH${n+1} param setup message:
%o`,t))});break}case 2:{let n=e.chRedir(i,r,!0),c=t[1];console.debug(`Unknown SD-90 global CH${n+1} MIDI setup message:
%o`,t.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,t)}}),e.#U.add([0,1,73,78],(t,r,f)=>{e.switchMode("krs"),e.setPortMode(e.getTrackPort(r),1,m.krs),console.debug("Might be KORG KROSS 2 mode reset... Not sure.")}).add([0,1,73,117,2,37],(t,r,f)=>{e.switchMode("krs");let s=e.getTrackPort(r);if(e.#d[s]&&e.#d[s]!=m.krs)if(e.#A.dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled. Port ${String.fromCharCode(65+s)} mode "${S[e.#d[s]]}" mismatch, should be "krs".`);return}else console.info(`Track ${r} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);e.setPortMode(e.getTrackPort(r),1,m.krs);let i="KROSS 2 BMT1 ",n="";M(t,(c,d)=>{if(d<24)n+=String.fromCharCode(Math.max(32,c));else if(!(d<1276)){let o=d-1276,b=e.chRedir(Math.floor(o/44),r,!0),y=o%44,k=u.cc*b;y<15?([()=>{c&&e.setChActive(b,1),e.#s[b]=c,e.dispatchEvent("voice",{part:b})},()=>{c&&e.setChActive(b,1),c<10?(e.#e[k+p[0]]=63,e.#e[k+p[32]]=c):c<20?(e.#e[k+p[0]]=121,e.#e[k+p[32]]=c-10):c<24&&(e.#e[k+p[0]]=[120,0,56,62][c-20],e.#e[k+p[32]]=0),e.dispatchEvent("voice",{part:b})},()=>{let x=e.chRedir(c&15,r,!0);e.#h[b]=x,console.info(`${i}CH${b+1} receives from CH${x+1}`)},!1,!1,()=>{e.#e[k+p[7]]=c},!1,()=>{},()=>{},!1,!1,!1,!1,!1,()=>{e.#e[k+p[10]]=c||128}][y]||(()=>{}))():y<36||([()=>{e.#e[k+p[74]]=(c+128&255)-64},()=>{e.#e[k+p[71]]=(c+128&255)-64},!1,!1,()=>{e.#e[k+p[73]]=(c+128&255)-64},()=>{e.#e[k+p[75]]=(c+128&255)-64},!1,()=>{e.#e[k+p[72]]=(c+128&255)-64}][y]||(()=>{}))()}}),n=n.trimRight(),e.dispatchEvent("metacommit",{type:"EORTitle",data:n})})}};export{et as OctaviaDevice,u as allocated,p as ccToPos,R as dnToPos,A as overrides};
