var re=function(e,t){let l=Math.min(e.length,t.length),f=e.slice(0,l),u=t.slice(0,l),g=0,C=0;for(;C<l&&g==0;)g=Math.sign(f[C]-u[C]),C++;return g},D=function(e=""){this.name=e,this.pool=[],this.point=function(t,l=!1){if(this.pool.length>0){let f=this.pool.length,u=1<<Math.floor(Math.log2(f)),g=u,C=64;for(;u>=1&&C>=0;){if(C<=0)throw new Error("TTL reached.");if(g==f)g-=u;else{let k=re(t,this.pool[g]);switch(k){case 0:{C=0;break}case 1:{g+u<=f&&(g+=u);break}case-1:{g!=0&&(g-=u);break}default:console.warn(`Unexpected result ${k}.`)}}u=u>>1,C--}let $=!0;if(g>=this.pool.length)$=!1;else{let k=this;this.pool[g].forEach(function(a,o,i){$&&a!=t[o]&&($=!1)}),!$&&re(t,this.pool[g])>0&&g++}return $||l?g:-1}else return l?0:-1},this.add=function(t,l){return t.data=l,this.pool.splice(this.point(t,!0),0,t),this},this.default=function(t){console.warn(`No match in "${this.name||"(unknown)"}" for "${t}". Default action not defined.`)},this.get=function(t){let l=this.point(t);if(l>-1)return this.pool[l].data;this.default(t)},this.run=function(t,...l){let f=this.point(t);f>-1?t.subarray?this.pool[f].data(t.subarray(this.pool[f].length),...l):this.pool[f].data(t.slice(this.pool[f].length),...l):this.default(t,...l)}};var se=class{#t={};addEventListener(e,t){this.#t[e]||(this.#t[e]=[]),this.#t[e].unshift(t)}removeEventListener(e,t){if(this.#t[e]){let l=this.#t[e].indexOf(t);l>-1&&this.#t[e].splice(l,1),this.#t[e].length<1&&delete this.#t[e]}}dispatchEvent(e,t){let l=new Event(e),f=this;l.data=t,this.#t[e]?.length>0&&this.#t[e].forEach(function(u){try{u?.call(f,l)}catch(g){console.error(g)}}),this[`on${e}`]&&this[`on${e}`](l)}};var Se=["MSB","PRG","LSB","NME","ELC","DRM","LVL"],Te={krs:"KR",s90es:"ES",motif:"ES"},Me={krs:"Kr",s90es:"SE",motif:"ME"},Q=function(e){let t=Math.floor(e/10),l=e%10;return`${t.toString(16)}${l}`},Y=class{#t;get bankInfo(){return this.#t}strictMode=!1;get(e=0,t=0,l=0,f,u=0){let g=[e,t,l],C,$=1,k=0,a,o,i=Array.from(arguments);switch(f){case"xg":{switch(e){case 0:{l===126?i[2]=125:l===127&&(i[2]=0);break}case 16:{l===126&&(i[2]=0);break}case 32:{l>125&&(i[2]=0),i[2]+=4;break}case 33:{(l>125||l===3)&&(i[2]=0),i[2]+=5;break}case 34:case 35:case 36:{l>125&&(i[2]=0),i[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:i[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{l===126&&(i[2]=0);break}case 48:case 64:case 126:case 127:{l===126&&(e===127&&t===0||(i[2]=0));break}}break}case"gs":case"sc":{e===0&&l<5?i[0]=49:e>125&&l<5&&l!=2&&(i[2]=e,i[0]=49);break}case"mt32":{e===0&&(i[0]=49);break}case"sd":{switch(e){case 121:{i[0]=96;break}case 120:{i[0]=104;break}}i[0]>>1===40?i[2]|=16:i[0]>95&&i[0]<100&&(i[2]|=16,t>>4===7&&(i[0]=96));break}case"g2":{e>>1===40?i[2]|=16:e>95&&e<100&&(i[2]|=16,t>>4===7&&(i[0]=96));break}case"sg":{e===8&&l===0&&(i[2]=5);break}case"05rw":case"x5d":{e&&e<56&&(i[0]=56);break}case"s90es":{if(e===0)break;l<8?i[2]+=17:l<32?i[2]+=13:i[2]=(i[2]>>3)+19;break}case"motif":{if(e===0)break;l<8?i[2]+=28:l<32?i[2]+=13:i[2]=(i[2]>>3)+19;break}}let r=" ",s="M",c="",n=0,d=0;switch(i[0]){case 0:{switch(i[2]){case 127:{s="GM-a";break}case 126:{s="GM-n";break}case 7:{s="GM-k",c="GLX";break}case 5:{s="SG-a",c="000";break}case 4:{f==="gs"||f==="sc"?(s="GM-a",c="000"):(s="SP-l",c="C/M");break}case 3:case 2:case 1:{(f==="gs"||f==="sc")&&(s="GM-a",c="000");break}case 0:{s="GM-a";break}default:s="y",n=3}break}case 8:{f==="sg"?s="GM-s":s="r:";break}case 32:case 33:case 34:case 35:case 36:{f==="xg"&&(s=`${["AP","VL","PF","DX","AN"][e&7]}-${"abcdefgh"[l]}`,n=3);break}case 48:{c=`M${(i[2]>>3).toString().padStart(2,"0")}`,s=`y${c}`,n=1;break}case 49:{i[2]>>1===63?(s=`MT-${"ba"[i[2]&1]}`,c=`C${"-/"[i[2]&1]}M`):(s="GM-a",c="000");break}case 56:{s="GM-b";break}case 57:s=["yDOC","QY10","QY20"][i[2]-112]||"yMxv",c=["DOC","QY1","QY2"][i[2]-112]||"057";case 61:case 120:{s="rDrm";break}case 62:{s="kDrm";break}case 63:{if(i[2]<17){let v=i[2];s=v<10?"kP:":"kC:",s+=v%10}else i[2]<34?s=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][i[2]-17]:s="Ds";n=1;break}case 64:{s="ySFX",c="SFX";break}case 67:{s="DX:S";break}case 80:case 81:case 82:case 83:{s=`Prg${"UABC"[i[0]-80]}`;break}case 88:case 89:case 90:case 91:{s=`Cmb${"UABC"[i[0]-88]}`;break}case 95:{s=`${["DR","PC"][i[2]]}-d`;break}case 96:{s=i[2]===106?"AP-a":i[2]>>4===1?"SDg":"PF",i[2]>63?d=63:i[2]>>4===1&&(d=16),n=3;break}case 97:{s=i[2]>>4===1?"SDa":"VL:",n=3,i[2]>>4===1?d=16:d=112;break}case 98:{s=i[2]>>4===1?"SDb":"SG-a",n=3,d=16;break}case 99:{s=i[2]>>4===1?"SDc":"DX",i[2]>63?d=63:i[2]>>4===1&&(d=16),n=3;break}case 100:{s="AN",i[2]>63?d=63:i[2]>>4===1&&(d=16),n=3;break}case 104:case 105:case 106:case 107:{s="SDd",d=104;break}case 121:{s=`GM-${i[2]?"":"a"}`,n=3;break}case 122:{s="lDrm";break}case 126:{s="yDrS";break}case 127:{i[2]===127?s="rDrm":s="yDrm";break}default:i[0]<48?s="r:":s="M"}s.length<4&&(s+=`${[e,l,i[0],i[2]][n]-d}`.padStart(4-s.length,"0")),c.length<3&&(c+=`${[e,l,e,l][n]}`.padStart(3-c.length,"0")),f==="xg"&&(e===0?i[2]<100?s=s.replace("y0","y:"):i[2]===125&&(s="y126"):e===16?(C=`Voice${((i[2]<<7)+i[1]+1).toString().padStart(3,"0")}`,r=" "):e===35&&l>>1===2&&(C=`DXCH_${(((i[2]&1)<<7)+t+1).toString().padStart(3,"0")}`,r=" "));let h=[i[0],i[1],i[2]];for(;!(C?.length>=0);)if(C=this.#t[i[1]||0][(i[0]<<8)+i[2]]?.name,C){let v=this.#t[i[1]||0][(i[0]<<8)+i[2]];$=v?.poly||$,k=v?.type||k,a=v?.drum,o=v?.level}else if(this.strictMode)C="",r="?";else if(i[0]===0&&i[1]===0&&i[2]===0)C="Unloaded";else if(this.#t[i[1]||0][i[0]<<8])i[0]===0?(i[2]=0,r="^"):i[2]<1?(i[0]=0,r="*"):(i[2]--,r="^");else if(e===48)i[0]=0,i[2]=0,r="!";else if(e===62)i[1]--,r=" ",i[1]<1&&!C?.length&&(i[0]=0,r="!");else if(e<63)i[0]===0?(i[2]=0,r="^"):i[2]<1?(i[0]=0,r="*"):i[2]--;else if(e===80)C=`PrgU:${t.toString().padStart(3,"0")}`,r="!";else if(e===88)C=`CmbU:${t.toString().padStart(3,"0")}`,r="!";else if(e===121)C=`GM2Vox0${l}`,r="#";else if(e===122)if(i[1]===32?i[1]:i[1]%=7,C=this.#t[i[1]||0][(i[0]<<8)+i[2]]?.name,C){r=" ";let v=this.#t[i[1]||0][(i[0]<<8)+i[2]];$=v?.poly||$,k=v?.type||k,a=v?.drum,o=v?.level}else C="",r="*";else i[1]===0?(C=`${e.toString().padStart(3,"0")} ${t.toString().padStart(3,"0")} ${l.toString().padStart(3,"0")}`,r="!"):i[0]===0?(i[2]=0,r="^"):i[2]>0?i[2]--:i[1]>0?(i[1]=0,r="!"):(i[0]=0,r="?");let b=[i[0],i[1],i[2]];switch(r){case"^":{switch(f){case"gs":case"sc":case"ns5r":{r=" ";break}}e===127&&r==="^"&&(r=" ");break}}let E="??";switch(i[0]){case 0:{i[2]===0?E="GM":i[2]===5||i[2]===7?E="KG":i[2]<126&&(E="XG");break}case 32:case 33:case 35:case 36:{i[2]>4?E=["AP","VL","PF","DX","AN"][i[0]-32]:E="GS";break}case 48:{E="MU";break}case 49:{i[2]>>1===63?E="MT":i[2]<5&&(E="GM");break}case 56:{E="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{E="AI";break}case 62:case 82:case 90:{E="XD";break}case 63:{i[2]<17?E="KR":i[2]<34?E="ES":E="DS";break}case 64:case 126:{E="XG";break}case 67:case 99:{E=i[2]>>4===1?"SD":"DX";break}case 81:{E="RW";break}case 95:{E=["DR","PC"][i[2]];break}case 96:{E=i[2]===106?"AP":i[2]>>4===1?"SD":"PF";break}case 97:{E=i[2]>>4===1?"SD":"VL";break}case 98:{E=i[2]>>4===1?"SD":"SG";break}case 100:{E="AN";break}case 104:case 105:case 106:case 107:{E="SD";break}case 120:{E=t===0?"GM":"GS";break}case 121:{E=i[2]?"G2":"GM";break}case 122:{E="KG";break}case 127:{E=i[2]===127?"MT":t===0?"GM":"XG";break}default:i[0]<48&&(i[0]===16&&f==="xg"?E="XG":E="GS")}if(r!=" ")switch(f){case"krs":case"s90es":case"motif":{C="",E=Te[f];break}default:self.debugMode&&(C="")}return{name:C||`${Me[f]||f.toUpperCase()}${Q(e||0)}${Q(t||0)}${Q(l||0)}`,poly:$,type:k,drum:a,level:o,iid:h,eid:b,sid:g,ending:r,sect:s,bank:c,standard:E,mode:f}}async load(e,t,l="(internal)",f){let u=this,g=[],C=0,$=0,k=0;e.split(`
`).forEach(function(a,o){let i=a.split("	"),r=[];if(o===0){if(i.forEach(function(s,c){g[Se.indexOf(s)]=c}),g.length<4){console.debug("Debugger launched.");debugger}}else{let s=0,c=0,n=0,d,h=1,b=0,E,v;i.forEach(function(M,W){switch(W){case g[0]:{s=parseInt(M);break}case g[1]:{c=parseInt(M);break}case g[2]:{n=parseInt(M);break}case g[3]:{d=M;break}case g[4]:{M=parseInt(M),M<16?h=M+1:(b=(M&15)+1,h=b);break}case g[5]:{v=M;break}case g[6]:{M?.constructor&&(E=parseInt(M));break}}}),u.#t[c]=u.#t[c]||[];let x=u.#t[c],R={msb:s,prg:c,lsb:n,name:d,poly:h,type:b,drum:v,level:E,priority:f},O=!1;f<x[s<<8|n]?.priority&&(O=!0,k++),(!x[s<<8|n]||O||t)&&(x[s<<8|n]=R,C++),$++}}),t||console.debug(`Map "${l}": ${$} total, ${C} loaded (${C-k} + ${k}).`)}clearRange(e){let t=e.prg!=null?e.prg.constructor===Array?e.prg:[e.prg,e.prg]:[0,127],l=e.msb!=null?e.msb.constructor===Array?e.msb:[e.msb,e.msb]:[0,127],f=e.lsb!=null?e.lsb.constructor===Array?e.lsb:[e.lsb,e.lsb]:[0,127];for(let u=l[0];u<=l[1];u++){let g=u<<8;for(let C=f[0];C<=f[1];C++){let $=g+C;for(let k=t[0];k<=t[1];k++)delete this.#t[k][$]}}}init(){this.#t=[];for(let e=0;e<128;e++)this.#t.push([""])}async loadFiles(...e){this.init();let t=this;e.forEach(async function(l,f){try{t.load(await(await fetch(`./data/bank/${l}.tsv`)).text(),!1,l,f)}catch{console.error(`Failed loading "${l}.tsv".`)}})}constructor(...e){this.loadFiles(...e)}};var ie=class{#t={};context;set(e,t){this.#t[e]=t}has(e){return!!this.#t[e]}async read(e,t){if(!this.has(e))throw new Error(`No decoder registered for "${e}"`);return await this.#t[e].call(this.context||this,t)}};var Re=function(e,t){let l=!0;return t.forEach((f,u)=>{l=l&&e[u]===f}),l},I=function(e){let t=0;return e.forEach(l=>{t*=256,t+=l}),t},N=new TextDecoder,B=new ie;B.set("s7e",async function(e){let t=new Uint8Array(await e.slice(0,65536).arrayBuffer()),l="MSB	LSB	PRG	NME",f=[0,0,0,0],u=32,g=0,C=0,$=!0,k=[],a=0;for(;$;){let o=t.subarray(g);([()=>{N.decode(o.subarray(0,4))==="YSFC"?(g+=80,C=1):g++},()=>{if(Re(o.subarray(0,4),f))k.forEach((i,r,s)=>{let c=I(t.subarray(i.start+4,i.start+8));i.length=c}),C=2;else{let i=N.decode(o.subarray(0,4)),r=I(o.subarray(4,8));k.push({type:i,start:r}),g+=8}},()=>{let i=k[a],r=t.subarray(i.start,i.start+i.length),s=32;switch(i.type){case"ENVC":{let c=u;for(;c<r.length;){let n=r.subarray(c,c+s),d=N.decode(n.subarray(0,10)).trimEnd();d.slice(0,5)==="Init "&&(d=""),d&&(l+=`
063	${(n[17]+13).toString().padStart(3,"0")}	${n[19].toString().padStart(3,"0")}	${d}`),c+=s}break}case"EDVC":{let c=u;for(;c<r.length;){let n=r.subarray(c,c+s),d=N.decode(n.subarray(0,10)).trimEnd();d.slice(0,5)==="Init "&&(d=""),d&&(l+=`
063	024	${n[19].toString().padStart(3,"0")}	${d}`),c+=s}break}case"EPVC":{let c=32,n=u;for(;n<r.length;){let d=r.subarray(n,n+c),h=N.decode(d.subarray(0,10)).trimEnd();h==="----------"&&(h=""),h&&(l+=`
063	${(d[17]+1).toString().padStart(3,"0")}	${d[19].toString().padStart(3,"0")}	${h}`),n+=c}break}}a++,a>=k.length&&(C=3,$=!1)}][C]||(()=>{$=!1}))()}return l});B.set("pcg",async function(e){let t=new Uint8Array(await e.arrayBuffer()),l="MSB	LSB	PRG	NME",f=100,u=0,g=0,C=!0,$=[],k=0;for(;C;){let a=t.subarray(f);([()=>{C=N.decode(a.subarray(0,4))==="INI2",g=a[15],f+=16,u=1},()=>{let o=N.decode(a.subarray(0,4)),i=a[5],r=a[7],s=a[11],c=I(a.subarray(12,16)),n=I(a.subarray(16,20)),d=I(a.subarray(36,40)),h=N.decode(a.subarray(44,44+s));$.push({type:o,tipMsb:i,tipLsb:r,nameLen:s,length:c,start:n,entryLen:d,name:h}),f+=64,g--,g<1&&(u=2)},()=>{let o=$[k],i=t.subarray(o.start,o.start+o.length);switch(o.type){case"PRG1":break;case"PBK1":{let r=63,s=(o.tipMsb?6:0)+o.tipLsb;for(let c=0;c<128;c++){let n=c*o.entryLen,d=i.subarray(n,n+o.entryLen),h=N.decode(d.subarray(0,24)).trimEnd().replace("InitProg","");h.length&&s>5&&(l+=`
${r.toString().padStart(3,"0")}	${s.toString().padStart(3,"0")}	${c.toString().padStart(3,"0")}	${h}`)}break}case"CBK1":{let r=63,s=(o.tipMsb?3:0)+o.tipLsb+10;for(let c=0;c<128;c++){let n=c*o.entryLen,d=i.subarray(n,n+o.entryLen),h=N.decode(d.subarray(0,24)).trimEnd().replace("InitCombi","");h.length&&s>12&&(l+=`
${r.toString().padStart(3,"0")}	${s.toString().padStart(3,"0")}	${c.toString().padStart(3,"0")}	${h}`)}break}}k++,k>=$.length&&(u=3,C=!1)}][u]||(()=>{C=!1}))()}return l});var G=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),X=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],Pe=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],_=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],ce=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],ne=function(e){let t=.1,l=-.3;return e>66?(t=5,l=315):e>56?(t=1,l=47):e>46&&(t=.5,l=18.5),t*e-l},oe=function(e){return e>105?Pe[e-106]:e>100?e*1.1-100:e/10},le=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),j={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,ㇺ
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,ゐ
we,ゑ
wo,を
nga,か゚
ngi,き゚
ngu,く゚
nge,け゚
ngo,こ゚
ngy,き゚!
ng,ン
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,𛀁
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(e=>{let t=e.split(",");j[t[0]]=t[1]});var he=function(e){let t=e;e[0]=="*"&&(t=t.slice(1)),["aa","ii","uu","ee","oo"].forEach(f=>{for(;t.indexOf(f)>-1;)t=t.replace(f,f[0])});for(let f in j)t=t.replaceAll(f,j[f]);t.indexOf("ん")==0&&t.length>1&&(t=t.slice(1));let l=t.indexOf("!");return l>-1&&t.length>1&&(t=t.slice(l+1)),t},de=function(e){return e?e<96?`cc${e}`:["aftertouch","velocity","pitch bend"][e-96]:"off"},fe={u8:["utf-8","Unicode"],l1:["l9","Pan-Latin"],jp:["sjis","Japanese"],kr:["iso-2022-kr","Korean"],hz:["gb18030","Simplified Chinese"],b5:["big5","Traditional Chinese"],cy:["koi8-ru","Cyrillic"],vn:["tcvn-5773-1993","Vietnamese"]},ue={m:"Male",f:"Female",c:"Chorus",s:"Solo",p:"Plural",w:"Words",x:"Non-vocal"};var J=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],pe=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],be=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var Oe={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},De={66307:["drive"],66309:["vowel",e=>"aiueo"[e]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",e=>["off","LPF","HPF"][e]],94984:["noise type",e=>["white","pink"][e]],94987:["disc type",e=>["LP","SP","EP","RND"]],94990:["hum type",e=>`${e+5}0Hz`],94993:["M/S",e=>["mono","stereo"][e]]},Z=function(e){return Oe[(e[0]-32<<8)+e[1]]||`0x${e[0].toString(16).padStart(2,"0")}${e[1].toString(16).padStart(2,"0")}`},Ee=function(e,t,l){let f=(e[0]-32<<16)+(e[1]<<8)+t,u=De[f]||{},g=u[0];if(g?.length)return g+=`: ${(u[1]||function(){})(l)||l}`,g},ee=[68,48,95,78,41,3,110,122,0];var P=function(e=64){return Math.round(2e3*Math.log10(e/64))/100};var U=function(e){let t=0;return e.forEach(l=>{t+=l,t=t&127}),~t+1&127},A=function(e,t){let l=0,f=0;for(let u=0;u<e.length;u++){let g=u%8-1,C=(f>>g&1)<<7,$=e[u];$+=C,u%8!=0?(t($,l,e),l++):f=e[u]}};var K=function(e){let t=Math.floor(e*14.2);return t<128?t:0},w=function(){return self.Bun?!0:self.debugMode??!1};var T=["?","gm","gs","sc","xg","g2","mt32","doc","qy10","qy20","ns5r","x5d","05rw","k11","sg","sd","pa","krs","s90es","motif","trin"],Ae={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es",trinity:"trin","tr-rack":"trin"},Le=["melodic","drum","menu"],ge={"?":[0,0,120,0,0],gm:[0,0,120,0,0],gs:[0,0,120,0,0],sc:[0,0,120,0,0],xg:[0,0,127,0,0],g2:[0,0,120,0,0],mt32:[0,127,127,0,127],doc:[57,112,127,57,112],qy10:[57,113,127,57,113],qy20:[57,114,127,57,114],ns5r:[0,0,61,0,0],x5d:[82,0,62,56,0],"05rw":[81,0,62,56,0],k11:[0,0,122,0,0],sg:[0,0,122,0,0],sd:[97,0,105,0,0],krs:[121,0,120,0,0],s90es:[0,0,127,0,0],motif:[0,0,127,0,0],trin:[0,0,127,0,0]},Ne=[9,25,41,57,73,89,105,121],Ue=[0,3,81,84,88],me={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},ye={0:0,1:1,2:3,5:4},Ce={0:0,1:1,2:2,5:3},$e=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],ae=[36,37,48,49,52,53],q=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],ve={26:127,29:0,30:0,31:0,52:12,53:54},H=[0,1,2,4,5,6,7,8,10,11,12,13,14,15,16,17,18,19,20,21,22,26,28,32,38,40,41,42,43,44,45,46,47,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,80,81,82,83,84,91,92,93,94,95,98,99,100,101,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],_e=[2,4,12,13,14,15,16,17,18,19,20,21,40,41,42,43,44,45,46,47,80,81,83,136,130,131,132,133,134,135,137,138,139,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],He=[33,102,99,32,100,8,9,10],ke=[0,16,25,40,32,64,24,48],y={};T.forEach((e,t)=>{y[e]=t});var m=[];H.forEach((e,t)=>{m[e]=t});var L={length:q.length};q.forEach((e,t)=>{L[e]=t});var Ie={};Le.forEach((e,t)=>{Ie[e]=t});var Be=function(e){let t=[],l=0;return e?.forEach(function(f,u){f===247?t.push(e.subarray(l,u)):f===240&&(l=u+1)}),t.length||t.push(e.subarray(0)),w()&&console.debug(t),t};var te=8,p={port:te,ch:te<<4,chShift:Math.ceil(Math.log2(te))+4,cc:H.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,nrpn:ae.length,ace:8,drm:8,dpn:q.length,dnc:128,ext:3,efx:7,cvn:12,redir:32,vxPrim:3,invalidCh:255};p.chcc=p.cc*p.ch;var V={bank0:128},S=new Uint16Array(p.ch),z=new Uint16Array(p.ch),Ge=new Uint16Array(p.ch),Xe=new Uint16Array(p.ch),xe=new Uint16Array(p.ch),we=new Array(p.drm);for(let e=0;e<p.ch;e++)S[e]=e*p.cc,z[e]=e*p.rpn,Ge[e]=e*p.nrpn,Xe[e]=e*p.ace,xe[e]=e*p.ext;for(let e=0;e<p.drm;e++){we[e]=new Uint16Array(p.dpn);let t=e*p.dpn*p.dnc;for(let l=0;l<p.dpn;l++)we[e][l]=t+l*p.dnc}var bt=class extends se{NOTE_IDLE=0;NOTE_ATTACK=1;NOTE_DECAY=2;NOTE_SUSTAIN=3;NOTE_HELD=4;NOTE_RELEASE=5;NOTE_SOSTENUTO_ATTACK=8;NOTE_SOSTENUTO_DECAY=9;NOTE_SOSTENUTO_SUSTAIN=10;NOTE_SOSTENUTO_HELD=11;NOTE_MUTED_RECOVERABLE=16;CH_MELODIC=0;CH_DRUMS=1;CH_DRUM1=2;CH_DRUM2=3;CH_DRUM3=4;CH_DRUM4=5;CH_DRUM5=6;CH_DRUM6=7;CH_DRUM7=8;CH_DRUM8=9;DUMP_ALL=0;DUMP_ONCE=1;DUMP_MODE=2;EXT_NONE=0;EXT_VL=1;EXT_DX=3;VLBC_SYSTEM=0;VLBC_BRTHEXPR=1;VLBC_VELOINIT=2;VLBC_VELOALL=3;CH_INACTIVE=0;CH_ACTIVE=1;CH_DISABLED=2;KARAOKE_NONE=0;KARAOKE_TEXT=1;KARAOKE_XF=2;#t=0;#E=0;#M=0;#U=new Array(11);get#$(){return this.#U[this.#E]}set#$(e){this.#U[this.#E]=e}#v=new Uint8Array(p.ch);#u=new Uint8Array(p.ch);#a=new Uint8Array(p.ch);#e=new Uint8Array(p.chcc<<1);#g=new Uint8Array(p.ch*p.ace);#s=new Uint8Array(p.ch*p.vxPrim);#p=new Uint8Array(p.ch*p.nn);#y=new Uint8Array(p.ch);#h=new Uint16Array(p.pl);#o=new Uint8Array(p.pl);#_=new Int16Array(p.ch);#D=new Uint8Array(p.ch);#V=new Uint8Array(p.ch);#k=new Uint8Array(p.ch*p.ext);#r=new Uint8Array(p.ch*p.rpn);#c=new Uint8Array(p.ch*p.rpnt);#se=new Int8Array(p.ch*ae.length);#C=new Uint8Array(p.drm*p.dpn*p.dnc);#R=new Uint8Array(p.drm*2);#w=new Uint8Array(p.efx*3);#ie=new Uint8Array(p.ch);#F=new Uint8Array(p.ch*p.redir);#d=new Uint8Array(p.port);#ce=new Uint8Array(p.port);#z=new Uint8Array(p.ch);#P=new Uint8Array(p.ch);#he=new Uint8Array(p.ch*p.cvn);#I=new Uint8Array(128);#O=new Uint8Array(p.cmt*8);#ne=new Uint8Array(1024);#B=new Uint8Array(p.cmt*64);#f={};modelEx={sc:{showBar:!0,invBar:!1,invDisp:!1,peakHold:1}};#i;#A;#de;#l=100;#q=0;#oe=500;#W=0;#Q=0;#be=32;#Y=!1;#G="";#X=0;#fe=0;#le=0;#L=!0;#n=0;#Ee=1;#ue;#j=new Array(p.ch);#x=[];#H=new Uint8Array(p.ch);#K=new Uint8Array(p.tr);baseBank=new Y("gm2","ns5r","xg","gs","sd","gmega","plg-vl","plg-pf","plg-dx","plg-an","plg-dr","plg-sg","kross","s90es");userBank=new Y("gm2");initOnReset=!1;aiEfxName="";polyIndexShrink=!0;polyIndexLatest=0;polyIndexLast=0;chRedir(e,t,l){let f=this;if(f.#K[t])return(f.#K[t]-1)*16+e;if(f.#t===y.sc||f.#t===y.sd){if(l===1)return e;let u=0,g=!0;for(;g;)f.#H[e+u]===0?(f.#H[e+u]=t,console.debug(`Assign track ${t} to channel ${e+u+1}.`),g=!1):this.#H[e+u]===t?g=!1:(u+=16,u>=128&&(u=0,g=!1));return e+u}else return e}getTrackPort(e){return this.chRedir(0,e,!0)>>4}forceVoiceRefresh(){for(let e=0;e<p.ch;e++)this.#v[e]&&this.dispatchEvent("voice",{part:e})}#m=[];#J;#b={nOff:(e,t)=>{let l=e*128+t,f=this.#h.lastIndexOf(l);if(f>-1)if(this.getChCc(e,64)>>6)this.#o[f]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:t,velo:this.#p[l],state:this.NOTE_HELD});else if(this.getChCc(e,66)>>6&&this.#o[f]===this.NOTE_SOSTENUTO_SUSTAIN)this.#o[f]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:t,velo:this.#p[l],state:this.NOTE_SOSTENUTO_HELD});else{this.#h[f]=0,this.#p[l]=0,this.#o[f]=this.NOTE_IDLE;let u=this.getExt(e)[1];(u===this.VLBC_VELOINIT||u===this.VLBC_VELOALL)&&this.setChCc(e,129,0),this.dispatchEvent("note",{part:e,note:t,velo:0,state:this.NOTE_IDLE})}if(this.#y[e]){for(let u=this.polyIndexLast;u>=0;u--)if(this.#h[u]>>7===e&&this.#o[u]!==0){this.#o[u]===this.NOTE_MUTED_RECOVERABLE&&(this.#o[u]=this.NOTE_SUSTAIN);break}}this.polyIndexShrink&&this.polyIndexLast>0&&this.#o[this.polyIndexLast]===0&&this.polyIndexLast--},nOn:(e,t,l)=>{let f=e*128+t,u=0;if(this.#y[e])for(let g=0;g<=this.polyIndexLast;g++)this.#h[g]>>7===e&&this.#o[g]!==0&&(this.#o[g]=this.NOTE_MUTED_RECOVERABLE);for(;this.#o[u]>0&&this.#h[u]!=f;)u++;if(u<p.pl){this.#h[u]=f,this.#p[f]=l,this.#o[u]=this.NOTE_SUSTAIN,this.#D[e]<l&&(this.#D[e]=l);let g=this.getExt(e)[1];(g===this.VLBC_VELOINIT||g===this.VLBC_VELOALL)&&this.setChCc(e,129,l),this.dispatchEvent("note",{part:e,note:t,velo:l,state:this.NOTE_SUSTAIN}),this.polyIndexLatest=u+1,u>this.polyIndexLast&&(this.polyIndexLast=u)}else console.error("Polyphony exceeded.")},nAt:(e,t,l)=>{},cAt:(e,t)=>{},hoOf:e=>{this.#o.forEach((t,l)=>{if(t===this.NOTE_HELD){let f=this.#h[l],u=f>>7;e===u&&(this.#o[l]=this.NOTE_IDLE,this.#h[l]=0,this.#p[f]=0,this.dispatchEvent("note",{part:e,note:f&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{this.#o.forEach((t,l)=>{let f;switch(t){case this.NOTE_ATTACK:{f=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{f=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{f=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(f){this.#o[l]=f;let u=this.#h[l];this.dispatchEvent("note",{part:e,note:u&127,velo:this.#p[u],state:f})}})},soOf:e=>{this.#o.forEach((t,l)=>{if(t===this.NOTE_SOSTENUTO_HELD){let f=this.#h[l],u=f>>7;e===u&&(this.#o[l]=this.NOTE_IDLE,this.#h[l]=0,this.#p[f]=0,this.dispatchEvent("note",{part:e,note:f&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{this.#h.forEach(t=>{let l=t>>7,f=t&127;t===0&&this.#p[0]===0||l===e&&this.#b.nOff(l,f)})}};#pe={8:function(e){let t=e.channel,l=e.data[0];this.#b.nOff(t,l)},9:function(e){let t=e.channel,l=this;if(l.getChModeId(t)===y.xg&&l.#a[t]>1){let g=l.getChDrumFirstWrite(t);g[0]&&g[1]!=p.invalidCh&&!l.#v[t]&&(l.copyChSetup(g[1],t),l.dispatchEvent("voice",{part:t}),console.debug(`Part CH${t+1} copied from CH${g[1]+1}.`))}l.setChActive(t,1);let f=e.data[0],u=e.data[1];u>0?l.#b.nOn(t,f,u):l.#b.nOff(t,f)},10:function(e){let t=e.channel,l=t*128+e.data[0];this.#h.indexOf(l)>-1&&(this.#p[l]=data[1],this.getExt(t)[1]===this.VLBC_VELOALL&&this.setChCc(t,129,data[1]),this.dispatchEvent("note",{part:t,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let t=e.channel,l=this,f=l.#j[t],u=f[e.data[0]];u&&(e.data[0]=u),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(this.#t){case y.s90es:case y.motif:{if(e.data[0]===0){[0,63].indexOf(e.data[1])>-1&&l.setChActive(t,1);break}e.data[1]&&l.setChActive(t,1);break}default:break}})();let g=t*p.ext,C=l.getChModeId(t);switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{this.#b.ano(t),this.#_[t]=0,l.resetChCc(t,1,0),l.resetChCc(t,5,0),l.resetChCc(t,64,0),l.resetChCc(t,65,0),l.resetChCc(t,66,0),l.resetChCc(t,67,0),l.resetChCc(t,11,127),l.resetChCc(t,101,127),l.resetChCc(t,100,127),l.resetChCc(t,99,127),l.resetChCc(t,98,127);return}case 123:{this.#b.ano(t);return}case 124:{this.#b.ano(t);return}case 125:{this.#b.ano(t);return}case 126:{this.#y[t]=1,this.#b.ano(t);return}case 127:{this.#y[t]=0,this.#b.ano(t);return}}if(m[e.data[0]]===void 0)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(_e.indexOf(e.data[0])>-1&&this.allocateAce(t,e.data[0]),e.data[0]){case 0:{switch(w()&&console.debug(`${T[this.#t]}, CH${t+1}: ${e.data[1]}`),this.#t===0?e.data[1]<48?(this.#a[t]>0&&(e.data[1]=this.getChPrimitive(t,1,!1),e.data[1]=120,console.debug(`Forced channel ${t+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]===56?this.switchMode(this.#i.x5===82?"x5d":"05rw"):e.data[1]===62?this.switchMode(this.#i.x5===82?"x5d":"05rw"):e.data[1]===63?this.switchMode(T[this.#i.ds]):(e.data[1]===64||e.data[1]===127)&&this.switchMode("xg"):this.#t===y.gs||this.#t===y.sc?e.data[1]<56&&this.#a[t]>0&&(e.data[1]=this.getChPrimitive(t,1,!1),e.data[1]=120,console.debug(`Forced channel ${t+1} to stay drums.`)):this.#t===y.gm&&(e.data[1]<48?this.#a[t]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${t+1} to stay drums.`)):(e.data[1]===64||e.data[1]===127)&&this.switchMode("xg",!0)),this.#t){case y.xg:{[79,95,126,127].indexOf(e.data[1])>-1?this.#a[t]===0&&(this.setChType(t,this.CH_DRUM2),console.debug(`CH${t+1} set to drums by MSB.`)):this.#a[t]>0&&(this.setChType(t,this.CH_MELODIC),console.debug(`CH${t+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?this.#k[g]=this.EXT_VL:[35,67,83,99].indexOf(e.data[1])>-1?this.#k[g]=this.EXT_DX:this.#k[g]=this.EXT_NONE;break}case y["05rw"]:case y.x5d:case y.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?this.#a[t]===this.CH_MELODIC&&(this.setChType(t,this.CH_DRUM2),console.debug(`CH${t+1} set to drums by MSB.`)):[80,81,82,83].indexOf(e.data[1])>-1||this.#a[t]!=this.CH_MELODIC&&(this.setChType(t,this.CH_MELODIC),console.debug(`CH${t+1} set to melodic by MSB.`));break}case y.sd:{[104,105,106,107].indexOf(e.data[1])>-1?this.#a[t]===0&&(this.setChType(t,this.CH_DRUM2),console.debug(`CH${t+1} set to drums by MSB.`)):this.#a[t]>0&&(this.setChType(t,this.CH_MELODIC),console.debug(`CH${t+1} set to melodic by MSB.`));break}case y.g2:{e.data[1]===120?this.#a[t]===0&&(this.setChType(t,this.CH_DRUMS),console.debug(`CH${t+1} set to drums by MSB.`)):this.#a[t]>0&&(this.setChType(t,this.CH_MELODIC),console.debug(`CH${t+1} set to melodic by MSB.`));break}}break}case 2:{this.getExt(t)[1]===this.VLBC_BRTHEXPR&&this.setChCc(t,129,e.data[1]);break}case 6:{if(this.#V[t]){[y.xg,y.gs,y.sc,y.ns5r].indexOf(this.#t)<0&&console.warn(`NRPN commits are not available under "${T[this.#t]}" mode, even when they are supported in Octavia.`);let $=this.getChCc(t,99),k=this.getChCc(t,98);if($===1){let a=He.indexOf(k);if(a>-1)this.setChCc(t,71+a,e.data[1]),w()&&console.debug(`Redirected NRPN 1 ${k} to cc${71+a}.`),this.dispatchEvent("cc",{part:t,cc:71+a,data:e.data[1]});else{let o=ae.indexOf(k);o>-1?this.#se[t*10+o]=e.data[1]-64:console.warn(`NRPN 0x01${k.toString(16).padStart(2,"0")} is not supported.`),w()&&console.debug(`CH${t+1} voice NRPN ${k} commit`)}}else{if(q.indexOf($)<0){let o=`NRPN 0x${$.toString(16).padStart(2,"0")}${k.toString(16).padStart(2,"0")} `;console.warn($===127?`${o}is not necessary. Consider removing it.`:`${o}is not supported.`)}else{let o=this.#a[t]-2;o<0?console.warn(`CH${t+1} cannot accept drum NRPN as type ${X[this.#a[t]]}.`):this.#C[(o*p.dpn+L[$])*p.dnc+k]=e.data[1]}w()&&console.debug(`CH${t+1} (${X[this.#a[t]]}) drum NRPN ${$} commit`)}}else{let $=ye[this.getChCc(t,100)],k=Ce[this.getChCc(t,100)];if(this.getChCc(t,101)===0&&$!=null)switch(w()&&console.debug(`CH${t+1} RPN 0 ${this.getChCc(t,100)} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],$e[$][0]),$e[$][1]),this.#r[t*p.rpn+$]=e.data[1],this.#c[t*p.rpnt+k]=1,C){case y.xg:case y.gs:case y.sc:case y.mt32:case y.s90es:case y.motif:{switch(this.getChCc(t,100)){case 1:case 2:{this.dispatchEvent("pitch",{part:t,pitch:this.getPitchShift(t)});break}}break}default:this.dispatchEvent("pitch",{part:t,pitch:this.getPitchShift(t)})}}break}case 32:{switch(w()&&console.debug(`${T[this.#t]}, CH${t+1} LSB: ${e.data[1]}`),this.#t){case y.s90es:case y.motif:{this.setChType(t,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,this.#t,!0);break}}this.getExt(t)[0],this.EXT_DX;break}case 38:{if(!this.#V[t]){let $=ye[this.getChCc(t,100)],k=Ce[this.getChCc(t,100)];this.getChCc(t,101)===0&&$!=null&&(this.#r[t*p.rpn+$+1]=e.data[1],this.#c[t*p.rpnt+k]=1)}break}case 64:{e.data[1]<64&&this.#b.hoOf(t);break}case 66:{e.data[1]>>6?this.#b.soOn(t):this.#b.soOf(t);break}case 98:case 99:{this.#V[t]=1;break}case 100:case 101:{this.#V[t]=0;break}}this.setChCc(t,e.data[0],e.data[1]),this.dispatchEvent("cc",{part:t,cc:e.data[0],data:e.data[1]})}l.getChModeId(t)===y.xg&&l.#a[t]&&l.setDrumFirstWrite(t)},12:function(e){let t=e.channel,l=this;switch(l.#t){case y.s90es:case y.motif:{e.data&&l.setChActive(t,1);break}default:l.setChActive(t,1)}let f=S[t];switch(l.getExt(t)[0]){case l.EXT_VL:break}l.#s[t]=e.data,l.#P[t]=0,l.pushChPrimitives(t),w()&&console.debug(`T:${e.track} C:${t} P:${e.data}`),l.dispatchEvent("voice",{part:t}),l.getChModeId(t)===y.xg&&l.#a[t]&&l.setDrumFirstWrite(t)},13:function(e){let t=this,l=e.channel;this.#h.forEach(function(f){let u=f>>7;l===u&&(t.#p[f]=e.data,t.dispatchEvent("note",{part:l,note:f&127,velo:e.data,state:t.NOTE_SUSTAIN}))})},14:function(e){let t=e.channel;this.#_[t]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:t,pitch:this.getPitchShift(t)})},15:function(e){Be(e.data).forEach(t=>{let l=t[0],f=t[1];(this.#ge[l]||function(){console.debug(`Unknown manufacturer ${l}.`)})(f,t.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(this.#m[e.meta]||function(l,f,u){}).call(this,e.data,e.track,e.meta),e.meta!=32&&(this.#q=0);let t=Ue.indexOf(e.meta)>-1;if(w()&&console.debug(e),t)return e.reply="meta",e}};#ge={64:(e,t,l)=>{this.#te.run(t,l,e)},65:(e,t,l)=>{if(t[0]<16)if(t[1]===72){let f=t[t.length-1],u=U(t.subarray(3,t.length-1));f===u?this.#T.run(t.subarray(0,t.length-1),l,e):console.warn(`Bad SD checksum ${f} - should be ${u}.`)}else this.#T.run(t,l,e);else{let f=t[t.length-1],u=U(t.subarray(2,t.length-1));f===u?this.#T.run(t.subarray(0,t.length-1),l,e):console.warn(`Bad GS checksum ${f} - should be ${u}.`)}},66:(e,t,l)=>{this.#N.run(t,l,e)},67:(e,t,l)=>{this.#S.run(t,l,e)},68:(e,t,l)=>{this.#re.run(t,l,e)},71:(e,t,l)=>{this.#ae.run(t,l,e)},126:(e,t,l)=>{this.#Z.run(t,l,e)},127:(e,t,l)=>{this.switchMode("gm"),this.#ee.run(t,l,e)}};#Z;#ee;#S;#T;#N;#te;#ae;#re;buildRchTree(){let e=[];this.#u.forEach((t,l)=>{t<p.ch&&(e[t]?.constructor||(e[t]=[]),e[t].push(l))}),this.#ue=e}buildRccMap(){let e=this;for(let t=0;t<p.ch;t++)e.#j[t]={};e.#F.forEach((t,l)=>{t&&(e.#j[Math.floor(l/p.redir)][t]=l%p.redir|128)}),w()&&console.debug(e.#j)}getActive(){return this.#v}getChActive(e){return this.#v[e]}getCc(e){if(typeof e!="number"||e<0||e>=p.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let t=this,l=S[e];return t.#e.subarray(l,l+p.cc)}getChCc(e,t){let l=this;if(H.indexOf(t)<0)throw new Error("CC number not accepted");return l.#e[S[e]+m[t]]}setChCc(e=0,t,l){let f=this;if(H.indexOf(t)<0)throw new Error("CC number not accepted");if(l?.constructor!=Number)throw new TypeError("Expected numbers for value");let u=l&255,g=S[e]+m[t];f.#e[g]=u,f.#e[g+p.chcc]=1,f.dispatchEvent("cc",{part:e,cc:t,data:u})}getCcAll(){return this.#e.slice()}resetCc(e){}resetChCc(e,t,l){let f=this;l?.constructor&&f.setChCc(e,t,l),f.#e[S[e]+m[t]+p.chcc]=0}resetCcAll(){}isChCcWritten(e,t){if(H.indexOf(t)<0)throw new Error("CC number not accepted");return upThis.#e[S[e]+m[t]+p.chcc]}getChSource(){return this.#u}getChType(){return this.#a}setChType(e,t,l=0,f=!1){t&=15;let u=this;l=l||u.getChModeId(e),u.#a[e]=t,t>0&&!f&&(u.setChCc(e,0,u.#f[l][2]),u.pushChPrimitives(e))}setChActive(e,t=0){this.#v[e]!=t&&this.dispatchEvent("channeltoggle",{part:e,active:t}),this.#v[e]=t}getExt(e){let t=p.ext*e,l=this.#k.subarray(t,t+p.ext),f=new Uint8Array(l.length);return f.set(l),f[1]=f[1]||this.#Ee,f}getPitch(){return this.#_}getProgram(){return this.#s}getTexts(){return this.#x.slice()}getVel(e){let t=new Map,l=this;return l.#h.forEach(function(f,u){let g=f>>7,C=f&127;e===g&&l.#p[f]>0&&t.set(C,{v:l.#p[f],s:l.#o[u]})}),t}getBitmap(){return{bitmap:this.#$,expire:this.#M}}getLetter(){return{text:this.#G,set:this.#fe,expire:this.#X}}getMode(){return T[this.#t]}getMaster(){return{volume:this.#l}}getRawStrength(){let e=this;return this.#h.forEach(function(t){let l=t>>7;e.#p[t]>e.#D[l]&&(e.#D[l]=e.#p[t])}),this.#D}getStrength(){let e=[],t=this;return this.getRawStrength().forEach(function(l,f){e[f]=Math.floor(l*t.getChCc(f,7)*t.getChCc(f,11)*t.#l/803288)}),e}getRpn(){return this.#r}getNrpn(){return this.#se}getSubDb(){return self?.structuredClone(this.#f)}getDetect(){return self?.structuredClone(this.#i)}getVoice(e,t,l,f="?"){let u=this;y[f]?.constructor||(f="?");let g=y[f],C=e||u.#f[g][0],$=t,k=l||u.#f[g][1];C===V.bank0&&(C=0),k===V.bank0&&(k=0),f==="ns5r"&&C>0&&C<56&&(k=3);let a=u.userBank.get(C,$,k,f);if(f==="mt32"&&a.name.indexOf("MT-m:")===0){let o=parseInt(a.name.slice(5)),i=o*p.cmt,r="";u.#B.subarray(i,i+10).forEach(c=>{c>31&&(r+=String.fromCharCode(c))});let s=`MSB	LSB	PRG	NME
49	127	${$}	${r}`;u.userBank.load(s,!0),a.name=r,a.ending=" "}return(a.ending!=" "||!a.name.length)&&(a=u.baseBank.get(C,$,k,f)),a}getChPrimitive(e,t,l){if(t>=p.vxPrim||t?.constructor!=Number)throw new RangeError(`Invalid voice primitive component "${t}"`);if(typeof e!="number"||e<0||e>=p.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let f=this,u=f.#s[t<<p.chShift|e];switch(t){case 1:case 2:{l&&(u=u||f.#f[f.getChModeId(e)][t-1]),u===V.bank0&&(u=0);break}}return u}getChPrimitives(e,t){let l=this,f=new Uint8Array(3);return f[1]=l.#s[e],f[0]=l.getChPrimitive(e,1,t),f[2]=l.getChPrimitive(e,2,t),f}pushChPrimitives(e){let t=this;t.#s[1<<p.chShift|e]=t.getChCc(e,0),t.#s[2<<p.chShift|e]=t.getChCc(e,32),t.dispatchEvent("voice",{part:e})}getChVoice(e){let t=this,l=t.getVoice(...t.getChPrimitives(e),t.getChMode(e));if(t.#P[e]){let f="";switch(t.#t){case y.mt32:{t.#O.subarray(p.cmt*(e-1),p.cmt*(e-1)+10).forEach(u=>{f+=String.fromCharCode(Math.max(u,32))}),f=f.trimRight();break}default:{let u=p.cvn*e;t.#he.subarray(u,u+p.cvn).forEach(g=>{f+=String.fromCharCode(Math.max(g,32))}),f=f.trimRight()}}f.length&&(l.ending="~",l.name=f)}return l}getRawPitch(){return this.#_}getPitchShift(e){let t=this,l=e*p.rpn,f=t.#r[l];return t.#c[e*p.rpnt]||t.#t===y.mt32&&(f=12),t.#_[e]/8192*f+(t.#r[l+3]-64)+((t.#r[l+1]<<7)+t.#r[l+2]-8192)/8192}getEffectType(e=0){let t=3*e+1;return this.#w.subarray(t,t+2)}getPolyState(e=0){return this.#o[e]}setEffectTypeRaw(e=0,t,l){let f=3*e;this.#w[f]=1,this.#w[f+1+ +t]=l}setEffectType(e=0,t,l){this.setEffectTypeRaw(e,!1,t),this.setEffectTypeRaw(e,!0,l)}getEffectSink(){return this.#ie}setLetterDisplay(e,t,l=0,f=3200){let u=this,g;u.#G=" ".repeat(l),e.forEach(C=>{u.#G+=String.fromCharCode(C>31?C:32),C<32&&(g=g||new Set,g.add(C))}),u.#fe=Date.now(),u.#X=Date.now()+f,u.dispatchEvent("letter"),g&&(g=Array.from(g),g.forEach((C,$,k)=>{k[$]=C.toString(16).padStart(2,"0")}),console.warn(`${t}${t?" ":""}invalid code point${g.length>1?"s":""}: 0x${g.join(", 0x")}`))}setDetectionTargets(e="?",t=0){let l=this,f=-1;switch(e.replaceAll(", ",",").split(",").forEach(u=>{u=u.toLowerCase();let g=T.indexOf(Ae[u]||u);w()&&console.debug(`Mapped mode "${u}" to ID "${g}".`),g>-1&&(f=g)}),w()&&console.debug(`Set detection target to ID "${f}".`),f>0&&(l.#i.x5=82,l.#i.ds=y.krs),f){case y["05rw"]:{l.#i.x5=81;break}case y.s90es:l.#i.ds=y.s90es,l.#i.smotif=y.s90es;case y.motif:l.#i.ds=y.motif,l.#i.smotif=y.motif}}setGsTargets(e=!1,t=4){if(!t)t=e?3:4;else{if(t>4||t<0)throw new Error(`Invalid GS level ${t}`);if(e&&t>>1!=1)throw new Error(`Invalid SC level ${t}`)}let l=this;l.#i[e?"sc":"gs"]=t,l.#f[y[e?"sc":"gs"]][1]=t,l.forceVoiceRefresh()}getConfigs(){return this.#de}setDumpLimit(e){if(e>2||e<0)throw new RangeError("Invalid dump limit.");this.#A.dumpLimit=e}allocateAce(e=0,t){let l=this;if(!t||t<128&&t>95){console.warn(`cc${t} cannot be allocated as an active custom effect.`);return}let f=!0,u=0,g=p.ace*e;for(;f&&u<p.ace;)l.#g[u+g]===t?f=!1:l.#g[u+g]||(f=!1,l.#g[u+g]=t,console.info(`Allocated cc${t} to ACE slot ${u} in CH${e+1}.`)),u++;u>=p.ace&&console.warn(`ACE slots are full in CH${e+1}.`)}allocateAceAll(e){let t=this;if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}for(let l=0;l<p.ch;l++){let f=!0,u=0,g=p.ace*l;for(;f&&u<p.ace;)t.#g[u+g]===e?f=!1:t.#g[u+g]||(f=!1,t.#g[u+g]=e),u++;u>=p.ace&&console.warn(`ACE slots are full in CH${l+1}.`)}}releaseAce(e=0,t){let l=!0,f=p.ace*e,u=f+p.ace;for(;l&&f<u;)this.#g[f]===t&&(this.#g[f]=0,l=!1),f++;l&&w()&&console.debug(`No ACE slot was allocated to cc${t} in CH${e+1}.`)}resetAce(){this.#g.fill(0),console.info("All ACE slots have been reset.")}getAce(){return this.#g}getChAce(e=0,t=0){if(t<0||t>=p.ace)throw new RangeError("No such ACE slot");let l=this.#g[p.ace*e+t];if(l){if(H.indexOf(l)>=0)return this.getChCc(e,l);throw new Error(`Invalid ACE source in CH${e+1}: ${l}`)}else return 0}initDrums(){let e=this;e.#C.fill(64);for(let t=0;t<p.drm;t++){let l=t*p.dpn;for(let f in ve){let u=ve[f],g=(l+L[f])*p.dnc;e.#C.subarray(g,g+p.dnc).fill(u)}}}init(e=0){let t=this;t.#q=0,t.#f[y.xg][1]=0,t.dispatchEvent("banklevel",{mode:"xg",data:0}),t.#v.fill(0),t.#e.fill(0),t.#g.fill(0),t.#s.fill(0),t.#p.fill(0),t.#h.fill(0),t.#o.fill(0),t.#y.fill(0),t.#D.fill(0),t.#_.fill(0),t.#se.fill(0),t.#c.fill(0),t.#k.fill(0),t.#d.fill(0),t.#ce.fill(0),t.#z.fill(0),t.#F.fill(0),t.#l=100,t.#x=[],t.#oe=500,t.#W=0,t.#Q=0,t.#Y=!1,t.#M=0,t.#E=0,t.#$.fill(0),t.#n=t.KARAOKE_NONE,t.#le=0,t.#L=!0,t.initDrums(),t.polyIndexLatest=0,t.polyIndexLast=0,t.#u.forEach(function(l,f,u){u[f]=f}),e===0&&(t.dispatchEvent("mode","?"),t.#t=0,t.#H.fill(0),t.#K.fill(0),t.#X=0,t.#G=""),Ne.forEach(l=>{t.setChCc(l,0,t.#f[t.getChModeId(l)][2])}),t.#a.fill(t.CH_MELODIC),t.#a[9]=t.CH_DRUM1,t.#a[25]=t.CH_DRUM3,t.#a[41]=t.CH_DRUMS,t.#a[57]=t.CH_DRUMS,t.#a[73]=t.CH_DRUM5,t.#a[89]=t.CH_DRUM7,t.#a[105]=t.CH_DRUMS,t.#a[121]=t.CH_DRUMS;for(let l=0;l<p.drm;l++)t.#R[l<<1]=0,t.#R[l<<1|1]=p.invalidCh;t.#ne.fill(0),t.#B.fill(0),t.#I.fill(0),t.#O.fill(0),t.#P.fill(0),t.#w.fill(0),t.#ie.fill(0),t.aiEfxName="",t.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),t.modelEx.sc.showBar=!0,t.modelEx.sc.invBar=!1,t.modelEx.sc.invDisp=!1,t.modelEx.sc.peakHold=1;for(let l=0;l<p.ch;l++){let f=S[l];t.#e[f+m[7]]=100,t.#e[f+m[11]]=127,t.#e[f+m[2]]=127,t.#e[f+m[10]]=64,t.#e.subarray(f+m[71],f+m[71]+8).fill(64),t.#e[f+m[128]]=127,t.#e.subarray(f+m[130],f+m[157]+1).fill(64),t.#e[f+m[91]]=40,t.#e[f+m[101]]=127,t.#e[f+m[100]]=127,t.#e[f+m[99]]=127,t.#e[f+m[98]]=127;let u=l*p.rpn;t.#r[u]=2,t.#r[u+1]=64,t.#r[u+2]=0,t.#r[u+3]=64,t.#r[u+4]=0,t.#r[u+5]=0;let g=l*p.ext;t.#k[g+1]=t.VLBC_BRTHEXPR;let C=l*p.redir;t.#F[C+8]=13}t.buildRchTree(),t.buildRccMap(),t.dispatchEvent("mastervolume",t.#l),t.dispatchEvent("efxreverb",t.getEffectType(0)),t.dispatchEvent("efxchorus",t.getEffectType(1)),t.dispatchEvent("efxdelay",t.getEffectType(2)),t.dispatchEvent("efxinsert0",t.getEffectType(3)),t.dispatchEvent("efxinsert1",t.getEffectType(4)),t.dispatchEvent("efxinsert2",t.getEffectType(5)),t.dispatchEvent("efxinsert3",t.getEffectType(6)),t.dispatchEvent("reset"),t.switchMode("?")}setChMode(e,t){let l=this;if(typeof e!="number"||e<0||e>=p.ch)throw new RangeError(`Invalid part number: CH${e+1}`);if(port<0||t>=T.length)throw new RangeError(`Invalid mode ID ${t}`);l.#z[e]=t,l.dispatchEvent("chmode",{part:e,id:t,mode:T[t]}),l.dispatchEvent("voice",{part:e})}getChMode(e,t){return T[this.getChModeId(e,t)]}getChModeId(e,t){return t?this.#z[e]||this.#d[e>>4]:this.#z[e]||this.#d[e>>4]||this.#t}setPortMode(e,t,l){let f=this;if(e<0||e>=p.ch>>4)throw new RangeError(`Invalid port ${e+1}`);if(t<1)throw new RangeError("Range must be a positive integer");if(e+t>=p.ch>>4)throw new RangeError("Range must be in bound");if(e<0||l>=T.length)throw new RangeError(`Invalid mode ID ${l}`);f.#ce[e]=l;for(let u=e;u<e+t;u++){let g=f.#ce[u];if(t>1&&g!==0&&g!==l)break;f.#d[u]=l;for(let C=u<<4;C<u+1<<4;C++)f.dispatchEvent("chmode",{part:C,id:l,mode:T[l]}),f.dispatchEvent("voice",{part:C})}}copyChSetup(e,t,l){if(e===t){console.warn(`Failed attempt at overwriting CH${e+1} with its own data.`);return}let f=this;if(l&&f.#v[t]){console.warn(`Failed attempt at copying setup data from CH${e+1} to CH${t+1}.`);return}let u=S[e],g=S[t];f.#s[t]=f.#s[e],f.#e.set(f.#e.subarray(u,u+p.cc),g),f.pushChPrimitives(t)}setDrumFirstWrite(e,t){let l=this,f=l.#a[e];if(f<2)return;let u=f-2;if(l.#R[u<<1])if(t)l.#R[u<<1]=0,w()&&console.debug(`First write part for drum set ${u+1} has been reset.`);else return;else t?console.warn(`First write part for drum set ${u+1} is already blank.`):(l.#R[u<<1]=1,l.#R[u<<1|1]=e,console.debug(`First write part for drum set ${u+1} is set to CH${e+1}.`))}getChDrumFirstWrite(e){let t=this,l=t.#a[e];if(l<2)return;let f=l-2;return t.#R.subarray(f<<1,f+1<<1)}getDrumFirstWrite(e){if(e>=0&&e<p.drm)return this.#R.subarray(e<<1,e+1<<1)}switchMode(e,t=!1,l=!1){let f=this,u=y[e];if(u>-1){if(f.#t===0||t){f.initOnReset&&t&&this.init(1),f.#t=u,f.#E=0;for(let C=0;C<p.ch;C++){let $=f.getChModeId(C,!0);f.#a[C]>0&&$===y["?"]&&(f.setChCc(C,0,f.#f[u][2]),w()&&console.debug(`CH${C+1} (${f.#a[C]}) (${f.getChMode(C)}), ${T[$]} (${f.#f[$][2]}) -> ${T[u]} (${f.#f[u][2]})`),f.pushChPrimitives(C))}switch(u){case y.mt32:{ee.forEach((C,$)=>{let k=$+1;f.#v[k]||(f.#s[k]=C,f.setChCc(k,91,127),f.pushChPrimitives(k))});for(let C=1;C<10;C++)f.dispatchEvent("voice",{part:C});break}}let g;switch(u){case y["?"]:case y.g2:{g=[52,4,52,18,0,0,0,0];break}case y.xg:{g=[1,0,65,0,5,0,0,0];break}case y.gm:case y.gs:case y.sc:{g=[40,4,40,18,40,32,32,0];break}case y.sd:{g=[58,0,60,0,61,0,61,0];break}case y["05rw"]:case y.x5d:case y.ns5r:{g=[44,1,44,19,44,0,44,0];break}case y.k11:case y.sg:{g=[24,0,0,0,0,0,0,0];break}case y.mt32:{g=[40,4,0,0,0,0,0,0];break}case y.doc:{g=[24,16,0,0,0,0,0,0];break}case y.motif:case y.s90es:{g=[129,0,133,0,130,0,0,0];break}default:g=[0,0,0,0,0,0,0,0]}for(let C=0;C<p.efx;C++)!f.#w[3*C]&&g[C<<1]?.constructor&&(f.#w[3*C+1]=g[2*C],f.#w[3*C+2]=g[2*C+1],f.dispatchEvent(`efx${["reverb","chorus","delay","insert0"][C]}`,f.getEffectType(C)));l&&f.setDetectionTargets(e),f.dispatchEvent("mode",e),f.forceVoiceRefresh()}}else throw new Error(`Unknown mode ${e}`)}newStrength(){this.#D.fill(0)}runJson(e){if(e.type>14)return e.type===15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),this.#pe[e.type].call(this,e);{let t=this.chRedir(e.part,e.track),l=!1;this.#ue[t]?.forEach(f=>{e.channel=f,l=!0,this.#pe[e.type].call(this,e)}),l||console.warn(`${me[e.type]?me[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${t+1} without any recipient.`)}this.#x.length>100&&this.#x.splice(100,this.#x.length-99)}runRaw(e){}async loadBank(e,t){let l=this;switch(e=e.toLowerCase(),e){case"s7e":{l.userBank.clearRange({msb:63,lsb:[21,22]}),l.userBank.clearRange({msb:63,lsb:[24,27]});break}case"pcg":{l.userBank.clearRange({msb:63,lsb:[6,9]}),l.userBank.clearRange({msb:63,lsb:[13,16]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":case"pcg":{B.context=this,await l.userBank.load(await B.read(e,t),!1);break}}l.forceVoiceRefresh()}constructor(){super();let e=this;e.#$=new Uint8Array(256),e.#U[10]=new Uint8Array(512),e.#J=new D,e.#i={x5:82,ds:y.krs,smotif:y.s90es,gs:4,sc:3},e.#A={dumpLimit:e.DUMP_MODE},e.#de=new Proxy(e.#A,{set:()=>{}});for(let a in ge){let o=y[a];o===void 0?console.debug(`SubDB build error: "${a}" does not exist`):e.#f[o]=new Uint8Array(ge[a])}e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(a){let{data:o}=a;e.#x[0]?.type===o.type&&e.#x[0]?.amend?(e.#x[0].amend=o.amend,e.#x[0].data+=o.data):e.#x.unshift(o)}),e.#m[1]=function(a){switch(a=a.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),a.slice(0,2)){case"@I":{e.#n=e.KARAOKE_TEXT,e.dispatchEvent("metacommit",{type:"Kar.Info",data:a.slice(2)?.trimLeft()});break}case"@K":{e.#n=e.KARAOKE_TEXT,e.dispatchEvent("metacommit",{type:"Kar.Mode",data:a.slice(2)?.trimLeft()}),console.debug(`Karaoke mode active: ${a.slice(2)}`);break}case"@L":{e.#n=e.KARAOKE_TEXT,e.dispatchEvent("metacommit",{type:"Kar.Lang",data:a.slice(2)?.trimLeft()});break}case"@T":{e.#n=e.KARAOKE_TEXT,e.dispatchEvent("metacommit",{type:"KarTitle",data:a.slice(2)?.trimLeft()});break}case"@V":{e.#n=e.KARAOKE_TEXT,e.dispatchEvent("metacommit",{type:"Kar.Ver.",data:a.slice(2)?.trimLeft()});break}case"XF":{let o=a.slice(2).split(":");switch(o[0]){case"hd":{o.slice(1).forEach((i,r)=>{i.length&&e.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][r],data:i})});break}case"ln":{o.slice(1).forEach((i,r)=>{i.length&&e.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][r],data:i})});break}default:e.dispatchEvent("metacommit",{type:"XfUnData",data:a})}break}default:switch(e.#n){case e.KARAOKE_TEXT:{switch(a[0]){case"\\":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:a.slice(1),amend:!0});break}case"/":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:a.slice(1),mask:!0,amend:!0});break}default:e.dispatchEvent("metacommit",{type:"KarLyric",data:a,amend:!0})}break}default:a.split(`
`).forEach((o,i)=>{e.dispatchEvent("metacommit",{type:"Cmn.Text",data:o,mask:i!=0})})}}},e.#m[2]=function(a){e.dispatchEvent("metacommit",{type:"Copyrite",data:a})},e.#m[3]=function(a,o){o<1&&e.#q<1&&e.dispatchEvent("metacommit",{type:"TrkTitle",data:a})},e.#m[4]=function(a,o){e.dispatchEvent("metacommit",{type:"Instrmnt",data:a})};let t=!1;e.#m[5]=function(a){switch(e.#n){case e.KARAOKE_XF:{let o="";for(let i of a)switch(i){case"^":{o+=" ";break}case">":break;case"<":{e.dispatchEvent("metacommit",{type:"KarLyric",data:o,mask:t,amend:!1}),o="",t=!1;break}case"/":case"%":{e.dispatchEvent("metacommit",{type:"KarLyric",data:o,mask:!1,amend:!0}),e.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),o="",t=!0;break}default:o+=i}o.length>0&&(e.dispatchEvent("metacommit",{type:"KarLyric",data:o,mask:t,amend:!0}),t=!1);break}default:{a.trim()===""?e.dispatchEvent("metacommit",{type:"C.Lyrics",data:"",amend:!1}):e.dispatchEvent("metacommit",{type:"C.Lyrics",data:a,amend:!0});break}}},e.#m[6]=function(a){e.dispatchEvent("metacommit",{type:"C.Marker",data:a})},e.#m[7]=function(a){switch(a[0]){case"$":{if(a.substring(1,5)==="Lyrc"){e.#n=e.KARAOKE_XF;let o=a.substring(6).split(":"),i=o[0].replaceAll(" ","").split(",");i.forEach((s,c,n)=>{n[c]=parseInt(s)-1});let r=fe[o[2].substring(0,2).toLowerCase()];e.dispatchEvent("metacommit",{type:"XfMeloCh",data:`CH${o[0].replaceAll(" ","").split(",").join(", CH")}`,parsed:i}),e.dispatchEvent("metacommit",{type:"XfLyrOff",data:o[1],parsed:parseInt(o[1])}),e.dispatchEvent("metacommit",{type:"XfLyrEnc",data:r[1],parsed:r[0]}),t=!1}else e.dispatchEvent("metacommit",{type:"CuePoint",data:a});break}case"#":{e.dispatchEvent("metacommit",{type:"XfScneNo",data:a.substring(1)});break}case"&":{a.length===2?(e.dispatchEvent("metacommit",{type:"XfSngPrt",data:ue[a[1]]||`Unknown "${a[1]}"`}),t=!1):e.dispatchEvent("metacommit",{type:"CuePoint",data:a});break}default:e.dispatchEvent("metacommit",{type:"CuePoint",data:a})}},e.#m[32]=function(a){e.#q=a[0]+1},e.#m[33]=function(a,o){w()&&console.debug(`Track ${o} requests to get assigned to output ${a}.`),e.#K[o]=a+1},e.#m[81]=function(a,o){e.#oe=a/1e3},e.#m[127]=function(a,o){e.#J.run(a,o)},e.#J.default=function(a){console.warn(`Unrecognized sequencer-specific byte sequence: ${a}`)},e.#J.add([67,0,1],function(a,o){w()&&console.debug(`XGworks requests assigning track ${o} to output ${a[0]}.`),e.#K[o]=a[0]+1}),e.#Z=new D("universal non-realtime"),e.#ee=new D("universal realtime"),e.#S=new D("Yamaha"),e.#T=new D("Roland"),e.#N=new D("Korg"),e.#te=new D("Kawai"),e.#ae=new D("Akai"),e.#re=new D("Casio");let l=new D("DX7+ Dump"),f=function(a){console.info(`Unrecognized SysEx in "${this.name}" set.
%o`,a)};e.#Z.default=f,e.#ee.default=f,e.#S.default=f,e.#T.default=f,e.#N.default=f,e.#te.default=f,e.#ae.default=f,e.#re.default=f,l.default=f,e.#Z.add([9],(a,o,i)=>{e.switchMode(["gm","?","g2"][a[0]-1],!0),e.setPortMode(e.getTrackPort(o),1,y[["gm","?","g2"][a[0]-1]]),e.#n=e.#n||e.KARAOKE_NONE,console.info(`MIDI reset: ${["GM","Init","GM2"][a[0]-1]}`),a[0]===2&&e.init()}),e.#ee.add([4,1],(a,o,i)=>{e.dispatchEvent("mupromptex"),e.#l=((a[1]<<7)+a[0])/16383*100,e.dispatchEvent("mastervolume",e.#l)}).add([4,3],(a,o,i)=>((a[1]<<7)+a[0]-8192)/8192).add([4,4],(a,o,i)=>a[1]-64).add([4,5],(a,o,i)=>{e.dispatchEvent("mupromptex");let r=a[0],s=a[1],c=a[2],n=3,d=n+(r<<1),h=d+s;if(r!=1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${r})!
`,a);return}let b=0,E=0,v=0;switch(a.subarray(n,d).forEach(x=>{b=b<<7,b|=x}),a.subarray(d,h).forEach((x,R)=>{E|=x<<R*7}),a.subarray(h).forEach((x,R)=>{v|=x<<R*7}),w()&&console.debug(`GM2 global parameter: (${a.subarray(3,d)}; p: ${E}, v: ${v})`),b){case 129:{E===0&&(e.setEffectType(0,52,v),e.dispatchEvent("efxreverb",e.getEffectType(0)));break}case 130:{E===0&&(e.setEffectType(1,52,v|16),e.dispatchEvent("efxchorus",e.getEffectType(1)));break}default:w()&&console.debug("GM2 global paramater slot path unknown.")}}),this.#S.add([76,0,0],(a,o,i)=>{switch(a[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset on drum kit ${a[1]}.`);break}case 126:{e.switchMode("xg",!0),e.setPortMode(e.getTrackPort(o),4,y.xg),e.#n=e.#n||e.KARAOKE_NONE,console.info("MIDI reset: XG");break}default:{e.dispatchEvent("mupromptex");let r=[0,0,0,0],s=(c,n)=>{r[n]=c};if(a.subarray(1).forEach((c,n)=>{let d=n+a[0];([s,s,s,s,h=>{this.#l=h*129/16383*100,e.dispatchEvent("mastervolume",e.#l)},h=>{},h=>{}][d]||(()=>{}))(c,n)}),a[0]<4){let c=0;r.forEach(n=>{c=c<<4,c+=n}),c-=1024}}}}).add([76,2,1],(a,o,i)=>{e.dispatchEvent("mupromptex");let r="XG ";a[0]<32?(r+="reverb ",a.subarray(1).forEach((s,c)=>{([n=>{e.setEffectTypeRaw(0,!1,n),console.info(`${r}main type: ${G[n]}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},n=>{e.setEffectTypeRaw(0,!0,n),console.debug(`${r}sub type: ${n+1}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},n=>{console.debug(`${r}time: ${ne(n)}s`)},n=>{console.debug(`${r}diffusion: ${n}`)},n=>{console.debug(`${r}initial delay: ${n}`)},n=>{console.debug(`${r}HPF cutoff: ${_[n]}Hz`)},n=>{console.debug(`${r}LPF cutoff: ${_[n]}Hz`)},n=>{console.debug(`${r}width: ${n}`)},n=>{console.debug(`${r}height: ${n}`)},n=>{console.debug(`${r}depth: ${n}`)},n=>{console.debug(`${r}wall type: ${n}`)},n=>{console.debug(`${r}dry/wet: ${n}`)},n=>{console.debug(`${r}send: ${P(n)}dB`)},n=>{console.debug(`${r}pan: ${n-64}`)},!1,!1,n=>{console.debug(`${r}delay: ${n}`)},n=>{console.debug(`${r}density: ${n}`)},n=>{console.debug(`${r}balance: ${n}`)},n=>{},n=>{console.debug(`${r}feedback: ${n}`)},n=>{}][a[0]+c]||function(){console.warn(`Unknown XG reverb address: ${a[0]}.`)})(s)})):a[0]<64?(r+="chorus ",a.subarray(1).forEach((s,c)=>{([n=>{e.setEffectTypeRaw(1,!1,n),console.info(`${r}main type: ${G[n]}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},n=>{e.setEffectTypeRaw(1,!0,n),console.debug(`${r}sub type: ${n+1}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},n=>{console.debug(`${r}LFO: ${ce[n]}Hz`)},n=>{},n=>{console.debug(`${r}feedback: ${n}`)},n=>{console.debug(`${r}delay offset: ${oe(n)}ms`)},n=>{},n=>{console.debug(`${r}low: ${_[n]}Hz`)},n=>{console.debug(`${r}low: ${n-64}dB`)},n=>{console.debug(`${r}high: ${_[n]}Hz`)},n=>{console.debug(`${r}high: ${n-64}dB`)},n=>{console.debug(`${r}dry/wet: ${n}`)},n=>{console.debug(`${r}send: ${P(n)}dB`)},n=>{console.debug(`${r}pan: ${n-64}`)},n=>{console.debug(`${r}to reverb: ${P(n)}dB`)},!1,n=>{},n=>{},n=>{},n=>{console.debug(`${r}LFO phase diff: ${(n-64)*3}deg`)},n=>{console.debug(`${r}input mode: ${n?"stereo":"mono"}`)},n=>{}][a[0]-32+c]||function(){console.warn(`Unknown XG chorus address: ${a[0]}.`)})(s)})):a[0]<86?(r+="variation ",a.subarray(1).forEach((s,c)=>{([n=>{e.setEffectTypeRaw(2,!1,n),console.info(`${r}main type: ${G[n]}`),e.dispatchEvent("efxdelay",e.getEffectType(2))},n=>{e.setEffectTypeRaw(2,!0,n),console.debug(`${r}sub type: ${n+1}`),e.dispatchEvent("efxdelay",e.getEffectType(2))}][a[0]-64+c]||function(){})(s)})):a[0]<97?(r+="variation ",a.subarray(1).forEach((s,c)=>{[n=>{console.debug(`${r}send: ${P(n)}dB`)},n=>{console.debug(`${r}pan: ${n-64}`)},n=>{console.debug(`${r}to reverb: ${P(n)}dB`)},n=>{console.debug(`${r}to chorus: ${P(n)}dB`)},n=>{console.debug(`${r}connection: ${n?"system":"insertion"}`)},n=>{console.debug(`${r}channel: CH${n+1}`)},n=>{console.debug(`${r}mod wheel: ${n-64}`)},n=>{console.debug(`${r}bend wheel: ${n-64}`)},n=>{console.debug(`${r}channel after touch: ${n-64}`)},n=>{console.debug(`${r}AC1: ${n-64}`)},n=>{console.debug(`${r}AC2: ${n-64}`)}][a[0]-86+c](s)})):a[0]>111&&a[0]<118?r+="variation ":console.warn(`Unknown XG variation address: ${a[0]}`)}).add([76,2,64],(a,o,i)=>{a.subarray(1).forEach((r,s)=>{let c=s+a[0];if(c===0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][r]}`);else{let n=c-1>>2,d=c-1&3,h=`XG EQ ${n} ${["gain","freq","Q","shape"][d]}: `;[()=>{console.debug(`${h}${r-64}dB`)},()=>{console.debug(`${h}${r} (raw)`)},()=>{console.debug(`${h}${r/10}`)},()=>{console.debug(`${h}${["shelf","peak"][+!!r]}`)}][d]()}})}).add([76,3],(a,o,i)=>{e.dispatchEvent("mupromptex");let r=a[0],s=a[1],c=`XG Insertion ${a[0]+1} `;a.subarray(2).forEach((n,d)=>{([h=>{e.setEffectTypeRaw(3+r,!1,h),console.info(`${c}main type: ${G[h]}`),e.dispatchEvent(`efxinsert${r}`,e.getEffectType(3+r))},h=>{e.setEffectTypeRaw(3+r,!0,h),console.debug(`${c}sub type: ${h+1}`),e.dispatchEvent(`efxinsert${r}`,e.getEffectType(3+r))}][s+d]||function(){})(n)})}).add([76,6,0],(a,o,i)=>{let r=a[0];r<64?e.setLetterDisplay(a.subarray(1),"XG letter display",r):e.#X=Date.now()}).add([76,7,0],(a,o,i)=>{let r=a[0];e.#E=0,e.#M=Date.now()+3200,e.#$.fill(0);let s=a.subarray(1);for(let c=0;c<r;c++)s.unshift(0);s.forEach(function(c,n){let d=Math.floor(n/16),h=n%16,b=(h*3+d)*7,E=7,v=0;for(b-=h*5,d===2&&(E=2);v<E;)e.#$[b+v]=c>>6-v&1,v++})}).add([76,8],(a,o)=>{e.dispatchEvent("mupromptex");let i=e.chRedir(a[0],o,!0),r=a[1],s=S[i],c=`XG CH${i+1} `,n=`Unknown XG part address ${r}.`,d=!0;a.subarray(2).forEach((h,b)=>{d=!0,r<1?console.debug(n):r<41?([()=>{e.setChCc(i,0,h),e.pushChPrimitives(i),e.dispatchEvent("voice",{part:i})},()=>{e.setChCc(i,32,h),e.pushChPrimitives(i),e.dispatchEvent("voice",{part:i})},()=>{e.#s[i]=h,e.dispatchEvent("voice",{part:i})},()=>{d=!1;let E=e.chRedir(h,o,!0);e.#u[i]=E,i!=E&&(e.buildRchTree(),console.info(`${c}receives from CH${E+1}`)),e.#v[i]||(e.copyChSetup(E,i,!0),console.debug(`${c}copied from CH${E+1}.`),e.setChActive(i,1),e.dispatchEvent("voice",{part:i}))},()=>{e.#y[i]=+!h},()=>{},()=>{d=!1,e.setChType(i,h,y.xg),console.debug(`${c}type: ${X[h]||h}`),e.dispatchEvent("voice",{part:i})},()=>{e.#r[p.rpn*i+3]=h,e.#c[p.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},!1,!1,()=>{e.setChCc(i,7,h)},!1,!1,()=>{e.setChCc(i,10,h||128)},!1,!1,()=>{e.setChCc(i,128,h),e.allocateAce(i,128)},()=>{e.setChCc(i,93,h)},()=>{e.setChCc(i,91,h)},()=>{e.setChCc(i,94,h)},()=>{e.setChCc(i,76,h)},()=>{e.setChCc(i,77,h)},()=>{e.setChCc(i,78,h)},()=>{e.setChCc(i,74,h)},()=>{e.setChCc(i,71,h)},()=>{e.setChCc(i,73,h)},()=>{e.setChCc(i,75,h)},()=>{e.setChCc(i,72,h)}][r+b-1]||(()=>{}))():r<48?console.debug(n):r<111?r>102&&r<105&&e.setChCc(i,[5,65][r&1],h):r<114?console.debug(n):r<116?console.debug(`${c}EQ ${["bass","treble"][r&1]} gain: ${h-64}dB`):r<118?console.debug(n):r<120?console.debug(`${c}EQ ${["bass","treble"][r&1]} freq: ${h}`):console.debug(n)}),d&&e.#a[i]>1&&e.setDrumFirstWrite(i)}).add([76,9],(a,o)=>{let i=e.chRedir(a[0],o,!0),r=a[1],s=S[i],c=`PLG-VL CH${i+1} `;a.subarray(2).forEach((n,d)=>{let h=d+r;switch(h){case 1:{console.info(`${c}breath mode: ${["system","breath","velocity","touch EG"][n]}`);break}case 0:case 27:case 28:break;default:if(h<27){let b=h-3>>1,E=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][b];h&1?h<23?(console.debug(`${c}${E} control source: ${de(n)}`),n&&n<96&&e.allocateAce(i,130+b),e.#F[p.redir*i+b+2]=n,e.buildRccMap()):console.debug(`${c}${E} scale break point: ${n}`):(console.debug(`${c}${E} depth: ${n-64}`),e.setChCc(i,130+b,n))}}})}).add([76,10],(a,o,i)=>{}).add([76,16],(a,o,i)=>{}).add([76,17,0,0],(a,o,i)=>{}).add([76,112],(a,o,i)=>{switch(console.debug(`XG enable PLG-${["VL","SG","DX","AN","PF","DR","PC","AP"][a[0]]} for CH${a[2]+1}.`),a[0]){case 0:{e.#k[p.ext*a[2]]=e.EXT_VL;break}case 2:{e.#k[p.ext*a[2]]=e.EXT_DX;break}default:e.#k[p.ext*a[2]]=e.EXT_NONE}}).add([73,0,0],(a,o)=>{let i=a[0],r="MU1000 System - ";a.subarray(1).forEach((s,c)=>{let n=i+c;n===8?console.debug(`${r}LCD contrast: ${s}.`):n===18?(e.#f[y.xg][1]=s?126:0,console.debug(`${r}default bank: ${s?"MU100 Native":"MU Basic"}.`),e.dispatchEvent("banklevel",{mode:"xg",data:+!!s}),e.forceVoiceRefresh()):n>=64&&n<69&&[()=>{e.dispatchEvent("channelactive",s)},()=>{s<8?(e.dispatchEvent("channelmin",s<<4),console.debug(`Octavia System: Minimum CH${(s<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{s<8?(e.dispatchEvent("channelmax",(s<<4)+15),console.debug(`Octavia System: Maximum CH${(s<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{e.#L=!!s,console.info(`Octavia System: RS receiving ${["dis","en"][s]}abled.`)}][n-64]()})}).add([73,10,0],(a,o)=>{let i=a[0],r=`MU1000 RS${e.#L?"":" (ignored)"}: `;if(i<16)switch(i){case 2:{let s=e.chRedir(0,o,!0);e.#L&&(e.dispatchEvent("portrange",4),e.dispatchEvent("portstart",s)),console.info(`${r}Show CH${s+1}~CH${s+64}`);break}case 3:{let s=e.chRedir(a[1]<<5,o,!0);e.#L&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",s)),console.info(`${r}Show CH${s+1}~CH${s+32}`);break}default:console.debug(`${r}unknown switch ${i} invoked.`)}else if(i<32){if(e.#L){let s=e.chRedir(i-16+(e.#le<<4),o,!0);e.dispatchEvent("channelactive",s)}}else if(i<36){let s=e.chRedir(i-32<<4,o,!0);e.#L&&(e.dispatchEvent("portrange",1),e.dispatchEvent("portstart",s>>4),e.#le=i-32),console.info(`${r}Show CH${s+1}~CH${s+16}`)}}).add([73,11,0],(a,o)=>{let i="MU1000 System - channel ",r="Octavia System - channel ",s=a[0];a.subarray(1).forEach((c,n)=>{let d=s+n;([()=>{e.setChActive(c,1),e.dispatchEvent("channelactive",c),w()&&console.debug(`${i}current part: CH${c+1}`)},()=>{c<5?(e.dispatchEvent("portrange",1<<c),console.debug(`${i}port range: ${1<<c} port(s)`)):(e.dispatchEvent("portrange",0),console.debug(`${i}port range: reset`))},()=>{c<16?(e.dispatchEvent("portstart",c),console.debug(`${r}start port: ${"ABCDEFGHIJKLMNOP"[c]}`)):(e.dispatchEvent("portstart",255),console.debug(`${r}start port: reset`))}][d]||(()=>{console.debug(`${i}unknown address: ${d}`)}))()})}).add([93,3],(a,o)=>{let i=e.chRedir(a[0],o,!0),r=`PLG-SG CH${i+1} `,s=Date.now();if(a[1]===0){let c="",n=0;a.subarray(2).forEach((d,h)=>{h%2===0?c+=le[d]||d.toString().padStart("0"):n+=d*13}),(s>=e.#W||e.#Q>=e.#be)&&(e.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),e.#Y=s<e.#W,e.#Q=0),e.dispatchEvent("metacommit",{type:"SGLyrics",data:`${he(c)}`,amend:!0,mask:e.#Y}),e.#Q++,e.#Y=!1,e.#W=s+Math.ceil(n/2)+e.#oe,w()&&console.debug(`${r}vocals: ${c}`)}else console.warn(`Unknown PLG-SG data: ${a}`)}).add([98,0],(a,o,i)=>{e.dispatchEvent("mupromptex");let r=a[0],s=a.length-5,c=a.length-1;if(r!=s){console.info(`PLG-DX native dump size mismatch! Gave ${r} instead of ${a.length-5}.`);return}let n=U(a.subarray(4,c));if(n!=a[c]){console.info(`Bad PLG-DX checksum ${a[c]} - should be ${n}.`);return}a[0]=98,e.#S.run(a.subarray(0,c),o,i,{noAce:!0})}).add([98,96],(a,o,i,r)=>{let s=e.chRedir(a[0],o,!0),c=S[s],n=a[1];a.subarray(2).forEach((d,h)=>{let b=n+h;if(!(b<10)){if(b===10)e.resetAce();else if(b<27){let E=b+131;r?.noAce||e.allocateAce(s,E),e.setChCc(s,E,d),e.dispatchEvent("cc",{part:s,cc:E,data:d})}}})}).add([100,0],(a,o,i)=>{let r=a.subarray(0,a.length-1);if(a[0]+5!=a.length){console.warn(`Yamaha DX7+ dump SysEx size mismatch! Expected ${a.length}, but got ${a[0]}:
`,a);return}let s=U(r),c=a[a.length-1];if(s!=c){console.warn(`Yamaha DX7+ dump SysEx checksum mismatch! Expected ${s}, but got ${c}:
`,a);return}l.run(r.subarray(1))}).add([100,76],(a,o,i)=>{let r=a[0]>>4,s=a[0]&15,c=a[1];switch(r){case 2:{let n=e.chRedir(s,o,!0),d=S[n];a.subarray(2).forEach((h,b)=>{let E=b+c;if(!(E<7)){if(E<23){let v=E+135;e.allocateAce(n,v),e.setChCc(n,v,h),e.dispatchEvent("cc",{part:n,cc:v,data:h})}}});break}default:console.info("Unknown DX7+ multipart: %o",a)}}).add([1,20],(a,o,i)=>{i===115?(e.switchMode("doc",!0),e.setPortMode(e.getTrackPort(o),1,y.doc),console.info("MIDI reset: DOC")):console.debug(`Unknown Yamaha SysEx: 67, ${i}, ${a.join(", ")}`)}).add([1,17,15,89],(a,o,i)=>{i===115?(e.setEffectType(0,24,a[0]|16),e.dispatchEvent("efxreverb",e.getEffectType(0))):console.debug(`Unknown Yamaha SysEx: 67, ${i}, ${a.join(", ")}`)}).add([1,24],(a,o,i)=>{if(i===115){for(let r=0;r<16;r++){let s=e.chRedir(r,o,!0);e.setChCc(s,91,127)}console.info("DOC Global Reverb: on")}else console.debug(`Unknown Yamaha SysEx: 67, ${i}, ${a.join(", ")}`)}),l.add([14,31],(a,o,i)=>{e.setChCc(a[0],64,0),e.#b.ano(a[0]),e.switchMode("xg"),e.setPortMode(e.getTrackPort(o),1,y.xg),e.resetAce(),console.debug(`Yamaha DX7+ reset CH${a[0]+1}.`)}).add([76,112],async a=>{let o=a[0],i=S[o],r=xe[o],s=p.cvn*o;e.#k[r]=e.EXT_DX,e.#P[o]=1;let c=e.#he.subarray(s,s+p.cvn);c.fill(32),a.subarray(1).forEach((n,d)=>{if(d<10)c[d]=Math.max(n,32);else if(!(d<40)){if(d<56){let h=d+102;e.setChCc(o,h,n),e.dispatchEvent("cc",{part:o,cc:h,data:n})}}}),e.#s[o]=o&127,e.setChCc(o,0,35),e.setChCc(o,32,o>>7|4),e.pushChPrimitives(o),e.dispatchEvent("voice",{part:o}),console.debug(`DX7+ CH${o+1} dump: %o`,a)});let u=function(a,o,i,r){},g=function(a,o){e.dispatchEvent("mupromptex");let i=a*p.dpn,r=o[0],s=o[1];o.subarray(2).forEach((c,n)=>{let d=n+s,h=-1;d<16?([()=>{h=24},()=>{h=25},()=>{h=26},()=>{},()=>{h=28},()=>{h=29},()=>{h=30},()=>{h=31},()=>{},()=>{},()=>{},()=>{h=20},()=>{h=21},()=>{h=22},()=>{h=23},()=>{}][d]||(()=>{console.debug(`Unknown XG-style drum param ${d} on set ${a+1}.`)}))():d<32||(d<40?([()=>{h=48},()=>{h=49},!1,!1,()=>{h=52},()=>{h=53}][d-32]||(()=>{console.debug(`Unknown XG-style drum param ${d} on set ${a+1}.`)}))():d<80||([()=>{h=36}][d-80]||(()=>{console.debug(`Unknown XG-style drum param ${d} on set ${a+1}.`)}))()),h>=0?(w()&&console.debug(i,h,r,c),e.#C[(i+L[h])*p.dnc+r]=c):w()&&console.debug(`XG-style drum param ${d} has no writes.`)})},C=function(a,o,i){e.dispatchEvent("mupromptex");let r=a*p.dpn,s=(o<<7)+i[0];i.subarray(1).forEach((c,n)=>{let d=n+s,h=d&127,b=d>>7,E=-1;b>1&&([()=>{E=26},()=>{},()=>{E=28},()=>{E=29},()=>{E=30},()=>{},()=>{},()=>{E=31}][b-2]||(()=>{console.debug(`Unknown GS-style drum param ${b} on set ${a+1}.`)}))(),E>-1?(w()&&console.debug(r,E,h,c),e.#C[(r+L[E])*p.dnc+h]=c):w()&&console.debug(`GS-style drum param ${b} has no writes.`)})};this.#S.add([76,48],(a,o,i)=>{g(0,a)}).add([76,49],(a,o,i)=>{g(1,a)}).add([76,50],(a,o,i)=>{g(2,a)}).add([76,51],(a,o,i)=>{g(3,a)}).add([76,52],(a,o,i)=>{g(4,a)}).add([76,53],(a,o,i)=>{g(5,a)}).add([76,54],(a,o,i)=>{g(6,a)}).add([76,55],(a,o,i)=>{g(7,a)}),this.#S.add([89,0],(a,o,i)=>{if(e.eprom){let r=a[0],s=(a[1]<<14)+(a[2]<<7)+a[3]+(e.eprom.offset||0);w()&&console.debug(`MU1000 EPROM trail to 0x${s.toString(16).padStart(6,"0")}, ${r} bytes.`);let c=e.eprom.data;a.subarray(4).forEach((n,d)=>{let h=d>>3,b=d&7;if(b===7)for(let E=0;E<7;E++)c[s+7*h+E]+=(n>>6-E&1)<<7;else c[s+7*h+b]=n})}}).add([89,1],(a,o,i)=>{let r=(a[0]<<21)+(a[1]<<14)+(a[2]<<7)+a[3];w()&&console.debug(`MU1000 EPROM jump to 0x${r.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=r)}).add([89,2],(a,o,i)=>{if(e.eprom){let r=(a[0]<<21)+(a[1]<<14)+(a[2]<<7)+a[3]+(e.eprom.offset||0);w()&&console.debug(`MU1000 EPROM write to 0x${r.toString(16).padStart(6,"0")}.`);let s=e.eprom.data;a.subarray(4).forEach((c,n)=>{let d=n>>3,h=n&7;if(h===7)for(let b=0;b<7;b++)s[r+7*d+b]+=(c>>6-b&1)<<7;else s[r+7*d+h]=c})}}).add([89,3],(a,o,i)=>{}),this.#S.add([39,48],(a,o,i)=>{}).add([43,0,0],(a,o,i)=>{e.dispatchEvent("mupromptex");let r=[0,0,0,0],s=(c,n)=>{r[n]=c};if(a.subarray(1).forEach((c,n)=>{let d=n+a[0];[s,s,s,s,()=>{this.#l=c*129/16383*100,e.dispatchEvent("mastervolume",e.#l)},()=>c-64,()=>c||128,()=>c,()=>c,()=>{console.debug(`TG300 variation on cc${c}.`)}][d](c,d)}),a[0]<4){let c=0;r.forEach(n=>{c=c<<4,c+=n}),c-=1024}}).add([43,1,0],(a,o,i)=>{e.dispatchEvent("mupromptex")}).add([43,2],(a,o,i)=>{e.dispatchEvent("mupromptex");let r=e.chRedir(a[0],o,!0),s=a[1],c=S[r],n=`TG300 CH${r+1} `;a.subarray(2).forEach((d,h)=>{h<5?([()=>{},()=>{e.setChCc(r,0,d),e.pushChPrimitives(r),e.dispatchEvent("voice",{part:r})},()=>{e.setChCc(r,32,d),e.pushChPrimitives(r),e.dispatchEvent("voice",{part:r})},()=>{e.#s[r]=d,e.dispatchEvent("voice",{part:r})},()=>{let b=e.chRedir(d,o,!0);e.#u[r]=b,r!=b&&(e.buildRchTree(),console.info(`${n}receives from CH${b+1}`))}][h+s]||(()=>{}))(d,h+s):h<21||(h<47?([()=>{e.#y[r]=+!d},()=>{},()=>{},()=>{e.#r[p.rpn*r+3]=d,e.#c[p.rpnt*r+2]=1,e.dispatchEvent("pitch",{part:r,pitch:e.getPitchShift(r)})},()=>{},()=>{e.setChCc(r,7,d)},!1,!1,()=>{e.setChCc(r,10,d||128)},!1,!1,()=>{console.debug(`${n} AC1 at cc${d}`)},()=>{console.debug(`${n} AC2 at cc${d}`)},()=>{e.#e[c+m[128]]=d,e.allocateAce(r,128)},()=>{e.#e[c+m[93]]=d},()=>{e.#e[c+m[91]]=d},()=>{e.#e[c+m[94]]=d},()=>{e.#e[c+m[76]]=d},()=>{e.#e[c+m[77]]=d},()=>{e.#e[c+m[74]]=d},()=>{e.#e[c+m[71]]=d},()=>{e.#e[c+m[73]]=d},()=>{e.#e[c+m[75]]=d},()=>{e.#e[c+m[72]]=d},()=>{e.#e[c+m[78]]=d}][h+s-21]||(()=>{}))(d,h+s):h<95||([()=>{e.#e[c+m[65]]=d},()=>{e.#e[c+m[5]]=d}][h+s-95]||(()=>{}))(d,h+s))})}).add([43,7,0],(a,o,i)=>{let r=a[0];e.setLetterDisplay(a.subarray(1),"TG300 letter display",r)}).add([43,7,1],(a,o,i)=>{e.#E=0,e.#M=Date.now()+3200,e.#$.fill(0),a.forEach(function(r,s){let c=Math.floor(s/16),n=s%16,d=(n*3+c)*7,h=7,b=0;for(d-=n*5,c===2&&(h=2);b<h;)e.#$[d+b]=r>>6-b&1,b++})}),this.#T.add([66,18,0,0,127],(a,o,i)=>{e.switchMode("sc",!0),e.setPortMode(e.getTrackPort(o),2,y.sc),e.#f[y.sc][1]=e.#i.sc,e.#n=e.KARAOKE_NONE,e.#H.fill(0),console.info(`GS system to ${["single","dual"][a[0]]} mode.`)}).add([66,18,64,0],(a,o,i)=>{switch(a[0]){case 127:{e.switchMode("gs",!0),e.setPortMode(e.getTrackPort(o),4,y.gs),e.#f[y.gs][1]=e.#i.gs,e.#n=e.KARAOKE_NONE,e.#H.fill(0),console.info("MIDI reset: GS");break}default:{e.dispatchEvent("mupromptex");let r=[0,0,0,0],s=(c,n)=>{r[n]=c};if(a.subarray(1).forEach((c,n)=>{let d=n+a[0];[s,s,s,s,h=>{this.#l=h*129/16383*100,e.dispatchEvent("mastervolume",e.#l)},h=>{},h=>{}][d](c,n)}),a[0]<4){let c=0;r.forEach(n=>{c=c<<4,c+=n}),c-=1024}}}}).add([66,18,64,1],(a,o,i)=>{e.dispatchEvent("mupromptex");let r=a[0];if(r<16){let s="".padStart(r," ");a.subarray(1).forEach((c,n)=>{s+=String.fromCharCode(Math.max(32,c))}),s=s.padEnd(16," "),console.debug(`GS patch name: ${s}`)}else r<48||(r<65?a.subarray(1).forEach((s,c)=>{let n=`GS ${r+c>55?"chorus":"reverb"} `;([()=>{console.info(`${n}type: ${J[s]}`),e.setEffectType(0,40,s),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${n}predelay: ${s}ms`)},()=>{console.info(`${n}type: ${pe[s]}`),e.setEffectType(1,40,16+s),e.dispatchEvent("efxchorus",e.getEffectType(1))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${n}to reverb: ${P(s)}`)},()=>{console.debug(`${n}to delay: ${P(s)}`)}][r+c-48]||(()=>{}))()}):r<80?console.debug(`Unknown GS patch address: ${r}`):r<91?a.subarray(1).forEach((s,c)=>{let n="GS delay ";([()=>{console.info(`${n}type: ${be[s]}`),e.setEffectType(2,40,32+s),e.dispatchEvent("efxdelay",e.getEffectType(2))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${n}to reverb: ${P(s)}`)}][r+c-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${r}`))}).add([66,18,64,2],(a,o,i)=>{let r="GS EQ ";a.subarray(1).forEach((s,c)=>{([()=>{console.debug(`${r}low freq: ${[200,400][s]}Hz`)},()=>{console.debug(`${r}low gain: ${s-64}dB`)},()=>{console.debug(`${r}high freq: ${[3e3,6e3][s]}Hz`)},()=>{console.debug(`${r}high gain: ${s-64}dB`)}][a[0]+c]||function(){console.warn(`Unknown GS EQ address: ${a[0]+c}`)})()})}).add([66,18,64,3],(a,o,i)=>{e.dispatchEvent("mupromptex");let r="GS EFX ",s=function(c,n){let d=Ee(e.#w.subarray(10,12),n,c);d&&console.debug(`${r}${Z(e.#w.subarray(10,12))} ${d}`)};a.subarray(1).forEach((c,n)=>{([()=>{e.setEffectTypeRaw(3,!1,32+c),e.dispatchEvent("efxinsert0",e.getEffectType(3))},()=>{e.setEffectTypeRaw(3,!0,c),console.info(`${r}type: ${Z(e.#w.subarray(10,12))}`),e.dispatchEvent("efxinsert0",e.getEffectType(3))},!1,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,()=>{console.debug(`${r}to reverb: ${P(c)}dB`)},()=>{console.debug(`${r}to chorus: ${P(c)}dB`)},()=>{console.debug(`${r}to delay: ${P(c)}dB`)},!1,()=>{console.debug(`${r}1 source: ${c}`),c&&c<96&&e.allocateAceAll(c)},()=>{console.debug(`${r}1 depth: ${c-64}`)},()=>{console.debug(`${r}2 source: ${c}`),c&&c<96&&e.allocateAceAll(c)},()=>{console.debug(`${r}2 depth: ${c-64}`)},()=>{console.debug(`${r}to EQ: ${c?"ON":"OFF"}`)}][a[0]+n]||function(d,h){console.warn(`Unknown GS EFX address: ${h}`)})(c,a[0]+n)})}).add([66,18,65],(a,o,i)=>{C((a[0]>>4)+1<<1,a[0]&15,a.subarray(1))}).add([69,18,16],(a,o,i)=>{switch(a[0]){case 0:{let r=a[1];e.setLetterDisplay(a.subarray(2),"GS display text",r);break}case 8:{let r=a[1],s=e.modelEx.sc;a.subarray(2).forEach((c,n)=>{([()=>{s.showBar=!(c&1),s.invBar=c>>1&1,s.invDisp=c>>2&1},()=>{s.peakHold=c<4?c:1}][n+r]||(()=>{console.debug("Unsupported GS display type SysEx.")}))()});break}case 32:{e.#M=Date.now()+3200,a[1]===0&&(a[2]?(e.#E=Math.max(Math.min(a[2]-1,9),0),w()&&console.debug(`GS switch display page ${a[2]-1}.`)):(e.#E=0,e.#M=Date.now(),w()&&console.debug("GS disable display page.")));break}default:if(a[0]<6){e.#E>9&&(e.#E=0);let r=a[0]-1<<1|a[1]>>6;e.#E===r&&(e.#M=Date.now()+3200),e.#U[r]?.length||(e.#U[r]=new Uint8Array(256));let s=e.#U[r];w()&&console.debug(`GS frame draw page ${r}.`);let c=a[1]&63;s.fill(0),a.subarray(2).forEach(function(d,h){let b=h+c,E=Math.floor(b/16),v=b%16,x=(v*4+E)*5,R=5,O=0;for(x-=v*4,E===3&&(R=1);O<R;)s[x+O]=d>>4-O&1,O++})}else console.warn(`Unknown GS display section: ${a[0]}`)}}).add([69,18,32],(a,o,i)=>{let r=a[0],s=a[1],c=a.subarray(2);if(r>>4){console.warn(`SC-8850 partial screen dump out of bounds: invalid bundle.
`,a);return}let n=s+c.length,d=s*6-(s*2428>>16<<1),h=n*6-(n*2428>>16<<1);if(d>640){console.warn(`SC-8850 partial screen dump out of bounds: invalid buffer range.
`,a);return}h>640&&(console.info(`SC-8850 partial screen dump out of bounds: invalid buffer end, automatically restricted.
`,a),h=640);let b=new Uint8Array(h-d);c.forEach((x,R)=>{let O=R+s,M=(O*2428&65535)*27>>16===26,W=O*6-(O*2428>>16<<1),F=M?2:0;for(;F<6;)b[W+(5-F)]=x>>F&1,F++});let E=r*108+s,v=E*6-(E*2428>>16<<1);e.dispatchEvent("screen",{type:"sc8850",offset:v,data:b}),w()&&console.debug(`SC-8850 screen dump: bundle ${r+1}, range ${d}~${h}`)});let $=function(a,o,i){e.dispatchEvent("mupromptex");let r=a[0],s=S[o],c=z[o],n=`GS CH${o+1} `;r<3?(a.subarray(1).forEach((d,h)=>{[()=>{e.#e[s+m[0]]=d,e.pushChPrimitives(o)},()=>{e.#s[o]=d},()=>{let b=0;d<16?b=e.chRedir(d,i,!0):b=p.ch,e.#u[o]=b,o!=b&&(e.buildRchTree(),console.info(`${n}receives from CH${b+1}`))}][r+h]()}),e.dispatchEvent("voice",{part:o})):r<19||(r<44?a.subarray(1).forEach((d,h)=>{([()=>{e.#y[o]=+!d},!1,()=>{e.setChType(o,d<<1,y.gs),console.debug(`${n}type: ${d?"drum ":"melodic"}${d||""}`)},()=>{e.#r[c+3]=d,e.#c[p.rpnt*o+2]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)})},!1,()=>{e.#e[s+m[7]]=d},!1,!1,()=>{e.#e[s+m[10]]=d||128},!1,!1,()=>{console.debug(`${n}CC 1: cc${d}`)},()=>{console.debug(`${n}CC 2: cc${d}`)},()=>{e.#e[s+m[93]]=d},()=>{e.#e[s+m[91]]=d},!1,!1,()=>{e.#r[c+1]=d,e.#c[p.rpnt*o+1]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)})},()=>{e.#r[c+2]=d,e.#c[p.rpnt*o+1]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)})},()=>{e.#e[s+m[94]]=d}][r+h-19]||(()=>{}))()}):r<76||console.debug(`Unknown GS part address: ${r}`))},k=function(a,o){let i=a[0],r=`GS CH${o+1} `;i<2?a.subarray(1).forEach((s,c)=>{[()=>{e.setChCc(o,32,s)},()=>{}][i+c]()}):i<32?console.warn(`Unknown GS misc address: ${i}`):i<35?a.subarray(1).forEach((s,c)=>{[()=>{console.debug(`${r}EQ: o${["ff","n"][s]}`)},()=>{},()=>{console.debug(`${r}EFX: o${["ff","n"][s]}`),e.#ie[o]=s,e.dispatchEvent("partefxtoggle",{part:o,active:s})}][i+c-32]()}):console.warn(`Unknown GS misc address: ${i}`)};this.#T.add([66,18,64,16],(a,o)=>{$(a,e.chRedir(9,o,!0),o)}).add([66,18,64,17],(a,o)=>{$(a,e.chRedir(0,o,!0),o)}).add([66,18,64,18],(a,o)=>{$(a,e.chRedir(1,o,!0),o)}).add([66,18,64,19],(a,o)=>{$(a,e.chRedir(2,o,!0),o)}).add([66,18,64,20],(a,o)=>{$(a,e.chRedir(3,o,!0),o)}).add([66,18,64,21],(a,o)=>{$(a,e.chRedir(4,o,!0),o)}).add([66,18,64,22],(a,o)=>{$(a,e.chRedir(5,o,!0),o)}).add([66,18,64,23],(a,o)=>{$(a,e.chRedir(6,o,!0),o)}).add([66,18,64,24],(a,o)=>{$(a,e.chRedir(7,o,!0),o)}).add([66,18,64,25],(a,o)=>{$(a,e.chRedir(8,o,!0),o)}).add([66,18,64,26],(a,o)=>{$(a,e.chRedir(10,o,!0),o)}).add([66,18,64,27],(a,o)=>{$(a,e.chRedir(11,o,!0),o)}).add([66,18,64,28],(a,o)=>{$(a,e.chRedir(12,o,!0),o)}).add([66,18,64,29],(a,o)=>{$(a,e.chRedir(13,o,!0),o)}).add([66,18,64,30],(a,o)=>{$(a,e.chRedir(14,o,!0),o)}).add([66,18,64,31],(a,o)=>{$(a,e.chRedir(15,o,!0),o)}).add([66,18,64,64],(a,o)=>{k(a,e.chRedir(9,o,!0))}).add([66,18,64,65],(a,o)=>{k(a,e.chRedir(0,o,!0))}).add([66,18,64,66],(a,o)=>{k(a,e.chRedir(1,o,!0))}).add([66,18,64,67],(a,o)=>{k(a,e.chRedir(2,o,!0))}).add([66,18,64,68],(a,o)=>{k(a,e.chRedir(3,o,!0))}).add([66,18,64,69],(a,o)=>{k(a,e.chRedir(4,o,!0))}).add([66,18,64,70],(a,o)=>{k(a,e.chRedir(5,o,!0))}).add([66,18,64,71],(a,o)=>{k(a,e.chRedir(6,o,!0))}).add([66,18,64,72],(a,o)=>{k(a,e.chRedir(7,o,!0))}).add([66,18,64,73],(a,o)=>{k(a,e.chRedir(8,o,!0))}).add([66,18,64,74],(a,o)=>{k(a,e.chRedir(10,o,!0))}).add([66,18,64,75],(a,o)=>{k(a,e.chRedir(11,o,!0))}).add([66,18,64,76],(a,o)=>{k(a,e.chRedir(12,o,!0))}).add([66,18,64,77],(a,o)=>{k(a,e.chRedir(13,o,!0))}).add([66,18,64,78],(a,o)=>{k(a,e.chRedir(14,o,!0))}).add([66,18,64,79],(a,o)=>{k(a,e.chRedir(15,o,!0))}),this.#N.add([54,65],(a,o)=>{let i=e.#i.x5==="81"?"05rw":"x5d";e.switchMode(i,!0),e.setPortMode(e.getTrackPort(o),1,y[i]);let r=a[a.length-1],s=a.subarray(0,a.length-1),c=U(s);c!=r&&(console.info(`X5D multi parameters checksum mismatch! Expected ${c}, got ${r}.`),console.debug(a));let n=(a[1]<<7)+a[0],d=(a[3]<<7)+a[2],h=e.chRedir(n&15,o,!0),b=S[h];[()=>{d<1||(d<101?(e.setChType(h,e.CH_MELODIC,y.x5d),e.#s[h]=d-1,e.#e[b+m[0]]=e.#i.x5):d<229?(e.setChType(h,e.CH_MELODIC,y.x5d),e.#s[h]=d-101,e.#e[b+m[0]]=56):(e.setChType(h,e.CH_DRUMS,y.x5d),e.#s[h]=ke[d-229]||0,e.#e[b+m[0]]=62)),e.pushChPrimitives(h),e.dispatchEvent("voice",{part:h})},()=>{e.#e[b+m[7]]=d},()=>{d<31&&(e.#e[b+m[10]]=Math.round((d-15)*4.2+64))},()=>{e.#e[b+m[93]]=K(d)},()=>{e.#e[b+m[91]]=K(d)},()=>{e.#r[h*p.rpn+3]=d>8191?d-16320:64+d,e.#c[p.rpnt*h+2]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)})},()=>{e.#r[h*p.rpn+1]=d>8191?d-16320:64+d,e.#c[p.rpnt*h+1]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)})},()=>{d>0&&(e.#r[h*p.rpn]=d,e.#c[p.rpnt*h]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)}))},()=>{}][n>>4]()}).add([54,76,0],(a,o)=>{e.dispatchEvent("mupromptex");let i=e.#i.x5==="81"?"05rw":"x5d";e.switchMode(i),e.setPortMode(e.getTrackPort(o),1,y[i]);let r="",s=e.#i.x5,c=0,n=0,d="MSB	PRG	LSB	NME";A(a,function(h,b){if(b<16400){let E=b%164;switch(!0){case E<10:{h>31&&(r+=String.fromCharCode(h));break}case E===10:break;case E===11:{d+=`
${s}	${c}	${n}	${r.trim().replace("Init Voice","")}`,c++,r="";break}}c>99&&(s=90,c=0)}}),e.userBank.clearRange({msb:e.#i.x5,prg:[0,99],lsb:0}),e.userBank.load(d),w()&&console.debug(d),e.forceVoiceRefresh()}).add([54,77,0],(a,o)=>{e.dispatchEvent("mupromptex");let i=e.#i.x5==="81"?"05rw":"x5d";e.switchMode(i),e.setPortMode(e.getTrackPort(o),1,y[i]);let r="",s=90,c=0,n=0,d="MSB	PRG	LSB	NME";A(a,function(h,b){if(b<13600){let E=b%136;switch(!0){case E<10:{h>31&&(r+=String.fromCharCode(h));break}case E===11:{d+=`
${s}	${c}	${n}	${r.trim().replace("Init Combi","")}`,c++,r="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(d),w()&&console.debug(d),e.forceVoiceRefresh()}).add([54,78],(a,o)=>{let i=e.#i.x5==="81"?"05rw":"x5d";e.switchMode(i),e.setPortMode(e.getTrackPort(o),1,y[i]),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][a[0]]} mode.`)}).add([54,85],(a,o)=>{e.dispatchEvent("mupromptex");let i=e.#i.x5==="81"?"05rw":"x5d";e.switchMode(i),e.setPortMode(e.getTrackPort(o),1,y[i]),A(a,(r,s)=>{s>0&&s<3&&(e.setEffectType(s-1,44,r),e.dispatchEvent(`efx${["reverb","chorus"][s-1]}`,e.getEffectType(s-1)))})}).add([54,104],(a,o)=>{e.dispatchEvent("mupromptex");let i=e.#i.x5==="81"?"05rw":"x5d";e.switchMode(i,!0);let r=e.getTrackPort(o);if(e.#d[r]&&e.#d[r]!=y[i])if(e.#A.dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${o}. Port ${String.fromCharCode(65+r)} mode "${T[e.#d[r]]}" mismatch, should be "${i}".`);return}else console.info(`Track ${o} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+r)}.`);e.setPortMode(r,1,y[i]),A(a,function(s,c,n,d){if(c<192){let h=e.chRedir(Math.floor(c/12),o,!0),b=S[h];switch(c%12){case 0:{s<128?(e.setChType(h,e.CH_MELODIC,y.x5d),e.#e[b+m[0]]=e.#i.x5,e.#s[h]=s):(e.setChType(h,e.CH_DRUMS,y.x5d),e.#e[b+m[0]]=62,e.#s[h]=ke[s-128]),s>0&&e.setChActive(h,1),e.pushChPrimitives(h),e.dispatchEvent("voice",{part:h});break}case 1:{e.#e[b+m[7]]=s;break}case 2:{e.#r[h*p.rpn+3]=s>127?s-192:64+s,e.#c[p.rpnt*h+2]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)});break}case 3:{e.#r[h*p.rpn+1]=s>127?s-192:64+s,e.#c[p.rpnt*h+1]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)});break}case 4:{s<31&&(e.#e[b+m[10]]=Math.round((s-15)*4.2+64));break}case 5:{let E=s>>4,v=s&15;e.#e[b+m[91]]=K(v),e.#e[b+m[93]]=K(E);break}case 10:{e.#a[h]||(e.#e[b+m[0]]=s>>6?56:e.#i.x5,e.pushChPrimitives(h),e.dispatchEvent("voice",{part:h}));break}case 11:{let E=e.chRedir(s&15,o,!0),v=s>>4;e.#u[h]=s,(E!=h||v)&&(console.info(`X5D Part CH${h+1} receives from CH${E+1}.`),e.buildRchTree())}}}else{let h=e.chRedir(c-192,o,!0)}})}),this.#T.add([22,18,127],(a,o,i)=>{e.switchMode("mt32",!0),e.setPortMode(e.getTrackPort(o),1,y.mt32),e.#n=e.KARAOKE_NONE,e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(a,o,i)=>{e.switchMode("mt32");let r=e.chRedir(i,o,!0),s=a[1];a.subarray(2).forEach((c,n)=>{let d=n+s;e.#I[d+(r-1)*16]=c,([!1,()=>{let h=e.#I[r-1<<4];if(h<3){if(e.#P[r]=1,h===2)for(let b=0;b<name.length;b++)e.#O[(r-1)*p.cmt+b]=e.#B[c*p.cmt+b];else{let b=e.baseBank.get(0,c+(h<<6),127,"mt32").name;for(let E=0;E<b.length;E++)e.#O[(r-1)*p.cmt+E]=b.charCodeAt(E)}e.dispatchEvent("voice",{part:r})}},()=>{e.#r[r*p.rpn+3]=c+40,e.#c[p.rpnt*r+2]=1},()=>{e.#r[r*p.rpn+1]=c+14,e.#c[p.rpnt*r+1]=1},()=>{e.#r[r*p.rpn]=c,e.#c[p.rpnt*r]=1},!1,()=>{e.setChCc(r,91,c?127:0)},!1,()=>{e.setChCc(r,7,c)},()=>{e.setChCc(r,10,Math.ceil(c*9.05))}][d]||(()=>{}))()})}).add([22,18,1],(a,o,i)=>{e.switchMode("mt32");let r=i&7;console.debug(`MT-32 slot #${i+1} Drum: ${a}`);let s=a[0]<<7|a[1];a.subarray(2).forEach((c,n)=>{let d=n+s,h=(d>>2)+24,b=d&3,E=r*p.dpn;if(w()&&console.debug(`MT-32 temp drum note ${h} param ${b}: ${c}`),h<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${h}`);return}[()=>{},()=>{e.#C[(E+L[26])*p.dnc+h]=Math.round(c*1.27)},()=>{e.#C[(E+L[26])*p.dnc+h]=c*9+1&127},()=>{e.#C[(E+L[26])*p.dnc+h]=c?127:0}][b]()})}).add([22,18,2],(a,o,i)=>{e.switchMode("mt32");let r=e.chRedir(i,o,!0),s=a[1]+(a[0]<<7);s<10&&(e.#P[r]=1),a.subarray(2).forEach((c,n)=>{let d=n+s;d<14&&(e.#O[(r-1)*p.cmt+d]=c)}),e.dispatchEvent("voice",{part:r})}).add([22,18,3],(a,o,i)=>{e.switchMode("mt32");let r=i&7;if(a[0]){let s=(a[0]-1<<7)+a[1]-16;a.subarray(2).forEach((c,n)=>{let d=n+s,h=(d>>2)+24,b=d&3,E=r*p.dpn;if(w()&&console.debug(`MT-32 dev drum note ${h} param ${b}: ${c}`),h<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${h}`);return}[()=>{},()=>{e.#C[(E+L[26])*p.dnc+h]=Math.round(c*1.27)},()=>{e.#C[(E+L[26])*p.dnc+h]=c*9+1&127},()=>{e.#C[(E+L[26])*p.dnc+h]=c?127:0}][b]()})}else{let s=a[1];a.subarray(2).forEach((c,n)=>{let d=n+s;e.#I[d]=c;let h=e.chRedir(1+(d>>4),o,!0),b=d&15;([!1,()=>{let E=e.#I[h-1<<4];if(E<3)if(e.#P[h]=1,E===2)for(let v=0;v<name.length;v++)e.#O[(h-1)*p.cmt+v]=e.#B[c*p.cmt+v];else{let v=e.baseBank.get(0,c+(E<<6),127,"mt32").name;for(let x=0;x<v.length;x++)e.#O[(h-1)*p.cmt+x]=v.charCodeAt(x)}e.dispatchEvent("voice",{part:h})},()=>{e.#r[h*p.rpn+3]=c+40,e.#c[p.rpnt*h+2]=1},()=>{e.#r[h*p.rpn+1]=c+14,e.#c[p.rpnt*h+1]=1},()=>{e.#r[h*p.rpn]=c,e.#c[p.rpnt*h]=1},!1,()=>{e.setChCc(h,91,c?127:0)},!1,()=>{e.setChCc(h,7,c)},()=>{e.setChCc(h,10,Math.ceil(c*9.05))}][b]||(()=>{}))()})}}).add([22,18,4],(a,o,i)=>{e.switchMode("mt32");let r=a[1]+(a[0]<<7),s=[];a.subarray(2).forEach((c,n)=>{let d=n+r,h=e.chRedir(Math.floor(d/246+1),o,!0),b=d%246;b<14&&(e.#O[(h-1)*p.cmt+b]=c),b<10&&(e.#P[h]=1),s.indexOf(h)<0&&s.push(h)}),s.forEach(c=>{e.dispatchEvent("voice",{part:c})})}).add([22,18,5],(a,o,i)=>{e.switchMode("mt32");let r=(a[0]<<7)+a[1];a.subarray(2).forEach((s,c)=>{let n=r+c,d=Math.floor(n/8),h=n&7,b=d*8;e.#ne[n]=s,([!1,()=>{let E=e.#ne[b];if(E<3){let v="";if(E===2){let R=p.cmt*d;v=`MT-m:${s.toString().padStart(3,"0")}`}else v=e.baseBank.get(0,s+(E<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:d});let x=`MSB	LSB	PRG	NME
49	127	${d}	${v}`;e.userBank.load(x,!0)}}][h]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(a,o,i)=>{e.switchMode("mt32");let r=((a[0]&1)<<7)+a[1],s=a[0]>>1,c=!1;if(a.subarray(2).forEach((n,d)=>{let h=r+d;h<p.cmt&&(e.#B[s*p.cmt+h]=n,c=!0)}),c){e.userBank.clearRange({msb:0,lsb:127,prg:s});let n=`MSB	LSB	PRG	NME
49	127	${s}	MT-m:${s}`;e.userBank.load(n,!0)}e.forceVoiceRefresh()}).add([22,18,16],(a,o,i)=>{e.switchMode("mt32");let r=a[1],s=!1,c=function(n,d){e.#u[d-12]=n,s=!0};a.subarray(2).forEach((n,d)=>{let h=d+r;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,c,c,c,c,c,c,c,c,c,()=>{e.#l=n,e.dispatchEvent("mastervolume",e.#l)}][h]||(()=>{}))(n,d)}),s&&e.buildRchTree()}).add([22,18,32],(a,o,i)=>{e.switchMode("mt32");let r=a[1],s=" ".repeat(r);a.subarray(2).forEach(c=>{c>31?s+=String.fromCharCode(c):s+=" "}),e.#G=s.padStart(20," "),e.#X=Date.now()+3200}).add([22,18,82],(a,o)=>{let i=e.chRedir(0,o,!0);for(let r=0;r<16;r++)e.#b.ano(i+r),r&&r<10&&(e.#s[i+r]=ee[r-1]);console.info("MT-32 alt reset complete.")}),this.#N.add([66,0],(a,o)=>{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(o),2,y.ns5r),e.#n=e.KARAOKE_NONE,console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][a[0]]} mode.`)}).add([66,1],(a,o)=>{let i=["ns5r","05rw"][a[0]];e.switchMode(i,!0),e.setPortMode(e.getTrackPort(o),2,y[i]),e.#n=e.KARAOKE_NONE}).add([66,18,0,0],(a,o)=>{let i=a[0];switch(i){case 124:case 126:case 127:{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(o),2,y.ns5r),e.#n=e.KARAOKE_NONE;break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset on drum kit ${a[1]}.`);break}default:if(i<10){let r=[0,0,0,0],s=(c,n)=>{r[n]=c};if(a.subarray(1).forEach((c,n)=>{[s,s,s,s,()=>{e.#l=c*129/16383*100,e.dispatchEvent("mastervolume",e.#l)},()=>c-64,()=>c-64,()=>{},()=>{},()=>{}][i+n]()}),a[0]<4){let c=0;r.forEach(n=>{c=c<<4,c+=n}),c-=1024}}}}).add([66,18,0,1],(a,o)=>{}).add([66,18,0,2],(a,o)=>{}).add([66,18,1],(a,o)=>{e.dispatchEvent("mupromptex");let i=e.chRedir(a[0],o,!0),r=S[i],s=a[1],c=`NS5R CH${i+1} `;a.subarray(2).forEach((n,d)=>{let h=s+d;h<3?([()=>{e.#e[r+m[0]]=n||V.bank0,e.pushChPrimitives(i)},()=>{e.#e[r+m[32]]=n,e.pushChPrimitives(i)},()=>{e.#s[i]=n}][h](),e.dispatchEvent("voice",{part:i})):h<8||(h<14?[()=>{let b=e.chRedir(n,o,!0);e.#u[i]=b,i!=b&&(e.buildRchTree(),console.info(`${c}receives from CH${b+1}`))},()=>{e.#y[i]=+!n},()=>{e.setChType(i,n,y.ns5r),console.debug(`${c}type: ${X[n]}`)},()=>{e.#r[p.rpn*i+3]=n,e.#c[p.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{},()=>{}][h-8]():h<16||(h<33?[()=>{e.#e[r+m[7]]=n},()=>{e.#e[r+m[11]]=n},()=>{},()=>{},()=>{e.#e[r+m[10]]=n||128},()=>{},()=>{},()=>{e.#e[r+m[93]]=n},()=>{e.#e[r+m[91]]=n},()=>{e.#e[r+m[76]]=n},()=>{e.#e[r+m[77]]=n},()=>{e.#e[r+m[78]]=n},()=>{e.#e[r+m[74]]=n},()=>{e.#e[r+m[71]]=n},()=>{e.#e[r+m[73]]=n},()=>{e.#e[r+m[75]]=n},()=>{e.#e[r+m[72]]=n}][h-16]():h<112||h<114&&[()=>{e.#e[r+m[5]]=n},()=>{e.#e[r+m[65]]=n}][h-112]()))})}).add([66,18,8,0],(a,o)=>{let i=a[0];if(i<32)e.setLetterDisplay(a.subarray(1,33),"NS5R letter display");else{let r=i-32;e.#M=Date.now()+3200,e.#E=10,e.#$.fill(0);let s=a.subarray(1),c=4;s.forEach(function(n,d){let h=d+r,b=h>>4,E=h&15;if(h<80){let v=b<c?n:n>>3,x=0,R=b<c?6:3;for(;v>0;)e.#$[E*32+b*7+(R-x)]=v&1,v=v>>1,x++}})}}).add([66,18,48],(a,o,i)=>{g(0,a)}).add([66,18,49],(a,o,i)=>{g(1,a)}).add([66,18,50],(a,o,i)=>{g(2,a)}).add([66,18,51],(a,o,i)=>{g(3,a)}).add([66,18,52],(a,o,i)=>{g(4,a)}).add([66,18,53],(a,o,i)=>{g(5,a)}).add([66,18,54],(a,o,i)=>{g(6,a)}).add([66,18,55],(a,o,i)=>{g(7,a)}).add([66,52],(a,o)=>{e.switchMode("ns5r"),e.#n=e.KARAOKE_NONE;let i="";A(a,(r,s)=>{s<8?(r>31&&(i+=String.fromCharCode(r)),s===7&&(e.aiEfxName=i)):s<10&&(e.setEffectType(s-8,44,r),e.dispatchEvent(`efx${["reverb","chorus"][s-8]}`,e.getEffectType(s-8)))})}).add([66,53],(a,o)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r"),e.#n=e.KARAOKE_NONE;let i="",r=a[a.length-1],s=a.subarray(0,a.length-1),c=U(s);c!=r&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${c}, got ${r}.`),console.debug(a));let n=e.getTrackPort(o);if(e.#d[n]&&e.#d[n]!=y.ns5r)if(e.#A.dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${o}. Port ${String.fromCharCode(65+n)} mode "${T[e.#d[n]]}" mismatch, should be "ns5r".`);return}else console.info(`Track ${o} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+n)}.`);e.setPortMode(n,2,y.ns5r),A(s,function(d,h){switch(!0){case h<2944:{let b=e.chRedir(Math.floor(h/92),o,!0),E=S[b];switch(h%92){case 0:{e.#e[E+m[0]]=d,e.pushChPrimitives(b),e.dispatchEvent("voice",{part:b});break}case 1:{e.#e[E+m[32]]=d,!d&&!e.#e[E+m[0]]&&(e.#e[E+m[0]]=V.bank0),e.pushChPrimitives(b),e.dispatchEvent("voice",{part:b});break}case 2:{e.#s[b]=d,d>0&&e.setChActive(b,1),e.dispatchEvent("voice",{part:b});break}case 3:{let v=e.chRedir(d,o,!0);e.#u[b]=v,b!=v&&(console.info(`NS5R CH${b+1} receives from CH${v+1}.`),e.buildRchTree());break}case 7:{e.#a[b]=d,e.dispatchEvent("voice",{part:b});break}case 8:{e.#r[b*p.rpn+3]=d<40||d>88?d+(d>63?-192:64):d,e.#c[p.rpnt*b+2]=1,e.dispatchEvent("pitch",{part:b,pitch:e.getPitchShift(b)});break}case 9:case 10:{e.#e[E+m[7]]=d;break}case 11:{e.#e[E+m[11]]=d;break}case 14:{e.#e[E+m[10]]=d||128;break}case 19:{e.#e[E+m[93]]=d;break}case 20:{e.#e[E+m[91]]=d;break}case 84:{e.#e[E+m[65]]=d;break}case 85:{e.#e[E+m[5]]=d;break}}break}case h<3096:break;case h<3134:{let b=h-3096;b<8?(d>31&&(i+=String.fromCharCode(d)),b===7&&(e.aiEfxName=i)):b<10&&(e.setEffectType(b-8,44,d),e.dispatchEvent(`efx${["reverb","chorus"][b-8]}`,e.getEffectType(b-8)));break}case h<8566:break}})}).add([66,54],(a,o)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r");let i="",r=80,s=0,c=0,n="MSB	PRG	LSB	NME";A(a,function(d,h){let b=h%158;switch(!0){case b<10:{d>31&&(i+=String.fromCharCode(d));break}case b===10:break;case b===11:{r=d&127;break}case b===12:{c=d&127;break}case b===13:{n+=`
${r}	${s}	${c}	${i.trim().replace("Init Voice","")}`,s++,i="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(n),w()&&console.debug(n),e.forceVoiceRefresh()}).add([66,55],(a,o)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r");let i="",r=88,s=0,c=0,n="MSB	PRG	LSB	NME";A(a,function(d,h){let b=h%126;switch(!0){case b<10:{d>31&&(i+=String.fromCharCode(d));break}case b===11:break;case b===12:break;case b===13:{n+=`
${r}	${s}	${c}	${i.trim().replace("Init Combi","")}`,s++,i="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(n),w()&&console.debug(n),e.forceVoiceRefresh()}).add([66,125],(a,o,i)=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][a[0]]||"white")}).add([66,127],(a,o,i)=>{let r=a[a.length-1],s=a.subarray(0,a.length-1),c=U(s);c!=r&&(console.info(`NS5R screen dump checksum mismatch! Expected ${c}, got ${r}.`),console.debug(a));let n=new Uint8Array(5760);A(a,(d,h,b)=>{if(h<720)for(let E=0;E<8;E++)n[h*8+E]=d>>7-E&1}),e.dispatchEvent("screen",{type:"ns5r",data:n})}).add([76],(a,o,i)=>{e.#N.run([66,...a],o,i)}),this.#te.add([16,0,8,0],(a,o,i)=>{let r=(a[2]<<4)+a[3],s="K11 ";([()=>{e.switchMode("k11",!0),e.setPortMode(e.getTrackPort(o),2,y.k11),e.#n=e.KARAOKE_NONE,e.#f[y.k11][1]=r?4:0,console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,r),console.debug(`${s}reverb type: ${r}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{console.debug(`${s}reverb time: ${r}`)},()=>{console.debug(`${s}reverb time: ${r}`)},()=>{console.debug(`${s}reverb predelay: ${r}`)},()=>{console.debug(`${s}reverb predelay: ${r}`)},()=>{console.debug(`${s}depth high: ${r}`)},()=>{console.debug(`${s}depth high: ${r}`)},()=>{console.debug(`${s}depth low: ${r}`)},()=>{console.debug(`${s}depth low: ${r}`)}][a[0]]||(()=>{}))()}).add([16,0,8,1],(a,o,i)=>{e.dispatchEvent("mupromptex");let r=e.chRedir(a[1],o,!0),s=S[r],c=z[r],n=(a[3]<<4)+a[4],d=`K11 CH${r+1} `;([()=>{n<128?(e.setChType(r,e.CH_MELODIC,y.k11),e.#e[s+m[0]]=0,e.#s[r]=n):(e.setChType(r,e.CH_DRUMS,y.k11),e.#s[r]=n-128),e.pushChPrimitives(r),e.dispatchEvent("voice",{part:r})},()=>{let h=e.chRedir(n,o,!0);e.#u[r]=h,r!=h&&(e.buildRchTree(),console.info(`${d}receives from CH${h+1}`))},()=>{e.#e[s+m[7]]=n},()=>{uupThis.setChActive(r,n)},()=>{e.#e[s+m[10]]=n},()=>{e.#r[c+3]=n+40,e.#c[p.rpnt*r+2]=1,e.dispatchEvent("pitch",{part:r,pitch:e.getPitchShift(r)})},()=>{e.#r[c+1]=n>>1,e.#r[c+2]=n&1,e.#c[p.rpnt*r+1]=1,e.dispatchEvent("pitch",{part:r,pitch:e.getPitchShift(r)})},()=>{e.#e[s+m[91]]=n?127:0},()=>{},()=>{e.#e[s+m[74]]=n},()=>{e.#e[s+m[73]]=n},()=>{e.#e[s+m[72]]=n}][a[0]]||(()=>{}))()}).add([16,0,9,0],(a,o,i)=>{e.dispatchEvent("mupromptex");let r=(a[2]<<4)+a[3],s="GMLX ";([()=>{console.debug(`${s}reverb type: ${r}`)},()=>{console.debug(`${s}reverb time: ${r}`)},()=>{console.debug(`${s}reverb predelay: ${r}`)},()=>{console.debug(`${s}depth high: ${r}`)},()=>{console.debug(`${s}depth low: ${r}`)}][a[0]]||(()=>{}))()}).add([16,0,9,3],(a,o,i)=>{e.dispatchEvent("mupromptex");let r=(a[2]<<4)+a[3],s=e.chRedir(a[1],o,!0),c=S[s];[()=>{r<128?(e.setChType(s,e.CH_MELODIC,y.k11),e.#e[c+m[0]]=0,e.#e[c+m[32]]=0,e.#s[s]=r):r<160?(e.setChType(s,e.CH_MELODIC,y.k11),e.#e[c+m[0]]=0,e.#e[c+m[32]]=7,e.#s[s]=r-100):(e.setChType(s,e.CH_DRUMS,y.k11),e.#e[c+m[0]]=122,e.#e[c+m[32]]=0,e.#s[s]=r-160),e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{let n=e.chRedir(r,o,!0);e.#u[s]=n,s!=n&&(e.buildRchTree(),console.info(`GMLX CH${s+1} receives from CH${n+1}`))}][a[0]]()}).add([16,0,9,4],(a,o,i)=>{e.dispatchEvent("mupromptex");let r=(a[2]<<4)+a[3],s=e.chRedir(a[1],o,!0),c=S[s],n=z[s],d=`GMLX CH${s+1} `;[()=>{e.setChActive(s,r)},()=>{e.#e[c+m[7]]=r},()=>{e.#e[c+m[10]]=r},()=>{e.#e[c+m[91]]=r?127:0},()=>{e.#r[n+3]=r+40,e.#c[p.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{e.#r[n+1]=r,e.#c[p.rpnt*s+1]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{e.#r[n]=r,e.#c[p.rpnt*s]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{}][a[0]]()}),this.#ae.add([66,93,64],(a,o,i)=>{let r=a[2];switch(a[0]){case 0:{switch(a[1]){case 4:{e.dispatchEvent("mupromptex"),e.#l=r*129/16383*100,e.dispatchEvent("mastervolume",e.#l);break}case 5:{e.dispatchEvent("mupromptex"),r-64;break}case 6:{e.dispatchEvent("mupromptex"),console.debug(`SG global reverb: ${r?"on":"off"}`);break}case 127:{e.switchMode("sg",!0),e.setPortMode(e.getTrackPort(o),1,y.sg);break}}break}case 1:{switch(a[1]){case 48:{e.dispatchEvent("mupromptex"),console.debug(`SG reverb type: ${J[r]}`);break}}break}default:if(a[0]>>4===1){e.dispatchEvent("mupromptex");let s=e.chRedir(a[0]&15,o,!0);if(a[1]===2){let c=e.chRedir(r,o,!0);e.#u[s]=c,s!=c&&(e.buildRchTree(),console.info(`SG CH${s+1} receives from CH${c+1}`))}else a[1]===19&&e.setChCc(s,7,r)}else console.warn(`Unknown AKAI SG SysEx: ${a}`)}}),this.#re.add([9],(a,o,i)=>{e.dispatchEvent("mupromptex"),console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremolo","phaser","rotary speaker","enhancer","flanger","EQ"][a[0]]||"off"}`)}),this.#S.add([127,0],(a,o,i)=>{e.switchMode("motif");let r=new Uint8Array([127,1,...a]);e.#S.run(r,o,i)}).add([127,1,0,0],(a,o,i)=>{e.switchMode("s90es");let r="S90/Motif ES system ",s=a[0];a.subarray(1).forEach((c,n)=>{([()=>{e.#l=c*12900/16383,e.dispatchEvent("mastervolume",e.#l)}][s+n]||(()=>{console.info(`Unrecognized ${r}ID: ${s+n}`)}))()})}).add([127,1,0,36,54,1],(a,o,i)=>{e.switchMode("s90es");let r="S90/Motif ES reverb ",s=a[0];a.subarray(1).forEach((c,n)=>{([()=>{e.setEffectTypeRaw(0,!1,c&15|128)},()=>{e.setEffectTypeRaw(0,!0,c)}][s+n]||(()=>{}))()}),e.dispatchEvent("efxreverb",e.getEffectType(0))}).add([127,1,0,37,54,2],(a,o,i)=>{e.switchMode("s90es");let r="S90/Motif ES chorus ",s=a[0];a.subarray(1).forEach((c,n)=>{([()=>{e.setEffectTypeRaw(1,!1,c&15|128)},()=>{e.setEffectTypeRaw(1,!0,c)}][s+n]||(()=>{}))()}),e.dispatchEvent("efxchorus",e.getEffectType(1))}).add([127,1,0,34,54,3],(a,o,i)=>{e.switchMode("s90es");let r="S90/Motif ES insert 1 ",s=a[0];a.subarray(1).forEach((c,n)=>{([()=>{e.setEffectTypeRaw(3,!1,c&15|128)},()=>{e.setEffectTypeRaw(3,!0,c)}][s+n]||(()=>{}))()}),e.dispatchEvent("efxinsert0",e.getEffectType(3))}).add([127,1,0,34,54,4],(a,o,i)=>{e.switchMode("s90es");let r="S90/Motif ES insert 2 ",s=a[0];a.subarray(1).forEach((c,n)=>{([()=>{e.setEffectTypeRaw(4,!1,c&15|128)},()=>{e.setEffectTypeRaw(4,!0,c)}][s+n]||(()=>{}))()}),e.dispatchEvent("efxinsert1",e.getEffectType(4))}).add([127,1,0,35,54,17],(a,o,i)=>{e.switchMode("s90es");let r="S90/Motif ES variation ",s=a[0];a.subarray(1).forEach((c,n)=>{([()=>{e.setEffectTypeRaw(2,!1,c&15|128)},()=>{e.setEffectTypeRaw(2,!0,c)}][s+n]||(()=>{}))()}),e.dispatchEvent("efxdelay",e.getEffectType(2))}).add([127,1,0,58,55],(a,o,i)=>{e.dispatchEvent("mupromptex"),e.switchMode("s90es");let r=e.getTrackPort(o);if(e.#d[r]&&e.#d[r]!=e.#i.smotif)if(e.#A.dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${o}. Port ${String.fromCharCode(65+r)} mode "${T[e.#d[r]]}" mismatch, should be "${T[e.#i.smotif]}".`);return}else console.info(`Track ${o} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+r)}.`);let s=e.chRedir(a[0],o,!0),c=S[s],n=a[1];a[0]>15&&(s=a[0]+32);let d=`Track ${o} S90/Motif ES bulk CH${s<128?s+1:"U"+(s-127)} `;console.debug(d,a),!(a[0]>15)&&a.subarray(2).forEach((h,b)=>{([()=>{e.#e[c+m[0]]=h,e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{h&&e.setChActive(s,1),e.#e[c+m[32]]=h,e.getChPrimitive(s,1)===63&&e.setChType(s,[32,40].indexOf(h)>-1?e.CH_DRUMS:e.CH_MELODIC,e.#t,!0),e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{h&&e.setChActive(s,1),e.#s[s]=h,e.dispatchEvent("voice",{part:s})},()=>{let E=e.chRedir(h,o,!0);e.#u[s]=E,s!=E&&(e.buildRchTree(),console.info(`${d}receives from CH${E+1}`))},()=>{e.#y[s]=h?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{h!=100&&e.setChActive(s,1),e.#e[c+m[7]]=h},()=>{h!=64&&e.setChActive(s,1),e.#e[c+m[10]]=h},!1,!1,!1,()=>{e.#e[c+m[91]]=h},()=>{h&&e.setChActive(s,1),e.#e[c+m[93]]=h},()=>{h&&e.setChActive(s,1),e.#e[c+m[94]]=h},()=>{e.setChCc(s,128,h),h!=127&&(e.setChActive(s,1),e.allocateAce(s,128))},()=>{},()=>{h!=64&&e.setChActive(s,1),e.#e[c+m[74]]=h},()=>{h!=64&&e.setChActive(s,1),e.#e[c+m[71]]=h},!1,()=>{e.#e[c+m[65]]=h},()=>{e.#e[c+m[5]]=h},()=>{}][n+b]||(()=>{}))()})}).add([127,1,54,16],(a,o,i)=>{e.switchMode("s90es");let r=a[0];a.subarray(1).forEach((s,c)=>{let d=`S90/Motif ES EQ${(c>>2)+1} `;([()=>{let h=s-64},()=>{let h=_[s]},()=>{let h=s/10},()=>{let h=s}][r+c&3]||(()=>{}))()})}),this.#T.add([0,72,18,0,0,0,0],(a,o,i)=>{e.switchMode("sd",!0),e.setPortMode(e.getTrackPort(o),2,y.sd),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(a,o,i)=>{e.dispatchEvent("mupromptex");let r=a[0]>>5,s=a[0]&31;switch(r){case 0:{let c=a[0]>>1,n=a[1];switch(c){case 1:{a.subarray(2).forEach((d,h,b)=>{let E=h+n;switch(E){case 0:{d&&(e.setEffectType(1,60,d-1),e.dispatchEvent("efxchorus",e.getEffectType(1)),console.debug(`SD MFX Cho: ${E} - ${d}`));break}}});break}case 2:{a.subarray(2).forEach((d,h)=>{let b=h+n;switch(b){case 0:{d&&(e.setEffectType(0,55+d,0),e.dispatchEvent("efxreverb",e.getEffectType(0)),console.debug(`SD MFX Rev: ${b} - ${d}`));break}}});break}case 3:case 4:case 5:{let d=c-1;a.subarray(2).forEach((h,b)=>{let E=b+n;switch(console.debug(`SD MFX ${d-2}: ${E} - ${h}`),E){case 0:{e.setEffectTypeRaw(d,62,h),e.dispatchEvent(`efx${d>2?"delay":"insert"+(d-4)}`,e.getEffectType(d));break}}}),console.debug(`SD MFX message:
%o`,a);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,a)}break}case 1:{let c=e.chRedir(s,o,!0),n=a[1],d=S[c];a.subarray(2).forEach((h,b)=>{let E=n+b;E<37?([()=>{},()=>{},0,()=>{},()=>{switch(h){case 104:case 105:case 106:case 107:case 120:{e.#a[c]||e.setChType(c,e.CH_DRUMS);break}default:e.#a[c]&&e.setChType(c,e.CH_MELODIC)}e.setChCc(c,0,h),e.pushChPrimitives(c),e.dispatchEvent("voice",{part:c})},()=>{e.#e[d+m[32]]=h,e.pushChPrimitives(c),e.dispatchEvent("voice",{part:c})},()=>{e.#s[c]=h,e.dispatchEvent("voice",{part:c})},()=>{e.#e[d+m[7]]=h},()=>{e.#e[d+m[10]]=h},()=>{},()=>{},()=>{h<2&&(e.#y[c]=h)},()=>{h<2&&(e.#e[d+m[68]]=h?127:0)},()=>{},()=>{h<2&&(e.#e[d+m[65]]=h?127:0)},()=>{e.#e[d+m[5]]=h&15<<4|e.#e[d+m[5]]&15},()=>{e.#e[d+m[5]]=h&15|(e.#e[d+m[5]]&240)>>4},()=>{e.#e[d+m[74]]=h},()=>{e.#e[d+m[71]]=h},()=>{e.#e[d+m[73]]=h},()=>{e.#e[d+m[72]]=h},0,0,0,0,0,0,0,()=>{e.#e[d+m[128]]=h,e.allocateAce(128)},()=>{e.#e[d+m[93]]=h},()=>{e.#e[d+m[91]]=h},0,0,()=>{e.#e[d+m[75]]=h},()=>{e.#e[d+m[76]]=h},()=>{e.#e[d+m[77]]=h},()=>{e.#e[d+m[78]]=h}][E]||(()=>{}))():E<63||(E<64?(e.#a[c]?(e.#e[d+m[0]]=104|h,e.pushChPrimitives(c),e.dispatchEvent("voice",{part:c})):(e.#e[d+m[0]]=96|h,e.pushChPrimitives(c),e.dispatchEvent("voice",{part:c})),e.dispatchEvent("voice",{part:c})):console.debug(`Unknown SD-90 global CH${c+1} param setup message:
%o`,a))});break}case 2:{let c=e.chRedir(s,o,!0),n=a[1];console.debug(`Unknown SD-90 global CH${c+1} MIDI setup message:
%o`,a.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,a)}}),e.#N.add([0,1,73,78],(a,o,i)=>{e.switchMode("krs"),e.setPortMode(e.getTrackPort(o),1,y.krs),console.debug("Might be KORG KROSS 2 mode reset... Not sure.")}).add([0,1,73,117,2,37],(a,o,i)=>{e.switchMode("krs");let r=e.getTrackPort(o);if(e.#d[r]&&e.#d[r]!=y.krs)if(e.#A.dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled. Port ${String.fromCharCode(65+r)} mode "${T[e.#d[r]]}" mismatch, should be "krs".`);return}else console.info(`Track ${o} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+r)}.`);e.setPortMode(e.getTrackPort(o),1,y.krs);let s="KROSS 2 BMT1 ",c="";A(a,(n,d)=>{if(d<24)c+=String.fromCharCode(Math.max(32,n));else if(!(d<1276)){let h=d-1276,b=e.chRedir(Math.floor(h/44),o,!0),E=h%44,v=S[b];E<15?([()=>{n&&e.setChActive(b,1),e.#s[b]=n,e.dispatchEvent("voice",{part:b})},()=>{n&&e.setChActive(b,1),n<10?(e.#e[v+m[0]]=63,e.#e[v+m[32]]=n):n<20?(e.#e[v+m[0]]=121,e.#e[v+m[32]]=n-10):n<24&&(e.#e[v+m[0]]=[120,0,56,62][n-20],e.#e[v+m[32]]=0),e.pushChPrimitives(b),e.dispatchEvent("voice",{part:b})},()=>{let x=e.chRedir(n&15,o,!0);e.#u[b]=x,console.info(`${s}CH${b+1} receives from CH${x+1}`)},!1,!1,()=>{e.#e[v+m[7]]=n},!1,()=>{},()=>{},!1,!1,!1,!1,!1,()=>{e.#e[v+m[10]]=n||128}][E]||(()=>{}))():E<36||([()=>{e.#e[v+m[74]]=(n+128&255)-64},()=>{e.#e[v+m[71]]=(n+128&255)-64},!1,!1,()=>{e.#e[v+m[73]]=(n+128&255)-64},()=>{e.#e[v+m[75]]=(n+128&255)-64},!1,()=>{e.#e[v+m[72]]=(n+128&255)-64}][E]||(()=>{}))()}}),c=c.trimRight(),e.dispatchEvent("metacommit",{type:"EORTitle",data:c})})}};export{bt as OctaviaDevice,p as allocated,m as ccToPos,L as dnToPos,w as getDebugState,V as overrides};
