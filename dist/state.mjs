var te=function(e,a){let d=Math.min(e.length,a.length),h=e.slice(0,d),b=a.slice(0,d),y=0,$=0;for(;$<d&&y==0;)y=Math.sign(h[$]-b[$]),$++;return y},P=function(e=""){this.name=e,this.pool=[],this.point=function(a,d=!1){if(this.pool.length>0){let h=this.pool.length,b=1<<Math.floor(Math.log2(h)),y=b,$=64;for(;b>=1&&$>=0;){if($<=0)throw new Error("TTL reached.");if(y==h)y-=b;else{let t=te(a,this.pool[y]);switch(t){case 0:{$=0;break}case 1:{y+b<=h&&(y+=b);break}case-1:{y!=0&&(y-=b);break}default:console.warn(`Unexpected result ${t}.`)}}b=b>>1,$--}let v=!0;if(y>=this.pool.length)v=!1;else{let t=this;this.pool[y].forEach(function(o,c,r){v&&o!=a[c]&&(v=!1)}),!v&&te(a,this.pool[y])>0&&y++}return v||d?y:-1}else return d?0:-1},this.add=function(a,d){return a.data=d,this.pool.splice(this.point(a,!0),0,a),this},this.default=function(a){console.warn(`No match in "${this.name||"(unknown)"}" for "${a}". Default action not defined.`)},this.get=function(a){let d=this.point(a);if(d>-1)return this.pool[d].data;this.default(a)},this.run=function(a,...d){let h=this.point(a);h>-1?a.subarray?this.pool[h].data(a.subarray(this.pool[h].length),...d):this.pool[h].data(a.slice(this.pool[h].length),...d):this.default(a,...d)}};var ae=class{#t={};addEventListener(e,a){this.#t[e]||(this.#t[e]=[]),this.#t[e].unshift(a)}removeEventListener(e,a){if(this.#t[e]){let d=this.#t[e].indexOf(a);d>-1&&this.#t[e].splice(d,1),this.#t[e].length<1&&delete this.#t[e]}}dispatchEvent(e,a){let d=new Event(e),h=this;d.data=a,this.#t[e]?.length>0&&this.#t[e].forEach(function(b){try{b?.call(h,d)}catch(y){console.error(y)}}),this[`on${e}`]&&this[`on${e}`](d)}};var ke=["MSB","PRG","LSB","NME","ELC","DRM","LVL"],we={krs:"KR",s90es:"ES",motif:"ES"},Ce={krs:"Kr",s90es:"SE",motif:"ME"},z=function(e){let a=Math.floor(e/10),d=e%10;return`${a.toString(16)}${d}`},q=class{#t;get bankInfo(){return this.#t}strictMode=!1;get(e=0,a=0,d=0,h){let b=[e,a,d],y,$=1,v=0,t,o,c=Array.from(arguments);switch(h){case"xg":{switch(e){case 0:{d==126?c[2]=125:d==127&&(c[2]=0);break}case 16:{d==126&&(c[2]=0);break}case 32:{d>125&&(c[2]=0),c[2]+=4;break}case 33:{(d>125||d==3)&&(c[2]=0),c[2]+=5;break}case 34:case 35:case 36:{d>125&&(c[2]=0),c[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:c[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{d==126&&(c[2]=0);break}case 48:case 64:case 126:case 127:{d==126&&(e==127&&a==0||(c[2]=0));break}}break}case"gs":case"sc":{e==0&&d<5?c[2]=0:e>125&&d<5&&d!=2&&(c[2]=e,c[0]=0);break}case"g2":case"sd":{e>>1==40?c[2]|=16:e>95&&e<100&&(c[2]|=16,a>>4==7&&(c[0]=96));break}case"sg":{e==8&&d==0&&(c[2]=5);break}case"05rw":case"x5d":{e&&e<56&&(c[0]=56);break}case"s90es":{if(e==0)break;d<8?c[2]+=17:d<32?c[2]+=13:c[2]=(c[2]>>3)+19;break}case"motif":{if(e==0)break;d<8?c[2]+=28:d<32?c[2]+=13:c[2]=(c[2]>>3)+19;break}}let r=" ",s="M",n="",i=0,f=0;switch(c[0]){case 0:{switch(c[2]){case 127:{h=="xg"?s="GM-a":(s="MT-a",n="C/M");break}case 126:{h=="xg"?s="GM-n":(s="MT-b",n="C/M");break}case 7:{s="GM-k",n="GLX";break}case 5:{s="SG-a",n="000";break}case 4:{h=="gs"||h=="sc"?(s="GM-a",n="000"):(s="SP-l",n="C/M");break}case 3:case 2:case 1:{(h=="gs"||h=="sc")&&(s="GM-a",n="000");break}case 0:{s="GM-a";break}default:s="y",i=3}break}case 8:{h=="sg"?s="GM-s":s="r:";break}case 32:case 33:case 34:case 35:case 36:{h=="xg"&&(s=`${["AP","VL","PF","DX","AN"][e&7]}-${"abcdefgh"[d]}`,i=3);break}case 48:{n=`M${(c[2]>>3).toString().padStart(2,"0")}`,s=`y${n}`,i=1;break}case 56:{s="GM-b";break}case 57:s=["yDOC","QY10","QY20"][c[2]-112]||"yMxv",n=["DOC","QY1","QY2"][c[2]-112]||"057";case 61:case 120:{s="rDrm";break}case 62:{s="kDrm";break}case 63:{if(c[2]<17){let k=c[2];s=k<10?"kP:":"kC:",s+=k%10}else c[2]<34?s=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][c[2]-17]:s="Ds";i=1;break}case 64:{s="ySFX",n="SFX";break}case 67:{s="DX:S";break}case 80:case 81:case 82:case 83:{s=`Prg${"UABC"[c[0]-80]}`;break}case 88:case 89:case 90:case 91:{s=`Cmb${"UABC"[c[0]-88]}`;break}case 95:{s=`${["DR","PC"][c[2]]}-d`;break}case 96:{s=c[2]==106?"AP-a":c[2]>>4==1?"SDg":"PF",c[2]>63?f=63:c[2]>>4==1&&(f=16),i=3;break}case 97:{s=c[2]>>4==1?"SDa":"VL:",i=3,c[2]>>4==1?f=16:f=112;break}case 98:{s=c[2]>>4==1?"SDb":"SG-a",i=3,f=16;break}case 99:{s=c[2]>>4==1?"SDc":"DX",c[2]>63?f=63:c[2]>>4==1&&(f=16),i=3;break}case 100:{s="AN",c[2]>63?f=63:c[2]>>4==1&&(f=16),i=3;break}case 104:case 105:case 106:case 107:{s="SDd",f=104;break}case 121:{s=`GM-${c[2]?"":"a"}`,i=3;break}case 122:{s="lDrm";break}case 126:{s="yDrS";break}case 127:{c[2]==127?s="rDrm":s="yDrm";break}default:c[0]<48?s="r:":s="M"}s.length<4&&(s+=`${[e,d,c[0],c[2]][i]-f}`.padStart(4-s.length,"0")),n.length<3&&(n+=`${[e,d,e,d][i]}`.padStart(3-n.length,"0")),h=="xg"&&(e==0?c[2]<100?s=s.replace("y0","y:"):c[2]==125&&(s="y126"):e==16?(y=`Voice${((c[2]<<7)+c[1]+1).toString().padStart(3,"0")}`,r=" "):e==35&&d>>1==2&&(y=`DXCH_${(((c[2]&1)<<7)+a+1).toString().padStart(3,"0")}`,r=" "));let l=[c[0],c[1],c[2]];for(;!(y?.length>=0);)if(y=this.#t[c[1]||0][(c[0]<<8)+c[2]]?.name,y){let k=this.#t[c[1]||0][(c[0]<<8)+c[2]];$=k?.poly||$,v=k?.type||v,t=k?.drum,o=k?.level}else if(this.strictMode)y="",r="?";else if(c[0]==0&&c[1]==0&&c[2]==0)y="Unloaded";else if(this.#t[c[1]||0][c[0]<<8])c[0]==0?(c[2]=0,r="^"):c[2]<1?(c[0]=0,r="*"):(c[2]--,r="^");else if(e==48)c[0]=0,c[2]=0,r="!";else if(e==62)c[1]--,r=" ",c[1]<1&&!y?.length&&(c[0]=0,r="!");else if(e<63)c[0]==0?(c[2]=0,r="^"):c[2]<1?(c[0]=0,r="*"):c[2]--;else if(e==80)y=`PrgU:${a.toString().padStart(3,"0")}`,r="!";else if(e==88)y=`CmbU:${a.toString().padStart(3,"0")}`,r="!";else if(e==121)y=`GM2Vox0${d}`,r="#";else if(e==122)if(c[1]==32?c[1]==0:c[1]%=7,y=this.#t[c[1]||0][(c[0]<<8)+c[2]]?.name,y){r=" ";let k=this.#t[c[1]||0][(c[0]<<8)+c[2]];$=k?.poly||$,v=k?.type||v,t=k?.drum,o=k?.level}else y="",r="*";else c[1]==0?(y=`${e.toString().padStart(3,"0")} ${a.toString().padStart(3,"0")} ${d.toString().padStart(3,"0")}`,r="!"):c[0]==0?(c[2]=0,r="^"):c[2]>0?c[2]--:c[1]>0?(c[1]=0,r="!"):(c[0]=0,r="?");let g=[c[0],c[1],c[2]];switch(r){case"^":{switch(h){case"gs":case"sc":case"ns5r":{r=" ";break}}e==127&&r=="^"&&(r=" ");break}}let E="??";switch(c[0]){case 0:{c[2]==0?E="GM":c[2]==5||c[2]==7?E="KG":c[2]<126?E="XG":c[2]==127&&(E="MT");break}case 32:case 33:case 35:case 36:{c[2]>4?E=["AP","VL","PF","DX","AN"][c[0]-32]:E="GS";break}case 48:{E="MU";break}case 56:{E="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{E="AI";break}case 62:case 82:case 90:{E="XD";break}case 63:{c[2]<17?E="KR":c[2]<34?E="ES":E="DS";break}case 64:case 126:{E="XG";break}case 67:case 99:{E=c[2]>>4==1?"SD":"DX";break}case 81:{E="RW";break}case 95:{E=["DR","PC"][c[2]];break}case 96:{E=c[2]==106?"AP":c[2]>>4==1?"SD":"PF";break}case 97:{E=c[2]>>4==1?"SD":"VL";break}case 98:{E=c[2]>>4==1?"SD":"SG";break}case 100:{E="AN";break}case 104:case 105:case 106:case 107:{E="SD";break}case 120:{E="GS";break}case 121:{E=c[2]?"G2":"GM";break}case 122:{E="KG";break}case 127:{E=c[2]==127?"MT":a==0?"GM":"XG";break}default:c[0]<48&&(c[0]==16&&h=="xg"?E="XG":E="GS")}if(r!=" ")switch(h){case"krs":case"s90es":case"motif":{y="",E=we[h];break}default:self.debugMode&&(y="")}return{name:y||`${Ce[h]||h.toUpperCase()}${z(e||0)}${z(a||0)}${z(d||0)}`,poly:$,type:v,drum:t,level:o,iid:l,eid:g,sid:b,ending:r,sect:s,bank:n,standard:E,mode:h}}async load(e,a,d="(internal)",h){let b=this,y=[],$=0,v=0,t=0;e.split(`
`).forEach(function(o,c){let r=o.split("	"),s=[];if(c==0){if(r.forEach(function(n,i){y[ke.indexOf(n)]=i}),y.length<4){console.debug("Debugger launched.");debugger}}else{let n=0,i=0,f=0,l,g=1,E=0,k,C;r.forEach(function(T,U){switch(U){case y[0]:{n=parseInt(T);break}case y[1]:{i=parseInt(T);break}case y[2]:{f=parseInt(T);break}case y[3]:{l=T;break}case y[4]:{T=parseInt(T),T<16?g=T+1:(E=(T&15)+1,g=E);break}case y[5]:{C=T;break}case y[6]:{T?.constructor&&(k=parseInt(T));break}}}),b.#t[i]=b.#t[i]||[];let x=b.#t[i],O={msb:n,prg:i,lsb:f,name:l,poly:g,type:E,drum:C,level:k,priority:h},F=!1;h<x[n<<8|f]?.priority&&(F=!0,t++),(!x[n<<8|f]||F||a)&&(x[n<<8|f]=O,$++),v++}}),a||console.debug(`Map "${d}": ${v} total, ${$} loaded (${$-t} + ${t}).`)}clearRange(e){let a=e.prg!=null?e.prg.constructor==Array?e.prg:[e.prg,e.prg]:[0,127],d=e.msb!=null?e.msb.constructor==Array?e.msb:[e.msb,e.msb]:[0,127],h=e.lsb!=null?e.lsb.constructor==Array?e.lsb:[e.lsb,e.lsb]:[0,127];for(let b=d[0];b<=d[1];b++){let y=b<<8;for(let $=h[0];$<=h[1];$++){let v=y+$;for(let t=a[0];t<=a[1];t++)delete this.#t[t][v]}}}init(){this.#t=[];for(let e=0;e<128;e++)this.#t.push([""])}async loadFiles(...e){this.init();let a=this;e.forEach(async function(d,h){try{a.load(await(await fetch(`./data/bank/${d}.tsv`)).text(),!1,d,h)}catch{console.error(`Failed loading "${d}.tsv".`)}})}constructor(...e){this.loadFiles(...e)}};var re=class{#t={};context;set(e,a){this.#t[e]=a}has(e){return!!this.#t[e]}async read(e,a){if(!this.has(e))throw new Error(`No decoder registered for "${e}"`);return await this.#t[e].call(this.context||this,a)}};var xe=function(e,a){let d=!0;return a.forEach((h,b)=>{d=d&&e[b]==h}),d},N=function(e){let a=0;return e.forEach(d=>{a*=256,a+=d}),a},A=new TextDecoder,B=new re;B.set("s7e",async function(e){let a=new Uint8Array(await e.slice(0,65536).arrayBuffer()),d="MSB	LSB	PRG	NME",h=[0,0,0,0],b=32,y=0,$=0,v=!0,t=[],o=0;for(;v;){let c=a.subarray(y);([()=>{A.decode(c.subarray(0,4))=="YSFC"?(y+=80,$=1):y++},()=>{if(xe(c.subarray(0,4),h))t.forEach((r,s,n)=>{let i=N(a.subarray(r.start+4,r.start+8));r.length=i}),$=2;else{let r=A.decode(c.subarray(0,4)),s=N(c.subarray(4,8));t.push({type:r,start:s}),y+=8}},()=>{let r=t[o],s=a.subarray(r.start,r.start+r.length),n=32;switch(r.type){case"ENVC":{let i=b;for(;i<s.length;){let f=s.subarray(i,i+n),l=A.decode(f.subarray(0,10)).trimEnd();l.slice(0,5)=="Init "&&(l=""),l&&(d+=`
063	${(f[17]+13).toString().padStart(3,"0")}	${f[19].toString().padStart(3,"0")}	${l}`),i+=n}break}case"EDVC":{let i=b;for(;i<s.length;){let f=s.subarray(i,i+n),l=A.decode(f.subarray(0,10)).trimEnd();l.slice(0,5)=="Init "&&(l=""),l&&(d+=`
063	024	${f[19].toString().padStart(3,"0")}	${l}`),i+=n}break}case"EPVC":{let i=32,f=b;for(;f<s.length;){let l=s.subarray(f,f+i),g=A.decode(l.subarray(0,10)).trimEnd();g=="----------"&&(g=""),g&&(d+=`
063	${(l[17]+1).toString().padStart(3,"0")}	${l[19].toString().padStart(3,"0")}	${g}`),f+=i}break}}o++,o>=t.length&&($=3,v=!1)}][$]||(()=>{v=!1}))()}return d});B.set("pcg",async function(e){let a=new Uint8Array(await e.arrayBuffer()),d="MSB	LSB	PRG	NME",h=100,b=0,y=0,$=!0,v=[],t=0;for(;$;){let o=a.subarray(h);([()=>{$=A.decode(o.subarray(0,4))=="INI2",y=o[15],h+=16,b=1},()=>{let c=A.decode(o.subarray(0,4)),r=o[5],s=o[7],n=o[11],i=N(o.subarray(12,16)),f=N(o.subarray(16,20)),l=N(o.subarray(36,40)),g=A.decode(o.subarray(44,44+n));v.push({type:c,tipMsb:r,tipLsb:s,nameLen:n,length:i,start:f,entryLen:l,name:g}),h+=64,y--,y<1&&(b=2)},()=>{let c=v[t],r=a.subarray(c.start,c.start+c.length);switch(c.type){case"PRG1":break;case"PBK1":{let s=63,n=(c.tipMsb?6:0)+c.tipLsb;for(let i=0;i<128;i++){let f=i*c.entryLen,l=r.subarray(f,f+c.entryLen),g=A.decode(l.subarray(0,24)).trimEnd().replace("InitProg","");g.length&&n>5&&(d+=`
${s.toString().padStart(3,"0")}	${n.toString().padStart(3,"0")}	${i.toString().padStart(3,"0")}	${g}`)}break}case"CBK1":{let s=63,n=(c.tipMsb?3:0)+c.tipLsb+10;for(let i=0;i<128;i++){let f=i*c.entryLen,l=r.subarray(f,f+c.entryLen),g=A.decode(l.subarray(0,24)).trimEnd().replace("InitCombi","");g.length&&n>12&&(d+=`
${s.toString().padStart(3,"0")}	${n.toString().padStart(3,"0")}	${i.toString().padStart(3,"0")}	${g}`)}break}}t++,t>=v.length&&(b=3,$=!1)}][b]||(()=>{$=!1}))()}return d});var I=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),G=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],Se=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],H=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],se=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],ie=function(e){let a=.1,d=-.3;return e>66?(a=5,d=315):e>56?(a=1,d=47):e>46&&(a=.5,d=18.5),a*e-d},ce=function(e){return e>105?Se[e-106]:e>100?e*1.1-100:e/10},ne=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),Q={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,ㇺ
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,うぃ
we,うぇ
wo,を
nga,か゚
ngi,き゚
ngu,く゚
nge,け゚
ngo,こ゚
ngy,き゚!
ng,ン
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,いぇ
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(e=>{let a=e.split(",");Q[a[0]]=a[1]});var oe=function(e){let a=e;e[0]=="*"&&(a=a.slice(1)),["aa","ii","uu","ee","oo"].forEach(h=>{for(;a.indexOf(h)>-1;)a=a.replace(h,h[0])});for(let h in Q)a=a.replaceAll(h,Q[h]);a.indexOf("ん")==0&&a.length>1&&(a=a.slice(1));let d=a.indexOf("!");return d>-1&&a.length>1&&(a=a.slice(d+1)),a},le=function(e){return e?e<96?`cc${e}`:["aftertouch","velocity","pitch bend"][e-96]:"off"};var W=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],de=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],fe=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var Te={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},Me={66307:["drive"],66309:["vowel",e=>"aiueo"[e]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",e=>["off","LPF","HPF"][e]],94984:["noise type",e=>["white","pink"][e]],94987:["disc type",e=>["LP","SP","EP","RND"]],94990:["hum type",e=>`${e+5}0Hz`],94993:["M/S",e=>["mono","stereo"][e]]},Y=function(e){return Te[(e[0]-32<<8)+e[1]]||`0x${e[0].toString(16).padStart(2,"0")}${e[1].toString(16).padStart(2,"0")}`},he=function(e,a,d){let h=(e[0]-32<<16)+(e[1]<<8)+a,b=Me[h]||{},y=b[0];if(y?.length)return y+=`: ${(b[1]||function(){})(d)||d}`,y},j=[68,48,95,78,41,3,110,122,0];var M=function(e=64){return Math.round(2e3*Math.log10(e/64))/100};var L=function(e){let a=0;return e.forEach(d=>{a+=d,a=a&127}),~a+1&127},R=function(e,a){let d=0,h=0;for(let b=0;b<e.length;b++){let y=b%8-1,$=(h>>y&1)<<7,v=e[b];v+=$,b%8!=0?(a(v,d,e),d++):h=e[b]}};var _=function(e){let a=Math.floor(e*14.2);return a<128?a:0},w=function(){return!!self.Bun||self.debugMode||!1};var S=["?","gm","gs","sc","xg","g2","mt32","doc","qy10","qy20","ns5r","x5d","05rw","k11","sg","sd","krs","s90es","motif","trin"],Pe={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es",trinity:"trin","tr-rack":"trin"},Re=["melodic","drum","menu"],ue={"?":[0,0,120,0,0],gm:[0,0,127,0,0],gs:[0,0,120,0,0],sc:[0,0,120,0,0],xg:[0,0,127,0,0],g2:[0,0,120,0,0],mt32:[0,127,127,0,127],doc:[57,112,127,57,112],qy10:[57,113,127,57,113],qy20:[57,114,127,57,114],ns5r:[0,0,61,0,0],x5d:[82,0,62,56,0],"05rw":[81,0,62,56,0],k11:[0,0,122,0,0],sg:[0,0,122,0,0],sd:[97,0,105,0,0],krs:[121,0,120,0,0],s90es:[0,0,127,0,0],motif:[0,0,127,0,0],trin:[0,0,127,0,0]},pe=[9,25,41,57,73,89,105,121],De=[0,3,81,84,88],be={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},ge={0:0,1:1,2:3,5:4},Ee={0:0,1:1,2:2,5:3},ye=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],Z=[36,37,48,49,52,53],K=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],me={26:127,29:0,30:0,31:0,52:12,53:54},V=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,128,12,13,16,17,18,19,14,15,20,21,26,28,22,80,81,82,83,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],Oe=[2,12,13,14,15,16,17,18,19,20,21,80,81,83,136,130,131,132,133,134,135,137,138,139,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],Ae=[33,102,99,32,100,8,9,10],$e=[0,16,25,32,40,64,24,48],m={};S.forEach((e,a)=>{m[e]=a});var p={length:V.length};V.forEach((e,a)=>{p[e]=a});var D={length:K.length};K.forEach((e,a)=>{D[e]=a});var Le={};Re.forEach((e,a)=>{Le[e]=a});var Ue=function(e){let a=[],d=0;return e?.forEach(function(h,b){h==247?a.push(e.subarray(d,b)):h==240&&(d=b+1)}),a.length||a.push(e.subarray(0)),w()&&console.debug(a),a};var J=8,u={port:J,ch:J<<4,chShift:Math.ceil(Math.log2(J))+4,cc:V.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,nrpn:Z.length,ace:8,drm:8,dpn:K.length,dnc:128,ext:3,efx:7,cvn:12,redir:32,vxPrim:3,invalidCh:255},X={bank0:128},ee=new Uint16Array(u.ch),He=new Uint16Array(u.ch),Ne=new Uint16Array(u.ch),Be=new Uint16Array(u.ch),Ie=new Uint16Array(u.ch),ve=new Array(u.drm);for(let e=0;e<u.ch;e++)ee[e]=e*u.cc,He[e]=e*u.rpn,Ne[e]=e*u.nrpn,Be[e]=e*u.ace,Ie[e]=e*u.ext;for(let e=0;e<u.drm;e++){ve[e]=new Uint16Array(u.dpn);let a=e*u.dpn*u.dnc;for(let d=0;d<u.dpn;d++)ve[e][d]=a+d*u.dnc}var ft=class extends ae{NOTE_IDLE=0;NOTE_ATTACK=1;NOTE_DECAY=2;NOTE_SUSTAIN=3;NOTE_HELD=4;NOTE_RELEASE=5;NOTE_SOSTENUTO_ATTACK=8;NOTE_SOSTENUTO_DECAY=9;NOTE_SOSTENUTO_SUSTAIN=10;NOTE_SOSTENUTO_HELD=11;CH_MELODIC=0;CH_DRUMS=1;CH_DRUM1=2;CH_DRUM2=3;CH_DRUM3=4;CH_DRUM4=5;CH_DRUM5=6;CH_DRUM6=7;CH_DRUM7=8;CH_DRUM8=9;DUMP_ALL=0;DUMP_ONCE=1;DUMP_MODE=2;EXT_NONE=0;EXT_VL=1;EXT_DX=3;VLBC_BRTHEXPR=1;VLBC_VELOINIT=2;VLBC_VELOALL=3;CH_INACTIVE=0;CH_ACTIVE=1;CH_DISABLED=2;#t=0;#g=0;#M=0;#H=new Array(11);get#$(){return this.#H[this.#g]}set#$(e){this.#H[this.#g]=e}#S=new Uint8Array(u.ch);#f=new Uint8Array(u.ch);#a=new Uint8Array(u.ch);#e=new Uint8Array(u.ch*u.cc);#E=new Uint8Array(u.ch*u.ace);#s=new Uint8Array(u.ch*u.vxPrim);#h=new Uint8Array(u.ch*u.nn);#v=new Uint8Array(u.ch);#u=new Uint16Array(u.pl);#b=new Uint8Array(u.pl);#N=new Int16Array(u.ch);#O=new Uint8Array(u.ch);#K=new Uint8Array(u.ch);#k=new Uint8Array(u.ch*u.ext);#r=new Uint8Array(u.ch*u.rpn);#i=new Uint8Array(u.ch*u.rpnt);#te=new Int8Array(u.ch*Z.length);#m=new Uint8Array(u.drm*u.dpn*u.dnc);#P=new Uint8Array(u.drm*2);#w=new Uint8Array(u.efx*3);#ae=new Uint8Array(u.ch);#z=new Uint8Array(u.ch*u.redir);#l=new Uint8Array(u.port);#I=new Uint8Array(u.ch);#R=new Uint8Array(u.ch);#ne=new Uint8Array(u.ch*u.cvn);#G=new Uint8Array(128);#D=new Uint8Array(u.cmt*8);#re=new Uint8Array(1024);#_=new Uint8Array(u.cmt*64);#p={};modelEx={sc:{showBar:!0,invBar:!1,invDisp:!1,peakHold:1}};#c;#A;#oe;#n=100;#q=0;#se=500;#ie=0;#X="";#V=0;#le=0;#ce=0;#L=!0;#o=!1;#he=1;#de;#Q=new Array(u.ch);#C=[];#B=new Uint8Array(u.ch);#F=new Uint8Array(u.tr);baseBank=new q("gm2","ns5r","xg","gs","sd","gmega","plg-vl","plg-pf","plg-dx","plg-an","plg-dr","plg-sg","kross","s90es");userBank=new q("gm");initOnReset=!1;aiEfxName="";chRedir(e,a,d){let h=this;if(h.#F[a])return(h.#F[a]-1)*16+e;if(h.#t==m.sc){if(d==1)return e;let b=0,y=!0;for(;y;)h.#B[e+b]==0?(h.#B[e+b]=a,console.debug(`Assign track ${a} to channel ${e+b+1}.`),y=!1):this.#B[e+b]==a?y=!1:(b+=16,b>=128&&(b=0,y=!1));return e+b}else return e}getTrackPort(e){return this.chRedir(0,e,!0)>>4}forceVoiceRefresh(){for(let e=0;e<u.ch;e++)this.#S[e]&&this.dispatchEvent("voice",{part:e})}#y=[];#W;#d={nOff:(e,a)=>{let d=e*128+a,h=this.#u.lastIndexOf(d);if(h>-1)if(this.#e[u.cc*e+p[64]]>63)this.#b[h]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:a,velo:this.#h[d],state:this.NOTE_HELD});else if(this.#e[u.cc*e+p[66]]>63&&this.#b[h]==this.NOTE_SOSTENUTO_SUSTAIN)this.#b[h]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:a,velo:this.#h[d],state:this.NOTE_SOSTENUTO_HELD});else{this.#u[h]=0,this.#h[d]=0,this.#b[h]=this.NOTE_IDLE;let b=this.getExt(e)[1];(b==this.VLBC_VELOINIT||b==this.VLBC_VELOALL)&&(this.#e[u.cc*e+p[129]]=0),this.dispatchEvent("note",{part:e,note:a,velo:0,state:this.NOTE_IDLE})}},nOn:(e,a,d)=>{let h=e*128+a,b=0;for(this.#v[e]&&this.#d.ano(e);this.#b[b]>0&&this.#u[b]!=h;)b++;if(b<u.pl){this.#u[b]=h,this.#h[h]=d,this.#b[b]=this.NOTE_SUSTAIN,this.#O[e]<d&&(this.#O[e]=d);let y=this.getExt(e)[1];(y==this.VLBC_VELOINIT||y==this.VLBC_VELOALL)&&(this.#e[u.cc*e+p[129]]=d),this.dispatchEvent("note",{part:e,note:a,velo:d,state:this.NOTE_SUSTAIN})}else console.error("Polyphony exceeded.")},nAt:(e,a,d)=>{},cAt:(e,a)=>{},hoOf:e=>{this.#b.forEach((a,d)=>{if(a==this.NOTE_HELD){let h=this.#u[d],b=h>>7;e==b&&(this.#b[d]=this.NOTE_IDLE,this.#u[d]=0,this.#h[h]=0,this.dispatchEvent("note",{part:e,note:h&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{this.#b.forEach((a,d)=>{let h;switch(a){case this.NOTE_ATTACK:{h=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{h=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{h=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(h){this.#b[d]=h;let b=this.#u[d];this.dispatchEvent("note",{part:e,note:b&127,velo:this.#h[b],state:h})}})},soOf:e=>{this.#b.forEach((a,d)=>{if(a==this.NOTE_SOSTENUTO_HELD){let h=this.#u[d],b=h>>7;e==b&&(this.#b[d]=this.NOTE_IDLE,this.#u[d]=0,this.#h[h]=0,this.dispatchEvent("note",{part:e,note:h&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{this.#u.forEach((a,d,h)=>{let b=a>>7,y=a&127;a==0&&this.#h[0]==0||b==e&&this.#d.nOff(b,y)})}};#fe={8:function(e){let a=e.channel,d=e.data[0];this.#d.nOff(a,d)},9:function(e){let a=e.channel,d=this;if(d.getChModeId(a)==m.xg&&d.#a[a]>1){let y=d.getChDrumFirstWrite(a);y[0]&&y[1]!=u.invalidCh&&!d.#S[a]&&(d.copyChSetup(y[1],a),d.dispatchEvent("voice",{part:a}),console.debug(`Part CH${a+1} copied from CH${y[1]}.`))}d.setChActive(a,1);let h=e.data[0],b=e.data[1];b>0?d.#d.nOn(a,h,b):d.#d.nOff(a,h)},10:function(e){let a=e.channel,d=a*128+e.data[0];this.#u.indexOf(d)>-1&&(this.#h[d]=data[1],this.getExt(a)[1]==this.VLBC_VELOALL&&(this.#e[u.cc*a+p[129]]=data[1]),this.dispatchEvent("note",{part:a,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let a=e.channel,d=this,h=this.#Q[a],b=h[e.data[0]];b&&(e.data[0]=b),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(this.#t){case m.s90es:case m.motif:{if(e.data[0]==0){[0,63].indexOf(e.data[1])>-1&&this.setChActive(a,1);break}e.data[1]&&this.setChActive(a,1);break}default:{this.setChActive(a,1);break}}})();let y=a*u.cc,$=a*u.ext,v=this.getChModeId(a);switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{this.#d.ano(a),this.#N[a]=0,this.#e[y+p[1]]=0,this.#e[y+p[5]]=0,this.#e[y+p[64]]=0,this.#e[y+p[65]]=0,this.#e[y+p[66]]=0,this.#e[y+p[67]]=0,this.#e[y+p[11]]=127,this.#e[y+p[101]]=127,this.#e[y+p[100]]=127,this.#e[y+p[99]]=127,this.#e[y+p[98]]=127;return}case 123:{this.#d.ano(a);return}case 124:{this.#d.ano(a);return}case 125:{this.#d.ano(a);return}case 126:{this.#v[a]=1,this.#d.ano(a);return}case 127:{this.#v[a]=0,this.#d.ano(a);return}}if(p[e.data[0]]==null)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(Oe.indexOf(e.data[0])>-1&&this.allocateAce(a,e.data[0]),e.data[0]){case 0:{switch(w()&&console.debug(`${S[this.#t]}, CH${a+1}: ${e.data[1]}`),this.#t==0?e.data[1]<48?(this.#a[a]>0&&(e.data[1]=this.#e[y],e.data[1]=120,console.debug(`Forced channel ${a+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]==56?this.switchMode(this.#c.x5==82?"x5d":"05rw"):e.data[1]==62?this.switchMode(this.#c.x5==82?"x5d":"05rw"):e.data[1]==63?this.switchMode(S[this.#c.ds]):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg"):this.#t==m.gs||this.#t==m.sc?e.data[1]<56&&this.#a[a]>0&&(e.data[1]=this.#e[y],e.data[1]=120,console.debug(`Forced channel ${a+1} to stay drums.`)):this.#t==m.gm&&(e.data[1]<48?this.#a[a]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${a+1} to stay drums.`)):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg",!0)),this.#t){case m.xg:{[79,95,126,127].indexOf(e.data[1])>-1?this.#a[a]==0&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):this.#a[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?this.#k[$]=this.EXT_VL:[35,67,83,99].indexOf(e.data[1])>-1?this.#k[$]=this.EXT_DX:this.#k[$]=this.EXT_NONE;break}case m["05rw"]:case m.x5d:case m.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?this.#a[a]==this.CH_MELODIC&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):[80,81,82,83].indexOf(e.data[1])>-1||this.#a[a]!=this.CH_MELODIC&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}case m.sd:{[104,105,106,107].indexOf(e.data[1])>-1?this.#a[a]==0&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):this.#a[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}case m.g2:{e.data[1]==120?this.#a[a]==0&&(this.setChType(a,this.CH_DRUMS),console.debug(`CH${a+1} set to drums by MSB.`)):this.#a[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}}break}case 2:{this.getExt(a)[1]==this.VLBC_BRTHEXPR&&(this.#e[y+p[129]]=e.data[1]);break}case 6:{if(this.#K[a]){[m.xg,m.gs,m.sc,m.ns5r].indexOf(this.#t)<0&&console.warn(`NRPN commits are not available under "${S[this.#t]}" mode, even when they are supported in Octavia.`);let t=this.#e[y+p[99]],o=this.#e[y+p[98]];if(t==1){let c=Ae.indexOf(o);if(c>-1)this.#e[y+p[71+c]]=e.data[1],w()&&console.debug(`Redirected NRPN 1 ${o} to cc${71+c}.`),this.dispatchEvent("cc",{part:a,cc:71+c,data:e.data[1]});else{let r=Z.indexOf(o);r>-1?this.#te[a*10+r]=e.data[1]-64:console.warn(`NRPN 0x01${o.toString(16).padStart(2,"0")} is not supported.`),w()&&console.debug(`CH${a+1} voice NRPN ${o} commit`)}}else{if(K.indexOf(t)<0){let r=`NRPN 0x${t.toString(16).padStart(2,"0")}${o.toString(16).padStart(2,"0")} `;t==127?console.warn(`${r}is not necessary. Consider removing it.`):console.warn(`${r}is not supported.`)}else{let r=this.#a[a]-2;r<0?console.warn(`CH${a+1} cannot accept drum NRPN as type ${G[this.#a[a]]}.`):this.#m[(r*u.dpn+D[t])*u.dnc+o]=e.data[1]}w()&&console.debug(`CH${a+1} (${G[this.#a[a]]}) drum NRPN ${t} commit`)}}else{let t=ge[this.#e[y+p[100]]],o=Ee[this.#e[y+p[100]]];if(this.#e[y+p[101]]==0&&t!=null)switch(w()&&console.debug(`CH${a+1} RPN 0 ${this.#e[y+p[100]]} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],ye[t][0]),ye[t][1]),this.#r[a*u.rpn+t]=e.data[1],this.#i[a*u.rpnt+o]=1,v){case m.xg:case m.gs:case m.sc:case m.mt32:case m.s90es:case m.motif:{switch(this.#e[y+p[100]]){case 1:case 2:{this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)});break}}break}default:this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)})}}break}case 32:{switch(w()&&console.debug(`${S[this.#t]}, CH${a+1} LSB: ${e.data[1]}`),this.#t){case m.s90es:case m.motif:{this.setChType(a,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,this.#t,!0);break}}this.getExt(a)[0]==this.EXT_DX;break}case 38:{if(!this.#K[a]){let t=ge[this.#e[y+100]],o=Ee[this.#e[y+100]];this.#e[y+101]==0&&t!=null&&(this.#r[a*u.rpn+t+1]=e.data[1],this.#i[a*u.rpnt+o]=1)}break}case 64:{e.data[1]<64&&this.#d.hoOf(a);break}case 66:{e.data[1]>>6?this.#d.soOn(a):this.#d.soOf(a);break}case 98:case 99:{this.#K[a]=1;break}case 100:case 101:{this.#K[a]=0;break}}this.#e[y+p[e.data[0]]]=e.data[1],this.dispatchEvent("cc",{part:a,cc:e.data[0],data:e.data[1]})}d.getChModeId(a)==m.xg&&d.#a[a]&&d.setDrumFirstWrite(a)},12:function(e){let a=e.channel,d=this;switch(d.#t){case m.s90es:case m.motif:{e.data&&d.setChActive(a,1);break}default:d.setChActive(a,1)}if(d.getExt(a)[0]==d.EXT_DX){let h=u.cc*a}d.#s[a]=e.data,d.#R[a]=0,d.pushChPrimitives(a),w()&&console.debug(`T:${e.track} C:${a} P:${e.data}`),d.dispatchEvent("voice",{part:a}),d.getChModeId(a)==m.xg&&d.#a[a]&&d.setDrumFirstWrite(a)},13:function(e){let a=this,d=e.channel;this.#u.forEach(function(h){let b=h>>7;d==b&&(a.#h[h]=e.data,a.dispatchEvent("note",{part:d,note:h&127,velo:e.data,state:a.NOTE_SUSTAIN}))})},14:function(e){let a=e.channel;this.#N[a]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)})},15:function(e){Ue(e.data).forEach(a=>{let d=a[0],h=a[1];(this.#ue[d]||function(){console.debug(`Unknown manufacturer ${d}.`)})(h,a.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(this.#y[e.meta]||function(d,h,b){}).call(this,e.data,e.track,e.meta),e.meta!=32&&(this.#q=0);let a=De.indexOf(e.meta)>-1;if(w()&&console.debug(e),a)return e.reply="meta",e}};#ue={64:(e,a,d)=>{this.#J.run(a,d,e)},65:(e,a,d)=>{if(a[0]<16)if(a[1]==72){let h=a[a.length-1],b=L(a.subarray(3,a.length-1));h==b?this.#T.run(a.subarray(0,a.length-1),d,e):console.warn(`Bad SD checksum ${h} - should be ${b}.`)}else this.#T.run(a,d,e);else{let h=a[a.length-1],b=L(a.subarray(2,a.length-1));h==b?this.#T.run(a.subarray(0,a.length-1),d,e):console.warn(`Bad GS checksum ${h} - should be ${b}.`)}},66:(e,a,d)=>{this.#U.run(a,d,e)},67:(e,a,d)=>{this.#x.run(a,d,e)},68:(e,a,d)=>{this.#ee.run(a,d,e)},71:(e,a,d)=>{this.#Z.run(a,d,e)},126:(e,a,d)=>{this.#Y.run(a,d,e)},127:(e,a,d)=>{this.switchMode("gm"),this.#j.run(a,d,e)}};#Y;#j;#x;#T;#U;#J;#Z;#ee;buildRchTree(){let e=[];this.#f.forEach((a,d)=>{a<u.ch&&(e[a]?.constructor||(e[a]=[]),e[a].push(d))}),this.#de=e}buildRccMap(){let e=this;for(let a=0;a<u.ch;a++)e.#Q[a]={};e.#z.forEach((a,d)=>{a&&(e.#Q[Math.floor(d/u.redir)][a]=d%u.redir|128)}),w()&&console.debug(e.#Q)}getActive(){return this.#S}getCc(e){let a=this,d=e*u.cc;return a.#e.subarray(d,d+u.cc)}getCcCh(e,a){let d=this;if(V.indexOf(a)<0)throw new Error("CC number not accepted");return d.#e[u.cc*e+p[a]]}getCcAll(){return this.#e.slice()}getChSource(){return this.#f}getChType(){return this.#a}setChType(e,a,d=0,h=!1){a&=15;let b=this;d=d||b.getChModeId(e),b.#a[e]=a,a>0&&!h&&(b.#e[e*u.cc+p[0]]=b.#p[d][2],b.pushChPrimitives(e))}setChActive(e,a=0){this.#S[e]!=a&&this.dispatchEvent("channeltoggle",{part:e,active:a}),this.#S[e]=a}getExt(e){let a=u.ext*e,d=this.#k.subarray(a,a+u.ext),h=new Uint8Array(d.length);return h.set(d),h[1]=h[1]||this.#he,h}getPitch(){return this.#N}getProgram(){return this.#s}getTexts(){return this.#C.slice()}getVel(e){let a=new Map,d=this;return d.#u.forEach(function(h,b){let y=h>>7,$=h&127;e==y&&d.#h[h]>0&&a.set($,{v:d.#h[h],s:d.#b[b]})}),a}getBitmap(){return{bitmap:this.#$,expire:this.#M}}getLetter(){return{text:this.#X,set:this.#le,expire:this.#V}}getMode(){return S[this.#t]}getMaster(){return{volume:this.#n}}getRawStrength(){let e=this;return this.#u.forEach(function(a){let d=a>>7;e.#h[a]>e.#O[d]&&(e.#O[d]=e.#h[a])}),this.#O}getStrength(){let e=[],a=this;return this.getRawStrength().forEach(function(d,h){e[h]=Math.floor(d*a.#e[h*u.cc+p[7]]*a.#e[h*u.cc+p[11]]*a.#n/803288)}),e}getRpn(){return this.#r}getNrpn(){return this.#te}getSubDb(){return self?.structuredClone(this.#p)}getVoice(e,a,d,h="?"){let b=this;m[h]?.constructor||(h="?");let y=m[h],$=e||b.#p[y][0],v=a,t=d||b.#p[y][1];$==X.bank0&&($=0),t==X.bank0&&(t=0),h=="ns5r"&&$>0&&$<56&&(t=3);let o=b.userBank.get($,v,t,h);if(h=="mt32"&&o.name.indexOf("MT-m:")==0){let c=parseInt(o.name.slice(5)),r=c*u.cmt,s="";b.#_.subarray(r,r+10).forEach(i=>{i>31&&(s+=String.fromCharCode(i))});let n=`MSB	LSB	PRG	NME
0	127	${v}	${s}`;b.userBank.load(n,!0),o.name=s,o.ending=" "}return(o.ending!=" "||!o.name.length)&&(o=b.baseBank.get($,v,t,h)),o}getChPrimitive(e,a,d){if(a>=u.vxPrim||a?.constructor!=Number)throw new RangeError(`Invalid voice primitive component "${a}"`);if(e>=u.ch)throw new RangeError(`Invalid part "CH${e+1}"`);let h=this,b=h.#s[a<<u.chShift|e];switch(a){case 1:case 2:{d&&(b=b||h.#p[h.getChModeId(e)][a-1]),b==X.bank0&&(b=0);break}}return b}getChPrimitives(e,a){let d=this,h=new Uint8Array(3);return h[1]=d.#s[e],h[0]=d.getChPrimitive(e,1,a),h[2]=d.getChPrimitive(e,2,a),h}pushChPrimitives(e){let a=this;a.#s[1<<u.chShift|e]=a.#e[ee[e]+p[0]],a.#s[2<<u.chShift|e]=a.#e[ee[e]+p[32]]}getChVoice(e){let a=this,d=a.getVoice(...a.getChPrimitives(e),a.getChMode(e));if(a.#R[e]){let h="";switch(a.#t){case m.mt32:{a.#D.subarray(u.cmt*(e-1),u.cmt*(e-1)+10).forEach(b=>{h+=String.fromCharCode(Math.max(b,32))}),h=h.trimRight();break}default:{let b=u.cvn*e;a.#ne.subarray(b,b+u.cvn).forEach(y=>{h+=String.fromCharCode(Math.max(y,32))}),h=h.trimRight()}}h.length&&(d.ending="~",d.name=h)}return d}getRawPitch(){return this.#N}getPitchShift(e){let a=this,d=e*u.rpn,h=a.#r[d];return a.#i[e*u.rpnt]||a.#t==m.mt32&&(h=12),a.#N[e]/8192*h+(a.#r[d+3]-64)+((a.#r[d+1]<<7)+a.#r[d+2]-8192)/8192}getEffectType(e=0){let a=3*e+1;return this.#w.subarray(a,a+2)}setEffectTypeRaw(e=0,a,d){let h=3*e;this.#w[h]=1,this.#w[h+1+ +a]=d}setEffectType(e=0,a,d){this.setEffectTypeRaw(e,!1,a),this.setEffectTypeRaw(e,!0,d)}getEffectSink(){return this.#ae}setLetterDisplay(e,a,d=0,h=3200){let b=this,y;b.#X=" ".repeat(d),e.forEach($=>{b.#X+=String.fromCharCode($>31?$:32),$<32&&(y=y||new Set,y.add($))}),b.#le=Date.now(),b.#V=Date.now()+h,y&&(y=Array.from(y),y.forEach(($,v,t)=>{t[v]=$.toString(16).padStart(2,"0")}),console.warn(`${a}${a?" ":""}invalid code point${y.length>1?"s":""}: 0x${y.join(", 0x")}`))}setDetectionTargets(e="?",a=0){let d=this,h=-1;switch(e.replaceAll(", ",",").split(",").forEach(b=>{b=b.toLowerCase();let y=S.indexOf(Pe[b]||b);w()&&console.debug(`Mapped mode "${b}" to ID "${y}".`),y>-1&&(h=y)}),w()&&console.debug(`Set detection target to ID "${h}".`),h>0&&(d.#c.x5=82,d.#c.ds=m.krs),h){case m["05rw"]:{d.#c.x5=81;break}case m.s90es:d.#c.ds=m.s90es,d.#c.smotif=m.s90es;case m.motif:d.#c.ds=m.motif,d.#c.smotif=m.motif}}setGsTargets(e=!1,a=4){if(!a)a=e?3:4;else{if(a>4||a<0)throw new Error(`Invalid GS level ${a}`);if(e&&a>>1!=1)throw new Error(`Invalid SC level ${a}`)}let d=this;d.#c[e?"sc":"gs"]=a,d.#p[m[e?"sc":"gs"]][1]=a,d.forceVoiceRefresh()}getConfigs(){return this.#oe}setDumpLimit(e){if(e>2||e<0)throw new RangeError("Invalid dump limit.");this.#A.dumpLimit=e}allocateAce(e=0,a){let d=this;if(!a||a<128&&a>95){console.warn(`cc${a} cannot be allocated as an active custom effect.`);return}let h=!0,b=0,y=u.ace*e;for(;h&&b<u.ace;)d.#E[b+y]==a?h=!1:d.#E[b+y]||(h=!1,d.#E[b+y]=a,console.info(`Allocated cc${a} to ACE slot ${b} in CH${e+1}.`)),b++;b>=u.ace&&console.warn(`ACE slots are full in CH${e+1}.`)}allocateAceAll(e){let a=this;if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}for(let d=0;d<u.ch;d++){let h=!0,b=0,y=u.ace*d;for(;h&&b<u.ace;)a.#E[b+y]==e?h=!1:a.#E[b+y]||(h=!1,a.#E[b+y]=e),b++;b>=u.ace&&console.warn(`ACE slots are full in CH${d+1}.`)}}releaseAce(e=0,a){let d=!0,h=u.ace*e,b=h+u.ace;for(;d&&h<b;)this.#E[h]==a&&(this.#E[h]=0,d=!1),h++;d&&w()&&console.debug(`No ACE slot was allocated to cc${a} in CH${e+1}.`)}resetAce(){this.#E.fill(0),console.info("All ACE slots have been reset.")}getAce(){return this.#E}getChAce(e=0,a=0){if(a<0||a>=u.ace)throw new RangeError("No such ACE slot");let d=this.#E[u.ace*e+a];if(d){if(V.indexOf(d)>=0)return this.#e[e*u.cc+p[d]];throw new Error(`Invalid ACE source in CH${e+1}: ${d}`)}else return 0}initDrums(){let e=this;e.#m.fill(64);for(let a=0;a<u.drm;a++){let d=a*u.dpn;for(let h in me){let b=me[h],y=(d+D[h])*u.dnc;e.#m.subarray(y,y+u.dnc).fill(b)}}}init(e=0){let a=this;a.#q=0,a.#p[m.xg][1]=0,a.dispatchEvent("banklevel",{mode:"xg",data:0}),a.#S.fill(0),a.#e.fill(0),a.#E.fill(0),a.#s.fill(0),a.#h.fill(0),a.#u.fill(0),a.#v.fill(0),a.#O.fill(0),a.#N.fill(0),a.#te.fill(0),a.#i.fill(0),a.#k.fill(0),a.#l.fill(0),a.#I.fill(0),a.#z.fill(0),a.#n=100,a.#C=[],a.#se=500,a.#ie=0,a.#M=0,a.#g=0,a.#$.fill(0),a.#o=!1,a.#ce=0,a.#L=!0,a.initDrums(),a.#f.forEach(function(d,h,b){b[h]=h}),e==0&&(a.dispatchEvent("mode","?"),a.#t=0,a.#B.fill(0),a.#F.fill(0),a.#V=0,a.#X=""),pe.forEach(d=>{a.#e[u.cc*d]=a.#p[a.getChModeId(d)][2]}),a.#a.fill(a.CH_MELODIC),a.#a[9]=a.CH_DRUM1,a.#a[25]=a.CH_DRUM3,a.#a[41]=a.CH_DRUMS,a.#a[57]=a.CH_DRUMS,a.#a[73]=a.CH_DRUM5,a.#a[89]=a.CH_DRUM7,a.#a[105]=a.CH_DRUMS,a.#a[121]=a.CH_DRUMS;for(let d=0;d<u.drm;d++)a.#P[d<<1]=0,a.#P[d<<1|1]=u.invalidCh;a.#re.fill(0),a.#_.fill(0),a.#G.fill(0),a.#D.fill(0),a.#R.fill(0),a.#w.fill(0),a.#ae.fill(0),a.aiEfxName="",a.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),a.modelEx.sc.showBar=!0,a.modelEx.sc.invBar=!1,a.modelEx.sc.invDisp=!1,a.modelEx.sc.peakHold=1;for(let d=0;d<u.ch;d++){let h=d*u.cc;a.#e[h+p[7]]=100,a.#e[h+p[11]]=127,a.#e[h+p[2]]=127,a.#e[h+p[10]]=64,a.#e.subarray(h+p[71],h+p[71]+8).fill(64),a.#e[h+p[128]]=127,a.#e.subarray(h+p[130],h+p[157]+1).fill(64),a.#e[h+p[91]]=40,a.#e[h+p[101]]=127,a.#e[h+p[100]]=127,a.#e[h+p[99]]=127,a.#e[h+p[98]]=127;let b=d*u.rpn;a.#r[b]=2,a.#r[b+1]=64,a.#r[b+2]=0,a.#r[b+3]=64,a.#r[b+4]=0,a.#r[b+5]=0;let y=d*u.ext;a.#k[y+1]=a.VLBC_BRTHEXPR;let $=d*u.redir;a.#z[$+8]=13}a.buildRchTree(),a.buildRccMap(),a.dispatchEvent("mastervolume",a.#n),a.dispatchEvent("efxreverb",a.getEffectType(0)),a.dispatchEvent("efxchorus",a.getEffectType(1)),a.dispatchEvent("efxdelay",a.getEffectType(2)),a.dispatchEvent("efxinsert0",a.getEffectType(3)),a.dispatchEvent("efxinsert1",a.getEffectType(4)),a.dispatchEvent("efxinsert2",a.getEffectType(5)),a.dispatchEvent("efxinsert3",a.getEffectType(6)),a.dispatchEvent("reset"),a.switchMode("?")}setChMode(e,a){let d=this;if(e<0||e>=u.ch)throw new RangeError(`Invalid CH${e+1}`);if(port<0||a>=S.length)throw new RangeError(`Invalid mode ID ${a}`);d.#I[e]=a,d.dispatchEvent("voice",{part:e})}getChMode(e,a){return S[this.getChModeId(e,a)]}getChModeId(e,a){return a?this.#I[e]||this.#l[e>>4]:this.#I[e]||this.#l[e>>4]||this.#t}setPortMode(e,a,d){let h=this;if(e<0||e>=u.ch>>4)throw new RangeError(`Invalid port ${e+1}`);if(a<1)throw new RangeError("Range must be a positive integer");if(e+a>=u.ch>>4)throw new RangeError("Range must be in bound");if(e<0||d>=S.length)throw new RangeError(`Invalid mode ID ${d}`);for(let b=e;b<e+a;b++){h.#l[b]=d;for(let y=b<<4;y<b+1<<4;y++)h.dispatchEvent("voice",{part:y})}}copyChSetup(e,a,d){if(e==a){console.warn(`Failed attempt at overwriting CH${e+1} with its own data.`);return}let h=this;if(d&&h.#S[a]){console.warn(`Failed attempt at copying setup data from CH${e+1} to CH${a+1}.`);return}let b=u.cc*e,y=u.cc*a;h.#s[a]=h.#s[e],h.#e.set(h.#e.subarray(b,b+u.cc),y),h.pushChPrimitives(a)}setDrumFirstWrite(e,a){let d=this,h=d.#a[e];if(h<2)return;let b=h-2;if(d.#P[b<<1])if(a)d.#P[b<<1]=0,w()&&console.debug(`First write part for drum set ${b+1} has been reset.`);else return;else a?console.warn(`First write part for drum set ${b+1} is already blank.`):(d.#P[b<<1]=1,d.#P[b<<1|1]=e,console.debug(`First write part for drum set ${b+1} is set to CH${e+1}.`))}getChDrumFirstWrite(e){let a=this,d=a.#a[e];if(d<2)return;let h=d-2;return a.#P.subarray(h<<1,h+1<<1)}getDrumFirstWrite(e){if(e>=0&&e<u.drm)return this.#P.subarray(e<<1,e+1<<1)}switchMode(e,a=!1,d=!1){let h=this,b=m[e];if(b>-1){if(h.#t==0||a){let y=h.#t;h.initOnReset&&a&&(this.init(1),y=m["?"]),h.#t=b,h.#g=0;for(let v=0;v<u.ch;v++)h.#a[v]>0&&h.#I[v]==0&&(h.#e[v*u.cc]=h.#p[b][2],h.pushChPrimitives(v));switch(b){case m.mt32:{j.forEach((v,t)=>{let o=t+1;h.#S[o]||(h.#s[o]=v,h.#e[o*u.cc+p[91]]=127,h.pushChPrimitives(o))});for(let v=1;v<10;v++)h.dispatchEvent("voice",{part:v});break}}let $;switch(b){case m["?"]:case m.g2:{$=[52,4,52,18,0,0,0,0];break}case m.xg:{$=[1,0,65,0,5,0,0,0];break}case m.gm:case m.gs:case m.sc:{$=[40,4,40,18,40,32,32,0];break}case m.sd:{$=[58,0,60,0,61,0,61,0];break}case m["05rw"]:case m.x5d:case m.ns5r:{$=[44,1,44,19,44,0,44,0];break}case m.k11:case m.sg:{$=[24,0,0,0,0,0,0,0];break}case m.mt32:{$=[40,4,0,0,0,0,0,0];break}case m.doc:{$=[24,16,0,0,0,0,0,0];break}case m.motif:case m.s90es:{$=[113,0,117,0,114,0,0,0];break}default:$=[0,0,0,0,0,0,0,0]}for(let v=0;v<u.efx;v++)!h.#w[3*v]&&$[v<<1]?.constructor&&(h.#w[3*v+1]=$[2*v],h.#w[3*v+2]=$[2*v+1],h.dispatchEvent(`efx${["reverb","chorus","delay","insert0"][v]}`,h.getEffectType(v)));d&&h.setDetectionTargets(e),h.dispatchEvent("mode",e),h.forceVoiceRefresh(),pe.forEach(v=>{h.dispatchEvent("voice",{part:v})})}}else throw new Error(`Unknown mode ${e}`)}newStrength(){this.#O.fill(0)}runJson(e){if(e.type>14)return e.type==15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),this.#fe[e.type].call(this,e);{let a=this.chRedir(e.part,e.track),d=!1;this.#de[a]?.forEach(h=>{e.channel=h,d=!0,this.#fe[e.type].call(this,e)}),d||console.warn(`${be[e.type]?be[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${a+1} without any recipient.`)}this.#C.length>100&&this.#C.splice(100,this.#C.length-99)}runRaw(e){}async loadBank(e,a){let d=this;switch(e=e.toLowerCase(),e){case"s7e":{d.userBank.clearRange({msb:63,lsb:[21,22]}),d.userBank.clearRange({msb:63,lsb:[24,27]});break}case"pcg":{d.userBank.clearRange({msb:63,lsb:[6,9]}),d.userBank.clearRange({msb:63,lsb:[13,16]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":case"pcg":{B.context=this,await d.userBank.load(await B.read(e,a),!1);break}}d.forceVoiceRefresh()}constructor(){super();let e=this;e.#$=new Uint8Array(256),e.#H[10]=new Uint8Array(512),e.#W=new P,e.#c={x5:82,ds:m.krs,smotif:m.s90es,gs:4,sc:3},e.#A={dumpLimit:e.DUMP_MODE},e.#oe=new Proxy(e.#A,{set:()=>{}});for(let t in ue){let o=m[t];o==null?console.debug(`SubDB build error: "${t}" does not exist`):e.#p[o]=new Uint8Array(ue[t])}e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(t){let{data:o}=t;e.#C[0]?.type==o.type&&e.#C[0]?.amend?(e.#C[0].amend=o.amend,e.#C[0].data+=o.data):e.#C.unshift(o)}),e.#y[1]=function(t){switch(t=t.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),t.slice(0,2)){case"@I":{this.#o=!0,this.dispatchEvent("metacommit",{type:"Kar.Info",data:t.slice(2)?.trimLeft()});break}case"@K":{this.#o=!0,this.dispatchEvent("metacommit",{type:"Kar.Mode",data:t.slice(2)?.trimLeft()}),console.debug(`Karaoke mode active: ${t.slice(2)}`);break}case"@L":{this.#o=!0,this.dispatchEvent("metacommit",{type:"Kar.Lang",data:t.slice(2)?.trimLeft()});break}case"@T":{this.#o=!0,this.dispatchEvent("metacommit",{type:"KarTitle",data:t.slice(2)?.trimLeft()});break}case"@V":{this.#o=!0,this.dispatchEvent("metacommit",{type:"Kar.Ver.",data:t.slice(2)?.trimLeft()});break}case"XF":{let o=t.slice(2).split(":");switch(o[0]){case"hd":{o.slice(1).forEach((c,r)=>{c.length&&this.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][r],data:c})});break}case"ln":{o.slice(1).forEach((c,r)=>{c.length&&this.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][r],data:c})});break}default:this.dispatchEvent("metacommit",{type:"XfUnData",data:t})}break}default:this.#o?t[0]=="\\"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:t.slice(1),amend:!0})):t[0]=="/"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:t.slice(1),mask:!0,amend:!0})):this.dispatchEvent("metacommit",{type:"KarLyric",data:t,amend:!0}):t.split(`
`).forEach((o,c)=>{this.dispatchEvent("metacommit",{type:"Cmn.Text",data:o,mask:c!=0})})}},e.#y[2]=function(t){this.dispatchEvent("metacommit",{type:"Copyrite",data:t})},e.#y[3]=function(t,o){o<1&&this.#q<1&&this.dispatchEvent("metacommit",{type:"TrkTitle",data:t})},e.#y[4]=function(t,o){this.dispatchEvent("metacommit",{type:"Instrmnt",data:t})},e.#y[5]=function(t){t.trim()==""?this.dispatchEvent("metacommit",{type:"C.Lyrics",data:"",amend:!1}):this.dispatchEvent("metacommit",{type:"C.Lyrics",data:t,amend:!0})},e.#y[6]=function(t){this.dispatchEvent("metacommit",{type:"C.Marker",data:t})},e.#y[7]=function(t){this.dispatchEvent("metacommit",{type:"CuePoint",data:t})},e.#y[32]=function(t){this.#q=t[0]+1},e.#y[33]=function(t,o){w()&&console.debug(`Track ${o} requests to get assigned to output ${t}.`),e.#F[o]=t+1},e.#y[81]=function(t,o){e.#se=t/1e3},e.#y[127]=function(t,o){e.#W.run(t,o)},e.#W.default=function(t){console.warn(`Unrecognized sequencer-specific byte sequence: ${t}`)},e.#W.add([67,0,1],function(t,o){w()&&console.debug(`XGworks requests assigning track ${o} to output ${t[0]}.`),e.#F[o]=t[0]+1}),e.#Y=new P("universal non-realtime"),e.#j=new P("universal realtime"),e.#x=new P("Yamaha"),e.#T=new P("Roland"),e.#U=new P("Korg"),e.#J=new P("Kawai"),e.#Z=new P("Akai"),e.#ee=new P("Casio");let a=new P("DX7+ Dump"),d=function(t){console.info(`Unrecognized SysEx in "${this.name}" set.
%o`,t)};e.#Y.default=d,e.#j.default=d,e.#x.default=d,e.#T.default=d,e.#U.default=d,e.#J.default=d,e.#Z.default=d,e.#ee.default=d,a.default=d,e.#Y.add([9],(t,o,c)=>{e.switchMode(["gm","?","g2"][t[0]-1],!0),e.setPortMode(e.getTrackPort(o),1,m[["gm","?","g2"][t[0]-1]]),e.#o=e.#o||!1,console.info(`MIDI reset: ${["GM","Init","GM2"][t[0]-1]}`),t[0]==2&&e.init()}),e.#j.add([4,1],(t,o,c)=>{e.dispatchEvent("mupromptex"),e.#n=((t[1]<<7)+t[0])/16383*100,e.dispatchEvent("mastervolume",e.#n)}).add([4,3],(t,o,c)=>((t[1]<<7)+t[0]-8192)/8192).add([4,4],(t,o,c)=>t[1]-64).add([4,5],(t,o,c)=>{e.dispatchEvent("mupromptex");let r=t[0],s=t[1],n=t[2],i=3,f=i+(r<<1),l=f+s;if(r!=1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${r})!
`,t);return}let g=0,E=0,k=0;switch(t.subarray(i,f).forEach(C=>{g=g<<7,g|=C}),t.subarray(f,l).forEach((C,x)=>{E|=C<<x*7}),t.subarray(l).forEach((C,x)=>{k|=C<<x*7}),w()&&console.debug(`GM2 global parameter: (${t.subarray(3,f)}; p: ${E}, v: ${k})`),g){case 129:{E==0&&(e.setEffectType(0,52,k),e.dispatchEvent("efxreverb",e.getEffectType(0)));break}case 130:{E==0&&(e.setEffectType(1,52,k|16),e.dispatchEvent("efxchorus",e.getEffectType(1)));break}default:w()&&console.debug("GM2 global paramater slot path unknown.")}}),this.#x.add([76,0,0],(t,o,c)=>{switch(t[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset: ${t}`);break}case 126:{e.switchMode("xg",!0),e.setPortMode(e.getTrackPort(o),4,m.xg),e.#o=!1,console.info("MIDI reset: XG");break}default:{e.dispatchEvent("mupromptex");let r=[0,0,0,0],s=(n,i)=>{r[i]=n};if(t.subarray(1).forEach((n,i)=>{let f=i+t[0];([s,s,s,s,l=>{this.#n=l*129/16383*100,e.dispatchEvent("mastervolume",e.#n)},l=>{},l=>{}][f]||(()=>{}))(n,i)}),t[0]<4){let n=0;r.forEach(i=>{n=n<<4,n+=i}),n-=1024}}}}).add([76,2,1],(t,o,c)=>{e.dispatchEvent("mupromptex");let r="XG ";t[0]<32?(r+="reverb ",t.subarray(1).forEach((s,n)=>{([i=>{e.setEffectTypeRaw(0,!1,i),console.info(`${r}main type: ${I[i]}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},i=>{e.setEffectTypeRaw(0,!0,i),console.debug(`${r}sub type: ${i+1}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},i=>{console.debug(`${r}time: ${ie(i)}s`)},i=>{console.debug(`${r}diffusion: ${i}`)},i=>{console.debug(`${r}initial delay: ${i}`)},i=>{console.debug(`${r}HPF cutoff: ${H[i]}Hz`)},i=>{console.debug(`${r}LPF cutoff: ${H[i]}Hz`)},i=>{console.debug(`${r}width: ${i}`)},i=>{console.debug(`${r}height: ${i}`)},i=>{console.debug(`${r}depth: ${i}`)},i=>{console.debug(`${r}wall type: ${i}`)},i=>{console.debug(`${r}dry/wet: ${i}`)},i=>{console.debug(`${r}send: ${M(i)}dB`)},i=>{console.debug(`${r}pan: ${i-64}`)},!1,!1,i=>{console.debug(`${r}delay: ${i}`)},i=>{console.debug(`${r}density: ${i}`)},i=>{console.debug(`${r}balance: ${i}`)},i=>{},i=>{console.debug(`${r}feedback: ${i}`)},i=>{}][t[0]+n]||function(){console.warn(`Unknown XG reverb address: ${t[0]}.`)})(s)})):t[0]<64?(r+="chorus ",t.subarray(1).forEach((s,n)=>{([i=>{e.setEffectTypeRaw(1,!1,i),console.info(`${r}main type: ${I[i]}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},i=>{e.setEffectTypeRaw(1,!0,i),console.debug(`${r}sub type: ${i+1}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},i=>{console.debug(`${r}LFO: ${se[i]}Hz`)},i=>{},i=>{console.debug(`${r}feedback: ${i}`)},i=>{console.debug(`${r}delay offset: ${ce(i)}ms`)},i=>{},i=>{console.debug(`${r}low: ${H[i]}Hz`)},i=>{console.debug(`${r}low: ${i-64}dB`)},i=>{console.debug(`${r}high: ${H[i]}Hz`)},i=>{console.debug(`${r}high: ${i-64}dB`)},i=>{console.debug(`${r}dry/wet: ${i}`)},i=>{console.debug(`${r}send: ${M(i)}dB`)},i=>{console.debug(`${r}pan: ${i-64}`)},i=>{console.debug(`${r}to reverb: ${M(i)}dB`)},!1,i=>{},i=>{},i=>{},i=>{console.debug(`${r}LFO phase diff: ${(i-64)*3}deg`)},i=>{console.debug(`${r}input mode: ${i?"stereo":"mono"}`)},i=>{}][t[0]-32+n]||function(){console.warn(`Unknown XG chorus address: ${t[0]}.`)})(s)})):t[0]<86?(r+="variation ",t.subarray(1).forEach((s,n)=>{([i=>{e.setEffectTypeRaw(2,!1,i),console.info(`${r}main type: ${I[i]}`),e.dispatchEvent("efxdelay",e.getEffectType(2))},i=>{e.setEffectTypeRaw(2,!0,i),console.debug(`${r}sub type: ${i+1}`),e.dispatchEvent("efxdelay",e.getEffectType(2))}][t[0]-64+n]||function(){})(s)})):t[0]<97?(r+="variation ",t.subarray(1).forEach((s,n)=>{[i=>{console.debug(`${r}send: ${M(i)}dB`)},i=>{console.debug(`${r}pan: ${i-64}`)},i=>{console.debug(`${r}to reverb: ${M(i)}dB`)},i=>{console.debug(`${r}to chorus: ${M(i)}dB`)},i=>{console.debug(`${r}connection: ${i?"system":"insertion"}`)},i=>{console.debug(`${r}channel: CH${i+1}`)},i=>{console.debug(`${r}mod wheel: ${i-64}`)},i=>{console.debug(`${r}bend wheel: ${i-64}`)},i=>{console.debug(`${r}channel after touch: ${i-64}`)},i=>{console.debug(`${r}AC1: ${i-64}`)},i=>{console.debug(`${r}AC2: ${i-64}`)}][t[0]-86+n](s)})):t[0]>111&&t[0]<118?r+="variation ":console.warn(`Unknown XG variation address: ${t[0]}`)}).add([76,2,64],(t,o,c)=>{t.subarray(1).forEach((r,s)=>{let n=s+t[0];if(n==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][r]}`);else{let i=n-1>>2,f=n-1&3,l=`XG EQ ${i} ${["gain","freq","Q","shape"][f]}: `;[()=>{console.debug(`${l}${r-64}dB`)},()=>{console.debug(`${l}${r} (raw)`)},()=>{console.debug(`${l}${r/10}`)},()=>{console.debug(`${l}${["shelf","peak"][+!!r]}`)}][f]()}})}).add([76,3],(t,o,c)=>{e.dispatchEvent("mupromptex");let r=t[0],s=t[1],n=`XG Insertion ${t[0]+1} `;t.subarray(2).forEach((i,f)=>{([l=>{e.setEffectTypeRaw(3+r,!1,l),console.info(`${n}main type: ${I[l]}`),e.dispatchEvent(`efxinsert${r}`,e.getEffectType(3+r))},l=>{e.setEffectTypeRaw(3+r,!0,l),console.debug(`${n}sub type: ${l+1}`),e.dispatchEvent(`efxinsert${r}`,e.getEffectType(3+r))}][s+f]||function(){})(i)})}).add([76,6,0],(t,o,c)=>{let r=t[0];r<64?e.setLetterDisplay(t.subarray(1),"XG letter display",r):e.#V=Date.now()}).add([76,7,0],(t,o,c)=>{let r=t[0];e.#g=0,e.#M=Date.now()+3200,e.#$.fill(0);let s=t.subarray(1);for(let n=0;n<r;n++)s.unshift(0);s.forEach(function(n,i){let f=Math.floor(i/16),l=i%16,g=(l*3+f)*7,E=7,k=0;for(g-=l*5,f==2&&(E=2);k<E;)e.#$[g+k]=n>>6-k&1,k++})}).add([76,8],(t,o)=>{e.dispatchEvent("mupromptex");let c=e.chRedir(t[0],o,!0),r=t[1],s=u.cc*c,n=`XG CH${c+1} `,i=`Unknown XG part address ${r}.`,f=!0;t.subarray(2).forEach((l,g)=>{f=!0,r<1?console.debug(i):r<41?([()=>{e.#e[s+p[0]]=l,e.pushChPrimitives(c),e.dispatchEvent("voice",{part:c})},()=>{e.#e[s+p[32]]=l,e.pushChPrimitives(c),e.dispatchEvent("voice",{part:c})},()=>{e.#s[c]=l,e.dispatchEvent("voice",{part:c})},()=>{f=!1;let E=e.chRedir(l,o,!0);e.#f[c]=E,c!=E&&(e.buildRchTree(),console.info(`${n}receives from CH${E+1}`)),e.#S[c]||(e.copyChSetup(E,c,!0),console.debug(`${n}copied from CH${E+1}.`),e.setChActive(c,1),e.dispatchEvent("voice",{part:c}))},()=>{e.#v[c]=+!l},()=>{},()=>{f=!1,e.setChType(c,l,m.xg),console.debug(`${n}type: ${G[l]||l}`),e.dispatchEvent("voice",{part:c})},()=>{e.#r[u.rpn*c+3]=l,e.#i[u.rpnt*c+2]=1,e.dispatchEvent("pitch",{part:c,pitch:e.getPitchShift(c)})},!1,!1,()=>{e.#e[s+p[7]]=l},!1,!1,()=>{e.#e[s+p[10]]=l||128},!1,!1,()=>{e.#e[s+p[128]]=l,e.allocateAce(c,128)},()=>{e.#e[s+p[93]]=l},()=>{e.#e[s+p[91]]=l},()=>{e.#e[s+p[94]]=l},()=>{e.#e[s+p[76]]=l},()=>{e.#e[s+p[77]]=l},()=>{e.#e[s+p[78]]=l},()=>{e.#e[s+p[74]]=l},()=>{e.#e[s+p[71]]=l},()=>{e.#e[s+p[73]]=l},()=>{e.#e[s+p[75]]=l},()=>{e.#e[s+p[72]]=l}][r+g-1]||(()=>{}))():r<48?console.debug(i):r<111?r>102&&r<105&&(e.#e[s+p[[5,65][r&1]]]=l):r<114?console.debug(i):r<116?console.debug(`${n}EQ ${["bass","treble"][r&1]} gain: ${l-64}dB`):r<118?console.debug(i):r<120?console.debug(`${n}EQ ${["bass","treble"][r&1]} freq: ${l}`):console.debug(i)}),f&&e.#a[c]>1&&e.setDrumFirstWrite(c)}).add([76,9],(t,o)=>{let c=e.chRedir(t[0],o,!0),r=t[1],s=u.cc*c,n=`PLG-VL CH${c+1} `;t.subarray(2).forEach((i,f)=>{let l=f+r;switch(l){case 1:{console.info(`${n}breath mode: ${["system","breath","velocity","touch EG"][i]}`);break}case 0:case 27:case 28:break;default:if(l<27){let g=l-3>>1,E=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][g];l&1?l<23?(console.debug(`${n}${E} control source: ${le(i)}`),i&&i<96&&e.allocateAce(c,130+g),e.#z[u.redir*c+g+2]=i,e.buildRccMap()):console.debug(`${n}${E} scale break point: ${i}`):(console.debug(`${n}${E} depth: ${i-64}`),e.#e[s+p[130+g]]=i)}}})}).add([76,10],(t,o,c)=>{}).add([76,16],(t,o,c)=>{}).add([76,17,0,0],(t,o,c)=>{}).add([76,112],(t,o,c)=>{switch(console.debug(`XG enable PLG-${["VL","SG","DX","AN","PF","DR","PC","AP"][t[0]]} for CH${t[2]+1}.`),t[0]){case 0:{e.#k[u.ext*t[2]]=e.EXT_VL;break}case 2:{e.#k[u.ext*t[2]]=e.EXT_DX;break}default:e.#k[u.ext*t[2]]=e.EXT_NONE}}).add([73,0,0],(t,o)=>{let c=t[0],r="MU1000 System - ";t.subarray(1).forEach((s,n)=>{let i=c+n;i==8?console.debug(`${r}LCD contrast: ${s}.`):i==18?(e.#p[m.xg][1]=s?126:0,console.debug(`${r}default bank: ${s?"MU100 Native":"MU Basic"}.`),e.dispatchEvent("banklevel",{mode:"xg",data:+!!s}),e.forceVoiceRefresh()):i>=64&&i<69&&[()=>{e.dispatchEvent("channelactive",s)},()=>{s<8?(e.dispatchEvent("channelmin",s<<4),console.debug(`Octavia System: Minimum CH${(s<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{s<8?(e.dispatchEvent("channelmax",(s<<4)+15),console.debug(`Octavia System: Maximum CH${(s<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{e.#L=!!s,console.info(`Octavia System: RS receiving ${["dis","en"][s]}abled.`)}][i-64]()})}).add([73,10,0],(t,o)=>{let c=t[0],r=`MU1000 RS${e.#L?"":" (ignored)"}: `;if(c<16)switch(c){case 2:{let s=e.chRedir(0,o,!0);e.#L&&(e.dispatchEvent("portrange",4),e.dispatchEvent("portstart",s)),console.info(`${r}Show CH${s+1}~CH${s+64}`);break}case 3:{let s=e.chRedir(t[1]<<5,o,!0);e.#L&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",s)),console.info(`${r}Show CH${s+1}~CH${s+32}`);break}default:console.debug(`${r}unknown switch ${c} invoked.`)}else if(c<32){if(e.#L){let s=e.chRedir(c-16+(e.#ce<<4),o,!0);e.dispatchEvent("channelactive",s)}}else if(c<36){let s=e.chRedir(c-32<<4,o,!0);e.#L&&(e.dispatchEvent("portrange",1),e.dispatchEvent("portstart",s>>4),e.#ce=c-32),console.info(`${r}Show CH${s+1}~CH${s+16}`)}}).add([73,11,0],(t,o)=>{let c="MU1000 System - channel ",r="Octavia System - channel ",s=t[0];t.subarray(1).forEach((n,i)=>{let f=s+i;([()=>{e.setChActive(n,1),e.dispatchEvent("channelactive",n),w()&&console.debug(`${c}current part: CH${n+1}`)},()=>{n<5?(e.dispatchEvent("portrange",1<<n),console.debug(`${c}port range: ${1<<n} port(s)`)):(e.dispatchEvent("portrange",0),console.debug(`${c}port range: reset`))},()=>{n<16?(e.dispatchEvent("portstart",n),console.debug(`${r}start port: ${"ABCDEFGHIJKLMNOP"[n]}`)):(e.dispatchEvent("portstart",255),console.debug(`${r}start port: reset`))}][f]||(()=>{console.debug(`${c}unknown address: ${f}`)}))()})}).add([93,3],(t,o)=>{let c=e.chRedir(t[0],o,!0),r=`PLG-SG CH${c+1} `,s=Date.now();if(t[1]==0){let n="",i=0;t.subarray(2).forEach((f,l)=>{l%2==0?n+=ne[f]||f.toString().padStart("0"):i+=f*13}),s>=e.#ie&&this.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"SGLyrics",data:`${oe(n)}`,amend:!0}),e.#ie=s+Math.ceil(i/2)+e.#se,w()&&console.debug(`${r}vocals: ${n}`)}else console.warn(`Unknown PLG-SG data: ${t}`)}).add([98,0],(t,o,c)=>{e.dispatchEvent("mupromptex");let r=t[0],s=t.length-5,n=t.length-1;if(r!=s){console.info(`PLG-DX native dump size mismatch! Gave ${r} instead of ${t.length-5}.`);return}let i=L(t.subarray(4,n));if(i!=t[n]){console.info(`Bad PLG-DX checksum ${t[n]} - should be ${i}.`);return}t[0]=98,e.#x.run(t.subarray(0,n),o,c,{noAce:!0})}).add([98,96],(t,o,c,r)=>{let s=e.chRedir(t[0],o,!0),n=u.cc*s,i=t[1];t.subarray(2).forEach((f,l)=>{let g=i+l;if(!(g<10)){if(g==10)e.resetAce();else if(g<27){let E=g+131;r?.noAce||e.allocateAce(s,E),e.#e[n+p[E]]=f,e.dispatchEvent("cc",{part:s,cc:E,data:f})}}})}).add([100,0],(t,o,c)=>{let r=t.subarray(0,t.length-1);if(t[0]+5!=t.length){console.warn(`Yamaha DX7+ dump SysEx size mismatch! Expected ${t.length}, but got ${t[0]}:
`,t);return}let s=L(r),n=t[t.length-1];if(s!=n){console.warn(`Yamaha DX7+ dump SysEx checksum mismatch! Expected ${s}, but got ${n}:
`,t);return}a.run(r.subarray(1))}).add([100,76],(t,o,c)=>{let r=t[0]>>4,s=t[0]&15,n=t[1];switch(r){case 2:{let i=e.chRedir(s,o,!0),f=u.cc*i;t.subarray(2).forEach((l,g)=>{let E=g+n;if(!(E<7)){if(E<23){let k=E+135;e.allocateAce(i,k),e.#e[f+p[k]]=l,e.dispatchEvent("cc",{part:i,cc:k,data:l})}}});break}default:console.info("Unknown DX7+ multipart: %o",t)}}).add([1,20],(t,o,c)=>{c==115?(e.switchMode("doc",!0),e.setPortMode(e.getTrackPort(o),1,m.doc),console.info("MIDI reset: DOC")):console.debug(`Unknown Yamaha SysEx: 67, ${c}, ${t.join(", ")}`)}).add([1,17,15,89],(t,o,c)=>{c==115?(e.setEffectType(0,24,t[0]|16),e.dispatchEvent("efxreverb",e.getEffectType(0))):console.debug(`Unknown Yamaha SysEx: 67, ${c}, ${t.join(", ")}`)}).add([1,24],(t,o,c)=>{if(c==115){for(let r=0;r<16;r++){let s=e.chRedir(r,o,!0);e.#e[s*u.cc+p[91]]=127}console.info("DOC Global Reverb: on")}else console.debug(`Unknown Yamaha SysEx: 67, ${c}, ${t.join(", ")}`)}),a.add([14,31],(t,o,c)=>{e.#e[u.cc*t[0]+p[64]]=0,e.#d.ano(t[0]),e.switchMode("xg"),e.setPortMode(e.getTrackPort(o),1,m.xg),e.resetAce(),console.debug(`Yamaha DX7+ reset CH${t[0]+1}.`)}).add([76,112],async t=>{let o=t[0],c=u.cc*o,r=u.ext*o,s=u.cvn*o;e.#k[r]=e.EXT_DX,e.#R[o]=1;let n=e.#ne.subarray(s,s+u.cvn);n.fill(32),t.subarray(1).forEach((i,f)=>{if(f<10)n[f]=Math.max(i,32);else if(!(f<40)){if(f<56){let l=f+102;e.#e[c+p[l]]=i,e.dispatchEvent("cc",{part:o,cc:l,data:i})}}}),e.#s[o]=o&127,e.#e[u.cc*o+p[0]]=35,e.#e[u.cc*o+p[32]]=o>>7|4,e.pushChPrimitives(o),e.dispatchEvent("voice",{part:o}),console.debug(`DX7+ CH${o+1} dump: %o`,t)});let h=function(t,o,c,r){},b=function(t,o){e.dispatchEvent("mupromptex");let c=t*u.dpn,r=o[0],s=o[1];o.subarray(2).forEach((n,i)=>{let f=i+s,l=-1;f<16?([()=>{l=24},()=>{l=25},()=>{l=26},()=>{},()=>{l=28},()=>{l=29},()=>{l=30},()=>{l=31},()=>{},()=>{},()=>{},()=>{l=20},()=>{l=21},()=>{l=22},()=>{l=23},()=>{}][f]||(()=>{console.debug(`Unknown XG-style drum param ${f} on set ${t+1}.`)}))():f<32||(f<40?([()=>{l=48},()=>{l=49},!1,!1,()=>{l=52},()=>{l=53}][f-32]||(()=>{console.debug(`Unknown XG-style drum param ${f} on set ${t+1}.`)}))():f<80||([()=>{l=36}][f-80]||(()=>{console.debug(`Unknown XG-style drum param ${f} on set ${t+1}.`)}))()),l>=0?(w()&&console.debug(c,l,r,n),e.#m[(c+D[l])*u.dnc+r]=n):w()&&console.debug(`XG-style drum param ${f} has no writes.`)})},y=function(t,o,c){e.dispatchEvent("mupromptex");let r=t*u.dpn,s=(o<<7)+c[0];c.subarray(1).forEach((n,i)=>{let f=i+s,l=f&127,g=f>>7,E=-1;g>1&&([()=>{E=26},()=>{},()=>{E=28},()=>{E=29},()=>{E=30},()=>{},()=>{},()=>{E=31}][g-2]||(()=>{console.debug(`Unknown GS-style drum param ${g} on set ${t+1}.`)}))(),E>-1?(w()&&console.debug(r,E,l,n),e.#m[(r+D[E])*u.dnc+l]=n):w()&&console.debug(`GS-style drum param ${g} has no writes.`)})};this.#x.add([76,48],(t,o,c)=>{b(0,t)}).add([76,49],(t,o,c)=>{b(1,t)}).add([76,50],(t,o,c)=>{b(2,t)}).add([76,51],(t,o,c)=>{b(3,t)}).add([76,52],(t,o,c)=>{b(4,t)}).add([76,53],(t,o,c)=>{b(5,t)}).add([76,54],(t,o,c)=>{b(6,t)}).add([76,55],(t,o,c)=>{b(7,t)}),this.#x.add([89,0],(t,o,c)=>{if(e.eprom){let r=t[0],s=(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);w()&&console.debug(`MU1000 EPROM trail to 0x${s.toString(16).padStart(6,"0")}, ${r} bytes.`);let n=e.eprom.data;t.subarray(4).forEach((i,f)=>{let l=f>>3,g=f&7;if(g==7)for(let E=0;E<7;E++)n[s+7*l+E]+=(i>>6-E&1)<<7;else n[s+7*l+g]=i})}}).add([89,1],(t,o,c)=>{let r=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3];w()&&console.debug(`MU1000 EPROM jump to 0x${r.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=r)}).add([89,2],(t,o,c)=>{if(e.eprom){let r=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);w()&&console.debug(`MU1000 EPROM write to 0x${r.toString(16).padStart(6,"0")}.`);let s=e.eprom.data;t.subarray(4).forEach((n,i)=>{let f=i>>3,l=i&7;if(l==7)for(let g=0;g<7;g++)s[r+7*f+g]+=(n>>6-g&1)<<7;else s[r+7*f+l]=n})}}).add([89,3],(t,o,c)=>{}),this.#x.add([39,48],(t,o,c)=>{}).add([43,0,0],(t,o,c)=>{e.dispatchEvent("mupromptex");let r=[0,0,0,0],s=(n,i)=>{r[i]=n};if(t.subarray(1).forEach((n,i)=>{let f=i+t[0];[s,s,s,s,()=>{this.#n=n*129/16383*100,e.dispatchEvent("mastervolume",e.#n)},()=>n-64,()=>n||128,()=>n,()=>n,()=>{console.debug(`TG300 variation on cc${n}.`)}][f](n,f)}),t[0]<4){let n=0;r.forEach(i=>{n=n<<4,n+=i}),n-=1024}}).add([43,1,0],(t,o,c)=>{e.dispatchEvent("mupromptex")}).add([43,2],(t,o,c)=>{e.dispatchEvent("mupromptex");let r=e.chRedir(t[0],o,!0),s=t[1],n=u.cc*r,i=`TG300 CH${r+1} `;t.subarray(2).forEach((f,l)=>{l<5?([()=>{},()=>{e.#e[n+p[0]]=f,e.pushChPrimitives(r),e.dispatchEvent("voice",{part:r})},()=>{e.#e[n+p[32]]=f,e.pushChPrimitives(r),e.dispatchEvent("voice",{part:r})},()=>{e.#s[r]=f,e.dispatchEvent("voice",{part:r})},()=>{let g=e.chRedir(f,o,!0);e.#f[r]=g,r!=g&&(e.buildRchTree(),console.info(`${i}receives from CH${g+1}`))}][l+s]||(()=>{}))(f,l+s):l<21||(l<47?([()=>{e.#v[r]=+!f},()=>{},()=>{},()=>{e.#r[u.rpn*r+3]=f,e.#i[u.rpnt*r+2]=1,e.dispatchEvent("pitch",{part:r,pitch:e.getPitchShift(r)})},()=>{},()=>{e.#e[n+p[7]]=f},!1,!1,()=>{e.#e[n+p[10]]=f||128},!1,!1,()=>{console.debug(`${i} AC1 at cc${f}`)},()=>{console.debug(`${i} AC2 at cc${f}`)},()=>{e.#e[n+p[128]]=f,e.allocateAce(r,128)},()=>{e.#e[n+p[93]]=f},()=>{e.#e[n+p[91]]=f},()=>{e.#e[n+p[94]]=f},()=>{e.#e[n+p[76]]=f},()=>{e.#e[n+p[77]]=f},()=>{e.#e[n+p[74]]=f},()=>{e.#e[n+p[71]]=f},()=>{e.#e[n+p[73]]=f},()=>{e.#e[n+p[75]]=f},()=>{e.#e[n+p[72]]=f},()=>{e.#e[n+p[78]]=f}][l+s-21]||(()=>{}))(f,l+s):l<95||([()=>{e.#e[n+p[65]]=f},()=>{e.#e[n+p[5]]=f}][l+s-95]||(()=>{}))(f,l+s))})}).add([43,7,0],(t,o,c)=>{let r=t[0];e.setLetterDisplay(t.subarray(1),"TG300 letter display",r)}).add([43,7,1],(t,o,c)=>{e.#g=0,e.#M=Date.now()+3200,e.#$.fill(0),t.forEach(function(r,s){let n=Math.floor(s/16),i=s%16,f=(i*3+n)*7,l=7,g=0;for(f-=i*5,n==2&&(l=2);g<l;)e.#$[f+g]=r>>6-g&1,g++})}),this.#T.add([66,18,0,0,127],(t,o,c)=>{e.switchMode("sc",!0),e.setPortMode(e.getTrackPort(o),2,m.sc),e.#e[u.cc*9]=120,e.#e[u.cc*25]=120,e.#e[u.cc*41]=120,e.#e[u.cc*57]=120,e.#p[m.sc][1]=e.#c.sc,e.#o=!1,e.#B.fill(0),console.info(`GS system to ${["single","dual"][t[0]]} mode.`)}).add([66,18,64,0],(t,o,c)=>{switch(t[0]){case 127:{e.switchMode("gs",!0),e.setPortMode(e.getTrackPort(o),2,m.gs),e.#p[m.gs][1]=e.#c.gs,e.#e[u.cc*9]=120,e.#e[u.cc*25]=120,e.#e[u.cc*41]=120,e.#e[u.cc*57]=120,e.#o=!1,e.#B.fill(0),console.info("MIDI reset: GS");break}default:{e.dispatchEvent("mupromptex");let r=[0,0,0,0],s=(n,i)=>{r[i]=n};if(t.subarray(1).forEach((n,i)=>{let f=i+t[0];[s,s,s,s,l=>{this.#n=l*129/16383*100,e.dispatchEvent("mastervolume",e.#n)},l=>{},l=>{}][f](n,i)}),t[0]<4){let n=0;r.forEach(i=>{n=n<<4,n+=i}),n-=1024}}}}).add([66,18,64,1],(t,o,c)=>{e.dispatchEvent("mupromptex");let r=t[0];if(r<16){let s="".padStart(r," ");t.subarray(1).forEach((n,i)=>{s+=String.fromCharCode(Math.max(32,n))}),s=s.padEnd(16," "),console.debug(`GS patch name: ${s}`)}else r<48||(r<65?t.subarray(1).forEach((s,n)=>{let i=`GS ${r+n>55?"chorus":"reverb"} `;([()=>{console.info(`${i}type: ${W[s]}`),e.setEffectType(0,40,s),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${i}predelay: ${s}ms`)},()=>{console.info(`${i}type: ${de[s]}`),e.setEffectType(1,40,16+s),e.dispatchEvent("efxchorus",e.getEffectType(1))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${i}to reverb: ${M(s)}`)},()=>{console.debug(`${i}to delay: ${M(s)}`)}][r+n-48]||(()=>{}))()}):r<80?console.debug(`Unknown GS patch address: ${r}`):r<91?t.subarray(1).forEach((s,n)=>{let i="GS delay ";([()=>{console.info(`${i}type: ${fe[s]}`),e.setEffectType(2,40,32+s),e.dispatchEvent("efxdelay",e.getEffectType(2))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${i}to reverb: ${M(s)}`)}][r+n-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${r}`))}).add([66,18,64,2],(t,o,c)=>{let r="GS EQ ";t.subarray(1).forEach((s,n)=>{([()=>{console.debug(`${r}low freq: ${[200,400][s]}Hz`)},()=>{console.debug(`${r}low gain: ${s-64}dB`)},()=>{console.debug(`${r}high freq: ${[3e3,6e3][s]}Hz`)},()=>{console.debug(`${r}high gain: ${s-64}dB`)}][t[0]+n]||function(){console.warn(`Unknown GS EQ address: ${t[0]+n}`)})()})}).add([66,18,64,3],(t,o,c)=>{e.dispatchEvent("mupromptex");let r="GS EFX ",s=function(n,i){let f=he(e.#w.subarray(10,12),i,n);f&&console.debug(`${r}${Y(e.#w.subarray(10,12))} ${f}`)};t.subarray(1).forEach((n,i)=>{([()=>{e.setEffectTypeRaw(3,!1,32+n),e.dispatchEvent("efxinsert0",e.getEffectType(3))},()=>{e.setEffectTypeRaw(3,!0,n),console.info(`${r}type: ${Y(e.#w.subarray(10,12))}`),e.dispatchEvent("efxinsert0",e.getEffectType(3))},!1,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,()=>{console.debug(`${r}to reverb: ${M(n)}dB`)},()=>{console.debug(`${r}to chorus: ${M(n)}dB`)},()=>{console.debug(`${r}to delay: ${M(n)}dB`)},!1,()=>{console.debug(`${r}1 source: ${n}`),n&&n<96&&e.allocateAceAll(n)},()=>{console.debug(`${r}1 depth: ${n-64}`)},()=>{console.debug(`${r}2 source: ${n}`),n&&n<96&&e.allocateAceAll(n)},()=>{console.debug(`${r}2 depth: ${n-64}`)},()=>{console.debug(`${r}to EQ: ${n?"ON":"OFF"}`)}][t[0]+i]||function(f,l){console.warn(`Unknown GS EFX address: ${l}`)})(n,t[0]+i)})}).add([66,18,65],(t,o,c)=>{y((t[0]>>4)+1<<1,t[0]&15,t.subarray(1))}).add([69,18,16],(t,o,c)=>{switch(t[0]){case 0:{let r=t[1];e.setLetterDisplay(t.subarray(2),"GS display text",r);break}case 8:{let r=t[1],s=e.modelEx.sc;t.subarray(2).forEach((n,i)=>{([()=>{s.showBar=!(n&1),s.invBar=n>>1&1,s.invDisp=n>>2&1},()=>{s.peakHold=n<4?n:1}][i+r]||(()=>{console.debug("Unsupported GS display type SysEx.")}))()});break}case 32:{e.#M=Date.now()+3200,t[1]==0&&(t[2]?(e.#g=Math.max(Math.min(t[2]-1,9),0),w()&&console.debug(`GS switch display page ${t[2]-1}.`)):(e.#g=0,e.#M=Date.now(),w()&&console.debug("GS disable display page.")));break}default:if(t[0]<6){e.#g>9&&(e.#g=0);let r=t[0]-1<<1|t[1]>>6;e.#g==r&&(e.#M=Date.now()+3200),e.#H[r]?.length||(e.#H[r]=new Uint8Array(256));let s=e.#H[r];w()&&console.debug(`GS frame draw page ${r}.`);let n=t[1]&63;s.fill(0),t.subarray(2).forEach(function(f,l){let g=l+n,E=Math.floor(g/16),k=g%16,C=(k*4+E)*5,x=5,O=0;for(C-=k*4,E==3&&(x=1);O<x;)s[C+O]=f>>4-O&1,O++})}else console.warn(`Unknown GS display section: ${t[0]}`)}}).add([69,18,32],(t,o,c)=>{let r=t[0],s=t[1],n=t.subarray(2);if(r>>4){console.warn(`SC-8850 partial screen dump out of bounds: invalid bundle.
`,t);return}let i=s+n.length,f=s*6-(s*2428>>16<<1),l=i*6-(i*2428>>16<<1);if(f>640){console.warn(`SC-8850 partial screen dump out of bounds: invalid buffer range.
`,t);return}l>640&&(console.info(`SC-8850 partial screen dump out of bounds: invalid buffer end, automatically restricted.
`,t),l=640);let g=new Uint8Array(l-f);n.forEach((C,x)=>{let O=x+s,F=(O*2428&65535)*27>>16==26,T=O*6-(O*2428>>16<<1),U=F?2:0;for(;U<6;)g[T+(5-U)]=C>>U&1,U++});let E=r*108+s,k=E*6-(E*2428>>16<<1);e.dispatchEvent("screen",{type:"sc8850",offset:k,data:g}),w()&&console.debug(`SC-8850 screen dump: bundle ${r+1}, range ${f}~${l}`)});let $=function(t,o,c){e.dispatchEvent("mupromptex");let r=t[0],s=u.cc*o,n=u.rpn*o,i=`GS CH${o+1} `;r<3?(t.subarray(1).forEach((f,l)=>{[()=>{e.#e[s+p[0]]=f,e.pushChPrimitives(o)},()=>{e.#s[o]=f},()=>{let g=0;f<16?g=e.chRedir(f,c,!0):g=u.ch,e.#f[o]=g,o!=g&&(e.buildRchTree(),console.info(`${i}receives from CH${g+1}`))}][r+l]()}),e.dispatchEvent("voice",{part:o})):r<19||(r<44?t.subarray(1).forEach((f,l)=>{([()=>{e.#v[o]=+!f},!1,()=>{e.setChType(o,f<<1,m.gs),console.debug(`${i}type: ${f?"drum ":"melodic"}${f||""}`)},()=>{e.#r[n+3]=f,e.#i[u.rpnt*o+2]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)})},!1,()=>{e.#e[s+p[7]]=f},!1,!1,()=>{e.#e[s+p[10]]=f||128},!1,!1,()=>{console.debug(`${i}CC 1: cc${f}`)},()=>{console.debug(`${i}CC 2: cc${f}`)},()=>{e.#e[s+p[93]]=f},()=>{e.#e[s+p[91]]=f},!1,!1,()=>{e.#r[n+1]=f,e.#i[u.rpnt*o+1]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)})},()=>{e.#r[n+2]=f,e.#i[u.rpnt*o+1]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)})},()=>{e.#e[s+p[94]]=f}][r+l-19]||(()=>{}))()}):r<76||console.debug(`Unknown GS part address: ${r}`))},v=function(t,o){let c=t[0],r=`GS CH${o+1} `;c<2?t.subarray(1).forEach((s,n)=>{[()=>{e.#e[u.cc*o+p[32]]=s},()=>{}][c+n]()}):c<32?console.warn(`Unknown GS misc address: ${c}`):c<35?t.subarray(1).forEach((s,n)=>{[()=>{console.debug(`${r}EQ: o${["ff","n"][s]}`)},()=>{},()=>{console.debug(`${r}EFX: o${["ff","n"][s]}`),e.#ae[o]=s,e.dispatchEvent("partefxtoggle",{part:o,active:s})}][c+n-32]()}):console.warn(`Unknown GS misc address: ${c}`)};this.#T.add([66,18,64,16],(t,o)=>{$(t,e.chRedir(9,o,!0),o)}).add([66,18,64,17],(t,o)=>{$(t,e.chRedir(0,o,!0),o)}).add([66,18,64,18],(t,o)=>{$(t,e.chRedir(1,o,!0),o)}).add([66,18,64,19],(t,o)=>{$(t,e.chRedir(2,o,!0),o)}).add([66,18,64,20],(t,o)=>{$(t,e.chRedir(3,o,!0),o)}).add([66,18,64,21],(t,o)=>{$(t,e.chRedir(4,o,!0),o)}).add([66,18,64,22],(t,o)=>{$(t,e.chRedir(5,o,!0),o)}).add([66,18,64,23],(t,o)=>{$(t,e.chRedir(6,o,!0),o)}).add([66,18,64,24],(t,o)=>{$(t,e.chRedir(7,o,!0),o)}).add([66,18,64,25],(t,o)=>{$(t,e.chRedir(8,o,!0),o)}).add([66,18,64,26],(t,o)=>{$(t,e.chRedir(10,o,!0),o)}).add([66,18,64,27],(t,o)=>{$(t,e.chRedir(11,o,!0),o)}).add([66,18,64,28],(t,o)=>{$(t,e.chRedir(12,o,!0),o)}).add([66,18,64,29],(t,o)=>{$(t,e.chRedir(13,o,!0),o)}).add([66,18,64,30],(t,o)=>{$(t,e.chRedir(14,o,!0),o)}).add([66,18,64,31],(t,o)=>{$(t,e.chRedir(15,o,!0),o)}).add([66,18,64,64],(t,o)=>{v(t,e.chRedir(9,o,!0))}).add([66,18,64,65],(t,o)=>{v(t,e.chRedir(0,o,!0))}).add([66,18,64,66],(t,o)=>{v(t,e.chRedir(1,o,!0))}).add([66,18,64,67],(t,o)=>{v(t,e.chRedir(2,o,!0))}).add([66,18,64,68],(t,o)=>{v(t,e.chRedir(3,o,!0))}).add([66,18,64,69],(t,o)=>{v(t,e.chRedir(4,o,!0))}).add([66,18,64,70],(t,o)=>{v(t,e.chRedir(5,o,!0))}).add([66,18,64,71],(t,o)=>{v(t,e.chRedir(6,o,!0))}).add([66,18,64,72],(t,o)=>{v(t,e.chRedir(7,o,!0))}).add([66,18,64,73],(t,o)=>{v(t,e.chRedir(8,o,!0))}).add([66,18,64,74],(t,o)=>{v(t,e.chRedir(10,o,!0))}).add([66,18,64,75],(t,o)=>{v(t,e.chRedir(11,o,!0))}).add([66,18,64,76],(t,o)=>{v(t,e.chRedir(12,o,!0))}).add([66,18,64,77],(t,o)=>{v(t,e.chRedir(13,o,!0))}).add([66,18,64,78],(t,o)=>{v(t,e.chRedir(14,o,!0))}).add([66,18,64,79],(t,o)=>{v(t,e.chRedir(15,o,!0))}),this.#U.add([54,65],(t,o)=>{let c=e.#c.x5=="81"?"05rw":"x5d";e.switchMode(c,!0),e.setPortMode(e.getTrackPort(o),1,m[c]);let r=t[t.length-1],s=t.subarray(0,t.length-1),n=L(s);n!=r&&(console.info(`X5D multi parameters checksum mismatch! Expected ${n}, got ${r}.`),console.debug(t));let i=(t[1]<<7)+t[0],f=(t[3]<<7)+t[2],l=e.chRedir(i&15,o,!0),g=u.cc*l;[()=>{f<1||(f<101?(e.setChType(l,e.CH_MELODIC,m.x5d),e.#s[l]=f-1,e.#e[g+p[0]]=e.#c.x5):f<229?(e.setChType(l,e.CH_MELODIC,m.x5d),e.#s[l]=f-101,e.#e[g+p[0]]=56):(e.setChType(l,e.CH_DRUMS,m.x5d),e.#s[l]=$e[f-229]||0,e.#e[g+p[0]]=62)),e.pushChPrimitives(l),e.dispatchEvent("voice",{part:l})},()=>{e.#e[g+p[7]]=f},()=>{f<31&&(e.#e[g+p[10]]=Math.round((f-15)*4.2+64))},()=>{e.#e[g+p[93]]=_(f)},()=>{e.#e[g+p[91]]=_(f)},()=>{e.#r[l*u.rpn+3]=f>8191?f-16320:64+f,e.#i[u.rpnt*l+2]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)})},()=>{e.#r[l*u.rpn+1]=f>8191?f-16320:64+f,e.#i[u.rpnt*l+1]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)})},()=>{f>0&&(e.#r[l*u.rpn]=f,e.#i[u.rpnt*l]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)}))},()=>{}][i>>4]()}).add([54,76,0],(t,o)=>{e.dispatchEvent("mupromptex");let c=e.#c.x5=="81"?"05rw":"x5d";e.switchMode(c),e.setPortMode(e.getTrackPort(o),1,m[c]);let r="",s=e.#c.x5,n=0,i=0,f="MSB	PRG	LSB	NME";R(t,function(l,g){if(g<16400){let E=g%164;switch(!0){case E<10:{l>31&&(r+=String.fromCharCode(l));break}case E==10:break;case E==11:{f+=`
${s}	${n}	${i}	${r.trim().replace("Init Voice","")}`,n++,r="";break}}n>99&&(s=90,n=0)}}),e.userBank.clearRange({msb:e.#c.x5,prg:[0,99],lsb:0}),e.userBank.load(f),w()&&console.debug(f),e.forceVoiceRefresh()}).add([54,77,0],(t,o)=>{e.dispatchEvent("mupromptex");let c=e.#c.x5=="81"?"05rw":"x5d";e.switchMode(c),e.setPortMode(e.getTrackPort(o),1,m[c]);let r="",s=90,n=0,i=0,f="MSB	PRG	LSB	NME";R(t,function(l,g){if(g<13600){let E=g%136;switch(!0){case E<10:{l>31&&(r+=String.fromCharCode(l));break}case E==11:{f+=`
${s}	${n}	${i}	${r.trim().replace("Init Combi","")}`,n++,r="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(f),w()&&console.debug(f),e.forceVoiceRefresh()}).add([54,78],(t,o)=>{let c=e.#c.x5=="81"?"05rw":"x5d";e.switchMode(c),e.setPortMode(e.getTrackPort(o),1,m[c]),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][t[0]]} mode.`)}).add([54,85],(t,o)=>{e.dispatchEvent("mupromptex");let c=e.#c.x5=="81"?"05rw":"x5d";e.switchMode(c),e.setPortMode(e.getTrackPort(o),1,m[c]),R(t,(r,s)=>{s>0&&s<3&&(e.setEffectType(s-1,44,r),e.dispatchEvent(`efx${["reverb","chorus"][s-1]}`,e.getEffectType(s-1)))})}).add([54,104],(t,o)=>{e.dispatchEvent("mupromptex");let c=e.#c.x5=="81"?"05rw":"x5d";e.switchMode(c,!0);let r=e.getTrackPort(o);if(e.#l[r]&&e.#l[r]!=m[c])if(e.#A.dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${o}. Port ${String.fromCharCode(65+r)} mode "${S[e.#l[r]]}" mismatch, should be "${c}".`);return}else console.info(`Track ${o} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+r)}.`);e.setPortMode(r,1,m[c]),R(t,function(s,n,i,f){if(n<192){let l=e.chRedir(Math.floor(n/12),o,!0),g=l*u.cc;switch(n%12){case 0:{s<128?(e.setChType(l,e.CH_MELODIC,m.x5d),e.#e[g+p[0]]=e.#c.x5,e.#s[l]=s):(e.setChType(l,e.CH_DRUMS,m.x5d),e.#e[g+p[0]]=62,e.#s[l]=$e[s-128]),s>0&&e.setChActive(l,1),e.pushChPrimitives(l),e.dispatchEvent("voice",{part:l});break}case 1:{e.#e[g+p[7]]=s;break}case 2:{e.#r[l*u.rpn+3]=s>127?s-192:64+s,e.#i[u.rpnt*l+2]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)});break}case 3:{e.#r[l*u.rpn+1]=s>127?s-192:64+s,e.#i[u.rpnt*l+1]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)});break}case 4:{s<31&&(e.#e[g+p[10]]=Math.round((s-15)*4.2+64));break}case 5:{let E=s>>4,k=s&15;e.#e[g+p[91]]=_(k),e.#e[g+p[93]]=_(E);break}case 10:{e.#a[l]||(e.#e[g+p[0]]=s>>6?56:e.#c.x5,e.pushChPrimitives(l),e.dispatchEvent("voice",{part:l}));break}case 11:{let E=e.chRedir(s&15,o,!0),k=s>>4;e.#f[l]=s,(E!=l||k)&&(console.info(`X5D Part CH${l+1} receives from CH${E+1}.`),e.buildRchTree())}}}else{let l=e.chRedir(n-192,o,!0)}})}),this.#T.add([22,18,127],(t,o,c)=>{e.switchMode("mt32",!0),e.setPortMode(e.getTrackPort(o),1,m.mt32),e.#o=!1,e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(t,o,c)=>{e.switchMode("mt32");let r=e.chRedir(c,o,!0),s=t[1];t.subarray(2).forEach((n,i)=>{let f=i+s;e.#G[f+(r-1)*16]=n,([!1,()=>{let l=e.#G[r-1<<4];if(l<3){if(e.#R[r]=1,l==2)for(let g=0;g<name.length;g++)e.#D[(r-1)*u.cmt+g]=e.#_[n*u.cmt+g];else{let g=e.baseBank.get(0,n+(l<<6),127,"mt32").name;for(let E=0;E<g.length;E++)e.#D[(r-1)*u.cmt+E]=g.charCodeAt(E)}e.dispatchEvent("voice",{part:r})}},()=>{e.#r[r*u.rpn+3]=n+40,e.#i[u.rpnt*r+2]=1},()=>{e.#r[r*u.rpn+1]=n+14,e.#i[u.rpnt*r+1]=1},()=>{e.#r[r*u.rpn]=n,e.#i[u.rpnt*r]=1},!1,()=>{e.#e[u.cc*r+p[91]]=n?127:0},!1,()=>{e.#e[u.cc*r+p[7]]=n},()=>{e.#e[u.cc*r+p[10]]=Math.ceil(n*9.05)}][f]||(()=>{}))()})}).add([22,18,1],(t,o,c)=>{e.switchMode("mt32");let r=c&7;console.debug(`MT-32 slot #${c+1} Drum: ${t}`);let s=t[0]<<7|t[1];t.subarray(2).forEach((n,i)=>{let f=i+s,l=(f>>2)+24,g=f&3,E=r*u.dpn;if(w()&&console.debug(`MT-32 temp drum note ${l} param ${g}: ${n}`),l<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${l}`);return}[()=>{},()=>{e.#m[(E+D[26])*u.dnc+l]=Math.round(n*1.27)},()=>{e.#m[(E+D[26])*u.dnc+l]=n*9+1&127},()=>{e.#m[(E+D[26])*u.dnc+l]=n?127:0}][g]()})}).add([22,18,2],(t,o,c)=>{e.switchMode("mt32");let r=e.chRedir(c,o,!0),s=t[1]+(t[0]<<7);s<10&&(e.#R[r]=1),t.subarray(2).forEach((n,i)=>{let f=i+s;f<14&&(e.#D[(r-1)*u.cmt+f]=n)}),e.dispatchEvent("voice",{part:r})}).add([22,18,3],(t,o,c)=>{e.switchMode("mt32");let r=c&7;if(t[0]){let s=(t[0]-1<<7)+t[1]-16;t.subarray(2).forEach((n,i)=>{let f=i+s,l=(f>>2)+24,g=f&3,E=r*u.dpn;if(w()&&console.debug(`MT-32 dev drum note ${l} param ${g}: ${n}`),l<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${l}`);return}[()=>{},()=>{e.#m[(E+D[26])*u.dnc+l]=Math.round(n*1.27)},()=>{e.#m[(E+D[26])*u.dnc+l]=n*9+1&127},()=>{e.#m[(E+D[26])*u.dnc+l]=n?127:0}][g]()})}else{let s=t[1];t.subarray(2).forEach((n,i)=>{let f=i+s;e.#G[f]=n;let l=e.chRedir(1+(f>>4),o,!0),g=f&15;([!1,()=>{let E=e.#G[l-1<<4];if(E<3)if(e.#R[l]=1,E==2)for(let k=0;k<name.length;k++)e.#D[(l-1)*u.cmt+k]=e.#_[n*u.cmt+k];else{let k=e.baseBank.get(0,n+(E<<6),127,"mt32").name;for(let C=0;C<k.length;C++)e.#D[(l-1)*u.cmt+C]=k.charCodeAt(C)}e.dispatchEvent("voice",{part:l})},()=>{e.#r[l*u.rpn+3]=n+40,e.#i[u.rpnt*l+2]=1},()=>{e.#r[l*u.rpn+1]=n+14,e.#i[u.rpnt*l+1]=1},()=>{e.#r[l*u.rpn]=n,e.#i[u.rpnt*l]=1},!1,()=>{e.#e[u.cc*l+p[91]]=n?127:0},!1,()=>{e.#e[u.cc*l+p[7]]=n},()=>{e.#e[u.cc*l+p[10]]=Math.ceil(n*9.05)}][g]||(()=>{}))()})}}).add([22,18,4],(t,o,c)=>{e.switchMode("mt32");let r=t[1]+(t[0]<<7),s=[];t.subarray(2).forEach((n,i)=>{let f=i+r,l=e.chRedir(Math.floor(f/246+1),o,!0),g=f%246;g<14&&(e.#D[(l-1)*u.cmt+g]=n),g<10&&(e.#R[l]=1),s.indexOf(l)<0&&s.push(l)}),s.forEach(n=>{e.dispatchEvent("voice",{part:n})})}).add([22,18,5],(t,o,c)=>{e.switchMode("mt32");let r=(t[0]<<7)+t[1];t.subarray(2).forEach((s,n)=>{let i=r+n,f=Math.floor(i/8),l=i&7,g=f*8;e.#re[i]=s,([!1,()=>{let E=e.#re[g];if(E<3){let k="";if(E==2){let x=u.cmt*f;k=`MT-m:${s.toString().padStart(3,"0")}`}else k=e.baseBank.get(0,s+(E<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:f});let C=`MSB	LSB	PRG	NME
000	127	${f}	${k}`;e.userBank.load(C,!0)}}][l]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(t,o,c)=>{e.switchMode("mt32");let r=((t[0]&1)<<7)+t[1],s=t[0]>>1,n=!1;if(t.subarray(2).forEach((i,f)=>{let l=r+f;l<u.cmt&&(e.#_[s*u.cmt+l]=i,n=!0)}),n){e.userBank.clearRange({msb:0,lsb:127,prg:s});let i=`MSB	LSB	PRG	NME
000	127	${s}	MT-m:${s}`;e.userBank.load(i,!0)}e.forceVoiceRefresh()}).add([22,18,16],(t,o,c)=>{e.switchMode("mt32");let r=t[1],s=!1,n=function(i,f){e.#f[f-12]=i,s=!0};t.subarray(2).forEach((i,f)=>{let l=f+r;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,n,n,n,n,n,n,n,n,n,()=>{e.#n=i,e.dispatchEvent("mastervolume",e.#n)}][l]||(()=>{}))(i,f)}),s&&e.buildRchTree()}).add([22,18,32],(t,o,c)=>{e.switchMode("mt32");let r=t[1],s=" ".repeat(r);t.subarray(2).forEach(n=>{n>31?s+=String.fromCharCode(n):s+=" "}),e.#X=s.padStart(20," "),e.#V=Date.now()+3200}).add([22,18,82],(t,o)=>{let c=e.chRedir(0,o,!0);for(let r=0;r<16;r++)e.#d.ano(c+r),r&&r<10&&(e.#s[c+r]=j[r-1]);console.info("MT-32 alt reset complete.")}),this.#U.add([66,0],(t,o)=>{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(o),2,m.ns5r),e.#o=!1,console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][t[0]]} mode.`)}).add([66,1],(t,o)=>{let c=["ns5r","05rw"][t[0]];e.switchMode(c,!0),e.setPortMode(e.getTrackPort(o),2,m[c]),e.#o=!1}).add([66,18,0,0],(t,o)=>{let c=t[0];switch(c){case 124:case 126:case 127:{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(o),2,m.ns5r),e.#o=!1;break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset: ${t}`);break}default:if(c<10){let r=[0,0,0,0],s=(n,i)=>{r[i]=n};if(t.subarray(1).forEach((n,i)=>{[s,s,s,s,()=>{e.#n=n*129/16383*100,e.dispatchEvent("mastervolume",e.#n)},()=>n-64,()=>n-64,()=>{},()=>{},()=>{}][c+i]()}),t[0]<4){let n=0;r.forEach(i=>{n=n<<4,n+=i}),n-=1024}}}}).add([66,18,0,1],(t,o)=>{}).add([66,18,0,2],(t,o)=>{}).add([66,18,1],(t,o)=>{e.dispatchEvent("mupromptex");let c=e.chRedir(t[0],o,!0),r=c*u.cc,s=t[1],n=`NS5R CH${c+1} `;t.subarray(2).forEach((i,f)=>{let l=s+f;l<3?([()=>{e.#e[r+p[0]]=i||X.bank0,e.pushChPrimitives(c)},()=>{e.#e[r+p[32]]=i,e.pushChPrimitives(c)},()=>{e.#s[c]=i}][l](),e.dispatchEvent("voice",{part:c})):l<8||(l<14?[()=>{let g=e.chRedir(i,o,!0);e.#f[c]=g,c!=g&&(e.buildRchTree(),console.info(`${n}receives from CH${g+1}`))},()=>{e.#v[c]=+!i},()=>{e.setChType(c,i,m.ns5r),console.debug(`${n}type: ${G[i]}`)},()=>{e.#r[u.rpn*c+3]=i,e.#i[u.rpnt*c+2]=1,e.dispatchEvent("pitch",{part:c,pitch:e.getPitchShift(c)})},()=>{},()=>{}][l-8]():l<16||(l<33?[()=>{e.#e[r+p[7]]=i},()=>{e.#e[r+p[11]]=i},()=>{},()=>{},()=>{e.#e[r+p[10]]=i||128},()=>{},()=>{},()=>{e.#e[r+p[93]]=i},()=>{e.#e[r+p[91]]=i},()=>{e.#e[r+p[76]]=i},()=>{e.#e[r+p[77]]=i},()=>{e.#e[r+p[78]]=i},()=>{e.#e[r+p[74]]=i},()=>{e.#e[r+p[71]]=i},()=>{e.#e[r+p[73]]=i},()=>{e.#e[r+p[75]]=i},()=>{e.#e[r+p[72]]=i}][l-16]():l<112||l<114&&[()=>{e.#e[r+p[5]]=i},()=>{e.#e[r+p[65]]=i}][l-112]()))})}).add([66,18,8,0],(t,o)=>{let c=t[0];if(c<32)e.setLetterDisplay(t.subarray(1,33),"NS5R letter display");else{let r=c-32;e.#M=Date.now()+3200,e.#g=10,e.#$.fill(0);let s=t.subarray(1),n=4;s.forEach(function(i,f){let l=f+r,g=l>>4,E=l&15;if(l<80){let k=g<n?i:i>>3,C=0,x=g<n?6:3;for(;k>0;)e.#$[E*32+g*7+(x-C)]=k&1,k=k>>1,C++}})}}).add([66,18,48],(t,o,c)=>{b(0,t)}).add([66,18,49],(t,o,c)=>{b(1,t)}).add([66,18,50],(t,o,c)=>{b(2,t)}).add([66,18,51],(t,o,c)=>{b(3,t)}).add([66,18,52],(t,o,c)=>{b(4,t)}).add([66,18,53],(t,o,c)=>{b(5,t)}).add([66,18,54],(t,o,c)=>{b(6,t)}).add([66,18,55],(t,o,c)=>{b(7,t)}).add([66,52],(t,o)=>{e.switchMode("ns5r"),e.#o=!1;let c="";R(t,(r,s)=>{s<8?(r>31&&(c+=String.fromCharCode(r)),s==7&&(e.aiEfxName=c)):s<10&&(e.setEffectType(s-8,44,r),e.dispatchEvent(`efx${["reverb","chorus"][s-8]}`,e.getEffectType(s-8)))})}).add([66,53],(t,o)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r"),e.#o=!1;let c="",r=t[t.length-1],s=t.subarray(0,t.length-1),n=L(s);n!=r&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${n}, got ${r}.`),console.debug(t));let i=e.getTrackPort(o);if(e.#l[i]&&e.#l[i]!=m.ns5r)if(e.#A.dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${o}. Port ${String.fromCharCode(65+i)} mode "${S[e.#l[i]]}" mismatch, should be "ns5r".`);return}else console.info(`Track ${o} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);e.setPortMode(i,2,m.ns5r),R(s,function(f,l){switch(!0){case l<2944:{let g=e.chRedir(Math.floor(l/92),o,!0),E=g*u.cc;switch(l%92){case 0:{e.#e[E+p[0]]=f,e.pushChPrimitives(g),e.dispatchEvent("voice",{part:g});break}case 1:{e.#e[E+p[32]]=f,!f&&!e.#e[E+p[0]]&&(e.#e[E+p[0]]=X.bank0),e.pushChPrimitives(g),e.dispatchEvent("voice",{part:g});break}case 2:{e.#s[g]=f,f>0&&e.setChActive(g,1),e.dispatchEvent("voice",{part:g});break}case 3:{let k=e.chRedir(f,o,!0);e.#f[g]=k,g!=k&&(console.info(`NS5R CH${g+1} receives from CH${k+1}.`),e.buildRchTree());break}case 7:{e.#a[g]=f,e.dispatchEvent("voice",{part:g});break}case 8:{e.#r[g*u.rpn+3]=f<40||f>88?f+(f>63?-192:64):f,e.#i[u.rpnt*g+2]=1,e.dispatchEvent("pitch",{part:g,pitch:e.getPitchShift(g)});break}case 9:case 10:{e.#e[E+p[7]]=f;break}case 11:{e.#e[E+p[11]]=f;break}case 14:{e.#e[E+p[10]]=f||128;break}case 19:{e.#e[E+p[93]]=f;break}case 20:{e.#e[E+p[91]]=f;break}case 84:{e.#e[E+p[65]]=f;break}case 85:{e.#e[E+p[5]]=f;break}}break}case l<3096:break;case l<3134:{let g=l-3096;g<8?(f>31&&(c+=String.fromCharCode(f)),g==7&&(e.aiEfxName=c)):g<10&&(e.setEffectType(g-8,44,f),e.dispatchEvent(`efx${["reverb","chorus"][g-8]}`,e.getEffectType(g-8)));break}case l<8566:break}})}).add([66,54],(t,o)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r");let c="",r=80,s=0,n=0,i="MSB	PRG	LSB	NME";R(t,function(f,l){let g=l%158;switch(!0){case g<10:{f>31&&(c+=String.fromCharCode(f));break}case g==10:break;case g==11:{r=f&127;break}case g==12:{n=f&127;break}case g==13:{i+=`
${r}	${s}	${n}	${c.trim().replace("Init Voice","")}`,s++,c="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(i),w()&&console.debug(i),e.forceVoiceRefresh()}).add([66,55],(t,o)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r");let c="",r=88,s=0,n=0,i="MSB	PRG	LSB	NME";R(t,function(f,l){let g=l%126;switch(!0){case g<10:{f>31&&(c+=String.fromCharCode(f));break}case g==11:break;case g==12:break;case g==13:{i+=`
${r}	${s}	${n}	${c.trim().replace("Init Combi","")}`,s++,c="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(i),w()&&console.debug(i),e.forceVoiceRefresh()}).add([66,125],(t,o,c)=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][t[0]]||"white")}).add([66,127],(t,o,c)=>{let r=t[t.length-1],s=t.subarray(0,t.length-1),n=L(s);n!=r&&(console.info(`NS5R screen dump checksum mismatch! Expected ${n}, got ${r}.`),console.debug(t));let i=new Uint8Array(5760);R(t,(f,l,g)=>{if(l<720)for(let E=0;E<8;E++)i[l*8+E]=f>>7-E&1}),e.dispatchEvent("screen",{type:"ns5r",data:i})}).add([76],(t,o,c)=>{e.#U.run([66,...t],o,c)}),this.#J.add([16,0,8,0],(t,o,c)=>{let r=(t[2]<<4)+t[3],s="K11 ";([()=>{e.switchMode("k11",!0),e.setPortMode(e.getTrackPort(o),2,m.k11),e.#o=!1,e.#p[m.k11][1]=r?4:0,console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,r),console.debug(`${s}reverb type: ${r}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{console.debug(`${s}reverb time: ${r}`)},()=>{console.debug(`${s}reverb time: ${r}`)},()=>{console.debug(`${s}reverb predelay: ${r}`)},()=>{console.debug(`${s}reverb predelay: ${r}`)},()=>{console.debug(`${s}depth high: ${r}`)},()=>{console.debug(`${s}depth high: ${r}`)},()=>{console.debug(`${s}depth low: ${r}`)},()=>{console.debug(`${s}depth low: ${r}`)}][t[0]]||(()=>{}))()}).add([16,0,8,1],(t,o,c)=>{e.dispatchEvent("mupromptex");let r=e.chRedir(t[1],o,!0),s=u.cc*r,n=u.rpn*r,i=(t[3]<<4)+t[4],f=`K11 CH${r+1} `;([()=>{i<128?(e.setChType(r,e.CH_MELODIC,m.k11),e.#e[s+p[0]]=0,e.#s[r]=i):(e.setChType(r,e.CH_DRUMS,m.k11),e.#s[r]=i-128),e.pushChPrimitives(r),e.dispatchEvent("voice",{part:r})},()=>{let l=e.chRedir(i,o,!0);e.#f[r]=l,r!=l&&(e.buildRchTree(),console.info(`${f}receives from CH${l+1}`))},()=>{e.#e[s+p[7]]=i},()=>{uupThis.setChActive(r,i)},()=>{e.#e[s+p[10]]=i},()=>{e.#r[n+3]=i+40,e.#i[u.rpnt*r+2]=1,e.dispatchEvent("pitch",{part:r,pitch:e.getPitchShift(r)})},()=>{e.#r[n+1]=i>>1,e.#r[n+2]=i&1,e.#i[u.rpnt*r+1]=1,e.dispatchEvent("pitch",{part:r,pitch:e.getPitchShift(r)})},()=>{e.#e[s+p[91]]=i?127:0},()=>{},()=>{e.#e[s+p[74]]=i},()=>{e.#e[s+p[73]]=i},()=>{e.#e[s+p[72]]=i}][t[0]]||(()=>{}))()}).add([16,0,9,0],(t,o,c)=>{e.dispatchEvent("mupromptex");let r=(t[2]<<4)+t[3],s="GMLX ";([()=>{console.debug(`${s}reverb type: ${r}`)},()=>{console.debug(`${s}reverb time: ${r}`)},()=>{console.debug(`${s}reverb predelay: ${r}`)},()=>{console.debug(`${s}depth high: ${r}`)},()=>{console.debug(`${s}depth low: ${r}`)}][t[0]]||(()=>{}))()}).add([16,0,9,3],(t,o,c)=>{e.dispatchEvent("mupromptex");let r=(t[2]<<4)+t[3],s=e.chRedir(t[1],o,!0),n=s*u.cc;[()=>{r<128?(e.setChType(s,e.CH_MELODIC,m.k11),e.#e[n+p[0]]=0,e.#e[n+p[32]]=0,e.#s[s]=r):r<160?(e.setChType(s,e.CH_MELODIC,m.k11),e.#e[n+p[0]]=0,e.#e[n+p[32]]=7,e.#s[s]=r-100):(e.setChType(s,e.CH_DRUMS,m.k11),e.#e[n+p[0]]=122,e.#e[n+p[32]]=0,e.#s[s]=r-160),e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{let i=e.chRedir(r,o,!0);e.#f[s]=i,s!=i&&(e.buildRchTree(),console.info(`GMLX CH${s+1} receives from CH${i+1}`))}][t[0]]()}).add([16,0,9,4],(t,o,c)=>{e.dispatchEvent("mupromptex");let r=(t[2]<<4)+t[3],s=e.chRedir(t[1],o,!0),n=s*u.cc,i=s*u.rpn,f=`GMLX CH${s+1} `;[()=>{e.setChActive(s,r)},()=>{e.#e[n+p[7]]=r},()=>{e.#e[n+p[10]]=r},()=>{e.#e[n+p[91]]=r?127:0},()=>{e.#r[i+3]=r+40,e.#i[u.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{e.#r[i+1]=r,e.#i[u.rpnt*s+1]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{e.#r[i]=r,e.#i[u.rpnt*s]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{}][t[0]]()}),this.#Z.add([66,93,64],(t,o,c)=>{let r=t[2];switch(t[0]){case 0:{switch(t[1]){case 4:{e.dispatchEvent("mupromptex"),e.#n=r*129/16383*100,e.dispatchEvent("mastervolume",e.#n);break}case 5:{e.dispatchEvent("mupromptex"),r-64;break}case 6:{e.dispatchEvent("mupromptex"),console.debug(`SG global reverb: ${r?"on":"off"}`);break}case 127:{e.switchMode("sg",!0),e.setPortMode(e.getTrackPort(o),1,m.sg);break}}break}case 1:{switch(t[1]){case 48:{e.dispatchEvent("mupromptex"),console.debug(`SG reverb type: ${W[r]}`);break}}break}default:if(t[0]>>4==1){e.dispatchEvent("mupromptex");let s=e.chRedir(t[0]&15,o,!0);if(t[1]==2){let n=e.chRedir(r,o,!0);e.#f[s]=n,s!=n&&(e.buildRchTree(),console.info(`SG CH${s+1} receives from CH${n+1}`))}else t[1]==19&&(e.#e[u.cc*s+p[7]]=r)}else console.warn(`Unknown AKAI SG SysEx: ${t}`)}}),this.#ee.add([9],(t,o,c)=>{e.dispatchEvent("mupromptex"),console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremolo","phaser","rotary speaker","enhancer","flanger","EQ"][t[0]]||"off"}`)}),this.#x.add([127,0],(t,o,c)=>{e.switchMode("motif");let r=new Uint8Array([127,1,...t]);e.#x.run(r,o,c)}).add([127,1,0,0],(t,o,c)=>{e.switchMode("s90es");let r="S90/Motif ES system ",s=t[0];t.subarray(1).forEach((n,i)=>{([()=>{e.#n=n*12900/16383,e.dispatchEvent("mastervolume",e.#n)}][s+i]||(()=>{console.info(`Unrecognized ${r}ID: ${s+i}`)}))()})}).add([127,1,0,36,54,1],(t,o,c)=>{e.switchMode("s90es");let r="S90/Motif ES reverb ",s=t[0];t.subarray(1).forEach((n,i)=>{([()=>{e.setEffectTypeRaw(0,!1,n&15|112)},()=>{e.setEffectTypeRaw(0,!0,n)}][s+i]||(()=>{}))()}),e.dispatchEvent("efxreverb",e.getEffectType(0))}).add([127,1,0,37,54,2],(t,o,c)=>{e.switchMode("s90es");let r="S90/Motif ES chorus ",s=t[0];t.subarray(1).forEach((n,i)=>{([()=>{e.setEffectTypeRaw(1,!1,n&15|112)},()=>{e.setEffectTypeRaw(1,!0,n)}][s+i]||(()=>{}))()}),e.dispatchEvent("efxchorus",e.getEffectType(1))}).add([127,1,0,34,54,3],(t,o,c)=>{e.switchMode("s90es");let r="S90/Motif ES insert 1 ",s=t[0];t.subarray(1).forEach((n,i)=>{([()=>{e.setEffectTypeRaw(3,!1,n&15|112)},()=>{e.setEffectTypeRaw(3,!0,n)}][s+i]||(()=>{}))()}),e.dispatchEvent("efxinsert0",e.getEffectType(3))}).add([127,1,0,34,54,4],(t,o,c)=>{e.switchMode("s90es");let r="S90/Motif ES insert 2 ",s=t[0];t.subarray(1).forEach((n,i)=>{([()=>{e.setEffectTypeRaw(4,!1,n&15|112)},()=>{e.setEffectTypeRaw(4,!0,n)}][s+i]||(()=>{}))()}),e.dispatchEvent("efxinsert1",e.getEffectType(4))}).add([127,1,0,35,54,17],(t,o,c)=>{e.switchMode("s90es");let r="S90/Motif ES variation ",s=t[0];t.subarray(1).forEach((n,i)=>{([()=>{e.setEffectTypeRaw(2,!1,n&15|112)},()=>{e.setEffectTypeRaw(2,!0,n)}][s+i]||(()=>{}))()}),e.dispatchEvent("efxdelay",e.getEffectType(2))}).add([127,1,0,58,55],(t,o,c)=>{e.dispatchEvent("mupromptex"),e.switchMode("s90es");let r=e.getTrackPort(o);if(e.#l[r]&&e.#l[r]!=e.#c.smotif)if(e.#A.dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${o}. Port ${String.fromCharCode(65+r)} mode "${S[e.#l[r]]}" mismatch, should be "${S[e.#c.smotif]}".`);return}else console.info(`Track ${o} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+r)}.`);let s=e.chRedir(t[0],o,!0),n=u.cc*s,i=t[1];t[0]>15&&(s=t[0]+32);let f=`Track ${o} S90/Motif ES bulk CH${s<128?s+1:"U"+(s-127)} `;console.debug(f,t),!(t[0]>15)&&t.subarray(2).forEach((l,g)=>{([()=>{e.#e[n+p[0]]=l,e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{l&&e.setChActive(s,1),e.#e[n+p[32]]=l,e.getChPrimitive(s,1)==63&&e.setChType(s,[32,40].indexOf(l)>-1?e.CH_DRUMS:e.CH_MELODIC,e.#t,!0),e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{l&&e.setChActive(s,1),e.#s[s]=l,e.dispatchEvent("voice",{part:s})},()=>{let E=e.chRedir(l,o,!0);e.#f[s]=E,s!=E&&(e.buildRchTree(),console.info(`${f}receives from CH${E+1}`))},()=>{e.#v[s]=l?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{l!=100&&e.setChActive(s,1),e.#e[n+p[7]]=l},()=>{l!=64&&e.setChActive(s,1),e.#e[n+p[10]]=l},!1,!1,!1,()=>{e.#e[n+p[91]]=l},()=>{l&&e.setChActive(s,1),e.#e[n+p[93]]=l},()=>{l&&e.setChActive(s,1),e.#e[n+p[94]]=l},()=>{l!=127&&e.setChActive(s,1),e.#e[n+p[128]]=l,e.allocateAce(s,128)},()=>{},()=>{l!=64&&e.setChActive(s,1),e.#e[n+p[74]]=l},()=>{l!=64&&e.setChActive(s,1),e.#e[n+p[71]]=l},!1,()=>{e.#e[n+p[65]]=l},()=>{e.#e[n+p[5]]=l},()=>{}][i+g]||(()=>{}))()})}).add([127,1,54,16],(t,o,c)=>{e.switchMode("s90es");let r=t[0];t.subarray(1).forEach((s,n)=>{let f=`S90/Motif ES EQ${(n>>2)+1} `;([()=>{let l=s-64},()=>{let l=H[s]},()=>{let l=s/10},()=>{let l=s}][r+n&3]||(()=>{}))()})}),this.#T.add([0,72,18,0,0,0,0],(t,o,c)=>{e.switchMode("sd",!0),e.setPortMode(e.getTrackPort(o),2,m.sd),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(t,o,c)=>{e.dispatchEvent("mupromptex");let r=t[0]>>5,s=t[0]&31;switch(r){case 0:{let n=t[0]>>1,i=t[1];switch(n){case 1:{t.subarray(2).forEach((f,l,g)=>{let E=l+i;switch(E){case 0:{f&&(e.setEffectType(1,60,f-1),e.dispatchEvent("efxchorus",e.getEffectType(1)),console.debug(`SD MFX Cho: ${E} - ${f}`));break}}});break}case 2:{t.subarray(2).forEach((f,l)=>{let g=l+i;switch(g){case 0:{f&&(e.setEffectType(0,55+f,0),e.dispatchEvent("efxreverb",e.getEffectType(0)),console.debug(`SD MFX Rev: ${g} - ${f}`));break}}});break}case 3:case 4:case 5:{let f=n-1;t.subarray(2).forEach((l,g)=>{let E=g+i;switch(console.debug(`SD MFX ${f-2}: ${E} - ${l}`),E){case 0:{e.setEffectTypeRaw(f,62,l),e.dispatchEvent(`efx${f>2?"delay":"insert"+(f-4)}`,e.getEffectType(f));break}}}),console.debug(`SD MFX message:
%o`,t);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,t)}break}case 1:{let n=e.chRedir(s,o,!0),i=t[1],f=n*u.cc;t.subarray(2).forEach((l,g)=>{let E=i+g;E<37?([()=>{},()=>{},0,()=>{},()=>{switch(e.#e[f+p[0]]=l,l){case 104:case 105:case 106:case 107:case 120:{e.#a[n]||e.setChType(n,e.CH_DRUMS);break}default:e.#a[n]&&e.setChType(n,e.CH_MELODIC)}e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n})},()=>{e.#e[f+p[32]]=l,e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n})},()=>{e.#s[n]=l,e.dispatchEvent("voice",{part:n})},()=>{e.#e[f+p[7]]=l},()=>{e.#e[f+p[10]]=l},()=>{},()=>{},()=>{l<2&&(e.#v[n]=l)},()=>{l<2&&(e.#e[f+p[68]]=l?127:0)},()=>{},()=>{l<2&&(e.#e[f+p[65]]=l?127:0)},()=>{e.#e[f+p[5]]=l&15<<4|e.#e[f+p[5]]&15},()=>{e.#e[f+p[5]]=l&15|(e.#e[f+p[5]]&240)>>4},()=>{e.#e[f+p[74]]=l},()=>{e.#e[f+p[71]]=l},()=>{e.#e[f+p[73]]=l},()=>{e.#e[f+p[72]]=l},0,0,0,0,0,0,0,()=>{e.#e[f+p[128]]=l,e.allocateAce(128)},()=>{e.#e[f+p[93]]=l},()=>{e.#e[f+p[91]]=l},0,0,()=>{e.#e[f+p[75]]=l},()=>{e.#e[f+p[76]]=l},()=>{e.#e[f+p[77]]=l},()=>{e.#e[f+p[78]]=l}][E]||(()=>{}))():E<63||(E<64?(e.#a[n]?e.#e[f+p[0]]=104|l:e.#e[f+p[0]]=96|l,e.dispatchEvent("voice",{part:n})):console.debug(`Unknown SD-90 global CH${n+1} param setup message:
%o`,t))});break}case 2:{let n=e.chRedir(s,o,!0),i=t[1];console.debug(`Unknown SD-90 global CH${n+1} MIDI setup message:
%o`,t.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,t)}}),e.#U.add([0,1,73,78],(t,o,c)=>{e.switchMode("krs"),e.setPortMode(e.getTrackPort(o),1,m.krs),console.debug("Might be KORG KROSS 2 mode reset... Not sure.")}).add([0,1,73,117,2,37],(t,o,c)=>{e.switchMode("krs");let r=e.getTrackPort(o);if(e.#l[r]&&e.#l[r]!=m.krs)if(e.#A.dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled. Port ${String.fromCharCode(65+r)} mode "${S[e.#l[r]]}" mismatch, should be "krs".`);return}else console.info(`Track ${o} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+r)}.`);e.setPortMode(e.getTrackPort(o),1,m.krs);let s="KROSS 2 BMT1 ",n="";R(t,(i,f)=>{if(f<24)n+=String.fromCharCode(Math.max(32,i));else if(!(f<1276)){let l=f-1276,g=e.chRedir(Math.floor(l/44),o,!0),E=l%44,k=u.cc*g;E<15?([()=>{i&&e.setChActive(g,1),e.#s[g]=i,e.dispatchEvent("voice",{part:g})},()=>{i&&e.setChActive(g,1),i<10?(e.#e[k+p[0]]=63,e.#e[k+p[32]]=i):i<20?(e.#e[k+p[0]]=121,e.#e[k+p[32]]=i-10):i<24&&(e.#e[k+p[0]]=[120,0,56,62][i-20],e.#e[k+p[32]]=0),e.pushChPrimitives(g),e.dispatchEvent("voice",{part:g})},()=>{let C=e.chRedir(i&15,o,!0);e.#f[g]=C,console.info(`${s}CH${g+1} receives from CH${C+1}`)},!1,!1,()=>{e.#e[k+p[7]]=i},!1,()=>{},()=>{},!1,!1,!1,!1,!1,()=>{e.#e[k+p[10]]=i||128}][E]||(()=>{}))():E<36||([()=>{e.#e[k+p[74]]=(i+128&255)-64},()=>{e.#e[k+p[71]]=(i+128&255)-64},!1,!1,()=>{e.#e[k+p[73]]=(i+128&255)-64},()=>{e.#e[k+p[75]]=(i+128&255)-64},!1,()=>{e.#e[k+p[72]]=(i+128&255)-64}][E]||(()=>{}))()}}),n=n.trimRight(),e.dispatchEvent("metacommit",{type:"EORTitle",data:n})})}};export{ft as OctaviaDevice,u as allocated,p as ccToPos,D as dnToPos,w as getDebugState,X as overrides};
