var Q=function(e,r){let d=Math.min(e.length,r.length),p=e.slice(0,d),b=r.slice(0,d),E=0,g=0;for(;g<d&&E==0;)E=Math.sign(p[g]-b[g]),g++;return E},C=function(e=""){this.name=e,this.pool=[],this.point=function(r,d=!1){if(this.pool.length>0){let p=this.pool.length,b=1<<Math.floor(Math.log2(p)),E=b,g=64;for(;b>=1&&g>=0;){if(g<=0)throw new Error("TTL reached.");if(E==p)E-=b;else{let t=Q(r,this.pool[E]);switch(t){case 0:{g=0;break}case 1:{E+b<=p&&(E+=b);break}case-1:{E!=0&&(E-=b);break}default:console.warn(`Unexpected result ${t}.`)}}b=b>>1,g--}let $=!0;if(E>=this.pool.length)$=!1;else{let t=this;this.pool[E].forEach(function(a,c,i){$&&a!=r[c]&&($=!1)}),!$&&Q(r,this.pool[E])>0&&E++}return $||d?E:-1}else return d?0:-1},this.add=function(r,d){return r.data=d,this.pool.splice(this.point(r,!0),0,r),this},this.default=function(r){console.warn(`No match in "${this.name||"(unknown)"}" for "${r}". Default action not defined.`)},this.get=function(r){let d=this.point(r);if(d>-1)return this.pool[d].data;this.default(r)},this.run=function(r,...d){let p=this.point(r);p>-1?r.subarray?this.pool[p].data(r.subarray(this.pool[p].length),...d):this.pool[p].data(r.slice(this.pool[p].length),...d):this.default(r,...d)}};var Y=class{#t={};addEventListener(e,r){this.#t[e]||(this.#t[e]=[]),this.#t[e].unshift(r)}removeEventListener(e,r){if(this.#t[e]){let d=this.#t[e].indexOf(r);d>-1&&this.#t[e].splice(d,1),this.#t[e].length<1&&delete this.#t[e]}}dispatchEvent(e,r){let d=new Event(e),p=this;d.data=r,this.#t[e]?.length>0&&this.#t[e].forEach(function(b){try{b?.call(p,d)}catch(E){console.error(E)}}),this[`on${e}`]&&this[`on${e}`](d)}};var be=["MSB","PRG","LSB","NME","ELC","DRM"],I=function(e){let r=Math.floor(e/10),d=e%10;return`${r.toString(16)}${d}`},X=class{#t;strictMode=!1;get(e=0,r=0,d=0,p){let b=[e,r,d],E,g=1,$=0,t,a=Array.from(arguments);switch(p){case"xg":{switch(e){case 0:{d==126?a[2]=125:d==127&&(a[2]=0);break}case 16:{d==126&&(a[2]=0);break}case 32:{d>125&&(a[2]=0),a[2]+=4;break}case 33:case 34:case 35:case 36:{d>125&&(a[2]=0),a[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:a[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{d==126&&(a[2]=0);break}case 48:case 64:case 126:case 127:{d==126&&(a[2]=0);break}}break}case"gs":{e==0&&d<5?a[2]=0:e>125&&d<5&&d!=2&&(a[2]=e,a[0]=0);break}case"g2":case"sd":{e>>1==40?a[2]|=16:e>95&&e<100&&(a[2]|=16,r>>3==15&&(a[0]=96));break}case"sg":{e==8&&d==0&&(a[2]=5);break}case"s90es":{d<8?a[2]+=17:d<32?a[2]+=13:a[2]=(a[2]>>3)+19;break}case"motif":{d<8?a[2]+=28:d<32?a[2]+=13:a[2]=(a[2]>>3)+19;break}}let c=" ",i="M",s=0,f=0;switch(a[0]){case 0:{a[2]==127?i="MT-a":a[2]==126?i="MT-b":a[2]==7?i="GM-k":a[2]==5?i="SG-a":a[2]==4?i="SP-l":a[2]==0||p=="gs"&&a[2]<5?i="GM-a":(i="y",s=3);break}case 8:{p=="sg"?i="GM-s":i="r:";break}case 32:case 33:case 34:case 35:case 36:{p=="xg"&&(i=`${["AP","VL","PF","DX","AN"][e&7]}-${"abcdefgh"[d]}`);break}case 48:{i=`yM${(a[2]>>3).toString().padStart(2,"0")}`,s=1;break}case 56:{i="GM-b";break}case 61:case 120:{i="rDrm";break}case 62:{i="kDrm";break}case 63:{if(a[2]<17){let y=a[2];i=y<10?"kP:":"kC:",i+=y%10}else a[2]<34?i=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][a[2]-17]:i="Ds";break}case 64:{i="ySFX";break}case 67:{i="DX:S";break}case 80:case 81:case 82:case 83:{i=`Prg${"UABC"[a[0]-80]}`;break}case 88:case 89:case 90:case 91:{i=`Cmb${"UABC"[a[0]-88]}`;break}case 95:{i=`${["DR","PC"][a[2]]}-d`;break}case 96:{i=a[2]==106?"AP-a":a[2]>>4==1?"SDg":"PF",a[2]>63?f=63:a[2]>>4==1&&(f=16),s=3;break}case 97:{i=a[2]>>4==1?"SDa":"VL:",s=3,a[2]>>4==1?f=16:f=112;break}case 98:{i=a[2]>>4==1?"SDb":"SG-a",s=3,f=16;break}case 99:{i=a[2]>>4==1?"SDc":"DX",a[2]>63?f=63:a[2]>>4==1&&(f=16),s=3;break}case 100:{i="AN",a[2]>63?f=63:a[2]>>4==1&&(f=16),s=3;break}case 104:case 105:case 106:case 107:{i="SDd",f=104;break}case 121:{i=`GM-${a[2]?"":"a"}`,s=3;break}case 122:{i="lDrm";break}case 126:{i="yDrS";break}case 127:{a[2]==127?i="rDrm":i="yDrm";break}default:a[0]<48?i="r:":i="M"}i.length<4&&(i+=`${[e,d,a[0],a[2]][s]-f}`.padStart(4-i.length,"0")),p=="xg"&&(e==0?a[2]<100?i=i.replace("y0","y:"):a[2]==125&&(i="y126"):e==16&&(E=`Voice${(a[2]*128+a[1]+1).toString().padStart(3,"0")}`,c=" "));let o=[a[0],a[1],a[2]];for(;!(E?.length>=0);)if(E=this.#t[a[1]||0][(a[0]<<7)+a[2]]?.name,E){let y=this.#t[a[1]||0][(a[0]<<7)+a[2]];g=y?.poly||g,$=y?.type||$,t=y?.drum}else if(this.strictMode)E="",c="?";else if(a[0]==0&&a[1]==0&&a[2]==0)E="Unloaded";else if(this.#t[a[1]||0][a[0]<<7])a[0]==0?(a[2]=0,c="^"):a[2]<1?(a[0]=0,c="*"):(a[2]--,c="^");else if(e==48)a[0]=0,a[2]=0,c="!";else if(e==62)a[1]--,c=" ",a[1]<1&&!E?.length&&(a[0]=0,c="!");else if(e<63)a[0]==0?(a[2]=0,c="^"):a[2]<1?(a[0]=0,c="*"):a[2]--;else if(e==80)E=`PrgU:${r.toString().padStart(3,"0")}`,c="!";else if(e==88)E=`CmbU:${r.toString().padStart(3,"0")}`,c="!";else if(e==121)E=`GM2Vox0${d}`,c="#";else if(e==122)if(a[1]==32?a[1]==0:a[1]%=7,E=this.#t[a[1]||0][(a[0]<<7)+a[2]]?.name,E){c=" ";let y=this.#t[a[1]||0][(a[0]<<7)+a[2]];g=y?.poly||g,$=y?.type||$,t=y?.drum}else E="",c="*";else a[1]==0?(E=`${e.toString().padStart(3,"0")} ${r.toString().padStart(3,"0")} ${d.toString().padStart(3,"0")}`,c="!"):a[0]==0?(a[2]=0,c="^"):a[2]>0?a[2]--:a[1]>0?(a[1]=0,c="!"):(a[0]=0,c="?");let n=[a[0],a[1],a[2]];(p=="gs"||p=="ns5r")&&c=="^"&&(c=" "),e==127&&c=="^"&&(c=" "),c!=" "&&self.debugMode&&(E="");let l="??";switch(a[0]){case 0:{a[2]==0?l="GM":a[2]==5||a[2]==7?l="KG":a[2]<126?l="XG":a[2]==127&&(l="MT");break}case 32:case 33:case 35:case 36:{a[2]>4?l=["AP","VL","PF","DX","AN"][a[0]-32]:l="GS";break}case 48:{l="MU";break}case 56:{l="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{l="AI";break}case 62:case 82:case 90:{l="XD";break}case 63:{a[2]<17?l="KR":a[2]<34?l="ES":l="DS";break}case 64:case 126:{l="XG";break}case 67:case 99:{l=a[2]>>4==1?"SD":"DX";break}case 81:{l="RW";break}case 95:{l=["DR","PC"][a[2]];break}case 96:{l=a[2]==106?"AP":a[2]>>4==1?"SD":"PF";break}case 97:{l=a[2]>>4==1?"SD":"VL";break}case 98:{l=a[2]>>4==1?"SD":"SG";break}case 100:{l="AN";break}case 104:case 105:case 106:case 107:{l="SD";break}case 120:{l="GS";break}case 121:{l=a[2]?"G2":"GM";break}case 122:{l="KG";break}case 127:{l=a[2]==127?"MT":r==0?"GM":"XG";break}default:a[0]<48&&(a[0]==16&&p=="xg"?l="XG":l="GS")}return{name:E||`${I(e||0)} ${I(r||0)} ${I(d||0)}`,poly:g,type:$,drum:t,iid:o,eid:n,sid:b,ending:c,sect:i,standard:l}}async load(e,r,d="(internal)"){let p=this,b=[],E=0,g=0;e.split(`
`).forEach(function($,t){let a=$.split("	"),c=[];if(t==0){if(a.forEach(function(i,s){b[be.indexOf(i)]=s}),b.length<4){console.debug("Debugger launched.");debugger}}else{let i=0,s=0,f=0,o,n=1,l=0,y;a.forEach(async function(w,S){switch(S){case b[0]:{i=parseInt(w);break}case b[1]:{s=parseInt(w);break}case b[2]:{f=parseInt(w);break}case b[3]:{o=w;break}case b[4]:{w=parseInt(w),w<16?n=w+1:l=(w&15)+1;break}case b[5]:{y=w;break}}}),p.#t[s]=p.#t[s]||[];let m=p.#t[s];if(!m[i<<7|f]||r){let w={msb:i,prg:s,lsb:f,name:o,poly:n,type:l,drum:y};m[i<<7|f]=w,E++}g++}}),r||console.debug(`Map "${d}": ${g} total, ${E} loaded.`)}clearRange(e){let r=e.prg!=null?e.prg.constructor==Array?e.prg:[e.prg,e.prg]:[0,127],d=e.msb!=null?e.msb.constructor==Array?e.msb:[e.msb,e.msb]:[0,127],p=e.lsb!=null?e.lsb.constructor==Array?e.lsb:[e.lsb,e.lsb]:[0,127];for(let b=d[0];b<=d[1];b++){let E=b<<7;for(let g=p[0];g<=p[1];g++){let $=E+g;for(let t=r[0];t<=r[1];t++)delete this.#t[t][$]}}}init(){this.#t=[];for(let e=0;e<128;e++)this.#t.push([""])}async loadFiles(...e){this.init();let r=this;e.forEach(async function(d){try{await fetch(`./data/bank/${d}.tsv`).then(function(p){return p.text()}).then(p=>{r.load(p,!1,d)})}catch{console.error(`Failed loading "${d}.tsv".`)}})}constructor(...e){this.loadFiles(...e)}};var W=class{#t={};context;set(e,r){this.#t[e]=r}has(e){return!!this.#t[e]}async read(e,r){if(!this.has(e))throw new Error(`No decoder registered for "${e}"`);return await this.#t[e].call(this.context||this,r)}};var ye=function(e,r){let d=!0;return r.forEach((p,b)=>{d=d&&e[b]==p}),d},j=function(e){let r=0;return e.forEach(d=>{r*=256,r+=d}),r},A=new TextDecoder,B=new W;B.set("s7e",async function(e){let r=new Uint8Array(await e.slice(0,65536).arrayBuffer()),d="MSB	LSB	PRG	NME",p=[0,0,0,0],b=32,E=0,g=0,$=!0,t=[],a=0;for(;$;){let c=r.subarray(E);([()=>{A.decode(c.subarray(0,4))=="YSFC"?(E+=80,g=1):E++},()=>{if(ye(c.subarray(0,4),p))t.forEach((i,s,f)=>{let o=j(r.subarray(i.start+4,i.start+8));i.length=o}),g=2;else{let i=A.decode(c.subarray(0,4)),s=j(c.subarray(4,8));t.push({type:i,start:s}),E+=8}},()=>{let i=t[a],s=r.subarray(i.start,i.start+i.length),f=32;switch(i.type){case"ENVC":{let o=b;for(;o<s.length;){let n=s.subarray(o,o+f),l=A.decode(n.subarray(0,10)).trimEnd();l.slice(0,5)=="Init "&&(l=""),l&&(d+=`
063	${(n[17]+13).toString().padStart(3,"0")}	${n[19].toString().padStart(3,"0")}	${l}`),o+=f}break}case"EDVC":{let o=b;for(;o<s.length;){let n=s.subarray(o,o+f),l=A.decode(n.subarray(0,10)).trimEnd();l.slice(0,5)=="Init "&&(l=""),l&&(d+=`
063	024	${n[19].toString().padStart(3,"0")}	${l}`),o+=f}break}case"EPVC":{let o=32,n=b;for(;n<s.length;){let l=s.subarray(n,n+o),y=A.decode(l.subarray(0,10)).trimEnd();y=="----------"&&(y=""),y&&(d+=`
063	${(l[17]+1).toString().padStart(3,"0")}	${l[19].toString().padStart(3,"0")}	${y}`),n+=o}break}}a++,a>=t.length&&(g=3,$=!1)}][g]||(()=>{$=!1}))()}return d});var U=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),N=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],ge=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],L=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],J=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],Z=function(e){let r=.1,d=-.3;return e>66?(r=5,d=315):e>56?(r=1,d=47):e>46&&(r=.5,d=18.5),r*e-d},ee=function(e){return e>105?ge[e-106]:e>100?e*1.1-100:e/10},te=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),V={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,うぃ
we,うぇ
wo,を
nga,ガ
ngi,ギ
ngu,グ
nge,ゲ
ngo,ゴ
ngy,ギ!
ng,
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,いぇ
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(e=>{let r=e.split(",");V[r[0]]=r[1]});var ae=function(e){let r=e;e[0]=="*"&&(r=r.slice(1)),["aa","ii","uu","ee","oo"].forEach(p=>{for(;r.indexOf(p)>-1;)r=r.replace(p,p[0])});for(let p in V)r=r.replaceAll(p,V[p]);r.indexOf("ん")==0&&r.length>1&&(r=r.slice(1));let d=r.indexOf("!");return d>-1&&r.length>1&&(r=r.slice(d+1)),r},re=function(e){return e?e<96?`cc${e}`:["aftertouch","velocity","pitch bend"][e-96]:"off"};var F=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],se=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],ie=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var Ee={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},$e={66307:["drive"],66309:["vowel",e=>"aiueo"[e]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",e=>["off","LPF","HPF"][e]],94984:["noise type",e=>["white","pink"][e]],94987:["disc type",e=>["LP","SP","EP","RND"]],94990:["hum type",e=>`${e+5}0Hz`],94993:["M/S",e=>["mono","stereo"][e]]},K=function(e){return Ee[(e[0]-32<<8)+e[1]]||`0x${e[0].toString(16).padStart(2,"0")}${e[1].toString(16).padStart(2,"0")}`},ce=function(e,r,d){let p=(e[0]-32<<16)+(e[1]<<8)+r,b=$e[p]||{},E=b[0];if(E?.length)return E+=`: ${(b[1]||function(){})(d)||d}`,E},z=[68,48,95,78,41,3,110,122,0];var x=function(e=64){return Math.round(2e3*Math.log10(e/64))/100};var D=function(e){let r=0;return e.forEach(d=>{r+=d,r=r&127}),~r+1&127},M=function(e,r){let d=0,p=0;for(let b=0;b<e.length;b++){let E=b%8-1,g=(p>>E&1)<<7,$=e[b];$+=g,b%8!=0?(r($,d,e),d++):p=e[b]}};var P=function(e){let r=Math.floor(e*14.2);return r<128?r:0};var R=["?","gm","gs","xg","g2","mt32","ns5r","x5d","05rw","sd","k11","sg","krs","s90es","motif"],me={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es"},ke=["melodic","drum","menu"],ne=[[0,0,0,0,121,0,0,82,81,97,0,0,63,63,63],[0,0,4,0,0,127,0,0,0,0,0,0,0,0,0]],O=[120,127,120,127,120,127,61,62,62,105,122,122,120,127,127],we=[0,3,81,84,88],oe={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},le={0:0,1:1,2:3,5:4},fe={0:0,1:1,2:2,5:3},de=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],he=[36,37,48,49,52,53],_=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],ue={26:127,29:0,30:0,31:0,52:12,53:54},G=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,128,12,13,16,17,18,19,14,15,20,21,26,28,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],ve=[2,12,13,14,15,16,17,18,19,20,21,136,130,131,132,133,134,135,137,138,139],Se=[33,99,100,32,102,8,9,10],pe=[0,16,25,40,32,64,26,48],k={};R.forEach((e,r)=>{k[e]=r});var h={length:G.length};G.forEach((e,r)=>{h[e]=r});var T={length:_.length};_.forEach((e,r)=>{T[e]=r});var xe={};ke.forEach((e,r)=>{xe[e]=r});var v=function(){return!!self.Bun||self.debugMode||!1},Ce=function(e){let r=[],d=0;return e?.forEach(function(p,b){p==247?r.push(e.subarray(d,b)):p==240&&(d=b+1)}),r.length||r.push(e.subarray(0)),v()&&console.debug(r),r};var u={ch:128,cc:G.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,ace:8,drm:8,dpn:_.length,dnc:128,ext:2,efx:7,redir:32},H={bank0:128},Je=class extends Y{NOTE_IDLE=0;NOTE_ATTACK=1;NOTE_DECAY=2;NOTE_SUSTAIN=3;NOTE_HELD=4;NOTE_RELEASE=5;NOTE_SOSTENUTO_ATTACK=8;NOTE_SOSTENUTO_DECAY=9;NOTE_SOSTENUTO_SUSTAIN=10;NOTE_SOSTENUTO_HELD=11;CH_MELODIC=0;CH_DRUMS=1;CH_DRUM1=2;CH_DRUM2=3;CH_DRUM3=4;CH_DRUM4=5;CH_DRUM5=6;CH_DRUM6=7;CH_DRUM7=8;CH_DRUM8=9;EXT_NONE=0;EXT_VL=1;VLBC_BRTHEXPR=1;VLBC_VELOINIT=2;VLBC_VELOALL=3;#t=0;#b=0;#C=0;#D=new Array(11);get#g(){return this.#D[this.#b]}set#g(e){this.#D[this.#b]=e}#O=new Uint8Array(u.ch);#h=new Uint8Array(u.ch);#r=new Uint8Array(u.ch);#e=new Uint8Array(u.ch*u.cc);#L=new Uint8Array(u.ace);#i=new Uint8Array(u.ch);#f=new Uint8Array(u.ch*u.nn);#E=new Uint8Array(u.ch);#d=new Uint16Array(u.pl);#u=new Uint8Array(u.pl);#A=new Int16Array(u.ch);#T=new Uint8Array(u.ch);#X=0;#M=new Uint8Array(u.ch*u.ext);#a=new Uint8Array(u.ch*u.rpn);#s=new Uint8Array(u.ch*u.rpnt);#J=new Int8Array(u.ch*he.length);#y=new Uint8Array(u.drm*u.dpn*u.dnc);#$=new Uint8Array(u.efx*3);#Z=new Uint8Array(u.ch);#V=new Uint8Array(u.ch*u.redir);#R=new Uint8Array(u.ch);#P=new Uint8Array(128);#S=new Uint8Array(u.cmt*8);#ee=new Uint8Array(1024);#H=new Uint8Array(u.cmt*64);#G=0;#k=0;#o;#c=100;#F=0;#te=500;#ae=0;#B="";#_=0;#se=0;#re=0;#x=!0;#n=!1;#ne=1;#ie;#K=new Array(u.ch);#le=new Uint8Array(2);#m=[];#U=new Uint8Array(u.ch);#I=new Uint8Array(u.tr);baseBank=new X("gm","gm2","xg","gs","ns5r","sd","gmega","plg-150vl","plg-150pf","plg-150dx","plg-150an","plg-150dr","plg-100sg","krs","s90es");userBank=new X("gm");initOnReset=!1;aiEfxName="";chRedir(e,r,d){if(this.#I[r])return(this.#I[r]-1)*16+e;if([2,3].indexOf(this.#k)>-1){if(d==1)return e;let p=0,b=!0;for(;b;)this.#U[e+p]==0?(this.#U[e+p]=r,console.debug(`Assign track ${r} to channel ${e+p+1}.`),b=!1):this.#U[e+p]==r?b=!1:(p+=16,p>=128&&(p=0,b=!1));return e+p}else return e}forceVoiceRefresh(){for(let e=0;e<u.ch;e++)this.#O[e]&&this.dispatchEvent("voice",{part:e})}#p=[];#z;#l={nOff:(e,r)=>{let d=e*128+r,p=this.#d.lastIndexOf(d);if(p>-1)if(this.#e[u.cc*e+h[64]]>63)this.#u[p]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:r,velo:this.#f[d],state:this.NOTE_HELD});else if(this.#e[u.cc*e+h[66]]>63&&this.#u[p]==this.NOTE_SOSTENUTO_SUSTAIN)this.#u[p]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:r,velo:this.#f[d],state:this.NOTE_SOSTENUTO_HELD});else{this.#d[p]=0,this.#f[d]=0,this.#u[p]=this.NOTE_IDLE;let b=this.getExt(e)[1];(b==this.VLBC_VELOINIT||b==this.VLBC_VELOALL)&&(this.#e[u.cc*e+h[129]]=0),this.dispatchEvent("note",{part:e,note:r,velo:0,state:this.NOTE_IDLE})}},nOn:(e,r,d)=>{let p=e*128+r,b=0;for(this.#E[e]&&this.#l.ano(e);this.#u[b]>0&&this.#d[b]!=p;)b++;if(b<u.pl){this.#d[b]=p,this.#f[p]=d,this.#u[b]=this.NOTE_SUSTAIN,this.#T[e]<d&&(this.#T[e]=d);let E=this.getExt(e)[1];(E==this.VLBC_VELOINIT||E==this.VLBC_VELOALL)&&(this.#e[u.cc*e+h[129]]=d),this.dispatchEvent("note",{part:e,note:r,velo:d,state:this.NOTE_SUSTAIN})}else console.error("Polyphony exceeded.")},nAt:(e,r,d)=>{},cAt:(e,r)=>{},hoOf:e=>{this.#u.forEach((r,d)=>{if(r==this.NOTE_HELD){let p=this.#d[d],b=p>>7;e==b&&(this.#u[d]=this.NOTE_IDLE,this.#d[d]=0,this.#f[p]=0,this.dispatchEvent("note",{part:e,note:p&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{this.#u.forEach((r,d)=>{let p;switch(r){case this.NOTE_ATTACK:{p=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{p=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{p=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(p){this.#u[d]=p;let b=this.#d[d];this.dispatchEvent("note",{part:e,note:b&127,velo:this.#f[b],state:p})}})},soOf:e=>{this.#u.forEach((r,d)=>{if(r==this.NOTE_SOSTENUTO_HELD){let p=this.#d[d],b=p>>7;e==b&&(this.#u[d]=this.NOTE_IDLE,this.#d[d]=0,this.#f[p]=0,this.dispatchEvent("note",{part:e,note:p&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{this.#d.forEach((r,d,p)=>{let b=r>>7,E=r&127;r==0&&this.#f[0]==0||b==e&&this.#l.nOff(b,E)})}};#ce={8:function(e){let r=e.channel,d=e.data[0];this.#l.nOff(r,d)},9:function(e){let r=e.channel;this.setChActive(r,1);let d=e.data[0],p=e.data[1];p>0?this.#l.nOn(r,d,p):this.#l.nOff(r,d)},10:function(e){let r=e.channel,d=r*128+e.data[0];this.#d.indexOf(d)>-1&&(this.#f[d]=data[1],this.getExt(r)[1]==this.VLBC_VELOALL&&(this.#e[u.cc*r+h[129]]=data[1]),this.dispatchEvent("note",{part:r,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let r=e.channel,d=this.#K[r],p=d[e.data[0]];p&&(e.data[0]=p),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(this.#t){case k.s90es:case k.motif:{if(e.data[0]==0){[0,63].indexOf(e.data[1])>-1&&this.setChActive(r,1);break}e.data[1]&&this.setChActive(r,1);break}default:{this.setChActive(r,1);break}}})();let b=r*u.cc,E=r*u.ext;switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{this.#l.ano(r),this.#A[r]=0,this.#e[b+h[1]]=0,this.#e[b+h[5]]=0,this.#e[b+h[64]]=0,this.#e[b+h[65]]=0,this.#e[b+h[66]]=0,this.#e[b+h[67]]=0,this.#e[b+h[11]]=127,this.#e[b+h[101]]=127,this.#e[b+h[100]]=127,this.#e[b+h[99]]=127,this.#e[b+h[98]]=127;return}case 123:{this.#l.ano(r);return}case 124:{this.#l.ano(r);return}case 125:{this.#l.ano(r);return}case 126:{this.#E[r]=1,this.#l.ano(r);return}case 127:{this.#E[r]=0,this.#l.ano(r);return}}if(h[e.data[0]]==null)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(ve.indexOf(e.data[0])>-1&&this.allocateAce(e.data[0]),e.data[0]){case 0:{switch(v()&&console.debug(`${R[this.#t]}, CH${r+1}: ${e.data[1]}`),this.#t==0?e.data[1]<48?(this.#r[r]>0&&(e.data[1]=this.#e[b],e.data[1]=120,console.debug(`Forced channel ${r+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]==62?this.switchMode(this.#o.x5==82?"x5d":"05rw"):e.data[1]==63?this.switchMode(this.modeIdx[this.#o.ds]):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg"):this.#t==k.gs?e.data[1]<56&&this.#r[r]>0&&(e.data[1]=this.#e[b],e.data[1]=120,console.debug(`Forced channel ${r+1} to stay drums.`)):this.#t==k.gm&&(e.data[1]<48?this.#r[r]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${r+1} to stay drums.`)):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg",!0)),this.#t){case k.xg:{[79,95,126,127].indexOf(e.data[1])>-1?this.#r[r]==0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):this.#r[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?this.#M[E]=this.EXT_VL:this.#M[E]=this.EXT_NONE;break}case k["05rw"]:case k.x5d:case k.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?this.#r[r]==this.CH_MELODIC&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):[80,81,82,83].indexOf(e.data[1])>-1||this.#r[r]!=this.CH_MELODIC&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case k.sd:{[104,105,106,107].indexOf(e.data[1])>-1?this.#r[r]==0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):this.#r[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case k.g2:{e.data[1]==120?this.#r[r]==0&&(this.setChType(r,this.CH_DRUMS),console.debug(`CH${r+1} set to drums by MSB.`)):this.#r[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}}this.dispatchEvent("voice",{part:r});break}case 2:{this.getExt(r)[1]==this.VLBC_BRTHEXPR&&(this.#e[b+h[129]]=e.data[1]);break}case 6:{if(this.#X){[k.xg,k.gs,k.ns5r].indexOf(this.#t)<0&&console.warn(`NRPN commits are not available under "${R[this.#t]}" mode, even when they are supported in Octavia.`);let g=this.#e[b+h[99]],$=this.#e[b+h[98]];if(g==1){let t=Se.indexOf($);if(t>-1)this.#e[b+h[71+t]]=e.data[1],v()&&console.debug(`Redirected NRPN 1 ${$} to cc${71+t}.`),this.dispatchEvent("cc",{part:r,cc:71+t,data:e.data[1]});else{let a=he.indexOf($);a>-1?this.#J[r*10+a]=e.data[1]-64:console.warn(`NRPN 0x01${$.toString(16).padStart(2,"0")} is not supported.`),v()&&console.debug(`CH${r+1} voice NRPN ${$} commit`)}}else{if(_.indexOf(g)<0){let a=`NRPN 0x${g.toString(16).padStart(2,"0")}${$.toString(16).padStart(2,"0")} `;g==127?console.warn(`${a}is not necessary. Consider removing it.`):console.warn(`${a}is not supported.`)}else{let a=this.#r[r]-2;a<0?console.warn(`CH${r+1} cannot accept drum NRPN as type ${N[this.#r[r]]}.`):this.#y[(a*u.dpn+T[g])*u.dnc+$]=e.data[1]}v()&&console.debug(`CH${r+1} (${N[this.#r[r]]}) drum NRPN ${g} commit`)}}else{let g=le[this.#e[b+h[100]]],$=fe[this.#e[b+h[100]]];this.#e[b+h[101]]==0&&g!=null&&(v()&&console.debug(`CH${r+1} RPN 0 ${this.#e[b+h[100]]} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],de[g][0]),de[g][1]),this.#a[r*u.rpn+g]=e.data[1],this.#s[r*u.rpnt+$]=1)}break}case 32:{switch(v()&&console.debug(`${R[this.#t]}, CH${r+1} LSB: ${e.data[1]}`),this.#t){case k.s90es:case k.motif:{this.setChType(r,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,this.#t,!0);break}}this.dispatchEvent("voice",{part:r});break}case 38:{if(!this.#X){let g=le[this.#e[b+100]],$=fe[this.#e[b+100]];this.#e[b+101]==0&&g!=null&&(this.#a[r*u.rpn+g+1]=e.data[1],this.#s[r*u.rpnt+$]=1)}break}case 64:{e.data[1]<64&&this.#l.hoOf(r);break}case 66:{e.data[1]>>6?this.#l.soOn(r):this.#l.soOf(r);break}case 98:case 99:{this.#X=1;break}case 100:case 101:{this.#X=0;break}}this.#e[b+h[e.data[0]]]=e.data[1],this.dispatchEvent("cc",{part:r,cc:e.data[0],data:e.data[1]})}},12:function(e){let r=e.channel;switch(this.#t){case k.s90es:case k.motif:{e.data&&this.setChActive(r,1);break}default:this.setChActive(r,1)}this.#i[r]=e.data,this.#R[r]=0,v()&&console.debug(`T:${e.track} C:${r} P:${e.data}`),this.dispatchEvent("voice",{part:r})},13:function(e){let r=this,d=e.channel;this.#d.forEach(function(p){let b=p>>7;d==b&&(r.#f[p]=e.data,r.dispatchEvent("note",{part:d,note:p&127,velo:e.data,state:r.NOTE_SUSTAIN}))})},14:function(e){let r=e.channel;this.#A[r]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)})},15:function(e){Ce(e.data).forEach(r=>{let d=r[0],p=r[1];(this.#oe[d]||function(){console.debug(`Unknown manufacturer ${d}.`)})(p,r.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(this.#p[e.meta]||function(d,p,b){}).call(this,e.data,e.track,e.meta),e.meta!=32&&(this.#F=0);let r=we.indexOf(e.meta)>-1;if(v()&&console.debug(e),r)return e.reply="meta",e}};#oe={64:(e,r,d)=>{this.#Y.run(r,d,e)},65:(e,r,d)=>{if(r[0]<16)if(r[1]==72){let p=r[r.length-1],b=D(r.subarray(3,r.length-1));p==b?this.#v.run(r.subarray(0,r.length-1),d,e):console.warn(`Bad SD checksum ${p}. Should be ${b}.`)}else this.#v.run(r,d,e);else{let p=r[r.length-1],b=D(r.subarray(2,r.length-1));p==b?this.#v.run(r.subarray(0,r.length-1),d,e):console.warn(`Bad GS checksum ${p}. Should be ${b}.`)}},66:(e,r,d)=>{this.#N.run(r,d,e)},67:(e,r,d)=>{this.#w.run(r,d,e)},68:(e,r,d)=>{this.#j.run(r,d,e)},71:(e,r,d)=>{this.#W.run(r,d,e)},126:(e,r,d)=>{this.#q.run(r,d,e)},127:(e,r,d)=>{this.switchMode("gm"),this.#Q.run(r,d,e)}};#q;#Q;#w;#v;#N;#Y;#W;#j;buildRchTree(){let e=[];this.#h.forEach((r,d)=>{r<u.ch&&(e[r]?.constructor||(e[r]=[]),e[r].push(d))}),this.#ie=e}buildRccMap(){let e=this;for(let r=0;r<u.ch;r++)e.#K[r]={};e.#V.forEach((r,d)=>{r&&(e.#K[Math.floor(d/u.redir)][r]=d%u.redir|128)}),v()&&console.debug(e.#K)}getActive(){return this.#O}getCc(e){let r=e*u.cc,d=this.#e.subarray(r,r+u.cc);return d[h[0]]=d[h[0]]||this.#G,d[h[32]]=d[h[32]]||this.#k,d[h[0]]==H.bank0&&(d[h[0]]=0),d}getCcCh(e,r){if(G.indexOf(r)<0)throw new Error("CC number not accepted");return this.#e[u.cc*e+h[r]]}getCcAll(){let e=this.#e.slice();for(let r=0;r<u.ch;r++){let d=r*u.cc;e[d+h[0]]=e[d+h[0]]||this.#G,e[d+h[32]]=e[d+h[32]]||this.#k,e[h[0]]==H.bank0&&(e[h[0]]=0)}return e}getChSource(){return this.#h}getChType(){return this.#r}setChType(e,r,d=this.#t,p=!1){r&=15,this.#r[e]=r,r>0&&!p&&(this.#e[e*u.cc+h[0]]=O[d])}setChActive(e,r=0){this.#O[e]!=r&&this.dispatchEvent("channeltoggle",{part:e,active:r}),this.#O[e]=r}getExt(e){let r=u.ext*e,d=this.#M.subarray(r,r+u.ext),p=new Uint8Array(d.length);return p.set(d),p[1]=p[1]||this.#ne,p}getPitch(){return this.#A}getProgram(){return this.#i}getTexts(){return this.#m.slice()}getVel(e){let r=new Map,d=this;return d.#d.forEach(function(p,b){let E=Math.floor(p/128),g=p%128;e==E&&d.#f[p]>0&&r.set(g,{v:d.#f[p],s:d.#u[b]})}),r}getBitmap(){return{bitmap:this.#g,expire:this.#C}}getLetter(){return{text:this.#B,set:this.#se,expire:this.#_}}getMode(){return R[this.#t]}getMaster(){return{volume:this.#c}}getRawStrength(){let e=this;return this.#d.forEach(function(r){let d=Math.floor(r/128);e.#f[r]>e.#T[d]&&(e.#T[d]=e.#f[r])}),this.#T}getStrength(){let e=[],r=this;return this.getRawStrength().forEach(function(d,p){e[p]=Math.floor(d*r.#e[p*u.cc+h[7]]*r.#e[p*u.cc+h[11]]*r.#c/803288)}),e}getRpn(){return this.#a}getNrpn(){return this.#J}getVoice(e,r,d,p){let b=e||this.#G,E=r,g=d||this.#k;b==H.bank0&&(b=0),R[this.#t]=="ns5r"&&b>0&&b<56&&(g=3);let $=this.userBank.get(b,E,g,p);if(R[this.#t]=="mt32"&&$.name.indexOf("MT-m:")==0){let t=parseInt($.name.slice(5)),a=t*u.cmt,c="";this.#H.subarray(a,a+10).forEach(s=>{s>31&&(c+=String.fromCharCode(s))});let i=`MSB	LSB	PRG	NME
0	127	${E}	${c}`;this.userBank.load(i,!0),$.name=c,$.ending=" "}return($.ending!=" "||!$.name.length)&&($=this.baseBank.get(b,E,g,p)),$}getChVoice(e){let r=this.getVoice(this.#e[e*u.cc+h[0]],this.#i[e],this.#e[e*u.cc+h[32]],R[this.#t]);if(this.#R[e])switch(this.#t){case k.mt32:r.ending="~",r.name="",this.#S.subarray(14*(e-1),14*(e-1)+10).forEach(d=>{r.name+=String.fromCharCode(Math.max(d,32))}),r.name=r.name.trimRight()}return r}getRawPitch(){return this.#A}getPitchShift(e){let r=this,d=e*u.rpn,p=r.#a[d];return r.#s[e*u.rpnt]||r.#t==k.mt32&&(p=12),r.#A[e]/8192*p+(r.#a[d+3]-64)+((r.#a[d+1]<<7)+r.#a[d+2]-8192)/8192}getEffectType(e=0){let r=3*e+1;return this.#$.subarray(r,r+2)}setEffectTypeRaw(e=0,r,d){let p=3*e;this.#$[p]=1,this.#$[p+1+ +r]=d}setEffectType(e=0,r,d){this.setEffectTypeRaw(e,!1,r),this.setEffectTypeRaw(e,!0,d)}getEffectSink(){return this.#Z}setLetterDisplay(e,r,d=0,p=3200){let b=this,E;b.#B=" ".repeat(d),e.forEach(g=>{b.#B+=String.fromCharCode(g>31?g:32),g<32&&(E=E||new Set,E.add(g))}),b.#se=Date.now(),b.#_=Date.now()+p,E&&(E=Array.from(E),E.forEach((g,$,t)=>{t[$]=g.toString(16).padStart(2,"0")}),console.warn(`${r}${r?" ":""}invalid code point${E.length>1?"s":""}: 0x${E.join(", 0x")}`))}setDetectionTargets(e="?",r=0){let d=this,p=-1;switch(e.replaceAll(", ",",").split(",").forEach(b=>{b=b.toLowerCase();let E=R.indexOf(me[b]||b);v()&&console.debug(`Mapped mode "${b}" to ID "${E}".`),E>-1&&(p=E)}),v()&&console.debug(`Set detection target to ID "${p}".`),p>0&&(d.#o.x5=82,d.#o.ds=k.krs),p){case k["05rw"]:{d.#o.x5=81;break}case k.s90es:d.#o.ds=k.s90es;case k.motif:d.#o.ds=k.motif}}allocateAce(e){if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}let r=!0,d=0;for(;r&&d<u.ace;)this.#L[d]==e?r=!1:this.#L[d]||(r=!1,this.#L[d]=e,console.info(`Allocated cc${e} to ACE slot ${d}.`)),d++;d>=u.ace&&console.warn("ACE slots are full.")}getAce(){return this.#L}getChAce(e,r){if(r<0||r>=u.ace)throw new RangeError("No such ACE slot");let d=this.#L[r];if(d){if(G.indexOf(d)>=0)return this.#e[e*u.cc+h[d]];throw new Error(`Invalid ACE source: ${d}`)}else return 0}initDrums(){let e=this;e.#y.fill(64);for(let r=0;r<u.drm;r++){let d=r*u.dpn;for(let p in ue){let b=ue[p],E=(d+T[p])*u.dnc;e.#y.subarray(E,E+u.dnc).fill(b)}}}init(e=0){let r=this;r.#G=0,r.#k=0,r.#F=0,r.#O.fill(0),r.#e.fill(0),r.#L.fill(0),r.#i.fill(0),r.#f.fill(0),r.#d.fill(0),r.#E.fill(0),r.#T.fill(0),r.#A.fill(0),r.#J.fill(0),r.#s.fill(0),r.#M.fill(0),r.#V.fill(0),r.#c=100,r.#m=[],r.#te=500,r.#ae=0,r.#C=0,r.#b=0,r.#g.fill(0),r.#n=!1,r.#re=0,r.#x=!0,r.initDrums(),r.#h.forEach(function(d,p,b){b[p]=p}),e==0&&(r.dispatchEvent("mode","?"),r.#t=0,r.#U.fill(0),r.#I.fill(0),r.#_=0,r.#B=""),r.#e[u.cc*9]=O[0],r.#e[u.cc*25]=O[0],r.#e[u.cc*41]=O[0],r.#e[u.cc*57]=O[0],r.#r.fill(r.CH_MELODIC),r.#r[9]=r.CH_DRUM1,r.#r[25]=r.CH_DRUM3,r.#r[41]=r.CH_DRUMS,r.#r[57]=r.CH_DRUMS,r.#r[73]=r.CH_DRUM5,r.#r[89]=r.CH_DRUM7,r.#r[105]=r.CH_DRUMS,r.#r[121]=r.CH_DRUMS,r.#ee.fill(0),r.#H.fill(0),r.#P.fill(0),r.#S.fill(0),r.#R.fill(0),r.#$.fill(0),r.#Z.fill(0),r.aiEfxName="",r.userBank.clearRange({msb:0,lsb:127,prg:[0,127]});for(let d=0;d<u.ch;d++){let p=d*u.cc;r.#e[p+h[7]]=100,r.#e[p+h[11]]=127,r.#e[p+h[2]]=127,r.#e[p+h[10]]=64,r.#e.subarray(p+h[71],p+h[71]+8).fill(64),r.#e.subarray(p+h[130],p+h[130]+28).fill(64),r.#e[p+h[91]]=40,r.#e[p+h[101]]=127,r.#e[p+h[100]]=127,r.#e[p+h[99]]=127,r.#e[p+h[98]]=127;let b=d*u.rpn;r.#a[b]=2,r.#a[b+1]=64,r.#a[b+2]=0,r.#a[b+3]=64,r.#a[b+4]=0,r.#a[b+5]=0;let E=d*u.ext;r.#M[E+1]=r.VLBC_BRTHEXPR;let g=d*u.redir;r.#V[g+8]=13}r.buildRchTree(),r.buildRccMap(),r.dispatchEvent("mastervolume",r.#c),r.dispatchEvent("efxreverb",r.getEffectType(0)),r.dispatchEvent("efxchorus",r.getEffectType(1)),r.dispatchEvent("efxdelay",r.getEffectType(2)),r.dispatchEvent("efxinsert0",r.getEffectType(3)),r.dispatchEvent("efxinsert1",r.getEffectType(4)),r.dispatchEvent("efxinsert2",r.getEffectType(5)),r.dispatchEvent("efxinsert3",r.getEffectType(6)),r.dispatchEvent("reset"),r.switchMode("?")}switchMode(e,r=!1,d=!1){let p=this,b=R.indexOf(e);if(b>-1){if(p.#t==0||r){let E=p.#t;p.initOnReset&&r&&(this.init(1),E=k["?"]),p.#t=b,p.#b=0,p.#G=ne[0][b],p.#k=ne[1][b];for(let $=0;$<u.ch;$++)p.#r[$]>0&&p.#e[$*u.cc+h[0]]==O[E]&&(p.#e[$*u.cc]=O[b]);switch(b){case k.mt32:{z.forEach(($,t)=>{let a=t+1;p.#O[a]||(p.#i[a]=$,p.#e[a*u.cc+h[91]]=127)});for(let $=1;$<10;$++)p.dispatchEvent("voice",{part:$});break}}let g;switch(b){case k["?"]:case k.g2:{g=[52,4,52,18,0,0,0,0];break}case k.xg:{g=[1,0,65,0,5,0,0,0];break}case k.gm:case k.gs:{g=[40,4,40,18,40,32,32,0];break}case k.sd:{g=[58,0,60,0,61,0,61,0];break}case k["05rw"]:case k.x5d:case k.ns5r:{g=[44,1,44,19,44,0,44,0];break}case k.k11:case k.sg:{g=[24,0,0,0,0,0,0,0];break}case k.mt32:{g=[40,4,0,0,0,0,0,0];break}default:g=[0,0,0,0,0,0,0,0]}for(let $=0;$<u.efx;$++)!p.#$[3*$]&&g[$<<1]?.constructor&&(p.#$[3*$+1]=g[2*$],p.#$[3*$+2]=g[2*$+1],p.dispatchEvent(`efx${["reverb","chorus","delay","insert0"][$]}`,p.getEffectType($)));d&&p.setDetectionTargets(e),p.dispatchEvent("mode",e),p.forceVoiceRefresh()}}else throw new Error(`Unknown mode ${e}`)}newStrength(){this.#T.fill(0)}runJson(e){if(e.type>14)return e.type==15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),this.#ce[e.type].call(this,e);{let r=this.chRedir(e.part,e.track),d=!1;this.#ie[r]?.forEach(p=>{e.channel=p,d=!0,this.#ce[e.type].call(this,e)}),d||console.warn(`${oe[e.type]?oe[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${r+1} without any recipient.`)}this.#m.length>100&&this.#m.splice(100,this.#m.length-99)}runRaw(e){}async loadBank(e,r){let d=this;switch(e=e.toLowerCase(),e){case"s7e":{d.userBank.clearRange({msb:63,lsb:[21,22]}),d.userBank.clearRange({msb:63,lsb:[24,27]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":{B.context=this,d.userBank.load(await B.read(e,r));break}}d.forceVoiceRefresh()}constructor(){super();let e=this;e.#g=new Uint8Array(256),e.#D[10]=new Uint8Array(512),e.#z=new C,e.#o={x5:82,ds:k.krs},e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(t){let{data:a}=t;e.#m[0]?.type==a.type&&e.#m[0]?.amend?(e.#m[0].amend=a.amend,e.#m[0].data+=a.data):e.#m.unshift(a)}),e.#p[1]=function(t){switch(t=t.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),t.slice(0,2)){case"@I":{this.#n=!0,this.dispatchEvent("metacommit",{type:"Kar.Info",data:t.slice(2)?.trimLeft()});break}case"@K":{this.#n=!0,this.dispatchEvent("metacommit",{type:"Kar.Mode",data:t.slice(2)?.trimLeft()}),console.debug(`Karaoke mode active: ${t.slice(2)}`);break}case"@L":{this.#n=!0,this.dispatchEvent("metacommit",{type:"Kar.Lang",data:t.slice(2)?.trimLeft()});break}case"@T":{this.#n=!0,this.dispatchEvent("metacommit",{type:"KarTitle",data:t.slice(2)?.trimLeft()});break}case"@V":{this.#n=!0,this.dispatchEvent("metacommit",{type:"Kar.Ver.",data:t.slice(2)?.trimLeft()});break}case"XF":{let a=t.slice(2).split(":");switch(a[0]){case"hd":{a.slice(1).forEach((c,i)=>{c.length&&this.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][i],data:c})});break}case"ln":{a.slice(1).forEach((c,i)=>{c.length&&this.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][i],data:c})});break}default:this.dispatchEvent("metacommit",{type:"XfUnData",data:t})}break}default:this.#n?t[0]=="\\"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:t.slice(1),amend:!0})):t[0]=="/"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:t.slice(1),mask:!0,amend:!0})):this.dispatchEvent("metacommit",{type:"KarLyric",data:t,amend:!0}):t.split(`
`).forEach((a,c)=>{this.dispatchEvent("metacommit",{type:"Cmn.Text",data:a,mask:c!=0})})}},e.#p[2]=function(t){this.dispatchEvent("metacommit",{type:"Copyrite",data:t})},e.#p[3]=function(t,a){a<1&&this.#F<1&&this.dispatchEvent("metacommit",{type:"TrkTitle",data:t})},e.#p[4]=function(t,a){this.dispatchEvent("metacommit",{type:"Instrmnt",data:t})},e.#p[5]=function(t){t.trim()==""?this.dispatchEvent("metacommit",{type:"C.Lyrics",data:"",amend:!1}):this.dispatchEvent("metacommit",{type:"C.Lyrics",data:t,amend:!0})},e.#p[6]=function(t){this.dispatchEvent("metacommit",{type:"C.Marker",data:t})},e.#p[7]=function(t){this.dispatchEvent("metacommit",{type:"CuePoint",data:t})},e.#p[32]=function(t){this.#F=t[0]+1},e.#p[33]=function(t,a){e.#I[a]=t+1},e.#p[81]=function(t,a){e.#te=t/1e3},e.#p[127]=function(t,a){e.#z.run(t,a)},e.#z.default=function(t){console.warn(`Unrecognized sequencer-specific byte sequence: ${t}`)},e.#z.add([67,0,1],function(t,a){e.#I[a]=t[0]+1}),e.#q=new C("universal non-realtime"),e.#Q=new C("universal realtime"),e.#w=new C("Yamaha"),e.#v=new C("Roland"),e.#N=new C("Korg"),e.#Y=new C("Kawai"),e.#W=new C("Akai"),e.#j=new C("Casio");let r=new C("DX7+ Dump"),d=function(t){console.info(`Unrecognized SysEx in "${this.name}" set.
%o`,t)};e.#q.default=d,e.#Q.default=d,e.#w.default=d,e.#v.default=d,e.#N.default=d,e.#Y.default=d,e.#W.default=d,e.#j.default=d,r.default=d,e.#q.add([9],t=>{e.switchMode(["gm","?","g2"][t[0]-1],!0),e.#n=e.#n||!1,console.info(`MIDI reset: ${["GM","Init","GM2"][t[0]-1]}`),t[0]==2&&e.init()}),e.#Q.add([4,1],t=>{e.#c=((t[1]<<7)+t[0])/16383*100,e.dispatchEvent("mastervolume",e.#c)}).add([4,3],t=>((t[1]<<7)+t[0]-8192)/8192).add([4,4],t=>t[1]-64).add([4,5],t=>{let a=t[0],c=t[1],i=t[2],s=3,f=s+(a<<1),o=f+c;if(a!=1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${a})!
`,t);return}let n=0,l=0,y=0;switch(t.subarray(s,f).forEach(m=>{n=n<<7,n|=m}),t.subarray(f,o).forEach((m,w)=>{l|=m<<w*7}),t.subarray(o).forEach((m,w)=>{y|=m<<w*7}),v()&&console.debug(`GM2 global parameter: (${t.subarray(3,f)}; p: ${l}, v: ${y})`),n){case 129:{l==0&&(e.setEffectType(0,52,y),e.dispatchEvent("efxreverb",e.getEffectType(0)));break}case 130:{l==0&&(e.setEffectType(1,52,y|16),e.dispatchEvent("efxchorus",e.getEffectType(1)));break}default:v()&&console.debug("GM2 global paramater slot path unknown.")}}),this.#w.add([76,0,0],t=>{switch(t[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset: ${t}`);break}case 126:{e.switchMode("xg",!0),e.#n=!1,console.info("MIDI reset: XG");break}default:{let a=[0,0,0,0],c=(i,s)=>{a[s]=i};if(t.subarray(1).forEach((i,s)=>{let f=s+t[0];([c,c,c,c,o=>{this.#c=o*129/16383*100,e.dispatchEvent("mastervolume",e.#c)},o=>{},o=>{}][f]||(()=>{}))(i,s)}),t[0]<4){let i=0;a.forEach(s=>{i=i<<4,i+=s}),i-=1024}}}}).add([76,2,1],t=>{let a="XG ";t[0]<32?(a+="reverb ",t.subarray(1).forEach((c,i)=>{([s=>{e.setEffectTypeRaw(0,!1,s),console.info(`${a}main type: ${U[s]}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},s=>{e.setEffectTypeRaw(0,!0,s),console.debug(`${a}sub type: ${s+1}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},s=>{console.debug(`${a}time: ${Z(s)}s`)},s=>{console.debug(`${a}diffusion: ${s}`)},s=>{console.debug(`${a}initial delay: ${s}`)},s=>{console.debug(`${a}HPF cutoff: ${L[s]}Hz`)},s=>{console.debug(`${a}LPF cutoff: ${L[s]}Hz`)},s=>{console.debug(`${a}width: ${s}`)},s=>{console.debug(`${a}height: ${s}`)},s=>{console.debug(`${a}depth: ${s}`)},s=>{console.debug(`${a}wall type: ${s}`)},s=>{console.debug(`${a}dry/wet: ${s}`)},s=>{console.debug(`${a}send: ${x(s)}dB`)},s=>{console.debug(`${a}pan: ${s-64}`)},!1,!1,s=>{console.debug(`${a}delay: ${s}`)},s=>{console.debug(`${a}density: ${s}`)},s=>{console.debug(`${a}balance: ${s}`)},s=>{},s=>{console.debug(`${a}feedback: ${s}`)},s=>{}][t[0]+i]||function(){console.warn(`Unknown XG reverb address: ${t[0]}.`)})(c)})):t[0]<64?(a+="chorus ",t.subarray(1).forEach((c,i)=>{([s=>{e.setEffectTypeRaw(1,!1,s),console.info(`${a}main type: ${U[s]}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},s=>{e.setEffectTypeRaw(1,!0,s),console.debug(`${a}sub type: ${s+1}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},s=>{console.debug(`${a}LFO: ${J[s]}Hz`)},s=>{},s=>{console.debug(`${a}feedback: ${s}`)},s=>{console.debug(`${a}delay offset: ${ee(s)}ms`)},s=>{},s=>{console.debug(`${a}low: ${L[s]}Hz`)},s=>{console.debug(`${a}low: ${s-64}dB`)},s=>{console.debug(`${a}high: ${L[s]}Hz`)},s=>{console.debug(`${a}high: ${s-64}dB`)},s=>{console.debug(`${a}dry/wet: ${s}`)},s=>{console.debug(`${a}send: ${x(s)}dB`)},s=>{console.debug(`${a}pan: ${s-64}`)},s=>{console.debug(`${a}to reverb: ${x(s)}dB`)},!1,s=>{},s=>{},s=>{},s=>{console.debug(`${a}LFO phase diff: ${(s-64)*3}deg`)},s=>{console.debug(`${a}input mode: ${s?"stereo":"mono"}`)},s=>{}][t[0]-32+i]||function(){console.warn(`Unknown XG chorus address: ${t[0]}.`)})(c)})):t[0]<86?(a+="variation ",t.subarray(1).forEach((c,i)=>{([s=>{e.setEffectTypeRaw(2,!1,s),console.info(`${a}main type: ${U[s]}`),e.dispatchEvent("efxdelay",e.getEffectType(2))},s=>{e.setEffectTypeRaw(2,!0,s),console.debug(`${a}sub type: ${s+1}`),e.dispatchEvent("efxdelay",e.getEffectType(2))}][t[0]-64+i]||function(){})(c)})):t[0]<97?(a+="variation ",t.subarray(1).forEach((c,i)=>{[s=>{console.debug(`${a}send: ${x(s)}dB`)},s=>{console.debug(`${a}pan: ${s-64}`)},s=>{console.debug(`${a}to reverb: ${x(s)}dB`)},s=>{console.debug(`${a}to chorus: ${x(s)}dB`)},s=>{console.debug(`${a}connection: ${s?"system":"insertion"}`)},s=>{console.debug(`${a}channel: CH${s+1}`)},s=>{console.debug(`${a}mod wheel: ${s-64}`)},s=>{console.debug(`${a}bend wheel: ${s-64}`)},s=>{console.debug(`${a}channel after touch: ${s-64}`)},s=>{console.debug(`${a}AC1: ${s-64}`)},s=>{console.debug(`${a}AC2: ${s-64}`)}][t[0]-86+i](c)})):t[0]>111&&t[0]<118?a+="variation ":console.warn(`Unknown XG variation address: ${t[0]}`)}).add([76,2,64],t=>{t.subarray(1).forEach((a,c)=>{let i=c+t[0];if(i==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][a]}`);else{let s=i-1>>2,f=i-1&3,o=`XG EQ ${s} ${["gain","freq","Q","shape"][f]}: `;[()=>{console.debug(`${o}${a-64}dB`)},()=>{console.debug(`${o}${a} (raw)`)},()=>{console.debug(`${o}${a/10}`)},()=>{console.debug(`${o}${["shelf","peak"][+!!a]}`)}][f]()}})}).add([76,3],t=>{let a=t[0],c=t[1],i=`XG Insertion ${t[0]+1} `;t.subarray(2).forEach((s,f)=>{([o=>{e.setEffectTypeRaw(3+a,!1,o),console.info(`${i}main type: ${U[o]}`),e.dispatchEvent(`efxinsert${a}`,e.getEffectType(3+a))},o=>{e.setEffectTypeRaw(3+a,!0,o),console.debug(`${i}sub type: ${o+1}`),e.dispatchEvent(`efxinsert${a}`,e.getEffectType(3+a))}][c+f]||function(){})(s)})}).add([76,6,0],t=>{let a=t[0];a<64?e.setLetterDisplay(t.subarray(1),"XG letter display",a):e.#_=Date.now()}).add([76,7,0],t=>{let a=t[0];e.#b=0,e.#C=Date.now()+3200,e.#g.fill(0);let c=t.subarray(1);for(let i=0;i<a;i++)c.unshift(0);c.forEach(function(i,s){let f=Math.floor(s/16),o=s%16,n=(o*3+f)*7,l=7,y=0;for(n-=o*5,f==2&&(l=2);y<l;)e.#g[n+y]=i>>6-y&1,y++})}).add([76,8],(t,a)=>{let c=e.chRedir(t[0],a,!0),i=t[1],s=u.cc*c,f=`XG CH${c+1} `,o=`Unknown XG part address ${i}.`;t.subarray(2).forEach((n,l)=>{i<1?console.debug(o):i<41?([()=>{e.#e[s+h[0]]=n,e.dispatchEvent("voice",{part:c})},()=>{e.#e[s+h[32]]=n,e.dispatchEvent("voice",{part:c})},()=>{e.#i[c]=n,e.dispatchEvent("voice",{part:c})},()=>{let y=e.chRedir(n,a,!0);e.#h[c]=y,c!=y&&(e.buildRchTree(),console.info(`${f}receives from CH${y+1}`))},()=>{e.#E[c]=+!n},()=>{},()=>{e.setChType(c,n,k.xg),console.debug(`${f}type: ${N[n]||n}`)},()=>{e.#a[u.rpn*c+3]=n,e.#s[u.rpnt*c+2]=1},!1,!1,()=>{e.#e[s+h[7]]=n},!1,!1,()=>{e.#e[s+h[10]]=n||128},!1,!1,()=>{e.#e[s+h[128]]=n},()=>{e.#e[s+h[93]]=n},()=>{e.#e[s+h[91]]=n},()=>{e.#e[s+h[94]]=n},()=>{e.#e[s+h[76]]=n},()=>{e.#e[s+h[77]]=n},()=>{e.#e[s+h[78]]=n},()=>{e.#e[s+h[74]]=n},()=>{e.#e[s+h[71]]=n},()=>{e.#e[s+h[73]]=n},()=>{e.#e[s+h[75]]=n},()=>{e.#e[s+h[72]]=n}][i+l-1]||(()=>{}))():i<48?console.debug(o):i<111?i>102&&i<105&&(e.#e[s+h[[5,65][i&1]]]=n):i<114?console.debug(o):i<116?console.debug(`${f}EQ ${["bass","treble"][i&1]} gain: ${n-64}dB`):i<118?console.debug(o):i<120?console.debug(`${f}EQ ${["bass","treble"][i&1]} freq: ${n}`):console.debug(o)})}).add([76,9],(t,a)=>{let c=e.chRedir(t[0],a,!0),i=t[1],s=u.cc*c,f=`PLG-VL CH${c+1} `;t.subarray(2).forEach((o,n)=>{let l=n+i;switch(l){case 1:{console.info(`${f}breath mode: ${["system","breath","velocity","touch EG"][o]}`);break}case 0:case 27:case 28:break;default:if(l<27){let y=l-3>>1,m=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][y];l&1?l<23?(console.debug(`${f}${m} control source: ${re(o)}`),o&&o<96&&e.allocateAce(130+y),e.#V[u.redir*c+y+2]=o,e.buildRccMap()):console.debug(`${f}${m} scale break point: ${o}`):(console.debug(`${f}${m} depth: ${o-64}`),e.#e[s+h[130+y]]=o)}}})}).add([76,10],t=>{}).add([76,16],t=>{}).add([76,17,0,0],t=>{}).add([76,112],t=>{switch(console.debug(`XG enable PLG-${["VL","SG","DX","AN","PF","DR","PC","AP"][t[0]]} for CH${t[2]+1}.`),t[0]){case 0:{e.#M[u.ext*t[2]]=e.EXT_VL;break}default:e.#M[u.ext*t[2]]=e.EXT_NONE}}).add([73,0,0],(t,a)=>{let c=t[0],i="MU1000 System: ";t.subarray(1).forEach((s,f)=>{let o=c+f;o==8?console.debug(`${i}LCD contrast set to ${s}.`):o==18?(e.#k=s?126:0,console.debug(`${i}bank defaults to ${s?"MU100 Native":"MU Basic"}.`)):o>=64&&o<69&&[()=>{e.dispatchEvent("channelactive",s)},()=>{s<8?(e.dispatchEvent("channelmin",s<<4),console.debug(`Octavia System: Minimum CH${(s<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{s<8?(e.dispatchEvent("channelmax",(s<<4)+15),console.debug(`Octavia System: Maximum CH${(s<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{e.#x=!!s,console.info(`Octavia System: RS receiving ${["dis","en"][s]}abled.`)}][o-64]()})}).add([73,10,0],(t,a)=>{let c=t[0],i=`MU1000 RS${e.#x?"":" (ignored)"}: `;if(c<16)switch(c){case 2:{let s=e.chRedir(0,a,!0);e.#x&&(e.dispatchEvent("channelmin",s),e.dispatchEvent("channelmax",s+63)),console.info(`${i}Show CH1~64`);break}case 3:{let s=e.chRedir(t[1]<<5,a,!0);e.#x&&e.dispatchEvent("channelmin",s),e.#x&&e.dispatchEvent("channelmax",s+31),console.info(`${i}Show CH${s+1}~CH${s+32}`);break}default:console.debug(`${i}unknown switch ${c} invoked.`)}else if(c<32){if(e.#x){let s=e.chRedir(c-16+(e.#re<<4),a,!0);e.dispatchEvent("channelactive",s)}}else if(c<36){let s=e.chRedir(c-32<<4,a,!0);e.#x&&(e.dispatchEvent("channelmin",s),e.dispatchEvent("channelmax",s+15),e.#re=c-32),console.info(`${i}Show CH${s+1}~CH${s+16}`)}}).add([93,3],(t,a)=>{let c=e.chRedir(t[0],a,!0),i=`PLG-100SG CH${c+1} `,s=Date.now();if(t[1]==0){let f="",o=0;t.subarray(2).forEach((n,l)=>{l%2==0?f+=te[n]||n.toString().padStart("0"):o+=n*13}),s>=e.#ae&&this.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"SGLyrics",data:`${ae(f)}`,amend:!0}),e.#ae=s+Math.ceil(o/2)+e.#te,v()&&console.debug(`${i}vocals: ${f}`)}else console.warn(`Unknown PLG-100SG data: ${t}`)}).add([100,0],(t,a,c)=>{let i=t.subarray(0,t.length-1),s=D(i),f=t[t.length-1];if(s!=f){console.warn(`Yamaha DX7 dump SysEx checksum mismatch! Expected ${s}, but got ${f}:
`,t);return}else r.run(i)}),r.add([0,14,31],t=>{e.#e[u.cc*t[0]+h[64]]=0,e.#l.ano(t[0]),e.switchMode("xg"),console.debug(`Yamaha DX7+ reset CH${t[0]+1}.`)}).add([56,76,112],async t=>{let a=t[0],c="";t.subarray(1).forEach((i,s)=>{s<10&&(c+=String.fromCharCode(Math.max(i,32)))}),e.#i[a]=a&127,e.#e[u.cc*a+h[0]]=35,e.#e[u.cc*a+h[32]]=a>>7|2,e.dispatchEvent("voice",{part:a}),c.length>0&&(c=c.trimRight(),console.debug(`DX7+ CH${a+1} dumped voice name: "${c}"`))});let p=function(t,a,c,i){},b=function(t,a){let c=t*u.dpn,i=a[0],s=a[1];a.subarray(2).forEach((f,o)=>{let n=o+s,l=-1;n<16?([()=>{l=24},()=>{l=25},()=>{l=26},()=>{},()=>{l=28},()=>{l=29},()=>{l=30},()=>{l=31},()=>{},()=>{},()=>{},()=>{l=20},()=>{l=21},()=>{l=22},()=>{l=23},()=>{}][n]||(()=>{console.debug(`Unknown XG-style drum param ${n} on set ${t+1}.`)}))():n<32||(n<40?([()=>{l=48},()=>{l=49},!1,!1,()=>{l=52},()=>{l=53}][n-32]||(()=>{console.debug(`Unknown XG-style drum param ${n} on set ${t+1}.`)}))():n<80||([()=>{l=36}][n-80]||(()=>{console.debug(`Unknown XG-style drum param ${n} on set ${t+1}.`)}))()),l>=0?(v()&&console.debug(c,l,i,f),e.#y[(c+T[l])*u.dnc+i]=f):v()&&console.debug(`XG-style drum param ${n} has no writes.`)})},E=function(t,a,c){let i=t*u.dpn,s=(a<<7)+c[0];c.subarray(1).forEach((f,o)=>{let n=o+s,l=n&127,y=n>>7,m=-1;y>1&&([()=>{m=26},()=>{},()=>{m=28},()=>{m=29},()=>{m=30},()=>{},()=>{},()=>{m=31}][y-2]||(()=>{console.debug(`Unknown GS-style drum param ${y} on set ${t+1}.`)}))(),m>-1?(v()&&console.debug(i,m,l,f),e.#y[(i+T[m])*u.dnc+l]=f):v()&&console.debug(`GS-style drum param ${y} has no writes.`)})};this.#w.add([76,48],(t,a,c)=>{b(0,t)}).add([76,49],(t,a,c)=>{b(1,t)}).add([76,50],(t,a,c)=>{b(2,t)}).add([76,51],(t,a,c)=>{b(3,t)}).add([76,52],(t,a,c)=>{b(4,t)}).add([76,53],(t,a,c)=>{b(5,t)}).add([76,54],(t,a,c)=>{b(6,t)}).add([76,55],(t,a,c)=>{b(7,t)}),this.#w.add([89,0],(t,a,c)=>{if(e.eprom){let i=t[0],s=(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);v()&&console.debug(`MU1000 EPROM trail to 0x${s.toString(16).padStart(6,"0")}, ${i} bytes.`);let f=e.eprom.data;t.subarray(4).forEach((o,n)=>{let l=n>>3,y=n&7;if(y==7)for(let m=0;m<7;m++)f[s+7*l+m]+=(o>>6-m&1)<<7;else f[s+7*l+y]=o})}}).add([89,1],(t,a,c)=>{let i=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3];v()&&console.debug(`MU1000 EPROM jump to 0x${i.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=i)}).add([89,2],(t,a,c)=>{if(e.eprom){let i=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);v()&&console.debug(`MU1000 EPROM write to 0x${i.toString(16).padStart(6,"0")}.`);let s=e.eprom.data;t.subarray(4).forEach((f,o)=>{let n=o>>3,l=o&7;if(l==7)for(let y=0;y<7;y++)s[i+7*n+y]+=(f>>6-y&1)<<7;else s[i+7*n+l]=f})}}).add([89,3],(t,a,c)=>{}),this.#w.add([39,48],(t,a,c)=>{}).add([43,0,0],(t,a,c)=>{let i=[0,0,0,0],s=(f,o)=>{i[o]=f};if(t.subarray(1).forEach((f,o)=>{let n=o+t[0];[s,s,s,s,()=>{this.#c=f*129/16383*100,e.dispatchEvent("mastervolume",e.#c)},()=>f-64,()=>f||128,()=>f,()=>f,()=>{console.debug(`TG300 variation on cc${f}.`)}][n](f,n)}),t[0]<4){let f=0;i.forEach(o=>{f=f<<4,f+=o}),f-=1024}}).add([43,1,0],(t,a,c)=>{}).add([43,2],(t,a,c)=>{let i=e.chRedir(t[0],a,!0),s=t[1],f=u.cc*i,o=`TG300 CH${i+1} `;t.subarray(2).forEach((n,l)=>{l<5?([()=>{},()=>{e.#e[f+h[0]]=n,e.dispatchEvent("voice",{part:i})},()=>{e.#e[f+h[32]]=n,e.dispatchEvent("voice",{part:i})},()=>{e.#i[i]=n,e.dispatchEvent("voice",{part:i})},()=>{let y=e.chRedir(n,a,!0);e.#h[i]=y,i!=y&&(e.buildRchTree(),console.info(`${o}receives from CH${y+1}`))}][l+s]||(()=>{}))(n,l+s):l<21||(l<47?([()=>{e.#E[i]=+!n},()=>{},()=>{},()=>{e.#a[u.rpn*i+3]=n,e.#s[u.rpnt*i+2]=1},()=>{},()=>{e.#e[f+h[7]]=n},!1,!1,()=>{e.#e[f+h[10]]=n||128},!1,!1,()=>{console.debug(`${o} AC1 at cc${n}`)},()=>{console.debug(`${o} AC2 at cc${n}`)},()=>{e.#e[f+h[128]]=n},()=>{e.#e[f+h[93]]=n},()=>{e.#e[f+h[91]]=n},()=>{e.#e[f+h[94]]=n},()=>{e.#e[f+h[76]]=n},()=>{e.#e[f+h[77]]=n},()=>{e.#e[f+h[74]]=n},()=>{e.#e[f+h[71]]=n},()=>{e.#e[f+h[73]]=n},()=>{e.#e[f+h[75]]=n},()=>{e.#e[f+h[72]]=n},()=>{e.#e[f+h[78]]=n}][l+s-21]||(()=>{}))(n,l+s):l<95||([()=>{e.#e[f+h[65]]=n},()=>{e.#e[f+h[5]]=n}][l+s-95]||(()=>{}))(n,l+s))})}).add([43,7,0],(t,a,c)=>{let i=t[0];e.setLetterDisplay(t.subarray(1),"TG300 letter display",i)}).add([43,7,1],(t,a,c)=>{e.#b=0,e.#C=Date.now()+3200,e.#g.fill(0),t.forEach(function(i,s){let f=Math.floor(s/16),o=s%16,n=(o*3+f)*7,l=7,y=0;for(n-=o*5,f==2&&(l=2);y<l;)e.#g[n+y]=i>>6-y&1,y++})}),this.#v.add([66,18,0,0,127],(t,a,c)=>{e.switchMode("gs",!0),e.#e[u.cc*9]=120,e.#e[u.cc*25]=120,e.#e[u.cc*41]=120,e.#e[u.cc*57]=120,e.#k=3,e.#n=!1,e.#U.fill(0),console.info(`GS system to ${["single","dual"][t[0]]} mode.`)}).add([66,18,64,0],(t,a,c)=>{switch(t[0]){case 127:{e.switchMode("gs",!0),e.#e[u.cc*9]=120,e.#e[u.cc*25]=120,e.#e[u.cc*41]=120,e.#e[u.cc*57]=120,e.#n=!1,e.#U.fill(0),console.info("MIDI reset: GS");break}default:{let i=[0,0,0,0],s=(f,o)=>{i[o]=f};if(t.subarray(1).forEach((f,o)=>{let n=o+t[0];[s,s,s,s,l=>{this.#c=l*129/16383*100,e.dispatchEvent("mastervolume",e.#c)},l=>{},l=>{}][n](f,o)}),t[0]<4){let f=0;i.forEach(o=>{f=f<<4,f+=o}),f-=1024}}}}).add([66,18,64,1],t=>{let a=t[0];if(a<16){let c="".padStart(a," ");t.subarray(1).forEach((i,s)=>{c+=String.fromCharCode(Math.max(32,i))}),c=c.padEnd(16," "),console.debug(`GS patch name: ${c}`)}else a<48||(a<65?t.subarray(1).forEach((c,i)=>{let s=`GS ${a+i>55?"chorus":"reverb"} `;([()=>{console.info(`${s}type: ${F[c]}`),e.setEffectType(0,40,c),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${s}predelay: ${c}ms`)},()=>{console.info(`${s}type: ${se[c]}`),e.setEffectType(1,40,16+c),e.dispatchEvent("efxchorus",e.getEffectType(1))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${s}to reverb: ${x(c)}`)},()=>{console.debug(`${s}to delay: ${x(c)}`)}][a+i-48]||(()=>{}))()}):a<80?console.debug(`Unknown GS patch address: ${a}`):a<91?t.subarray(1).forEach((c,i)=>{let s="GS delay ";([()=>{console.info(`${s}type: ${ie[c]}`),e.setEffectType(2,40,32+c),e.dispatchEvent("efxdelay",e.getEffectType(2))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${s}to reverb: ${x(c)}`)}][a+i-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${a}`))}).add([66,18,64,2],t=>{let a="GS EQ ";t.subarray(1).forEach((c,i)=>{([()=>{console.debug(`${a}low freq: ${[200,400][c]}Hz`)},()=>{console.debug(`${a}low gain: ${c-64}dB`)},()=>{console.debug(`${a}high freq: ${[3e3,6e3][c]}Hz`)},()=>{console.debug(`${a}high gain: ${c-64}dB`)}][t[0]+i]||function(){console.warn(`Unknown GS EQ address: ${t[0]+i}`)})()})}).add([66,18,64,3],t=>{let a="GS EFX ",c=function(i,s){let f=ce(e.#$.subarray(10,12),s,i);f&&console.debug(`${a}${K(e.#$.subarray(10,12))} ${f}`)};t.subarray(1).forEach((i,s)=>{([()=>{e.setEffectTypeRaw(3,!1,32+i),e.dispatchEvent("efxinsert0",e.getEffectType(3))},()=>{e.setEffectTypeRaw(3,!0,i),console.info(`${a}type: ${K(e.#$.subarray(10,12))}`),e.dispatchEvent("efxinsert0",e.getEffectType(3))},!1,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,()=>{console.debug(`${a}to reverb: ${x(i)}dB`)},()=>{console.debug(`${a}to chorus: ${x(i)}dB`)},()=>{console.debug(`${a}to delay: ${x(i)}dB`)},!1,()=>{console.debug(`${a}1 source: ${i}`),i&&i<96&&e.allocateAce(i)},()=>{console.debug(`${a}1 depth: ${i-64}`)},()=>{console.debug(`${a}2 source: ${i}`),i&&i<96&&e.allocateAce(i)},()=>{console.debug(`${a}2 depth: ${i-64}`)},()=>{console.debug(`${a}to EQ: ${i?"ON":"OFF"}`)}][t[0]+s]||function(f,o){console.warn(`Unknown GS EFX address: ${o}`)})(i,t[0]+s)})}).add([66,18,65],t=>{E((t[0]>>4)+1<<1,t[0]&15,t.subarray(1))}).add([69,18,16],t=>{switch(t[0]){case 0:{let a=t[1];e.setLetterDisplay(t.subarray(2),"GS display text",a);break}case 32:{e.#C=Date.now()+3200,t[1]==0&&(e.#b=Math.max(Math.min(t[2]-1,9),0),v()&&console.debug(`GS switch display page ${t[2]-1}.`));break}default:if(t[0]<6){e.#b>9&&(e.#b=0);let a=t[0]-1<<1|t[1]>>6;e.#b==a&&(e.#C=Date.now()+3200),e.#D[a]?.length||(e.#D[a]=new Uint8Array(256));let c=e.#D[a];v()&&console.debug(`GS frame draw page ${a}.`);let i=t[1]&63;c.fill(0),t.subarray(2).forEach(function(f,o){let n=o+i,l=Math.floor(n/16),y=n%16,m=(y*4+l)*5,w=5,S=0;for(m-=y*4,l==3&&(w=1);S<w;)c[m+S]=f>>4-S&1,S++})}else console.warn(`Unknown GS display section: ${t[0]}`)}});let g=function(t,a,c){let i=t[0],s=u.cc*a,f=u.rpn*a,o=`GS CH${a+1} `;i<3?(t.subarray(1).forEach((n,l)=>{[()=>{e.#e[s+h[0]]=n},()=>{e.#i[a]=n},()=>{let y=0;n<16?y=e.chRedir(n,c,!0):y=u.ch,e.#h[a]=y,a!=y&&(e.buildRchTree(),console.info(`${o}receives from CH${y+1}`))}][i+l]()}),e.dispatchEvent("voice",{part:a})):i<19||(i<44?t.subarray(1).forEach((n,l)=>{([()=>{e.#E[a]=+!n},!1,()=>{e.setChType(a,n<<1,k.gs),console.debug(`${o}type: ${n?"drum ":"melodic"}${n||""}`)},()=>{e.#a[f+3]=n,e.#s[u.rpnt*a+2]=1},!1,()=>{e.#e[s+h[7]]=n},!1,!1,()=>{e.#e[s+h[10]]=n||128},!1,!1,()=>{console.debug(`${o}CC 1: cc${n}`)},()=>{console.debug(`${o}CC 2: cc${n}`)},()=>{e.#e[s+h[93]]=n},()=>{e.#e[s+h[91]]=n},!1,!1,()=>{e.#a[f+1]=n,e.#s[u.rpnt*a+1]=1},()=>{e.#a[f+2]=n,e.#s[u.rpnt*a+1]=1},()=>{e.#e[s+h[94]]=n}][i+l-19]||(()=>{}))()}):i<76||console.debug(`Unknown GS part address: ${i}`))},$=function(t,a){let c=t[0],i=`GS CH${a+1} `;c<2?t.subarray(1).forEach((s,f)=>{[()=>{e.#e[u.cc*a+h[32]]=s},()=>{}][c+f]()}):c<32?console.warn(`Unknown GS misc address: ${c}`):c<35?t.subarray(1).forEach((s,f)=>{[()=>{console.debug(`${i}EQ: o${["ff","n"][s]}`)},()=>{},()=>{console.debug(`${i}EFX: o${["ff","n"][s]}`),e.#Z[a]=s,e.dispatchEvent("partefxtoggle",{part:a,active:s})}][c+f-32]()}):console.warn(`Unknown GS misc address: ${c}`)};this.#v.add([66,18,64,16],(t,a)=>{g(t,e.chRedir(9,a,!0),a)}).add([66,18,64,17],(t,a)=>{g(t,e.chRedir(0,a,!0),a)}).add([66,18,64,18],(t,a)=>{g(t,e.chRedir(1,a,!0),a)}).add([66,18,64,19],(t,a)=>{g(t,e.chRedir(2,a,!0),a)}).add([66,18,64,20],(t,a)=>{g(t,e.chRedir(3,a,!0),a)}).add([66,18,64,21],(t,a)=>{g(t,e.chRedir(4,a,!0),a)}).add([66,18,64,22],(t,a)=>{g(t,e.chRedir(5,a,!0),a)}).add([66,18,64,23],(t,a)=>{g(t,e.chRedir(6,a,!0),a)}).add([66,18,64,24],(t,a)=>{g(t,e.chRedir(7,a,!0),a)}).add([66,18,64,25],(t,a)=>{g(t,e.chRedir(8,a,!0),a)}).add([66,18,64,26],(t,a)=>{g(t,e.chRedir(10,a,!0),a)}).add([66,18,64,27],(t,a)=>{g(t,e.chRedir(11,a,!0),a)}).add([66,18,64,28],(t,a)=>{g(t,e.chRedir(12,a,!0),a)}).add([66,18,64,29],(t,a)=>{g(t,e.chRedir(13,a,!0),a)}).add([66,18,64,30],(t,a)=>{g(t,e.chRedir(14,a,!0),a)}).add([66,18,64,31],(t,a)=>{g(t,e.chRedir(15,a,!0),a)}).add([66,18,64,64],(t,a)=>{$(t,e.chRedir(9,a,!0))}).add([66,18,64,65],(t,a)=>{$(t,e.chRedir(0,a,!0))}).add([66,18,64,66],(t,a)=>{$(t,e.chRedir(1,a,!0))}).add([66,18,64,67],(t,a)=>{$(t,e.chRedir(2,a,!0))}).add([66,18,64,68],(t,a)=>{$(t,e.chRedir(3,a,!0))}).add([66,18,64,69],(t,a)=>{$(t,e.chRedir(4,a,!0))}).add([66,18,64,70],(t,a)=>{$(t,e.chRedir(5,a,!0))}).add([66,18,64,71],(t,a)=>{$(t,e.chRedir(6,a,!0))}).add([66,18,64,72],(t,a)=>{$(t,e.chRedir(7,a,!0))}).add([66,18,64,73],(t,a)=>{$(t,e.chRedir(8,a,!0))}).add([66,18,64,74],(t,a)=>{$(t,e.chRedir(10,a,!0))}).add([66,18,64,75],(t,a)=>{$(t,e.chRedir(11,a,!0))}).add([66,18,64,76],(t,a)=>{$(t,e.chRedir(12,a,!0))}).add([66,18,64,77],(t,a)=>{$(t,e.chRedir(13,a,!0))}).add([66,18,64,78],(t,a)=>{$(t,e.chRedir(14,a,!0))}).add([66,18,64,79],(t,a)=>{$(t,e.chRedir(15,a,!0))}),this.#N.add([54,65],(t,a)=>{e.switchMode("x5d");let c=t[t.length-1],i=t.subarray(0,t.length-1),s=D(i);s!=c&&(console.info(`X5D multi parameters checksum mismatch! Expected ${s}, got ${c}.`),console.debug(t));let f=(t[1]<<7)+t[0],o=(t[3]<<7)+t[2],n=e.chRedir(f&15,a,!0),l=u.cc*n;[()=>{o<1||(o<101?(e.setChType(n,e.CH_MELODIC,k.x5d),e.#i[n]=o-1,e.#e[l+h[0]]=e.#o.x5):o<229?(e.setChType(n,e.CH_MELODIC,k.x5d),e.#i[n]=o-101,e.#e[l+h[0]]=56):(e.setChType(n,e.CH_DRUMS,k.x5d),e.#i[n]=pe[o-229]||0,e.#e[l+h[0]]=62)),e.dispatchEvent("voice",{part:n})},()=>{e.#e[l+h[7]]=o},()=>{o<31&&(e.#e[l+h[10]]=Math.round((o-15)*4.2+64))},()=>{e.#e[l+h[93]]=P(o)},()=>{e.#e[l+h[91]]=P(o)},()=>{e.#a[n*u.rpn+3]=o>8191?o-16320:64+o,e.#s[u.rpnt*n+2]=1},()=>{e.#a[n*u.rpn+1]=o>8191?o-16320:64+o,e.#s[u.rpnt*n+1]=1},()=>{o>0&&(e.#a[n*u.rpn]=o,e.#s[u.rpnt*n]=1)},()=>{}][f>>4]()}).add([54,76,0],(t,a)=>{e.switchMode(e.#o.x5=="81"?"05rw":"x5d",!0);let c="",i=e.#o.x5,s=0,f=0,o="MSB	PRG	LSB	NME";M(t,function(n,l){if(l<16400){let y=l%164;switch(!0){case y<10:{n>31&&(c+=String.fromCharCode(n));break}case y==10:break;case y==11:{o+=`
${i}	${s}	${f}	${c.trim().replace("Init Voice","")}`,s++,c="";break}}s>99&&(i=90,s=0)}}),e.userBank.clearRange({msb:e.#o.x5,prg:[0,99],lsb:0}),e.userBank.load(o),v()&&console.debug(o),e.forceVoiceRefresh()}).add([54,77,0],(t,a)=>{e.switchMode(e.#o.x5=="81"?"05rw":"x5d",!0);let c="",i=90,s=0,f=0,o="MSB	PRG	LSB	NME";M(t,function(n,l){if(l<13600){let y=l%136;switch(!0){case y<10:{n>31&&(c+=String.fromCharCode(n));break}case y==11:{o+=`
${i}	${s}	${f}	${c.trim().replace("Init Combi","")}`,s++,c="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(o),v()&&console.debug(o),e.forceVoiceRefresh()}).add([54,78],(t,a)=>{e.switchMode(e.#o.x5=="81"?"05rw":"x5d",!0),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][t[0]]} mode.`)}).add([54,85],(t,a)=>{e.switchMode(e.#o.x5=="81"?"05rw":"x5d",!0),M(t,(c,i)=>{i>0&&i<3&&(e.setEffectType(i-1,44,c),e.dispatchEvent(`efx${["reverb","chorus"][i-1]}`,e.getEffectType(i-1)))})}).add([54,104],(t,a)=>{e.switchMode(e.#o.x5=="81"?"05rw":"x5d",!0),M(t,function(c,i,s,f){if(i<192){let o=e.chRedir(Math.floor(i/12),a,!0),n=o*u.cc;switch(i%12){case 0:{c<128?(e.setChType(o,e.CH_MELODIC,k.x5d),e.#e[n+h[0]]=e.#o.x5,e.#i[o]=c):(e.setChType(o,e.CH_DRUMS,k.x5d),e.#e[n+h[0]]=62,e.#i[o]=pe[c-128]),c>0&&e.setChActive(o,1),e.dispatchEvent("voice",{part:o});break}case 1:{e.#e[n+h[7]]=c;break}case 2:{e.#a[o*u.rpn+3]=c>127?c-192:64+c,e.#s[u.rpnt*o+2]=1;break}case 3:{e.#a[o*u.rpn+1]=c>127?c-192:64+c,e.#s[u.rpnt*o+1]=1;break}case 4:{c<31&&(e.#e[n+h[10]]=Math.round((c-15)*4.2+64));break}case 5:{let l=c>>4,y=c&15;e.#e[n+h[91]]=P(y),e.#e[n+h[93]]=P(l);break}case 10:break;case 11:{let l=e.chRedir(c&15,a,!0),y=c>>4;e.#h[o]=c,(l!=o||y)&&(console.info(`X5D Part CH${o+1} receives from CH${l+1}.`),e.buildRchTree())}}}else{let o=e.chRedir(i-192,a,!0)}})}),this.#v.add([22,18,127],t=>{e.switchMode("mt32",!0),e.#n=!1,e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(t,a,c)=>{e.switchMode("mt32");let i=e.chRedir(c,a,!0),s=t[1];t.subarray(2).forEach((f,o)=>{let n=o+s;e.#P[n+(i-1)*16]=f,([!1,()=>{let l=e.#P[i-1<<4];if(l<3){if(e.#R[i]=1,l==2)for(let y=0;y<name.length;y++)e.#S[(i-1)*u.cmt+y]=e.#H[f*u.cmt+y];else{let y=e.baseBank.get(0,f+(l<<6),127,"mt32").name;for(let m=0;m<y.length;m++)e.#S[(i-1)*u.cmt+m]=y.charCodeAt(m)}e.dispatchEvent("voice",{part:i})}},()=>{e.#a[i*u.rpn+3]=f+40,e.#s[u.rpnt*i+2]=1},()=>{e.#a[i*u.rpn+1]=f+14,e.#s[u.rpnt*i+1]=1},()=>{e.#a[i*u.rpn]=f,e.#s[u.rpnt*i]=1},!1,()=>{e.#e[u.cc*i+h[91]]=f?127:0},!1,()=>{e.#e[u.cc*i+h[7]]=f},()=>{e.#e[u.cc*i+h[10]]=Math.ceil(f*9.05)}][n]||(()=>{}))()})}).add([22,18,1],(t,a,c)=>{e.switchMode("mt32");let i=c&7;console.debug(`MT-32 slot #${c+1} Drum: ${t}`);let s=t[0]<<7|t[1];t.subarray(2).forEach((f,o)=>{let n=o+s,l=(n>>2)+24,y=n&3,m=i*u.dpn;if(v()&&console.debug(`MT-32 temp drum note ${l} param ${y}: ${f}`),l<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${l}`);return}[()=>{},()=>{e.#y[(m+T[26])*u.dnc+l]=Math.round(f*1.27)},()=>{e.#y[(m+T[26])*u.dnc+l]=f*9+1&127},()=>{e.#y[(m+T[26])*u.dnc+l]=f?127:0}][y]()})}).add([22,18,2],(t,a,c)=>{e.switchMode("mt32");let i=e.chRedir(c,a,!0),s=t[1]+(t[0]<<7);s<10&&(e.#R[i]=1),t.subarray(2).forEach((f,o)=>{let n=o+s;n<14&&(e.#S[(i-1)*u.cmt+n]=f)}),e.dispatchEvent("voice",{part:i})}).add([22,18,3],(t,a,c)=>{e.switchMode("mt32");let i=c&7;if(t[0]){let s=(t[0]-1<<7)+t[1]-16;t.subarray(2).forEach((f,o)=>{let n=o+s,l=(n>>2)+24,y=n&3,m=i*u.dpn;if(v()&&console.debug(`MT-32 dev drum note ${l} param ${y}: ${f}`),l<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${l}`);return}[()=>{},()=>{e.#y[(m+T[26])*u.dnc+l]=Math.round(f*1.27)},()=>{e.#y[(m+T[26])*u.dnc+l]=f*9+1&127},()=>{e.#y[(m+T[26])*u.dnc+l]=f?127:0}][y]()})}else{let s=t[1];t.subarray(2).forEach((f,o)=>{let n=o+s;e.#P[n]=f;let l=e.chRedir(1+(n>>4),a,!0),y=n&15;([!1,()=>{let m=e.#P[l-1<<4];if(m<3)if(e.#R[l]=1,m==2)for(let w=0;w<name.length;w++)e.#S[(l-1)*u.cmt+w]=e.#H[f*u.cmt+w];else{let w=e.baseBank.get(0,f+(m<<6),127,"mt32").name;for(let S=0;S<w.length;S++)e.#S[(l-1)*u.cmt+S]=w.charCodeAt(S)}e.dispatchEvent("voice",{part:l})},()=>{e.#a[l*u.rpn+3]=f+40,e.#s[u.rpnt*l+2]=1},()=>{e.#a[l*u.rpn+1]=f+14,e.#s[u.rpnt*l+1]=1},()=>{e.#a[l*u.rpn]=f,e.#s[u.rpnt*l]=1},!1,()=>{e.#e[u.cc*l+h[91]]=f?127:0},!1,()=>{e.#e[u.cc*l+h[7]]=f},()=>{e.#e[u.cc*l+h[10]]=Math.ceil(f*9.05)}][y]||(()=>{}))()})}}).add([22,18,4],(t,a,c)=>{e.switchMode("mt32");let i=t[1]+(t[0]<<7),s=[];t.subarray(2).forEach((f,o)=>{let n=o+i,l=e.chRedir(Math.floor(n/246+1),a,!0),y=n%246;y<14&&(e.#S[(l-1)*u.cmt+y]=f),y<10&&(e.#R[l]=1),s.indexOf(l)<0&&s.push(l)}),s.forEach(f=>{e.dispatchEvent("voice",{part:f})})}).add([22,18,5],(t,a,c)=>{e.switchMode("mt32");let i=(t[0]<<7)+t[1];t.subarray(2).forEach((s,f)=>{let o=i+f,n=Math.floor(o/8),l=o&7,y=n*8;e.#ee[o]=s,([!1,()=>{let m=e.#ee[y];if(m<3){let w="";if(m==2){let q=u.cmt*n;w=`MT-m:${s.toString().padStart(3,"0")}`}else w=e.baseBank.get(0,s+(m<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:n});let S=`MSB	LSB	PRG	NME
000	127	${n}	${w}`;e.userBank.load(S,!0)}}][l]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(t,a,c)=>{e.switchMode("mt32");let i=((t[0]&1)<<7)+t[1];t.subarray(2).forEach((s,f)=>{let o=i+f;o<u.cmt&&(e.#H[(t[0]>>1)*u.cmt+o]=s)}),e.forceVoiceRefresh()}).add([22,18,16],(t,a,c)=>{e.switchMode("mt32");let i=t[1],s=!1,f=function(o,n){e.#h[n-12]=o,s=!0};t.subarray(2).forEach((o,n)=>{let l=n+i;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,f,f,f,f,f,f,f,f,f,()=>{e.#c=o,e.dispatchEvent("mastervolume",e.#c)}][l]||(()=>{}))(o,n)}),s&&e.buildRchTree()}).add([22,18,32],t=>{e.switchMode("mt32");let a=t[1],c=" ".repeat(a);t.subarray(2).forEach(i=>{i>31?c+=String.fromCharCode(i):c+=" "}),e.#B=c.padStart(20," "),e.#_=Date.now()+3200}).add([22,18,82],(t,a)=>{let c=e.chRedir(0,a,!0);for(let i=0;i<16;i++)e.#l.ano(c+i),i&&i<10&&(e.#i[c+i]=z[i-1]);console.info("MT-32 alt reset complete.")}),this.#N.add([66,0],(t,a)=>{e.switchMode("ns5r",!0),e.#n=!1,console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][t[0]]} mode.`)}).add([66,1],(t,a)=>{e.switchMode(["ns5r","05rw"][t[0]],!0),e.#n=!1}).add([66,18,0,0],(t,a)=>{let c=t[0];switch(c){case 124:case 126:case 127:{e.switchMode("ns5r",!0),e.#n=!1;break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset: ${t}`);break}default:if(c<10){let i=[0,0,0,0],s=(f,o)=>{i[o]=f};if(t.subarray(1).forEach((f,o)=>{[s,s,s,s,()=>{e.#c=f*129/16383*100,e.dispatchEvent("mastervolume",e.#c)},()=>f-64,()=>f-64,()=>{},()=>{},()=>{}][c+o]()}),t[0]<4){let f=0;i.forEach(o=>{f=f<<4,f+=o}),f-=1024}}}}).add([66,18,0,1],(t,a)=>{}).add([66,18,0,2],(t,a)=>{}).add([66,18,1],(t,a)=>{let c=e.chRedir(t[0],a,!0),i=c*u.cc,s=t[1],f=`NS5R CH${c+1} `;t.subarray(2).forEach((o,n)=>{let l=s+n;l<3?([()=>{e.#e[i+h[0]]=o||H.bank0},()=>{e.#e[i+h[32]]=o},()=>{e.#i[c]=o}][l](),e.dispatchEvent("voice",{part:c})):l<8||(l<14?[()=>{let y=e.chRedir(o,a,!0);e.#h[c]=y,c!=y&&(e.buildRchTree(),console.info(`${f}receives from CH${y+1}`))},()=>{e.#E[c]=+!o},()=>{e.setChType(c,o,k.ns5r),console.debug(`${f}type: ${N[o]}`)},()=>{e.#a[u.rpn*c+3]=o,e.#s[u.rpnt*c+2]=1},()=>{},()=>{}][l-8]():l<16||(l<33?[()=>{e.#e[i+h[7]]=o},()=>{e.#e[i+h[11]]=o},()=>{},()=>{},()=>{e.#e[i+h[10]]=o||128},()=>{},()=>{},()=>{e.#e[i+h[93]]=o},()=>{e.#e[i+h[91]]=o},()=>{e.#e[i+h[76]]=o},()=>{e.#e[i+h[77]]=o},()=>{e.#e[i+h[78]]=o},()=>{e.#e[i+h[74]]=o},()=>{e.#e[i+h[71]]=o},()=>{e.#e[i+h[73]]=o},()=>{e.#e[i+h[75]]=o},()=>{e.#e[i+h[72]]=o}][l-16]():l<112||l<114&&[()=>{e.#e[i+h[5]]=o},()=>{e.#e[i+h[65]]=o}][l-112]()))})}).add([66,18,8,0],(t,a)=>{let c=t[0];if(c<32)e.setLetterDisplay(t.subarray(1,33),"NS5R letter display");else{let i=c-32;e.#C=Date.now()+3200,e.#b=10,e.#g.fill(0);let s=t.subarray(1),f=4;s.forEach(function(o,n){let l=n+i,y=l>>4,m=l&15;if(l<80){let w=y<f?o:o>>3,S=0,q=y<f?6:3;for(;w>0;)e.#g[m*32+y*7+(q-S)]=w&1,w=w>>1,S++}})}}).add([66,18,48],(t,a,c)=>{b(0,t)}).add([66,18,49],(t,a,c)=>{b(1,t)}).add([66,18,50],(t,a,c)=>{b(2,t)}).add([66,18,51],(t,a,c)=>{b(3,t)}).add([66,18,52],(t,a,c)=>{b(4,t)}).add([66,18,53],(t,a,c)=>{b(5,t)}).add([66,18,54],(t,a,c)=>{b(6,t)}).add([66,18,55],(t,a,c)=>{b(7,t)}).add([66,52],(t,a)=>{e.switchMode("ns5r",!0),e.#n=!1;let c="";M(t,(i,s)=>{s<8?(i>31&&(c+=String.fromCharCode(i)),s==7&&(e.aiEfxName=c)):s<10&&(e.setEffectType(s-8,44,i),e.dispatchEvent(`efx${["reverb","chorus"][s-8]}`,e.getEffectType(s-8)))})}).add([66,53],(t,a)=>{e.switchMode("ns5r",!0),e.#n=!1;let c="",i=t[t.length-1],s=t.subarray(0,t.length-1),f=D(s);f!=i&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${f}, got ${i}.`),console.debug(t)),M(s,function(o,n){switch(!0){case n<2944:{let l=e.chRedir(Math.floor(n/92),a,!0),y=l*u.cc;switch(n%92){case 0:{e.#e[y+h[0]]=o,e.dispatchEvent("voice",{part:l});break}case 1:{e.#e[y+h[32]]=o,!o&&!e.#e[y+h[0]]&&(e.#e[y+h[0]]=H.bank0),e.dispatchEvent("voice",{part:l});break}case 2:{e.#i[l]=o,o>0&&e.setChActive(l,1),e.dispatchEvent("voice",{part:l});break}case 3:{let m=e.chRedir(o,a,!0);e.#h[l]=m,l!=m&&(console.info(`NS5R CH${l+1} receives from CH${m+1}.`),e.buildRchTree());break}case 7:{e.#r[l]=o,e.dispatchEvent("voice",{part:l});break}case 8:{e.#a[l*u.rpn+3]=o<40||o>88?o+(o>63?-192:64):o,e.#s[u.rpnt*l+2]=1;break}case 9:case 10:{e.#e[y+h[7]]=o;break}case 11:{e.#e[y+h[11]]=o;break}case 14:{e.#e[y+h[10]]=o||128;break}case 19:{e.#e[y+h[93]]=o;break}case 20:{e.#e[y+h[91]]=o;break}case 84:{e.#e[y+h[65]]=o;break}case 85:{e.#e[y+h[5]]=o;break}}break}case n<3096:break;case n<3134:{let l=n-3096;l<8?(o>31&&(c+=String.fromCharCode(o)),l==7&&(e.aiEfxName=c)):l<10&&(e.setEffectType(l-8,44,o),e.dispatchEvent(`efx${["reverb","chorus"][l-8]}`,e.getEffectType(l-8)));break}case n<8566:break}})}).add([66,54],(t,a)=>{e.switchMode("ns5r",!0);let c="",i=80,s=0,f=0,o="MSB	PRG	LSB	NME";M(t,function(n,l){let y=l%158;switch(!0){case y<10:{n>31&&(c+=String.fromCharCode(n));break}case y==10:break;case y==11:{i=n&127;break}case y==12:{f=n&127;break}case y==13:{o+=`
${i}	${s}	${f}	${c.trim().replace("Init Voice","")}`,s++,c="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(o),v()&&console.debug(o),e.forceVoiceRefresh()}).add([66,55],(t,a)=>{e.switchMode("ns5r",!0);let c="",i=88,s=0,f=0,o="MSB	PRG	LSB	NME";M(t,function(n,l){let y=l%126;switch(!0){case y<10:{n>31&&(c+=String.fromCharCode(n));break}case y==11:break;case y==12:break;case y==13:{o+=`
${i}	${s}	${f}	${c.trim().replace("Init Combi","")}`,s++,c="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(o),v()&&console.debug(o),e.forceVoiceRefresh()}).add([66,125],t=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][t[0]]||"white")}).add([66,127],t=>{let a=t[t.length-1],c=t.subarray(0,t.length-1),i=D(c);i!=a&&(console.info(`NS5R screen dump checksum mismatch! Expected ${i}, got ${a}.`),console.debug(t));let s=new Uint8Array(5760);M(t,(f,o,n)=>{if(o<720)for(let l=0;l<8;l++)s[o*8+l]=f>>7-l&1}),e.dispatchEvent("screen",{type:"ns5r",data:s})}).add([76],(t,a,c)=>{e.#N.run([66,...t],a,c)}),this.#Y.add([16,0,8,0],(t,a,c)=>{let i=(t[2]<<4)+t[3],s="K11 ";([()=>{e.switchMode("k11",!0),e.#n=!1,e.#k=i?4:0,console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,i),console.debug(`${s}reverb type: ${i}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{console.debug(`${s}reverb time: ${i}`)},()=>{console.debug(`${s}reverb time: ${i}`)},()=>{console.debug(`${s}reverb predelay: ${i}`)},()=>{console.debug(`${s}reverb predelay: ${i}`)},()=>{console.debug(`${s}depth high: ${i}`)},()=>{console.debug(`${s}depth high: ${i}`)},()=>{console.debug(`${s}depth low: ${i}`)},()=>{console.debug(`${s}depth low: ${i}`)}][t[0]]||(()=>{}))()}).add([16,0,8,1],(t,a,c)=>{let i=e.chRedir(t[1],a,!0),s=u.cc*i,f=u.rpn*i,o=(t[3]<<4)+t[4],n=`K11 CH${i+1} `;([()=>{o<128?(e.setChType(i,e.CH_MELODIC,k.k11),e.#e[s+h[0]]=0,e.#i[i]=o):(e.setChType(i,e.CH_DRUMS,k.k11),e.#i[i]=o-128),e.dispatchEvent("voice",{part:i})},()=>{let l=e.chRedir(o,a,!0);e.#h[i]=l,i!=l&&(e.buildRchTree(),console.info(`${n}receives from CH${l+1}`))},()=>{e.#e[s+h[7]]=o},()=>{uupThis.setChActive(i,o)},()=>{e.#e[s+h[10]]=o},()=>{e.#a[f+3]=o+40,e.#s[u.rpnt*i+2]=1},()=>{e.#a[f+1]=o>>1,e.#a[f+2]=o&1,e.#s[u.rpnt*i+1]=1},()=>{e.#e[s+h[91]]=o?127:0},()=>{},()=>{e.#e[s+h[74]]=o},()=>{e.#e[s+h[73]]=o},()=>{e.#e[s+h[72]]=o}][t[0]]||(()=>{}))()}).add([16,0,9,0],(t,a,c)=>{let i=(t[2]<<4)+t[3],s="GMLX ";([()=>{console.debug(`${s}reverb type: ${i}`)},()=>{console.debug(`${s}reverb time: ${i}`)},()=>{console.debug(`${s}reverb predelay: ${i}`)},()=>{console.debug(`${s}depth high: ${i}`)},()=>{console.debug(`${s}depth low: ${i}`)}][t[0]]||(()=>{}))()}).add([16,0,9,3],(t,a,c)=>{let i=(t[2]<<4)+t[3],s=e.chRedir(t[1],a,!0),f=s*u.cc;[()=>{i<128?(e.setChType(s,e.CH_MELODIC,k.k11),e.#e[f+h[0]]=0,e.#e[f+h[32]]=0,e.#i[s]=i):i<160?(e.setChType(s,e.CH_MELODIC,k.k11),e.#e[f+h[0]]=0,e.#e[f+h[32]]=7,e.#i[s]=i-100):(e.setChType(s,e.CH_DRUMS,k.k11),e.#e[f+h[0]]=122,e.#e[f+h[32]]=0,e.#i[s]=i-160),e.dispatchEvent("voice",{part:s})},()=>{let o=e.chRedir(i,a,!0);e.#h[s]=o,s!=o&&(e.buildRchTree(),console.info(`GMLX CH${s+1} receives from CH${o+1}`))}][t[0]]()}).add([16,0,9,4],(t,a,c)=>{let i=(t[2]<<4)+t[3],s=e.chRedir(t[1],a,!0),f=s*u.cc,o=s*u.rpn,n=`GMLX CH${s+1} `;[()=>{e.setChActive(s,i)},()=>{e.#e[f+h[7]]=i},()=>{e.#e[f+h[10]]=i},()=>{e.#e[f+h[91]]=i?127:0},()=>{e.#a[o+3]=i+40,e.#s[u.rpnt*s+2]=1},()=>{e.#a[o+1]=i,e.#s[u.rpnt*s+1]=1},()=>{e.#a[o]=i,e.#s[u.rpnt*s]=1},()=>{}][t[0]]()}),this.#W.add([66,93,64],(t,a,c)=>{let i=t[2];switch(t[0]){case 0:{switch(t[1]){case 4:{e.#c=i*129/16383*100,e.dispatchEvent("mastervolume",e.#c);break}case 5:{i-64;break}case 6:{console.debug(`SG global reverb: ${i?"on":"off"}`);break}case 127:{e.switchMode("sg",!0);break}}break}case 1:{switch(t[1]){case 48:{console.debug(`SG reverb type: ${F[i]}`);break}}break}default:if(t[0]>>4==1){let s=e.chRedir(t[0]&15,a,!0);if(t[1]==2){let f=e.chRedir(i,a,!0);e.#h[s]=f,s!=f&&(e.buildRchTree(),console.info(`SG CH${s+1} receives from CH${f+1}`))}else t[1]==19&&(e.#e[u.cc*s+h[7]]=i)}else console.warn(`Unknown AKAI SG SysEx: ${t}`)}}),this.#j.add([9],(t,a,c)=>{console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremelo","phaser","rotary speaker","enhancer","flanger","EQ"][t[0]]||"off"}`)}),this.#w.add([127,0],(t,a,c)=>{e.switchMode("motif");let i=new Uint8Array([127,1,...t]);e.#w.run(i,a,c)}).add([127,1,0,0],(t,a,c)=>{e.switchMode("s90es");let i="S90/Motif ES system ",s=t[0];t.subarray(1).forEach((f,o)=>{([()=>{e.#c=f*12900/16383,e.dispatchEvent("mastervolume",e.#c)}][s+o]||(()=>{console.info(`Unrecognized ${i}ID: ${s+o}`)}))()})}).add([127,1,0,0,14],(t,a,c)=>{e.switchMode("s90es");let i="S90/Motif ES bulk header ",s=[];s[95]=(f,o,n)=>{console.debug(`${i}multi edit buffer: ${f[1]}`)},(s[t[0]]||(()=>{console.info(`Unrecognized ${i}ID: ${t[0]}.`)}))(t.subarray(1))}).add([127,1,0,0,15],(t,a,c)=>{e.switchMode("s90es");let i="S90/Motif ES bulk footer ",s=[];s[95]=(f,o,n)=>{console.debug(`${i}multi edit buffer: ${f[1]}`)},(s[t[0]]||(()=>{console.info(`Unrecognized ${i}ID: ${t[0]}.`)}))(t.subarray(1))}).add([127,1,0,58,55],(t,a,c)=>{e.switchMode("s90es");let i=e.chRedir(t[0],a,!0),s=u.cc*i,f=t[1],o=`S90/Motif ES bulk CH${i<16?i+1:"U"+(i-95)} `;console.debug(o,t),!(t[0]>15)&&t.subarray(2).forEach((n,l)=>{([()=>{e.#e[s+h[0]]=n,e.dispatchEvent("voice",{part:i})},()=>{n&&e.setChActive(i,1),e.#e[s+h[32]]=n,e.setChType(i,[32,40].indexOf(n)>-1?e.CH_DRUMS:e.CH_MELODIC,e.#t,!0),e.dispatchEvent("voice",{part:i})},()=>{n&&e.setChActive(i,1),e.#i[i]=n,e.dispatchEvent("voice",{part:i})},()=>{let y=e.chRedir(n,a,!0);e.#h[i]=y,i!=y&&(e.buildRchTree(),console.info(`${o}receives from CH${y+1}`))},()=>{e.#E[i]=n?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{e.#e[s+h[7]]=n},()=>{e.#e[s+h[10]]=n},!1,!1,!1,()=>{e.#e[s+h[91]]=n},()=>{e.#e[s+h[93]]=n},()=>{e.#e[s+h[94]]=n},()=>{e.#e[s+h[128]]=n},()=>{},()=>{e.#e[s+h[74]]=n},()=>{e.#e[s+h[71]]=n},!1,()=>{e.#e[s+h[65]]=n},()=>{e.#e[s+h[5]]=n},()=>{}][f+l]||(()=>{}))()})}).add([127,1,54,16],(t,a,c)=>{e.switchMode("s90es");let i=t[0];t.subarray(1).forEach((s,f)=>{let n=`S90/Motif ES EQ${(f>>2)+1} `;([()=>{let l=s-64},()=>{let l=L[s]},()=>{let l=s/10},()=>{let l=s}][i+f&3]||(()=>{}))()})}),this.#v.add([0,72,18,0,0,0,0],(t,a,c)=>{e.switchMode("sd",!0),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(t,a,c)=>{let i=t[0]>>5,s=t[0]&31;switch(i){case 0:{let f=t[0]>>1,o=t[1];switch(f){case 1:{t.subarray(2).forEach((n,l,y)=>{let m=l+o;switch(m){case 0:{n&&(e.setEffectType(1,60,n-1),e.dispatchEvent("efxchorus",e.getEffectType(1)),console.debug(`SD MFX Cho: ${m} - ${n}`));break}}});break}case 2:{t.subarray(2).forEach((n,l)=>{let y=l+o;switch(y){case 0:{n&&(e.setEffectType(0,55+n,0),e.dispatchEvent("efxreverb",e.getEffectType(0)),console.debug(`SD MFX Rev: ${y} - ${n}`));break}}});break}case 3:case 4:case 5:{let n=f-1;t.subarray(2).forEach((l,y)=>{let m=y+o;switch(console.debug(`SD MFX ${n-2}: ${m} - ${l}`),m){case 0:{e.setEffectTypeRaw(n,62,l),e.dispatchEvent(`efx${n>2?"delay":"insert"+(n-4)}`,e.getEffectType(n));break}}}),console.debug(`SD MFX message:
%o`,t);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,t)}break}case 1:{let f=e.chRedir(s,a,!0),o=t[1],n=f*u.cc;t.subarray(2).forEach((l,y)=>{let m=o+y;m<37?([()=>{},()=>{},0,()=>{},()=>{switch(e.#e[n+h[0]]=l,l){case 104:case 105:case 106:case 107:case 120:{e.#r[f]||e.setChType(f,e.CH_DRUMS);break}default:e.#r[f]&&e.setChType(f,e.CH_MELODIC)}e.dispatchEvent("voice",{part:f})},()=>{e.#e[n+h[32]]=l,e.dispatchEvent("voice",{part:f})},()=>{e.#i[f]=l,e.dispatchEvent("voice",{part:f})},()=>{e.#e[n+h[7]]=l},()=>{e.#e[n+h[10]]=l},()=>{},()=>{},()=>{l<2&&(e.#E[f]=l)},()=>{l<2&&(e.#e[n+h[68]]=l?127:0)},()=>{},()=>{l<2&&(e.#e[n+h[65]]=l?127:0)},()=>{e.#e[n+h[5]]=l&15<<4|e.#e[n+h[5]]&15},()=>{e.#e[n+h[5]]=l&15|(e.#e[n+h[5]]&240)>>4},()=>{e.#e[n+h[74]]=l},()=>{e.#e[n+h[71]]=l},()=>{e.#e[n+h[73]]=l},()=>{e.#e[n+h[72]]=l},0,0,0,0,0,0,0,()=>{e.#e[n+h[128]]=l},()=>{e.#e[n+h[93]]=l},()=>{e.#e[n+h[91]]=l},0,0,()=>{e.#e[n+h[75]]=l},()=>{e.#e[n+h[76]]=l},()=>{e.#e[n+h[77]]=l},()=>{e.#e[n+h[78]]=l}][m]||(()=>{}))():m<63||(m<64?(e.#r[f]?e.#e[n+h[0]]=104|l:e.#e[n+h[0]]=96|l,e.dispatchEvent("voice",{part:f})):console.debug(`Unknown SD-90 global CH${f+1} param setup message:
%o`,t))});break}case 2:{let f=e.chRedir(s,a,!0),o=t[1];console.debug(`Unknown SD-90 global CH${f+1} MIDI setup message:
%o`,t.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,t)}})}};export{Je as OctaviaDevice,u as allocated,h as ccToPos,T as dnToPos};
