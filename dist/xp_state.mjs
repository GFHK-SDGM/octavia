var Qt=Object.defineProperty;var Yt=(y,e,r)=>e in y?Qt(y,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):y[e]=r;var T=(y,e,r)=>(Yt(y,typeof e!="symbol"?e+"":e,r),r),vt=(y,e,r)=>{if(!e.has(y))throw TypeError("Cannot "+r)};var t=(y,e,r)=>(vt(y,e,"read from private field"),r?r.call(y):e.get(y)),C=(y,e,r)=>{if(e.has(y))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(y):e.set(y,r)},x=(y,e,r,h)=>(vt(y,e,"write to private field"),h?h.call(y,r):e.set(y,r),r);(function(){var y=function(k,S,a){var c,f;if(self.MessageEvent)switch(k){case"message":{f=new MessageEvent(k,{data:S,ports:a==null?void 0:a.ports}),Object.defineProperty(f,"source",{value:a==null?void 0:a.source});break}default:f=new Event(k)}else f=document.createEvent("Event"),f.initEvent(k,!1,!1),a&&k=="message"&&(f.data=S,a.source&&Object.defineProperty(f,"source",{value:a.source}),(c=a.ports)!=null&&c.length&&Object.defineProperty(f,"ports",{value:a.ports}));return f};self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),r=[],h={},u=function(k){var S,a=this;if((this==null?void 0:this.constructor)!=u)throw new TypeError("Illegal constructor");r.push(this),(S=h[k])!=null&&S.constructor||(h[k]=[]),h[k].push(this);var c=Math.floor(Math.random()*281474976710656),f=[],s=0,i=[],o=!0,n=!1;Object.defineProperty(this,"id",{get:function(){return c}}),Object.defineProperty(this,"name",{value:k}),this.close=function(){var l,m=r.indexOf(a);m>-1?(e.postMessage({t:"d",c:k,i:c}),r.splice(m,1),(l=h[k])!=null&&l.constructor&&(m=h[k].indexOf(a),m>-1&&h[k].splice(m,1)),h[k].length||delete h[k],console.debug("[Snowy] BroadcastChannel closed."),n=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(l){if(e){if(n)throw new Error("Channel already closed");e.postMessage({t:"m",c:k,i:c,m:s,d:l}),s++,s>4294967295&&(s=0)}else i.push(l),console.debug("[Snowy] Message is cached.")},this.flush=function(){if(e){if(o){for(e.postMessage({t:"r",c:k,i:c}),console.debug("[Snowy] ".concat(i.length," message(s) in cache."));i.length;){var l=i.shift();a.postMessage(l)}o=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(l){l.c==k?l.i!=c&&a.dispatchEvent(y("message",l.d,{source:a})):console.debug("[Snowy] Channel ID mismatch. Instance ".concat(c," receives from ").concat(k,", not ").concat(l.c,"."))};var d={};this.dispatchEvent=function(l){var m,$;if(Object.defineProperty(l,"target",{value:a}),Object.defineProperty(l,"currentTarget",{value:a}),(m=d[l.type])!=null&&m.length)for(var M=d[l.type],U=0;U<M.length;U++)(($=M[U])==null?void 0:$.constructor)==Function&&M[U].call(a,l);a["on".concat(l.type)]&&a["on".concat(l.type)].constructor==Function&&a["on".concat(l.type)].call(a,l)},this.addEventListener=function(l,m){var $;($=d[l])!=null&&$.constructor||(d[l]=[]);var M=d[l].indexOf(m);M==-1&&d[l].push(m)},this.removeEventListener=function(l,m){var $,M;if(($=d[l])!=null&&$.length){var U=d[l].indexOf(m);U>-1&&d[l].splice(U,1)}!((M=d[l])!=null&&M.length)&&d[l].constructor&&delete d[l]}},self.BroadcastChannel=u,E=function(){if(e){e.addEventListener("message",function(S){var a=S.data,c=!1;switch(a.t){case"k":{c=!1,e.postMessage({t:"k"});break}case"m":{var f=h[a.c];if(f!=null&&f.length)for(var s=0;s<f.length;s++)f[s].receiveMessage(a);break}case"c":{for(var i=[],o=0;o<r.length;o++){var n=r[o].name;i.indexOf(n)<0&&i.push(n)}e.postMessage({t:"k",c:i});break}default:c=!0}c&&console.info("ReceiveBroadcast",a)});for(var k=0;k<r.length;k++)r[k].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},v=function(){if(!e){var k=new SharedWorker(self.SNOWY_PATH||"/snowy.js");k.port.start();var S=function(a){a.data.t=="swc"&&(k.port.removeEventListener("message",S),e=k.port,e.postMessage({t:"k"}),E())};k.port.addEventListener("message",S)}},v());var e,r,h,u,E,v})();{let y=function(e,r){let h=new FileReader;return new Promise((u,E)=>{switch(h.addEventListener("abort",()=>{E(new Error("Blob read aborted"))}),h.addEventListener("error",v=>{E(h.error||v.data||new Error("Blob read error"))}),h.addEventListener("load",()=>{u(h.result)}),r.toLowerCase()){case"arraybuffer":case"buffer":{h.readAsArrayBuffer(e);break}case"string":case"text":{h.readAsText(e);break}default:E(new Error(`Unknown target ${r}`))}})};Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||function(){return y(this,"buffer")},Blob.prototype.text=Blob.prototype.text||function(){return y(this,"text")}}String.prototype.replaceAll=String.prototype.replaceAll||function(y,e){let r=0,h=16,u=this,E=[];for(;r<h&&u.lastIndexOf(y)>-1;){let v=u.lastIndexOf(y);E.unshift(u.slice(v+y.length)),u=u.slice(0,v),v==0&&E.unshift(""),r++}return u.length&&E.unshift(u),E.join(e)||""},String.prototype.padStart=String.prototype.padStart||function(y,e){if(e){let r=this;for(;r.length<y;)r=`${e}${r}`;return r}},String.prototype.padEnd=String.prototype.padEnd||function(y,e){if(e){let r=this;for(;r.length<y;)r+=e;return r}};var wt=function(y,e){let r=Math.min(y.length,e.length),h=y.slice(0,r),u=e.slice(0,r),E=0,v=0;for(;v<r&&E==0;)E=Math.sign(h[v]-u[v]),v++;return E},oe=function(y=""){this.name=y,this.pool=[],this.point=function(e,r=!1){if(this.pool.length>0){let h=this.pool.length,u=1<<Math.floor(Math.log2(h)),E=u,v=64;for(;u>=1&&v>=0;){if(v<=0)throw new Error("TTL reached.");if(E==h)E-=u;else{let S=wt(e,this.pool[E]);switch(S){case 0:{v=0;break}case 1:{E+u<=h&&(E+=u);break}case-1:{E!=0&&(E-=u);break}default:console.warn(`Unexpected result ${S}.`)}}u=u>>1,v--}let k=!0;if(E>=this.pool.length)k=!1;else{let S=this;this.pool[E].forEach(function(a,c,f){k&&a!=e[c]&&(k=!1)}),!k&&wt(e,this.pool[E])>0&&E++}return k||r?E:-1}else return r?0:-1},this.add=function(e,r){return e.data=r,this.pool.splice(this.point(e,!0),0,e),this},this.default=function(e){console.warn(`No match in "${this.name||"(unknown)"}" for "${e}". Default action not defined.`)},this.get=function(e){let r=this.point(e);if(r>-1)return this.pool[r].data;this.default(e)},this.run=function(e,...r){let h=this.point(e);h>-1?e.subarray?this.pool[h].data(e.subarray(this.pool[h].length),...r):this.pool[h].data(e.slice(this.pool[h].length),...r):this.default(e,...r)}};var j,kt,St=(kt=class{constructor(){C(this,j,{})}addEventListener(y,e){t(this,j)[y]||(t(this,j)[y]=[]),t(this,j)[y].unshift(e)}removeEventListener(y,e){if(t(this,j)[y]){let r=t(this,j)[y].indexOf(e);r>-1&&t(this,j)[y].splice(r,1),t(this,j)[y].length<1&&delete t(this,j)[y]}}dispatchEvent(y,e){var u;let r=new Event(y),h=this;r.data=e,((u=t(this,j)[y])==null?void 0:u.length)>0&&t(this,j)[y].forEach(function(E){try{E==null||E.call(h,r)}catch(v){console.error(v)}}),this[`on${y}`]&&this[`on${y}`](r)}},j=new WeakMap,kt);var jt=["MSB","PRG","LSB","NME","ELC","DRM"],ht=function(y){let e=Math.floor(y/10),r=y%10;return`${e.toString(16)}${r}`},Q,xt,ut=(xt=class{constructor(...y){C(this,Q,void 0);T(this,"strictMode",!1);this.loadFiles(...y)}get(y=0,e=0,r=0,h){var l,m;let u=[y,e,r],E,v=1,k=0,S,a=Array.from(arguments);switch(h){case"xg":{switch(y){case 0:{r==126?a[2]=125:r==127&&(a[2]=0);break}case 16:{r==126&&(a[2]=0);break}case 32:{r>125&&(a[2]=0),a[2]+=4;break}case 33:case 34:case 35:case 36:{r>125&&(a[2]=0),a[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:a[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{r==126&&(a[2]=0);break}case 48:case 64:case 126:case 127:{r==126&&(a[2]=0);break}}break}case"gs":case"sc":{y==0&&r<5?a[2]=0:y>125&&r<5&&r!=2&&(a[2]=y,a[0]=0);break}case"g2":case"sd":{y>>1==40?a[2]|=16:y>95&&y<100&&(a[2]|=16,e>>4==7&&(a[0]=96));break}case"sg":{y==8&&r==0&&(a[2]=5);break}case"s90es":{r<8?a[2]+=17:r<32?a[2]+=13:a[2]=(a[2]>>3)+19;break}case"motif":{r<8?a[2]+=28:r<32?a[2]+=13:a[2]=(a[2]>>3)+19;break}}let c=" ",f="M",s=0,i=0;switch(a[0]){case 0:{a[2]==127?f="MT-a":a[2]==126?f="MT-b":a[2]==7?f="GM-k":a[2]==5?f="SG-a":a[2]==4?f="SP-l":a[2]==0||(h=="gs"||h=="sc")&&a[2]<5?f="GM-a":(f="y",s=3);break}case 8:{h=="sg"?f="GM-s":f="r:";break}case 32:case 33:case 34:case 35:case 36:{h=="xg"&&(f=`${["AP","VL","PF","DX","AN"][y&7]}-${"abcdefgh"[r]}`);break}case 48:{f=`yM${(a[2]>>3).toString().padStart(2,"0")}`,s=1;break}case 56:{f="GM-b";break}case 57:f=["yDOC","QY10","QY20"][a[2]-112]||"yMxv";case 61:case 120:{f="rDrm";break}case 62:{f="kDrm";break}case 63:{if(a[2]<17){let $=a[2];f=$<10?"kP:":"kC:",f+=$%10}else a[2]<34?f=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][a[2]-17]:f="Ds";break}case 64:{f="ySFX";break}case 67:{f="DX:S";break}case 80:case 81:case 82:case 83:{f=`Prg${"UABC"[a[0]-80]}`;break}case 88:case 89:case 90:case 91:{f=`Cmb${"UABC"[a[0]-88]}`;break}case 95:{f=`${["DR","PC"][a[2]]}-d`;break}case 96:{f=a[2]==106?"AP-a":a[2]>>4==1?"SDg":"PF",a[2]>63?i=63:a[2]>>4==1&&(i=16),s=3;break}case 97:{f=a[2]>>4==1?"SDa":"VL:",s=3,a[2]>>4==1?i=16:i=112;break}case 98:{f=a[2]>>4==1?"SDb":"SG-a",s=3,i=16;break}case 99:{f=a[2]>>4==1?"SDc":"DX",a[2]>63?i=63:a[2]>>4==1&&(i=16),s=3;break}case 100:{f="AN",a[2]>63?i=63:a[2]>>4==1&&(i=16),s=3;break}case 104:case 105:case 106:case 107:{f="SDd",i=104;break}case 121:{f=`GM-${a[2]?"":"a"}`,s=3;break}case 122:{f="lDrm";break}case 126:{f="yDrS";break}case 127:{a[2]==127?f="rDrm":f="yDrm";break}default:a[0]<48?f="r:":f="M"}f.length<4&&(f+=`${[y,r,a[0],a[2]][s]-i}`.padStart(4-f.length,"0")),h=="xg"&&(y==0?a[2]<100?f=f.replace("y0","y:"):a[2]==125&&(f="y126"):y==16?(E=`Voice${((a[2]<<7)+a[1]+1).toString().padStart(3,"0")}`,c=" "):y==35&&r>>1==2&&(E=`DXCH_${(((a[2]&1)<<7)+e+1).toString().padStart(3,"0")}`,c=" "));let o=[a[0],a[1],a[2]];for(;!((E==null?void 0:E.length)>=0);)if(E=(l=t(this,Q)[a[1]||0][(a[0]<<7)+a[2]])==null?void 0:l.name,E){let $=t(this,Q)[a[1]||0][(a[0]<<7)+a[2]];v=($==null?void 0:$.poly)||v,k=($==null?void 0:$.type)||k,S=$==null?void 0:$.drum}else if(this.strictMode)E="",c="?";else if(a[0]==0&&a[1]==0&&a[2]==0)E="Unloaded";else if(t(this,Q)[a[1]||0][a[0]<<7])a[0]==0?(a[2]=0,c="^"):a[2]<1?(a[0]=0,c="*"):(a[2]--,c="^");else if(y==48)a[0]=0,a[2]=0,c="!";else if(y==62)a[1]--,c=" ",a[1]<1&&!(E!=null&&E.length)&&(a[0]=0,c="!");else if(y<63)a[0]==0?(a[2]=0,c="^"):a[2]<1?(a[0]=0,c="*"):a[2]--;else if(y==80)E=`PrgU:${e.toString().padStart(3,"0")}`,c="!";else if(y==88)E=`CmbU:${e.toString().padStart(3,"0")}`,c="!";else if(y==121)E=`GM2Vox0${r}`,c="#";else if(y==122)if(a[1]==32?a[1]==0:a[1]%=7,E=(m=t(this,Q)[a[1]||0][(a[0]<<7)+a[2]])==null?void 0:m.name,E){c=" ";let $=t(this,Q)[a[1]||0][(a[0]<<7)+a[2]];v=($==null?void 0:$.poly)||v,k=($==null?void 0:$.type)||k,S=$==null?void 0:$.drum}else E="",c="*";else a[1]==0?(E=`${y.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")} ${r.toString().padStart(3,"0")}`,c="!"):a[0]==0?(a[2]=0,c="^"):a[2]>0?a[2]--:a[1]>0?(a[1]=0,c="!"):(a[0]=0,c="?");let n=[a[0],a[1],a[2]];(h=="gs"||h=="sc"||h=="ns5r")&&c=="^"&&(c=" "),y==127&&c=="^"&&(c=" "),c!=" "&&self.debugMode&&(E="");let d="??";switch(a[0]){case 0:{a[2]==0?d="GM":a[2]==5||a[2]==7?d="KG":a[2]<126?d="XG":a[2]==127&&(d="MT");break}case 32:case 33:case 35:case 36:{a[2]>4?d=["AP","VL","PF","DX","AN"][a[0]-32]:d="GS";break}case 48:{d="MU";break}case 56:{d="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{d="AI";break}case 62:case 82:case 90:{d="XD";break}case 63:{a[2]<17?d="KR":a[2]<34?d="ES":d="DS";break}case 64:case 126:{d="XG";break}case 67:case 99:{d=a[2]>>4==1?"SD":"DX";break}case 81:{d="RW";break}case 95:{d=["DR","PC"][a[2]];break}case 96:{d=a[2]==106?"AP":a[2]>>4==1?"SD":"PF";break}case 97:{d=a[2]>>4==1?"SD":"VL";break}case 98:{d=a[2]>>4==1?"SD":"SG";break}case 100:{d="AN";break}case 104:case 105:case 106:case 107:{d="SD";break}case 120:{d="GS";break}case 121:{d=a[2]?"G2":"GM";break}case 122:{d="KG";break}case 127:{d=a[2]==127?"MT":e==0?"GM":"XG";break}default:a[0]<48&&(a[0]==16&&h=="xg"?d="XG":d="GS")}return{name:E||`${ht(y||0)} ${ht(e||0)} ${ht(r||0)}`,poly:v,type:k,drum:S,iid:o,eid:n,sid:u,ending:c,sect:f,standard:d}}async load(y,e,r="(internal)"){let h=this,u=[],E=0,v=0;y.split(`
`).forEach(function(k,S){let a=k.split("	"),c=[];if(S==0){if(a.forEach(function(f,s){u[jt.indexOf(f)]=s}),u.length<4){console.debug("Debugger launched.");debugger}}else{let f=0,s=0,i=0,o,n=1,d=0,l;a.forEach(async function($,M){switch(M){case u[0]:{f=parseInt($);break}case u[1]:{s=parseInt($);break}case u[2]:{i=parseInt($);break}case u[3]:{o=$;break}case u[4]:{$=parseInt($),$<16?n=$+1:d=($&15)+1;break}case u[5]:{l=$;break}}}),t(h,Q)[s]=t(h,Q)[s]||[];let m=t(h,Q)[s];if(!m[f<<7|i]||e){let $={msb:f,prg:s,lsb:i,name:o,poly:n,type:d,drum:l};m[f<<7|i]=$,E++}v++}}),e||console.debug(`Map "${r}": ${v} total, ${E} loaded.`)}clearRange(y){let e=y.prg!=null?y.prg.constructor==Array?y.prg:[y.prg,y.prg]:[0,127],r=y.msb!=null?y.msb.constructor==Array?y.msb:[y.msb,y.msb]:[0,127],h=y.lsb!=null?y.lsb.constructor==Array?y.lsb:[y.lsb,y.lsb]:[0,127];for(let u=r[0];u<=r[1];u++){let E=u<<7;for(let v=h[0];v<=h[1];v++){let k=E+v;for(let S=e[0];S<=e[1];S++)delete t(this,Q)[S][k]}}}init(){x(this,Q,[]);for(let y=0;y<128;y++)t(this,Q).push([""])}async loadFiles(...y){this.init();let e=this;y.forEach(async function(r){try{await fetch(`./data/bank/${r}.tsv`).then(function(h){return h.text()}).then(h=>{e.load(h,!1,r)})}catch(h){console.error(`Failed loading "${r}.tsv".`)}})}},Q=new WeakMap,xt);var Xe,Ct,Mt=(Ct=class{constructor(){C(this,Xe,{});T(this,"context")}set(y,e){t(this,Xe)[y]=e}has(y){return!!t(this,Xe)[y]}async read(y,e){if(!this.has(y))throw new Error(`No decoder registered for "${y}"`);return await t(this,Xe)[y].call(this.context||this,e)}},Xe=new WeakMap,Ct);var Jt=function(y,e){let r=!0;return e.forEach((h,u)=>{r=r&&y[u]==h}),r},je=function(y){let e=0;return y.forEach(r=>{e*=256,e+=r}),e},Ee=new TextDecoder,Je=new Mt;Je.set("s7e",async function(y){let e=new Uint8Array(await y.slice(0,65536).arrayBuffer()),r="MSB	LSB	PRG	NME",h=[0,0,0,0],u=32,E=0,v=0,k=!0,S=[],a=0;for(;k;){let c=e.subarray(E);([()=>{Ee.decode(c.subarray(0,4))=="YSFC"?(E+=80,v=1):E++},()=>{if(Jt(c.subarray(0,4),h))S.forEach((f,s,i)=>{let o=je(e.subarray(f.start+4,f.start+8));f.length=o}),v=2;else{let f=Ee.decode(c.subarray(0,4)),s=je(c.subarray(4,8));S.push({type:f,start:s}),E+=8}},()=>{let f=S[a],s=e.subarray(f.start,f.start+f.length),i=32;switch(f.type){case"ENVC":{let o=u;for(;o<s.length;){let n=s.subarray(o,o+i),d=Ee.decode(n.subarray(0,10)).trimEnd();d.slice(0,5)=="Init "&&(d=""),d&&(r+=`
063	${(n[17]+13).toString().padStart(3,"0")}	${n[19].toString().padStart(3,"0")}	${d}`),o+=i}break}case"EDVC":{let o=u;for(;o<s.length;){let n=s.subarray(o,o+i),d=Ee.decode(n.subarray(0,10)).trimEnd();d.slice(0,5)=="Init "&&(d=""),d&&(r+=`
063	024	${n[19].toString().padStart(3,"0")}	${d}`),o+=i}break}case"EPVC":{let o=32,n=u;for(;n<s.length;){let d=s.subarray(n,n+o),l=Ee.decode(d.subarray(0,10)).trimEnd();l=="----------"&&(l=""),l&&(r+=`
063	${(d[17]+1).toString().padStart(3,"0")}	${d[19].toString().padStart(3,"0")}	${l}`),n+=o}break}}a++,a>=S.length&&(v=3,k=!1)}][v]||(()=>{k=!1}))()}return r});Je.set("pcg",async function(y){let e=new Uint8Array(await y.arrayBuffer()),r="MSB	LSB	PRG	NME",h=100,u=0,E=0,v=!0,k=[],S=0;for(;v;){let a=e.subarray(h);([()=>{v=Ee.decode(a.subarray(0,4))=="INI2",E=a[15],h+=16,u=1},()=>{let c=Ee.decode(a.subarray(0,4)),f=a[5],s=a[7],i=a[11],o=je(a.subarray(12,16)),n=je(a.subarray(16,20)),d=je(a.subarray(36,40)),l=Ee.decode(a.subarray(44,44+i));k.push({type:c,tipMsb:f,tipLsb:s,nameLen:i,length:o,start:n,entryLen:d,name:l}),h+=64,E--,E<1&&(u=2)},()=>{let c=k[S],f=e.subarray(c.start,c.start+c.length);switch(c.type){case"PRG1":break;case"PBK1":{let s=63,i=(c.tipMsb?6:0)+c.tipLsb;for(let o=0;o<128;o++){let n=o*c.entryLen,d=f.subarray(n,n+c.entryLen),l=Ee.decode(d.subarray(0,24)).trimEnd().replace("InitProg","");l.length&&i>5&&(r+=`
${s.toString().padStart(3,"0")}	${i.toString().padStart(3,"0")}	${o.toString().padStart(3,"0")}	${l}`)}break}case"CBK1":{let s=63,i=(c.tipMsb?3:0)+c.tipLsb+10;for(let o=0;o<128;o++){let n=o*c.entryLen,d=f.subarray(n,n+c.entryLen),l=Ee.decode(d.subarray(0,24)).trimEnd().replace("InitCombi","");l.length&&i>12&&(r+=`
${s.toString().padStart(3,"0")}	${i.toString().padStart(3,"0")}	${o.toString().padStart(3,"0")}	${l}`)}break}}S++,S>=k.length&&(u=3,v=!1)}][u]||(()=>{v=!1}))()}return r});var Ze=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),et=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],Zt=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],Ve=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],Tt=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],Rt=function(y){let e=.1,r=-.3;return y>66?(e=5,r=315):y>56?(e=1,r=47):y>46&&(e=.5,r=18.5),e*y-r},Dt=function(y){return y>105?Zt[y-106]:y>100?y*1.1-100:y/10},Pt=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),pt={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,うぃ
we,うぇ
wo,を
nga,ガ
ngi,ギ
ngu,グ
nge,ゲ
ngo,ゴ
ngy,ギ!
ng,
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,いぇ
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(y=>{let e=y.split(",");pt[e[0]]=e[1]});var Ot=function(y){let e=y;y[0]=="*"&&(e=e.slice(1)),["aa","ii","uu","ee","oo"].forEach(h=>{for(;e.indexOf(h)>-1;)e=e.replace(h,h[0])});for(let h in pt)e=e.replaceAll(h,pt[h]);e.indexOf("ん")==0&&e.length>1&&(e=e.slice(1));let r=e.indexOf("!");return r>-1&&e.length>1&&(e=e.slice(r+1)),e},At=function(y){return y?y<96?`cc${y}`:["aftertouch","velocity","pitch bend"][y-96]:"off"};var bt=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],Lt=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],Ut=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var ea={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},ta={66307:["drive"],66309:["vowel",y=>"aiueo"[y]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",y=>["off","LPF","HPF"][y]],94984:["noise type",y=>["white","pink"][y]],94987:["disc type",y=>["LP","SP","EP","RND"]],94990:["hum type",y=>`${y+5}0Hz`],94993:["M/S",y=>["mono","stereo"][y]]},gt=function(y){return ea[(y[0]-32<<8)+y[1]]||`0x${y[0].toString(16).padStart(2,"0")}${y[1].toString(16).padStart(2,"0")}`},Bt=function(y,e,r){let h=(y[0]-32<<16)+(y[1]<<8)+e,u=ta[h]||{},E=u[0];if(E!=null&&E.length)return E+=`: ${(u[1]||function(){})(r)||r}`,E},Et=[68,48,95,78,41,3,110,122,0];var J=function(y=64){return Math.round(2e3*Math.log10(y/64))/100};var xe=function(y){let e=0;return y.forEach(r=>{e+=r,e=e&127}),~e+1&127},le=function(y,e){let r=0,h=0;for(let u=0;u<y.length;u++){let E=u%8-1,v=(h>>E&1)<<7,k=y[u];k+=v,u%8!=0?(e(k,r,y),r++):h=y[u]}};var tt=function(y){let e=Math.floor(y*14.2);return e<128?e:0},P=function(){return!!self.Bun||self.debugMode||!1};var K=["?","gm","gs","sc","xg","g2","mt32","doc","qy10","qy20","ns5r","x5d","05rw","k11","sg","sd","krs","s90es","motif","trin"],aa={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es",trinity:"trin","tr-rack":"trin"},ra=["melodic","drum","menu"],Ht={"?":[0,0,120],gm:[0,0,127],gs:[0,0,120],sc:[0,0,120],xg:[0,0,127],g2:[0,0,120],mt32:[0,127,127],doc:[57,112,127],qy10:[57,113,127],qy20:[57,114,127],ns5r:[0,0,61],x5d:[82,0,62],"05rw":[81,0,62],k11:[0,0,122],sg:[0,0,122],sd:[97,0,105],krs:[63,0,120],s90es:[63,0,127],motif:[63,0,127],trin:[63,0,127]};var yt=[120,127,120,127,120,127,127,61,62,62,122,122,105,120,127,127,127],Nt=[9,25,41,57,73,89,105,121],sa=[0,3,81,84,88],It={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},_t={0:0,1:1,2:3,5:4},Gt={0:0,1:1,2:2,5:3},Xt=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],Vt=[36,37,48,49,52,53],ft=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],Ft={26:127,29:0,30:0,31:0,52:12,53:54},at=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,128,12,13,16,17,18,19,14,15,20,21,26,28,80,81,83,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],ia=[2,12,13,14,15,16,17,18,19,20,21,80,81,83,136,130,131,132,133,134,135,137,138,139,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],ca=[33,99,100,32,102,8,9,10],Kt=[0,16,25,40,32,64,26,48],w={};K.forEach((y,e)=>{w[y]=e});var b={length:at.length};at.forEach((y,e)=>{b[y]=e});var de={length:ft.length};ft.forEach((y,e)=>{de[y]=e});var na={};ra.forEach((y,e)=>{na[y]=e});var oa=function(y){let e=[],r=0;return y==null||y.forEach(function(h,u){h==247?e.push(y.subarray(r,u)):h==240&&(r=u+1)}),e.length||e.push(y.subarray(0)),P()&&console.debug(e),e};var zt=8,g={port:zt,ch:zt<<4,cc:at.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,ace:8,drm:8,dpn:ft.length,dnc:128,ext:3,efx:7,cvn:12,redir:32,invalidCh:255},Fe={bank0:128},O,W,fe,we,se,ve,qt,ie,G,D,p,ce,A,X,Z,V,z,ke,ye,Oe,ee,R,L,Ke,Y,he,te,ze,Ae,I,Ce,ue,rt,Me,pe,We,Te,F,B,me,st,H,Le,qe,Qe,Re,De,it,Ye,be,N,lt,ct,Ue,mt,ae,Se,Pe,q,Be,_,nt,dt,He,Ne,re,ne,$e,Ie,_e,Ge,Wt,qa=(Wt=class extends St{constructor(){super();C(this,se);T(this,"NOTE_IDLE",0);T(this,"NOTE_ATTACK",1);T(this,"NOTE_DECAY",2);T(this,"NOTE_SUSTAIN",3);T(this,"NOTE_HELD",4);T(this,"NOTE_RELEASE",5);T(this,"NOTE_SOSTENUTO_ATTACK",8);T(this,"NOTE_SOSTENUTO_DECAY",9);T(this,"NOTE_SOSTENUTO_SUSTAIN",10);T(this,"NOTE_SOSTENUTO_HELD",11);T(this,"CH_MELODIC",0);T(this,"CH_DRUMS",1);T(this,"CH_DRUM1",2);T(this,"CH_DRUM2",3);T(this,"CH_DRUM3",4);T(this,"CH_DRUM4",5);T(this,"CH_DRUM5",6);T(this,"CH_DRUM6",7);T(this,"CH_DRUM7",8);T(this,"CH_DRUM8",9);T(this,"DUMP_ALL",0);T(this,"DUMP_ONCE",1);T(this,"DUMP_MODE",2);T(this,"EXT_NONE",0);T(this,"EXT_VL",1);T(this,"EXT_DX",3);T(this,"VLBC_BRTHEXPR",1);T(this,"VLBC_VELOINIT",2);T(this,"VLBC_VELOALL",3);T(this,"CH_INACTIVE",0);T(this,"CH_ACTIVE",1);T(this,"CH_DISABLED",2);C(this,O,0);C(this,W,0);C(this,fe,0);C(this,we,new Array(11));C(this,ie,new Uint8Array(g.ch));C(this,G,new Uint8Array(g.ch));C(this,D,new Uint8Array(g.ch));C(this,p,new Uint8Array(g.ch*g.cc));C(this,ce,new Uint8Array(g.ace));C(this,A,new Uint8Array(g.ch));C(this,X,new Uint8Array(g.ch*g.nn));C(this,Z,new Uint8Array(g.ch));C(this,V,new Uint16Array(g.pl));C(this,z,new Uint8Array(g.pl));C(this,ke,new Int16Array(g.ch));C(this,ye,new Uint8Array(g.ch));C(this,Oe,0);C(this,ee,new Uint8Array(g.ch*g.ext));C(this,R,new Uint8Array(g.ch*g.rpn));C(this,L,new Uint8Array(g.ch*g.rpnt));C(this,Ke,new Int8Array(g.ch*Vt.length));C(this,Y,new Uint8Array(g.drm*g.dpn*g.dnc));C(this,he,new Uint8Array(g.drm*2));C(this,te,new Uint8Array(g.efx*3));C(this,ze,new Uint8Array(g.ch));C(this,Ae,new Uint8Array(g.ch*g.redir));C(this,I,new Uint8Array(g.port));C(this,Ce,new Uint8Array(g.ch));C(this,ue,new Uint8Array(g.ch));C(this,rt,new Uint8Array(g.ch*g.cvn));C(this,Me,new Uint8Array(128));C(this,pe,new Uint8Array(g.cmt*8));C(this,We,new Uint8Array(1024));C(this,Te,new Uint8Array(g.cmt*64));C(this,F,{});C(this,B,void 0);C(this,me,void 0);C(this,st,void 0);C(this,H,100);C(this,Le,0);C(this,qe,500);C(this,Qe,0);C(this,Re,"");C(this,De,0);C(this,it,0);C(this,Ye,0);C(this,be,!0);C(this,N,!1);C(this,lt,1);C(this,ct,void 0);C(this,Ue,new Array(g.ch));C(this,mt,new Uint8Array(2));C(this,ae,[]);C(this,Se,new Uint8Array(g.ch));C(this,Pe,new Uint8Array(g.tr));T(this,"baseBank",new ut("gm","gm2","xg","gs","ns5r","sd","gmega","plg-150vl","plg-150pf","plg-150dx","plg-150an","plg-150dr","plg-100sg","kross","s90es"));T(this,"userBank",new ut("gm"));T(this,"initOnReset",!1);T(this,"aiEfxName","");C(this,q,[]);C(this,Be,void 0);C(this,_,{nOff:(e,r)=>{let h=e*128+r,u=t(this,V).lastIndexOf(h);if(u>-1)if(t(this,p)[g.cc*e+b[64]]>63)t(this,z)[u]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:r,velo:t(this,X)[h],state:this.NOTE_HELD});else if(t(this,p)[g.cc*e+b[66]]>63&&t(this,z)[u]==this.NOTE_SOSTENUTO_SUSTAIN)t(this,z)[u]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:r,velo:t(this,X)[h],state:this.NOTE_SOSTENUTO_HELD});else{t(this,V)[u]=0,t(this,X)[h]=0,t(this,z)[u]=this.NOTE_IDLE;let E=this.getExt(e)[1];(E==this.VLBC_VELOINIT||E==this.VLBC_VELOALL)&&(t(this,p)[g.cc*e+b[129]]=0),this.dispatchEvent("note",{part:e,note:r,velo:0,state:this.NOTE_IDLE})}},nOn:(e,r,h)=>{let u=e*128+r,E=0;for(t(this,Z)[e]&&t(this,_).ano(e);t(this,z)[E]>0&&t(this,V)[E]!=u;)E++;if(E<g.pl){t(this,V)[E]=u,t(this,X)[u]=h,t(this,z)[E]=this.NOTE_SUSTAIN,t(this,ye)[e]<h&&(t(this,ye)[e]=h);let v=this.getExt(e)[1];(v==this.VLBC_VELOINIT||v==this.VLBC_VELOALL)&&(t(this,p)[g.cc*e+b[129]]=h),this.dispatchEvent("note",{part:e,note:r,velo:h,state:this.NOTE_SUSTAIN})}else console.error("Polyphony exceeded.")},nAt:(e,r,h)=>{},cAt:(e,r)=>{},hoOf:e=>{t(this,z).forEach((r,h)=>{if(r==this.NOTE_HELD){let u=t(this,V)[h],E=u>>7;e==E&&(t(this,z)[h]=this.NOTE_IDLE,t(this,V)[h]=0,t(this,X)[u]=0,this.dispatchEvent("note",{part:e,note:u&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{t(this,z).forEach((r,h)=>{let u;switch(r){case this.NOTE_ATTACK:{u=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{u=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{u=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(u){t(this,z)[h]=u;let E=t(this,V)[h];this.dispatchEvent("note",{part:e,note:E&127,velo:t(this,X)[E],state:u})}})},soOf:e=>{t(this,z).forEach((r,h)=>{if(r==this.NOTE_SOSTENUTO_HELD){let u=t(this,V)[h],E=u>>7;e==E&&(t(this,z)[h]=this.NOTE_IDLE,t(this,V)[h]=0,t(this,X)[u]=0,this.dispatchEvent("note",{part:e,note:u&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{t(this,V).forEach((r,h,u)=>{let E=r>>7,v=r&127;r==0&&t(this,X)[0]==0||E==e&&t(this,_).nOff(E,v)})}});C(this,nt,{8:function(e){let r=e.channel,h=e.data[0];t(this,_).nOff(r,h)},9:function(e){let r=e.channel,h=this;if(h.getChModeId(r)==w.xg&&t(h,D)[r]>1){let v=h.getChDrumFirstWrite(r);v[0]&&v[1]!=g.invalidCh&&!t(h,ie)[r]&&(h.copyChSetup(v[1],r),h.dispatchEvent("voice",{part:r}),console.debug(`Part CH${r+1} copied from CH${v[1]}.`))}h.setChActive(r,1);let u=e.data[0],E=e.data[1];E>0?t(h,_).nOn(r,u,E):t(h,_).nOff(r,u)},10:function(e){let r=e.channel,h=r*128+e.data[0];t(this,V).indexOf(h)>-1&&(t(this,X)[h]=data[1],this.getExt(r)[1]==this.VLBC_VELOALL&&(t(this,p)[g.cc*r+b[129]]=data[1]),this.dispatchEvent("note",{part:r,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let r=e.channel,h=this,u=t(this,Ue)[r],E=u[e.data[0]];E&&(e.data[0]=E),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(t(this,O)){case w.s90es:case w.motif:{if(e.data[0]==0){[0,63].indexOf(e.data[1])>-1&&this.setChActive(r,1);break}e.data[1]&&this.setChActive(r,1);break}default:{this.setChActive(r,1);break}}})();let v=r*g.cc,k=r*g.ext;switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{t(this,_).ano(r),t(this,ke)[r]=0,t(this,p)[v+b[1]]=0,t(this,p)[v+b[5]]=0,t(this,p)[v+b[64]]=0,t(this,p)[v+b[65]]=0,t(this,p)[v+b[66]]=0,t(this,p)[v+b[67]]=0,t(this,p)[v+b[11]]=127,t(this,p)[v+b[101]]=127,t(this,p)[v+b[100]]=127,t(this,p)[v+b[99]]=127,t(this,p)[v+b[98]]=127;return}case 123:{t(this,_).ano(r);return}case 124:{t(this,_).ano(r);return}case 125:{t(this,_).ano(r);return}case 126:{t(this,Z)[r]=1,t(this,_).ano(r);return}case 127:{t(this,Z)[r]=0,t(this,_).ano(r);return}}if(b[e.data[0]]==null)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(ia.indexOf(e.data[0])>-1&&this.allocateAce(e.data[0]),e.data[0]){case 0:{switch(P()&&console.debug(`${K[t(this,O)]}, CH${r+1}: ${e.data[1]}`),t(this,O)==0?e.data[1]<48?(t(this,D)[r]>0&&(e.data[1]=t(this,p)[v],e.data[1]=120,console.debug(`Forced channel ${r+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]==56?this.switchMode(t(this,B).x5==82?"x5d":"05rw"):e.data[1]==62?this.switchMode(t(this,B).x5==82?"x5d":"05rw"):e.data[1]==63?this.switchMode(K[t(this,B).ds]):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg"):t(this,O)==w.gs||t(this,O)==w.sc?e.data[1]<56&&t(this,D)[r]>0&&(e.data[1]=t(this,p)[v],e.data[1]=120,console.debug(`Forced channel ${r+1} to stay drums.`)):t(this,O)==w.gm&&(e.data[1]<48?t(this,D)[r]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${r+1} to stay drums.`)):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg",!0)),t(this,O)){case w.xg:{[79,95,126,127].indexOf(e.data[1])>-1?t(this,D)[r]==0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):t(this,D)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?t(this,ee)[k]=this.EXT_VL:[35,67,83,99].indexOf(e.data[1])>-1?t(this,ee)[k]=this.EXT_DX:t(this,ee)[k]=this.EXT_NONE;break}case w["05rw"]:case w.x5d:case w.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?t(this,D)[r]==this.CH_MELODIC&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):[80,81,82,83].indexOf(e.data[1])>-1||t(this,D)[r]!=this.CH_MELODIC&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case w.sd:{[104,105,106,107].indexOf(e.data[1])>-1?t(this,D)[r]==0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):t(this,D)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case w.g2:{e.data[1]==120?t(this,D)[r]==0&&(this.setChType(r,this.CH_DRUMS),console.debug(`CH${r+1} set to drums by MSB.`)):t(this,D)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}}this.dispatchEvent("voice",{part:r});break}case 2:{this.getExt(r)[1]==this.VLBC_BRTHEXPR&&(t(this,p)[v+b[129]]=e.data[1]);break}case 6:{if(t(this,Oe)){[w.xg,w.gs,w.sc,w.ns5r].indexOf(t(this,O))<0&&console.warn(`NRPN commits are not available under "${K[t(this,O)]}" mode, even when they are supported in Octavia.`);let S=t(this,p)[v+b[99]],a=t(this,p)[v+b[98]];if(S==1){let c=ca.indexOf(a);if(c>-1)t(this,p)[v+b[71+c]]=e.data[1],P()&&console.debug(`Redirected NRPN 1 ${a} to cc${71+c}.`),this.dispatchEvent("cc",{part:r,cc:71+c,data:e.data[1]});else{let f=Vt.indexOf(a);f>-1?t(this,Ke)[r*10+f]=e.data[1]-64:console.warn(`NRPN 0x01${a.toString(16).padStart(2,"0")} is not supported.`),P()&&console.debug(`CH${r+1} voice NRPN ${a} commit`)}}else{if(ft.indexOf(S)<0){let f=`NRPN 0x${S.toString(16).padStart(2,"0")}${a.toString(16).padStart(2,"0")} `;S==127?console.warn(`${f}is not necessary. Consider removing it.`):console.warn(`${f}is not supported.`)}else{let f=t(this,D)[r]-2;f<0?console.warn(`CH${r+1} cannot accept drum NRPN as type ${et[t(this,D)[r]]}.`):t(this,Y)[(f*g.dpn+de[S])*g.dnc+a]=e.data[1]}P()&&console.debug(`CH${r+1} (${et[t(this,D)[r]]}) drum NRPN ${S} commit`)}}else{let S=_t[t(this,p)[v+b[100]]],a=Gt[t(this,p)[v+b[100]]];t(this,p)[v+b[101]]==0&&S!=null&&(P()&&console.debug(`CH${r+1} RPN 0 ${t(this,p)[v+b[100]]} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],Xt[S][0]),Xt[S][1]),t(this,R)[r*g.rpn+S]=e.data[1],t(this,L)[r*g.rpnt+a]=1,this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)}))}break}case 32:{switch(P()&&console.debug(`${K[t(this,O)]}, CH${r+1} LSB: ${e.data[1]}`),t(this,O)){case w.s90es:case w.motif:{this.setChType(r,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,t(this,O),!0);break}}this.getExt(r)[0]==this.EXT_DX,this.dispatchEvent("voice",{part:r});break}case 38:{if(!t(this,Oe)){let S=_t[t(this,p)[v+100]],a=Gt[t(this,p)[v+100]];t(this,p)[v+101]==0&&S!=null&&(t(this,R)[r*g.rpn+S+1]=e.data[1],t(this,L)[r*g.rpnt+a]=1)}break}case 64:{e.data[1]<64&&t(this,_).hoOf(r);break}case 66:{e.data[1]>>6?t(this,_).soOn(r):t(this,_).soOf(r);break}case 98:case 99:{x(this,Oe,1);break}case 100:case 101:{x(this,Oe,0);break}}t(this,p)[v+b[e.data[0]]]=e.data[1],this.dispatchEvent("cc",{part:r,cc:e.data[0],data:e.data[1]})}h.getChModeId(r)==w.xg&&t(h,D)[r]&&h.setDrumFirstWrite(r)},12:function(e){let r=e.channel,h=this;switch(t(h,O)){case w.s90es:case w.motif:{e.data&&h.setChActive(r,1);break}default:h.setChActive(r,1)}if(h.getExt(r)[0]==h.EXT_DX){let u=g.cc*r}t(h,A)[r]=e.data,t(h,ue)[r]=0,P()&&console.debug(`T:${e.track} C:${r} P:${e.data}`),h.dispatchEvent("voice",{part:r}),h.getChModeId(r)==w.xg&&t(h,D)[r]&&h.setDrumFirstWrite(r)},13:function(e){let r=this,h=e.channel;t(this,V).forEach(function(u){let E=u>>7;h==E&&(t(r,X)[u]=e.data,r.dispatchEvent("note",{part:h,note:u&127,velo:e.data,state:r.NOTE_SUSTAIN}))})},14:function(e){let r=e.channel;t(this,ke)[r]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)})},15:function(e){oa(e.data).forEach(r=>{let h=r[0],u=r[1];(t(this,dt)[h]||function(){console.debug(`Unknown manufacturer ${h}.`)})(u,r.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(t(this,q)[e.meta]||function(h,u,E){}).call(this,e.data,e.track,e.meta),e.meta!=32&&x(this,Le,0);let r=sa.indexOf(e.meta)>-1;if(P()&&console.debug(e),r)return e.reply="meta",e}});C(this,dt,{64:(e,r,h)=>{t(this,Ie).run(r,h,e)},65:(e,r,h)=>{if(r[0]<16)if(r[1]==72){let u=r[r.length-1],E=xe(r.subarray(3,r.length-1));u==E?t(this,ne).run(r.subarray(0,r.length-1),h,e):console.warn(`Bad SD checksum ${u} - should be ${E}.`)}else t(this,ne).run(r,h,e);else{let u=r[r.length-1],E=xe(r.subarray(2,r.length-1));u==E?t(this,ne).run(r.subarray(0,r.length-1),h,e):console.warn(`Bad GS checksum ${u} - should be ${E}.`)}},66:(e,r,h)=>{t(this,$e).run(r,h,e)},67:(e,r,h)=>{t(this,re).run(r,h,e)},68:(e,r,h)=>{t(this,Ge).run(r,h,e)},71:(e,r,h)=>{t(this,_e).run(r,h,e)},126:(e,r,h)=>{t(this,He).run(r,h,e)},127:(e,r,h)=>{this.switchMode("gm"),t(this,Ne).run(r,h,e)}});C(this,He,void 0);C(this,Ne,void 0);C(this,re,void 0);C(this,ne,void 0);C(this,$e,void 0);C(this,Ie,void 0);C(this,_e,void 0);C(this,Ge,void 0);let e=this;x(e,se,new Uint8Array(256),qt),t(e,we)[10]=new Uint8Array(512),x(e,Be,new oe),x(e,B,{x5:82,ds:w.krs,smotif:w.s90es,gs:4,sc:3}),x(e,me,{dumpLimit:e.DUMP_MODE}),x(e,st,new Proxy(t(e,me),{set:()=>{}}));for(let a in Ht){let c=w[a];c==null?console.debug(`SubDB build error: "${a}" does not exist`):t(e,F)[c]=new Uint8Array(Ht[a])}e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(a){var f,s;let{data:c}=a;((f=t(e,ae)[0])==null?void 0:f.type)==c.type&&((s=t(e,ae)[0])!=null&&s.amend)?(t(e,ae)[0].amend=c.amend,t(e,ae)[0].data+=c.data):t(e,ae).unshift(c)}),t(e,q)[1]=function(a){var c,f,s,i,o;switch(a=a.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),a.slice(0,2)){case"@I":{x(this,N,!0),this.dispatchEvent("metacommit",{type:"Kar.Info",data:(c=a.slice(2))==null?void 0:c.trimLeft()});break}case"@K":{x(this,N,!0),this.dispatchEvent("metacommit",{type:"Kar.Mode",data:(f=a.slice(2))==null?void 0:f.trimLeft()}),console.debug(`Karaoke mode active: ${a.slice(2)}`);break}case"@L":{x(this,N,!0),this.dispatchEvent("metacommit",{type:"Kar.Lang",data:(s=a.slice(2))==null?void 0:s.trimLeft()});break}case"@T":{x(this,N,!0),this.dispatchEvent("metacommit",{type:"KarTitle",data:(i=a.slice(2))==null?void 0:i.trimLeft()});break}case"@V":{x(this,N,!0),this.dispatchEvent("metacommit",{type:"Kar.Ver.",data:(o=a.slice(2))==null?void 0:o.trimLeft()});break}case"XF":{let n=a.slice(2).split(":");switch(n[0]){case"hd":{n.slice(1).forEach((d,l)=>{d.length&&this.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][l],data:d})});break}case"ln":{n.slice(1).forEach((d,l)=>{d.length&&this.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][l],data:d})});break}default:this.dispatchEvent("metacommit",{type:"XfUnData",data:a})}break}default:t(this,N)?a[0]=="\\"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:a.slice(1),amend:!0})):a[0]=="/"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:a.slice(1),mask:!0,amend:!0})):this.dispatchEvent("metacommit",{type:"KarLyric",data:a,amend:!0}):a.split(`
`).forEach((n,d)=>{this.dispatchEvent("metacommit",{type:"Cmn.Text",data:n,mask:d!=0})})}},t(e,q)[2]=function(a){this.dispatchEvent("metacommit",{type:"Copyrite",data:a})},t(e,q)[3]=function(a,c){c<1&&t(this,Le)<1&&this.dispatchEvent("metacommit",{type:"TrkTitle",data:a})},t(e,q)[4]=function(a,c){this.dispatchEvent("metacommit",{type:"Instrmnt",data:a})},t(e,q)[5]=function(a){a.trim()==""?this.dispatchEvent("metacommit",{type:"C.Lyrics",data:"",amend:!1}):this.dispatchEvent("metacommit",{type:"C.Lyrics",data:a,amend:!0})},t(e,q)[6]=function(a){this.dispatchEvent("metacommit",{type:"C.Marker",data:a})},t(e,q)[7]=function(a){this.dispatchEvent("metacommit",{type:"CuePoint",data:a})},t(e,q)[32]=function(a){x(this,Le,a[0]+1)},t(e,q)[33]=function(a,c){P()&&console.debug(`Track ${c} requests to get assigned to output ${a}.`),t(e,Pe)[c]=a+1},t(e,q)[81]=function(a,c){x(e,qe,a/1e3)},t(e,q)[127]=function(a,c){t(e,Be).run(a,c)},t(e,Be).default=function(a){console.warn(`Unrecognized sequencer-specific byte sequence: ${a}`)},t(e,Be).add([67,0,1],function(a,c){t(e,Pe)[c]=a[0]+1}),x(e,He,new oe("universal non-realtime")),x(e,Ne,new oe("universal realtime")),x(e,re,new oe("Yamaha")),x(e,ne,new oe("Roland")),x(e,$e,new oe("Korg")),x(e,Ie,new oe("Kawai")),x(e,_e,new oe("Akai")),x(e,Ge,new oe("Casio"));let r=new oe("DX7+ Dump"),h=function(a){console.info(`Unrecognized SysEx in "${this.name}" set.
%o`,a)};t(e,He).default=h,t(e,Ne).default=h,t(e,re).default=h,t(e,ne).default=h,t(e,$e).default=h,t(e,Ie).default=h,t(e,_e).default=h,t(e,Ge).default=h,r.default=h,t(e,He).add([9],(a,c,f)=>{e.switchMode(["gm","?","g2"][a[0]-1],!0),e.setPortMode(e.getTrackPort(c),1,w[["gm","?","g2"][a[0]-1]]),x(e,N,t(e,N)||!1),console.info(`MIDI reset: ${["GM","Init","GM2"][a[0]-1]}`),a[0]==2&&e.init()}),t(e,Ne).add([4,1],(a,c,f)=>{e.dispatchEvent("mupromptex"),x(e,H,((a[1]<<7)+a[0])/16383*100),e.dispatchEvent("mastervolume",t(e,H))}).add([4,3],(a,c,f)=>((a[1]<<7)+a[0]-8192)/8192).add([4,4],(a,c,f)=>a[1]-64).add([4,5],(a,c,f)=>{e.dispatchEvent("mupromptex");let s=a[0],i=a[1],o=a[2],n=3,d=n+(s<<1),l=d+i;if(s!=1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${s})!
`,a);return}let m=0,$=0,M=0;switch(a.subarray(n,d).forEach(U=>{m=m<<7,m|=U}),a.subarray(d,l).forEach((U,ge)=>{$|=U<<ge*7}),a.subarray(l).forEach((U,ge)=>{M|=U<<ge*7}),P()&&console.debug(`GM2 global parameter: (${a.subarray(3,d)}; p: ${$}, v: ${M})`),m){case 129:{$==0&&(e.setEffectType(0,52,M),e.dispatchEvent("efxreverb",e.getEffectType(0)));break}case 130:{$==0&&(e.setEffectType(1,52,M|16),e.dispatchEvent("efxchorus",e.getEffectType(1)));break}default:P()&&console.debug("GM2 global paramater slot path unknown.")}}),t(this,re).add([76,0,0],(a,c,f)=>{switch(a[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset: ${a}`);break}case 126:{e.switchMode("xg",!0),e.setPortMode(e.getTrackPort(c),4,w.xg),x(e,N,!1),console.info("MIDI reset: XG");break}default:{e.dispatchEvent("mupromptex");let s=[0,0,0,0],i=(o,n)=>{s[n]=o};if(a.subarray(1).forEach((o,n)=>{let d=n+a[0];([i,i,i,i,l=>{x(this,H,l*129/16383*100),e.dispatchEvent("mastervolume",t(e,H))},l=>{},l=>{}][d]||(()=>{}))(o,n)}),a[0]<4){let o=0;s.forEach(n=>{o=o<<4,o+=n}),o-=1024}}}}).add([76,2,1],(a,c,f)=>{e.dispatchEvent("mupromptex");let s="XG ";a[0]<32?(s+="reverb ",a.subarray(1).forEach((i,o)=>{([n=>{e.setEffectTypeRaw(0,!1,n),console.info(`${s}main type: ${Ze[n]}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},n=>{e.setEffectTypeRaw(0,!0,n),console.debug(`${s}sub type: ${n+1}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},n=>{console.debug(`${s}time: ${Rt(n)}s`)},n=>{console.debug(`${s}diffusion: ${n}`)},n=>{console.debug(`${s}initial delay: ${n}`)},n=>{console.debug(`${s}HPF cutoff: ${Ve[n]}Hz`)},n=>{console.debug(`${s}LPF cutoff: ${Ve[n]}Hz`)},n=>{console.debug(`${s}width: ${n}`)},n=>{console.debug(`${s}height: ${n}`)},n=>{console.debug(`${s}depth: ${n}`)},n=>{console.debug(`${s}wall type: ${n}`)},n=>{console.debug(`${s}dry/wet: ${n}`)},n=>{console.debug(`${s}send: ${J(n)}dB`)},n=>{console.debug(`${s}pan: ${n-64}`)},!1,!1,n=>{console.debug(`${s}delay: ${n}`)},n=>{console.debug(`${s}density: ${n}`)},n=>{console.debug(`${s}balance: ${n}`)},n=>{},n=>{console.debug(`${s}feedback: ${n}`)},n=>{}][a[0]+o]||function(){console.warn(`Unknown XG reverb address: ${a[0]}.`)})(i)})):a[0]<64?(s+="chorus ",a.subarray(1).forEach((i,o)=>{([n=>{e.setEffectTypeRaw(1,!1,n),console.info(`${s}main type: ${Ze[n]}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},n=>{e.setEffectTypeRaw(1,!0,n),console.debug(`${s}sub type: ${n+1}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},n=>{console.debug(`${s}LFO: ${Tt[n]}Hz`)},n=>{},n=>{console.debug(`${s}feedback: ${n}`)},n=>{console.debug(`${s}delay offset: ${Dt(n)}ms`)},n=>{},n=>{console.debug(`${s}low: ${Ve[n]}Hz`)},n=>{console.debug(`${s}low: ${n-64}dB`)},n=>{console.debug(`${s}high: ${Ve[n]}Hz`)},n=>{console.debug(`${s}high: ${n-64}dB`)},n=>{console.debug(`${s}dry/wet: ${n}`)},n=>{console.debug(`${s}send: ${J(n)}dB`)},n=>{console.debug(`${s}pan: ${n-64}`)},n=>{console.debug(`${s}to reverb: ${J(n)}dB`)},!1,n=>{},n=>{},n=>{},n=>{console.debug(`${s}LFO phase diff: ${(n-64)*3}deg`)},n=>{console.debug(`${s}input mode: ${n?"stereo":"mono"}`)},n=>{}][a[0]-32+o]||function(){console.warn(`Unknown XG chorus address: ${a[0]}.`)})(i)})):a[0]<86?(s+="variation ",a.subarray(1).forEach((i,o)=>{([n=>{e.setEffectTypeRaw(2,!1,n),console.info(`${s}main type: ${Ze[n]}`),e.dispatchEvent("efxdelay",e.getEffectType(2))},n=>{e.setEffectTypeRaw(2,!0,n),console.debug(`${s}sub type: ${n+1}`),e.dispatchEvent("efxdelay",e.getEffectType(2))}][a[0]-64+o]||function(){})(i)})):a[0]<97?(s+="variation ",a.subarray(1).forEach((i,o)=>{[n=>{console.debug(`${s}send: ${J(n)}dB`)},n=>{console.debug(`${s}pan: ${n-64}`)},n=>{console.debug(`${s}to reverb: ${J(n)}dB`)},n=>{console.debug(`${s}to chorus: ${J(n)}dB`)},n=>{console.debug(`${s}connection: ${n?"system":"insertion"}`)},n=>{console.debug(`${s}channel: CH${n+1}`)},n=>{console.debug(`${s}mod wheel: ${n-64}`)},n=>{console.debug(`${s}bend wheel: ${n-64}`)},n=>{console.debug(`${s}channel after touch: ${n-64}`)},n=>{console.debug(`${s}AC1: ${n-64}`)},n=>{console.debug(`${s}AC2: ${n-64}`)}][a[0]-86+o](i)})):a[0]>111&&a[0]<118?s+="variation ":console.warn(`Unknown XG variation address: ${a[0]}`)}).add([76,2,64],(a,c,f)=>{a.subarray(1).forEach((s,i)=>{let o=i+a[0];if(o==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][s]}`);else{let n=o-1>>2,d=o-1&3,l=`XG EQ ${n} ${["gain","freq","Q","shape"][d]}: `;[()=>{console.debug(`${l}${s-64}dB`)},()=>{console.debug(`${l}${s} (raw)`)},()=>{console.debug(`${l}${s/10}`)},()=>{console.debug(`${l}${["shelf","peak"][+!!s]}`)}][d]()}})}).add([76,3],(a,c,f)=>{e.dispatchEvent("mupromptex");let s=a[0],i=a[1],o=`XG Insertion ${a[0]+1} `;a.subarray(2).forEach((n,d)=>{([l=>{e.setEffectTypeRaw(3+s,!1,l),console.info(`${o}main type: ${Ze[l]}`),e.dispatchEvent(`efxinsert${s}`,e.getEffectType(3+s))},l=>{e.setEffectTypeRaw(3+s,!0,l),console.debug(`${o}sub type: ${l+1}`),e.dispatchEvent(`efxinsert${s}`,e.getEffectType(3+s))}][i+d]||function(){})(n)})}).add([76,6,0],(a,c,f)=>{let s=a[0];s<64?e.setLetterDisplay(a.subarray(1),"XG letter display",s):x(e,De,Date.now())}).add([76,7,0],(a,c,f)=>{let s=a[0];x(e,W,0),x(e,fe,Date.now()+3200),t(e,se,ve).fill(0);let i=a.subarray(1);for(let o=0;o<s;o++)i.unshift(0);i.forEach(function(o,n){let d=Math.floor(n/16),l=n%16,m=(l*3+d)*7,$=7,M=0;for(m-=l*5,d==2&&($=2);M<$;)t(e,se,ve)[m+M]=o>>6-M&1,M++})}).add([76,8],(a,c)=>{e.dispatchEvent("mupromptex");let f=e.chRedir(a[0],c,!0),s=a[1],i=g.cc*f,o=`XG CH${f+1} `,n=`Unknown XG part address ${s}.`,d=!0;a.subarray(2).forEach((l,m)=>{d=!0,s<1?console.debug(n):s<41?([()=>{t(e,p)[i+b[0]]=l,e.dispatchEvent("voice",{part:f})},()=>{t(e,p)[i+b[32]]=l,e.dispatchEvent("voice",{part:f})},()=>{t(e,A)[f]=l,e.dispatchEvent("voice",{part:f})},()=>{d=!1;let $=e.chRedir(l,c,!0);t(e,G)[f]=$,f!=$&&(e.buildRchTree(),console.info(`${o}receives from CH${$+1}`)),t(e,ie)[f]||(e.copyChSetup($,f,!0),console.debug(`${o}copied from CH${$+1}.`),e.setChActive(f,1),e.dispatchEvent("voice",{part:f}))},()=>{t(e,Z)[f]=+!l},()=>{},()=>{d=!1,e.setChType(f,l,w.xg),console.debug(`${o}type: ${et[l]||l}`),e.dispatchEvent("voice",{part:f})},()=>{t(e,R)[g.rpn*f+3]=l,t(e,L)[g.rpnt*f+2]=1,e.dispatchEvent("pitch",{part:f,pitch:e.getPitchShift(f)})},!1,!1,()=>{t(e,p)[i+b[7]]=l},!1,!1,()=>{t(e,p)[i+b[10]]=l||128},!1,!1,()=>{t(e,p)[i+b[128]]=l,e.allocateAce(128)},()=>{t(e,p)[i+b[93]]=l},()=>{t(e,p)[i+b[91]]=l},()=>{t(e,p)[i+b[94]]=l},()=>{t(e,p)[i+b[76]]=l},()=>{t(e,p)[i+b[77]]=l},()=>{t(e,p)[i+b[78]]=l},()=>{t(e,p)[i+b[74]]=l},()=>{t(e,p)[i+b[71]]=l},()=>{t(e,p)[i+b[73]]=l},()=>{t(e,p)[i+b[75]]=l},()=>{t(e,p)[i+b[72]]=l}][s+m-1]||(()=>{}))():s<48?console.debug(n):s<111?s>102&&s<105&&(t(e,p)[i+b[[5,65][s&1]]]=l):s<114?console.debug(n):s<116?console.debug(`${o}EQ ${["bass","treble"][s&1]} gain: ${l-64}dB`):s<118?console.debug(n):s<120?console.debug(`${o}EQ ${["bass","treble"][s&1]} freq: ${l}`):console.debug(n)}),d&&t(e,D)[f]>1&&e.setDrumFirstWrite(f)}).add([76,9],(a,c)=>{let f=e.chRedir(a[0],c,!0),s=a[1],i=g.cc*f,o=`PLG-VL CH${f+1} `;a.subarray(2).forEach((n,d)=>{let l=d+s;switch(l){case 1:{console.info(`${o}breath mode: ${["system","breath","velocity","touch EG"][n]}`);break}case 0:case 27:case 28:break;default:if(l<27){let m=l-3>>1,$=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][m];l&1?l<23?(console.debug(`${o}${$} control source: ${At(n)}`),n&&n<96&&e.allocateAce(130+m),t(e,Ae)[g.redir*f+m+2]=n,e.buildRccMap()):console.debug(`${o}${$} scale break point: ${n}`):(console.debug(`${o}${$} depth: ${n-64}`),t(e,p)[i+b[130+m]]=n)}}})}).add([76,10],(a,c,f)=>{}).add([76,16],(a,c,f)=>{}).add([76,17,0,0],(a,c,f)=>{}).add([76,112],(a,c,f)=>{switch(console.debug(`XG enable PLG-${["VL","SG","DX","AN","PF","DR","PC","AP"][a[0]]} for CH${a[2]+1}.`),a[0]){case 0:{t(e,ee)[g.ext*a[2]]=e.EXT_VL;break}case 2:{t(e,ee)[g.ext*a[2]]=e.EXT_DX;break}default:t(e,ee)[g.ext*a[2]]=e.EXT_NONE}}).add([73,0,0],(a,c)=>{let f=a[0],s="MU1000 System - ";a.subarray(1).forEach((i,o)=>{let n=f+o;n==8?console.debug(`${s}LCD contrast: ${i}.`):n==18?(t(e,F)[w.xg][1]=i?126:0,console.debug(`${s}default bank: ${i?"MU100 Native":"MU Basic"}.`),e.dispatchEvent("banklevel",{mode:"xg",data:+!!i}),e.forceVoiceRefresh()):n>=64&&n<69&&[()=>{e.dispatchEvent("channelactive",i)},()=>{i<8?(e.dispatchEvent("channelmin",i<<4),console.debug(`Octavia System: Minimum CH${(i<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{i<8?(e.dispatchEvent("channelmax",(i<<4)+15),console.debug(`Octavia System: Maximum CH${(i<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{x(e,be,!!i),console.info(`Octavia System: RS receiving ${["dis","en"][i]}abled.`)}][n-64]()})}).add([73,10,0],(a,c)=>{let f=a[0],s=`MU1000 RS${t(e,be)?"":" (ignored)"}: `;if(f<16)switch(f){case 2:{let i=e.chRedir(0,c,!0);t(e,be)&&(e.dispatchEvent("channelmin",i),e.dispatchEvent("channelmax",i+63)),console.info(`${s}Show CH1~64`);break}case 3:{let i=e.chRedir(a[1]<<5,c,!0);t(e,be)&&e.dispatchEvent("channelmin",i),t(e,be)&&e.dispatchEvent("channelmax",i+31),console.info(`${s}Show CH${i+1}~CH${i+32}`);break}default:console.debug(`${s}unknown switch ${f} invoked.`)}else if(f<32){if(t(e,be)){let i=e.chRedir(f-16+(t(e,Ye)<<4),c,!0);e.dispatchEvent("channelactive",i)}}else if(f<36){let i=e.chRedir(f-32<<4,c,!0);t(e,be)&&(e.dispatchEvent("channelmin",i),e.dispatchEvent("channelmax",i+15),x(e,Ye,f-32)),console.info(`${s}Show CH${i+1}~CH${i+16}`)}}).add([73,11,0],(a,c)=>{let f="MU1000 System - channel ",s="Octavia System - channel ",i=a[0];a.subarray(1).forEach((o,n)=>{let d=i+n;([()=>{e.setChActive(o,1),e.dispatchEvent("channelactive",o),P()&&console.debug(`${f}current part: CH${o+1}`)},()=>{o<5?(e.dispatchEvent("portrange",1<<o),console.debug(`${f}port range: ${1<<o} port(s)`)):(e.dispatchEvent("portrange",0),console.debug(`${f}port range: reset`))},()=>{o<16?(e.dispatchEvent("portstart",o),console.debug(`${s}start port: ${"ABCDEFGHIJKLMNOP"[o]}`)):(e.dispatchEvent("portstart",255),console.debug(`${s}start port: reset`))}][d]||(()=>{console.debug(`${f}unknown address: ${d}`)}))()})}).add([93,3],(a,c)=>{let f=e.chRedir(a[0],c,!0),s=`PLG-100SG CH${f+1} `,i=Date.now();if(a[1]==0){let o="",n=0;a.subarray(2).forEach((d,l)=>{l%2==0?o+=Pt[d]||d.toString().padStart("0"):n+=d*13}),i>=t(e,Qe)&&this.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"SGLyrics",data:`${Ot(o)}`,amend:!0}),x(e,Qe,i+Math.ceil(n/2)+t(e,qe)),P()&&console.debug(`${s}vocals: ${o}`)}else console.warn(`Unknown PLG-100SG data: ${a}`)}).add([98,0],(a,c,f)=>{e.dispatchEvent("mupromptex");let s=a[0],i=a.length-5,o=a.length-1;if(s!=i){console.info(`PLG-DX native dump size mismatch! Gave ${s} instead of ${a.length-5}.`);return}let n=xe(a.subarray(4,o));if(n!=a[o]){console.info(`Bad PLG-DX checksum ${a[o]} - should be ${n}.`);return}a[0]=98,t(e,re).run(a.subarray(0,o),c,f,{noAce:!0})}).add([98,96],(a,c,f,s)=>{let i=e.chRedir(a[0],c,!0),o=g.cc*i,n=a[1];a.subarray(2).forEach((d,l)=>{let m=n+l;if(!(m<10)){if(m==10)e.resetAce();else if(m<27){let $=m+131;s!=null&&s.noAce||e.allocateAce($),t(e,p)[o+b[$]]=d,e.dispatchEvent("cc",{part:i,cc:$,data:d})}}})}).add([100,0],(a,c,f)=>{let s=a.subarray(0,a.length-1);if(a[0]+5!=a.length){console.warn(`Yamaha DX7+ dump SysEx size mismatch! Expected ${a.length}, but got ${a[0]}:
`,a);return}let i=xe(s),o=a[a.length-1];if(i!=o){console.warn(`Yamaha DX7+ dump SysEx checksum mismatch! Expected ${i}, but got ${o}:
`,a);return}r.run(s.subarray(1))}).add([100,76],(a,c,f)=>{let s=a[0]>>4,i=a[0]&15,o=a[1];switch(s){case 2:{let n=e.chRedir(i,c,!0),d=g.cc*n;a.subarray(2).forEach((l,m)=>{let $=m+o;if(!($<7)){if($<23){let M=$+135;e.allocateAce(M),t(e,p)[d+b[M]]=l,e.dispatchEvent("cc",{part:n,cc:M,data:l})}}});break}default:console.info("Unknown DX7+ multipart: %o",a)}}).add([1,20],(a,c,f)=>{f==115?(e.switchMode("doc",!0),e.setPortMode(e.getTrackPort(c),1,w.doc),console.info("MIDI reset: DOC")):console.debug(`Unknown Yamaha SysEx: 67, ${f}, ${a.join(", ")}`)}).add([1,17,15,89],(a,c,f)=>{f==115?(e.setEffectType(0,24,a[0]|16),e.dispatchEvent("efxreverb",e.getEffectType(0))):console.debug(`Unknown Yamaha SysEx: 67, ${f}, ${a.join(", ")}`)}).add([1,24],(a,c,f)=>{if(f==115){for(let s=0;s<16;s++){let i=e.chRedir(s,c,!0);t(e,p)[i*g.cc+b[91]]=127}console.info("DOC Global Reverb: on")}else console.debug(`Unknown Yamaha SysEx: 67, ${f}, ${a.join(", ")}`)}),r.add([14,31],(a,c,f)=>{t(e,p)[g.cc*a[0]+b[64]]=0,t(e,_).ano(a[0]),e.switchMode("xg"),e.setPortMode(e.getTrackPort(c),1,w.xg),e.resetAce(),console.debug(`Yamaha DX7+ reset CH${a[0]+1}.`)}).add([76,112],async a=>{let c=a[0],f=g.cc*c,s=g.ext*c,i=g.cvn*c;t(e,ee)[s]=e.EXT_DX,t(e,ue)[c]=1;let o=t(e,rt).subarray(i,i+g.cvn);o.fill(32),a.subarray(1).forEach((n,d)=>{if(d<10)o[d]=Math.max(n,32);else if(!(d<40)){if(d<56){let l=d+102;t(e,p)[f+b[l]]=n,e.dispatchEvent("cc",{part:c,cc:l,data:n})}}}),t(e,A)[c]=c&127,t(e,p)[g.cc*c+b[0]]=35,t(e,p)[g.cc*c+b[32]]=c>>7|4,e.dispatchEvent("voice",{part:c}),console.debug(`DX7+ CH${c+1} dump: %o`,a)});let u=function(a,c,f,s){},E=function(a,c){e.dispatchEvent("mupromptex");let f=a*g.dpn,s=c[0],i=c[1];c.subarray(2).forEach((o,n)=>{let d=n+i,l=-1;d<16?([()=>{l=24},()=>{l=25},()=>{l=26},()=>{},()=>{l=28},()=>{l=29},()=>{l=30},()=>{l=31},()=>{},()=>{},()=>{},()=>{l=20},()=>{l=21},()=>{l=22},()=>{l=23},()=>{}][d]||(()=>{console.debug(`Unknown XG-style drum param ${d} on set ${a+1}.`)}))():d<32||(d<40?([()=>{l=48},()=>{l=49},!1,!1,()=>{l=52},()=>{l=53}][d-32]||(()=>{console.debug(`Unknown XG-style drum param ${d} on set ${a+1}.`)}))():d<80||([()=>{l=36}][d-80]||(()=>{console.debug(`Unknown XG-style drum param ${d} on set ${a+1}.`)}))()),l>=0?(P()&&console.debug(f,l,s,o),t(e,Y)[(f+de[l])*g.dnc+s]=o):P()&&console.debug(`XG-style drum param ${d} has no writes.`)})},v=function(a,c,f){e.dispatchEvent("mupromptex");let s=a*g.dpn,i=(c<<7)+f[0];f.subarray(1).forEach((o,n)=>{let d=n+i,l=d&127,m=d>>7,$=-1;m>1&&([()=>{$=26},()=>{},()=>{$=28},()=>{$=29},()=>{$=30},()=>{},()=>{},()=>{$=31}][m-2]||(()=>{console.debug(`Unknown GS-style drum param ${m} on set ${a+1}.`)}))(),$>-1?(P()&&console.debug(s,$,l,o),t(e,Y)[(s+de[$])*g.dnc+l]=o):P()&&console.debug(`GS-style drum param ${m} has no writes.`)})};t(this,re).add([76,48],(a,c,f)=>{E(0,a)}).add([76,49],(a,c,f)=>{E(1,a)}).add([76,50],(a,c,f)=>{E(2,a)}).add([76,51],(a,c,f)=>{E(3,a)}).add([76,52],(a,c,f)=>{E(4,a)}).add([76,53],(a,c,f)=>{E(5,a)}).add([76,54],(a,c,f)=>{E(6,a)}).add([76,55],(a,c,f)=>{E(7,a)}),t(this,re).add([89,0],(a,c,f)=>{if(e.eprom){let s=a[0],i=(a[1]<<14)+(a[2]<<7)+a[3]+(e.eprom.offset||0);P()&&console.debug(`MU1000 EPROM trail to 0x${i.toString(16).padStart(6,"0")}, ${s} bytes.`);let o=e.eprom.data;a.subarray(4).forEach((n,d)=>{let l=d>>3,m=d&7;if(m==7)for(let $=0;$<7;$++)o[i+7*l+$]+=(n>>6-$&1)<<7;else o[i+7*l+m]=n})}}).add([89,1],(a,c,f)=>{let s=(a[0]<<21)+(a[1]<<14)+(a[2]<<7)+a[3];P()&&console.debug(`MU1000 EPROM jump to 0x${s.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=s)}).add([89,2],(a,c,f)=>{if(e.eprom){let s=(a[0]<<21)+(a[1]<<14)+(a[2]<<7)+a[3]+(e.eprom.offset||0);P()&&console.debug(`MU1000 EPROM write to 0x${s.toString(16).padStart(6,"0")}.`);let i=e.eprom.data;a.subarray(4).forEach((o,n)=>{let d=n>>3,l=n&7;if(l==7)for(let m=0;m<7;m++)i[s+7*d+m]+=(o>>6-m&1)<<7;else i[s+7*d+l]=o})}}).add([89,3],(a,c,f)=>{}),t(this,re).add([39,48],(a,c,f)=>{}).add([43,0,0],(a,c,f)=>{e.dispatchEvent("mupromptex");let s=[0,0,0,0],i=(o,n)=>{s[n]=o};if(a.subarray(1).forEach((o,n)=>{let d=n+a[0];[i,i,i,i,()=>{x(this,H,o*129/16383*100),e.dispatchEvent("mastervolume",t(e,H))},()=>o-64,()=>o||128,()=>o,()=>o,()=>{console.debug(`TG300 variation on cc${o}.`)}][d](o,d)}),a[0]<4){let o=0;s.forEach(n=>{o=o<<4,o+=n}),o-=1024}}).add([43,1,0],(a,c,f)=>{e.dispatchEvent("mupromptex")}).add([43,2],(a,c,f)=>{e.dispatchEvent("mupromptex");let s=e.chRedir(a[0],c,!0),i=a[1],o=g.cc*s,n=`TG300 CH${s+1} `;a.subarray(2).forEach((d,l)=>{l<5?([()=>{},()=>{t(e,p)[o+b[0]]=d,e.dispatchEvent("voice",{part:s})},()=>{t(e,p)[o+b[32]]=d,e.dispatchEvent("voice",{part:s})},()=>{t(e,A)[s]=d,e.dispatchEvent("voice",{part:s})},()=>{let m=e.chRedir(d,c,!0);t(e,G)[s]=m,s!=m&&(e.buildRchTree(),console.info(`${n}receives from CH${m+1}`))}][l+i]||(()=>{}))(d,l+i):l<21||(l<47?([()=>{t(e,Z)[s]=+!d},()=>{},()=>{},()=>{t(e,R)[g.rpn*s+3]=d,t(e,L)[g.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{},()=>{t(e,p)[o+b[7]]=d},!1,!1,()=>{t(e,p)[o+b[10]]=d||128},!1,!1,()=>{console.debug(`${n} AC1 at cc${d}`)},()=>{console.debug(`${n} AC2 at cc${d}`)},()=>{t(e,p)[o+b[128]]=d,e.allocateAce(128)},()=>{t(e,p)[o+b[93]]=d},()=>{t(e,p)[o+b[91]]=d},()=>{t(e,p)[o+b[94]]=d},()=>{t(e,p)[o+b[76]]=d},()=>{t(e,p)[o+b[77]]=d},()=>{t(e,p)[o+b[74]]=d},()=>{t(e,p)[o+b[71]]=d},()=>{t(e,p)[o+b[73]]=d},()=>{t(e,p)[o+b[75]]=d},()=>{t(e,p)[o+b[72]]=d},()=>{t(e,p)[o+b[78]]=d}][l+i-21]||(()=>{}))(d,l+i):l<95||([()=>{t(e,p)[o+b[65]]=d},()=>{t(e,p)[o+b[5]]=d}][l+i-95]||(()=>{}))(d,l+i))})}).add([43,7,0],(a,c,f)=>{let s=a[0];e.setLetterDisplay(a.subarray(1),"TG300 letter display",s)}).add([43,7,1],(a,c,f)=>{x(e,W,0),x(e,fe,Date.now()+3200),t(e,se,ve).fill(0),a.forEach(function(s,i){let o=Math.floor(i/16),n=i%16,d=(n*3+o)*7,l=7,m=0;for(d-=n*5,o==2&&(l=2);m<l;)t(e,se,ve)[d+m]=s>>6-m&1,m++})}),t(this,ne).add([66,18,0,0,127],(a,c,f)=>{e.switchMode("sc",!0),e.setPortMode(e.getTrackPort(c),2,w.sc),t(e,p)[g.cc*9]=120,t(e,p)[g.cc*25]=120,t(e,p)[g.cc*41]=120,t(e,p)[g.cc*57]=120,t(e,F)[w.sc][1]=t(e,B).sc,x(e,N,!1),t(e,Se).fill(0),console.info(`GS system to ${["single","dual"][a[0]]} mode.`)}).add([66,18,64,0],(a,c,f)=>{switch(a[0]){case 127:{e.switchMode("gs",!0),e.setPortMode(e.getTrackPort(c),2,w.gs),t(e,F)[w.gs][1]=t(e,B).gs,t(e,p)[g.cc*9]=120,t(e,p)[g.cc*25]=120,t(e,p)[g.cc*41]=120,t(e,p)[g.cc*57]=120,x(e,N,!1),t(e,Se).fill(0),console.info("MIDI reset: GS");break}default:{e.dispatchEvent("mupromptex");let s=[0,0,0,0],i=(o,n)=>{s[n]=o};if(a.subarray(1).forEach((o,n)=>{let d=n+a[0];[i,i,i,i,l=>{x(this,H,l*129/16383*100),e.dispatchEvent("mastervolume",t(e,H))},l=>{},l=>{}][d](o,n)}),a[0]<4){let o=0;s.forEach(n=>{o=o<<4,o+=n}),o-=1024}}}}).add([66,18,64,1],(a,c,f)=>{e.dispatchEvent("mupromptex");let s=a[0];if(s<16){let i="".padStart(s," ");a.subarray(1).forEach((o,n)=>{i+=String.fromCharCode(Math.max(32,o))}),i=i.padEnd(16," "),console.debug(`GS patch name: ${i}`)}else s<48||(s<65?a.subarray(1).forEach((i,o)=>{let n=`GS ${s+o>55?"chorus":"reverb"} `;([()=>{console.info(`${n}type: ${bt[i]}`),e.setEffectType(0,40,i),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${n}predelay: ${i}ms`)},()=>{console.info(`${n}type: ${Lt[i]}`),e.setEffectType(1,40,16+i),e.dispatchEvent("efxchorus",e.getEffectType(1))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${n}to reverb: ${J(i)}`)},()=>{console.debug(`${n}to delay: ${J(i)}`)}][s+o-48]||(()=>{}))()}):s<80?console.debug(`Unknown GS patch address: ${s}`):s<91?a.subarray(1).forEach((i,o)=>{let n="GS delay ";([()=>{console.info(`${n}type: ${Ut[i]}`),e.setEffectType(2,40,32+i),e.dispatchEvent("efxdelay",e.getEffectType(2))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${n}to reverb: ${J(i)}`)}][s+o-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${s}`))}).add([66,18,64,2],(a,c,f)=>{let s="GS EQ ";a.subarray(1).forEach((i,o)=>{([()=>{console.debug(`${s}low freq: ${[200,400][i]}Hz`)},()=>{console.debug(`${s}low gain: ${i-64}dB`)},()=>{console.debug(`${s}high freq: ${[3e3,6e3][i]}Hz`)},()=>{console.debug(`${s}high gain: ${i-64}dB`)}][a[0]+o]||function(){console.warn(`Unknown GS EQ address: ${a[0]+o}`)})()})}).add([66,18,64,3],(a,c,f)=>{e.dispatchEvent("mupromptex");let s="GS EFX ",i=function(o,n){let d=Bt(t(e,te).subarray(10,12),n,o);d&&console.debug(`${s}${gt(t(e,te).subarray(10,12))} ${d}`)};a.subarray(1).forEach((o,n)=>{([()=>{e.setEffectTypeRaw(3,!1,32+o),e.dispatchEvent("efxinsert0",e.getEffectType(3))},()=>{e.setEffectTypeRaw(3,!0,o),console.info(`${s}type: ${gt(t(e,te).subarray(10,12))}`),e.dispatchEvent("efxinsert0",e.getEffectType(3))},!1,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,()=>{console.debug(`${s}to reverb: ${J(o)}dB`)},()=>{console.debug(`${s}to chorus: ${J(o)}dB`)},()=>{console.debug(`${s}to delay: ${J(o)}dB`)},!1,()=>{console.debug(`${s}1 source: ${o}`),o&&o<96&&e.allocateAce(o)},()=>{console.debug(`${s}1 depth: ${o-64}`)},()=>{console.debug(`${s}2 source: ${o}`),o&&o<96&&e.allocateAce(o)},()=>{console.debug(`${s}2 depth: ${o-64}`)},()=>{console.debug(`${s}to EQ: ${o?"ON":"OFF"}`)}][a[0]+n]||function(d,l){console.warn(`Unknown GS EFX address: ${l}`)})(o,a[0]+n)})}).add([66,18,65],(a,c,f)=>{v((a[0]>>4)+1<<1,a[0]&15,a.subarray(1))}).add([69,18,16],(a,c,f)=>{var s;switch(a[0]){case 0:{let i=a[1];e.setLetterDisplay(a.subarray(2),"GS display text",i);break}case 32:{x(e,fe,Date.now()+3200),a[1]==0&&(a[2]?(x(e,W,Math.max(Math.min(a[2]-1,9),0)),P()&&console.debug(`GS switch display page ${a[2]-1}.`)):(x(e,W,0),x(e,fe,Date.now()),P()&&console.debug("GS disable display page.")));break}default:if(a[0]<6){t(e,W)>9&&x(e,W,0);let i=a[0]-1<<1|a[1]>>6;t(e,W)==i&&x(e,fe,Date.now()+3200),(s=t(e,we)[i])!=null&&s.length||(t(e,we)[i]=new Uint8Array(256));let o=t(e,we)[i];P()&&console.debug(`GS frame draw page ${i}.`);let n=a[1]&63;o.fill(0),a.subarray(2).forEach(function(l,m){let $=m+n,M=Math.floor($/16),U=$%16,ge=(U*4+M)*5,$t=5,ot=0;for(ge-=U*4,M==3&&($t=1);ot<$t;)o[ge+ot]=l>>4-ot&1,ot++})}else console.warn(`Unknown GS display section: ${a[0]}`)}});let k=function(a,c,f){e.dispatchEvent("mupromptex");let s=a[0],i=g.cc*c,o=g.rpn*c,n=`GS CH${c+1} `;s<3?(a.subarray(1).forEach((d,l)=>{[()=>{t(e,p)[i+b[0]]=d},()=>{t(e,A)[c]=d},()=>{let m=0;d<16?m=e.chRedir(d,f,!0):m=g.ch,t(e,G)[c]=m,c!=m&&(e.buildRchTree(),console.info(`${n}receives from CH${m+1}`))}][s+l]()}),e.dispatchEvent("voice",{part:c})):s<19||(s<44?a.subarray(1).forEach((d,l)=>{([()=>{t(e,Z)[c]=+!d},!1,()=>{e.setChType(c,d<<1,w.gs),console.debug(`${n}type: ${d?"drum ":"melodic"}${d||""}`)},()=>{t(e,R)[o+3]=d,t(e,L)[g.rpnt*c+2]=1,e.dispatchEvent("pitch",{part:c,pitch:e.getPitchShift(c)})},!1,()=>{t(e,p)[i+b[7]]=d},!1,!1,()=>{t(e,p)[i+b[10]]=d||128},!1,!1,()=>{console.debug(`${n}CC 1: cc${d}`)},()=>{console.debug(`${n}CC 2: cc${d}`)},()=>{t(e,p)[i+b[93]]=d},()=>{t(e,p)[i+b[91]]=d},!1,!1,()=>{t(e,R)[o+1]=d,t(e,L)[g.rpnt*c+1]=1,e.dispatchEvent("pitch",{part:c,pitch:e.getPitchShift(c)})},()=>{t(e,R)[o+2]=d,t(e,L)[g.rpnt*c+1]=1,e.dispatchEvent("pitch",{part:c,pitch:e.getPitchShift(c)})},()=>{t(e,p)[i+b[94]]=d}][s+l-19]||(()=>{}))()}):s<76||console.debug(`Unknown GS part address: ${s}`))},S=function(a,c){let f=a[0],s=`GS CH${c+1} `;f<2?a.subarray(1).forEach((i,o)=>{[()=>{t(e,p)[g.cc*c+b[32]]=i},()=>{}][f+o]()}):f<32?console.warn(`Unknown GS misc address: ${f}`):f<35?a.subarray(1).forEach((i,o)=>{[()=>{console.debug(`${s}EQ: o${["ff","n"][i]}`)},()=>{},()=>{console.debug(`${s}EFX: o${["ff","n"][i]}`),t(e,ze)[c]=i,e.dispatchEvent("partefxtoggle",{part:c,active:i})}][f+o-32]()}):console.warn(`Unknown GS misc address: ${f}`)};t(this,ne).add([66,18,64,16],(a,c)=>{k(a,e.chRedir(9,c,!0),c)}).add([66,18,64,17],(a,c)=>{k(a,e.chRedir(0,c,!0),c)}).add([66,18,64,18],(a,c)=>{k(a,e.chRedir(1,c,!0),c)}).add([66,18,64,19],(a,c)=>{k(a,e.chRedir(2,c,!0),c)}).add([66,18,64,20],(a,c)=>{k(a,e.chRedir(3,c,!0),c)}).add([66,18,64,21],(a,c)=>{k(a,e.chRedir(4,c,!0),c)}).add([66,18,64,22],(a,c)=>{k(a,e.chRedir(5,c,!0),c)}).add([66,18,64,23],(a,c)=>{k(a,e.chRedir(6,c,!0),c)}).add([66,18,64,24],(a,c)=>{k(a,e.chRedir(7,c,!0),c)}).add([66,18,64,25],(a,c)=>{k(a,e.chRedir(8,c,!0),c)}).add([66,18,64,26],(a,c)=>{k(a,e.chRedir(10,c,!0),c)}).add([66,18,64,27],(a,c)=>{k(a,e.chRedir(11,c,!0),c)}).add([66,18,64,28],(a,c)=>{k(a,e.chRedir(12,c,!0),c)}).add([66,18,64,29],(a,c)=>{k(a,e.chRedir(13,c,!0),c)}).add([66,18,64,30],(a,c)=>{k(a,e.chRedir(14,c,!0),c)}).add([66,18,64,31],(a,c)=>{k(a,e.chRedir(15,c,!0),c)}).add([66,18,64,64],(a,c)=>{S(a,e.chRedir(9,c,!0))}).add([66,18,64,65],(a,c)=>{S(a,e.chRedir(0,c,!0))}).add([66,18,64,66],(a,c)=>{S(a,e.chRedir(1,c,!0))}).add([66,18,64,67],(a,c)=>{S(a,e.chRedir(2,c,!0))}).add([66,18,64,68],(a,c)=>{S(a,e.chRedir(3,c,!0))}).add([66,18,64,69],(a,c)=>{S(a,e.chRedir(4,c,!0))}).add([66,18,64,70],(a,c)=>{S(a,e.chRedir(5,c,!0))}).add([66,18,64,71],(a,c)=>{S(a,e.chRedir(6,c,!0))}).add([66,18,64,72],(a,c)=>{S(a,e.chRedir(7,c,!0))}).add([66,18,64,73],(a,c)=>{S(a,e.chRedir(8,c,!0))}).add([66,18,64,74],(a,c)=>{S(a,e.chRedir(10,c,!0))}).add([66,18,64,75],(a,c)=>{S(a,e.chRedir(11,c,!0))}).add([66,18,64,76],(a,c)=>{S(a,e.chRedir(12,c,!0))}).add([66,18,64,77],(a,c)=>{S(a,e.chRedir(13,c,!0))}).add([66,18,64,78],(a,c)=>{S(a,e.chRedir(14,c,!0))}).add([66,18,64,79],(a,c)=>{S(a,e.chRedir(15,c,!0))}),t(this,$e).add([54,65],(a,c)=>{let f=t(e,B).x5=="81"?"05rw":"x5d";e.switchMode(f,!0),e.setPortMode(e.getTrackPort(c),1,w[f]);let s=a[a.length-1],i=a.subarray(0,a.length-1),o=xe(i);o!=s&&(console.info(`X5D multi parameters checksum mismatch! Expected ${o}, got ${s}.`),console.debug(a));let n=(a[1]<<7)+a[0],d=(a[3]<<7)+a[2],l=e.chRedir(n&15,c,!0),m=g.cc*l;[()=>{d<1||(d<101?(e.setChType(l,e.CH_MELODIC,w.x5d),t(e,A)[l]=d-1,t(e,p)[m+b[0]]=t(e,B).x5):d<229?(e.setChType(l,e.CH_MELODIC,w.x5d),t(e,A)[l]=d-101,t(e,p)[m+b[0]]=56):(e.setChType(l,e.CH_DRUMS,w.x5d),t(e,A)[l]=Kt[d-229]||0,t(e,p)[m+b[0]]=62)),e.dispatchEvent("voice",{part:l})},()=>{t(e,p)[m+b[7]]=d},()=>{d<31&&(t(e,p)[m+b[10]]=Math.round((d-15)*4.2+64))},()=>{t(e,p)[m+b[93]]=tt(d)},()=>{t(e,p)[m+b[91]]=tt(d)},()=>{t(e,R)[l*g.rpn+3]=d>8191?d-16320:64+d,t(e,L)[g.rpnt*l+2]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)})},()=>{t(e,R)[l*g.rpn+1]=d>8191?d-16320:64+d,t(e,L)[g.rpnt*l+1]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)})},()=>{d>0&&(t(e,R)[l*g.rpn]=d,t(e,L)[g.rpnt*l]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)}))},()=>{}][n>>4]()}).add([54,76,0],(a,c)=>{e.dispatchEvent("mupromptex");let f=t(e,B).x5=="81"?"05rw":"x5d";e.switchMode(f),e.setPortMode(e.getTrackPort(c),1,w[f]);let s="",i=t(e,B).x5,o=0,n=0,d="MSB	PRG	LSB	NME";le(a,function(l,m){if(m<16400){let $=m%164;switch(!0){case $<10:{l>31&&(s+=String.fromCharCode(l));break}case $==10:break;case $==11:{d+=`
${i}	${o}	${n}	${s.trim().replace("Init Voice","")}`,o++,s="";break}}o>99&&(i=90,o=0)}}),e.userBank.clearRange({msb:t(e,B).x5,prg:[0,99],lsb:0}),e.userBank.load(d),P()&&console.debug(d),e.forceVoiceRefresh()}).add([54,77,0],(a,c)=>{e.dispatchEvent("mupromptex");let f=t(e,B).x5=="81"?"05rw":"x5d";e.switchMode(f),e.setPortMode(e.getTrackPort(c),1,w[f]);let s="",i=90,o=0,n=0,d="MSB	PRG	LSB	NME";le(a,function(l,m){if(m<13600){let $=m%136;switch(!0){case $<10:{l>31&&(s+=String.fromCharCode(l));break}case $==11:{d+=`
${i}	${o}	${n}	${s.trim().replace("Init Combi","")}`,o++,s="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(d),P()&&console.debug(d),e.forceVoiceRefresh()}).add([54,78],(a,c)=>{let f=t(e,B).x5=="81"?"05rw":"x5d";e.switchMode(f),e.setPortMode(e.getTrackPort(c),1,w[f]),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][a[0]]} mode.`)}).add([54,85],(a,c)=>{e.dispatchEvent("mupromptex");let f=t(e,B).x5=="81"?"05rw":"x5d";e.switchMode(f),e.setPortMode(e.getTrackPort(c),1,w[f]),le(a,(s,i)=>{i>0&&i<3&&(e.setEffectType(i-1,44,s),e.dispatchEvent(`efx${["reverb","chorus"][i-1]}`,e.getEffectType(i-1)))})}).add([54,104],(a,c)=>{e.dispatchEvent("mupromptex");let f=t(e,B).x5=="81"?"05rw":"x5d";e.switchMode(f,!0);let s=e.getTrackPort(c);if(t(e,I)[s]&&t(e,I)[s]!=w[f])if(t(e,me).dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${c}. Port ${String.fromCharCode(65+s)} mode "${K[t(e,I)[s]]}" mismatch, should be "${f}".`);return}else console.info(`Track ${c} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);e.setPortMode(s,1,w[f]),le(a,function(i,o,n,d){if(o<192){let l=e.chRedir(Math.floor(o/12),c,!0),m=l*g.cc;switch(o%12){case 0:{i<128?(e.setChType(l,e.CH_MELODIC,w.x5d),t(e,p)[m+b[0]]=t(e,B).x5,t(e,A)[l]=i):(e.setChType(l,e.CH_DRUMS,w.x5d),t(e,p)[m+b[0]]=62,t(e,A)[l]=Kt[i-128]),i>0&&e.setChActive(l,1),e.dispatchEvent("voice",{part:l});break}case 1:{t(e,p)[m+b[7]]=i;break}case 2:{t(e,R)[l*g.rpn+3]=i>127?i-192:64+i,t(e,L)[g.rpnt*l+2]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)});break}case 3:{t(e,R)[l*g.rpn+1]=i>127?i-192:64+i,t(e,L)[g.rpnt*l+1]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)});break}case 4:{i<31&&(t(e,p)[m+b[10]]=Math.round((i-15)*4.2+64));break}case 5:{let $=i>>4,M=i&15;t(e,p)[m+b[91]]=tt(M),t(e,p)[m+b[93]]=tt($);break}case 10:break;case 11:{let $=e.chRedir(i&15,c,!0),M=i>>4;t(e,G)[l]=i,($!=l||M)&&(console.info(`X5D Part CH${l+1} receives from CH${$+1}.`),e.buildRchTree())}}}else{let l=e.chRedir(o-192,c,!0)}})}),t(this,ne).add([22,18,127],(a,c,f)=>{e.switchMode("mt32",!0),e.setPortMode(e.getTrackPort(c),1,w.mt32),x(e,N,!1),e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(a,c,f)=>{e.switchMode("mt32");let s=e.chRedir(f,c,!0),i=a[1];a.subarray(2).forEach((o,n)=>{let d=n+i;t(e,Me)[d+(s-1)*16]=o,([!1,()=>{let l=t(e,Me)[s-1<<4];if(l<3){if(t(e,ue)[s]=1,l==2)for(let m=0;m<name.length;m++)t(e,pe)[(s-1)*g.cmt+m]=t(e,Te)[o*g.cmt+m];else{let m=e.baseBank.get(0,o+(l<<6),127,"mt32").name;for(let $=0;$<m.length;$++)t(e,pe)[(s-1)*g.cmt+$]=m.charCodeAt($)}e.dispatchEvent("voice",{part:s})}},()=>{t(e,R)[s*g.rpn+3]=o+40,t(e,L)[g.rpnt*s+2]=1},()=>{t(e,R)[s*g.rpn+1]=o+14,t(e,L)[g.rpnt*s+1]=1},()=>{t(e,R)[s*g.rpn]=o,t(e,L)[g.rpnt*s]=1},!1,()=>{t(e,p)[g.cc*s+b[91]]=o?127:0},!1,()=>{t(e,p)[g.cc*s+b[7]]=o},()=>{t(e,p)[g.cc*s+b[10]]=Math.ceil(o*9.05)}][d]||(()=>{}))()})}).add([22,18,1],(a,c,f)=>{e.switchMode("mt32");let s=f&7;console.debug(`MT-32 slot #${f+1} Drum: ${a}`);let i=a[0]<<7|a[1];a.subarray(2).forEach((o,n)=>{let d=n+i,l=(d>>2)+24,m=d&3,$=s*g.dpn;if(P()&&console.debug(`MT-32 temp drum note ${l} param ${m}: ${o}`),l<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${l}`);return}[()=>{},()=>{t(e,Y)[($+de[26])*g.dnc+l]=Math.round(o*1.27)},()=>{t(e,Y)[($+de[26])*g.dnc+l]=o*9+1&127},()=>{t(e,Y)[($+de[26])*g.dnc+l]=o?127:0}][m]()})}).add([22,18,2],(a,c,f)=>{e.switchMode("mt32");let s=e.chRedir(f,c,!0),i=a[1]+(a[0]<<7);i<10&&(t(e,ue)[s]=1),a.subarray(2).forEach((o,n)=>{let d=n+i;d<14&&(t(e,pe)[(s-1)*g.cmt+d]=o)}),e.dispatchEvent("voice",{part:s})}).add([22,18,3],(a,c,f)=>{e.switchMode("mt32");let s=f&7;if(a[0]){let i=(a[0]-1<<7)+a[1]-16;a.subarray(2).forEach((o,n)=>{let d=n+i,l=(d>>2)+24,m=d&3,$=s*g.dpn;if(P()&&console.debug(`MT-32 dev drum note ${l} param ${m}: ${o}`),l<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${l}`);return}[()=>{},()=>{t(e,Y)[($+de[26])*g.dnc+l]=Math.round(o*1.27)},()=>{t(e,Y)[($+de[26])*g.dnc+l]=o*9+1&127},()=>{t(e,Y)[($+de[26])*g.dnc+l]=o?127:0}][m]()})}else{let i=a[1];a.subarray(2).forEach((o,n)=>{let d=n+i;t(e,Me)[d]=o;let l=e.chRedir(1+(d>>4),c,!0),m=d&15;([!1,()=>{let $=t(e,Me)[l-1<<4];if($<3)if(t(e,ue)[l]=1,$==2)for(let M=0;M<name.length;M++)t(e,pe)[(l-1)*g.cmt+M]=t(e,Te)[o*g.cmt+M];else{let M=e.baseBank.get(0,o+($<<6),127,"mt32").name;for(let U=0;U<M.length;U++)t(e,pe)[(l-1)*g.cmt+U]=M.charCodeAt(U)}e.dispatchEvent("voice",{part:l})},()=>{t(e,R)[l*g.rpn+3]=o+40,t(e,L)[g.rpnt*l+2]=1},()=>{t(e,R)[l*g.rpn+1]=o+14,t(e,L)[g.rpnt*l+1]=1},()=>{t(e,R)[l*g.rpn]=o,t(e,L)[g.rpnt*l]=1},!1,()=>{t(e,p)[g.cc*l+b[91]]=o?127:0},!1,()=>{t(e,p)[g.cc*l+b[7]]=o},()=>{t(e,p)[g.cc*l+b[10]]=Math.ceil(o*9.05)}][m]||(()=>{}))()})}}).add([22,18,4],(a,c,f)=>{e.switchMode("mt32");let s=a[1]+(a[0]<<7),i=[];a.subarray(2).forEach((o,n)=>{let d=n+s,l=e.chRedir(Math.floor(d/246+1),c,!0),m=d%246;m<14&&(t(e,pe)[(l-1)*g.cmt+m]=o),m<10&&(t(e,ue)[l]=1),i.indexOf(l)<0&&i.push(l)}),i.forEach(o=>{e.dispatchEvent("voice",{part:o})})}).add([22,18,5],(a,c,f)=>{e.switchMode("mt32");let s=(a[0]<<7)+a[1];a.subarray(2).forEach((i,o)=>{let n=s+o,d=Math.floor(n/8),l=n&7,m=d*8;t(e,We)[n]=i,([!1,()=>{let $=t(e,We)[m];if($<3){let M="";if($==2){let ge=g.cmt*d;M=`MT-m:${i.toString().padStart(3,"0")}`}else M=e.baseBank.get(0,i+($<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:d});let U=`MSB	LSB	PRG	NME
000	127	${d}	${M}`;e.userBank.load(U,!0)}}][l]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(a,c,f)=>{e.switchMode("mt32");let s=((a[0]&1)<<7)+a[1],i=a[0]>>1,o=!1;if(a.subarray(2).forEach((n,d)=>{let l=s+d;l<g.cmt&&(t(e,Te)[i*g.cmt+l]=n,o=!0)}),o){e.userBank.clearRange({msb:0,lsb:127,prg:i});let n=`MSB	LSB	PRG	NME
000	127	${i}	MT-m:${i}`;e.userBank.load(n,!0)}e.forceVoiceRefresh()}).add([22,18,16],(a,c,f)=>{e.switchMode("mt32");let s=a[1],i=!1,o=function(n,d){t(e,G)[d-12]=n,i=!0};a.subarray(2).forEach((n,d)=>{let l=d+s;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,o,o,o,o,o,o,o,o,o,()=>{x(e,H,n),e.dispatchEvent("mastervolume",t(e,H))}][l]||(()=>{}))(n,d)}),i&&e.buildRchTree()}).add([22,18,32],(a,c,f)=>{e.switchMode("mt32");let s=a[1],i=" ".repeat(s);a.subarray(2).forEach(o=>{o>31?i+=String.fromCharCode(o):i+=" "}),x(e,Re,i.padStart(20," ")),x(e,De,Date.now()+3200)}).add([22,18,82],(a,c)=>{let f=e.chRedir(0,c,!0);for(let s=0;s<16;s++)t(e,_).ano(f+s),s&&s<10&&(t(e,A)[f+s]=Et[s-1]);console.info("MT-32 alt reset complete.")}),t(this,$e).add([66,0],(a,c)=>{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(c),2,w.ns5r),x(e,N,!1),console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][a[0]]} mode.`)}).add([66,1],(a,c)=>{let f=["ns5r","05rw"][a[0]];e.switchMode(f,!0),e.setPortMode(e.getTrackPort(c),2,w[f]),x(e,N,!1)}).add([66,18,0,0],(a,c)=>{let f=a[0];switch(f){case 124:case 126:case 127:{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(c),2,w.ns5r),x(e,N,!1);break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset: ${a}`);break}default:if(f<10){let s=[0,0,0,0],i=(o,n)=>{s[n]=o};if(a.subarray(1).forEach((o,n)=>{[i,i,i,i,()=>{x(e,H,o*129/16383*100),e.dispatchEvent("mastervolume",t(e,H))},()=>o-64,()=>o-64,()=>{},()=>{},()=>{}][f+n]()}),a[0]<4){let o=0;s.forEach(n=>{o=o<<4,o+=n}),o-=1024}}}}).add([66,18,0,1],(a,c)=>{}).add([66,18,0,2],(a,c)=>{}).add([66,18,1],(a,c)=>{e.dispatchEvent("mupromptex");let f=e.chRedir(a[0],c,!0),s=f*g.cc,i=a[1],o=`NS5R CH${f+1} `;a.subarray(2).forEach((n,d)=>{let l=i+d;l<3?([()=>{t(e,p)[s+b[0]]=n||Fe.bank0},()=>{t(e,p)[s+b[32]]=n},()=>{t(e,A)[f]=n}][l](),e.dispatchEvent("voice",{part:f})):l<8||(l<14?[()=>{let m=e.chRedir(n,c,!0);t(e,G)[f]=m,f!=m&&(e.buildRchTree(),console.info(`${o}receives from CH${m+1}`))},()=>{t(e,Z)[f]=+!n},()=>{e.setChType(f,n,w.ns5r),console.debug(`${o}type: ${et[n]}`)},()=>{t(e,R)[g.rpn*f+3]=n,t(e,L)[g.rpnt*f+2]=1,e.dispatchEvent("pitch",{part:f,pitch:e.getPitchShift(f)})},()=>{},()=>{}][l-8]():l<16||(l<33?[()=>{t(e,p)[s+b[7]]=n},()=>{t(e,p)[s+b[11]]=n},()=>{},()=>{},()=>{t(e,p)[s+b[10]]=n||128},()=>{},()=>{},()=>{t(e,p)[s+b[93]]=n},()=>{t(e,p)[s+b[91]]=n},()=>{t(e,p)[s+b[76]]=n},()=>{t(e,p)[s+b[77]]=n},()=>{t(e,p)[s+b[78]]=n},()=>{t(e,p)[s+b[74]]=n},()=>{t(e,p)[s+b[71]]=n},()=>{t(e,p)[s+b[73]]=n},()=>{t(e,p)[s+b[75]]=n},()=>{t(e,p)[s+b[72]]=n}][l-16]():l<112||l<114&&[()=>{t(e,p)[s+b[5]]=n},()=>{t(e,p)[s+b[65]]=n}][l-112]()))})}).add([66,18,8,0],(a,c)=>{let f=a[0];if(f<32)e.setLetterDisplay(a.subarray(1,33),"NS5R letter display");else{let s=f-32;x(e,fe,Date.now()+3200),x(e,W,10),t(e,se,ve).fill(0);let i=a.subarray(1),o=4;i.forEach(function(n,d){let l=d+s,m=l>>4,$=l&15;if(l<80){let M=m<o?n:n>>3,U=0,ge=m<o?6:3;for(;M>0;)t(e,se,ve)[$*32+m*7+(ge-U)]=M&1,M=M>>1,U++}})}}).add([66,18,48],(a,c,f)=>{E(0,a)}).add([66,18,49],(a,c,f)=>{E(1,a)}).add([66,18,50],(a,c,f)=>{E(2,a)}).add([66,18,51],(a,c,f)=>{E(3,a)}).add([66,18,52],(a,c,f)=>{E(4,a)}).add([66,18,53],(a,c,f)=>{E(5,a)}).add([66,18,54],(a,c,f)=>{E(6,a)}).add([66,18,55],(a,c,f)=>{E(7,a)}).add([66,52],(a,c)=>{e.switchMode("ns5r"),x(e,N,!1);let f="";le(a,(s,i)=>{i<8?(s>31&&(f+=String.fromCharCode(s)),i==7&&(e.aiEfxName=f)):i<10&&(e.setEffectType(i-8,44,s),e.dispatchEvent(`efx${["reverb","chorus"][i-8]}`,e.getEffectType(i-8)))})}).add([66,53],(a,c)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r"),x(e,N,!1);let f="",s=a[a.length-1],i=a.subarray(0,a.length-1),o=xe(i);o!=s&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${o}, got ${s}.`),console.debug(a));let n=e.getTrackPort(c);if(t(e,I)[n]&&t(e,I)[n]!=w.ns5r)if(t(e,me).dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${c}. Port ${String.fromCharCode(65+n)} mode "${K[t(e,I)[n]]}" mismatch, should be "ns5r".`);return}else console.info(`Track ${c} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+n)}.`);e.setPortMode(n,2,w.ns5r),le(i,function(d,l){switch(!0){case l<2944:{let m=e.chRedir(Math.floor(l/92),c,!0),$=m*g.cc;switch(l%92){case 0:{t(e,p)[$+b[0]]=d,e.dispatchEvent("voice",{part:m});break}case 1:{t(e,p)[$+b[32]]=d,!d&&!t(e,p)[$+b[0]]&&(t(e,p)[$+b[0]]=Fe.bank0),e.dispatchEvent("voice",{part:m});break}case 2:{t(e,A)[m]=d,d>0&&e.setChActive(m,1),e.dispatchEvent("voice",{part:m});break}case 3:{let M=e.chRedir(d,c,!0);t(e,G)[m]=M,m!=M&&(console.info(`NS5R CH${m+1} receives from CH${M+1}.`),e.buildRchTree());break}case 7:{t(e,D)[m]=d,e.dispatchEvent("voice",{part:m});break}case 8:{t(e,R)[m*g.rpn+3]=d<40||d>88?d+(d>63?-192:64):d,t(e,L)[g.rpnt*m+2]=1,e.dispatchEvent("pitch",{part:m,pitch:e.getPitchShift(m)});break}case 9:case 10:{t(e,p)[$+b[7]]=d;break}case 11:{t(e,p)[$+b[11]]=d;break}case 14:{t(e,p)[$+b[10]]=d||128;break}case 19:{t(e,p)[$+b[93]]=d;break}case 20:{t(e,p)[$+b[91]]=d;break}case 84:{t(e,p)[$+b[65]]=d;break}case 85:{t(e,p)[$+b[5]]=d;break}}break}case l<3096:break;case l<3134:{let m=l-3096;m<8?(d>31&&(f+=String.fromCharCode(d)),m==7&&(e.aiEfxName=f)):m<10&&(e.setEffectType(m-8,44,d),e.dispatchEvent(`efx${["reverb","chorus"][m-8]}`,e.getEffectType(m-8)));break}case l<8566:break}})}).add([66,54],(a,c)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r");let f="",s=80,i=0,o=0,n="MSB	PRG	LSB	NME";le(a,function(d,l){let m=l%158;switch(!0){case m<10:{d>31&&(f+=String.fromCharCode(d));break}case m==10:break;case m==11:{s=d&127;break}case m==12:{o=d&127;break}case m==13:{n+=`
${s}	${i}	${o}	${f.trim().replace("Init Voice","")}`,i++,f="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(n),P()&&console.debug(n),e.forceVoiceRefresh()}).add([66,55],(a,c)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r");let f="",s=88,i=0,o=0,n="MSB	PRG	LSB	NME";le(a,function(d,l){let m=l%126;switch(!0){case m<10:{d>31&&(f+=String.fromCharCode(d));break}case m==11:break;case m==12:break;case m==13:{n+=`
${s}	${i}	${o}	${f.trim().replace("Init Combi","")}`,i++,f="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(n),P()&&console.debug(n),e.forceVoiceRefresh()}).add([66,125],(a,c,f)=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][a[0]]||"white")}).add([66,127],(a,c,f)=>{let s=a[a.length-1],i=a.subarray(0,a.length-1),o=xe(i);o!=s&&(console.info(`NS5R screen dump checksum mismatch! Expected ${o}, got ${s}.`),console.debug(a));let n=new Uint8Array(5760);le(a,(d,l,m)=>{if(l<720)for(let $=0;$<8;$++)n[l*8+$]=d>>7-$&1}),e.dispatchEvent("screen",{type:"ns5r",data:n})}).add([76],(a,c,f)=>{t(e,$e).run([66,...a],c,f)}),t(this,Ie).add([16,0,8,0],(a,c,f)=>{let s=(a[2]<<4)+a[3],i="K11 ";([()=>{e.switchMode("k11",!0),e.setPortMode(e.getTrackPort(c),2,w.k11),x(e,N,!1),t(e,F)[w.k11][1]=s?4:0,console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,s),console.debug(`${i}reverb type: ${s}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{console.debug(`${i}reverb time: ${s}`)},()=>{console.debug(`${i}reverb time: ${s}`)},()=>{console.debug(`${i}reverb predelay: ${s}`)},()=>{console.debug(`${i}reverb predelay: ${s}`)},()=>{console.debug(`${i}depth high: ${s}`)},()=>{console.debug(`${i}depth high: ${s}`)},()=>{console.debug(`${i}depth low: ${s}`)},()=>{console.debug(`${i}depth low: ${s}`)}][a[0]]||(()=>{}))()}).add([16,0,8,1],(a,c,f)=>{e.dispatchEvent("mupromptex");let s=e.chRedir(a[1],c,!0),i=g.cc*s,o=g.rpn*s,n=(a[3]<<4)+a[4],d=`K11 CH${s+1} `;([()=>{n<128?(e.setChType(s,e.CH_MELODIC,w.k11),t(e,p)[i+b[0]]=0,t(e,A)[s]=n):(e.setChType(s,e.CH_DRUMS,w.k11),t(e,A)[s]=n-128),e.dispatchEvent("voice",{part:s})},()=>{let l=e.chRedir(n,c,!0);t(e,G)[s]=l,s!=l&&(e.buildRchTree(),console.info(`${d}receives from CH${l+1}`))},()=>{t(e,p)[i+b[7]]=n},()=>{uupThis.setChActive(s,n)},()=>{t(e,p)[i+b[10]]=n},()=>{t(e,R)[o+3]=n+40,t(e,L)[g.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{t(e,R)[o+1]=n>>1,t(e,R)[o+2]=n&1,t(e,L)[g.rpnt*s+1]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{t(e,p)[i+b[91]]=n?127:0},()=>{},()=>{t(e,p)[i+b[74]]=n},()=>{t(e,p)[i+b[73]]=n},()=>{t(e,p)[i+b[72]]=n}][a[0]]||(()=>{}))()}).add([16,0,9,0],(a,c,f)=>{e.dispatchEvent("mupromptex");let s=(a[2]<<4)+a[3],i="GMLX ";([()=>{console.debug(`${i}reverb type: ${s}`)},()=>{console.debug(`${i}reverb time: ${s}`)},()=>{console.debug(`${i}reverb predelay: ${s}`)},()=>{console.debug(`${i}depth high: ${s}`)},()=>{console.debug(`${i}depth low: ${s}`)}][a[0]]||(()=>{}))()}).add([16,0,9,3],(a,c,f)=>{e.dispatchEvent("mupromptex");let s=(a[2]<<4)+a[3],i=e.chRedir(a[1],c,!0),o=i*g.cc;[()=>{s<128?(e.setChType(i,e.CH_MELODIC,w.k11),t(e,p)[o+b[0]]=0,t(e,p)[o+b[32]]=0,t(e,A)[i]=s):s<160?(e.setChType(i,e.CH_MELODIC,w.k11),t(e,p)[o+b[0]]=0,t(e,p)[o+b[32]]=7,t(e,A)[i]=s-100):(e.setChType(i,e.CH_DRUMS,w.k11),t(e,p)[o+b[0]]=122,t(e,p)[o+b[32]]=0,t(e,A)[i]=s-160),e.dispatchEvent("voice",{part:i})},()=>{let n=e.chRedir(s,c,!0);t(e,G)[i]=n,i!=n&&(e.buildRchTree(),console.info(`GMLX CH${i+1} receives from CH${n+1}`))}][a[0]]()}).add([16,0,9,4],(a,c,f)=>{e.dispatchEvent("mupromptex");let s=(a[2]<<4)+a[3],i=e.chRedir(a[1],c,!0),o=i*g.cc,n=i*g.rpn,d=`GMLX CH${i+1} `;[()=>{e.setChActive(i,s)},()=>{t(e,p)[o+b[7]]=s},()=>{t(e,p)[o+b[10]]=s},()=>{t(e,p)[o+b[91]]=s?127:0},()=>{t(e,R)[n+3]=s+40,t(e,L)[g.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{t(e,R)[n+1]=s,t(e,L)[g.rpnt*i+1]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{t(e,R)[n]=s,t(e,L)[g.rpnt*i]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{}][a[0]]()}),t(this,_e).add([66,93,64],(a,c,f)=>{let s=a[2];switch(a[0]){case 0:{switch(a[1]){case 4:{e.dispatchEvent("mupromptex"),x(e,H,s*129/16383*100),e.dispatchEvent("mastervolume",t(e,H));break}case 5:{e.dispatchEvent("mupromptex"),s-64;break}case 6:{e.dispatchEvent("mupromptex"),console.debug(`SG global reverb: ${s?"on":"off"}`);break}case 127:{e.switchMode("sg",!0),e.setPortMode(e.getTrackPort(c),1,w.sg);break}}break}case 1:{switch(a[1]){case 48:{e.dispatchEvent("mupromptex"),console.debug(`SG reverb type: ${bt[s]}`);break}}break}default:if(a[0]>>4==1){e.dispatchEvent("mupromptex");let i=e.chRedir(a[0]&15,c,!0);if(a[1]==2){let o=e.chRedir(s,c,!0);t(e,G)[i]=o,i!=o&&(e.buildRchTree(),console.info(`SG CH${i+1} receives from CH${o+1}`))}else a[1]==19&&(t(e,p)[g.cc*i+b[7]]=s)}else console.warn(`Unknown AKAI SG SysEx: ${a}`)}}),t(this,Ge).add([9],(a,c,f)=>{e.dispatchEvent("mupromptex"),console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremolo","phaser","rotary speaker","enhancer","flanger","EQ"][a[0]]||"off"}`)}),t(this,re).add([127,0],(a,c,f)=>{e.switchMode("motif");let s=new Uint8Array([127,1,...a]);t(e,re).run(s,c,f)}).add([127,1,0,0],(a,c,f)=>{e.switchMode("s90es");let s="S90/Motif ES system ",i=a[0];a.subarray(1).forEach((o,n)=>{([()=>{x(e,H,o*12900/16383),e.dispatchEvent("mastervolume",t(e,H))}][i+n]||(()=>{console.info(`Unrecognized ${s}ID: ${i+n}`)}))()})}).add([127,1,0,36,54,1],(a,c,f)=>{e.switchMode("s90es");let s="S90/Motif ES reverb ",i=a[0];a.subarray(1).forEach((o,n)=>{([()=>{e.setEffectTypeRaw(0,!1,o&15|112)},()=>{e.setEffectTypeRaw(0,!0,o)}][i+n]||(()=>{}))()}),e.dispatchEvent("efxreverb",e.getEffectType(0))}).add([127,1,0,37,54,2],(a,c,f)=>{e.switchMode("s90es");let s="S90/Motif ES chorus ",i=a[0];a.subarray(1).forEach((o,n)=>{([()=>{e.setEffectTypeRaw(1,!1,o&15|112)},()=>{e.setEffectTypeRaw(1,!0,o)}][i+n]||(()=>{}))()}),e.dispatchEvent("efxchorus",e.getEffectType(1))}).add([127,1,0,34,54,3],(a,c,f)=>{e.switchMode("s90es");let s="S90/Motif ES insert 1 ",i=a[0];a.subarray(1).forEach((o,n)=>{([()=>{e.setEffectTypeRaw(3,!1,o&15|112)},()=>{e.setEffectTypeRaw(3,!0,o)}][i+n]||(()=>{}))()}),e.dispatchEvent("efxinsert0",e.getEffectType(3))}).add([127,1,0,34,54,4],(a,c,f)=>{e.switchMode("s90es");let s="S90/Motif ES insert 2 ",i=a[0];a.subarray(1).forEach((o,n)=>{([()=>{e.setEffectTypeRaw(4,!1,o&15|112)},()=>{e.setEffectTypeRaw(4,!0,o)}][i+n]||(()=>{}))()}),e.dispatchEvent("efxinsert1",e.getEffectType(4))}).add([127,1,0,35,54,17],(a,c,f)=>{e.switchMode("s90es");let s="S90/Motif ES variation ",i=a[0];a.subarray(1).forEach((o,n)=>{([()=>{e.setEffectTypeRaw(2,!1,o&15|112)},()=>{e.setEffectTypeRaw(2,!0,o)}][i+n]||(()=>{}))()}),e.dispatchEvent("efxdelay",e.getEffectType(2))}).add([127,1,0,58,55],(a,c,f)=>{e.dispatchEvent("mupromptex"),e.switchMode("s90es");let s=e.getTrackPort(c);if(t(e,I)[s]&&t(e,I)[s]!=t(e,B).smotif)if(t(e,me).dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${c}. Port ${String.fromCharCode(65+s)} mode "${K[t(e,I)[s]]}" mismatch, should be "${K[t(e,B).smotif]}".`);return}else console.info(`Track ${c} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);let i=e.chRedir(a[0],c,!0),o=g.cc*i,n=a[1];a[0]>15&&(i=a[0]+32);let d=`Track ${c} S90/Motif ES bulk CH${i<128?i+1:"U"+(i-127)} `;console.debug(d,a),!(a[0]>15)&&a.subarray(2).forEach((l,m)=>{([()=>{t(e,p)[o+b[0]]=l,e.dispatchEvent("voice",{part:i})},()=>{l&&e.setChActive(i,1),t(e,p)[o+b[32]]=l,e.setChType(i,[32,40].indexOf(l)>-1?e.CH_DRUMS:e.CH_MELODIC,t(e,O),!0),e.dispatchEvent("voice",{part:i})},()=>{l&&e.setChActive(i,1),t(e,A)[i]=l,e.dispatchEvent("voice",{part:i})},()=>{let $=e.chRedir(l,c,!0);t(e,G)[i]=$,i!=$&&(e.buildRchTree(),console.info(`${d}receives from CH${$+1}`))},()=>{t(e,Z)[i]=l?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{l!=100&&e.setChActive(i,1),t(e,p)[o+b[7]]=l},()=>{l!=64&&e.setChActive(i,1),t(e,p)[o+b[10]]=l},!1,!1,!1,()=>{t(e,p)[o+b[91]]=l},()=>{l&&e.setChActive(i,1),t(e,p)[o+b[93]]=l},()=>{l&&e.setChActive(i,1),t(e,p)[o+b[94]]=l},()=>{l!=127&&e.setChActive(i,1),t(e,p)[o+b[128]]=l,e.allocateAce(128)},()=>{},()=>{l!=64&&e.setChActive(i,1),t(e,p)[o+b[74]]=l},()=>{l!=64&&e.setChActive(i,1),t(e,p)[o+b[71]]=l},!1,()=>{t(e,p)[o+b[65]]=l},()=>{t(e,p)[o+b[5]]=l},()=>{}][n+m]||(()=>{}))()})}).add([127,1,54,16],(a,c,f)=>{e.switchMode("s90es");let s=a[0];a.subarray(1).forEach((i,o)=>{let d=`S90/Motif ES EQ${(o>>2)+1} `;([()=>{let l=i-64},()=>{let l=Ve[i]},()=>{let l=i/10},()=>{let l=i}][s+o&3]||(()=>{}))()})}),t(this,ne).add([0,72,18,0,0,0,0],(a,c,f)=>{e.switchMode("sd",!0),e.setPortMode(e.getTrackPort(c),2,w.sd),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(a,c,f)=>{e.dispatchEvent("mupromptex");let s=a[0]>>5,i=a[0]&31;switch(s){case 0:{let o=a[0]>>1,n=a[1];switch(o){case 1:{a.subarray(2).forEach((d,l,m)=>{let $=l+n;switch($){case 0:{d&&(e.setEffectType(1,60,d-1),e.dispatchEvent("efxchorus",e.getEffectType(1)),console.debug(`SD MFX Cho: ${$} - ${d}`));break}}});break}case 2:{a.subarray(2).forEach((d,l)=>{let m=l+n;switch(m){case 0:{d&&(e.setEffectType(0,55+d,0),e.dispatchEvent("efxreverb",e.getEffectType(0)),console.debug(`SD MFX Rev: ${m} - ${d}`));break}}});break}case 3:case 4:case 5:{let d=o-1;a.subarray(2).forEach((l,m)=>{let $=m+n;switch(console.debug(`SD MFX ${d-2}: ${$} - ${l}`),$){case 0:{e.setEffectTypeRaw(d,62,l),e.dispatchEvent(`efx${d>2?"delay":"insert"+(d-4)}`,e.getEffectType(d));break}}}),console.debug(`SD MFX message:
%o`,a);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,a)}break}case 1:{let o=e.chRedir(i,c,!0),n=a[1],d=o*g.cc;a.subarray(2).forEach((l,m)=>{let $=n+m;$<37?([()=>{},()=>{},0,()=>{},()=>{switch(t(e,p)[d+b[0]]=l,l){case 104:case 105:case 106:case 107:case 120:{t(e,D)[o]||e.setChType(o,e.CH_DRUMS);break}default:t(e,D)[o]&&e.setChType(o,e.CH_MELODIC)}e.dispatchEvent("voice",{part:o})},()=>{t(e,p)[d+b[32]]=l,e.dispatchEvent("voice",{part:o})},()=>{t(e,A)[o]=l,e.dispatchEvent("voice",{part:o})},()=>{t(e,p)[d+b[7]]=l},()=>{t(e,p)[d+b[10]]=l},()=>{},()=>{},()=>{l<2&&(t(e,Z)[o]=l)},()=>{l<2&&(t(e,p)[d+b[68]]=l?127:0)},()=>{},()=>{l<2&&(t(e,p)[d+b[65]]=l?127:0)},()=>{t(e,p)[d+b[5]]=l&15<<4|t(e,p)[d+b[5]]&15},()=>{t(e,p)[d+b[5]]=l&15|(t(e,p)[d+b[5]]&240)>>4},()=>{t(e,p)[d+b[74]]=l},()=>{t(e,p)[d+b[71]]=l},()=>{t(e,p)[d+b[73]]=l},()=>{t(e,p)[d+b[72]]=l},0,0,0,0,0,0,0,()=>{t(e,p)[d+b[128]]=l,e.allocateAce(128)},()=>{t(e,p)[d+b[93]]=l},()=>{t(e,p)[d+b[91]]=l},0,0,()=>{t(e,p)[d+b[75]]=l},()=>{t(e,p)[d+b[76]]=l},()=>{t(e,p)[d+b[77]]=l},()=>{t(e,p)[d+b[78]]=l}][$]||(()=>{}))():$<63||($<64?(t(e,D)[o]?t(e,p)[d+b[0]]=104|l:t(e,p)[d+b[0]]=96|l,e.dispatchEvent("voice",{part:o})):console.debug(`Unknown SD-90 global CH${o+1} param setup message:
%o`,a))});break}case 2:{let o=e.chRedir(i,c,!0),n=a[1];console.debug(`Unknown SD-90 global CH${o+1} MIDI setup message:
%o`,a.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,a)}}),t(e,$e).add([0,1,73,78],(a,c,f)=>{e.switchMode("krs"),e.setPortMode(e.getTrackPort(c),1,w.krs),console.debug("Might be KORG KROSS 2 mode reset... Not sure.")}).add([0,1,73,117,2,37],(a,c,f)=>{e.switchMode("krs");let s=e.getTrackPort(c);if(t(e,I)[s]&&t(e,I)[s]!=w.krs)if(t(e,me).dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled. Port ${String.fromCharCode(65+s)} mode "${K[t(e,I)[s]]}" mismatch, should be "krs".`);return}else console.info(`Track ${c} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);e.setPortMode(e.getTrackPort(c),1,w.krs);let i="KROSS 2 BMT1 ",o="";le(a,(n,d)=>{if(d<24)o+=String.fromCharCode(Math.max(32,n));else if(!(d<1276)){let l=d-1276,m=e.chRedir(Math.floor(l/44),c,!0),$=l%44,M=g.cc*m;$<15?([()=>{n&&e.setChActive(m,1),t(e,A)[m]=n,e.dispatchEvent("voice",{part:m})},()=>{n&&e.setChActive(m,1),n<10?(t(e,p)[M+b[0]]=63,t(e,p)[M+b[32]]=n):n<20?(t(e,p)[M+b[0]]=121,t(e,p)[M+b[32]]=n-10):n<24&&(t(e,p)[M+b[0]]=[120,0,56,62][n-20],t(e,p)[M+b[32]]=0),e.dispatchEvent("voice",{part:m})},()=>{let U=e.chRedir(n&15,c,!0);t(e,G)[m]=U,console.info(`${i}CH${m+1} receives from CH${U+1}`),n>>5&1||(e.setChActive(m,0),console.debug(`KORG KROSS 2 CH${m+1} is disabled.`))},!1,!1,()=>{t(e,p)[M+b[7]]=n},!1,()=>{},()=>{},!1,!1,!1,!1,!1,()=>{t(e,p)[M+b[10]]=n||128}][$]||(()=>{}))():$<36||([()=>{t(e,p)[M+b[74]]=(n+128&255)-64},()=>{t(e,p)[M+b[71]]=(n+128&255)-64},!1,!1,()=>{t(e,p)[M+b[73]]=(n+128&255)-64},()=>{t(e,p)[M+b[75]]=(n+128&255)-64},!1,()=>{t(e,p)[M+b[72]]=(n+128&255)-64}][$]||(()=>{}))()}}),o=o.trimRight(),e.dispatchEvent("metacommit",{type:"EORTitle",data:o})})}chRedir(e,r,h){let u=this;if(t(u,Pe)[r])return(t(u,Pe)[r]-1)*16+e;if(t(u,O)==w.sc){if(h==1)return e;let E=0,v=!0;for(;v;)t(u,Se)[e+E]==0?(t(u,Se)[e+E]=r,console.debug(`Assign track ${r} to channel ${e+E+1}.`),v=!1):t(this,Se)[e+E]==r?v=!1:(E+=16,E>=128&&(E=0,v=!1));return e+E}else return e}getTrackPort(e){return this.chRedir(0,e,!0)>>4}forceVoiceRefresh(){for(let e=0;e<g.ch;e++)t(this,ie)[e]&&this.dispatchEvent("voice",{part:e})}buildRchTree(){let e=[];t(this,G).forEach((r,h)=>{var u;r<g.ch&&((u=e[r])!=null&&u.constructor||(e[r]=[]),e[r].push(h))}),x(this,ct,e)}buildRccMap(){let e=this;for(let r=0;r<g.ch;r++)t(e,Ue)[r]={};t(e,Ae).forEach((r,h)=>{r&&(t(e,Ue)[Math.floor(h/g.redir)][r]=h%g.redir|128)}),P()&&console.debug(t(e,Ue))}getActive(){return t(this,ie)}getCc(e){let r=this,h=e*g.cc,u=t(r,p).subarray(h,h+g.cc);return u[b[0]]=u[b[0]]||t(r,F)[r.getChModeId(e)][0],u[b[32]]=u[b[32]]||t(r,F)[r.getChModeId(e)][1],u[b[0]]==Fe.bank0&&(u[b[0]]=0),u}getCcCh(e,r){let h=this;if(at.indexOf(r)<0)throw new Error("CC number not accepted");let u=t(h,p)[g.cc*e+b[r]];switch(r){case 0:{u=u||t(h,F)[h.getChModeId(e)][0],u==Fe.bank0&&(u=0);break}case 32:{u=u||t(h,F)[h.getChModeId(e)][1];break}}return u}getCcAll(){let e=this,r=t(e,p).slice();for(let h=0;h<g.ch;h++){let u=h*g.cc;r[u+b[0]]=r[u+b[0]]||t(e,F)[e.getChModeId(h)][0],r[u+b[32]]=r[u+b[32]]||t(e,F)[e.getChModeId(h)][1],r[b[0]]==Fe.bank0&&(r[b[0]]=0)}return r}getChSource(){return t(this,G)}getChType(){return t(this,D)}setChType(e,r,h=t(this,O),u=!1){r&=15,t(this,D)[e]=r,r>0&&!u&&(t(this,p)[e*g.cc+b[0]]=yt[h])}setChActive(e,r=0){t(this,ie)[e]!=r&&this.dispatchEvent("channeltoggle",{part:e,active:r}),t(this,ie)[e]=r}getExt(e){let r=g.ext*e,h=t(this,ee).subarray(r,r+g.ext),u=new Uint8Array(h.length);return u.set(h),u[1]=u[1]||t(this,lt),u}getPitch(){return t(this,ke)}getProgram(){return t(this,A)}getTexts(){return t(this,ae).slice()}getVel(e){let r=new Map,h=this;return t(h,V).forEach(function(u,E){let v=Math.floor(u/128),k=u%128;e==v&&t(h,X)[u]>0&&r.set(k,{v:t(h,X)[u],s:t(h,z)[E]})}),r}getBitmap(){return{bitmap:t(this,se,ve),expire:t(this,fe)}}getLetter(){return{text:t(this,Re),set:t(this,it),expire:t(this,De)}}getMode(){return K[t(this,O)]}getMaster(){return{volume:t(this,H)}}getRawStrength(){let e=this;return t(this,V).forEach(function(r){let h=Math.floor(r/128);t(e,X)[r]>t(e,ye)[h]&&(t(e,ye)[h]=t(e,X)[r])}),t(this,ye)}getStrength(){let e=[],r=this;return this.getRawStrength().forEach(function(h,u){e[u]=Math.floor(h*t(r,p)[u*g.cc+b[7]]*t(r,p)[u*g.cc+b[11]]*t(r,H)/803288)}),e}getRpn(){return t(this,R)}getNrpn(){return t(this,Ke)}getVoice(e,r,h,u){let E=this,v=e||t(E,F)[t(E,O)][0],k=r,S=h||t(E,F)[t(E,O)][1];v==Fe.bank0&&(v=0),K[t(E,O)]=="ns5r"&&v>0&&v<56&&(S=3);let a=E.userBank.get(v,k,S,u);if(K[t(E,O)]=="mt32"&&a.name.indexOf("MT-m:")==0){let c=parseInt(a.name.slice(5)),f=c*g.cmt,s="";t(E,Te).subarray(f,f+10).forEach(o=>{o>31&&(s+=String.fromCharCode(o))});let i=`MSB	LSB	PRG	NME
0	127	${k}	${s}`;E.userBank.load(i,!0),a.name=s,a.ending=" "}return(a.ending!=" "||!a.name.length)&&(a=E.baseBank.get(v,k,S,u)),a}getChVoice(e){let r=this,h=r.getVoice(r.getCcCh(e,0),t(r,A)[e],r.getCcCh(e,32),r.getChMode(e));if(t(r,ue)[e]){let u="";switch(t(r,O)){case w.mt32:{t(r,pe).subarray(g.cmt*(e-1),g.cmt*(e-1)+10).forEach(E=>{u+=String.fromCharCode(Math.max(E,32))}),u=u.trimRight();break}default:{let E=g.cvn*e;t(r,rt).subarray(E,E+g.cvn).forEach(v=>{u+=String.fromCharCode(Math.max(v,32))}),u=u.trimRight()}}u.length&&(h.ending="~",h.name=u)}return h}getRawPitch(){return t(this,ke)}getPitchShift(e){let r=this,h=e*g.rpn,u=t(r,R)[h];return t(r,L)[e*g.rpnt]||t(r,O)==w.mt32&&(u=12),t(r,ke)[e]/8192*u+(t(r,R)[h+3]-64)+((t(r,R)[h+1]<<7)+t(r,R)[h+2]-8192)/8192}getEffectType(e=0){let r=3*e+1;return t(this,te).subarray(r,r+2)}setEffectTypeRaw(e=0,r,h){let u=3*e;t(this,te)[u]=1,t(this,te)[u+1+ +r]=h}setEffectType(e=0,r,h){this.setEffectTypeRaw(e,!1,r),this.setEffectTypeRaw(e,!0,h)}getEffectSink(){return t(this,ze)}setLetterDisplay(e,r,h=0,u=3200){let E=this,v;x(E,Re," ".repeat(h)),e.forEach(k=>{x(E,Re,t(E,Re)+String.fromCharCode(k>31?k:32)),k<32&&(v=v||new Set,v.add(k))}),x(E,it,Date.now()),x(E,De,Date.now()+u),v&&(v=Array.from(v),v.forEach((k,S,a)=>{a[S]=k.toString(16).padStart(2,"0")}),console.warn(`${r}${r?" ":""}invalid code point${v.length>1?"s":""}: 0x${v.join(", 0x")}`))}setDetectionTargets(e="?",r=0){let h=this,u=-1;switch(e.replaceAll(", ",",").split(",").forEach(E=>{E=E.toLowerCase();let v=K.indexOf(aa[E]||E);P()&&console.debug(`Mapped mode "${E}" to ID "${v}".`),v>-1&&(u=v)}),P()&&console.debug(`Set detection target to ID "${u}".`),u>0&&(t(h,B).x5=82,t(h,B).ds=w.krs),u){case w["05rw"]:{t(h,B).x5=81;break}case w.s90es:t(h,B).ds=w.s90es,t(h,B).smotif=w.s90es;case w.motif:t(h,B).ds=w.motif,t(h,B).smotif=w.motif}}setGsTargets(e=!1,r=4){if(!r)r=e?3:4;else{if(r>4||r<0)throw new Error(`Invalid GS level ${r}`);if(e&&r>>1!=1)throw new Error(`Invalid SC level ${r}`)}let h=this;t(h,B)[e?"sc":"gs"]=r,t(h,F)[w[e?"sc":"gs"]][1]=r,h.forceVoiceRefresh()}getConfigs(){return t(this,st)}setDumpLimit(e){if(e>2||e<0)throw new RangeError("Invalid dump limit.");t(this,me).dumpLimit=e}allocateAce(e){if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}let r=!0,h=0;for(;r&&h<g.ace;)t(this,ce)[h]==e?r=!1:t(this,ce)[h]||(r=!1,t(this,ce)[h]=e,console.info(`Allocated cc${e} to ACE slot ${h}.`)),h++;h>=g.ace&&console.warn("ACE slots are full.")}releaseAce(e){let r=!0,h=0;for(;r&&h<g.ace;)t(this,ce)[h]==e&&(t(this,ce)[h]=0,r=!1),h++;r&&P()&&console.debug(`No ACE slot was allocated to cc${e}.`)}resetAce(){t(this,ce).fill(0),console.info("All ACE slots have been reset.")}getAce(){return t(this,ce)}getChAce(e,r){if(r<0||r>=g.ace)throw new RangeError("No such ACE slot");let h=t(this,ce)[r];if(h){if(at.indexOf(h)>=0)return t(this,p)[e*g.cc+b[h]];throw new Error(`Invalid ACE source: ${h}`)}else return 0}initDrums(){let e=this;t(e,Y).fill(64);for(let r=0;r<g.drm;r++){let h=r*g.dpn;for(let u in Ft){let E=Ft[u],v=(h+de[u])*g.dnc;t(e,Y).subarray(v,v+g.dnc).fill(E)}}}init(e=0){let r=this;x(r,Le,0),t(r,F)[w.xg][1]=0,r.dispatchEvent("banklevel",{mode:"xg",data:0}),t(r,ie).fill(0),t(r,p).fill(0),t(r,ce).fill(0),t(r,A).fill(0),t(r,X).fill(0),t(r,V).fill(0),t(r,Z).fill(0),t(r,ye).fill(0),t(r,ke).fill(0),t(r,Ke).fill(0),t(r,L).fill(0),t(r,ee).fill(0),t(r,I).fill(0),t(r,Ce).fill(0),t(r,Ae).fill(0),x(r,H,100),x(r,ae,[]),x(r,qe,500),x(r,Qe,0),x(r,fe,0),x(r,W,0),t(r,se,ve).fill(0),x(r,N,!1),x(r,Ye,0),x(r,be,!0),r.initDrums(),t(r,G).forEach(function(h,u,E){E[u]=u}),e==0&&(r.dispatchEvent("mode","?"),x(r,O,0),t(r,Se).fill(0),t(r,Pe).fill(0),x(r,De,0),x(r,Re,"")),Nt.forEach(h=>{t(r,p)[g.cc*h]=yt[0]}),t(r,D).fill(r.CH_MELODIC),t(r,D)[9]=r.CH_DRUM1,t(r,D)[25]=r.CH_DRUM3,t(r,D)[41]=r.CH_DRUMS,t(r,D)[57]=r.CH_DRUMS,t(r,D)[73]=r.CH_DRUM5,t(r,D)[89]=r.CH_DRUM7,t(r,D)[105]=r.CH_DRUMS,t(r,D)[121]=r.CH_DRUMS;for(let h=0;h<g.drm;h++)t(r,he)[h<<1]=0,t(r,he)[h<<1|1]=g.invalidCh;t(r,We).fill(0),t(r,Te).fill(0),t(r,Me).fill(0),t(r,pe).fill(0),t(r,ue).fill(0),t(r,te).fill(0),t(r,ze).fill(0),r.aiEfxName="",r.userBank.clearRange({msb:0,lsb:127,prg:[0,127]});for(let h=0;h<g.ch;h++){let u=h*g.cc;t(r,p)[u+b[7]]=100,t(r,p)[u+b[11]]=127,t(r,p)[u+b[2]]=127,t(r,p)[u+b[10]]=64,t(r,p).subarray(u+b[71],u+b[71]+8).fill(64),t(r,p)[u+b[128]]=127,t(r,p).subarray(u+b[130],u+b[157]+1).fill(64),t(r,p)[u+b[91]]=40,t(r,p)[u+b[101]]=127,t(r,p)[u+b[100]]=127,t(r,p)[u+b[99]]=127,t(r,p)[u+b[98]]=127;let E=h*g.rpn;t(r,R)[E]=2,t(r,R)[E+1]=64,t(r,R)[E+2]=0,t(r,R)[E+3]=64,t(r,R)[E+4]=0,t(r,R)[E+5]=0;let v=h*g.ext;t(r,ee)[v+1]=r.VLBC_BRTHEXPR;let k=h*g.redir;t(r,Ae)[k+8]=13}r.buildRchTree(),r.buildRccMap(),r.dispatchEvent("mastervolume",t(r,H)),r.dispatchEvent("efxreverb",r.getEffectType(0)),r.dispatchEvent("efxchorus",r.getEffectType(1)),r.dispatchEvent("efxdelay",r.getEffectType(2)),r.dispatchEvent("efxinsert0",r.getEffectType(3)),r.dispatchEvent("efxinsert1",r.getEffectType(4)),r.dispatchEvent("efxinsert2",r.getEffectType(5)),r.dispatchEvent("efxinsert3",r.getEffectType(6)),r.dispatchEvent("reset"),r.switchMode("?")}setChMode(e,r){let h=this;if(e<0||e>=g.ch)throw new RangeError(`Invalid CH${e+1}`);if(port<0||r>=K.length)throw new RangeError(`Invalid mode ID ${r}`);t(h,Ce)[e]=r,h.dispatchEvent("voice",{part:e})}getChMode(e,r){return K[this.getChModeId(e,r)]}getChModeId(e,r){return r?t(this,Ce)[e]||t(this,I)[e>>4]:t(this,Ce)[e]||t(this,I)[e>>4]||t(this,O)}setPortMode(e,r,h){let u=this;if(e<0||e>=g.ch>>4)throw new RangeError(`Invalid port ${e+1}`);if(r<1)throw new RangeError("Range must be a positive integer");if(e+r>=g.ch>>4)throw new RangeError("Range must be in bound");if(e<0||h>=K.length)throw new RangeError(`Invalid mode ID ${h}`);for(let E=e;E<e+r;E++){t(u,I)[E]=h;for(let v=E<<4;v<E+1<<4;v++)u.dispatchEvent("voice",{part:v})}}copyChSetup(e,r,h){if(e==r){console.warn(`Failed attempt at overwriting CH${e+1} with its own data.`);return}let u=this;if(h&&t(u,ie)[r]){console.warn(`Failed attempt at copying setup data from CH${e+1} to CH${r+1}.`);return}let E=g.cc*e,v=g.cc*r;t(u,A)[r]=t(u,A)[e],t(u,p).set(t(u,p).subarray(E,E+g.cc),v)}setDrumFirstWrite(e,r){let h=this,u=t(h,D)[e];if(u<2)return;let E=u-2;if(t(h,he)[E<<1])if(r)t(h,he)[E<<1]=0,P()&&console.debug(`First write part for drum set ${E+1} has been reset.`);else return;else r?console.warn(`First write part for drum set ${E+1} is already blank.`):(t(h,he)[E<<1]=1,t(h,he)[E<<1|1]=e,console.debug(`First write part for drum set ${E+1} is set to CH${e}.`))}getChDrumFirstWrite(e){let r=this,h=t(r,D)[e];if(h<2)return;let u=h-2;return t(r,he).subarray(u<<1,u+1<<1)}getDrumFirstWrite(e){if(e>=0&&e<g.drm)return t(this,he).subarray(e<<1,e+1<<1)}switchMode(e,r=!1,h=!1){var v;let u=this,E=w[e];if(E>-1){if(t(u,O)==0||r){let k=t(u,O);u.initOnReset&&r&&(this.init(1),k=w["?"]),x(u,O,E),x(u,W,0);for(let a=0;a<g.ch;a++)t(u,D)[a]>0&&t(u,Ce)[a]==0&&(t(u,p)[a*g.cc]=yt[E]);switch(E){case w.mt32:{Et.forEach((a,c)=>{let f=c+1;t(u,ie)[f]||(t(u,A)[f]=a,t(u,p)[f*g.cc+b[91]]=127)});for(let a=1;a<10;a++)u.dispatchEvent("voice",{part:a});break}}let S;switch(E){case w["?"]:case w.g2:{S=[52,4,52,18,0,0,0,0];break}case w.xg:{S=[1,0,65,0,5,0,0,0];break}case w.gm:case w.gs:case w.sc:{S=[40,4,40,18,40,32,32,0];break}case w.sd:{S=[58,0,60,0,61,0,61,0];break}case w["05rw"]:case w.x5d:case w.ns5r:{S=[44,1,44,19,44,0,44,0];break}case w.k11:case w.sg:{S=[24,0,0,0,0,0,0,0];break}case w.mt32:{S=[40,4,0,0,0,0,0,0];break}case w.doc:{S=[24,16,0,0,0,0,0,0];break}case w.motif:case w.s90es:{S=[113,0,117,0,114,0,0,0];break}default:S=[0,0,0,0,0,0,0,0]}for(let a=0;a<g.efx;a++)!t(u,te)[3*a]&&((v=S[a<<1])!=null&&v.constructor)&&(t(u,te)[3*a+1]=S[2*a],t(u,te)[3*a+2]=S[2*a+1],u.dispatchEvent(`efx${["reverb","chorus","delay","insert0"][a]}`,u.getEffectType(a)));h&&u.setDetectionTargets(e),u.dispatchEvent("mode",e),u.forceVoiceRefresh(),Nt.forEach(a=>{u.dispatchEvent("voice",{part:a})})}}else throw new Error(`Unknown mode ${e}`)}newStrength(){t(this,ye).fill(0)}runJson(e){var r;if(e.type>14)return e.type==15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),t(this,nt)[e.type].call(this,e);{let h=this.chRedir(e.part,e.track),u=!1;(r=t(this,ct)[h])==null||r.forEach(E=>{e.channel=E,u=!0,t(this,nt)[e.type].call(this,e)}),u||console.warn(`${It[e.type]?It[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${h+1} without any recipient.`)}t(this,ae).length>100&&t(this,ae).splice(100,t(this,ae).length-99)}runRaw(e){}async loadBank(e,r){let h=this;switch(e=e.toLowerCase(),e){case"s7e":{h.userBank.clearRange({msb:63,lsb:[21,22]}),h.userBank.clearRange({msb:63,lsb:[24,27]});break}case"pcg":{h.userBank.clearRange({msb:63,lsb:[6,9]}),h.userBank.clearRange({msb:63,lsb:[13,16]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":case"pcg":{Je.context=this,await h.userBank.load(await Je.read(e,r),!1);break}}h.forceVoiceRefresh()}},O=new WeakMap,W=new WeakMap,fe=new WeakMap,we=new WeakMap,se=new WeakSet,ve=function(){return t(this,we)[t(this,W)]},qt=function(e){t(this,we)[t(this,W)]=e},ie=new WeakMap,G=new WeakMap,D=new WeakMap,p=new WeakMap,ce=new WeakMap,A=new WeakMap,X=new WeakMap,Z=new WeakMap,V=new WeakMap,z=new WeakMap,ke=new WeakMap,ye=new WeakMap,Oe=new WeakMap,ee=new WeakMap,R=new WeakMap,L=new WeakMap,Ke=new WeakMap,Y=new WeakMap,he=new WeakMap,te=new WeakMap,ze=new WeakMap,Ae=new WeakMap,I=new WeakMap,Ce=new WeakMap,ue=new WeakMap,rt=new WeakMap,Me=new WeakMap,pe=new WeakMap,We=new WeakMap,Te=new WeakMap,F=new WeakMap,B=new WeakMap,me=new WeakMap,st=new WeakMap,H=new WeakMap,Le=new WeakMap,qe=new WeakMap,Qe=new WeakMap,Re=new WeakMap,De=new WeakMap,it=new WeakMap,Ye=new WeakMap,be=new WeakMap,N=new WeakMap,lt=new WeakMap,ct=new WeakMap,Ue=new WeakMap,mt=new WeakMap,ae=new WeakMap,Se=new WeakMap,Pe=new WeakMap,q=new WeakMap,Be=new WeakMap,_=new WeakMap,nt=new WeakMap,dt=new WeakMap,He=new WeakMap,Ne=new WeakMap,re=new WeakMap,ne=new WeakMap,$e=new WeakMap,Ie=new WeakMap,_e=new WeakMap,Ge=new WeakMap,Wt);export{qa as OctaviaDevice,g as allocated,b as ccToPos,de as dnToPos};
