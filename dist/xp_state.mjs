var Ut=Object.defineProperty;var Pt=(g,e,r)=>e in g?Ut(g,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):g[e]=r;var R=(g,e,r)=>(Pt(g,typeof e!="symbol"?e+"":e,r),r),nt=(g,e,r)=>{if(!e.has(g))throw TypeError("Cannot "+r)};var t=(g,e,r)=>(nt(g,e,"read from private field"),r?r.call(g):e.get(g)),k=(g,e,r)=>{if(e.has(g))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(g):e.set(g,r)},w=(g,e,r,d)=>(nt(g,e,"write to private field"),d?d.call(g,r):e.set(g,r),r);(function(){var g=function(v,a,i){var c,n;if(self.MessageEvent)switch(v){case"message":{n=new MessageEvent(v,{data:a,ports:i==null?void 0:i.ports}),Object.defineProperty(n,"source",{value:i==null?void 0:i.source});break}default:n=new Event(v)}else n=document.createEvent("Event"),n.initEvent(v,!1,!1),i&&v=="message"&&(n.data=a,i.source&&Object.defineProperty(n,"source",{value:i.source}),(c=i.ports)!=null&&c.length&&Object.defineProperty(n,"ports",{value:i.ports}));return n};self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),r=[],d={},h=function(v){var a,i=this;if((this==null?void 0:this.constructor)!=h)throw new TypeError("Illegal constructor");r.push(this),(a=d[v])!=null&&a.constructor||(d[v]=[]),d[v].push(this);var c=Math.floor(Math.random()*281474976710656),n=[],s=0,o=[],f=!0,l=!1;Object.defineProperty(this,"id",{get:function(){return c}}),Object.defineProperty(this,"name",{value:v}),this.close=function(){var m,S=r.indexOf(i);S>-1?(e.postMessage({t:"d",c:v,i:c}),r.splice(S,1),(m=d[v])!=null&&m.constructor&&(S=d[v].indexOf(i),S>-1&&d[v].splice(S,1)),d[v].length||delete d[v],console.debug("[Snowy] BroadcastChannel closed."),l=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(m){if(e){if(l)throw new Error("Channel already closed");e.postMessage({t:"m",c:v,i:c,m:s,d:m}),s++,s>4294967295&&(s=0)}else o.push(m),console.debug("[Snowy] Message is cached.")},this.flush=function(){if(e){if(f){for(e.postMessage({t:"r",c:v,i:c}),console.debug("[Snowy] ".concat(o.length," message(s) in cache."));o.length;){var m=o.shift();i.postMessage(m)}f=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(m){m.c==v?m.i!=c&&i.dispatchEvent(g("message",m.d,{source:i})):console.debug("[Snowy] Channel ID mismatch. Instance ".concat(c," receives from ").concat(v,", not ").concat(m.c,"."))};var p={};this.dispatchEvent=function(m){var S,O;if(Object.defineProperty(m,"target",{value:i}),Object.defineProperty(m,"currentTarget",{value:i}),(S=p[m.type])!=null&&S.length)for(var H=p[m.type],F=0;F<H.length;F++)((O=H[F])==null?void 0:O.constructor)==Function&&H[F].call(i,m);i["on".concat(m.type)]&&i["on".concat(m.type)].constructor==Function&&i["on".concat(m.type)].call(i,m)},this.addEventListener=function(m,S){var O;(O=p[m])!=null&&O.constructor||(p[m]=[]);var H=p[m].indexOf(S);H==-1&&p[m].push(S)},this.removeEventListener=function(m,S){var O,H;if((O=p[m])!=null&&O.length){var F=p[m].indexOf(S);F>-1&&p[m].splice(F,1)}!((H=p[m])!=null&&H.length)&&p[m].constructor&&delete p[m]}},self.BroadcastChannel=h,E=function(){if(e){e.addEventListener("message",function(a){var i=a.data,c=!1;switch(i.t){case"k":{c=!1,e.postMessage({t:"k"});break}case"m":{var n=d[i.c];if(n!=null&&n.length)for(var s=0;s<n.length;s++)n[s].receiveMessage(i);break}case"c":{for(var o=[],f=0;f<r.length;f++){var l=r[f].name;o.indexOf(l)<0&&o.push(l)}e.postMessage({t:"k",c:o});break}default:c=!0}c&&console.info("ReceiveBroadcast",i)});for(var v=0;v<r.length;v++)r[v].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},b=function(){if(!e){var v=new SharedWorker(self.SNOWY_PATH||"/snowy.js");v.port.start();var a=function(i){i.data.t=="swc"&&(v.port.removeEventListener("message",a),e=v.port,e.postMessage({t:"k"}),E())};v.port.addEventListener("message",a)}},b());var e,r,d,h,E,b})();{let g=function(e,r){let d=new FileReader;return new Promise((h,E)=>{switch(d.addEventListener("abort",()=>{E(new Error("Blob read aborted"))}),d.addEventListener("error",b=>{E(d.error||b.data||new Error("Blob read error"))}),d.addEventListener("load",()=>{h(d.result)}),r.toLowerCase()){case"arraybuffer":case"buffer":{d.readAsArrayBuffer(e);break}case"string":case"text":{d.readAsText(e);break}default:E(new Error(`Unknown target ${r}`))}})};Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||function(){return g(this,"buffer")},Blob.prototype.text=Blob.prototype.text||function(){return g(this,"text")}}String.prototype.replaceAll=String.prototype.replaceAll||function(g,e){let r=0,d=16,h=this,E=[];for(;r<d&&h.lastIndexOf(g)>-1;){let b=h.lastIndexOf(g);E.unshift(h.slice(b+g.length)),h=h.slice(0,b),b==0&&E.unshift(""),r++}return h.length&&E.unshift(h),E.join(e)||""},String.prototype.padStart=String.prototype.padStart||function(g,e){if(e){let r=this;for(;r.length<g;)r=`${e}${r}`;return r}},String.prototype.padEnd=String.prototype.padEnd||function(g,e){if(e){let r=this;for(;r.length<g;)r+=e;return r}};var ct=function(g,e){let r=Math.min(g.length,e.length),d=g.slice(0,r),h=e.slice(0,r),E=0,b=0;for(;b<r&&E==0;)E=Math.sign(d[b]-h[b]),b++;return E},ie=function(g=""){this.name=g,this.pool=[],this.point=function(e,r=!1){if(this.pool.length>0){let d=this.pool.length,h=1<<Math.floor(Math.log2(d)),E=h,b=64;for(;h>=1&&b>=0;){if(b<=0)throw new Error("TTL reached.");if(E==d)E-=h;else{let a=ct(e,this.pool[E]);switch(a){case 0:{b=0;break}case 1:{E+h<=d&&(E+=h);break}case-1:{E!=0&&(E-=h);break}default:console.warn(`Unexpected result ${a}.`)}}h=h>>1,b--}let v=!0;if(E>=this.pool.length)v=!1;else{let a=this;this.pool[E].forEach(function(i,c,n){v&&i!=e[c]&&(v=!1)}),!v&&ct(e,this.pool[E])>0&&E++}return v||r?E:-1}else return r?0:-1},this.add=function(e,r){return e.data=r,this.pool.splice(this.point(e,!0),0,e),this},this.default=function(e){console.warn(`No match in "${this.name||"(unknown)"}" for "${e}". Default action not defined.`)},this.get=function(e){let r=this.point(e);if(r>-1)return this.pool[r].data;this.default(e)},this.run=function(e,...r){let d=this.point(e);d>-1?e.subarray?this.pool[d].data(e.subarray(this.pool[d].length),...r):this.pool[d].data(e.slice(this.pool[d].length),...r):this.default(e,...r)}};var z,ot,lt=(ot=class{constructor(){k(this,z,{})}addEventListener(g,e){t(this,z)[g]||(t(this,z)[g]=[]),t(this,z)[g].unshift(e)}removeEventListener(g,e){if(t(this,z)[g]){let r=t(this,z)[g].indexOf(e);r>-1&&t(this,z)[g].splice(r,1),t(this,z)[g].length<1&&delete t(this,z)[g]}}dispatchEvent(g,e){var h;let r=new Event(g),d=this;r.data=e,((h=t(this,z)[g])==null?void 0:h.length)>0&&t(this,z)[g].forEach(function(E){try{E==null||E.call(d,r)}catch(b){console.error(b)}}),this[`on${g}`]&&this[`on${g}`](r)}},z=new WeakMap,ot);var Lt=["MSB","PRG","LSB"],Je=function(g){let e=Math.floor(g/10),r=g%10;return`${e.toString(16)}${r}`},Q,dt,Ze=(dt=class{constructor(...g){k(this,Q,void 0);R(this,"strictMode",!1);this.loadFiles(...g)}get(g=0,e=0,r=0,d){let h=[g,e,r],E,b=Array.from(arguments);switch(d){case"xg":{switch(g){case 0:{r==126?b[2]=125:r==127&&(b[2]=0);break}case 16:{r==126&&(b[2]=0);break}case 32:{b[2]+=4;break}case 33:case 35:case 36:{b[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:b[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{r==126&&(b[2]=0);break}case 48:case 64:case 126:case 127:{r==126&&(b[2]=0);break}}break}case"gs":{g==0&&r<5?b[2]=0:g>125&&r<5&&r!=2&&(b[2]=g,b[0]=0);break}case"g2":case"sd":{(g>>1==40||g>95&&g<100)&&(b[2]|=16);break}case"sg":{g==8&&r==0&&(b[2]=5);break}case"s90es":{r<8?b[2]+=17:r<32?b[2]+=13:b[2]=(b[2]>>3)+19;break}case"motif":{r<8?b[2]+=28:r<32?b[2]+=13:b[2]=(b[2]>>3)+19;break}}let v=" ",a="M",i=0,c=0;switch(b[0]){case 0:{b[2]==127?a="MT-a":b[2]==126?a="MT-b":b[2]==7?a="GM-k":b[2]==5?a="SG-a":b[2]==4?a="SP-l":b[2]==0||d=="gs"&&b[2]<5?a="GM-a":(a="y",i=3);break}case 8:{d=="sg"?a="GM-s":a="r:";break}case 48:{a=`yM${(b[2]>>3).toString().padStart(2,"0")}`,i=1;break}case 56:{a="GM-b";break}case 61:case 120:{a="rDrm";break}case 62:{a="kDrm";break}case 63:{if(b[2]<17){let f=b[2];a=f<10?"kP:":"kC:",a+=f%10}else b[2]<34?a=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][b[2]-17]:a="Ds";break}case 64:{a="ySFX";break}case 67:{a="DX:S";break}case 80:case 81:case 82:case 83:{a=`Prg${"UABC"[b[0]-80]}`;break}case 88:case 89:case 90:case 91:{a=`Cmb${"UABC"[b[0]-88]}`;break}case 95:{a=`${["DR","PC"][b[2]]}-d`;break}case 96:{a=b[2]==106?"AP-a":b[2]>>4==1?"SDg":"PF",b[2]>63?c=63:b[2]>>4==1&&(c=16),i=3;break}case 97:{a=b[2]>>4==1?"SDa":"VL:",i=3,b[2]>>4==1?c=16:c=112;break}case 98:{a=b[2]>>4==1?"SDb":"SG-a",i=3,c=16;break}case 99:{a=b[2]>>4==1?"SDc":"DX",b[2]>63?c=63:b[2]>>4==1&&(c=16),i=3;break}case 100:{a="AN",b[2]>63?c=63:b[2]>>4==1&&(c=16),i=3;break}case 104:case 105:case 106:case 107:{a="SDd",c=104;break}case 121:{a=`GM-${b[2]?"":"a"}`,i=3;break}case 122:{a="lDrm";break}case 126:{a="yDrS";break}case 127:{b[2]==127?a="rDrm":a="yDrm";break}default:b[0]<48?a="r:":a="M"}a.length<4&&(a+=`${[g,r,b[0],b[2]][i]-c}`.padStart(4-a.length,"0")),d=="xg"&&(g==0?b[2]<100?a=a.replace("y0","y:"):b[2]==125&&(a="y126"):g==16&&(E=`Voice${(b[2]*128+b[1]+1).toString().padStart(3,"0")}`,v=" "));let n=[b[0],b[1],b[2]];for(;!((E==null?void 0:E.length)>=0);)E=t(this,Q)[b[1]||0][(b[0]<<7)+b[2]],E||(this.strictMode?(E="",v="?"):t(this,Q)[b[1]||0][b[0]<<7]?b[0]==0?(b[2]=0,v="^"):b[2]<1?(b[0]=0,v="*"):(b[2]--,v="^"):g==48?(b[0]=0,b[2]=0,v="!"):g==62?(b[1]--,v=" ",b[1]<1&&!(E!=null&&E.length)&&(b[0]=0,v="!")):g<63?b[0]==0?(b[2]=0,v="^"):b[2]<1?(b[0]=0,v="*"):b[2]--:g==80?(E=`PrgU:${e.toString().padStart(3,"0")}`,v="!"):g==88?(E=`CmbU:${e.toString().padStart(3,"0")}`,v="!"):g==121?(E=`GM2Vox0${r}`,v="#"):g==122?(b[1]==32?b[1]==0:b[1]%=7,E=t(this,Q)[b[1]||0][(b[0]<<7)+b[2]],E?v=" ":(E="",v="*")):b[1]==0?(E=`${g.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")} ${r.toString().padStart(3,"0")}`,v="!"):b[0]==0?(b[2]=0,v="^"):b[2]>0?b[2]--:b[1]>0?(b[1]=0,v="!"):(b[0]=0,v="?"));let s=[b[0],b[1],b[2]];(d=="gs"||d=="ns5r")&&v=="^"&&(v=" "),g==127&&v=="^"&&(v=" "),v!=" "&&self.debugMode&&(E="");let o="??";switch(b[0]){case 0:{b[2]==0?o="GM":b[2]==5||b[2]==7?o="KG":b[2]<126?o="XG":b[2]==127&&(o="MT");break}case 48:{o="MU";break}case 56:{o="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{o="AI";break}case 62:case 82:case 90:{o="XD";break}case 63:{b[2]<17?o="KR":b[2]<34?o="ES":o="DS";break}case 64:case 126:{o="XG";break}case 67:case 99:{o=b[2]>>4==1?"SD":"DX";break}case 81:{o="RW";break}case 95:{o=["DR","PC"][b[2]];break}case 96:{o=b[2]==106?"AP":b[2]>>4==1?"SD":"PF";break}case 97:{o=b[2]>>4==1?"SD":"VL";break}case 98:{o=b[2]>>4==1?"SD":"SG";break}case 100:{o="AN";break}case 104:case 105:case 106:case 107:{o="SD";break}case 120:{o="GS";break}case 121:{o=b[2]?"G2":"GM";break}case 122:{o="KG";break}case 127:{o=b[2]==127?"MT":e==0?"GM":"XG";break}default:b[0]<48&&(b[0]==16&&d=="xg"?o="XG":o="GS")}return{name:E||`${Je(g||0)} ${Je(e||0)} ${Je(r||0)}`,iid:n,eid:s,sid:h,ending:v,sect:a,standard:o}}async load(g,e,r){let d=this,h=[],E=0,b=0;g.split(`
`).forEach(function(v,a){let i=v.split("	"),c=[];a==0?i.forEach(function(n,s){h[Lt.indexOf(n)]=s}):i.forEach(async function(n,s){var o;s>2?(t(d,Q)[c[h[1]]]=t(d,Q)[c[h[1]]]||[],(!((o=t(d,Q)[c[h[1]]][(c[h[0]]<<7)+c[h[2]]])!=null&&o.length)||e)&&(t(d,Q)[c[h[1]]][(c[h[0]]<<7)+c[h[2]]]=i[3],E++),b++):c.push(parseInt(i[s]))})}),e||console.debug(`Map "${r||"(internal)"}": ${b} total, ${E} loaded.`)}clearRange(g){let e=g.prg!=null?g.prg.constructor==Array?g.prg:[g.prg,g.prg]:[0,127],r=g.msb!=null?g.msb.constructor==Array?g.msb:[g.msb,g.msb]:[0,127],d=g.lsb!=null?g.lsb.constructor==Array?g.lsb:[g.lsb,g.lsb]:[0,127];for(let h=r[0];h<=r[1];h++){let E=h<<7;for(let b=d[0];b<=d[1];b++){let v=E+b;for(let a=e[0];a<=e[1];a++)delete t(this,Q)[a][v]}}}init(){w(this,Q,[]);for(let g=0;g<128;g++)t(this,Q).push([""])}async loadFiles(...g){this.init();let e=this;g.forEach(async function(r,d){try{await fetch(`./data/bank/${r}.tsv`).then(function(h){return h.text()}).then(h=>{e.load(h,!1,r)})}catch(h){console.error(`Failed loading "${r}.tsv".`)}})}},Q=new WeakMap,dt);var Ue,ft,ht=(ft=class{constructor(){k(this,Ue,{});R(this,"context")}set(g,e){t(this,Ue)[g]=e}has(g){return!!t(this,Ue)[g]}async read(g,e){if(!this.has(g))throw new Error(`No decoder registered for "${g}"`);return await t(this,Ue)[g].call(this.context||this,e)}},Ue=new WeakMap,ft);var Ht=function(g,e){let r=!0;return e.forEach((d,h)=>{r=r&&g[h]==d}),r},ut=function(g){let e=0;return g.forEach(r=>{e*=256,e+=r}),e},_e=new TextDecoder,We=new ht;We.set("s7e",async function(g){let e=new Uint8Array(await g.slice(0,65536).arrayBuffer()),r="MSB	LSB	PRG	NME",d=[0,0,0,0],h=32,E=0,b=0,v=!0,a=[],i=0;for(;v;){let c=e.subarray(E);([()=>{_e.decode(c.subarray(0,4))=="YSFC"?(E+=80,b=1):E++},()=>{if(Ht(c.subarray(0,4),d))a.forEach((n,s,o)=>{let f=ut(e.subarray(n.start+4,n.start+8));n.length=f}),b=2;else{let n=_e.decode(c.subarray(0,4)),s=ut(c.subarray(4,8));a.push({type:n,start:s}),E+=8}},()=>{let n=a[i],s=e.subarray(n.start,n.start+n.length),o=32;switch(n.type){case"ENVC":{let f=h;for(;f<s.length;){let l=s.subarray(f,f+o),p=_e.decode(l.subarray(0,10)).trimEnd();p.slice(0,5)=="Init "&&(p=""),p&&(r+=`
063	${(l[17]+13).toString().padStart(3,"0")}	${l[19].toString().padStart(3,"0")}	${p}`),f+=o}break}case"EDVC":{let f=h;for(;f<s.length;){let l=s.subarray(f,f+o),p=_e.decode(l.subarray(0,10)).trimEnd();p.slice(0,5)=="Init "&&(p=""),p&&(r+=`
063	024	${l[19].toString().padStart(3,"0")}	${p}`),f+=o}break}case"EPVC":{let f=32,l=h;for(;l<s.length;){let p=s.subarray(l,l+f),m=_e.decode(p.subarray(0,10)).trimEnd();m=="----------"&&(m=""),m&&(r+=`
063	${(p[17]+1).toString().padStart(3,"0")}	${p[19].toString().padStart(3,"0")}	${m}`),l+=f}break}}i++,i>=a.length&&(b=3,v=!1)}][b]||(()=>{v=!1}))()}return r});var Xe=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),Fe=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],Nt=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],Pe=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],pt=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],bt=function(g){let e=.1,r=-.3;return g>66?(e=5,r=315):g>56?(e=1,r=47):g>46&&(e=.5,r=18.5),e*g-r},yt=function(g){return g>105?Nt[g-106]:g>100?g*1.1-100:g/10},gt=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),et={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,うぃ
we,うぇ
wo,を
nga,ガ
ngi,ギ
ngu,グ
nge,ゲ
ngo,ゴ
ngy,ギ!
ng,
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,いぇ
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(g=>{let e=g.split(",");et[e[0]]=e[1]});var $t=function(g){let e=g;g[0]=="*"&&(e=e.slice(1)),["aa","ii","uu","ee","oo"].forEach(d=>{for(;e.indexOf(d)>-1;)e=e.replace(d,d[0])});for(let d in et)e=e.replaceAll(d,et[d]);e.indexOf("ん")==0&&e.length>1&&(e=e.slice(1));let r=e.indexOf("!");return r>-1&&e.length>1&&(e=e.slice(r+1)),e},Et=function(g){return g?g<96?`cc${g}`:["aftertouch","velocity","pitch bend"][g-96]:"off"};var tt=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],mt=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],vt=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var Bt={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},Gt={66307:["drive"],66309:["vowel",g=>"aiueo"[g]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",g=>["off","LPF","HPF"][g]],94984:["noise type",g=>["white","pink"][g]],94987:["disc type",g=>["LP","SP","EP","RND"]],94990:["hum type",g=>`${g+5}0Hz`],94993:["M/S",g=>["mono","stereo"][g]]},at=function(g){return Bt[(g[0]-32<<8)+g[1]]||`0x${g[0].toString(16).padStart(2,"0")}${g[1].toString(16).padStart(2,"0")}`},wt=function(g,e,r){let d=(g[0]-32<<16)+(g[1]<<8)+e,h=Gt[d]||{},E=h[0];if(E!=null&&E.length)return E+=`: ${(h[1]||function(){})(r)||r}`,E},rt=[68,48,95,78,41,3,110,122,0];var q=function(g=64){return Math.round(2e3*Math.log10(g/64))/100};var st=function(g){let e=0;return g.forEach(r=>{e+=r,e=e&127}),~e+1&127},ne=function(g,e){let r=0,d=0;for(let h=0;h<g.length;h++){let E=h%8-1,b=(d>>E&1)<<7,v=g[h];v+=b,h%8!=0?(e(v,r,g),r++):d=g[h]}},Ve=function(g){let e=Math.floor(g*14.2);return e<128?e:0};var de=["?","gm","gs","xg","g2","mt32","ns5r","x5d","05rw","sd","k11","sg","krs","s90es","motif"],kt=[[0,0,0,0,121,0,0,82,81,97,0,0,63,63,63],[0,0,4,0,0,127,0,0,0,0,0,0,0,0,0]],Se=[120,127,120,127,120,127,61,62,62,105,122,122,120,127,127],It=[0,3,81,84,88],St={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},xt={0:0,1:1,2:3,5:4},Ct={0:0,1:1,2:2,5:3},Mt=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],Tt=[36,37,48,49,52,53],je=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],Rt={26:127,29:0,30:0,31:0,52:12,53:54},Ke=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,128,12,13,16,17,18,19],_t=[12,13,16,17,18,19],Xt=[33,99,100,32,102,8,9,10],Ot=[0,16,25,40,32,64,26,48],x={};de.forEach((g,e)=>{x[g]=e});var y={length:Ke.length};Ke.forEach((g,e)=>{y[g]=e});var ae={length:je.length};je.forEach((g,e)=>{ae[g]=e});var U=function(){return!!self.Bun||self.debugMode||!1},Ft=function(g){let e=[],r=0;return g==null||g.forEach(function(d,h){d==247?e.push(g.subarray(r,h)):d==240&&(r=h+1)}),e.length||e.push(g.subarray(0)),U()&&console.debug(e),e};var $={ch:128,cc:Ke.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,ace:8,drm:8,dpn:je.length,dnc:128,efx:7},D,V,ce,he,J,fe,At,ue,I,M,u,pe,A,N,W,B,_,ge,oe,xe,C,T,Le,K,le,$e,re,He,Ee,Y,Ne,me,Z,P,Ce,Be,Ge,ve,we,ze,Ie,se,L,Qe,it,j,be,ke,X,Me,G,qe,Ye,Te,Re,ee,te,ye,Oe,De,Ae,Dt,Ma=(Dt=class extends lt{constructor(){super();k(this,J);R(this,"NOTE_IDLE",0);R(this,"NOTE_ATTACK",1);R(this,"NOTE_DECAY",2);R(this,"NOTE_SUSTAIN",3);R(this,"NOTE_HELD",4);R(this,"NOTE_RELEASE",5);R(this,"NOTE_SOSTENUTO_ATTACK",8);R(this,"NOTE_SOSTENUTO_DECAY",9);R(this,"NOTE_SOSTENUTO_SUSTAIN",10);R(this,"NOTE_SOSTENUTO_HELD",11);R(this,"CH_MELODIC",0);R(this,"CH_DRUMS",1);R(this,"CH_DRUM1",2);R(this,"CH_DRUM2",3);R(this,"CH_DRUM3",4);R(this,"CH_DRUM4",5);R(this,"CH_DRUM5",6);R(this,"CH_DRUM6",7);R(this,"CH_DRUM7",8);R(this,"CH_DRUM8",9);k(this,D,0);k(this,V,0);k(this,ce,0);k(this,he,new Array(11));k(this,ue,new Uint8Array($.ch));k(this,I,new Uint8Array($.ch));k(this,M,new Uint8Array($.ch));k(this,u,new Uint8Array($.ch*$.cc));k(this,pe,new Uint8Array($.ace));k(this,A,new Uint8Array($.ch));k(this,N,new Uint8Array($.ch*$.nn));k(this,W,new Uint8Array($.ch));k(this,B,new Uint16Array($.pl));k(this,_,new Uint8Array($.pl));k(this,ge,new Int16Array($.ch));k(this,oe,new Uint8Array($.ch));k(this,xe,0);k(this,C,new Uint8Array($.ch*$.rpn));k(this,T,new Uint8Array($.ch*$.rpnt));k(this,Le,new Int8Array($.ch*Tt.length));k(this,K,new Uint8Array($.drm*$.dpn*$.dnc));k(this,le,new Uint8Array($.ch));k(this,$e,new Uint8Array(128));k(this,re,new Uint8Array($.cmt*8));k(this,He,new Uint8Array(1024));k(this,Ee,new Uint8Array($.cmt*64));k(this,Y,new Uint8Array($.efx*3));k(this,Ne,new Uint8Array($.ch));k(this,me,0);k(this,Z,0);k(this,P,100);k(this,Ce,0);k(this,Be,500);k(this,Ge,0);k(this,ve,"");k(this,we,0);k(this,ze,0);k(this,Ie,0);k(this,se,!0);k(this,L,!1);k(this,Qe,void 0);k(this,it,new Uint8Array(2));k(this,j,[]);k(this,be,new Uint8Array($.ch));k(this,ke,new Uint8Array($.tr));R(this,"baseBank",new Ze("gm","gm2","xg","gs","ns5r","sd","gmega","plg-150vl","plg-150pf","plg-150dx","plg-150an","plg-150dr","plg-100sg","kross","s90es"));R(this,"userBank",new Ze("gm"));R(this,"initOnReset",!1);R(this,"aiEfxName","");k(this,X,[]);k(this,Me,void 0);k(this,G,{nOff:(e,r)=>{let d=e*128+r,h=t(this,B).lastIndexOf(d);h>-1&&(t(this,u)[$.cc*e+y[64]]>63?(t(this,_)[h]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:r,velo:t(this,N)[d],state:this.NOTE_HELD})):t(this,u)[$.cc*e+y[66]]>63&&t(this,_)[h]==this.NOTE_SOSTENUTO_SUSTAIN?(t(this,_)[h]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:r,velo:t(this,N)[d],state:this.NOTE_SOSTENUTO_HELD})):(t(this,B)[h]=0,t(this,N)[d]=0,t(this,_)[h]=this.NOTE_IDLE,this.dispatchEvent("note",{part:e,note:r,velo:0,state:this.NOTE_IDLE})))},nOn:(e,r,d)=>{let h=e*128+r,E=0;for(t(this,W)[e]&&t(this,G).ano(e);t(this,_)[E]>0&&t(this,B)[E]!=h;)E++;E<$.pl?(t(this,B)[E]=h,t(this,N)[h]=d,t(this,_)[E]=this.NOTE_SUSTAIN,t(this,oe)[e]<d&&(t(this,oe)[e]=d),this.dispatchEvent("note",{part:e,note:r,velo:d,state:this.NOTE_SUSTAIN})):console.error("Polyphony exceeded.")},nAt:(e,r,d)=>{},cAt:(e,r)=>{},hoOf:e=>{t(this,_).forEach((r,d)=>{if(r==this.NOTE_HELD){let h=t(this,B)[d],E=h>>7;e==E&&(t(this,_)[d]=this.NOTE_IDLE,t(this,B)[d]=0,t(this,N)[h]=0,this.dispatchEvent("note",{part:e,note:h&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{t(this,_).forEach((r,d)=>{let h;switch(r){case this.NOTE_ATTACK:{h=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{h=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{h=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(h){t(this,_)[d]=h;let E=t(this,B)[d];this.dispatchEvent("note",{part:e,note:E&127,velo:t(this,N)[E],state:h})}})},soOf:e=>{t(this,_).forEach((r,d)=>{if(r==this.NOTE_SOSTENUTO_HELD){let h=t(this,B)[d],E=h>>7;e==E&&(t(this,_)[d]=this.NOTE_IDLE,t(this,B)[d]=0,t(this,N)[h]=0,this.dispatchEvent("note",{part:e,note:h&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{t(this,B).forEach((r,d,h)=>{let E=r>>7,b=r&127;r==0&&t(this,N)[0]==0||E==e&&t(this,G).nOff(E,b)})}});k(this,qe,{8:function(e){let r=e.channel,d=e.data[0];t(this,G).nOff(r,d)},9:function(e){let r=e.channel;this.setChActive(r,1);let d=e.data[0],h=e.data[1];h>0?t(this,G).nOn(r,d,h):t(this,G).nOff(r,d)},10:function(e){let r=e.channel,d=r*128+e.data[0];t(this,B).indexOf(d)>-1&&(t(this,N)[d]=data[1],this.dispatchEvent("note",{part:r,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let r=e.channel;[0,32].indexOf(e.data[0])>-1&&(()=>{switch(t(this,D)){case x.s90es:case x.motif:{if(e.data[0]==0){[0,63].indexOf(e.data[1])>-1&&this.setChActive(r,1);break}e.data[1]&&this.setChActive(r,1);break}default:{this.setChActive(r,1);break}}})();let d=r*$.cc;switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{t(this,G).ano(r),t(this,ge)[r]=0;let h=r*$.cc;t(this,u)[h+y[1]]=0,t(this,u)[h+y[5]]=0,t(this,u)[h+y[64]]=0,t(this,u)[h+y[65]]=0,t(this,u)[h+y[66]]=0,t(this,u)[h+y[67]]=0,t(this,u)[h+y[11]]=127,t(this,u)[h+y[101]]=127,t(this,u)[h+y[100]]=127,t(this,u)[h+y[99]]=127,t(this,u)[h+y[98]]=127;return}case 123:{t(this,G).ano(r);return}case 124:{t(this,G).ano(r);return}case 125:{t(this,G).ano(r);return}case 126:{t(this,W)[r]=1,t(this,G).ano(r);return}case 127:{t(this,W)[r]=0,t(this,G).ano(r);return}}if(y[e.data[0]]==null)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(_t.indexOf(e.data[0])>-1&&this.allocateAce(e.data[0]),e.data[0]){case 0:{switch(U()&&console.debug(`${de[t(this,D)]}, CH${r+1}: ${e.data[1]}`),t(this,D)==0?e.data[1]<48?(t(this,M)[r]>0&&(e.data[1]=t(this,u)[d],e.data[1]=120,console.debug(`Forced channel ${r+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]==62?this.switchMode("x5d"):e.data[1]==63?this.switchMode("krs"):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg"):t(this,D)==x.gs?e.data[1]<56&&t(this,M)[r]>0&&(e.data[1]=t(this,u)[d],e.data[1]=120,console.debug(`Forced channel ${r+1} to stay drums.`)):t(this,D)==x.gm?e.data[1]<48?t(this,M)[r]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${r+1} to stay drums.`)):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg",!0):t(this,D)==x.x5d&&e.data[1]>0&&e.data[1]<8&&this.switchMode("05rw",!0),t(this,D)){case x.xg:{[126,127].indexOf(e.data[1])>-1?t(this,M)[r]==0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):t(this,M)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case x["05rw"]:case x.x5d:case x.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?t(this,M)[r]==0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):t(this,M)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case x.sd:{[104,105,106,107].indexOf(e.data[1])>-1?t(this,M)[r]==0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):t(this,M)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case x.g2:{e.data[1]==120?t(this,M)[r]==0&&(this.setChType(r,this.CH_DRUMS),console.debug(`CH${r+1} set to drums by MSB.`)):t(this,M)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}}this.dispatchEvent("voice",{part:r});break}case 6:{if(t(this,xe)){[x.xg,x.gs,x.ns5r].indexOf(t(this,D))<0&&console.warn(`NRPN commits are not available under "${de[t(this,D)]}" mode, even when they are supported in Octavia.`);let h=t(this,u)[d+y[99]],E=t(this,u)[d+y[98]];if(h==1){let b=Xt.indexOf(E);if(b>-1)t(this,u)[d+y[71+b]]=e.data[1],U()&&console.debug(`Redirected NRPN 1 ${E} to cc${71+b}.`),this.dispatchEvent("cc",{part:r,cc:71+b,data:e.data[1]});else{let v=Tt.indexOf(E);v>-1?t(this,Le)[r*10+v]=e.data[1]-64:console.warn(`NRPN 0x01${E.toString(16).padStart(2,"0")} is not supported.`),U()&&console.debug(`CH${r+1} voice NRPN ${E} commit`)}}else{if(je.indexOf(h)<0){let v=`NRPN 0x${h.toString(16).padStart(2,"0")}${E.toString(16).padStart(2,"0")} `;h==127?console.warn(`${v}is not necessary. Consider removing it.`):console.warn(`${v}is not supported.`)}else{let v=t(this,M)[r]-2;v<0?console.warn(`CH${r+1} cannot accept drum NRPN as type ${Fe[t(this,M)[r]]}.`):t(this,K)[(v*$.dpn+ae[h])*$.dnc+E]=e.data[1]}U()&&console.debug(`CH${r+1} (${Fe[t(this,M)[r]]}) drum NRPN ${h} commit`)}}else{let h=xt[t(this,u)[d+y[100]]],E=Ct[t(this,u)[d+y[100]]];t(this,u)[d+y[101]]==0&&h!=null&&(U()&&console.debug(`CH${r+1} RPN 0 ${t(this,u)[d+y[100]]} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],Mt[h][0]),Mt[h][1]),t(this,C)[r*$.rpn+h]=e.data[1],t(this,T)[r*$.rpnt+E]=1)}break}case 32:{switch(U()&&console.debug(`${de[t(this,D)]}, CH${r+1} LSB: ${e.data[1]}`),t(this,D)){case x.s90es:case x.motif:{this.setChType(r,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,t(this,D),!0);break}}this.dispatchEvent("voice",{part:r});break}case 38:{if(!t(this,xe)){let h=xt[t(this,u)[d+100]],E=Ct[t(this,u)[d+100]];t(this,u)[d+101]==0&&h!=null&&(t(this,C)[r*$.rpn+h+1]=e.data[1],t(this,T)[r*$.rpnt+E]=1)}break}case 64:{e.data[1]<64&&t(this,G).hoOf(r);break}case 66:{e.data[1]>>6?t(this,G).soOn(r):t(this,G).soOf(r);break}case 98:case 99:{w(this,xe,1);break}case 100:case 101:{w(this,xe,0);break}}t(this,u)[d+y[e.data[0]]]=e.data[1],this.dispatchEvent("cc",{part:r,cc:e.data[0],data:e.data[1]})}},12:function(e){let r=e.channel;switch(t(this,D)){case x.s90es:case x.motif:{e.data&&this.setChActive(r,1);break}default:this.setChActive(r,1)}t(this,A)[r]=e.data,t(this,le)[r]=0,U()&&console.debug(`T:${e.track} C:${r} P:${e.data}`),this.dispatchEvent("voice",{part:r})},13:function(e){let r=this,d=e.channel;t(this,B).forEach(function(h){let E=h>>7;d==E&&(t(r,N)[h]=e.data,r.dispatchEvent("note",{part:d,note:h&127,velo:e.data,state:r.NOTE_SUSTAIN}))})},14:function(e){let r=e.channel;t(this,ge)[r]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)})},15:function(e){Ft(e.data).forEach(r=>{let d=r[0],h=r[1];(t(this,Ye)[d]||function(){console.debug(`Unknown manufacturer ${d}.`)})(h,r.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(t(this,X)[e.meta]||function(d,h,E){}).call(this,e.data,e.track,e.meta),e.meta!=32&&w(this,Ce,0);let r=It.indexOf(e.meta)>-1;if(U()&&console.debug(e),r)return e.reply="meta",e}});k(this,Ye,{64:(e,r,d)=>{t(this,Oe).run(r,d,e)},65:(e,r,d)=>{if(r[0]<16)if(r[1]==72){let h=r[r.length-1],E=st(r.subarray(3,r.length-1));h==E?t(this,te).run(r.subarray(0,r.length-1),d,e):console.warn(`Bad SD checksum ${h}. Should be ${E}.`)}else t(this,te).run(r,d,e);else{let h=r[r.length-1],E=st(r.subarray(2,r.length-1));h==E?t(this,te).run(r.subarray(0,r.length-1),d,e):console.warn(`Bad GS checksum ${h}. Should be ${E}.`)}},66:(e,r,d)=>{t(this,ye).run(r,d,e)},67:(e,r,d)=>{t(this,ee).run(r,d,e)},68:(e,r,d)=>{t(this,Ae).run(r,d,e)},71:(e,r,d)=>{t(this,De).run(r,d,e)},126:(e,r,d)=>{t(this,Te).run(r,d,e)},127:(e,r,d)=>{this.switchMode("gm"),t(this,Re).run(r,d,e)}});k(this,Te,void 0);k(this,Re,void 0);k(this,ee,void 0);k(this,te,void 0);k(this,ye,void 0);k(this,Oe,void 0);k(this,De,void 0);k(this,Ae,void 0);let e=this;w(this,J,new Uint8Array(256),At),t(this,he)[10]=new Uint8Array(512),w(this,Me,new ie),this.userBank.strictMode=!0,this.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),this.addEventListener("metacommit",function(a){var c,n;let{data:i}=a;((c=t(e,j)[0])==null?void 0:c.type)==i.type&&((n=t(e,j)[0])!=null&&n.amend)?(t(e,j)[0].amend=i.amend,t(e,j)[0].data+=i.data):t(e,j).unshift(i)}),t(this,X)[1]=function(a){var i,c,n,s,o;switch(a=a.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),a.slice(0,2)){case"@I":{w(this,L,!0),this.dispatchEvent("metacommit",{type:"Kar.Info",data:(i=a.slice(2))==null?void 0:i.trimLeft()});break}case"@K":{w(this,L,!0),this.dispatchEvent("metacommit",{type:"Kar.Mode",data:(c=a.slice(2))==null?void 0:c.trimLeft()}),console.debug(`Karaoke mode active: ${a.slice(2)}`);break}case"@L":{w(this,L,!0),this.dispatchEvent("metacommit",{type:"Kar.Lang",data:(n=a.slice(2))==null?void 0:n.trimLeft()});break}case"@T":{w(this,L,!0),this.dispatchEvent("metacommit",{type:"KarTitle",data:(s=a.slice(2))==null?void 0:s.trimLeft()});break}case"@V":{w(this,L,!0),this.dispatchEvent("metacommit",{type:"Kar.Ver.",data:(o=a.slice(2))==null?void 0:o.trimLeft()});break}case"XF":{let f=a.slice(2).split(":");switch(f[0]){case"hd":{f.slice(1).forEach((l,p)=>{l.length&&this.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][p],data:l})});break}case"ln":{f.slice(1).forEach((l,p)=>{l.length&&this.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][p],data:l})});break}default:this.dispatchEvent("metacommit",{type:"XfUnData",data:a})}break}default:t(this,L)?a[0]=="\\"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:a.slice(1),amend:!0})):a[0]=="/"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:a.slice(1),mask:!0,amend:!0})):this.dispatchEvent("metacommit",{type:"KarLyric",data:a,amend:!0}):a.split(`
`).forEach((f,l)=>{this.dispatchEvent("metacommit",{type:"Cmn.Text",data:f,mask:l!=0})})}},t(this,X)[2]=function(a){this.dispatchEvent("metacommit",{type:"Copyrite",data:a})},t(this,X)[3]=function(a,i){i<1&&t(this,Ce)<1&&this.dispatchEvent("metacommit",{type:"TrkTitle",data:a})},t(this,X)[4]=function(a,i){this.dispatchEvent("metacommit",{type:"Instrmnt",data:a})},t(this,X)[5]=function(a){a.trim()==""?this.dispatchEvent("metacommit",{type:"C.Lyrics",data:"",amend:!1}):this.dispatchEvent("metacommit",{type:"C.Lyrics",data:a,amend:!0})},t(this,X)[6]=function(a){this.dispatchEvent("metacommit",{type:"C.Marker",data:a})},t(this,X)[7]=function(a){this.dispatchEvent("metacommit",{type:"CuePoint",data:a})},t(this,X)[32]=function(a){w(this,Ce,a[0]+1)},t(this,X)[33]=function(a,i){t(e,ke)[i]=a+1},t(this,X)[81]=function(a,i){w(e,Be,a/1e3)},t(this,X)[127]=function(a,i){t(e,Me).run(a,i)},t(this,Me).default=function(a){console.warn(`Unrecognized sequencer-specific byte sequence: ${a}`)},t(this,Me).add([67,0,1],function(a,i){t(e,ke)[i]=a[0]+1}),w(this,Te,new ie("universal non-realtime")),w(this,Re,new ie("universal realtime")),w(this,ee,new ie("Yamaha")),w(this,te,new ie("Roland")),w(this,ye,new ie("Korg")),w(this,Oe,new ie("Kawai")),w(this,De,new ie("Akai")),w(this,Ae,new ie("Casio"));let r=function(a){console.info(`Unrecognized SysEx in "${this.name}" set.
%o`,a)};t(this,Te).default=r,t(this,Re).default=r,t(this,ee).default=r,t(this,te).default=r,t(this,ye).default=r,t(this,Oe).default=r,t(this,De).default=r,t(this,Ae).default=r,t(this,Te).add([9],a=>{e.switchMode(["gm","?","g2"][a[0]-1],!0),w(e,L,t(e,L)||!1),console.info(`MIDI reset: ${["GM","Init","GM2"][a[0]-1]}`),a[0]==2&&e.init()}),t(this,Re).add([4,1],a=>{w(e,P,((a[1]<<7)+a[0])/16383*100),e.dispatchEvent("mastervolume",t(e,P))}).add([4,3],a=>((a[1]<<7)+a[0]-8192)/8192).add([4,4],a=>a[1]-64),t(this,ee).add([76,0,0],a=>{switch(a[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset: ${a}`);break}case 126:{e.switchMode("xg",!0),w(e,L,!1),console.info("MIDI reset: XG");break}default:{let i=[0,0,0,0],c=(n,s)=>{i[s]=n};if(a.subarray(1).forEach((n,s)=>{let o=s+a[0];([c,c,c,c,f=>{w(this,P,f*129/16383*100),e.dispatchEvent("mastervolume",t(e,P))},f=>{},f=>{}][o]||(()=>{}))(n,s)}),a[0]<4){let n=0;i.forEach(s=>{n=n<<4,n+=s}),n-=1024}}}}).add([76,2,1],a=>{let i="XG ";a[0]<32?(i+="reverb ",a.subarray(1).forEach((c,n)=>{([s=>{e.setEffectTypeRaw(0,!1,s),console.info(`${i}main type: ${Xe[s]}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},s=>{e.setEffectTypeRaw(0,!0,s),console.debug(`${i}sub type: ${s+1}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},s=>{console.debug(`${i}time: ${bt(s)}s`)},s=>{console.debug(`${i}diffusion: ${s}`)},s=>{console.debug(`${i}initial delay: ${s}`)},s=>{console.debug(`${i}HPF cutoff: ${Pe[s]}Hz`)},s=>{console.debug(`${i}LPF cutoff: ${Pe[s]}Hz`)},s=>{console.debug(`${i}width: ${s}`)},s=>{console.debug(`${i}height: ${s}`)},s=>{console.debug(`${i}depth: ${s}`)},s=>{console.debug(`${i}wall type: ${s}`)},s=>{console.debug(`${i}dry/wet: ${s}`)},s=>{console.debug(`${i}send: ${q(s)}dB`)},s=>{console.debug(`${i}pan: ${s-64}`)},!1,!1,s=>{console.debug(`${i}delay: ${s}`)},s=>{console.debug(`${i}density: ${s}`)},s=>{console.debug(`${i}balance: ${s}`)},s=>{},s=>{console.debug(`${i}feedback: ${s}`)},s=>{}][a[0]+n]||function(){console.warn(`Unknown XG reverb address: ${a[0]}.`)})(c)})):a[0]<64?(i+="chorus ",a.subarray(1).forEach((c,n)=>{([s=>{e.setEffectTypeRaw(1,!1,s),console.info(`${i}main type: ${Xe[s]}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},s=>{e.setEffectTypeRaw(1,!0,s),console.debug(`${i}sub type: ${s+1}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},s=>{console.debug(`${i}LFO: ${pt[s]}Hz`)},s=>{},s=>{console.debug(`${i}feedback: ${s}`)},s=>{console.debug(`${i}delay offset: ${yt(s)}ms`)},s=>{},s=>{console.debug(`${i}low: ${Pe[s]}Hz`)},s=>{console.debug(`${i}low: ${s-64}dB`)},s=>{console.debug(`${i}high: ${Pe[s]}Hz`)},s=>{console.debug(`${i}high: ${s-64}dB`)},s=>{console.debug(`${i}dry/wet: ${s}`)},s=>{console.debug(`${i}send: ${q(s)}dB`)},s=>{console.debug(`${i}pan: ${s-64}`)},s=>{console.debug(`${i}to reverb: ${q(s)}dB`)},!1,s=>{},s=>{},s=>{},s=>{console.debug(`${i}LFO phase diff: ${(s-64)*3}deg`)},s=>{console.debug(`${i}input mode: ${s?"stereo":"mono"}`)},s=>{}][a[0]-32+n]||function(){console.warn(`Unknown XG chorus address: ${a[0]}.`)})(c)})):a[0]<86?(i+="variation ",a.subarray(1).forEach((c,n)=>{([s=>{e.setEffectTypeRaw(2,!1,s),console.info(`${i}main type: ${Xe[s]}`),e.dispatchEvent("efxdelay",e.getEffectType(2))},s=>{e.setEffectTypeRaw(2,!0,s),console.debug(`${i}sub type: ${s+1}`),e.dispatchEvent("efxdelay",e.getEffectType(2))}][a[0]-64+n]||function(){})(c)})):a[0]<97?(i+="variation ",a.subarray(1).forEach((c,n)=>{[s=>{console.debug(`${i}send: ${q(s)}dB`)},s=>{console.debug(`${i}pan: ${s-64}`)},s=>{console.debug(`${i}to reverb: ${q(s)}dB`)},s=>{console.debug(`${i}to chorus: ${q(s)}dB`)},s=>{console.debug(`${i}connection: ${s?"system":"insertion"}`)},s=>{console.debug(`${i}channel: CH${s+1}`)},s=>{console.debug(`${i}mod wheel: ${s-64}`)},s=>{console.debug(`${i}bend wheel: ${s-64}`)},s=>{console.debug(`${i}channel after touch: ${s-64}`)},s=>{console.debug(`${i}AC1: ${s-64}`)},s=>{console.debug(`${i}AC2: ${s-64}`)}][a[0]-86+n](c)})):a[0]>111&&a[0]<118?i+="variation ":console.warn(`Unknown XG variation address: ${a[0]}`)}).add([76,2,64],a=>{a.subarray(1).forEach((i,c)=>{let n=c+a[0];if(n==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][i]}`);else{let s=n-1>>2,o=n-1&3,f=`XG EQ ${s} ${["gain","freq","Q","shape"][o]}: `;[()=>{console.debug(`${f}${i-64}dB`)},()=>{console.debug(`${f}${i} (raw)`)},()=>{console.debug(`${f}${i/10}`)},()=>{console.debug(`${f}${["shelf","peak"][+!!i]}`)}][o]()}})}).add([76,3],a=>{let i=a[0],c=a[1],n=`XG Insertion ${a[0]+1} `;a.subarray(2).forEach((s,o)=>{([f=>{e.setEffectTypeRaw(3+i,!1,f),console.info(`${n}main type: ${Xe[f]}`),e.dispatchEvent(`efxinsert${i}`,e.getEffectType(3+i))},f=>{e.setEffectTypeRaw(3+i,!0,f),console.debug(`${n}sub type: ${f+1}`),e.dispatchEvent(`efxinsert${i}`,e.getEffectType(3+i))}][c+o]||function(){})(s)})}).add([76,6,0],a=>{let i=a[0];i<64?e.setLetterDisplay(a.subarray(1),"XG letter display",i):w(e,we,Date.now())}).add([76,7,0],a=>{let i=a[0];w(e,V,0),w(e,ce,Date.now()+3200),t(e,J,fe).fill(0);let c=a.subarray(1);for(let n=0;n<i;n++)c.unshift(0);c.forEach(function(n,s){let o=Math.floor(s/16),f=s%16,l=(f*3+o)*7,p=7,m=0;for(l-=f*5,o==2&&(p=2);m<p;)t(e,J,fe)[l+m]=n>>6-m&1,m++})}).add([76,8],(a,i)=>{let c=e.chRedir(a[0],i,!0),n=a[1],s=$.cc*c,o=`XG CH${c+1} `,f=`Unknown XG part address ${n}.`;a.subarray(2).forEach((l,p)=>{n<1?console.debug(f):n<41?([()=>{t(e,u)[s+y[0]]=l,e.dispatchEvent("voice",{part:c})},()=>{t(e,u)[s+y[32]]=l,e.dispatchEvent("voice",{part:c})},()=>{t(e,A)[c]=l,e.dispatchEvent("voice",{part:c})},()=>{let m=e.chRedir(l,i,!0);t(e,I)[c]=m,c!=m&&(e.buildRchTree(),console.info(`${o}receives from CH${m+1}`))},()=>{t(e,W)[c]=+!l},()=>{},()=>{e.setChType(c,l,x.xg),console.debug(`${o}type: ${Fe[l]||l}`)},()=>{t(e,C)[$.rpn*c+3]=l,t(e,T)[$.rpnt*c+2]=1},!1,!1,()=>{t(e,u)[s+y[7]]=l},!1,!1,()=>{t(e,u)[s+y[10]]=l||128},!1,!1,()=>{t(e,u)[s+y[128]]=l},()=>{t(e,u)[s+y[93]]=l},()=>{t(e,u)[s+y[91]]=l},()=>{t(e,u)[s+y[94]]=l},()=>{t(e,u)[s+y[76]]=l},()=>{t(e,u)[s+y[77]]=l},()=>{t(e,u)[s+y[78]]=l},()=>{t(e,u)[s+y[74]]=l},()=>{t(e,u)[s+y[71]]=l},()=>{t(e,u)[s+y[73]]=l},()=>{t(e,u)[s+y[75]]=l},()=>{t(e,u)[s+y[72]]=l}][n+p-1]||(()=>{}))():n<48?console.debug(f):n<111?n>102&&n<105&&(t(e,u)[s+y[[5,65][n&1]]]=l):n<114?console.debug(f):n<116?console.debug(`${o}EQ ${["bass","treble"][n&1]} gain: ${l-64}dB`):n<118?console.debug(f):n<120?console.debug(`${o}EQ ${["bass","treble"][n&1]} freq: ${l}`):console.debug(f)})}).add([76,9],(a,i)=>{let c=e.chRedir(a[0],i,!0),n=a[1],s=`PLG-150VL CH${c+1} `;a.subarray(2).forEach((o,f)=>{let l=f+n;switch(l){case 1:{console.info(`${s}breath mode: ${["system","breath","velocity","touch EG"][o]}`);break}case 0:case 27:case 28:break;default:if(l<27){let p=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][l-3>>1];l&1?l<23?(console.debug(`${s}${p} control source: ${Et(o)}`),o&&o<96&&e.allocateAce(o)):console.debug(`${s}${p} scale break point: ${o}`):console.debug(`${s}${p} depth: ${o-64}`)}}})}).add([76,10],a=>{}).add([76,16],a=>{}).add([76,17,0,0],a=>{}).add([76,112],a=>{console.debug(`XG enable PLG-1${["50VL","00SG","50DX"][a[0]]} for CH${a[2]+1}.`)}).add([73,0,0],(a,i)=>{let c=a[0],n="MU1000 System: ";a.subarray(1).forEach((s,o)=>{let f=c+o;f==8?console.debug(`${n}LCD contrast set to ${s}.`):f==18?(w(e,Z,s?126:0),console.debug(`${n}bank defaults to ${s?"MU100 Native":"MU Basic"}.`)):f>=64&&f<69&&[()=>{e.dispatchEvent("channelactive",s)},()=>{s<8?(e.dispatchEvent("channelmin",s<<4),console.debug(`Octavia System: Minimum CH${(s<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{s<8?(e.dispatchEvent("channelmax",(s<<4)+15),console.debug(`Octavia System: Maximum CH${(s<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{w(e,se,!!s),console.info(`Octavia System: RS receiving ${["dis","en"][s]}abled.`)}][f-64]()})}).add([73,10,0],(a,i)=>{let c=a[0],n=`MU1000 RS${t(e,se)?"":" (ignored)"}: `;if(c<16)switch(c){case 2:{let s=e.chRedir(0,i,!0);t(e,se)&&(e.dispatchEvent("channelmin",s),e.dispatchEvent("channelmax",s+63)),console.info(`${n}Show CH1~64`);break}case 3:{let s=e.chRedir(a[1]<<5,i,!0);t(e,se)&&e.dispatchEvent("channelmin",s),t(e,se)&&e.dispatchEvent("channelmax",s+31),console.info(`${n}Show CH${s+1}~CH${s+32}`);break}default:console.debug(`${n}unknown switch ${c} invoked.`)}else if(c<32){if(t(e,se)){let s=e.chRedir(c-16+(t(e,Ie)<<4),i,!0);e.dispatchEvent("channelactive",s)}}else if(c<36){let s=e.chRedir(c-32<<4,i,!0);t(e,se)&&(e.dispatchEvent("channelmin",s),e.dispatchEvent("channelmax",s+15),w(e,Ie,c-32)),console.info(`${n}Show CH${s+1}~CH${s+16}`)}}).add([93,3],(a,i)=>{let c=e.chRedir(a[0],i,!0),n=`PLG-100SG CH${c+1} `,s=Date.now();if(a[1]==0){let o="",f=0;a.subarray(2).forEach((l,p)=>{p%2==0?o+=gt[l]||l.toString().padStart("0"):f+=l*13}),s>=t(e,Ge)&&this.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"SGLyrics",data:`${$t(o)}`,amend:!0}),w(e,Ge,s+Math.ceil(f/2)+t(e,Be)),U()&&console.debug(`${n}vocals: ${o}`)}else console.warn(`Unknown PLG-100SG data: ${a}`)});let d=function(a,i,c,n){},h=function(a,i){let c=a*$.dpn,n=i[0],s=i[1];i.subarray(2).forEach((o,f)=>{let l=f+s,p=-1;l<16?([()=>{p=24},()=>{p=25},()=>{p=26},()=>{},()=>{p=28},()=>{p=29},()=>{p=30},()=>{p=31},()=>{},()=>{},()=>{},()=>{p=20},()=>{p=21},()=>{p=22},()=>{p=23},()=>{}][l]||(()=>{console.debug(`Unknown XG-style drum param ${l} on set ${a+1}.`)}))():l<32||(l<40?([()=>{p=48},()=>{p=49},!1,!1,()=>{p=52},()=>{p=53}][l-32]||(()=>{console.debug(`Unknown XG-style drum param ${l} on set ${a+1}.`)}))():l<80||([()=>{p=36}][l-80]||(()=>{console.debug(`Unknown XG-style drum param ${l} on set ${a+1}.`)}))()),p>=0?(U()&&console.debug(c,p,n,o),t(e,K)[(c+ae[p])*$.dnc+n]=o):U()&&console.debug(`XG-style drum param ${l} has no writes.`)})},E=function(a,i,c){let n=a*$.dpn,s=(i<<7)+c[0];c.subarray(1).forEach((o,f)=>{let l=f+s,p=l&127,m=l>>7,S=-1;m>1&&([()=>{S=26},()=>{},()=>{S=28},()=>{S=29},()=>{S=30},()=>{},()=>{},()=>{S=31}][m-2]||(()=>{console.debug(`Unknown GS-style drum param ${m} on set ${a+1}.`)}))(),S>-1?(U()&&console.debug(n,S,p,o),t(e,K)[(n+ae[S])*$.dnc+p]=o):U()&&console.debug(`GS-style drum param ${m} has no writes.`)})};t(this,ee).add([76,48],(a,i,c)=>{h(0,a)}).add([76,49],(a,i,c)=>{h(1,a)}).add([76,50],(a,i,c)=>{h(2,a)}).add([76,51],(a,i,c)=>{h(3,a)}).add([76,52],(a,i,c)=>{h(4,a)}).add([76,53],(a,i,c)=>{h(5,a)}).add([76,54],(a,i,c)=>{h(6,a)}).add([76,55],(a,i,c)=>{h(7,a)}),t(this,ee).add([89,0],(a,i,c)=>{if(e.eprom){let n=a[0],s=(a[1]<<14)+(a[2]<<7)+a[3]+(e.eprom.offset||0);U()&&console.debug(`MU1000 EPROM trail to 0x${s.toString(16).padStart(6,"0")}, ${n} bytes.`);let o=e.eprom.data;a.subarray(4).forEach((f,l)=>{let p=l>>3,m=l&7;if(m==7)for(let S=0;S<7;S++)o[s+7*p+S]+=(f>>6-S&1)<<7;else o[s+7*p+m]=f})}}).add([89,1],(a,i,c)=>{let n=(a[0]<<21)+(a[1]<<14)+(a[2]<<7)+a[3];U()&&console.debug(`MU1000 EPROM jump to 0x${n.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=n)}).add([89,2],(a,i,c)=>{if(e.eprom){let n=(a[0]<<21)+(a[1]<<14)+(a[2]<<7)+a[3]+(e.eprom.offset||0);U()&&console.debug(`MU1000 EPROM write to 0x${n.toString(16).padStart(6,"0")}.`);let s=e.eprom.data;a.subarray(4).forEach((o,f)=>{let l=f>>3,p=f&7;if(p==7)for(let m=0;m<7;m++)s[n+7*l+m]+=(o>>6-m&1)<<7;else s[n+7*l+p]=o})}}).add([89,3],(a,i,c)=>{}),t(this,ee).add([39,48],(a,i,c)=>{}).add([43,0,0],(a,i,c)=>{let n=[0,0,0,0],s=(o,f)=>{n[f]=o};if(a.subarray(1).forEach((o,f)=>{let l=f+a[0];[s,s,s,s,()=>{w(this,P,o*129/16383*100),e.dispatchEvent("mastervolume",t(e,P))},()=>o-64,()=>o||128,()=>o,()=>o,()=>{console.debug(`TG300 variation on cc${o}.`)}][l](o,l)}),a[0]<4){let o=0;n.forEach(f=>{o=o<<4,o+=f}),o-=1024}}).add([43,1,0],(a,i,c)=>{}).add([43,2],(a,i,c)=>{let n=e.chRedir(a[0],i,!0),s=a[1],o=$.cc*n,f=`TG300 CH${n+1} `;a.subarray(2).forEach((l,p)=>{p<5?([()=>{},()=>{t(e,u)[o+y[0]]=l,e.dispatchEvent("voice",{part:n})},()=>{t(e,u)[o+y[32]]=l,e.dispatchEvent("voice",{part:n})},()=>{t(e,A)[n]=l,e.dispatchEvent("voice",{part:n})},()=>{let m=e.chRedir(l,i,!0);t(e,I)[n]=m,n!=m&&(e.buildRchTree(),console.info(`${f}receives from CH${m+1}`))}][p+s]||(()=>{}))(l,p+s):p<21||(p<47?([()=>{t(e,W)[n]=+!l},()=>{},()=>{},()=>{t(e,C)[$.rpn*n+3]=l,t(e,T)[$.rpnt*n+2]=1},()=>{},()=>{t(e,u)[o+y[7]]=l},!1,!1,()=>{t(e,u)[o+y[10]]=l||128},!1,!1,()=>{console.debug(`${f} AC1 at cc${l}`)},()=>{console.debug(`${f} AC2 at cc${l}`)},()=>{t(e,u)[o+y[128]]=l},()=>{t(e,u)[o+y[93]]=l},()=>{t(e,u)[o+y[91]]=l},()=>{t(e,u)[o+y[94]]=l},()=>{t(e,u)[o+y[76]]=l},()=>{t(e,u)[o+y[77]]=l},()=>{t(e,u)[o+y[74]]=l},()=>{t(e,u)[o+y[71]]=l},()=>{t(e,u)[o+y[73]]=l},()=>{t(e,u)[o+y[75]]=l},()=>{t(e,u)[o+y[72]]=l},()=>{t(e,u)[o+y[78]]=l}][p+s-21]||(()=>{}))(l,p+s):p<95||([()=>{t(e,u)[o+y[65]]=l},()=>{t(e,u)[o+y[5]]=l}][p+s-95]||(()=>{}))(l,p+s))})}).add([43,7,0],(a,i,c)=>{let n=a[0];e.setLetterDisplay(a.subarray(1),"TG300 letter display",n)}).add([43,7,1],(a,i,c)=>{w(e,V,0),w(e,ce,Date.now()+3200),t(e,J,fe).fill(0),a.forEach(function(n,s){let o=Math.floor(s/16),f=s%16,l=(f*3+o)*7,p=7,m=0;for(l-=f*5,o==2&&(p=2);m<p;)t(e,J,fe)[l+m]=n>>6-m&1,m++})}),t(this,te).add([66,18,0,0,127],(a,i,c)=>{e.switchMode("gs",!0),t(e,u)[$.cc*9]=120,t(e,u)[$.cc*25]=120,t(e,u)[$.cc*41]=120,t(e,u)[$.cc*57]=120,w(e,Z,3),w(e,L,!1),t(e,be).fill(0),console.info(`GS system to ${["single","dual"][a[0]]} mode.`)}).add([66,18,64,0],(a,i,c)=>{switch(a[0]){case 127:{e.switchMode("gs",!0),t(e,u)[$.cc*9]=120,t(e,u)[$.cc*25]=120,t(e,u)[$.cc*41]=120,t(e,u)[$.cc*57]=120,w(e,L,!1),t(e,be).fill(0),console.info("MIDI reset: GS");break}default:{let n=[0,0,0,0],s=(o,f)=>{n[f]=o};if(a.subarray(1).forEach((o,f)=>{let l=f+a[0];[s,s,s,s,p=>{w(this,P,p*129/16383*100),e.dispatchEvent("mastervolume",t(e,P))},p=>{},p=>{}][l](o,f)}),a[0]<4){let o=0;n.forEach(f=>{o=o<<4,o+=f}),o-=1024}}}}).add([66,18,64,1],a=>{let i=a[0];if(i<16){let c="".padStart(i," ");a.subarray(1).forEach((n,s)=>{c+=String.fromCharCode(Math.max(32,n))}),c=c.padEnd(16," "),console.debug(`GS patch name: ${c}`)}else i<48||(i<65?a.subarray(1).forEach((c,n)=>{let s=`GS ${i+n>55?"chorus":"reverb"} `;([()=>{console.info(`${s}type: ${tt[c]}`),e.setEffectType(0,40,c),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${s}predelay: ${c}ms`)},()=>{console.info(`${s}type: ${mt[c]}`),e.setEffectType(1,40,16+c),e.dispatchEvent("efxchorus",e.getEffectType(1))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${s}to reverb: ${q(c)}`)},()=>{console.debug(`${s}to delay: ${q(c)}`)}][i+n-48]||(()=>{}))()}):i<80?console.debug(`Unknown GS patch address: ${i}`):i<91?a.subarray(1).forEach((c,n)=>{let s="GS delay ";([()=>{console.info(`${s}type: ${vt[c]}`),e.setEffectType(2,40,32+c),e.dispatchEvent("efxdelay",e.getEffectType(2))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${s}to reverb: ${q(c)}`)}][i+n-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${i}`))}).add([66,18,64,2],a=>{let i="GS EQ ";a.subarray(1).forEach((c,n)=>{([()=>{console.debug(`${i}low freq: ${[200,400][c]}Hz`)},()=>{console.debug(`${i}low gain: ${c-64}dB`)},()=>{console.debug(`${i}high freq: ${[3e3,6e3][c]}Hz`)},()=>{console.debug(`${i}high gain: ${c-64}dB`)}][a[0]+n]||function(){console.warn(`Unknown GS EQ address: ${a[0]+n}`)})()})}).add([66,18,64,3],a=>{let i="GS EFX ",c=function(n,s){let o=wt(t(e,Y).subarray(10,12),s,n);o&&console.debug(`${i}${at(t(e,Y).subarray(10,12))} ${o}`)};a.subarray(1).forEach((n,s)=>{([()=>{e.setEffectTypeRaw(3,!1,32+n),e.dispatchEvent("efxinsert0",e.getEffectType(3))},()=>{e.setEffectTypeRaw(3,!0,n),console.info(`${i}type: ${at(t(e,Y).subarray(10,12))}`),e.dispatchEvent("efxinsert0",e.getEffectType(3))},!1,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,()=>{console.debug(`${i}to reverb: ${q(n)}dB`)},()=>{console.debug(`${i}to chorus: ${q(n)}dB`)},()=>{console.debug(`${i}to delay: ${q(n)}dB`)},!1,()=>{console.debug(`${i}1 source: ${n}`),n&&n<96&&e.allocateAce(n)},()=>{console.debug(`${i}1 depth: ${n-64}`)},()=>{console.debug(`${i}2 source: ${n}`),n&&n<96&&e.allocateAce(n)},()=>{console.debug(`${i}2 depth: ${n-64}`)},()=>{console.debug(`${i}to EQ: ${n?"ON":"OFF"}`)}][a[0]+s]||function(o,f){console.warn(`Unknown GS EFX address: ${f}`)})(n,a[0]+s)})}).add([66,18,65],a=>{E((a[0]>>4)+1<<1,a[0]&15,a.subarray(1))}).add([69,18,16],a=>{var i;switch(a[0]){case 0:{let c=a[1];e.setLetterDisplay(a.subarray(2),"GS display text",c);break}case 32:{w(e,ce,Date.now()+3200),a[1]==0&&(w(e,V,Math.max(Math.min(a[2]-1,9),0)),U()&&console.debug(`GS switch display page ${a[2]-1}.`));break}default:if(a[0]<6){t(e,V)>9&&w(e,V,0);let c=a[0]-1<<1|a[1]>>6;t(e,V)==c&&w(e,ce,Date.now()+3200),(i=t(e,he)[c])!=null&&i.length||(t(e,he)[c]=new Uint8Array(256));let n=t(e,he)[c];U()&&console.debug(`GS frame draw page ${c}.`);let s=a[1]&63;n.fill(0),a.subarray(2).forEach(function(f,l){let p=l+s,m=Math.floor(p/16),S=p%16,O=(S*4+m)*5,H=5,F=0;for(O-=S*4,m==3&&(H=1);F<H;)n[O+F]=f>>4-F&1,F++})}else console.warn(`Unknown GS display section: ${a[0]}`)}});let b=function(a,i,c){let n=a[0],s=$.cc*i,o=$.rpn*i,f=`GS CH${i+1} `;n<3?(a.subarray(1).forEach((l,p)=>{[()=>{t(e,u)[s+y[0]]=l},()=>{t(e,A)[i]=l},()=>{let m=0;l<16?m=e.chRedir(l,c,!0):m=$.ch,t(e,I)[i]=m,i!=m&&(e.buildRchTree(),console.info(`${f}receives from CH${m+1}`))}][n+p]()}),e.dispatchEvent("voice",{part:i})):n<19||(n<44?a.subarray(1).forEach((l,p)=>{([()=>{t(e,W)[i]=+!l},!1,()=>{e.setChType(i,l<<1,x.gs),console.debug(`${f}type: ${l?"drum ":"melodic"}${l||""}`)},()=>{t(e,C)[o+3]=l,t(e,T)[$.rpnt*i+2]=1},!1,()=>{t(e,u)[s+y[7]]=l},!1,!1,()=>{t(e,u)[s+y[10]]=l||128},!1,!1,()=>{console.debug(`${f}CC 1: cc${l}`)},()=>{console.debug(`${f}CC 2: cc${l}`)},()=>{t(e,u)[s+y[93]]=l},()=>{t(e,u)[s+y[91]]=l},!1,!1,()=>{t(e,C)[o+1]=l,t(e,T)[$.rpnt*i+1]=1},()=>{t(e,C)[o+2]=l,t(e,T)[$.rpnt*i+1]=1},()=>{t(e,u)[s+y[94]]=l}][n+p-19]||(()=>{}))()}):n<76||console.debug(`Unknown GS part address: ${n}`))},v=function(a,i){let c=a[0],n=`GS CH${i+1} `;c<2?a.subarray(1).forEach((s,o)=>{[()=>{t(e,u)[$.cc*i+y[32]]=s},()=>{}][c+o]()}):c<32?console.warn(`Unknown GS misc address: ${c}`):c<35?a.subarray(1).forEach((s,o)=>{[()=>{console.debug(`${n}EQ: o${["ff","n"][s]}`)},()=>{},()=>{console.debug(`${n}EFX: o${["ff","n"][s]}`),t(e,Ne)[i]=s,e.dispatchEvent("partefxtoggle",{part:i,active:s})}][c+o-32]()}):console.warn(`Unknown GS misc address: ${c}`)};t(this,te).add([66,18,64,16],(a,i)=>{b(a,e.chRedir(9,i,!0),i)}).add([66,18,64,17],(a,i)=>{b(a,e.chRedir(0,i,!0),i)}).add([66,18,64,18],(a,i)=>{b(a,e.chRedir(1,i,!0),i)}).add([66,18,64,19],(a,i)=>{b(a,e.chRedir(2,i,!0),i)}).add([66,18,64,20],(a,i)=>{b(a,e.chRedir(3,i,!0),i)}).add([66,18,64,21],(a,i)=>{b(a,e.chRedir(4,i,!0),i)}).add([66,18,64,22],(a,i)=>{b(a,e.chRedir(5,i,!0),i)}).add([66,18,64,23],(a,i)=>{b(a,e.chRedir(6,i,!0),i)}).add([66,18,64,24],(a,i)=>{b(a,e.chRedir(7,i,!0),i)}).add([66,18,64,25],(a,i)=>{b(a,e.chRedir(8,i,!0),i)}).add([66,18,64,26],(a,i)=>{b(a,e.chRedir(10,i,!0),i)}).add([66,18,64,27],(a,i)=>{b(a,e.chRedir(11,i,!0),i)}).add([66,18,64,28],(a,i)=>{b(a,e.chRedir(12,i,!0),i)}).add([66,18,64,29],(a,i)=>{b(a,e.chRedir(13,i,!0),i)}).add([66,18,64,30],(a,i)=>{b(a,e.chRedir(14,i,!0),i)}).add([66,18,64,31],(a,i)=>{b(a,e.chRedir(15,i,!0),i)}).add([66,18,64,64],(a,i)=>{v(a,e.chRedir(9,i,!0))}).add([66,18,64,65],(a,i)=>{v(a,e.chRedir(0,i,!0))}).add([66,18,64,66],(a,i)=>{v(a,e.chRedir(1,i,!0))}).add([66,18,64,67],(a,i)=>{v(a,e.chRedir(2,i,!0))}).add([66,18,64,68],(a,i)=>{v(a,e.chRedir(3,i,!0))}).add([66,18,64,69],(a,i)=>{v(a,e.chRedir(4,i,!0))}).add([66,18,64,70],(a,i)=>{v(a,e.chRedir(5,i,!0))}).add([66,18,64,71],(a,i)=>{v(a,e.chRedir(6,i,!0))}).add([66,18,64,72],(a,i)=>{v(a,e.chRedir(7,i,!0))}).add([66,18,64,73],(a,i)=>{v(a,e.chRedir(8,i,!0))}).add([66,18,64,74],(a,i)=>{v(a,e.chRedir(10,i,!0))}).add([66,18,64,75],(a,i)=>{v(a,e.chRedir(11,i,!0))}).add([66,18,64,76],(a,i)=>{v(a,e.chRedir(12,i,!0))}).add([66,18,64,77],(a,i)=>{v(a,e.chRedir(13,i,!0))}).add([66,18,64,78],(a,i)=>{v(a,e.chRedir(14,i,!0))}).add([66,18,64,79],(a,i)=>{v(a,e.chRedir(15,i,!0))}),t(this,ye).add([54,65],(a,i)=>{e.switchMode("x5d");let c=(a[1]<<7)+a[0],n=(a[3]<<7)+a[2],s=e.chRedir(c&15,i,!0),o=$.cc*s;[()=>{n<1||(n<101?(e.setChType(s,e.CH_MELODIC,x.x5d),t(e,A)[s]=n-1,t(e,u)[o+y[0]]=82):n<229?(e.setChType(s,e.CH_MELODIC,x.x5d),t(e,A)[s]=n-101,t(e,u)[o+y[0]]=56):(e.setChType(s,e.CH_DRUMS,x.x5d),t(e,A)[s]=Ot[n-229]||0,t(e,u)[o+y[0]]=62)),e.dispatchEvent("voice",{part:s})},()=>{t(e,u)[o+y[7]]=n},()=>{n<31&&(t(e,u)[o+y[10]]=Math.round((n-15)*4.2+64))},()=>{t(e,u)[o+y[93]]=Ve(n)},()=>{t(e,u)[o+y[91]]=Ve(n)},()=>{t(e,C)[s*$.rpn+3]=n>8191?n-16320:64+n,t(e,T)[$.rpnt*s+2]=1},()=>{t(e,C)[s*$.rpn+1]=n>8191?n-16320:64+n,t(e,T)[$.rpnt*s+1]=1},()=>{n>0&&(t(e,C)[s*$.rpn]=n,t(e,T)[$.rpnt*s]=1)},()=>{}][c>>4]()}).add([54,76,0],(a,i)=>{e.switchMode("x5d",!0);let c="",n=82,s=0,o=0,f="MSB	PRG	LSB	NME";ne(a,function(l,p){if(p<16400){let m=p%164;switch(!0){case m<10:{l>31&&(c+=String.fromCharCode(l));break}case m==11:{f+=`
${n}	${s}	${o}	${c.trim().replace("Init Voice","")}`,s++,c="";break}}s>99&&(n=90,s=0)}}),e.userBank.clearRange({msb:82,prg:[0,99],lsb:0}),e.userBank.load(f),U()&&console.debug(f),e.forceVoiceRefresh()}).add([54,77,0],(a,i)=>{e.switchMode("x5d",!0);let c="",n=90,s=0,o=0,f="MSB	PRG	LSB	NME";ne(a,function(l,p){if(p<13600){let m=p%136;switch(!0){case m<10:{l>31&&(c+=String.fromCharCode(l));break}case m==11:{f+=`
${n}	${s}	${o}	${c.trim().replace("Init Combi","")}`,s++,c="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(f),U()&&console.debug(f),e.forceVoiceRefresh()}).add([54,78],(a,i)=>{e.switchMode("x5d",!0),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][a[0]]} mode.`)}).add([54,85],(a,i)=>{e.switchMode("x5d",!0),ne(a,(c,n)=>{n>0&&n<3&&(e.setEffectType(n-1,44,c),e.dispatchEvent(`efx${["reverb","chorus"][n-1]}`,e.getEffectType(n-1)))})}).add([54,104],(a,i)=>{e.switchMode("x5d",!0),ne(a,function(c,n,s,o){if(n<192){let f=e.chRedir(Math.floor(n/12),i,!0),l=f*$.cc;switch(n%12){case 0:{c<128?(e.setChType(f,e.CH_MELODIC,x.x5d),t(e,u)[l+y[0]]=82,t(e,A)[f]=c):(e.setChType(f,e.CH_DRUMS,x.x5d),t(e,u)[l+y[0]]=62,t(e,A)[f]=Ot[c-128]),c>0&&e.setChActive(f,1),e.dispatchEvent("voice",{part:f});break}case 1:{t(e,u)[l+y[7]]=c;break}case 2:{t(e,C)[f*$.rpn+3]=c>127?c-192:64+c,t(e,T)[$.rpnt*f+2]=1;break}case 3:{t(e,C)[f*$.rpn+1]=c>127?c-192:64+c,t(e,T)[$.rpnt*f+1]=1;break}case 4:{c<31&&(t(e,u)[l+y[10]]=Math.round((c-15)*4.2+64));break}case 5:{let p=c>>4,m=c&15;t(e,u)[l+y[91]]=Ve(m),t(e,u)[l+y[93]]=Ve(p);break}case 10:break;case 11:{let p=e.chRedir(c&15,i,!0),m=c>>4;t(e,I)[f]=c,(p!=f||m)&&(console.info(`X5D Part CH${f+1} receives from CH${p+1}.`),e.buildRchTree())}}}else{let f=e.chRedir(n-192,i,!0)}})}),t(this,te).add([22,18,127],a=>{e.switchMode("mt32",!0),w(e,L,!1),e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(a,i,c)=>{e.switchMode("mt32");let n=e.chRedir(c,i,!0),s=a[1];a.subarray(2).forEach((o,f)=>{let l=f+s;t(e,$e)[l+(n-1)*16]=o,([!1,()=>{let p=t(e,$e)[n-1<<4];if(p<3){if(t(e,le)[n]=1,p==2)for(let m=0;m<name.length;m++)t(e,re)[(n-1)*$.cmt+m]=t(e,Ee)[o*$.cmt+m];else{let m=e.baseBank.get(0,o+(p<<6),127,"mt32").name;for(let S=0;S<m.length;S++)t(e,re)[(n-1)*$.cmt+S]=m.charCodeAt(S)}e.dispatchEvent("voice",{part:n})}},()=>{t(e,C)[n*$.rpn+3]=o+40,t(e,T)[$.rpnt*n+2]=1},()=>{t(e,C)[n*$.rpn+1]=o+14,t(e,T)[$.rpnt*n+1]=1},()=>{t(e,C)[n*$.rpn]=o,t(e,T)[$.rpnt*n]=1},!1,()=>{t(e,u)[$.cc*n+y[91]]=o?127:0},!1,()=>{t(e,u)[$.cc*n+y[7]]=o},()=>{t(e,u)[$.cc*n+y[10]]=Math.ceil(o*9.05)}][l]||(()=>{}))()})}).add([22,18,1],(a,i,c)=>{e.switchMode("mt32");let n=c&7;console.debug(`MT-32 slot #${c+1} Drum: ${a}`);let s=a[0]<<7|a[1];a.subarray(2).forEach((o,f)=>{let l=f+s,p=(l>>2)+24,m=l&3,S=n*$.dpn;if(U()&&console.debug(`MT-32 temp drum note ${p} param ${m}: ${o}`),p<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${p}`);return}[()=>{},()=>{t(e,K)[(S+ae[26])*$.dnc+p]=Math.round(o*1.27)},()=>{t(e,K)[(S+ae[26])*$.dnc+p]=o*9+1&127},()=>{t(e,K)[(S+ae[26])*$.dnc+p]=o?127:0}][m]()})}).add([22,18,2],(a,i,c)=>{e.switchMode("mt32");let n=e.chRedir(c,i,!0),s=a[1]+(a[0]<<7);s<10&&(t(e,le)[n]=1),a.subarray(2).forEach((o,f)=>{let l=f+s;l<14&&(t(e,re)[(n-1)*$.cmt+l]=o)}),e.dispatchEvent("voice",{part:n})}).add([22,18,3],(a,i,c)=>{e.switchMode("mt32");let n=c&7;if(a[0]){let s=(a[0]-1<<7)+a[1]-16;a.subarray(2).forEach((o,f)=>{let l=f+s,p=(l>>2)+24,m=l&3,S=n*$.dpn;if(U()&&console.debug(`MT-32 dev drum note ${p} param ${m}: ${o}`),p<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${p}`);return}[()=>{},()=>{t(e,K)[(S+ae[26])*$.dnc+p]=Math.round(o*1.27)},()=>{t(e,K)[(S+ae[26])*$.dnc+p]=o*9+1&127},()=>{t(e,K)[(S+ae[26])*$.dnc+p]=o?127:0}][m]()})}else{let s=a[1];a.subarray(2).forEach((o,f)=>{let l=f+s;t(e,$e)[l]=o;let p=e.chRedir(1+(l>>4),i,!0),m=l&15;([!1,()=>{let S=t(e,$e)[p-1<<4];if(S<3)if(t(e,le)[p]=1,S==2)for(let O=0;O<name.length;O++)t(e,re)[(p-1)*$.cmt+O]=t(e,Ee)[o*$.cmt+O];else{let O=e.baseBank.get(0,o+(S<<6),127,"mt32").name;for(let H=0;H<O.length;H++)t(e,re)[(p-1)*$.cmt+H]=O.charCodeAt(H)}e.dispatchEvent("voice",{part:p})},()=>{t(e,C)[p*$.rpn+3]=o+40,t(e,T)[$.rpnt*p+2]=1},()=>{t(e,C)[p*$.rpn+1]=o+14,t(e,T)[$.rpnt*p+1]=1},()=>{t(e,C)[p*$.rpn]=o,t(e,T)[$.rpnt*p]=1},!1,()=>{t(e,u)[$.cc*p+y[91]]=o?127:0},!1,()=>{t(e,u)[$.cc*p+y[7]]=o},()=>{t(e,u)[$.cc*p+y[10]]=Math.ceil(o*9.05)}][m]||(()=>{}))()})}}).add([22,18,4],(a,i,c)=>{e.switchMode("mt32");let n=a[1]+(a[0]<<7),s=[];a.subarray(2).forEach((o,f)=>{let l=f+n,p=e.chRedir(Math.floor(l/246+1),i,!0),m=l%246;m<14&&(t(e,re)[(p-1)*$.cmt+m]=o),m<10&&(t(e,le)[p]=1),s.indexOf(p)<0&&s.push(p)}),s.forEach(o=>{e.dispatchEvent("voice",{part:o})})}).add([22,18,5],(a,i,c)=>{e.switchMode("mt32");let n=(a[0]<<7)+a[1];a.subarray(2).forEach((s,o)=>{let f=n+o,l=Math.floor(f/8),p=f&7,m=l*8;t(e,He)[f]=s,([!1,()=>{let S=t(e,He)[m];if(S<3){let O="";if(S==2){let H=$.cmt*l;O=`MT-m:${s.toString().padStart(3,"0")}`}else O=e.baseBank.get(0,s+(S<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:l}),e.userBank.load(`MSB	LSB	PRG	NME
000	127	${l}	${O}`,!0)}}][p]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(a,i,c)=>{e.switchMode("mt32");let n=((a[0]&1)<<7)+a[1];a.subarray(2).forEach((s,o)=>{let f=n+o;f<$.cmt&&(t(e,Ee)[(a[0]>>1)*$.cmt+f]=s)}),e.forceVoiceRefresh()}).add([22,18,16],(a,i,c)=>{e.switchMode("mt32");let n=a[1],s=!1,o=function(f,l){t(e,I)[l-12]=f,s=!0};a.subarray(2).forEach((f,l)=>{let p=l+n;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,o,o,o,o,o,o,o,o,o,()=>{w(e,P,f),e.dispatchEvent("mastervolume",t(e,P))}][p]||(()=>{}))(f,l)}),s&&e.buildRchTree()}).add([22,18,32],a=>{e.switchMode("mt32");let i=a[1],c=" ".repeat(i);a.subarray(2).forEach(n=>{n>31?c+=String.fromCharCode(n):c+=" "}),w(e,ve,c.padStart(20," ")),w(e,we,Date.now()+3200)}).add([22,18,82],(a,i)=>{let c=e.chRedir(0,i,!0);for(let n=0;n<16;n++)t(e,G).ano(c+n),n&&n<10&&(t(e,A)[c+n]=rt[n-1]);console.info("MT-32 alt reset complete.")}),t(this,ye).add([66,0],(a,i)=>{e.switchMode("ns5r",!0),w(e,L,!1),console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][a[0]]} mode.`)}).add([66,1],(a,i)=>{e.switchMode(["ns5r","05rw"][a[0]],!0),w(e,L,!1)}).add([66,18,0,0],(a,i)=>{let c=a[0];switch(c){case 124:case 126:case 127:{e.switchMode("ns5r",!0),w(e,L,!1);break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset: ${a}`);break}default:if(c<10){let n=[0,0,0,0],s=(o,f)=>{n[f]=o};if(a.subarray(1).forEach((o,f)=>{[s,s,s,s,()=>{w(e,P,o*129/16383*100),e.dispatchEvent("mastervolume",t(e,P))},()=>o-64,()=>o-64,()=>{},()=>{},()=>{}][c+f]()}),a[0]<4){let o=0;n.forEach(f=>{o=o<<4,o+=f}),o-=1024}}}}).add([66,18,0,1],(a,i)=>{}).add([66,18,0,2],(a,i)=>{}).add([66,18,1],(a,i)=>{let c=e.chRedir(a[0],i,!0),n=c*$.cc,s=a[1],o=`NS5R CH${c+1} `;a.subarray(2).forEach((f,l)=>{let p=s+l;p<3?([()=>{t(e,u)[n+y[0]]=f||121},()=>{t(e,u)[n+y[32]]=f},()=>{t(e,A)[c]=f}][p](),e.dispatchEvent("voice",{part:c})):p<8||(p<14?[()=>{let m=e.chRedir(f,i,!0);t(e,I)[c]=m,c!=m&&(e.buildRchTree(),console.info(`${o}receives from CH${m+1}`))},()=>{t(e,W)[c]=+!f},()=>{e.setChType(c,f,x.ns5r),console.debug(`${o}type: ${Fe[f]}`)},()=>{t(e,C)[$.rpn*c+3]=f,t(e,T)[$.rpnt*c+2]=1},()=>{},()=>{}][p-8]():p<16||(p<33?[()=>{t(e,u)[n+y[7]]=f},()=>{t(e,u)[n+y[11]]=f},()=>{},()=>{},()=>{t(e,u)[n+y[10]]=f||128},()=>{},()=>{},()=>{t(e,u)[n+y[93]]=f},()=>{t(e,u)[n+y[91]]=f},()=>{t(e,u)[n+y[76]]=f},()=>{t(e,u)[n+y[77]]=f},()=>{t(e,u)[n+y[78]]=f},()=>{t(e,u)[n+y[74]]=f},()=>{t(e,u)[n+y[71]]=f},()=>{t(e,u)[n+y[73]]=f},()=>{t(e,u)[n+y[75]]=f},()=>{t(e,u)[n+y[72]]=f}][p-16]():p<112||p<114&&[()=>{t(e,u)[n+y[5]]=f},()=>{t(e,u)[n+y[65]]=f}][p-112]()))})}).add([66,18,8,0],(a,i)=>{let c=a[0];if(c<32)e.setLetterDisplay(a.subarray(1,33),"NS5R letter display");else{let n=c-32;w(e,ce,Date.now()+3200),w(e,V,10),t(e,J,fe).fill(0);let s=a.subarray(1),o=4;s.forEach(function(f,l){let p=l+n,m=p>>4,S=p&15;if(p<80){let O=m<o?f:f>>3,H=0,F=m<o?6:3;for(;O>0;)t(e,J,fe)[S*32+m*7+(F-H)]=O&1,O=O>>1,H++}})}}).add([66,18,48],(a,i,c)=>{h(0,a)}).add([66,18,49],(a,i,c)=>{h(1,a)}).add([66,18,50],(a,i,c)=>{h(2,a)}).add([66,18,51],(a,i,c)=>{h(3,a)}).add([66,18,52],(a,i,c)=>{h(4,a)}).add([66,18,53],(a,i,c)=>{h(5,a)}).add([66,18,54],(a,i,c)=>{h(6,a)}).add([66,18,55],(a,i,c)=>{h(7,a)}).add([66,52],(a,i)=>{e.switchMode("ns5r",!0),w(e,L,!1);let c="";ne(a,(n,s)=>{s<8?(n>31&&(c+=String.fromCharCode(n)),s==7&&(e.aiEfxName=c)):s<10&&(e.setEffectType(s-8,44,n),e.dispatchEvent(`efx${["reverb","chorus"][s-8]}`,e.getEffectType(s-8)))})}).add([66,53],(a,i)=>{e.switchMode("ns5r",!0),w(e,L,!1),ne(a,function(c,n){switch(!0){case n<2944:{let s=e.chRedir(Math.floor(n/92),i,!0),o=s*$.cc;switch(n%92){case 0:{t(e,u)[o+y[0]]=c||121,e.dispatchEvent("voice",{part:s});break}case 1:{t(e,u)[o+y[32]]=c,e.dispatchEvent("voice",{part:s});break}case 2:{t(e,A)[s]=c,c>0&&e.setChActive(s,1),e.dispatchEvent("voice",{part:s});break}case 3:{let f=e.chRedir(c,i,!0);t(e,I)[s]=f,s!=f&&(console.info(`NS5R CH${s+1} receives from CH${f+1}.`),e.buildRchTree())}case 7:break;case 8:{t(e,C)[s*$.rpn+3]=c<40||c>88?c+(c>63?-192:64):c,t(e,T)[$.rpnt*s+2]=1;break}case 9:case 10:{t(e,u)[o+y[7]]=c;break}case 11:{t(e,u)[o+y[11]]=c;break}case 14:{t(e,u)[o+y[10]]=c||128;break}case 19:{t(e,u)[o+y[93]]=c;break}case 20:{t(e,u)[o+y[91]]=c;break}case 84:{t(e,u)[o+y[65]]=c;break}case 85:{t(e,u)[o+y[5]]=c;break}}break}case n<3096:break;case n<3134:break;case n<8566:break}})}).add([66,54],(a,i)=>{e.switchMode("ns5r",!0);let c="",n=80,s=0,o=0,f="MSB	PRG	LSB	NME";ne(a,function(l,p){let m=p%158;switch(!0){case m<10:{l>31&&(c+=String.fromCharCode(l));break}case m==11:{n=l&127;break}case m==12:{o=l&127;break}case m==13:{f+=`
${n}	${s}	${o}	${c.trim().replace("Init Voice","")}`,s++,c="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(f),U()&&console.debug(f),e.forceVoiceRefresh()}).add([66,55],(a,i)=>{e.switchMode("ns5r",!0);let c="",n=88,s=0,o=0,f="MSB	PRG	LSB	NME";ne(a,function(l,p){let m=p%126;switch(!0){case m<10:{l>31&&(c+=String.fromCharCode(l));break}case m==11:break;case m==12:break;case m==13:{f+=`
${n}	${s}	${o}	${c.trim().replace("Init Combi","")}`,s++,c="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(f),U()&&console.debug(f),e.forceVoiceRefresh()}).add([66,125],a=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][a[0]]||"white")}).add([66,127],a=>{let i=new Uint8Array(5760);ne(a,(c,n,s)=>{if(n<720)for(let o=0;o<8;o++)i[n*8+o]=c>>7-o&1}),e.dispatchEvent("screen",{type:"ns5r",data:i})}).add([76],(a,i,c)=>{t(e,ye).run([66,...a],i,c)}),t(this,Oe).add([16,0,8,0],(a,i,c)=>{let n=(a[2]<<4)+a[3],s="K11 ";([()=>{e.switchMode("k11",!0),w(e,L,!1),w(e,Z,n?4:0),console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,n),console.debug(`${s}reverb type: ${n}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{console.debug(`${s}reverb time: ${n}`)},()=>{console.debug(`${s}reverb time: ${n}`)},()=>{console.debug(`${s}reverb predelay: ${n}`)},()=>{console.debug(`${s}reverb predelay: ${n}`)},()=>{console.debug(`${s}depth high: ${n}`)},()=>{console.debug(`${s}depth high: ${n}`)},()=>{console.debug(`${s}depth low: ${n}`)},()=>{console.debug(`${s}depth low: ${n}`)}][a[0]]||(()=>{}))()}).add([16,0,8,1],(a,i,c)=>{let n=e.chRedir(a[1],i,!0),s=$.cc*n,o=$.rpn*n,f=(a[3]<<4)+a[4],l=`K11 CH${n+1} `;([()=>{f<128?(e.setChType(n,e.CH_MELODIC,x.k11),t(e,u)[s+y[0]]=0,t(e,A)[n]=f):(e.setChType(n,e.CH_DRUMS,x.k11),t(e,A)[n]=f-128),e.dispatchEvent("voice",{part:n})},()=>{let p=e.chRedir(f,i,!0);t(e,I)[n]=p,n!=p&&(e.buildRchTree(),console.info(`${l}receives from CH${p+1}`))},()=>{t(e,u)[s+y[7]]=f},()=>{uupThis.setChActive(n,f)},()=>{t(e,u)[s+y[10]]=f},()=>{t(e,C)[o+3]=f+40,t(e,T)[$.rpnt*n+2]=1},()=>{t(e,C)[o+1]=f>>1,t(e,C)[o+2]=f&1,t(e,T)[$.rpnt*n+1]=1},()=>{t(e,u)[s+y[91]]=f?127:0},()=>{},()=>{t(e,u)[s+y[74]]=f},()=>{t(e,u)[s+y[73]]=f},()=>{t(e,u)[s+y[72]]=f}][a[0]]||(()=>{}))()}).add([16,0,9,0],(a,i,c)=>{let n=(a[2]<<4)+a[3],s="GMLX ";([()=>{console.debug(`${s}reverb type: ${n}`)},()=>{console.debug(`${s}reverb time: ${n}`)},()=>{console.debug(`${s}reverb predelay: ${n}`)},()=>{console.debug(`${s}depth high: ${n}`)},()=>{console.debug(`${s}depth low: ${n}`)}][a[0]]||(()=>{}))()}).add([16,0,9,3],(a,i,c)=>{let n=(a[2]<<4)+a[3],s=e.chRedir(a[1],i,!0),o=s*$.cc;[()=>{n<128?(e.setChType(s,e.CH_MELODIC,x.k11),t(e,u)[o+y[0]]=0,t(e,u)[o+y[32]]=0,t(e,A)[s]=n):n<160?(e.setChType(s,e.CH_MELODIC,x.k11),t(e,u)[o+y[0]]=0,t(e,u)[o+y[32]]=7,t(e,A)[s]=n-100):(e.setChType(s,e.CH_DRUMS,x.k11),t(e,u)[o+y[0]]=122,t(e,u)[o+y[32]]=0,t(e,A)[s]=n-160),e.dispatchEvent("voice",{part:s})},()=>{let f=e.chRedir(n,i,!0);t(e,I)[s]=f,s!=f&&(e.buildRchTree(),console.info(`GMLX CH${s+1} receives from CH${f+1}`))}][a[0]]()}).add([16,0,9,4],(a,i,c)=>{let n=(a[2]<<4)+a[3],s=e.chRedir(a[1],i,!0),o=s*$.cc,f=s*$.rpn,l=`GMLX CH${s+1} `;[()=>{e.setChActive(s,n)},()=>{t(e,u)[o+y[7]]=n},()=>{t(e,u)[o+y[10]]=n},()=>{t(e,u)[o+y[91]]=n?127:0},()=>{t(e,C)[f+3]=n+40,t(e,T)[$.rpnt*s+2]=1},()=>{t(e,C)[f+1]=n,t(e,T)[$.rpnt*s+1]=1},()=>{t(e,C)[f]=n,t(e,T)[$.rpnt*s]=1},()=>{}][a[0]]()}),t(this,De).add([66,93,64],(a,i,c)=>{let n=a[2];switch(a[0]){case 0:{switch(a[1]){case 4:{w(e,P,n*129/16383*100),e.dispatchEvent("mastervolume",t(e,P));break}case 5:{n-64;break}case 6:{console.debug(`SG global reverb: ${n?"on":"off"}`);break}case 127:{e.switchMode("sg",!0);break}}break}case 1:{switch(a[1]){case 48:{console.debug(`SG reverb type: ${tt[n]}`);break}}break}default:if(a[0]>>4==1){let s=e.chRedir(a[0]&15,i,!0);if(a[1]==2){let o=e.chRedir(n,i,!0);t(e,I)[s]=o,s!=o&&(e.buildRchTree(),console.info(`SG CH${s+1} receives from CH${o+1}`))}else a[1]==19&&(t(e,u)[$.cc*s+y[7]]=n)}else console.warn(`Unknown AKAI SG SysEx: ${a}`)}}),t(this,Ae).add([9],(a,i,c)=>{console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremelo","phaser","rotary speaker","enhancer","flanger","EQ"][a[0]]||"off"}`)}),t(this,ee).add([127,0],(a,i,c)=>{e.switchMode("motif");let n=new Uint8Array([127,1,...a]);t(e,ee).run(n,i,c)}).add([127,1,0,0],(a,i,c)=>{e.switchMode("s90es");let n="S90/Motif ES system ",s=a[0];a.subarray(1).forEach((o,f)=>{([()=>{w(e,P,o*12900/16383),e.dispatchEvent("mastervolume",t(e,P))}][s+f]||(()=>{console.info(`Unrecognized ${n}ID: ${s+f}`)}))()})}).add([127,1,0,0,14],(a,i,c)=>{e.switchMode("s90es");let n="S90/Motif ES bulk header ",s=[];s[95]=(o,f,l)=>{console.debug(`${n}multi edit buffer: ${o[1]}`)},(s[a[0]]||(()=>{console.info(`Unrecognized ${n}ID: ${a[0]}.`)}))(a.subarray(1))}).add([127,1,0,0,15],(a,i,c)=>{e.switchMode("s90es");let n="S90/Motif ES bulk footer ",s=[];s[95]=(o,f,l)=>{console.debug(`${n}multi edit buffer: ${o[1]}`)},(s[a[0]]||(()=>{console.info(`Unrecognized ${n}ID: ${a[0]}.`)}))(a.subarray(1))}).add([127,1,0,58,55],(a,i,c)=>{e.switchMode("s90es");let n=e.chRedir(a[0],i,!0),s=$.cc*n,o=a[1],f=`S90/Motif ES bulk CH${n<16?n+1:"U"+(n-95)} `;console.debug(f,a),!(a[0]>15)&&a.subarray(2).forEach((l,p)=>{([()=>{t(e,u)[s+y[0]]=l,e.dispatchEvent("voice",{part:n})},()=>{l&&e.setChActive(n,1),t(e,u)[s+y[32]]=l,e.setChType(n,[32,40].indexOf(l)>-1?e.CH_DRUMS:e.CH_MELODIC,t(e,D),!0),e.dispatchEvent("voice",{part:n})},()=>{l&&e.setChActive(n,1),t(e,A)[n]=l,e.dispatchEvent("voice",{part:n})},()=>{let m=e.chRedir(l,i,!0);t(e,I)[n]=m,n!=m&&(e.buildRchTree(),console.info(`${f}receives from CH${m+1}`))},()=>{t(e,W)[n]=l?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{t(e,u)[s+y[7]]=l},()=>{t(e,u)[s+y[10]]=l},!1,!1,!1,()=>{t(e,u)[s+y[91]]=l},()=>{t(e,u)[s+y[93]]=l},()=>{t(e,u)[s+y[94]]=l},()=>{t(e,u)[s+y[128]]=l},()=>{},()=>{t(e,u)[s+y[74]]=l},()=>{t(e,u)[s+y[71]]=l},!1,()=>{t(e,u)[s+y[65]]=l},()=>{t(e,u)[s+y[5]]=l},()=>{}][o+p]||(()=>{}))()})}).add([127,1,54,16],(a,i,c)=>{e.switchMode("s90es");let n=a[0];a.subarray(1).forEach((s,o)=>{let l=`S90/Motif ES EQ${(o>>2)+1} `;([()=>{let p=s-64},()=>{let p=Pe[s]},()=>{let p=s/10},()=>{let p=s}][n+o&3]||(()=>{}))()})}),t(this,te).add([0,72,18,0,0,0,0],(a,i,c)=>{e.switchMode("sd",!0),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(a,i,c)=>{let n=a[0]>>5,s=a[0]&31;switch(n){case 0:{console.debug(`Unknown SD-90 global effects message:
%o`,a);break}case 1:{let o=e.chRedir(s,i,!0),f=a[1],l=o*$.cc;a.subarray(2).forEach((p,m)=>{let S=f+m;S<37?([()=>{},()=>{},0,()=>{},()=>{switch(t(e,u)[l+y[0]]=p,p){case 104:case 105:case 106:case 107:case 120:{t(e,M)[o]||e.setChType(o,e.CH_DRUMS);break}default:t(e,M)[o]&&e.setChType(o,e.CH_MELODIC)}e.dispatchEvent("voice",{part:o})},()=>{t(e,u)[l+y[32]]=p,e.dispatchEvent("voice",{part:o})},()=>{t(e,A)[o]=p,e.dispatchEvent("voice",{part:o})},()=>{t(e,u)[l+y[7]]=p},()=>{t(e,u)[l+y[10]]=p},()=>{},()=>{},()=>{p<2&&(t(e,W)[o]=p)},()=>{p<2&&(t(e,u)[l+y[68]]=p?127:0)},()=>{},()=>{p<2&&(t(e,u)[l+y[65]]=p?127:0)},()=>{t(e,u)[l+y[5]]=p&15<<4|t(e,u)[l+y[5]]&15},()=>{t(e,u)[l+y[5]]=p&15|(t(e,u)[l+y[5]]&240)>>4},()=>{t(e,u)[l+y[74]]=p},()=>{t(e,u)[l+y[71]]=p},()=>{t(e,u)[l+y[73]]=p},()=>{t(e,u)[l+y[72]]=p},0,0,0,0,0,0,0,()=>{t(e,u)[l+y[128]]=p},()=>{t(e,u)[l+y[93]]=p},()=>{t(e,u)[l+y[91]]=p},0,0,()=>{t(e,u)[l+y[75]]=p},()=>{t(e,u)[l+y[76]]=p},()=>{t(e,u)[l+y[77]]=p},()=>{t(e,u)[l+y[78]]=p}][S]||(()=>{}))():S<63||(S<64?t(e,M)[o]?t(e,u)[l+y[0]]=104|p:t(e,u)[l+y[0]]=96|p:console.debug(`Unknown SD-90 global CH${o+1} param setup message:
%o`,a))});break}case 2:{let o=e.chRedir(s,i,!0),f=a[1];console.debug(`Unknown SD-90 global CH${o+1} MIDI setup message:
%o`,a.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,a)}})}chRedir(e,r,d){if(t(this,ke)[r])return(t(this,ke)[r]-1)*16+e;if([2,3].indexOf(t(this,Z))>-1){if(d==1)return e;let h=0,E=!0;for(;E;)t(this,be)[e+h]==0?(t(this,be)[e+h]=r,console.debug(`Assign track ${r} to channel ${e+h+1}.`),E=!1):t(this,be)[e+h]==r?E=!1:(h+=16,h>=128&&(h=0,E=!1));return e+h}else return e}forceVoiceRefresh(){for(let e=0;e<$.ch;e++)t(this,ue)[e]&&this.dispatchEvent("voice",{part:e})}buildRchTree(){let e=[];t(this,I).forEach((r,d)=>{var h;r<$.ch&&((h=e[r])!=null&&h.constructor||(e[r]=[]),e[r].push(d))}),w(this,Qe,e)}getActive(){return t(this,ue)}getCc(e){let r=e*$.cc,d=t(this,u).subarray(r,r+$.cc);return d[y[0]]=d[y[0]]||t(this,me),d[y[32]]=d[y[32]]||t(this,Z),d}getCcCh(e,r){if(Ke.indexOf(r)<0)throw new Error("CC number not accepted");return t(this,u)[$.cc*e+y[r]]}getCcAll(){let e=t(this,u).slice();for(let r=0;r<$.ch;r++){let d=r*$.cc;e[d+y[0]]=e[d+y[0]]||t(this,me),e[d+y[32]]=e[d+y[32]]||t(this,Z)}return e}getChSource(){return t(this,I)}getChType(){return t(this,M)}setChType(e,r,d=t(this,D),h=!1){r&=15,t(this,M)[e]=r,r>0&&!h&&(t(this,u)[e*$.cc+y[0]]=Se[d])}setChActive(e,r=0){t(this,ue)[e]!=r&&this.dispatchEvent("channeltoggle",{part:e,active:r}),t(this,ue)[e]=r}getPitch(){return t(this,ge)}getProgram(){return t(this,A)}getTexts(){return t(this,j).slice()}getVel(e){let r=new Map,d=this;return t(d,B).forEach(function(h,E){let b=Math.floor(h/128),v=h%128;e==b&&t(d,N)[h]>0&&r.set(v,{v:t(d,N)[h],s:t(d,_)[E]})}),r}getBitmap(){return{bitmap:t(this,J,fe),expire:t(this,ce)}}getLetter(){return{text:t(this,ve),set:t(this,ze),expire:t(this,we)}}getMode(){return de[t(this,D)]}getMaster(){return{volume:t(this,P)}}getRawStrength(){let e=this;return t(this,B).forEach(function(r){let d=Math.floor(r/128);t(e,N)[r]>t(e,oe)[d]&&(t(e,oe)[d]=t(e,N)[r])}),t(this,oe)}getStrength(){let e=[],r=this;return this.getRawStrength().forEach(function(d,h){e[h]=Math.floor(d*t(r,u)[h*$.cc+y[7]]*t(r,u)[h*$.cc+y[11]]*t(r,P)/803288)}),e}getRpn(){return t(this,C)}getNrpn(){return t(this,Le)}getVoice(e,r,d,h){let E=e||t(this,me),b=r,v=d||t(this,Z);de[t(this,D)]=="ns5r"&&E>0&&E<56&&(v=3);let a=this.userBank.get(E,b,v,h);if(de[t(this,D)]=="mt32"&&a.name.indexOf("MT-m:")==0){let i=parseInt(a.name.slice(5)),c=i*$.cmt,n="";t(this,Ee).subarray(c,c+10).forEach(s=>{s>31&&(n+=String.fromCharCode(s))}),this.userBank.load(`MSB	LSB	PRG
0	127	${b}	${n}`,!0),a.name=n,a.ending=" "}return(a.ending!=" "||!a.name.length)&&(a=this.baseBank.get(E,b,v,h)),a}getChVoice(e){let r=this.getVoice(t(this,u)[e*$.cc+y[0]],t(this,A)[e],t(this,u)[e*$.cc+y[32]],de[t(this,D)]);if(t(this,le)[e])switch(t(this,D)){case x.mt32:r.ending="~",r.name="",t(this,re).subarray(14*(e-1),14*(e-1)+10).forEach(d=>{d>31&&(r.name+=String.fromCharCode(d))})}return r}getPitchShift(e){let r=this,d=e*$.rpn,h=t(r,C)[d];return t(r,T)[e*$.rpnt]||t(r,D)==x.mt32&&(h=12),t(r,ge)[e]/8192*h+(t(r,C)[d+3]-64)+((t(r,C)[d+1]<<7)+t(r,C)[d+2]-8192)/8192}getEffectType(e=0){let r=3*e+1;return t(this,Y).subarray(r,r+2)}setEffectTypeRaw(e=0,r,d){let h=3*e;t(this,Y)[h]=1,t(this,Y)[h+1+ +r]=d}setEffectType(e=0,r,d){this.setEffectTypeRaw(e,!1,r),this.setEffectTypeRaw(e,!0,d)}getEffectSink(){return t(this,Ne)}setLetterDisplay(e,r,d=0,h=3200){let E=this,b;w(E,ve," ".repeat(d)),e.forEach(v=>{w(E,ve,t(E,ve)+String.fromCharCode(v>31?v:32)),v<32&&(b=b||new Set,b.add(v))}),w(E,ze,Date.now()),w(E,we,Date.now()+h),b&&(b=Array.from(b),b.forEach((v,a,i)=>{i[a]=v.toString(16).padStart(2,"0")}),console.warn(`${r}${r?" ":""}invalid code point${b.length>1?"s":""}: 0x${b.join(", 0x")}`))}allocateAce(e){if(!e||e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}let r=!0,d=0;for(;r&&d<$.ace;)t(this,pe)[d]==e?r=!1:t(this,pe)[d]||(r=!1,t(this,pe)[d]=e,console.info(`Allocated cc${e} to ACE slot ${d}.`)),d++;d>=$.ace&&console.warn("ACE slots are full.")}getAce(){return t(this,pe)}getChAce(e,r){if(r<0||r>=$.ace)throw new RangeError("No such ACE slot");let d=t(this,pe)[r];if(d){if(Ke.indexOf(d)>=0)return t(this,u)[e*$.cc+y[d]];throw new Error(`Invalid ACE source: ${d}`)}else return 0}initDrums(){let e=this;t(e,K).fill(64);for(let r=0;r<$.drm;r++){let d=r*$.dpn;for(let h in Rt){let E=Rt[h],b=(d+ae[h])*$.dnc;t(e,K).subarray(b,b+$.dnc).fill(E)}}}init(e=0){let r=this;w(r,me,0),w(r,Z,0),w(r,Ce,0),t(r,ue).fill(0),t(r,u).fill(0),t(r,pe).fill(0),t(r,A).fill(0),t(r,N).fill(0),t(r,B).fill(0),t(r,W).fill(0),t(r,oe).fill(0),t(r,ge).fill(0),t(r,Le).fill(0),t(r,T).fill(0),w(r,P,100),w(r,j,[]),w(r,Be,500),w(r,Ge,0),w(r,ce,0),w(r,V,0),t(r,J,fe).fill(0),w(r,L,!1),w(r,Ie,0),w(r,se,!0),r.initDrums(),t(r,I).forEach(function(d,h,E){E[h]=h}),r.buildRchTree(),e==0&&(r.dispatchEvent("mode","?"),w(r,D,0),t(r,be).fill(0),t(r,ke).fill(0),w(r,we,0),w(r,ve,"")),t(r,u)[$.cc*9]=Se[0],t(r,u)[$.cc*25]=Se[0],t(r,u)[$.cc*41]=Se[0],t(r,u)[$.cc*57]=Se[0],t(r,M).fill(r.CH_MELODIC),t(r,M)[9]=r.CH_DRUM1,t(r,M)[25]=r.CH_DRUM3,t(r,M)[41]=r.CH_DRUMS,t(r,M)[57]=r.CH_DRUMS,t(r,M)[73]=r.CH_DRUM5,t(r,M)[89]=r.CH_DRUM7,t(r,M)[105]=r.CH_DRUMS,t(r,M)[121]=r.CH_DRUMS,t(r,He).fill(0),t(r,Ee).fill(0),t(r,$e).fill(0),t(r,re).fill(0),t(r,le).fill(0),t(r,Y).fill(0),t(r,Ne).fill(0),r.aiEfxName="",r.userBank.clearRange({msb:0,lsb:127,prg:[0,127]});for(let d=0;d<$.ch;d++){let h=d*$.cc;t(r,u)[h+y[7]]=100,t(r,u)[h+y[11]]=127,t(r,u)[h+y[10]]=64,t(r,u)[h+y[71]]=64,t(r,u)[h+y[72]]=64,t(r,u)[h+y[73]]=64,t(r,u)[h+y[74]]=64,t(r,u)[h+y[75]]=64,t(r,u)[h+y[76]]=64,t(r,u)[h+y[77]]=64,t(r,u)[h+y[78]]=64,t(r,u)[h+y[91]]=40,t(r,u)[h+y[101]]=127,t(r,u)[h+y[100]]=127,t(r,u)[h+y[99]]=127,t(r,u)[h+y[98]]=127;let E=d*$.rpn;t(r,C)[E]=2,t(r,C)[E+1]=64,t(r,C)[E+2]=0,t(r,C)[E+3]=64,t(r,C)[E+4]=0,t(r,C)[E+5]=0}r.dispatchEvent("mastervolume",t(r,P)),r.dispatchEvent("efxreverb",r.getEffectType(0)),r.dispatchEvent("efxchorus",r.getEffectType(1)),r.dispatchEvent("efxdelay",r.getEffectType(2)),r.dispatchEvent("efxinsert0",r.getEffectType(3)),r.dispatchEvent("efxinsert1",r.getEffectType(4)),r.dispatchEvent("efxinsert2",r.getEffectType(5)),r.dispatchEvent("efxinsert3",r.getEffectType(6)),r.dispatchEvent("reset"),r.switchMode("?")}switchMode(e,r=!1){let d=this,h=de.indexOf(e);if(h>-1){if(t(d,D)==0||r){let E=t(d,D);d.initOnReset&&r&&(this.init(1),E=x["?"]),w(d,D,h),w(d,V,0),w(d,me,kt[0][h]),w(d,Z,kt[1][h]);for(let v=0;v<$.ch;v++)t(d,M)[v]>0&&t(d,u)[v*$.cc+y[0]]==Se[E]&&(t(d,u)[v*$.cc]=Se[h]);switch(h){case x.mt32:{rt.forEach((v,a)=>{let i=a+1;t(d,ue)[i]||(t(d,A)[i]=v,t(d,u)[i*$.cc+y[91]]=127)});for(let v=1;v<10;v++)d.dispatchEvent("voice",{part:v});break}}let b;switch(h){case x["?"]:case x.xg:{b=[1,0,65,0,5,0,0,0];break}case x.gm:case x.gs:case x.g2:case x.sd:{b=[40,4,40,18,40,32,32,0];break}case x["05rw"]:case x.x5d:case x.ns5r:{b=[44,1,44,19,44,0,44,0];break}case x.k11:case x.sg:{b=[24,0,0,0,0,0,0,0];break}case x.mt32:{b=[40,4,0,0,0,0,0,0];break}default:b=[0,0,0,0,0,0,0,0]}for(let v=0;v<4;v++)t(d,Y)[3*v]||(t(d,Y)[3*v+1]=b[2*v],t(d,Y)[3*v+2]=b[2*v+1],d.dispatchEvent(`efx${["reverb","chorus","delay","insert"][v]}`,d.getEffectType(v)));d.dispatchEvent("mode",e),d.forceVoiceRefresh()}}else throw new Error(`Unknown mode ${e}`)}newStrength(){t(this,oe).fill(0)}runJson(e){var r;if(e.type>14)return e.type==15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),t(this,qe)[e.type].call(this,e);{let d=this.chRedir(e.part,e.track),h=!1;(r=t(this,Qe)[d])==null||r.forEach(E=>{e.channel=E,h=!0,t(this,qe)[e.type].call(this,e)}),h||console.warn(`${St[e.type]?St[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${d+1} without any recipient.`)}t(this,j).length>100&&t(this,j).splice(100,t(this,j).length-99)}runRaw(e){}async loadBank(e,r){let d=this;switch(e=e.toLowerCase(),e){case"s7e":{d.userBank.clearRange({msb:63,lsb:[21,22]}),d.userBank.clearRange({msb:63,lsb:[24,27]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":{We.context=this,d.userBank.load(await We.read(e,r));break}}d.forceVoiceRefresh()}},D=new WeakMap,V=new WeakMap,ce=new WeakMap,he=new WeakMap,J=new WeakSet,fe=function(){return t(this,he)[t(this,V)]},At=function(e){t(this,he)[t(this,V)]=e},ue=new WeakMap,I=new WeakMap,M=new WeakMap,u=new WeakMap,pe=new WeakMap,A=new WeakMap,N=new WeakMap,W=new WeakMap,B=new WeakMap,_=new WeakMap,ge=new WeakMap,oe=new WeakMap,xe=new WeakMap,C=new WeakMap,T=new WeakMap,Le=new WeakMap,K=new WeakMap,le=new WeakMap,$e=new WeakMap,re=new WeakMap,He=new WeakMap,Ee=new WeakMap,Y=new WeakMap,Ne=new WeakMap,me=new WeakMap,Z=new WeakMap,P=new WeakMap,Ce=new WeakMap,Be=new WeakMap,Ge=new WeakMap,ve=new WeakMap,we=new WeakMap,ze=new WeakMap,Ie=new WeakMap,se=new WeakMap,L=new WeakMap,Qe=new WeakMap,it=new WeakMap,j=new WeakMap,be=new WeakMap,ke=new WeakMap,X=new WeakMap,Me=new WeakMap,G=new WeakMap,qe=new WeakMap,Ye=new WeakMap,Te=new WeakMap,Re=new WeakMap,ee=new WeakMap,te=new WeakMap,ye=new WeakMap,Oe=new WeakMap,De=new WeakMap,Ae=new WeakMap,Dt);export{Ma as OctaviaDevice,$ as allocated,y as ccToPos,ae as dnToPos};
