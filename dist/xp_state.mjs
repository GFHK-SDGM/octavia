var pa=Object.create;var Tt=Object.defineProperty;var ba=Object.getOwnPropertyDescriptor;var ga=Object.getOwnPropertyNames;var ya=Object.getPrototypeOf,Ea=Object.prototype.hasOwnProperty;var va=(b,e,r)=>e in b?Tt(b,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):b[e]=r;var Nt=(b,e)=>()=>(b&&(e=b(b=0)),e);var ma=(b,e)=>()=>(e||b((e={exports:{}}).exports,e),e.exports);var Ca=(b,e,r,f)=>{if(e&&typeof e=="object"||typeof e=="function")for(let u of ga(e))!Ea.call(b,u)&&u!==r&&Tt(b,u,{get:()=>e[u],enumerable:!(f=ba(e,u))||f.enumerable});return b};var ka=(b,e,r)=>(r=b!=null?pa(ya(b)):{},Ca(e||!b||!b.__esModule?Tt(r,"default",{value:b,enumerable:!0}):r,b));var M=(b,e,r)=>(va(b,typeof e!="symbol"?e+"":e,r),r),Bt=(b,e,r)=>{if(!e.has(b))throw TypeError("Cannot "+r)};var t=(b,e,r)=>(Bt(b,e,"read from private field"),r?r.call(b):e.get(b)),x=(b,e,r)=>{if(e.has(b))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(b):e.set(b,r)},S=(b,e,r,f)=>(Bt(b,e,"write to private field"),f?f.call(b,r):e.set(b,r),r),_t=(b,e,r,f)=>({set _(u){S(b,e,u,r)},get _(){return t(b,e,f)}});var Ht=Nt(()=>{"use strict";X();(function(){var b=function(k,$,a){var l,i;if(self.MessageEvent)switch(k){case"message":{i=new MessageEvent(k,{data:$,ports:a==null?void 0:a.ports}),Object.defineProperty(i,"source",{value:a==null?void 0:a.source});break}default:i=new Event(k)}else i=document.createEvent("Event"),i.initEvent(k,!1,!1),a&&k=="message"&&(i.data=$,a.source&&Object.defineProperty(i,"source",{value:a.source}),(l=a.ports)!=null&&l.length&&Object.defineProperty(i,"ports",{value:a.ports}));return i};self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),r=[],f={},u=function(k){var $,a=this;if((this==null?void 0:this.constructor)!=u)throw new TypeError("Illegal constructor");r.push(this),($=f[k])!=null&&$.constructor||(f[k]=[]),f[k].push(this);var l=Math.floor(Math.random()*281474976710656),i=[],s=0,n=[],c=!0,o=!1;Object.defineProperty(this,"id",{get:function(){return l}}),Object.defineProperty(this,"name",{value:k}),this.close=function(){var d,y=r.indexOf(a);y>-1?(e.postMessage({t:"d",c:k,i:l}),r.splice(y,1),(d=f[k])!=null&&d.constructor&&(y=f[k].indexOf(a),y>-1&&f[k].splice(y,1)),f[k].length||delete f[k],console.debug("[Snowy] BroadcastChannel closed."),o=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(d){if(e){if(o)throw new Error("Channel already closed");e.postMessage({t:"m",c:k,i:l,m:s,d}),s++,s>4294967295&&(s=0)}else n.push(d),console.debug("[Snowy] Message is cached.")},this.flush=function(){if(e){if(c){for(e.postMessage({t:"r",c:k,i:l}),console.debug("[Snowy] ".concat(n.length," message(s) in cache."));n.length;){var d=n.shift();a.postMessage(d)}c=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(d){d.c==k?d.i!=l&&a.dispatchEvent(b("message",d.d,{source:a})):console.debug("[Snowy] Channel ID mismatch. Instance ".concat(l," receives from ").concat(k,", not ").concat(d.c,"."))};var h={};this.dispatchEvent=function(d){var y,E;if(Object.defineProperty(d,"target",{value:a}),Object.defineProperty(d,"currentTarget",{value:a}),(y=h[d.type])!=null&&y.length)for(var T=h[d.type],D=0;D<T.length;D++)((E=T[D])==null?void 0:E.constructor)==Function&&T[D].call(a,d);a["on".concat(d.type)]&&a["on".concat(d.type)].constructor==Function&&a["on".concat(d.type)].call(a,d)},this.addEventListener=function(d,y){var E;(E=h[d])!=null&&E.constructor||(h[d]=[]);var T=h[d].indexOf(y);T==-1&&h[d].push(y)},this.removeEventListener=function(d,y){var E,T;if((E=h[d])!=null&&E.length){var D=h[d].indexOf(y);D>-1&&h[d].splice(D,1)}!((T=h[d])!=null&&T.length)&&h[d].constructor&&delete h[d]}},self.BroadcastChannel=u,p=function(){if(e){e.addEventListener("message",function($){var a=$.data,l=!1;switch(a.t){case"k":{l=!1,e.postMessage({t:"k"});break}case"m":{var i=f[a.c];if(i!=null&&i.length)for(var s=0;s<i.length;s++)i[s].receiveMessage(a);break}case"c":{for(var n=[],c=0;c<r.length;c++){var o=r[c].name;n.indexOf(o)<0&&n.push(o)}e.postMessage({t:"k",c:n});break}default:l=!0}l&&console.info("ReceiveBroadcast",a)});for(var k=0;k<r.length;k++)r[k].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},m=function(){if(!e){var k=new SharedWorker(self.SNOWY_PATH||"/snowy.js");k.port.start();var $=function(a){a.data.t=="swc"&&(k.port.removeEventListener("message",$),e=k.port,e.postMessage({t:"k"}),p())};k.port.addEventListener("message",$)}},m());var e,r,f,u,p,m})()});var X=Nt(()=>{"use strict";Ht();{let b=function(e,r){let f=new FileReader;return new Promise((u,p)=>{switch(f.addEventListener("abort",()=>{p(new Error("Blob read aborted"))}),f.addEventListener("error",m=>{p(f.error||m.data||new Error("Blob read error"))}),f.addEventListener("load",()=>{u(f.result)}),r.toLowerCase()){case"arraybuffer":case"buffer":{f.readAsArrayBuffer(e);break}case"string":case"text":{f.readAsText(e);break}default:p(new Error(`Unknown target ${r}`))}})};Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||function(){return b(this,"buffer")},Blob.prototype.text=Blob.prototype.text||function(){return b(this,"text")}}String.prototype.replaceAll=String.prototype.replaceAll||function(b,e){let r=0,f=16,u=this,p=[];for(;r<f&&u.lastIndexOf(b)>-1;){let m=u.lastIndexOf(b);p.unshift(u.slice(m+b.length)),u=u.slice(0,m),m==0&&p.unshift(""),r++}return u.length&&p.unshift(u),p.join(e)||""},String.prototype.padStart=String.prototype.padStart||function(b,e){if(e){let r=this;for(;r.length<b;)r=`${e}${r}`;return r}},String.prototype.padEnd=String.prototype.padEnd||function(b,e){if(e){let r=this;for(;r.length<b;)r+=e;return r}}});var sa=ma((gr,It)=>{X();(function(){"use strict";let b={fatal:!0},e=[new TextDecoder("iso-8859-15",b),new TextDecoder("utf-8",b),new TextDecoder("sjis",b),new TextDecoder("euc-jp",b),new TextDecoder("ascii")],r={debug:!1,parse:function(f,u){if(f instanceof Uint8Array)return r.Uint8(f);if(typeof f=="string")return r.Base64(f);if(f instanceof HTMLElement&&f.type==="file")return r.addListener(f,u);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(f,u){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(f===void 0||!(f instanceof HTMLElement)||f.tagName!=="INPUT"||f.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;u=u||function(){},f.addEventListener("change",function(p){if(!p.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let m=new FileReader;m.readAsArrayBuffer(p.target.files[0]),m.onload=function(k){u(r.Uint8(new Uint8Array(k.target.result)))}})},Base64:function(f){let u=function(k){var $="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(k=k.replace(/^.*?base64,/,""),k=String(k).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(k))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");k+="==".slice(2-(3&k.length));let a,l="",i,s,n=0;for(;n<k.length;)a=$.indexOf(k.charAt(n++))<<18|$.indexOf(k.charAt(n++))<<12|(i=$.indexOf(k.charAt(n++)))<<6|(s=$.indexOf(k.charAt(n++))),l+=i===64?String.fromCharCode(a>>16&255):s===64?String.fromCharCode(a>>16&255,a>>8&255):String.fromCharCode(a>>16&255,a>>8&255,255&a);return l}(f=String(f));var p=u.length;let m=new Uint8Array(new ArrayBuffer(p));for(let k=0;k<p;k++)m[k]=u.charCodeAt(k);return r.Uint8(m)},Uint8:function(m){let u={data:null,pointer:0,movePointer:function(i){return this.pointer+=i,this.pointer},readInt:function(i){if((i=Math.min(i,this.data.byteLength-this.pointer))<1)return-1;let s=0;if(1<i)for(let n=1;n<=i-1;n++)s+=this.data.getUint8(this.pointer)*Math.pow(256,i-n),this.pointer++;return s+=this.data.getUint8(this.pointer),this.pointer++,s},readStr:function(i){let s=new Uint8Array(i),n=!1,c;s.forEach((o,h)=>{s[h]=this.readInt(1)});for(let o=0;o<e.length;o++)if(!n)try{if(c=e[o].decode(s),o===0)for(let h=0;h<c.length;h++){let d=c.charCodeAt(h);if(d>191||d>127&&d<160)throw new RangeError(`Invalid code point: ${d}`)}n=!0,console.debug(`String byte sequence in ${e[o].encoding}`)}catch(h){console.debug(`SMF string ${h}`)}return c||"String byte sequence read failed."},backOne:function(){this.pointer--},readIntVLV:function(){let i=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)i=this.readInt(1);else{let n=[];for(;128<=this.data.getUint8(this.pointer);)n.push(this.readInt(1)-128);var s=this.readInt(1);for(let c=1;c<=n.length;c++)i+=n[n.length-c]*Math.pow(128,c);i+=s}return i}};if(u.data=new DataView(m.buffer,m.byteOffset,m.byteLength),u.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;u.readInt(4);let p={};p.formatType=u.readInt(2),p.tracks=u.readInt(2),p.track=[];var m=u.readInt(1),k=u.readInt(1);128<=m?(p.timeDivision=[],p.timeDivision[0]=m-128,p.timeDivision[1]=k):p.timeDivision=256*m+k;for(let i=1;i<=p.tracks;i++){p.track[i-1]={event:[]};var $,a=u.readInt(4);if(a===-1)break;if(a!==1297379947)return!1;u.readInt(4);let s=0,n=!1,c,o;for(;!n&&(s++,p.track[i-1].event[s-1]={},p.track[i-1].event[s-1].deltaTime=u.readIntVLV(),(c=u.readInt(1))!==-1);)if(128<=c?o=c:(c=o,u.movePointer(-1)),c===255){p.track[i-1].event[s-1].type=255,p.track[i-1].event[s-1].metaType=u.readInt(1);var l=u.readIntVLV();switch(p.track[i-1].event[s-1].metaType){case 47:case-1:n=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:p.track[i-1].event[s-1].data=u.readStr(l);break;case 33:case 89:case 81:p.track[i-1].event[s-1].data=u.readInt(l);break;case 84:p.track[i-1].event[s-1].data=[],p.track[i-1].event[s-1].data[0]=u.readInt(1),p.track[i-1].event[s-1].data[1]=u.readInt(1),p.track[i-1].event[s-1].data[2]=u.readInt(1),p.track[i-1].event[s-1].data[3]=u.readInt(1),p.track[i-1].event[s-1].data[4]=u.readInt(1);break;case 88:p.track[i-1].event[s-1].data=[],p.track[i-1].event[s-1].data[0]=u.readInt(1),p.track[i-1].event[s-1].data[1]=u.readInt(1),p.track[i-1].event[s-1].data[2]=u.readInt(1),p.track[i-1].event[s-1].data[3]=u.readInt(1);break;default:this.customInterpreter!==null&&(p.track[i-1].event[s-1].data=this.customInterpreter(p.track[i-1].event[s-1].metaType,u,l)),this.customInterpreter!==null&&p.track[i-1].event[s-1].data!==!1||(u.readInt(l),p.track[i-1].event[s-1].data=u.readInt(l),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch((c=c.toString(16).split(""))[1]||c.unshift("0"),p.track[i-1].event[s-1].type=parseInt(c[0],16),p.track[i-1].event[s-1].channel=parseInt(c[1],16),p.track[i-1].event[s-1].type){case 15:this.customInterpreter!==null&&(p.track[i-1].event[s-1].data=this.customInterpreter(p.track[i-1].event[s-1].type,u,!1)),this.customInterpreter!==null&&p.track[i-1].event[s-1].data!==!1||($=u.readIntVLV(),p.track[i-1].event[s-1].data=u.readInt($),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:p.track[i-1].event[s-1].data=[],p.track[i-1].event[s-1].data[0]=u.readInt(1),p.track[i-1].event[s-1].data[1]=u.readInt(1);break;case 12:case 13:p.track[i-1].event[s-1].data=u.readInt(1);break;case-1:n=!0;break;default:if(this.customInterpreter!==null&&(p.track[i-1].event[s-1].data=this.customInterpreter(p.track[i-1].event[s-1].metaType,u,!1)),this.customInterpreter===null||p.track[i-1].event[s-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return p},customInterpreter:null};if(typeof It<"u")It.exports=r;else{let f=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;f.MidiParser=r}})()});X();X();var Gt=function(b,e){let r=Math.min(b.length,e.length),f=b.slice(0,r),u=e.slice(0,r),p=0,m=0;for(;m<r&&p==0;)p=Math.sign(f[m]-u[m]),m++;return p},pe=function(b=""){this.name=b,this.pool=[],this.point=function(e,r=!1){if(this.pool.length>0){let f=this.pool.length,u=1<<Math.floor(Math.log2(f)),p=u,m=64;for(;u>=1&&m>=0;){if(m<=0)throw new Error("TTL reached.");if(p==f)p-=u;else{let $=Gt(e,this.pool[p]);switch($){case 0:{m=0;break}case 1:{p+u<=f&&(p+=u);break}case-1:{p!=0&&(p-=u);break}default:console.warn(`Unexpected result ${$}.`)}}u=u>>1,m--}let k=!0;if(p>=this.pool.length)k=!1;else{let $=this;this.pool[p].forEach(function(a,l,i){k&&a!=e[l]&&(k=!1)}),!k&&Gt(e,this.pool[p])>0&&p++}return k||r?p:-1}else return r?0:-1},this.add=function(e,r){return e.data=r,this.pool.splice(this.point(e,!0),0,e),this},this.default=function(e){console.warn(`No match in "${this.name||"(unknown)"}" for "${e}". Default action not defined.`)},this.get=function(e){let r=this.point(e);if(r>-1)return this.pool[r].data;this.default(e)},this.run=function(e,...r){let f=this.point(e);f>-1?e.subarray?this.pool[f].data(e.subarray(this.pool[f].length),...r):this.pool[f].data(e.slice(this.pool[f].length),...r):this.default(e,...r)}};X();var ne,Xt,Kt=(Xt=class{constructor(){x(this,ne,{})}addEventListener(b,e){t(this,ne)[b]||(t(this,ne)[b]=[]),t(this,ne)[b].unshift(e)}removeEventListener(b,e){if(t(this,ne)[b]){let r=t(this,ne)[b].indexOf(e);r>-1&&t(this,ne)[b].splice(r,1),t(this,ne)[b].length<1&&delete t(this,ne)[b]}}dispatchEvent(b,e){var u;let r=new Event(b),f=this;r.data=e,((u=t(this,ne)[b])==null?void 0:u.length)>0&&t(this,ne)[b].forEach(function(p){try{p==null||p.call(f,r)}catch(m){console.error(m)}}),this[`on${b}`]&&this[`on${b}`](r)}},ne=new WeakMap,Xt);X();var wa=["MSB","PRG","LSB","NME","ELC","DRM","LVL"],$a={krs:"KR",s90es:"ES",motif:"ES"},Sa={krs:"Kr",s90es:"SE",motif:"ME"},Mt=function(b){let e=Math.floor(b/10),r=b%10;return`${e.toString(16)}${r}`},ee,Vt,Pt=(Vt=class{constructor(...b){x(this,ee,void 0);M(this,"strictMode",!1);this.loadFiles(...b)}get bankInfo(){return t(this,ee)}get(b=0,e=0,r=0,f,u=0){var T,D;let p=[b,e,r],m,k=1,$=0,a,l,i=Array.from(arguments);switch(f){case"xg":{switch(b){case 0:{r===126?i[2]=125:r===127&&(i[2]=0);break}case 16:{r===126&&(i[2]=0);break}case 32:{r>125&&(i[2]=0),i[2]+=4;break}case 33:{(r>125||r===3)&&(i[2]=0),i[2]+=5;break}case 34:case 35:case 36:{r>125&&(i[2]=0),i[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:i[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{r===126&&(i[2]=0);break}case 48:case 64:case 126:case 127:{r===126&&(b===127&&e===0||(i[2]=0));break}}break}case"gs":case"sc":{b===0&&r<5?i[0]=49:b>125&&r<5&&r!==2&&(i[2]=b,i[0]=49);break}case"mt32":{b===0&&(i[0]=49);break}case"sd":{switch(b){case 121:{i[0]=96;break}case 120:{i[0]=104;break}}i[0]>>1===40?i[2]|=16:i[0]>95&&i[0]<100&&(i[2]|=16,e>>4===7&&(i[0]=96));break}case"g2":{b>>1===40?i[2]|=16:b>95&&b<100&&(i[2]|=16,e>>4===7&&(i[0]=96));break}case"sg":{b===8&&r===0&&(i[2]=5);break}case"05rw":case"x5d":{b&&b<56&&(i[0]=56);break}case"s90es":case"motif":case"an1x":case"cs1x":case"cs6x":{if(b===0)break;switch(b){case 63:{switch(f){case"s90es":{r<8?i[2]+=17:r<32?i[2]+=13:i[2]=(i[2]>>3)+19;break}case"motif":{r<8?i[2]+=28:r<32?i[2]+=13:i[2]=(i[2]>>3)+19;break}case"cs1x":{switch(r>>1){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:{i[2]+=34;break}case 32:{i[2]=34+((r&1)<<2);break}case 33:{i[2]=47+((r&1)<<2);break}case 61:{i[2]=34+((r&1)<<2);break}case 62:{i[2]=47+((r&1)<<2);break}}break}}break}case 32:{r>125&&(i[2]=0),i[2]+=4;break}case 33:{(r>125||r===3)&&(i[2]=0),i[2]+=5;break}case 34:case 35:case 36:{r>125&&(i[2]=0),i[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:i[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{r===126&&(i[2]=0);break}}break}}let s=" ",n="M",c="",o=0,h=0;switch(i[0]){case 0:{switch(i[2]){case 127:{n="GM-a";break}case 126:{n="GM-n";break}case 7:{n="GM-k",c="GLX";break}case 5:{n="SG-a",c="000";break}case 4:{f==="gs"||f==="sc"?(n="GM-a",c="000"):(n="SP-l",c="C/M");break}case 3:case 2:case 1:{(f==="gs"||f==="sc")&&(n="GM-a",c="000");break}case 0:{n="GM-a";break}default:n="y",o=3}break}case 8:{f==="sg"?n="GM-s":n="r:";break}case 32:case 33:case 34:case 35:case 36:{f==="xg"&&(n=`${["AP","VL","PF","DX","AN"][b&7]}-${"abcdefgh"[r]}`,o=3);break}case 48:{c=`M${(i[2]>>3).toString().padStart(2,"0")}`,n=`y${c}`,o=1;break}case 49:{i[2]>>1===63?(n=`MT-${"ba"[i[2]&1]}`,c=`C${"-/"[i[2]&1]}M`):(n="GM-a",c="000");break}case 56:{n="GM-b";break}case 57:n=["yDOC","QY10","QY20"][i[2]-112]||"yMxv",c=["DOC","QY1","QY2"][i[2]-112]||"057";case 61:case 120:{n="rDrm";break}case 62:{n="kDrm";break}case 63:{if(i[2]<17){let P=i[2];n=P<10?"kP:":"kC:",n+=P%10}else if(i[2]<34)n=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][i[2]-17];else if(i[2]<55){let P=i[2]-34;switch(P>12&&P--,r>>1){case 32:case 33:{n=`Pr${r-63}U`;break}case 61:case 62:{n=`Pr${r-121}U`;break}default:n=i[2]===46?"PrDr":`Pr${(P>>2)+1}${String.fromCharCode(65+(P&3))}`}}else n="Ds";o=1;break}case 64:{n="ySFX",c="SFX";break}case 67:{n="DX:S";break}case 80:case 81:case 82:case 83:{n=`Prg${"UABC"[i[0]-80]}`;break}case 88:case 89:case 90:case 91:{n=`Cmb${"UABC"[i[0]-88]}`;break}case 95:{n=`${["DR","PC"][i[2]]}-d`;break}case 96:{n=i[2]===106?"AP-a":i[2]>>4===1?"SDg":"PF",i[2]>63?h=63:i[2]>>4===1&&(h=16),o=3;break}case 97:{n=i[2]>>4===1?"SDa":"VL:",o=3,i[2]>>4===1?h=16:h=112;break}case 98:{n=i[2]>>4===1?"SDb":"SG-a",o=3,h=16;break}case 99:{n=i[2]>>4===1?"SDc":"DX",i[2]>63?h=63:i[2]>>4===1&&(h=16),o=3;break}case 100:{n="AN",i[2]>63?h=63:i[2]>>4===1&&(h=16),o=3;break}case 104:case 105:case 106:case 107:{n="SDd",h=104;break}case 121:{n=`GM-${i[2]?"":"a"}`,o=3;break}case 122:{n="lDrm";break}case 126:{n="yDrS";break}case 127:{i[2]===127?n="rDrm":n="yDrm";break}default:i[0]<48?n="r:":n="M"}n.length<4&&(n+=`${[b,r,i[0],i[2]][o]-h}`.padStart(4-n.length,"0")),c.length<3&&(c+=`${[b,r,b,r][o]}`.padStart(3-c.length,"0")),f==="xg"&&(b===0?i[2]<100?n=n.replace("y0","y:"):i[2]===125&&(n="y126"):b===16?(m=`Voice${((i[2]<<7)+i[1]+1).toString().padStart(3,"0")}`,s=" "):b===35&&r>>1===2&&(m=`DXCH_${(((i[2]&1)<<7)+e+1).toString().padStart(3,"0")}`,s=" "));let d=[i[0],i[1],i[2]];for(;!((m==null?void 0:m.length)>=0);)if(m=(T=t(this,ee)[i[1]||0][(i[0]<<8)+i[2]])==null?void 0:T.name,m){let P=t(this,ee)[i[1]||0][(i[0]<<8)+i[2]];k=(P==null?void 0:P.poly)||k,$=(P==null?void 0:P.type)||$,a=P==null?void 0:P.drum,l=P==null?void 0:P.level}else if(this.strictMode)m="",s="?";else if(i[0]===0&&i[1]===0&&i[2]===0)m="Unloaded";else if(t(this,ee)[i[1]||0][i[0]<<8])i[0]===0?(i[2]=0,s="^"):i[2]<1?(i[0]=0,s="*"):(i[2]--,s="^");else if(b===48)i[0]=0,i[2]=0,s="!";else if(b===62)i[1]--,s=" ",i[1]<1&&!(m!=null&&m.length)&&(i[0]=0,s="!");else if(b<63)i[0]===0?(i[2]=0,s="^"):i[2]<1?(i[0]=0,s="*"):i[2]--;else if(b===80)m=`PrgU:${e.toString().padStart(3,"0")}`,s="!";else if(b===88)m=`CmbU:${e.toString().padStart(3,"0")}`,s="!";else if(b===121)m=`GM2Vox0${r}`,s="#";else if(b===122)if(i[1]===32?i[1]:i[1]%=7,m=(D=t(this,ee)[i[1]||0][(i[0]<<8)+i[2]])==null?void 0:D.name,m){s=" ";let P=t(this,ee)[i[1]||0][(i[0]<<8)+i[2]];k=(P==null?void 0:P.poly)||k,$=(P==null?void 0:P.type)||$,a=P==null?void 0:P.drum,l=P==null?void 0:P.level}else m="",s="*";else i[1]===0?(m=`${b.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")} ${r.toString().padStart(3,"0")}`,s="!"):i[0]===0?(i[2]=0,s="^"):i[2]>0?i[2]--:i[1]>0?(i[1]=0,s="!"):(i[0]=0,s="?");let y=[i[0],i[1],i[2]];switch(s){case"^":{switch(f){case"gs":case"sc":case"ns5r":{s=" ";break}}b===127&&s==="^"&&(s=" ");break}}let E="??";switch(i[0]){case 0:{i[2]===0?E="GM":i[2]===5||i[2]===7?E="KG":i[2]<126&&(E="XG");break}case 32:case 33:case 35:case 36:{i[2]>4?E=["AP","VL","PF","DX","AN"][i[0]-32]:E="GS";break}case 48:{E="MU";break}case 49:{i[2]>>1===63?E="MT":i[2]<5&&(E="GM");break}case 56:{E="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{E="AI";break}case 62:case 82:case 90:{E="XD";break}case 63:{i[2]<17?E="KR":i[2]<34?E="ES":i[2]<55?E="CS":E="DS";break}case 64:case 126:{E="XG";break}case 67:case 99:{E=i[2]>>4===1?"SD":"DX";break}case 81:{E="RW";break}case 95:{E=["DR","PC"][i[2]];break}case 96:{E=i[2]===106?"AP":i[2]>>4===1?"SD":"PF";break}case 97:{E=i[2]>>4===1?"SD":"VL";break}case 98:{E=i[2]>>4===1?"SD":"SG";break}case 100:{E="AN";break}case 104:case 105:case 106:case 107:{E="SD";break}case 120:{E=e===0?"GM":"GS";break}case 121:{E=i[2]?"G2":"GM";break}case 122:{E="KG";break}case 127:{E=i[2]===127?"MT":e===0?"GM":"XG";break}default:i[0]<48&&(i[0]===16&&f==="xg"?E="XG":E="GS")}if(s!==" ")switch(f){case"krs":case"s90es":case"motif":{m="",E=$a[f];break}default:self.debugMode&&(m="")}return{name:m||`${Sa[f]||f.toUpperCase()}${Mt(b||0)}${Mt(e||0)}${Mt(r||0)}`,poly:k,type:$,drum:a,level:l,iid:d,eid:y,sid:p,ending:s,sect:n,bank:c,standard:E,mode:f}}async load(b,e,r="(internal)",f){let u=this,p=[],m=0,k=0,$=0;b.split(`
`).forEach(function(a,l){var n;let i=a.split("	"),s=[];if(l===0){if(i.forEach(function(c,o){p[wa.indexOf(c)]=o}),p.length<4){console.debug("Debugger launched.");debugger}}else{let c=0,o=0,h=0,d,y=1,E=0,T,D;i.forEach(function(Z,Je){switch(Je){case p[0]:{c=parseInt(Z);break}case p[1]:{o=parseInt(Z);break}case p[2]:{h=parseInt(Z);break}case p[3]:{d=Z;break}case p[4]:{Z=parseInt(Z),Z<16?y=Z+1:(E=(Z&15)+1,y=E);break}case p[5]:{D=Z;break}case p[6]:{Z!=null&&Z.constructor&&(T=parseInt(Z));break}}}),t(u,ee)[o]=t(u,ee)[o]||[];let P=t(u,ee)[o],Re={msb:c,prg:o,lsb:h,name:d,poly:y,type:E,drum:D,level:T,priority:f},Se=!1;f<((n=P[c<<8|h])==null?void 0:n.priority)&&(Se=!0,$++),(!P[c<<8|h]||Se||e)&&(P[c<<8|h]=Re,m++),k++}}),e||console.debug(`Map "${r}": ${k} total, ${m} loaded (${m-$} + ${$}).`)}clearRange(b){let e=b.prg!==void 0?b.prg.constructor===Array?b.prg:[b.prg,b.prg]:[0,127],r=b.msb!==void 0?b.msb.constructor===Array?b.msb:[b.msb,b.msb]:[0,127],f=b.lsb!==void 0?b.lsb.constructor===Array?b.lsb:[b.lsb,b.lsb]:[0,127];for(let u=r[0];u<=r[1];u++){let p=u<<8;for(let m=f[0];m<=f[1];m++){let k=p+m;for(let $=e[0];$<=e[1];$++)delete t(this,ee)[$][k]}}}init(){S(this,ee,[]);for(let b=0;b<128;b++)t(this,ee).push([""])}async loadFiles(...b){this.init();let e=this;b.forEach(async function(r,f){try{e.load(await(await fetch(`./data/bank/${r}.tsv`)).text(),!1,r,f)}catch(u){console.error(`Failed loading "${r}.tsv".`)}})}},ee=new WeakMap,Vt);X();X();var et,Ft,Yt=(Ft=class{constructor(){x(this,et,{});M(this,"context")}set(b,e){t(this,et)[b]=e}has(b){return!!t(this,et)[b]}async read(b,e){if(!this.has(b))throw new Error(`No decoder registered for "${b}"`);return await t(this,et)[b].call(this.context||this,e)}},et=new WeakMap,Ft);var xa=function(b,e){let r=!0;return e.forEach((f,u)=>{r=r&&b[u]===f}),r},dt=function(b){let e=0;return b.forEach(r=>{e*=256,e+=r}),e},me=new TextDecoder,ft=new Yt;ft.set("s7e",async function(b){let e=new Uint8Array(await b.slice(0,65536).arrayBuffer()),r="MSB	LSB	PRG	NME",f=[0,0,0,0],u=32,p=0,m=0,k=!0,$=[],a=0;for(;k;){let l=e.subarray(p);([()=>{me.decode(l.subarray(0,4))==="YSFC"?(p+=80,m=1):p++},()=>{if(xa(l.subarray(0,4),f))$.forEach((i,s,n)=>{let c=dt(e.subarray(i.start+4,i.start+8));i.length=c}),m=2;else{let i=me.decode(l.subarray(0,4)),s=dt(l.subarray(4,8));$.push({type:i,start:s}),p+=8}},()=>{let i=$[a],s=e.subarray(i.start,i.start+i.length),n=32;switch(i.type){case"ENVC":{let c=u;for(;c<s.length;){let o=s.subarray(c,c+n),h=me.decode(o.subarray(0,10)).trimEnd();h.slice(0,5)==="Init "&&(h=""),h&&(r+=`
063	${(o[17]+13).toString().padStart(3,"0")}	${o[19].toString().padStart(3,"0")}	${h}`),c+=n}break}case"EDVC":{let c=u;for(;c<s.length;){let o=s.subarray(c,c+n),h=me.decode(o.subarray(0,10)).trimEnd();h.slice(0,5)==="Init "&&(h=""),h&&(r+=`
063	024	${o[19].toString().padStart(3,"0")}	${h}`),c+=n}break}case"EPVC":{let c=32,o=u;for(;o<s.length;){let h=s.subarray(o,o+c),d=me.decode(h.subarray(0,10)).trimEnd();d==="----------"&&(d=""),d&&(r+=`
063	${(h[17]+1).toString().padStart(3,"0")}	${h[19].toString().padStart(3,"0")}	${d}`),o+=c}break}}a++,a>=$.length&&(m=3,k=!1)}][m]||(()=>{k=!1}))()}return r});ft.set("pcg",async function(b){let e=new Uint8Array(await b.arrayBuffer()),r="MSB	LSB	PRG	NME",f=100,u=0,p=0,m=!0,k=[],$=0;for(;m;){let a=e.subarray(f);([()=>{m=me.decode(a.subarray(0,4))==="INI2",p=a[15],f+=16,u=1},()=>{let l=me.decode(a.subarray(0,4)),i=a[5],s=a[7],n=a[11],c=dt(a.subarray(12,16)),o=dt(a.subarray(16,20)),h=dt(a.subarray(36,40)),d=me.decode(a.subarray(44,44+n));k.push({type:l,tipMsb:i,tipLsb:s,nameLen:n,length:c,start:o,entryLen:h,name:d}),f+=64,p--,p<1&&(u=2)},()=>{let l=k[$],i=e.subarray(l.start,l.start+l.length);switch(l.type){case"PRG1":break;case"PBK1":{let s=63,n=(l.tipMsb?6:0)+l.tipLsb;for(let c=0;c<128;c++){let o=c*l.entryLen,h=i.subarray(o,o+l.entryLen),d=me.decode(h.subarray(0,24)).trimEnd().replace("InitProg","");d.length&&n>5&&(r+=`
${s.toString().padStart(3,"0")}	${n.toString().padStart(3,"0")}	${c.toString().padStart(3,"0")}	${d}`)}break}case"CBK1":{let s=63,n=(l.tipMsb?3:0)+l.tipLsb+10;for(let c=0;c<128;c++){let o=c*l.entryLen,h=i.subarray(o,o+l.entryLen),d=me.decode(h.subarray(0,24)).trimEnd().replace("InitCombi","");d.length&&n>12&&(r+=`
${s.toString().padStart(3,"0")}	${n.toString().padStart(3,"0")}	${c.toString().padStart(3,"0")}	${d}`)}break}}$++,$>=k.length&&(u=3,m=!1)}][u]||(()=>{m=!1}))()}return r});X();var ht=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),ut=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],Ta=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],tt=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],zt=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],Wt=function(b){let e=.1,r=-.3;return b>66?(e=5,r=315):b>56?(e=1,r=47):b>46&&(e=.5,r=18.5),e*b-r},qt=function(b){return b>105?Ta[b-106]:b>100?b*1.1-100:b/10},Qt=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),Rt={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,ㇺ
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,ゐ
we,ゑ
wo,を
nga,か゚
ngi,き゚
ngu,く゚
nge,け゚
ngo,こ゚
ngy,き゚!
ng,ン
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,𛀁
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(b=>{let e=b.split(",");Rt[e[0]]=e[1]});var jt=function(b){let e=b;b[0]=="*"&&(e=e.slice(1)),["aa","ii","uu","ee","oo"].forEach(f=>{for(;e.indexOf(f)>-1;)e=e.replace(f,f[0])});for(let f in Rt)e=e.replaceAll(f,Rt[f]);e.indexOf("ん")==0&&e.length>1&&(e=e.slice(1));let r=e.indexOf("!");return r>-1&&e.length>1&&(e=e.slice(r+1)),e},Zt=function(b){return b?b<96?`cc${b}`:["aftertouch","velocity","pitch bend"][b-96]:"off"},Jt={u8:["utf-8","Unicode"],l1:["l9","Pan-Latin"],jp:["sjis","Japanese"],kr:["iso-2022-kr","Korean"],hz:["gb18030","Simplified Chinese"],b5:["big5","Traditional Chinese"],cy:["koi8-ru","Cyrillic"],vn:["tcvn-5773-1993","Vietnamese"]},ea={m:"Male",f:"Female",c:"Chorus",s:"Solo",p:"Plural",w:"Words",x:"Non-vocal"};X();var At=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],ta=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],aa=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var Ma={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},Pa={66307:["drive"],66309:["vowel",b=>"aiueo"[b]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",b=>["off","LPF","HPF"][b]],94984:["noise type",b=>["white","pink"][b]],94987:["disc type",b=>["LP","SP","EP","RND"]],94990:["hum type",b=>`${b+5}0Hz`],94993:["M/S",b=>["mono","stereo"][b]]},Ot=function(b){return Ma[(b[0]-32<<8)+b[1]]||`0x${b[0].toString(16).padStart(2,"0")}${b[1].toString(16).padStart(2,"0")}`},ra=function(b,e,r){let f=(b[0]-32<<16)+(b[1]<<8)+e,u=Pa[f]||{},p=u[0];if(p!=null&&p.length)return p+=`: ${(u[1]||function(){})(r)||r}`,p},Dt=[68,48,95,78,41,3,110,122,0];X();var ce=function(b=64){return Math.round(2e3*Math.log10(b/64))/100};var Ue=function(b){let e=0;return b.forEach(r=>{e+=r,e=e&127}),~e+1&127},be=function(b,e){let r=0,f=0;for(let u=0;u<b.length;u++){let p=u%8-1,m=(f>>p&1)<<7,k=b[u];k+=m,u%8!==0?(e(k,r,b),r++):f=b[u]}};var pt=function(b){let e=Math.floor(b*14.2);return e<128?e:0},O=function(){var b;return self.Bun?!0:(b=self.debugMode)!=null?b:!1};var ur="♭𝄫,𝄫,♭,,♯,𝄪,𝄪♯".split(",");var Rr=ka(sa(),1);var z=["?","gm","gs","sc","xg","g2","mt32","doc","qy10","qy20","ns5r","x5d","05rw","k11","sg","sd","pa","krs","s90es","motif","cs6x","trin","an1x","cs1x"],Ra={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es",trinity:"trin","tr-rack":"trin"},Aa=["melodic","drum","menu"],ia={"?":[0,0,120,0,0],gm:[0,0,120,0,0],gs:[0,0,120,0,0],sc:[0,0,120,0,0],xg:[0,0,127,0,0],g2:[0,0,120,0,0],mt32:[0,127,127,0,127],doc:[57,112,127,57,112],qy10:[57,113,127,57,113],qy20:[57,114,127,57,114],ns5r:[0,0,61,0,0],x5d:[82,0,62,56,0],"05rw":[81,0,62,56,0],k11:[0,0,122,0,0],sg:[0,0,122,0,0],sd:[97,0,105,0,0],krs:[121,0,120,0,0],s90es:[0,0,127,0,0],motif:[0,0,127,0,0],cs6x:[0,0,127,0,0],trin:[0,0,61,0,0],an1x:[36,3,127,0,0],cs1x:[0,0,127,63,0]},Oa=[9,25,41,57,73,89,105,121],Da=[0,3,81,84,88],na={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},mt={0:0,1:1,2:3,5:4},ca={0:0,1:1,2:2,5:3},oa=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],Ut=[36,37,48,49,52,53],xt=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],la={26:127,29:0,30:0,31:0,52:12,53:54},Ne=[0,1,2,4,5,6,7,8,10,11,12,13,14,15,16,17,18,19,20,21,22,26,28,32,38,40,41,42,43,44,45,46,47,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,80,81,82,83,84,91,92,93,94,95,98,99,100,101,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],Ia=[2,4,12,13,14,15,16,17,18,19,20,21,40,41,42,43,44,45,46,47,80,81,83,136,130,131,132,133,134,135,137,138,139,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],La=[33,102,99,32,100,8,9,10],da=[0,16,25,40,32,64,24,48],w={};z.forEach((b,e)=>{w[b]=e});var C=[];Ne.forEach((b,e)=>{C[b]=e});var ge={length:xt.length};xt.forEach((b,e)=>{ge[b]=e});var Ua={};Aa.forEach((b,e)=>{Ua[b]=e});var Na=function(b){let e=[],r=0;return b==null||b.forEach(function(f,u){f===247?e.push(b.subarray(r,u)):f===240&&(r=u+1)}),e.length||e.push(b.subarray(0)),O()&&console.debug(e),e};var Lt=8,g={port:Lt,ch:Lt<<4,chShift:Math.ceil(Math.log2(Lt))+4,cc:Ne.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,nrpn:Ut.length,ace:8,drm:8,dpn:xt.length,dnc:128,ext:3,efx:7,cvn:12,redir:32,vxPrim:3,invalidCh:255};g.chcc=g.cc*g.ch;var bt={bank0:128},Ba=new TextDecoder("l9"),N=new Uint16Array(g.ch),at=new Uint16Array(g.ch),_a=new Uint16Array(g.ch),Ct=new Uint16Array(g.ch),Ha=new Uint16Array(g.ch),kt=new Uint16Array(g.ch),fa=new Array(g.drm);for(let b=0;b<g.ch;b++)N[b]=b*g.cc,at[b]=b*g.rpn,_a[b]=b*g.nrpn,Ct[b]=b*g.ace,Ha[b]=b*g.ext,kt[b]=b*g.cvn;for(let b=0;b<g.drm;b++){fa[b]=new Uint16Array(g.dpn);let e=b*g.dpn*g.dnc;for(let r=0;r<g.dpn;r++)fa[b][r]=e+r*g.dnc}var _,te,ye,Te,fe,xe,ua,oe,B,R,v,J,I,q,ae,F,G,Me,Ce,Be,re,A,L,rt,ie,Ee,le,st,_e,W,it,He,he,Ge,Ae,ve,nt,Oe,Y,U,ke,gt,K,Xe,ct,Ke,Ve,wt,Fe,De,Ie,yt,ot,we,H,$t,Et,V,lt,Ye,de,Pe,Le,se,ze,Q,vt,St,We,qe,j,ue,$e,Qe,je,Ze,ha,Or=(ha=class extends Kt{constructor(){super();x(this,fe);M(this,"NOTE_IDLE",0);M(this,"NOTE_ATTACK",1);M(this,"NOTE_DECAY",2);M(this,"NOTE_SUSTAIN",3);M(this,"NOTE_HELD",4);M(this,"NOTE_RELEASE",5);M(this,"NOTE_SOSTENUTO_ATTACK",8);M(this,"NOTE_SOSTENUTO_DECAY",9);M(this,"NOTE_SOSTENUTO_SUSTAIN",10);M(this,"NOTE_SOSTENUTO_HELD",11);M(this,"NOTE_MUTED_RECOVERABLE",16);M(this,"CH_MELODIC",0);M(this,"CH_DRUMS",1);M(this,"CH_DRUM1",2);M(this,"CH_DRUM2",3);M(this,"CH_DRUM3",4);M(this,"CH_DRUM4",5);M(this,"CH_DRUM5",6);M(this,"CH_DRUM6",7);M(this,"CH_DRUM7",8);M(this,"CH_DRUM8",9);M(this,"DUMP_ALL",0);M(this,"DUMP_ONCE",1);M(this,"DUMP_MODE",2);M(this,"EXT_NONE",0);M(this,"EXT_VL",1);M(this,"EXT_DX",3);M(this,"VLBC_SYSTEM",0);M(this,"VLBC_BRTHEXPR",1);M(this,"VLBC_VELOINIT",2);M(this,"VLBC_VELOALL",3);M(this,"CH_INACTIVE",0);M(this,"CH_ACTIVE",1);M(this,"CH_DISABLED",2);M(this,"KARAOKE_NONE",0);M(this,"KARAOKE_TEXT",1);M(this,"KARAOKE_XF",2);x(this,_,0);x(this,te,0);x(this,ye,0);x(this,Te,new Array(11));x(this,oe,new Uint8Array(g.ch));x(this,B,new Uint8Array(g.ch));x(this,R,new Uint8Array(g.ch));x(this,v,new Uint8Array(g.chcc<<1));x(this,J,new Uint8Array(g.ch*g.ace));x(this,I,new Uint8Array(g.ch*g.vxPrim));x(this,q,new Uint8Array(g.ch*g.nn));x(this,ae,new Uint8Array(g.ch));x(this,F,new Uint16Array(g.pl));x(this,G,new Uint8Array(g.pl));x(this,Me,new Int16Array(g.ch));x(this,Ce,new Uint8Array(g.ch));x(this,Be,new Uint8Array(g.ch));x(this,re,new Uint8Array(g.ch*g.ext));x(this,A,new Uint8Array(g.ch*g.rpn));x(this,L,new Uint8Array(g.ch*g.rpnt));x(this,rt,new Int8Array(g.ch*Ut.length));x(this,ie,new Uint8Array(g.drm*g.dpn*g.dnc));x(this,Ee,new Uint8Array(g.drm*2));x(this,le,new Uint8Array(g.efx*3));x(this,st,new Uint8Array(g.ch));x(this,_e,new Uint8Array(g.ch*g.redir));x(this,W,new Uint8Array(g.port));x(this,it,new Uint8Array(g.port));x(this,He,new Uint8Array(g.ch));x(this,he,new Uint8Array(g.ch));x(this,Ge,new Uint8Array(g.ch*g.cvn));x(this,Ae,new Uint8Array(128));x(this,ve,new Uint8Array(g.cmt*8));x(this,nt,new Uint8Array(1024));x(this,Oe,new Uint8Array(g.cmt*64));x(this,Y,{});M(this,"modelEx",{sc:{showBar:!0,invBar:!1,invDisp:!1,peakHold:1},cs1x:{perfCh:0}});x(this,U,void 0);x(this,ke,void 0);x(this,gt,void 0);x(this,K,100);x(this,Xe,0);x(this,ct,500);x(this,Ke,0);x(this,Ve,0);x(this,wt,32);x(this,Fe,!1);x(this,De,"");x(this,Ie,0);x(this,yt,0);x(this,ot,0);x(this,we,!0);x(this,H,0);x(this,$t,1);x(this,Et,void 0);x(this,V,!1);x(this,lt,0);x(this,Ye,new Array(g.ch));x(this,de,[]);x(this,Pe,new Uint8Array(g.ch));x(this,Le,new Uint8Array(g.tr));M(this,"baseBank",new Pt("gm2","ns5r","xg","gs","sd","gmega","plg-vl","plg-pf","plg-dx","plg-an","plg-dr","plg-sg","kross","s90es","cs2x"));M(this,"userBank",new Pt("gm2"));M(this,"initOnReset",!1);M(this,"aiEfxName","");M(this,"polyIndexShrink",!0);M(this,"polyIndexLatest",0);M(this,"polyIndexLast",0);x(this,se,[]);x(this,ze,void 0);x(this,Q,{nOff:(e,r)=>{let f=e*128+r,u=t(this,F).lastIndexOf(f);if(u>-1)if(this.getChCc(e,64)>>6)t(this,G)[u]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:r,velo:t(this,q)[f],state:this.NOTE_HELD});else if(this.getChCc(e,66)>>6&&t(this,G)[u]===this.NOTE_SOSTENUTO_SUSTAIN)t(this,G)[u]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:r,velo:t(this,q)[f],state:this.NOTE_SOSTENUTO_HELD});else{t(this,F)[u]=0,t(this,q)[f]=0,t(this,G)[u]=this.NOTE_IDLE;let p=this.getExt(e)[1];(p===this.VLBC_VELOINIT||p===this.VLBC_VELOALL)&&this.setChCc(e,129,0),this.dispatchEvent("note",{part:e,note:r,velo:0,state:this.NOTE_IDLE})}if(t(this,ae)[e]){for(let p=this.polyIndexLast;p>=0;p--)if(t(this,F)[p]>>7===e&&t(this,G)[p]!==0){t(this,G)[p]===this.NOTE_MUTED_RECOVERABLE&&(t(this,G)[p]=this.NOTE_SUSTAIN);break}}this.polyIndexShrink&&this.polyIndexLast>0&&t(this,G)[this.polyIndexLast]===0&&this.polyIndexLast--},nOn:(e,r,f)=>{let u=e*128+r,p=0;if(t(this,ae)[e])for(let m=0;m<=this.polyIndexLast;m++)t(this,F)[m]>>7===e&&t(this,G)[m]!==0&&(t(this,G)[m]=this.NOTE_MUTED_RECOVERABLE);for(;t(this,G)[p]>0&&t(this,F)[p]!==u;)p++;if(p<g.pl){t(this,F)[p]=u,t(this,q)[u]=f,t(this,G)[p]=this.NOTE_SUSTAIN,t(this,Ce)[e]<f&&(t(this,Ce)[e]=f);let m=this.getExt(e)[1];(m===this.VLBC_VELOINIT||m===this.VLBC_VELOALL)&&this.setChCc(e,129,f),this.dispatchEvent("note",{part:e,note:r,velo:f,state:this.NOTE_SUSTAIN}),this.polyIndexLatest=p+1,p>this.polyIndexLast&&(this.polyIndexLast=p)}else console.error("Polyphony exceeded.")},nAt:(e,r,f)=>{},cAt:(e,r)=>{},hoOf:e=>{t(this,G).forEach((r,f)=>{if(r===this.NOTE_HELD){let u=t(this,F)[f],p=u>>7;e===p&&(t(this,G)[f]=this.NOTE_IDLE,t(this,F)[f]=0,t(this,q)[u]=0,this.dispatchEvent("note",{part:e,note:u&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{t(this,G).forEach((r,f)=>{let u;switch(r){case this.NOTE_ATTACK:{u=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{u=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{u=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(u){t(this,G)[f]=u;let p=t(this,F)[f];this.dispatchEvent("note",{part:e,note:p&127,velo:t(this,q)[p],state:u})}})},soOf:e=>{t(this,G).forEach((r,f)=>{if(r===this.NOTE_SOSTENUTO_HELD){let u=t(this,F)[f],p=u>>7;e===p&&(t(this,G)[f]=this.NOTE_IDLE,t(this,F)[f]=0,t(this,q)[u]=0,this.dispatchEvent("note",{part:e,note:u&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{t(this,F).forEach(r=>{let f=r>>7,u=r&127;r===0&&t(this,q)[0]===0||f===e&&t(this,Q).nOff(f,u)})}});x(this,vt,{8:function(e){let r=e.channel,f=e.data[0];t(this,Q).nOff(r,f)},9:function(e){let r=e.channel,f=this;if(f.getChModeId(r)===w.xg&&t(f,R)[r]>1){let m=f.getChDrumFirstWrite(r);m[0]&&m[1]!==g.invalidCh&&!t(f,oe)[r]&&(f.copyChSetup(m[1],r),f.dispatchEvent("voice",{part:r}),console.debug(`Part CH${r+1} copied from CH${m[1]+1}.`))}f.setChActive(r,1);let u=e.data[0],p=e.data[1];p>0?t(f,Q).nOn(r,u,p):t(f,Q).nOff(r,u)},10:function(e){let r=e.channel,f=r*128+e.data[0];t(this,F).indexOf(f)>-1&&(t(this,q)[f]=data[1],this.getExt(r)[1]===this.VLBC_VELOALL&&this.setChCc(r,129,data[1]),this.dispatchEvent("note",{part:r,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let r=e.channel,f=this,u=t(f,Ye)[r],p=u[e.data[0]];p&&(e.data[0]=p),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(t(this,_)){case w.s90es:case w.motif:{if(e.data[0]===0){[0,63].indexOf(e.data[1])>-1&&f.setChActive(r,1);break}e.data[1]&&f.setChActive(r,1);break}default:break}})();let m=r*g.ext,k=f.getChModeId(r);switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{t(this,Q).ano(r),t(this,Me)[r]=0,f.resetChCc(r,1,0),f.resetChCc(r,5,0),f.resetChCc(r,64,0),f.resetChCc(r,65,0),f.resetChCc(r,66,0),f.resetChCc(r,67,0),f.resetChCc(r,11,127),f.resetChCc(r,101,127),f.resetChCc(r,100,127),f.resetChCc(r,99,127),f.resetChCc(r,98,127);return}case 123:{t(this,Q).ano(r);return}case 124:{t(this,Q).ano(r);return}case 125:{t(this,Q).ano(r);return}case 126:{t(this,ae)[r]=1,t(this,Q).ano(r);return}case 127:{t(this,ae)[r]=0,t(this,Q).ano(r);return}}if(C[e.data[0]]===void 0)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(Ia.indexOf(e.data[0])>-1&&this.allocateAce(r,e.data[0]),e.data[0]){case 0:{switch(O()&&console.debug(`${z[t(this,_)]}, CH${r+1}: ${e.data[1]}`),t(this,_)===0?e.data[1]<48?(t(this,R)[r]>0&&(e.data[1]=this.getChPrimitive(r,1,!1),e.data[1]=120,console.debug(`Forced channel ${r+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]===56?this.switchMode(t(this,U).x5===82?"x5d":"05rw"):e.data[1]===62?this.switchMode(t(this,U).x5===82?"x5d":"05rw"):e.data[1]===63?this.switchMode(z[t(this,U).ds]):(e.data[1]===64||e.data[1]===127)&&this.switchMode("xg"):t(this,_)===w.gs||t(this,_)===w.sc?e.data[1]<56&&t(this,R)[r]>0&&(e.data[1]=this.getChPrimitive(r,1,!1),e.data[1]=120,console.debug(`Forced channel ${r+1} to stay drums.`)):t(this,_)===w.gm&&(e.data[1]<48?t(this,R)[r]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${r+1} to stay drums.`)):(e.data[1]===64||e.data[1]===127)&&this.switchMode("xg",!0)),t(this,_)){case w.xg:{[79,95,126,127].indexOf(e.data[1])>-1?t(this,R)[r]===0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):t(this,R)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?t(this,re)[m]=this.EXT_VL:[35,67,83,99].indexOf(e.data[1])>-1?t(this,re)[m]=this.EXT_DX:t(this,re)[m]=this.EXT_NONE;break}case w["05rw"]:case w.x5d:case w.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?t(this,R)[r]===this.CH_MELODIC&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):[80,81,82,83].indexOf(e.data[1])>-1||t(this,R)[r]!==this.CH_MELODIC&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case w.sd:{[104,105,106,107].indexOf(e.data[1])>-1?t(this,R)[r]===0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):t(this,R)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case w.g2:{e.data[1]===120?t(this,R)[r]===0&&(this.setChType(r,this.CH_DRUMS),console.debug(`CH${r+1} set to drums by MSB.`)):t(this,R)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}}break}case 2:{this.getExt(r)[1]===this.VLBC_BRTHEXPR&&this.setChCc(r,129,e.data[1]);break}case 6:{if(t(this,Be)[r]){[w.xg,w.gs,w.sc,w.ns5r].indexOf(t(this,_))<0&&console.warn(`NRPN commits are not available under "${z[t(this,_)]}" mode, even when they are supported in Octavia.`);let $=this.getChCc(r,99),a=this.getChCc(r,98);if($===1){let l=La.indexOf(a);if(l>-1)this.setChCc(r,71+l,e.data[1]),O()&&console.debug(`Redirected NRPN 1 ${a} to cc${71+l}.`),this.dispatchEvent("cc",{part:r,cc:71+l,data:e.data[1]});else{let i=Ut.indexOf(a);i>-1?t(this,rt)[r*10+i]=e.data[1]-64:console.warn(`NRPN 0x01${a.toString(16).padStart(2,"0")} is not supported.`),O()&&console.debug(`CH${r+1} voice NRPN ${a} commit`)}}else{if(xt.indexOf($)<0){let i=`NRPN 0x${$.toString(16).padStart(2,"0")}${a.toString(16).padStart(2,"0")} `;console.warn($===127?`${i}is not necessary. Consider removing it.`:`${i}is not supported.`)}else{let i=t(this,R)[r]-2;i<0?console.warn(`CH${r+1} cannot accept drum NRPN as type ${ut[t(this,R)[r]]}.`):t(this,ie)[(i*g.dpn+ge[$])*g.dnc+a]=e.data[1]}O()&&console.debug(`CH${r+1} (${ut[t(this,R)[r]]}) drum NRPN ${$} commit`)}}else{let $=mt[this.getChCc(r,100)],a=ca[this.getChCc(r,100)];if(this.getChCc(r,101)===0&&$!==void 0)switch(O()&&console.debug(`CH${r+1} RPN 0 ${this.getChCc(r,100)} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],oa[$][0]),oa[$][1]),t(this,A)[r*g.rpn+$]=e.data[1],t(this,L)[r*g.rpnt+a]=1,k){case w.xg:case w.gs:case w.sc:case w.mt32:case w.s90es:case w.motif:case w.cs1x:case w.cs6x:{switch(this.getChCc(r,100)){case 1:case 2:{this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)});break}}break}default:this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)})}}break}case 32:{switch(O()&&console.debug(`${z[t(this,_)]}, CH${r+1} LSB: ${e.data[1]}`),t(this,_)){case w.s90es:case w.motif:{this.setChType(r,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,t(this,_),!0);break}}this.getExt(r)[0],this.EXT_DX;break}case 38:{if(!t(this,Be)[r]){let $=mt[this.getChCc(r,100)],a=ca[this.getChCc(r,100)];this.getChCc(r,101)===0&&$!==void 0&&(t(this,A)[r*g.rpn+$+1]=e.data[1],t(this,L)[r*g.rpnt+a]=1)}break}case 64:{e.data[1]<64&&t(this,Q).hoOf(r);break}case 66:{e.data[1]>>6?t(this,Q).soOn(r):t(this,Q).soOf(r);break}case 98:case 99:{t(this,Be)[r]=1;break}case 100:case 101:{t(this,Be)[r]=0;break}}this.setChCc(r,e.data[0],e.data[1]),this.dispatchEvent("cc",{part:r,cc:e.data[0],data:e.data[1]})}f.getChModeId(r)===w.xg&&t(f,R)[r]&&f.setDrumFirstWrite(r)},12:function(e){let r=e.channel,f=this;switch(t(f,_)){case w.s90es:case w.motif:{e.data&&f.setChActive(r,1);break}default:f.setChActive(r,1)}let u=N[r];switch(f.getExt(r)[0]){case f.EXT_VL:break}t(f,I)[r]=e.data,t(f,he)[r]=0,f.pushChPrimitives(r),O()&&console.debug(`T:${e.track} C:${r} P:${e.data}`),f.dispatchEvent("voice",{part:r}),f.getChModeId(r)===w.xg&&t(f,R)[r]&&f.setDrumFirstWrite(r)},13:function(e){let r=this,f=e.channel;t(this,F).forEach(function(u){let p=u>>7;f===p&&(t(r,q)[u]=e.data,r.dispatchEvent("note",{part:f,note:u&127,velo:e.data,state:r.NOTE_SUSTAIN}))})},14:function(e){let r=e.channel;t(this,Me)[r]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)})},15:function(e){Na(e.data).forEach(r=>{let f=r[0],u=r[1];S(this,lt,r.length),(t(this,St)[f]||function(){console.debug(`Unknown manufacturer ${f}.`)})(u,r.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(t(this,se)[e.meta]||function(f,u,p){}).call(this,e.data,e.track,e.meta),e.meta!==32&&S(this,Xe,0);let r=Da.indexOf(e.meta)>-1;if(O()&&console.debug(e),r)return e.reply="meta",e}});x(this,St,{64:(e,r,f)=>{t(this,Qe).run(r,f,e)},65:(e,r,f)=>{if(r[0]<16)if(r[1]===72){let u=r[r.length-1],p=Ue(r.subarray(3,r.length-1));u===p?t(this,ue).run(r.subarray(0,r.length-1),f,e):console.warn(`Bad SD checksum ${u} - should be ${p}.`)}else t(this,ue).run(r,f,e);else{let u=r[r.length-1],p=Ue(r.subarray(2,r.length-1));u===p?t(this,ue).run(r.subarray(0,r.length-1),f,e):console.warn(`Bad GS checksum ${u} - should be ${p}.`)}},66:(e,r,f)=>{t(this,$e).run(r,f,e)},67:(e,r,f)=>{switch(e>>4){case 0:{let u=0;for(;r[u]===127&&u<4;)u++;let p=r[1+u]<<7|r[2+u];if(p+7+u!==r.length){console.warn(`Yamaha bulk dump length mismatch! Expected ${r.length-7-u}, received ${p}.`),console.debug(r);break}let m=Ue(r.subarray(1+u,r.length-1)),k=r[r.length-1];if(r[r.length-1]>>7)console.warn(`Yamaha bulk dump checksum invalid! Expected ${m}, received ${k}:
`),console.debug(r);else if(m!==k)console.warn(`Yamaha bulk dump checksum mismatch! Expected ${m}, received ${k}:
`),console.debug(r);else{let $=r.slice(2,r.length-1);for(let a=0;a<=u;a++)$[a]=r[a];t(this,j).run($,f,e&15)}break}case 1:{t(this,j).run(r,f,e&15);break}case 2:{console.warn("Octavia doesn't yet support Yamaha bulk dump requests.");break}case 3:{console.warn("Octavia doesn't yet support Yamaha parameter requests.");break}case 7:{switch(e&15){case 14:{let u=new Uint8Array(r.length+1);u[0]=126,u.set(r,1),t(this,j).run(u,f,0);break}default:console.warn(`Unknown Yamaha special SysEx type: ${e}.`)}break}default:console.warn(`Unknown Yamaha SysEx type: ${e>>4}.`)}},68:(e,r,f)=>{t(this,Ze).run(r,f,e)},71:(e,r,f)=>{t(this,je).run(r,f,e)},126:(e,r,f)=>{t(this,We).run(r,f,e)},127:(e,r,f)=>{this.switchMode("gm"),t(this,qe).run(r,f,e)}});x(this,We,void 0);x(this,qe,void 0);x(this,j,void 0);x(this,ue,void 0);x(this,$e,void 0);x(this,Qe,void 0);x(this,je,void 0);x(this,Ze,void 0);let e=this;S(e,fe,new Uint8Array(256),ua),t(e,Te)[10]=new Uint8Array(512),S(e,ze,new pe),S(e,U,{x5:82,ds:w.krs,smotif:w.s90es,gs:4,sc:3}),S(e,ke,{dumpLimit:e.DUMP_MODE}),S(e,gt,new Proxy(t(e,ke),{set:()=>{}}));for(let a in ia){let l=w[a];l===void 0?console.debug(`SubDB build error: "${a}" does not exist`):t(e,Y)[l]=new Uint8Array(ia[a])}e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(a){var i,s;let{data:l}=a;((i=t(e,de)[0])==null?void 0:i.type)===l.type&&((s=t(e,de)[0])!=null&&s.amend)?(t(e,de)[0].amend=l.amend,t(e,de)[0].data+=l.data):t(e,de).unshift(l)}),t(e,se)[1]=function(a){var l,i,s,n;switch(a=a.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),a.substring(0,2)){case"@I":{S(e,H,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Info",data:(l=a.substring(2))==null?void 0:l.trimLeft()});break}case"@K":{S(e,H,e.KARAOKE_TEXT);let c=a.substring(2);c!=="MIDI KARAOKE FILE"&&e.dispatchEvent("metacommit",{type:"Kar.Mode",data:c==null?void 0:c.trimLeft()}),console.debug(`Karaoke mode active: ${c}`);break}case"@L":{S(e,H,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Lang",data:(i=a.substring(2))==null?void 0:i.trimLeft()});break}case"@T":{S(e,H,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"KarTitle",data:(s=a.substring(2))==null?void 0:s.trimLeft()});break}case"@V":{S(e,H,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Ver.",data:(n=a.substring(2))==null?void 0:n.trimLeft()});break}case"XF":{let c=a.slice(2).split(":");switch(c[0]){case"hd":{c.slice(1).forEach((o,h)=>{o.length&&e.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][h],data:o})});break}case"ln":{c.slice(1).forEach((o,h)=>{o.length&&e.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][h],data:o})});break}default:e.dispatchEvent("metacommit",{type:"XfUnData",data:a})}break}default:switch(t(e,H)){case e.KARAOKE_TEXT:{switch(a[0]){case"\\":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:a.substring(1),amend:!0});break}case"/":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:a.substring(1),mask:!0,amend:!0});break}default:e.dispatchEvent("metacommit",{type:"KarLyric",data:a,amend:!0})}break}default:a.split(`
`).forEach((c,o)=>{e.dispatchEvent("metacommit",{type:"Cmn.Text",data:c,mask:o!==0})})}}},t(e,se)[2]=function(a){e.dispatchEvent("metacommit",{type:"Copyrite",data:a})},t(e,se)[3]=function(a,l){l<1&&t(e,Xe)<1&&e.dispatchEvent("metacommit",{type:"TrkTitle",data:a})},t(e,se)[4]=function(a,l){e.dispatchEvent("metacommit",{type:"Instrmnt",data:a})},t(e,se)[5]=function(a){switch(t(e,H)){case e.KARAOKE_XF:{let l="";for(let i of a)switch(i){case"^":case"%":{l+=" ";break}case">":{l+="	";break}case"<":{e.dispatchEvent("metacommit",{type:"KarLyric",data:l,mask:t(e,V),amend:!1}),l="",S(e,V,!1);break}case"/":{e.dispatchEvent("metacommit",{type:"KarLyric",data:l,mask:!1,amend:!1}),l="",S(e,V,!0);break}default:l+=i}l.length>0&&(e.dispatchEvent("metacommit",{type:"KarLyric",data:l,mask:t(e,V),amend:!0}),S(e,V,!1));break}default:{let l=0,i=!0,s=a.length-1;for(;i&&l<8;)switch(a.charCodeAt(l)){case 32:{l++;break}default:i=!1}switch(l>0&&(e.dispatchEvent("metacommit",{type:"C.Lyrics",data:a.substring(0,l),amend:!0,mask:t(e,V),untimed:!0}),S(e,V,!1)),a.charCodeAt(s)){case 10:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:a.substring(l,s),amend:!1,mask:t(e,V)}),S(e,V,!1);break}case 11:case 13:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:a.substring(l,s),amend:!1,mask:t(e,V)}),S(e,V,!0);break}case 32:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:a.substring(l,s),amend:!0,mask:t(e,V)}),e.dispatchEvent("metacommit",{type:"C.Lyrics",data:" ",amend:!0,mask:!1,untimed:!0}),S(e,V,!1);break}default:a.trim()===""?console.info("Blank line? Shouldn't happen."):e.dispatchEvent("metacommit",{type:"C.Lyrics",data:a,amend:!0,mask:t(e,V)}),S(e,V,!1)}break}}},t(e,se)[6]=function(a){e.dispatchEvent("metacommit",{type:"C.Marker",data:a})},t(e,se)[7]=function(a){switch(a[0]){case"$":{if(a.substring(1,5)==="Lyrc"){S(e,H,e.KARAOKE_XF);let l=a.substring(6).split(":"),i=l[0].replaceAll(" ","").split(",");i.forEach((n,c,o)=>{o[c]=parseInt(n)-1});let s=Jt[l[2].substring(0,2).toLowerCase()];e.dispatchEvent("metacommit",{type:"XfMeloCh",data:`CH${l[0].replaceAll(" ","").split(",").join(", CH")}`,parsed:i}),e.dispatchEvent("metacommit",{type:"XfLyrOff",data:l[1],parsed:parseInt(l[1])}),e.dispatchEvent("metacommit",{type:"XfLyrEnc",data:s[1],parsed:s[0]}),S(e,V,!1)}else e.dispatchEvent("metacommit",{type:"CuePoint",data:a});break}case"#":{e.dispatchEvent("metacommit",{type:"XfScneNo",data:a.substring(1)});break}case"&":{a.length===2?(e.dispatchEvent("metacommit",{type:"XfSngPrt",data:ea[a[1]]||`Unknown "${a[1]}"`}),S(e,V,!1)):e.dispatchEvent("metacommit",{type:"CuePoint",data:a});break}default:e.dispatchEvent("metacommit",{type:"CuePoint",data:a})}},t(e,se)[32]=function(a){S(e,Xe,a[0]+1)},t(e,se)[33]=function(a,l){O()&&console.debug(`Track ${l} requests getting assigned to port ${a}.`),t(e,Le)[l]=a+1},t(e,se)[81]=function(a,l){S(e,ct,a/1e3)},t(e,se)[127]=function(a,l){t(e,ze).run(a,l)},t(e,ze).default=function(a){let l=[];for(let i=0;i<8&&i<a.length;i++)l.push(a[i].toString(16).padStart(2,"0").toUpperCase());console.warn(`Unrecognized implementation-specific byte sequence: ${l.join(" ")}${a.length>8?" ...":""}
%o`,a)},t(e,ze).add([67,0,1],(a,l)=>{O()&&console.debug(`XGworks port assign requests assigning track ${l} to port ${a[0]}.`),t(e,Le)[l]=a[0]+1}).add([67,123,1],(a,l)=>{let i=[];for(let s=0;s<a.length;s+=2){let n=a[s]>>4,c=a[s]&15;if(n<7&&c&&c<8){let o=new Uint8Array(5);o[0]=c-1,o[1]=n-3<<2,o[2]=a[s|1],i.push(o)}}e.dispatchEvent("metacommit",{type:"ChordCtl",src:"yxf",data:i}),console.debug("Yamaha XF chord data: %o",i)}).add([67,123,2],(a,l)=>{var s;let i=new Uint8Array(2);i[0]=a[0]&15,i[1]=a[0]>>4,e.dispatchEvent("metacommit",{type:"RhrslMrk",src:"yxf",data:i}),console.debug(`Yamaha XF rehearsal mark: ${(s=["Intro","Ending","Fill-in"][i[0]])!=null?s:String.fromCharCode(62+i[0])}${"'".repeat(i[1])} %o`,i)}).add([67,123,96],(a,l)=>{let i=[0,0];a.subarray(1,3).forEach(s=>{i[0]=i[0]<<7,i[0]|=s&127}),a.subarray(3,5).forEach(s=>{i[1]=i[1]<<7,i[1]|=s&127}),e.dispatchEvent("metacommit",{type:"YStyleId",data:i}),console.debug(`Yamaha style ID: model ${i[0].toString(16)}, style ${i[1]+1}`)}),S(e,We,new pe("universal non-realtime")),S(e,qe,new pe("universal realtime")),S(e,j,new pe("Yamaha")),S(e,ue,new pe("Roland")),S(e,$e,new pe("Korg")),S(e,Qe,new pe("Kawai")),S(e,je,new pe("Akai")),S(e,Ze,new pe("Casio"));let r=new pe("DX7+ Dump"),f=function(a){let l=[];for(let i=0;i<8&&i<a.length;i++)l.push(a[i].toString(16).padStart(2,"0").toUpperCase());console.info(`Unrecognized SysEx in "${this.name}" set: ${l.join(" ")}${a.length>8?" ...":""}
%o`,a)};t(e,We).default=f,t(e,qe).default=f,t(e,j).default=f,t(e,ue).default=f,t(e,$e).default=f,t(e,Qe).default=f,t(e,je).default=f,t(e,Ze).default=f,r.default=f,t(e,We).add([9],(a,l,i)=>{e.switchMode(["gm","?","g2"][a[0]-1],!0),e.setPortMode(e.getTrackPort(l),1,w[["gm","?","g2"][a[0]-1]]),S(e,H,t(e,H)||e.KARAOKE_NONE),console.info(`MIDI reset: ${["GM","Init","GM2"][a[0]-1]}`),a[0]===2&&e.init()}),t(e,qe).add([4,1],(a,l,i)=>{e.invokeSysExIndicator(),S(e,K,((a[1]<<7)+a[0])/16383*100),e.dispatchEvent("mastervolume",t(e,K))}).add([4,3],(a,l,i)=>((a[1]<<7)+a[0]-8192)/8192).add([4,4],(a,l,i)=>a[1]-64).add([4,5],(a,l,i)=>{e.invokeSysExIndicator();let s=a[0],n=a[1],c=a[2],o=3,h=o+(s<<1),d=h+n;if(s!==1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${s})!
`,a);return}let y=0,E=0,T=0;switch(a.subarray(o,h).forEach(D=>{y=y<<7,y|=D}),a.subarray(h,d).forEach((D,P)=>{E|=D<<P*7}),a.subarray(d).forEach((D,P)=>{T|=D<<P*7}),O()&&console.debug(`GM2 global parameter: (${a.subarray(3,h)}; p: ${E}, v: ${T})`),y){case 129:{E===0&&(e.setEffectType(0,52,T),e.dispatchEvent("efxreverb",e.getEffectType(0)));break}case 130:{E===0&&(e.setEffectType(1,52,T|16),e.dispatchEvent("efxchorus",e.getEffectType(1)));break}default:O()&&console.debug("GM2 global paramater slot path unknown.")}}),t(this,j).add([76,0,0],(a,l,i)=>{switch(a[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset on drum kit ${a[1]}.`);break}case 126:{e.switchMode("xg",!0),e.setPortMode(e.getTrackPort(l),4,w.xg),S(e,H,t(e,H)||e.KARAOKE_NONE),console.info("MIDI reset: XG");break}default:{e.invokeSysExIndicator();let s=[0,0,0,0],n=(c,o)=>{s[o]=c};if(a.subarray(1).forEach((c,o)=>{let h=o+a[0];([n,n,n,n,d=>{S(this,K,d*129/16383*100),e.dispatchEvent("mastervolume",t(e,K))},d=>{},d=>{}][h]||(()=>{}))(c,o)}),a[0]<4){let c=0;s.forEach(o=>{c=c<<4,c+=o}),c-=1024,console.debug(`Master tune: ${c}`)}}}}).add([76,2,1],(a,l,i)=>{e.invokeSysExIndicator();let s="XG ";a[0]<32?(s+="reverb ",a.subarray(1).forEach((n,c)=>{([o=>{e.setEffectTypeRaw(0,!1,o),console.info(`${s}main type: ${ht[o]}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},o=>{e.setEffectTypeRaw(0,!0,o),console.debug(`${s}sub type: ${o+1}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},o=>{console.debug(`${s}time: ${Wt(o)}s`)},o=>{console.debug(`${s}diffusion: ${o}`)},o=>{console.debug(`${s}initial delay: ${o}`)},o=>{console.debug(`${s}HPF cutoff: ${tt[o]}Hz`)},o=>{console.debug(`${s}LPF cutoff: ${tt[o]}Hz`)},o=>{console.debug(`${s}width: ${o}`)},o=>{console.debug(`${s}height: ${o}`)},o=>{console.debug(`${s}depth: ${o}`)},o=>{console.debug(`${s}wall type: ${o}`)},o=>{console.debug(`${s}dry/wet: ${o}`)},o=>{console.debug(`${s}send: ${ce(o)}dB`)},o=>{console.debug(`${s}pan: ${o-64}`)},!1,!1,o=>{console.debug(`${s}delay: ${o}`)},o=>{console.debug(`${s}density: ${o}`)},o=>{console.debug(`${s}balance: ${o}`)},o=>{},o=>{console.debug(`${s}feedback: ${o}`)},o=>{}][a[0]+c]||function(){console.warn(`Unknown XG reverb address: ${a[0]}.`)})(n)})):a[0]<64?(s+="chorus ",a.subarray(1).forEach((n,c)=>{([o=>{e.setEffectTypeRaw(1,!1,o),console.info(`${s}main type: ${ht[o]}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},o=>{e.setEffectTypeRaw(1,!0,o),console.debug(`${s}sub type: ${o+1}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},o=>{console.debug(`${s}LFO: ${zt[o]}Hz`)},o=>{},o=>{console.debug(`${s}feedback: ${o}`)},o=>{console.debug(`${s}delay offset: ${qt(o)}ms`)},o=>{},o=>{console.debug(`${s}low: ${tt[o]}Hz`)},o=>{console.debug(`${s}low: ${o-64}dB`)},o=>{console.debug(`${s}high: ${tt[o]}Hz`)},o=>{console.debug(`${s}high: ${o-64}dB`)},o=>{console.debug(`${s}dry/wet: ${o}`)},o=>{console.debug(`${s}send: ${ce(o)}dB`)},o=>{console.debug(`${s}pan: ${o-64}`)},o=>{console.debug(`${s}to reverb: ${ce(o)}dB`)},!1,o=>{},o=>{},o=>{},o=>{console.debug(`${s}LFO phase diff: ${(o-64)*3}deg`)},o=>{console.debug(`${s}input mode: ${o?"stereo":"mono"}`)},o=>{}][a[0]-32+c]||function(){console.warn(`Unknown XG chorus address: ${a[0]}.`)})(n)})):a[0]<86?(s+="variation ",a.subarray(1).forEach((n,c)=>{([o=>{e.setEffectTypeRaw(2,!1,o),console.info(`${s}main type: ${ht[o]}`),e.dispatchEvent("efxdelay",e.getEffectType(2))},o=>{e.setEffectTypeRaw(2,!0,o),console.debug(`${s}sub type: ${o+1}`),e.dispatchEvent("efxdelay",e.getEffectType(2))}][a[0]-64+c]||function(){})(n)})):a[0]<97?(s+="variation ",a.subarray(1).forEach((n,c)=>{[o=>{console.debug(`${s}send: ${ce(o)}dB`)},o=>{console.debug(`${s}pan: ${o-64}`)},o=>{console.debug(`${s}to reverb: ${ce(o)}dB`)},o=>{console.debug(`${s}to chorus: ${ce(o)}dB`)},o=>{console.debug(`${s}connection: ${o?"system":"insertion"}`)},o=>{console.debug(`${s}channel: CH${o+1}`)},o=>{console.debug(`${s}mod wheel: ${o-64}`)},o=>{console.debug(`${s}bend wheel: ${o-64}`)},o=>{console.debug(`${s}channel after touch: ${o-64}`)},o=>{console.debug(`${s}AC1: ${o-64}`)},o=>{console.debug(`${s}AC2: ${o-64}`)}][a[0]-86+c](n)})):a[0]>111&&a[0]<118?s+="variation ":console.warn(`Unknown XG variation address: ${a[0]}`)}).add([76,2,64],(a,l,i)=>{a.subarray(1).forEach((s,n)=>{let c=n+a[0];if(c===0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][s]}`);else{let o=c-1>>2,h=c-1&3,d=`XG EQ ${o} ${["gain","freq","Q","shape"][h]}: `;[()=>{console.debug(`${d}${s-64}dB`)},()=>{console.debug(`${d}${s} (raw)`)},()=>{console.debug(`${d}${s/10}`)},()=>{console.debug(`${d}${["shelf","peak"][+!!s]}`)}][h]()}})}).add([76,3],(a,l,i)=>{e.invokeSysExIndicator();let s=a[0],n=a[1],c=`XG Insertion ${a[0]+1} `;a.subarray(2).forEach((o,h)=>{([d=>{e.setEffectTypeRaw(3+s,!1,d),console.info(`${c}main type: ${ht[d]}`),e.dispatchEvent(`efxinsert${s}`,e.getEffectType(3+s))},d=>{e.setEffectTypeRaw(3+s,!0,d),console.debug(`${c}sub type: ${d+1}`),e.dispatchEvent(`efxinsert${s}`,e.getEffectType(3+s))}][n+h]||function(){})(o)})}).add([76,6,0],(a,l,i)=>{let s=a[0];s<64?e.setLetterDisplay(a.subarray(1),"XG letter display",s):S(e,Ie,Date.now())}).add([76,7,0],(a,l,i)=>{let s=a[0];S(e,te,0),S(e,ye,Date.now()+3200),t(e,fe,xe).fill(0);let n=a.subarray(1);for(let c=0;c<s;c++)n.unshift(0);n.forEach(function(c,o){let h=Math.floor(o/16),d=o%16,y=(d*3+h)*7,E=7,T=0;for(y-=d*5,h===2&&(E=2);T<E;)t(e,fe,xe)[y+T]=c>>6-T&1,T++})}).add([76,8],(a,l)=>{e.invokeSysExIndicator();let i=e.chRedir(a[0],l,!0),s=a[1],n=N[i],c=`XG CH${i+1} `,o=`Unknown XG part address ${s}.`,h=!0;a.subarray(2).forEach((d,y)=>{h=!0,s<1?console.debug(o):s<41?([()=>{e.setChCc(i,0,d),e.pushChPrimitives(i),e.dispatchEvent("voice",{part:i})},()=>{e.setChCc(i,32,d),e.pushChPrimitives(i),e.dispatchEvent("voice",{part:i})},()=>{t(e,I)[i]=d,e.dispatchEvent("voice",{part:i})},()=>{h=!1;let E=e.chRedir(d,l,!0),T=t(e,B)[i];t(e,B)[i]=E,(i!==E||E!==T)&&(e.buildRchTree(),console.info(`${c}receives from CH${E+1}`)),t(e,oe)[i]||(e.copyChSetup(E,i,!0),console.debug(`${c}copied from CH${E+1}.`),e.setChActive(i,1),e.dispatchEvent("voice",{part:i}))},()=>{t(e,ae)[i]=+!d},()=>{},()=>{h=!1,e.setChType(i,d,w.xg),console.debug(`${c}type: ${ut[d]||d}`),e.dispatchEvent("voice",{part:i})},()=>{t(e,A)[g.rpn*i+3]=d,t(e,L)[g.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},!1,!1,()=>{e.setChCc(i,7,d)},!1,!1,()=>{e.setChCc(i,10,d||128)},!1,!1,()=>{e.setChCc(i,128,d),e.allocateAce(i,128)},()=>{e.setChCc(i,93,d)},()=>{e.setChCc(i,91,d)},()=>{e.setChCc(i,94,d)},()=>{e.setChCc(i,76,d)},()=>{e.setChCc(i,77,d)},()=>{e.setChCc(i,78,d)},()=>{e.setChCc(i,74,d)},()=>{e.setChCc(i,71,d)},()=>{e.setChCc(i,73,d)},()=>{e.setChCc(i,75,d)},()=>{e.setChCc(i,72,d)}][s+y-1]||(()=>{}))():s<48?console.debug(o):s<111?s>102&&s<105&&e.setChCc(i,[5,65][s&1],d):s<114?console.debug(o):s<116?console.debug(`${c}EQ ${["bass","treble"][s&1]} gain: ${d-64}dB`):s<118?console.debug(o):s<120?console.debug(`${c}EQ ${["bass","treble"][s&1]} freq: ${d}`):console.debug(o)}),h&&t(e,R)[i]>1&&e.setDrumFirstWrite(i)}).add([76,9],(a,l)=>{let i=e.chRedir(a[0],l,!0),s=a[1],n=N[i],c=`PLG-VL CH${i+1} `;a.subarray(2).forEach((o,h)=>{let d=h+s;switch(d){case 1:{console.info(`${c}breath mode: ${["system","breath","velocity","touch EG"][o]}`);break}case 0:case 27:case 28:break;default:if(d<27){let y=d-3>>1,E=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][y];d&1?d<23?(console.debug(`${c}${E} control source: ${Zt(o)}`),o&&o<96&&e.allocateAce(i,130+y),t(e,_e)[g.redir*i+y+2]=o,e.buildRccMap()):console.debug(`${c}${E} scale break point: ${o}`):(console.debug(`${c}${E} depth: ${o-64}`),e.setChCc(i,130+y,o))}}})}).add([76,10],(a,l,i)=>{}).add([76,16],(a,l,i)=>{}).add([76,17,0,0],(a,l,i)=>{}).add([76,112],(a,l,i)=>{switch(console.debug(`XG enable PLG-${["VL","SG","DX","AN","PF","DR","PC","AP"][a[0]]} for CH${a[2]+1}.`),a[0]){case 0:{t(e,re)[g.ext*a[2]]=e.EXT_VL;break}case 2:{t(e,re)[g.ext*a[2]]=e.EXT_DX;break}default:t(e,re)[g.ext*a[2]]=e.EXT_NONE}}).add([73,0,0],(a,l)=>{let i=a[0],s="MU1000 System - ";a.subarray(1).forEach((n,c)=>{let o=i+c;o===8?console.debug(`${s}LCD contrast: ${n}.`):o===18?(t(e,Y)[w.xg][1]=n?126:0,console.debug(`${s}default bank: ${n?"MU100 Native":"MU Basic"}.`),e.dispatchEvent("banklevel",{mode:"xg",data:+!!n}),e.forceVoiceRefresh()):o>=64&&o<69&&[()=>{e.dispatchEvent("channelactive",n)},()=>{n<8?(e.dispatchEvent("channelmin",n<<4),console.debug(`Octavia System: Minimum CH${(n<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{n<8?(e.dispatchEvent("channelmax",(n<<4)+15),console.debug(`Octavia System: Maximum CH${(n<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{S(e,we,!!n),console.info(`Octavia System: RS receiving ${["dis","en"][n]}abled.`)}][o-64]()})}).add([73,10,0],(a,l)=>{let i=a[0],s=`MU1000 RS${t(e,we)?"":" (ignored)"}: `;if(i<16)switch(i){case 2:{let n=e.chRedir(0,l,!0);t(e,we)&&(e.dispatchEvent("portrange",4),e.dispatchEvent("portstart",n)),console.info(`${s}Show CH${n+1}~CH${n+64}`);break}case 3:{let n=e.chRedir(a[1]<<5,l,!0);t(e,we)&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",n)),console.info(`${s}Show CH${n+1}~CH${n+32}`);break}default:console.debug(`${s}unknown switch ${i} invoked.`)}else if(i<32){if(t(e,we)){let n=e.chRedir(i-16+(t(e,ot)<<4),l,!0);e.dispatchEvent("channelactive",n)}}else if(i<36){let n=e.chRedir(i-32<<4,l,!0);t(e,we)&&(e.dispatchEvent("portrange",1),e.dispatchEvent("portstart",n>>4),S(e,ot,i-32)),console.info(`${s}Show CH${n+1}~CH${n+16}`)}}).add([73,11,0],(a,l)=>{let i="MU1000 System - channel ",s="Octavia System - channel ",n=a[0];a.subarray(1).forEach((c,o)=>{let h=n+o;([()=>{e.setChActive(c,1),e.dispatchEvent("channelactive",c),O()&&console.debug(`${i}current part: CH${c+1}`)},()=>{c<5?(e.dispatchEvent("portrange",1<<c),console.debug(`${i}port range: ${1<<c} port(s)`)):(e.dispatchEvent("portrange",0),console.debug(`${i}port range: reset`))},()=>{c<16?(e.dispatchEvent("portstart",c),console.debug(`${s}start port: ${"ABCDEFGHIJKLMNOP"[c]}`)):(e.dispatchEvent("portstart",255),console.debug(`${s}start port: reset`))}][h]||(()=>{console.debug(`${i}unknown address: ${h}`)}))()})}).add([93,3],(a,l)=>{let i=e.chRedir(a[0],l,!0),s=`PLG-SG CH${i+1} `,n=Date.now();if(a[1]===0){let c="",o=0;a.subarray(2).forEach((h,d)=>{d%2===0?c+=Qt[h]||h.toString().padStart("0"):o+=h*13}),(n>=t(e,Ke)||t(e,Ve)>=t(e,wt))&&(e.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),S(e,Fe,n<t(e,Ke)),S(e,Ve,0)),e.dispatchEvent("metacommit",{type:"SGLyrics",data:`${jt(c)}`,amend:!0,mask:t(e,Fe)}),_t(e,Ve)._++,S(e,Fe,!1),S(e,Ke,n+Math.ceil(o/2)+t(e,ct)),O()&&console.debug(`${s}vocals: ${c}`)}else console.warn(`Unknown PLG-SG data: ${a}`)}).add([98,96],(a,l,i,s)=>{let n=e.chRedir(a[0],l,!0),c=N[n],o=a[1];a.subarray(2).forEach((h,d)=>{let y=o+d;if(!(y<10)){if(y===10)e.resetAce();else if(y<27){let E=y+131;e.setChCc(n,E,h),!(s!=null&&s.noAce)&&h>0&&h!==64&&e.allocateAce(n,E),e.dispatchEvent("cc",{part:n,cc:E,data:h})}}})}).add([1,20],(a,l,i)=>{i===115?(e.switchMode("doc",!0),e.setPortMode(e.getTrackPort(l),1,w.doc),console.info("MIDI reset: DOC")):console.debug(`Unknown Yamaha SysEx: 67, ${i}, ${a.join(", ")}`)}).add([1,17,15,89],(a,l,i)=>{i===115?(e.setEffectType(0,24,a[0]|16),e.dispatchEvent("efxreverb",e.getEffectType(0))):console.debug(`Unknown Yamaha SysEx: 67, ${i}, ${a.join(", ")}`)}).add([1,24],(a,l,i)=>{if(i===115){for(let s=0;s<16;s++){let n=e.chRedir(s,l,!0);e.setChCc(n,91,127)}console.info("DOC Global Reverb: on")}else console.debug(`Unknown Yamaha SysEx: 67, ${i}, ${a.join(", ")}`)}).add([126,0],(a,l,i)=>{var s,n,c;switch(a[1]){case 0:{e.dispatchEvent("metacommit",{type:"YMCSSect",data:"Disabled",raw:"Intro "}),console.debug("Yamaha Section Control is off.");break}case 127:{e.dispatchEvent("metacommit",{type:"YMCSSect",data:(s=["Intro","Main A","Main B","Fill-in AB","Fill-in BA","Ending","Blank"][a[0]-8])!=null?s:`invalid section ${a[0]}`,raw:(n=["Intro ","Main A","Main B","FillAB","FillBA","Ending","Blank "][a[0]-8])!=null?n:`ID: ${a[0]}`}),console.debug(`Yamaha Section Control switches to "${(c=["intro","main A","main B","fill-in AB","fill-in BA","ending","blank"][a[0]-8])!=null?c:`Invalid section ${a[0]}`}".`);break}default:console.debug(`Unknown YMCS section control: ${a[1]}`)}}).add([126,2],(a,l,i)=>{let s=[];for(let n=0;n<a.length;n+=2){let c=a[n]>>4,o=a[n]&15;if(c<7&&o&&o<8){let h=new Uint8Array(5);h[0]=o-1,h[1]=c-3<<2,h[2]=a[n|1],s.push(h)}}e.dispatchEvent("metacommit",{type:"ChordCtl",src:"ymcs",data:s}),console.debug("YMCS chord data: %o",s)});let u=function(a,l,i,s){},p=function(a,l){e.invokeSysExIndicator();let i=a*g.dpn,s=l[0],n=l[1];l.subarray(2).forEach((c,o)=>{let h=o+n,d=-1;h<16?([()=>{d=24},()=>{d=25},()=>{d=26},()=>{},()=>{d=28},()=>{d=29},()=>{d=30},()=>{d=31},()=>{},()=>{},()=>{},()=>{d=20},()=>{d=21},()=>{d=22},()=>{d=23},()=>{}][h]||(()=>{console.debug(`Unknown XG-style drum param ${h} on set ${a+1}.`)}))():h<32||(h<40?([()=>{d=48},()=>{d=49},!1,!1,()=>{d=52},()=>{d=53}][h-32]||(()=>{console.debug(`Unknown XG-style drum param ${h} on set ${a+1}.`)}))():h<80||([()=>{d=36}][h-80]||(()=>{console.debug(`Unknown XG-style drum param ${h} on set ${a+1}.`)}))()),d>=0?(O()&&console.debug(i,d,s,c),t(e,ie)[(i+ge[d])*g.dnc+s]=c):O()&&console.debug(`XG-style drum param ${h} has no writes.`)})},m=function(a,l,i){e.invokeSysExIndicator();let s=a*g.dpn,n=(l<<7)+i[0];i.subarray(1).forEach((c,o)=>{let h=o+n,d=h&127,y=h>>7,E=-1;y>1&&([()=>{E=26},()=>{},()=>{E=28},()=>{E=29},()=>{E=30},()=>{},()=>{},()=>{E=31}][y-2]||(()=>{console.debug(`Unknown GS-style drum param ${y} on set ${a+1}.`)}))(),E>-1?(O()&&console.debug(s,E,d,c),t(e,ie)[(s+ge[E])*g.dnc+d]=c):O()&&console.debug(`GS-style drum param ${y} has no writes.`)})};t(this,j).add([76,48],(a,l,i)=>{p(0,a)}).add([76,49],(a,l,i)=>{p(1,a)}).add([76,50],(a,l,i)=>{p(2,a)}).add([76,51],(a,l,i)=>{p(3,a)}).add([76,52],(a,l,i)=>{p(4,a)}).add([76,53],(a,l,i)=>{p(5,a)}).add([76,54],(a,l,i)=>{p(6,a)}).add([76,55],(a,l,i)=>{p(7,a)}),t(this,j).add([89,0],(a,l,i)=>{if(e.eprom){let s=a[0],n=(a[1]<<14)+(a[2]<<7)+a[3]+(e.eprom.offset||0);O()&&console.debug(`MU1000 EPROM trail to 0x${n.toString(16).padStart(6,"0")}, ${s} bytes.`);let c=e.eprom.data;a.subarray(4).forEach((o,h)=>{let d=h>>3,y=h&7;if(y===7)for(let E=0;E<7;E++)c[n+7*d+E]+=(o>>6-E&1)<<7;else c[n+7*d+y]=o})}}).add([89,1],(a,l,i)=>{let s=(a[0]<<21)+(a[1]<<14)+(a[2]<<7)+a[3];O()&&console.debug(`MU1000 EPROM jump to 0x${s.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=s)}).add([89,2],(a,l,i)=>{if(e.eprom){let s=(a[0]<<21)+(a[1]<<14)+(a[2]<<7)+a[3]+(e.eprom.offset||0);O()&&console.debug(`MU1000 EPROM write to 0x${s.toString(16).padStart(6,"0")}.`);let n=e.eprom.data;a.subarray(4).forEach((c,o)=>{let h=o>>3,d=o&7;if(d===7)for(let y=0;y<7;y++)n[s+7*h+y]+=(c>>6-y&1)<<7;else n[s+7*h+d]=c})}}).add([89,3],(a,l,i)=>{}),t(this,j).add([39,48],(a,l,i)=>{}).add([43,0,0],(a,l,i)=>{e.invokeSysExIndicator();let s=[0,0,0,0],n=(c,o)=>{s[o]=c};if(a.subarray(1).forEach((c,o)=>{let h=o+a[0];[n,n,n,n,()=>{S(this,K,c*129/16383*100),e.dispatchEvent("mastervolume",t(e,K))},()=>c-64,()=>c||128,()=>c,()=>c,()=>{console.debug(`TG300 variation on cc${c}.`)}][h](c,h)}),a[0]<4){let c=0;s.forEach(o=>{c=c<<4,c+=o}),c-=1024,console.debug(`Master tune: ${c}`)}}).add([43,1,0],(a,l,i)=>{e.invokeSysExIndicator()}).add([43,2],(a,l,i)=>{e.invokeSysExIndicator();let s=e.chRedir(a[0],l,!0),n=a[1],c=N[s],o=`TG300 CH${s+1} `;a.subarray(2).forEach((h,d)=>{d<5?([()=>{},()=>{e.setChCc(s,0,h),e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{e.setChCc(s,32,h),e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{t(e,I)[s]=h,e.dispatchEvent("voice",{part:s})},()=>{let y=e.chRedir(h,l,!0),E=t(e,B)[s];t(e,B)[s]=y,(s!==y||y!==E)&&(e.buildRchTree(),console.info(`${o}receives from CH${y+1}`))}][d+n]||(()=>{}))(h,d+n):d<21||(d<47?([()=>{t(e,ae)[s]=+!h},()=>{},()=>{},()=>{t(e,A)[g.rpn*s+3]=h,t(e,L)[g.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{},()=>{e.setChCc(s,7,h)},!1,!1,()=>{e.setChCc(s,10,h||128)},!1,!1,()=>{console.debug(`${o} AC1 at cc${h}`)},()=>{console.debug(`${o} AC2 at cc${h}`)},()=>{t(e,v)[c+C[128]]=h,e.allocateAce(s,128)},()=>{t(e,v)[c+C[93]]=h},()=>{t(e,v)[c+C[91]]=h},()=>{t(e,v)[c+C[94]]=h},()=>{t(e,v)[c+C[76]]=h},()=>{t(e,v)[c+C[77]]=h},()=>{t(e,v)[c+C[74]]=h},()=>{t(e,v)[c+C[71]]=h},()=>{t(e,v)[c+C[73]]=h},()=>{t(e,v)[c+C[75]]=h},()=>{t(e,v)[c+C[72]]=h},()=>{t(e,v)[c+C[78]]=h}][d+n-21]||(()=>{}))(h,d+n):d<95||([()=>{t(e,v)[c+C[65]]=h},()=>{t(e,v)[c+C[5]]=h}][d+n-95]||(()=>{}))(h,d+n))})}).add([43,7,0],(a,l,i)=>{let s=a[0];e.setLetterDisplay(a.subarray(1),"TG300 letter display",s)}).add([43,7,1],(a,l,i)=>{S(e,te,0),S(e,ye,Date.now()+3200),t(e,fe,xe).fill(0),a.forEach(function(s,n){let c=Math.floor(n/16),o=n%16,h=(o*3+c)*7,d=7,y=0;for(h-=o*5,c===2&&(d=2);y<d;)t(e,fe,xe)[h+y]=s>>6-y&1,y++})}),t(this,ue).add([66,18,0,0,127],(a,l,i)=>{e.switchMode("sc",!0),e.setPortMode(e.getTrackPort(l),2,w.sc),t(e,Y)[w.sc][1]=t(e,U).sc,S(e,H,e.KARAOKE_NONE),t(e,Pe).fill(0),console.info(`GS system to ${["single","dual"][a[0]]} mode.`)}).add([66,18,64,0],(a,l,i)=>{switch(a[0]){case 127:{e.switchMode("gs",!0),e.setPortMode(e.getTrackPort(l),4,w.gs),t(e,Y)[w.gs][1]=t(e,U).gs,S(e,H,e.KARAOKE_NONE),t(e,Pe).fill(0),console.info("MIDI reset: GS");break}default:{e.invokeSysExIndicator();let s=[0,0,0,0],n=(c,o)=>{s[o]=c};if(a.subarray(1).forEach((c,o)=>{let h=o+a[0];[n,n,n,n,d=>{S(this,K,d*129/16383*100),e.dispatchEvent("mastervolume",t(e,K))},d=>{},d=>{}][h](c,o)}),a[0]<4){let c=0;s.forEach(o=>{c=c<<4,c+=o}),c-=1024,console.debug(`Master tune: ${c}`)}}}}).add([66,18,64,1],(a,l,i)=>{e.invokeSysExIndicator();let s=a[0];if(s<16){let n="".padStart(s," ");a.subarray(1).forEach((c,o)=>{n+=String.fromCharCode(Math.max(32,c))}),n=n.padEnd(16," "),console.debug(`GS patch name: ${n}`)}else s<48||(s<65?a.subarray(1).forEach((n,c)=>{let o=`GS ${s+c>55?"chorus":"reverb"} `;([()=>{console.info(`${o}type: ${At[n]}`),e.setEffectType(0,40,n),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${o}predelay: ${n}ms`)},()=>{console.info(`${o}type: ${ta[n]}`),e.setEffectType(1,40,16+n),e.dispatchEvent("efxchorus",e.getEffectType(1))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${o}to reverb: ${ce(n)}`)},()=>{console.debug(`${o}to delay: ${ce(n)}`)}][s+c-48]||(()=>{}))()}):s<80?console.debug(`Unknown GS patch address: ${s}`):s<91?a.subarray(1).forEach((n,c)=>{let o="GS delay ";([()=>{console.info(`${o}type: ${aa[n]}`),e.setEffectType(2,40,32+n),e.dispatchEvent("efxdelay",e.getEffectType(2))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${o}to reverb: ${ce(n)}`)}][s+c-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${s}`))}).add([66,18,64,2],(a,l,i)=>{let s="GS EQ ";a.subarray(1).forEach((n,c)=>{([()=>{console.debug(`${s}low freq: ${[200,400][n]}Hz`)},()=>{console.debug(`${s}low gain: ${n-64}dB`)},()=>{console.debug(`${s}high freq: ${[3e3,6e3][n]}Hz`)},()=>{console.debug(`${s}high gain: ${n-64}dB`)}][a[0]+c]||function(){console.warn(`Unknown GS EQ address: ${a[0]+c}`)})()})}).add([66,18,64,3],(a,l,i)=>{e.invokeSysExIndicator();let s="GS EFX ",n=function(c,o){let h=ra(t(e,le).subarray(10,12),o,c);h&&console.debug(`${s}${Ot(t(e,le).subarray(10,12))} ${h}`)};a.subarray(1).forEach((c,o)=>{([()=>{e.setEffectTypeRaw(3,!1,32+c),e.dispatchEvent("efxinsert0",e.getEffectType(3))},()=>{e.setEffectTypeRaw(3,!0,c),console.info(`${s}type: ${Ot(t(e,le).subarray(10,12))}`),e.dispatchEvent("efxinsert0",e.getEffectType(3))},!1,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,()=>{console.debug(`${s}to reverb: ${ce(c)}dB`)},()=>{console.debug(`${s}to chorus: ${ce(c)}dB`)},()=>{console.debug(`${s}to delay: ${ce(c)}dB`)},!1,()=>{console.debug(`${s}1 source: ${c}`),c&&c<96&&e.allocateAceAll(c)},()=>{console.debug(`${s}1 depth: ${c-64}`)},()=>{console.debug(`${s}2 source: ${c}`),c&&c<96&&e.allocateAceAll(c)},()=>{console.debug(`${s}2 depth: ${c-64}`)},()=>{console.debug(`${s}to EQ: ${c?"ON":"OFF"}`)}][a[0]+o]||function(h,d){console.warn(`Unknown GS EFX address: ${d}`)})(c,a[0]+o)})}).add([66,18,65],(a,l,i)=>{m((a[0]>>4)+1<<1,a[0]&15,a.subarray(1))}).add([69,18,16],(a,l,i)=>{var s;switch(a[0]){case 0:{let n=a[1];e.setLetterDisplay(a.subarray(2),"GS display text",n);break}case 8:{let n=a[1],c=e.modelEx.sc;a.subarray(2).forEach((o,h)=>{([()=>{c.showBar=!(o&1),c.invBar=o>>1&1,c.invDisp=o>>2&1},()=>{c.peakHold=o<4?o:1}][h+n]||(()=>{console.debug("Unsupported GS display type SysEx.")}))()});break}case 32:{S(e,ye,Date.now()+3200),a[1]===0&&(a[2]?(S(e,te,Math.max(Math.min(a[2]-1,9),0)),O()&&console.debug(`GS switch display page ${a[2]-1}.`)):(S(e,te,0),S(e,ye,Date.now()),O()&&console.debug("GS disable display page.")));break}default:if(a[0]<6){t(e,te)>9&&S(e,te,0);let n=a[0]-1<<1|a[1]>>6;t(e,te)===n&&S(e,ye,Date.now()+3200),(s=t(e,Te)[n])!=null&&s.length||(t(e,Te)[n]=new Uint8Array(256));let c=t(e,Te)[n];O()&&console.debug(`GS frame draw page ${n}.`);let o=a[1]&63;c.fill(0),a.subarray(2).forEach(function(d,y){let E=y+o,T=Math.floor(E/16),D=E%16,P=(D*4+T)*5,Re=5,Se=0;for(P-=D*4,T===3&&(Re=1);Se<Re;)c[P+Se]=d>>4-Se&1,Se++})}else console.warn(`Unknown GS display section: ${a[0]}`)}}).add([69,18,32],(a,l,i)=>{let s=a[0],n=a[1],c=a.subarray(2);if(s>>4){console.warn(`SC-8850 partial screen dump out of bounds: invalid bundle.
`,a);return}let o=n+c.length,h=n*6-(n*2428>>16<<1),d=o*6-(o*2428>>16<<1);if(h>640){console.warn(`SC-8850 partial screen dump out of bounds: invalid buffer range.
`,a);return}d>640&&(console.info(`SC-8850 partial screen dump out of bounds: invalid buffer end, automatically restricted.
`,a),d=640);let y=new Uint8Array(d-h);c.forEach((D,P)=>{let Re=P+n,Se=(Re*2428&65535)*27>>16===26,Z=Re*6-(Re*2428>>16<<1),Je=Se?2:0;for(;Je<6;)y[Z+(5-Je)]=D>>Je&1,Je++});let E=s*108+n,T=E*6-(E*2428>>16<<1);e.dispatchEvent("screen",{type:"sc8850",offset:T,data:y}),O()&&console.debug(`SC-8850 screen dump: bundle ${s+1}, range ${h}~${d}`)});let k=function(a,l,i){e.invokeSysExIndicator();let s=a[0],n=N[l],c=at[l],o=`GS CH${l+1} `;s<3?(a.subarray(1).forEach((h,d)=>{[()=>{t(e,v)[n+C[0]]=h,e.pushChPrimitives(l)},()=>{t(e,I)[l]=h},()=>{let y=0;h<16?y=e.chRedir(h,i,!0):y=g.ch,t(e,B)[l]=y;let E=t(e,B)[l];t(e,B)[l]=y,(l!==y||y!==E)&&(e.buildRchTree(),console.info(`${o}receives from CH${y+1}`))}][s+d]()}),e.dispatchEvent("voice",{part:l})):s<19||(s<44?a.subarray(1).forEach((h,d)=>{([()=>{t(e,ae)[l]=+!h},!1,()=>{e.setChType(l,h<<1,w.gs),console.debug(`${o}type: ${h?"drum ":"melodic"}${h||""}`)},()=>{t(e,A)[c+3]=h,t(e,L)[g.rpnt*l+2]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)})},!1,()=>{t(e,v)[n+C[7]]=h},!1,!1,()=>{t(e,v)[n+C[10]]=h||128},!1,!1,()=>{console.debug(`${o}CC 1: cc${h}`)},()=>{console.debug(`${o}CC 2: cc${h}`)},()=>{t(e,v)[n+C[93]]=h},()=>{t(e,v)[n+C[91]]=h},!1,!1,()=>{t(e,A)[c+1]=h,t(e,L)[g.rpnt*l+1]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)})},()=>{t(e,A)[c+2]=h,t(e,L)[g.rpnt*l+1]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)})},()=>{t(e,v)[n+C[94]]=h}][s+d-19]||(()=>{}))()}):s<76||console.debug(`Unknown GS part address: ${s}`))},$=function(a,l){let i=a[0],s=`GS CH${l+1} `;i<2?a.subarray(1).forEach((n,c)=>{[()=>{e.setChCc(l,32,n)},()=>{}][i+c]()}):i<32?console.warn(`Unknown GS misc address: ${i}`):i<35?a.subarray(1).forEach((n,c)=>{[()=>{console.debug(`${s}EQ: o${["ff","n"][n]}`)},()=>{},()=>{console.debug(`${s}EFX: o${["ff","n"][n]}`),t(e,st)[l]=n,e.dispatchEvent("partefxtoggle",{part:l,active:n})}][i+c-32]()}):console.warn(`Unknown GS misc address: ${i}`)};t(this,ue).add([66,18,64,16],(a,l)=>{k(a,e.chRedir(9,l,!0),l)}).add([66,18,64,17],(a,l)=>{k(a,e.chRedir(0,l,!0),l)}).add([66,18,64,18],(a,l)=>{k(a,e.chRedir(1,l,!0),l)}).add([66,18,64,19],(a,l)=>{k(a,e.chRedir(2,l,!0),l)}).add([66,18,64,20],(a,l)=>{k(a,e.chRedir(3,l,!0),l)}).add([66,18,64,21],(a,l)=>{k(a,e.chRedir(4,l,!0),l)}).add([66,18,64,22],(a,l)=>{k(a,e.chRedir(5,l,!0),l)}).add([66,18,64,23],(a,l)=>{k(a,e.chRedir(6,l,!0),l)}).add([66,18,64,24],(a,l)=>{k(a,e.chRedir(7,l,!0),l)}).add([66,18,64,25],(a,l)=>{k(a,e.chRedir(8,l,!0),l)}).add([66,18,64,26],(a,l)=>{k(a,e.chRedir(10,l,!0),l)}).add([66,18,64,27],(a,l)=>{k(a,e.chRedir(11,l,!0),l)}).add([66,18,64,28],(a,l)=>{k(a,e.chRedir(12,l,!0),l)}).add([66,18,64,29],(a,l)=>{k(a,e.chRedir(13,l,!0),l)}).add([66,18,64,30],(a,l)=>{k(a,e.chRedir(14,l,!0),l)}).add([66,18,64,31],(a,l)=>{k(a,e.chRedir(15,l,!0),l)}).add([66,18,64,64],(a,l)=>{$(a,e.chRedir(9,l,!0))}).add([66,18,64,65],(a,l)=>{$(a,e.chRedir(0,l,!0))}).add([66,18,64,66],(a,l)=>{$(a,e.chRedir(1,l,!0))}).add([66,18,64,67],(a,l)=>{$(a,e.chRedir(2,l,!0))}).add([66,18,64,68],(a,l)=>{$(a,e.chRedir(3,l,!0))}).add([66,18,64,69],(a,l)=>{$(a,e.chRedir(4,l,!0))}).add([66,18,64,70],(a,l)=>{$(a,e.chRedir(5,l,!0))}).add([66,18,64,71],(a,l)=>{$(a,e.chRedir(6,l,!0))}).add([66,18,64,72],(a,l)=>{$(a,e.chRedir(7,l,!0))}).add([66,18,64,73],(a,l)=>{$(a,e.chRedir(8,l,!0))}).add([66,18,64,74],(a,l)=>{$(a,e.chRedir(10,l,!0))}).add([66,18,64,75],(a,l)=>{$(a,e.chRedir(11,l,!0))}).add([66,18,64,76],(a,l)=>{$(a,e.chRedir(12,l,!0))}).add([66,18,64,77],(a,l)=>{$(a,e.chRedir(13,l,!0))}).add([66,18,64,78],(a,l)=>{$(a,e.chRedir(14,l,!0))}).add([66,18,64,79],(a,l)=>{$(a,e.chRedir(15,l,!0))}),t(this,$e).add([54,65],(a,l)=>{let i=t(e,U).x5==="81"?"05rw":"x5d";e.switchMode(i,!0),e.setPortMode(e.getTrackPort(l),1,w[i]);let s=a[a.length-1],n=a.subarray(0,a.length-1),c=Ue(n);c!==s&&(console.info(`X5D multi parameters checksum mismatch! Expected ${c}, got ${s}.`),console.debug(a));let o=(a[1]<<7)+a[0],h=(a[3]<<7)+a[2],d=e.chRedir(o&15,l,!0),y=N[d];[()=>{h<1||(h<101?(e.setChType(d,e.CH_MELODIC,w.x5d),t(e,I)[d]=h-1,t(e,v)[y+C[0]]=t(e,U).x5):h<229?(e.setChType(d,e.CH_MELODIC,w.x5d),t(e,I)[d]=h-101,t(e,v)[y+C[0]]=56):(e.setChType(d,e.CH_DRUMS,w.x5d),t(e,I)[d]=da[h-229]||0,t(e,v)[y+C[0]]=62)),e.pushChPrimitives(d),e.dispatchEvent("voice",{part:d})},()=>{t(e,v)[y+C[7]]=h},()=>{h<31&&(t(e,v)[y+C[10]]=Math.round((h-15)*4.2+64))},()=>{t(e,v)[y+C[93]]=pt(h)},()=>{t(e,v)[y+C[91]]=pt(h)},()=>{t(e,A)[d*g.rpn+3]=h>8191?h-16320:64+h,t(e,L)[g.rpnt*d+2]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)})},()=>{t(e,A)[d*g.rpn+1]=h>8191?h-16320:64+h,t(e,L)[g.rpnt*d+1]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)})},()=>{h>0&&(t(e,A)[d*g.rpn]=h,t(e,L)[g.rpnt*d]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)}))},()=>{}][o>>4]()}).add([54,76,0],(a,l)=>{e.invokeSysExIndicator();let i=t(e,U).x5==="81"?"05rw":"x5d";e.switchMode(i),e.setPortMode(e.getTrackPort(l),1,w[i]);let s="",n=t(e,U).x5,c=0,o=0,h="MSB	PRG	LSB	NME";be(a,function(d,y){if(y<16400){let E=y%164;switch(!0){case E<10:{d>31&&(s+=String.fromCharCode(d));break}case E===10:break;case E===11:{h+=`
${n}	${c}	${o}	${s.trim().replace("Init Voice","")}`,c++,s="";break}}c>99&&(n=90,c=0)}}),e.userBank.clearRange({msb:t(e,U).x5,prg:[0,99],lsb:0}),e.userBank.load(h),O()&&console.debug(h),e.forceVoiceRefresh()}).add([54,77,0],(a,l)=>{e.invokeSysExIndicator();let i=t(e,U).x5==="81"?"05rw":"x5d";e.switchMode(i),e.setPortMode(e.getTrackPort(l),1,w[i]);let s="",n=90,c=0,o=0,h="MSB	PRG	LSB	NME";be(a,function(d,y){if(y<13600){let E=y%136;switch(!0){case E<10:{d>31&&(s+=String.fromCharCode(d));break}case E===11:{h+=`
${n}	${c}	${o}	${s.trim().replace("Init Combi","")}`,c++,s="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(h),O()&&console.debug(h),e.forceVoiceRefresh()}).add([54,78],(a,l)=>{let i=t(e,U).x5==="81"?"05rw":"x5d";e.switchMode(i),e.setPortMode(e.getTrackPort(l),1,w[i]),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][a[0]]} mode.`)}).add([54,85],(a,l)=>{e.invokeSysExIndicator();let i=t(e,U).x5==="81"?"05rw":"x5d";e.switchMode(i),e.setPortMode(e.getTrackPort(l),1,w[i]),be(a,(s,n)=>{n>0&&n<3&&(e.setEffectType(n-1,44,s),e.dispatchEvent(`efx${["reverb","chorus"][n-1]}`,e.getEffectType(n-1)))})}).add([54,104],(a,l)=>{e.invokeSysExIndicator();let i=t(e,U).x5==="81"?"05rw":"x5d";e.switchMode(i,!0);let s=e.getTrackPort(l);if(t(e,W)[s]&&t(e,W)[s]!==w[i])if(t(e,ke).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${l}. Port ${String.fromCharCode(65+s)} mode "${z[t(e,W)[s]]}" mismatch, should be "${i}".`);return}else console.info(`Track ${l} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);e.setPortMode(s,1,w[i]),be(a,function(n,c,o,h){if(c<192){let d=e.chRedir(Math.floor(c/12),l,!0),y=N[d];switch(c%12){case 0:{n<128?(e.setChType(d,e.CH_MELODIC,w.x5d),t(e,v)[y+C[0]]=t(e,U).x5,t(e,I)[d]=n):(e.setChType(d,e.CH_DRUMS,w.x5d),t(e,v)[y+C[0]]=62,t(e,I)[d]=da[n-128]),n>0&&e.setChActive(d,1),e.pushChPrimitives(d),e.dispatchEvent("voice",{part:d});break}case 1:{t(e,v)[y+C[7]]=n;break}case 2:{t(e,A)[d*g.rpn+3]=n>127?n-192:64+n,t(e,L)[g.rpnt*d+2]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)});break}case 3:{t(e,A)[d*g.rpn+1]=n>127?n-192:64+n,t(e,L)[g.rpnt*d+1]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)});break}case 4:{n<31&&(t(e,v)[y+C[10]]=Math.round((n-15)*4.2+64));break}case 5:{let E=n>>4,T=n&15;t(e,v)[y+C[91]]=pt(T),t(e,v)[y+C[93]]=pt(E);break}case 10:{t(e,R)[d]||(t(e,v)[y+C[0]]=n>>6?56:t(e,U).x5,e.pushChPrimitives(d),e.dispatchEvent("voice",{part:d}));break}case 11:{let E=e.chRedir(n&15,l,!0),T=n>>4;t(e,B)[d]=n,(E!==d||T)&&console.info(`X5D Part CH${d+1} receives from CH${E+1}.`)}}}else{let d=e.chRedir(c-192,l,!0)}}),e.buildRchTree()}),t(this,ue).add([22,18,127],(a,l,i)=>{e.switchMode("mt32",!0),e.setPortMode(e.getTrackPort(l),1,w.mt32),S(e,H,e.KARAOKE_NONE),e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(a,l,i)=>{e.switchMode("mt32");let s=e.chRedir(i,l,!0),n=a[1];a.subarray(2).forEach((c,o)=>{let h=o+n;t(e,Ae)[h+(s-1)*16]=c,([!1,()=>{let d=t(e,Ae)[s-1<<4];if(d<3){if(t(e,he)[s]=1,d===2)for(let y=0;y<name.length;y++)t(e,ve)[(s-1)*g.cmt+y]=t(e,Oe)[c*g.cmt+y];else{let y=e.baseBank.get(0,c+(d<<6),127,"mt32").name;for(let E=0;E<y.length;E++)t(e,ve)[(s-1)*g.cmt+E]=y.charCodeAt(E)}e.dispatchEvent("voice",{part:s})}},()=>{t(e,A)[s*g.rpn+3]=c+40,t(e,L)[g.rpnt*s+2]=1},()=>{t(e,A)[s*g.rpn+1]=c+14,t(e,L)[g.rpnt*s+1]=1},()=>{t(e,A)[s*g.rpn]=c,t(e,L)[g.rpnt*s]=1},!1,()=>{e.setChCc(s,91,c?127:0)},!1,()=>{e.setChCc(s,7,c)},()=>{e.setChCc(s,10,Math.ceil(c*9.05))}][h]||(()=>{}))()})}).add([22,18,1],(a,l,i)=>{e.switchMode("mt32");let s=i&7;console.debug(`MT-32 slot #${i+1} Drum: ${a}`);let n=a[0]<<7|a[1];a.subarray(2).forEach((c,o)=>{let h=o+n,d=(h>>2)+24,y=h&3,E=s*g.dpn;if(O()&&console.debug(`MT-32 temp drum note ${d} param ${y}: ${c}`),d<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${d}`);return}[()=>{},()=>{t(e,ie)[(E+ge[26])*g.dnc+d]=Math.round(c*1.27)},()=>{t(e,ie)[(E+ge[26])*g.dnc+d]=c*9+1&127},()=>{t(e,ie)[(E+ge[26])*g.dnc+d]=c?127:0}][y]()})}).add([22,18,2],(a,l,i)=>{e.switchMode("mt32");let s=e.chRedir(i,l,!0),n=a[1]+(a[0]<<7);n<10&&(t(e,he)[s]=1),a.subarray(2).forEach((c,o)=>{let h=o+n;h<14&&(t(e,ve)[(s-1)*g.cmt+h]=c)}),e.dispatchEvent("voice",{part:s})}).add([22,18,3],(a,l,i)=>{e.switchMode("mt32");let s=i&7;if(a[0]){let n=(a[0]-1<<7)+a[1]-16;a.subarray(2).forEach((c,o)=>{let h=o+n,d=(h>>2)+24,y=h&3,E=s*g.dpn;if(O()&&console.debug(`MT-32 dev drum note ${d} param ${y}: ${c}`),d<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${d}`);return}[()=>{},()=>{t(e,ie)[(E+ge[26])*g.dnc+d]=Math.round(c*1.27)},()=>{t(e,ie)[(E+ge[26])*g.dnc+d]=c*9+1&127},()=>{t(e,ie)[(E+ge[26])*g.dnc+d]=c?127:0}][y]()})}else{let n=a[1];a.subarray(2).forEach((c,o)=>{let h=o+n;t(e,Ae)[h]=c;let d=e.chRedir(1+(h>>4),l,!0),y=h&15;([!1,()=>{let E=t(e,Ae)[d-1<<4];if(E<3)if(t(e,he)[d]=1,E===2)for(let T=0;T<name.length;T++)t(e,ve)[(d-1)*g.cmt+T]=t(e,Oe)[c*g.cmt+T];else{let T=e.baseBank.get(0,c+(E<<6),127,"mt32").name;for(let D=0;D<T.length;D++)t(e,ve)[(d-1)*g.cmt+D]=T.charCodeAt(D)}e.dispatchEvent("voice",{part:d})},()=>{t(e,A)[d*g.rpn+3]=c+40,t(e,L)[g.rpnt*d+2]=1},()=>{t(e,A)[d*g.rpn+1]=c+14,t(e,L)[g.rpnt*d+1]=1},()=>{t(e,A)[d*g.rpn]=c,t(e,L)[g.rpnt*d]=1},!1,()=>{e.setChCc(d,91,c?127:0)},!1,()=>{e.setChCc(d,7,c)},()=>{e.setChCc(d,10,Math.ceil(c*9.05))}][y]||(()=>{}))()})}}).add([22,18,4],(a,l,i)=>{e.switchMode("mt32");let s=a[1]+(a[0]<<7),n=[];a.subarray(2).forEach((c,o)=>{let h=o+s,d=e.chRedir(Math.floor(h/246+1),l,!0),y=h%246;y<14&&(t(e,ve)[(d-1)*g.cmt+y]=c),y<10&&(t(e,he)[d]=1),n.indexOf(d)<0&&n.push(d)}),n.forEach(c=>{e.dispatchEvent("voice",{part:c})})}).add([22,18,5],(a,l,i)=>{e.switchMode("mt32");let s=(a[0]<<7)+a[1];a.subarray(2).forEach((n,c)=>{let o=s+c,h=Math.floor(o/8),d=o&7,y=h*8;t(e,nt)[o]=n,([!1,()=>{let E=t(e,nt)[y];if(E<3){let T="";if(E===2){let P=g.cmt*h;T=`MT-m:${n.toString().padStart(3,"0")}`}else T=e.baseBank.get(0,n+(E<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:h});let D=`MSB	LSB	PRG	NME
49	127	${h}	${T}`;e.userBank.load(D,!0)}}][d]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(a,l,i)=>{e.switchMode("mt32");let s=((a[0]&1)<<7)+a[1],n=a[0]>>1,c=!1;if(a.subarray(2).forEach((o,h)=>{let d=s+h;d<g.cmt&&(t(e,Oe)[n*g.cmt+d]=o,c=!0)}),c){e.userBank.clearRange({msb:0,lsb:127,prg:n});let o=`MSB	LSB	PRG	NME
49	127	${n}	MT-m:${n}`;e.userBank.load(o,!0)}e.forceVoiceRefresh()}).add([22,18,16],(a,l,i)=>{e.switchMode("mt32");let s=a[1],n=!1,c=function(o,h){t(e,B)[h-12]=o,n=!0};a.subarray(2).forEach((o,h)=>{let d=h+s;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,c,c,c,c,c,c,c,c,c,()=>{S(e,K,o),e.dispatchEvent("mastervolume",t(e,K))}][d]||(()=>{}))(o,h)}),n&&e.buildRchTree()}).add([22,18,32],(a,l,i)=>{e.switchMode("mt32");let s=a[1],n=" ".repeat(s);a.subarray(2).forEach(c=>{c>31?n+=String.fromCharCode(c):n+=" "}),S(e,De,n.padStart(20," ")),S(e,Ie,Date.now()+3200)}).add([22,18,82],(a,l)=>{let i=e.chRedir(0,l,!0);for(let s=0;s<16;s++)t(e,Q).ano(i+s),s&&s<10&&(t(e,I)[i+s]=Dt[s-1]);console.info("MT-32 alt reset complete.")}),t(this,$e).add([66,0],(a,l)=>{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(l),2,w.ns5r),S(e,H,e.KARAOKE_NONE),console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][a[0]]} mode.`)}).add([66,1],(a,l)=>{let i=["ns5r","05rw"][a[0]];e.switchMode(i,!0),e.setPortMode(e.getTrackPort(l),2,w[i]),S(e,H,e.KARAOKE_NONE)}).add([66,18,0,0],(a,l)=>{let i=a[0];switch(i){case 124:case 126:case 127:{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(l),2,w.ns5r),S(e,H,e.KARAOKE_NONE);break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset on drum kit ${a[1]}.`);break}default:if(i<10){let s=[0,0,0,0],n=(c,o)=>{s[o]=c};if(a.subarray(1).forEach((c,o)=>{[n,n,n,n,()=>{S(e,K,c*129/16383*100),e.dispatchEvent("mastervolume",t(e,K))},()=>c-64,()=>c-64,()=>{},()=>{},()=>{}][i+o]()}),a[0]<4){let c=0;s.forEach(o=>{c=c<<4,c+=o}),c-=1024,console.debug(`Master tune: ${c}`)}}}}).add([66,18,0,1],(a,l)=>{}).add([66,18,0,2],(a,l)=>{}).add([66,18,1],(a,l)=>{e.invokeSysExIndicator();let i=e.chRedir(a[0],l,!0),s=N[i],n=a[1],c=`NS5R CH${i+1} `;a.subarray(2).forEach((o,h)=>{let d=n+h;d<3?([()=>{t(e,v)[s+C[0]]=o||bt.bank0,e.pushChPrimitives(i)},()=>{t(e,v)[s+C[32]]=o,e.pushChPrimitives(i)},()=>{t(e,I)[i]=o}][d](),e.dispatchEvent("voice",{part:i})):d<8||(d<14?[()=>{let y=e.chRedir(o,l,!0),E=t(e,B)[i];t(e,B)[i]=y,(i!==y||y!==E)&&(e.buildRchTree(),console.info(`${c}receives from CH${y+1}`))},()=>{t(e,ae)[i]=+!o},()=>{e.setChType(i,o,w.ns5r),console.debug(`${c}type: ${ut[o]}`)},()=>{t(e,A)[g.rpn*i+3]=o,t(e,L)[g.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{},()=>{}][d-8]():d<16||(d<33?[()=>{t(e,v)[s+C[7]]=o},()=>{t(e,v)[s+C[11]]=o},()=>{},()=>{},()=>{t(e,v)[s+C[10]]=o||128},()=>{},()=>{},()=>{t(e,v)[s+C[93]]=o},()=>{t(e,v)[s+C[91]]=o},()=>{t(e,v)[s+C[76]]=o},()=>{t(e,v)[s+C[77]]=o},()=>{t(e,v)[s+C[78]]=o},()=>{t(e,v)[s+C[74]]=o},()=>{t(e,v)[s+C[71]]=o},()=>{t(e,v)[s+C[73]]=o},()=>{t(e,v)[s+C[75]]=o},()=>{t(e,v)[s+C[72]]=o}][d-16]():d<112||d<114&&[()=>{t(e,v)[s+C[5]]=o},()=>{t(e,v)[s+C[65]]=o}][d-112]()))})}).add([66,18,8,0],(a,l)=>{let i=a[0];if(i<32)e.setLetterDisplay(a.subarray(1,33),"NS5R letter display");else{let s=i-32;S(e,ye,Date.now()+3200),S(e,te,10),t(e,fe,xe).fill(0);let n=a.subarray(1),c=4;n.forEach(function(o,h){let d=h+s,y=d>>4,E=d&15;if(d<80){let T=y<c?o:o>>3,D=0,P=y<c?6:3;for(;T>0;)t(e,fe,xe)[E*32+y*7+(P-D)]=T&1,T=T>>1,D++}})}}).add([66,18,48],(a,l,i)=>{p(0,a)}).add([66,18,49],(a,l,i)=>{p(1,a)}).add([66,18,50],(a,l,i)=>{p(2,a)}).add([66,18,51],(a,l,i)=>{p(3,a)}).add([66,18,52],(a,l,i)=>{p(4,a)}).add([66,18,53],(a,l,i)=>{p(5,a)}).add([66,18,54],(a,l,i)=>{p(6,a)}).add([66,18,55],(a,l,i)=>{p(7,a)}).add([66,52],(a,l)=>{e.switchMode("ns5r"),S(e,H,e.KARAOKE_NONE);let i="";be(a,(s,n)=>{n<8?(s>31&&(i+=String.fromCharCode(s)),n===7&&(e.aiEfxName=i)):n<10&&(e.setEffectType(n-8,44,s),e.dispatchEvent(`efx${["reverb","chorus"][n-8]}`,e.getEffectType(n-8)))})}).add([66,53],(a,l)=>{e.invokeSysExIndicator(),e.switchMode("ns5r"),S(e,H,e.KARAOKE_NONE);let i="",s=a[a.length-1],n=a.subarray(0,a.length-1),c=Ue(n);c!==s&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${c}, got ${s}.`),console.debug(a));let o=e.getTrackPort(l);if(t(e,W)[o]&&t(e,W)[o]!==w.ns5r)if(t(e,ke).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${l}. Port ${String.fromCharCode(65+o)} mode "${z[t(e,W)[o]]}" mismatch, should be "ns5r".`);return}else console.info(`Track ${l} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+o)}.`);e.setPortMode(o,2,w.ns5r),be(n,function(h,d){switch(!0){case d<2944:{let y=e.chRedir(Math.floor(d/92),l,!0),E=N[y];switch(d%92){case 0:{t(e,v)[E+C[0]]=h,e.pushChPrimitives(y),e.dispatchEvent("voice",{part:y});break}case 1:{t(e,v)[E+C[32]]=h,!h&&!t(e,v)[E+C[0]]&&(t(e,v)[E+C[0]]=bt.bank0),e.pushChPrimitives(y),e.dispatchEvent("voice",{part:y});break}case 2:{t(e,I)[y]=h,h>0&&e.setChActive(y,1),e.dispatchEvent("voice",{part:y});break}case 3:{let T=e.chRedir(h,l,!0);t(e,B)[y]=T,y!==T&&console.info(`NS5R CH${y+1} receives from CH${T+1}.`);break}case 7:{t(e,R)[y]=h,e.dispatchEvent("voice",{part:y});break}case 8:{t(e,A)[y*g.rpn+3]=h<40||h>88?h+(h>63?-192:64):h,t(e,L)[g.rpnt*y+2]=1,e.dispatchEvent("pitch",{part:y,pitch:e.getPitchShift(y)});break}case 9:case 10:{t(e,v)[E+C[7]]=h;break}case 11:{t(e,v)[E+C[11]]=h;break}case 14:{t(e,v)[E+C[10]]=h||128;break}case 19:{t(e,v)[E+C[93]]=h;break}case 20:{t(e,v)[E+C[91]]=h;break}case 84:{t(e,v)[E+C[65]]=h;break}case 85:{t(e,v)[E+C[5]]=h;break}}break}case d<3096:break;case d<3134:{let y=d-3096;y<8?(h>31&&(i+=String.fromCharCode(h)),y===7&&(e.aiEfxName=i)):y<10&&(e.setEffectType(y-8,44,h),e.dispatchEvent(`efx${["reverb","chorus"][y-8]}`,e.getEffectType(y-8)));break}case d<8566:break}}),e.buildRchTree()}).add([66,54],(a,l)=>{e.invokeSysExIndicator(),e.switchMode("ns5r");let i="",s=80,n=0,c=0,o="MSB	PRG	LSB	NME";be(a,function(h,d){let y=d%158;switch(!0){case y<10:{h>31&&(i+=String.fromCharCode(h));break}case y===10:break;case y===11:{s=h&127;break}case y===12:{c=h&127;break}case y===13:{o+=`
${s}	${n}	${c}	${i.trim().replace("Init Voice","")}`,n++,i="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(o),O()&&console.debug(o),e.forceVoiceRefresh()}).add([66,55],(a,l)=>{e.invokeSysExIndicator(),e.switchMode("ns5r");let i="",s=88,n=0,c=0,o="MSB	PRG	LSB	NME";be(a,function(h,d){let y=d%126;switch(!0){case y<10:{h>31&&(i+=String.fromCharCode(h));break}case y===11:break;case y===12:break;case y===13:{o+=`
${s}	${n}	${c}	${i.trim().replace("Init Combi","")}`,n++,i="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(o),O()&&console.debug(o),e.forceVoiceRefresh()}).add([66,125],(a,l,i)=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][a[0]]||"white")}).add([66,127],(a,l,i)=>{let s=a[a.length-1],n=a.subarray(0,a.length-1),c=Ue(n);c!==s&&(console.info(`NS5R screen dump checksum mismatch! Expected ${c}, got ${s}.`),console.debug(a));let o=new Uint8Array(5760);be(a,(h,d,y)=>{if(d<720)for(let E=0;E<8;E++)o[d*8+E]=h>>7-E&1}),e.dispatchEvent("screen",{type:"ns5r",data:o})}).add([76],(a,l,i)=>{t(e,$e).run([66,...a],l,i)}),t(this,Qe).add([16,0,8,0],(a,l,i)=>{let s=(a[2]<<4)+a[3],n="K11 ";([()=>{e.switchMode("k11",!0),e.setPortMode(e.getTrackPort(l),2,w.k11),S(e,H,e.KARAOKE_NONE),t(e,Y)[w.k11][1]=s?4:0,console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,s),console.debug(`${n}reverb type: ${s}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{console.debug(`${n}reverb time: ${s}`)},()=>{console.debug(`${n}reverb time: ${s}`)},()=>{console.debug(`${n}reverb predelay: ${s}`)},()=>{console.debug(`${n}reverb predelay: ${s}`)},()=>{console.debug(`${n}depth high: ${s}`)},()=>{console.debug(`${n}depth high: ${s}`)},()=>{console.debug(`${n}depth low: ${s}`)},()=>{console.debug(`${n}depth low: ${s}`)}][a[0]]||(()=>{}))()}).add([16,0,8,1],(a,l,i)=>{e.invokeSysExIndicator();let s=e.chRedir(a[1],l,!0),n=N[s],c=at[s],o=(a[3]<<4)+a[4],h=`GMega CH${s+1} `;([()=>{o<128?(e.setChType(s,e.CH_MELODIC,w.k11),t(e,v)[n+C[0]]=0,t(e,I)[s]=o):(e.setChType(s,e.CH_DRUMS,w.k11),t(e,I)[s]=o-128),e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{let d=e.chRedir(o,l,!0),y=t(e,B)[s];t(e,B)[s]=d,(s!==d||d!==y)&&(e.buildRchTree(),console.info(`${h}receives from CH${d+1}`))},()=>{t(e,v)[n+C[7]]=o},()=>{uupThis.setChActive(s,o)},()=>{t(e,v)[n+C[10]]=o},()=>{t(e,A)[c+3]=o+40,t(e,L)[g.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{t(e,A)[c+1]=o>>1,t(e,A)[c+2]=o&1,t(e,L)[g.rpnt*s+1]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{t(e,v)[n+C[91]]=o?127:0},()=>{},()=>{t(e,v)[n+C[74]]=o},()=>{t(e,v)[n+C[73]]=o},()=>{t(e,v)[n+C[72]]=o}][a[0]]||(()=>{}))()}).add([16,0,9,0],(a,l,i)=>{e.invokeSysExIndicator();let s=(a[2]<<4)+a[3],n="GMLX ";([()=>{console.debug(`${n}reverb type: ${s}`)},()=>{console.debug(`${n}reverb time: ${s}`)},()=>{console.debug(`${n}reverb predelay: ${s}`)},()=>{console.debug(`${n}depth high: ${s}`)},()=>{console.debug(`${n}depth low: ${s}`)}][a[0]]||(()=>{}))()}).add([16,0,9,3],(a,l,i)=>{e.invokeSysExIndicator();let s=(a[2]<<4)+a[3],n=e.chRedir(a[1],l,!0),c=N[n],o=`GMLX CH${n+1} `;[()=>{s<128?(e.setChType(n,e.CH_MELODIC,w.k11),t(e,v)[c+C[0]]=0,t(e,v)[c+C[32]]=0,t(e,I)[n]=s):s<160?(e.setChType(n,e.CH_MELODIC,w.k11),t(e,v)[c+C[0]]=0,t(e,v)[c+C[32]]=7,t(e,I)[n]=s-100):(e.setChType(n,e.CH_DRUMS,w.k11),t(e,v)[c+C[0]]=122,t(e,v)[c+C[32]]=0,t(e,I)[n]=s-160),e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n})},()=>{let h=e.chRedir(s,l,!0),d=t(e,B)[n];t(e,B)[n]=h,(n!==h||h!==d)&&(e.buildRchTree(),console.info(`${o}receives from CH${h+1}`))}][a[0]]()}).add([16,0,9,4],(a,l,i)=>{e.invokeSysExIndicator();let s=(a[2]<<4)+a[3],n=e.chRedir(a[1],l,!0),c=N[n],o=at[n];[()=>{e.setChActive(n,s)},()=>{t(e,v)[c+C[7]]=s},()=>{t(e,v)[c+C[10]]=s},()=>{t(e,v)[c+C[91]]=s?127:0},()=>{t(e,A)[o+3]=s+40,t(e,L)[g.rpnt*n+2]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{t(e,A)[o+1]=s,t(e,L)[g.rpnt*n+1]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{t(e,A)[o]=s,t(e,L)[g.rpnt*n]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{}][a[0]]()}),t(this,je).add([66,93,64],(a,l,i)=>{let s=a[2];switch(a[0]){case 0:{switch(a[1]){case 4:{e.invokeSysExIndicator(),S(e,K,s*129/16383*100),e.dispatchEvent("mastervolume",t(e,K));break}case 5:{e.invokeSysExIndicator(),s-64;break}case 6:{e.invokeSysExIndicator(),console.debug(`SG global reverb: ${s?"on":"off"}`);break}case 127:{e.switchMode("sg",!0),e.setPortMode(e.getTrackPort(l),1,w.sg);break}}break}case 1:{switch(a[1]){case 48:{e.invokeSysExIndicator(),console.debug(`SG reverb type: ${At[s]}`);break}}break}default:if(a[0]>>4===1){e.invokeSysExIndicator();let n=e.chRedir(a[0]&15,l,!0);if(a[1]===2){let c=e.chRedir(s,l,!0),o=t(e,B)[n];t(e,B)[n]=c,(n!==c||c!==o)&&(e.buildRchTree(),console.info(`SG CH${n+1} receives from CH${c+1}`))}else a[1]===19&&e.setChCc(n,7,s)}else console.warn(`Unknown AKAI SG SysEx: ${a}`)}}),t(this,Ze).add([9],(a,l,i)=>{e.invokeSysExIndicator(),console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremolo","phaser","rotary speaker","enhancer","flanger","EQ"][a[0]]||"off"}`)}),t(this,j).add([127,0],(a,l,i)=>{e.switchMode("motif");let s=new Uint8Array([127,1,...a]);t(e,j).run(s,l,i)}).add([127,1,0,0],(a,l,i)=>{e.switchMode("s90es");let s="S90/Motif ES system ",n=a[0];a.subarray(1).forEach((c,o)=>{([()=>{S(e,K,c*12900/16383),e.dispatchEvent("mastervolume",t(e,K))}][n+o]||(()=>{console.info(`Unrecognized ${s}ID: ${n+o}`)}))()})}).add([127,1,14],(a,l,i)=>{e.switchMode("s90es");let s="S90/Motif ES bulk header ",n=[];n[95]=(c,o,h)=>{console.debug(`${s}multi edit buffer: ${c[1]}`)},(n[a[0]]||(()=>{console.info(`Unrecognized ${s}ID: ${a[0]}.`)}))(a.subarray(1))}).add([127,1,15],(a,l,i)=>{e.switchMode("s90es");let s="S90/Motif ES bulk footer ",n=[];n[95]=(c,o,h)=>{console.debug(`${s}multi edit buffer: ${c[1]}`)},(n[a[0]]||(()=>{console.info(`Unrecognized ${s}ID: ${a[0]}.`)}))(a.subarray(1))}).add([127,1,54,1],(a,l,i)=>{e.switchMode("s90es");let s="S90/Motif ES reverb ",n=a[0];a.subarray(1).forEach((c,o)=>{([()=>{e.setEffectTypeRaw(0,!1,c&15|128)},()=>{e.setEffectTypeRaw(0,!0,c)}][n+o]||(()=>{}))()}),e.dispatchEvent("efxreverb",e.getEffectType(0))}).add([127,1,54,2],(a,l,i)=>{e.switchMode("s90es");let s="S90/Motif ES chorus ",n=a[0];a.subarray(1).forEach((c,o)=>{([()=>{e.setEffectTypeRaw(1,!1,c&15|128)},()=>{e.setEffectTypeRaw(1,!0,c)}][n+o]||(()=>{}))()}),e.dispatchEvent("efxchorus",e.getEffectType(1))}).add([127,1,54,3],(a,l,i)=>{e.switchMode("s90es");let s="S90/Motif ES insert 1 ",n=a[0];a.subarray(1).forEach((c,o)=>{([()=>{e.setEffectTypeRaw(3,!1,c&15|128)},()=>{e.setEffectTypeRaw(3,!0,c)}][n+o]||(()=>{}))()}),e.dispatchEvent("efxinsert0",e.getEffectType(3))}).add([127,1,54,4],(a,l,i)=>{e.switchMode("s90es");let s="S90/Motif ES insert 2 ",n=a[0];a.subarray(1).forEach((c,o)=>{([()=>{e.setEffectTypeRaw(4,!1,c&15|128)},()=>{e.setEffectTypeRaw(4,!0,c)}][n+o]||(()=>{}))()}),e.dispatchEvent("efxinsert1",e.getEffectType(4))}).add([127,1,54,16],(a,l,i)=>{e.switchMode("s90es");let s=a[0];a.subarray(1).forEach((n,c)=>{let h=`S90/Motif ES EQ${(c>>2)+1} `;([()=>{let d=n-64},()=>{let d=tt[n]},()=>{let d=n/10},()=>{let d=n}][s+c&3]||(()=>{}))()})}).add([127,1,54,17],(a,l,i)=>{e.switchMode("s90es");let s="S90/Motif ES variation ",n=a[0];a.subarray(1).forEach((c,o)=>{([()=>{e.setEffectTypeRaw(2,!1,c&15|128)},()=>{e.setEffectTypeRaw(2,!0,c)}][n+o]||(()=>{}))()}),e.dispatchEvent("efxdelay",e.getEffectType(2))}).add([127,1,55],(a,l,i)=>{e.invokeSysExIndicator(),e.switchMode("s90es");let s=e.getTrackPort(l);if(t(e,W)[s]&&t(e,W)[s]!==t(e,U).smotif)if(t(e,ke).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${l}. Port ${String.fromCharCode(65+s)} mode "${z[t(e,W)[s]]}" mismatch, should be "${z[t(e,U).smotif]}".`);return}else console.info(`Track ${l} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);let n=e.chRedir(a[0],l,!0),c=N[n],o=a[1];a[0]>15&&(n=a[0]+32);let h=`Track ${l} S90/Motif ES bulk CH${n<128?n+1:"U"+(n-127)} `;console.debug(h,a),!(a[0]>15)&&a.subarray(2).forEach((d,y)=>{([()=>{t(e,v)[c+C[0]]=d,e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n})},()=>{d&&e.setChActive(n,1),t(e,v)[c+C[32]]=d,e.getChPrimitive(n,1)===63&&e.setChType(n,[32,40].indexOf(d)>-1?e.CH_DRUMS:e.CH_MELODIC,t(e,_),!0),e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n})},()=>{d&&e.setChActive(n,1),t(e,I)[n]=d,e.dispatchEvent("voice",{part:n})},()=>{let E=e.chRedir(d,l,!0),T=t(e,B)[n];t(e,B)[n]=E,(n!==E||E!==T)&&(e.buildRchTree(),console.info(`${h}receives from CH${E+1}`))},()=>{t(e,ae)[n]=d?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{d!==100&&e.setChActive(n,1),t(e,v)[c+C[7]]=d},()=>{d!==64&&e.setChActive(n,1),t(e,v)[c+C[10]]=d},!1,!1,!1,()=>{t(e,v)[c+C[91]]=d},()=>{d&&e.setChActive(n,1),t(e,v)[c+C[93]]=d},()=>{d&&e.setChActive(n,1),t(e,v)[c+C[94]]=d},()=>{e.setChCc(n,128,d),d!==127&&(e.setChActive(n,1),e.allocateAce(n,128))},()=>{},()=>{d!==64&&e.setChActive(n,1),t(e,v)[c+C[74]]=d},()=>{d!==64&&e.setChActive(n,1),t(e,v)[c+C[71]]=d},!1,()=>{t(e,v)[c+C[65]]=d},()=>{t(e,v)[c+C[5]]=d},()=>{}][o+y]||(()=>{}))()})}),t(e,j).add([100,14],(a,l,i)=>{var n;e.switchMode("cs6x"),e.setPortMode(e.getTrackPort(l),1,w.cs6x);let s=(n=["normal voice","plugin voice PLG","drums",,"performance",,"phrase clip"][a[0]>>4])!=null?n:"invalid";a[0]&!0?s+=" edit buffer":a[0]>>4==1?s+=`${(a[0]&1)+1}`:s+=` ${["INT","EXT"][a[0]&1]}`,console.debug(`CS6x bulk dump for ${s} started.`)}).add([100,15],(a,l,i)=>{var n;e.switchMode("cs6x");let s=(n=["normal voice","plugin voice PLG","drums",,"performance",,"phrase clip"][a[0]>>4])!=null?n:"invalid";a[0]&!0?s+=" edit buffer":a[0]>>4==1?s+=`${(a[0]&1)+1}`:s+=` ${["INT","EXT"][a[0]&1]}`,console.debug(`CS6x bulk dump for ${s} ended.`)}).add([100,76,112],(a,l,i)=>{e.switchMode("cs6x");let s=0,n=a[0];a.subarray(1).forEach((c,o)=>{let h=o+n;h<10?(e.setChCvnRegister(s,o,c&127),t(e,he)[s]=1):h<12||h<13&&console.debug(`Plugin voice type: ${c}`)}),e.dispatchEvent("voice",{part:s})}).add([100,76,0],(a,l,i)=>{e.switchMode("cs6x"),e.setPortMode(e.getTrackPort(l),1,w.cs6x);let s=0,n=a[0];a.subarray(1).forEach((c,o)=>{let h=o+n;([()=>{e.setChCc(s,7,c),c!==100&&e.setChActive(s,1)},,,()=>{t(e,ae)[s]=c==0,e.setChCc(s,64,0),t(e,Q).ano(s),e.resetChAceAll(s)},,()=>{},,,()=>{e.setChCc(s,65,c?127:0)},()=>{e.setChCc(s,5,c)},,()=>{e.setChCc(s,91,c),c!==40&&e.setChActive(s,1)},()=>{e.setChCc(s,93,c),c&&e.setChActive(s,1)}][h]||(()=>{}))()})}).add([100,76,1],(a,l,i)=>{e.switchMode("cs6x");let s=0,n=a[0],c=!1;a.subarray(1).forEach((o,h)=>{let d=h+n;([()=>{e.setEffectTypeRaw(0,!1,o&15|128),c=!0},()=>{e.setEffectTypeRaw(0,!0,o),c=!0}][d]||(()=>{}))()}),c&&e.dispatchEvent("efxreverb",e.getEffectType(0))}).add([100,76,2],(a,l,i)=>{e.switchMode("cs6x");let s=0,n=a[0],c=!1;a.subarray(1).forEach((o,h)=>{let d=h+n;([()=>{e.setEffectTypeRaw(1,!1,o&15|128),c=!0},()=>{e.setEffectTypeRaw(1,!0,o),c=!0}][d]||(()=>{}))()}),c&&e.dispatchEvent("efxchorus",e.getEffectType(1))}).add([100,76,3],(a,l,i)=>{e.switchMode("cs6x");let s=0,n=a[0],c=!1;a.subarray(1).forEach((o,h)=>{let d=h+n;([()=>{e.setEffectTypeRaw(2,!1,o&15|128),c=!0},()=>{e.setEffectTypeRaw(2,!0,o),c=!0}][d]||(()=>{}))()}),c&&e.dispatchEvent("efxdelay",e.getEffectType(2))}).add([100,76,5],(a,l,i)=>{e.switchMode("cs6x")}).add([100,76,16],(a,l,i)=>{var o;e.switchMode("cs6x");let s=0,n=a[0],c=!1;if(a.subarray(1).forEach((h,d)=>{let y=d+n;([()=>{e.setChCc(s,0,h),c=!0},()=>{e.setChCc(s,32,h),c=!0,h&&e.setChActive(s,1)},()=>{t(e,I)[s]=h,c=!0,h&&e.setChActive(s,1)},()=>{t(e,L)[at[s]+mt[2]]=1,t(e,A)[at[s]+mt[2]]=h,h&&e.setChActive(s,1)}][y]||(()=>{}))()}),c){switch(e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s}),e.getChVoice(s).standard){case"DX":{t(e,re)[s]=e.EXT_DX;break}case"VL":{t(e,re)[s]=e.EXT_VL;break}}e.dispatchEvent("metacommit",{type:"OSysMeta",data:`CH${s+1} was renamed from "${(o=e.getVoice(...e.getChPrimitives(s,!0),e.getChMode(s)))==null?void 0:o.name}" to "${e.getChCvnString(s)}".`})}}).add([100,76,32],(a,l,i)=>{e.switchMode("cs6x");let s=0,n=a[0],c=t(e,re)[s];switch(c){case e.EXT_DX:{a.length>2&&console.debug(a),a.subarray(1).forEach((o,h)=>{let d=h+n;if(d<6){let y=d+142;e.setChCc(s,y,o),o!==64&&e.allocateAce(s,y)}else if(d<12){let y=d+144;e.setChCc(s,y,o),o!==64&&e.allocateAce(s,y)}else([()=>{},()=>{},()=>{},()=>{}][d]||(()=>{}))()});break}case e.EXT_VL:{console.info(`Support for Modular System Plug-in writes is not yet present for plugin type ${c}.`);break}default:console.warn(`Unsupported plug-in type: ${c}`)}}),t(this,ue).add([0,72,18,0,0,0,0],(a,l,i)=>{e.switchMode("sd",!0),e.setPortMode(e.getTrackPort(l),2,w.sd),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(a,l,i)=>{e.invokeSysExIndicator();let s=a[0]>>5,n=a[0]&31;switch(s){case 0:{let c=a[0]>>1,o=a[1];switch(c){case 1:{a.subarray(2).forEach((h,d,y)=>{let E=d+o;switch(E){case 0:{h&&(e.setEffectType(1,60,h-1),e.dispatchEvent("efxchorus",e.getEffectType(1)),console.debug(`SD MFX Cho: ${E} - ${h}`));break}}});break}case 2:{a.subarray(2).forEach((h,d)=>{let y=d+o;switch(y){case 0:{h&&(e.setEffectType(0,55+h,0),e.dispatchEvent("efxreverb",e.getEffectType(0)),console.debug(`SD MFX Rev: ${y} - ${h}`));break}}});break}case 3:case 4:case 5:{let h=c-1;a.subarray(2).forEach((d,y)=>{let E=y+o;switch(console.debug(`SD MFX ${h-2}: ${E} - ${d}`),E){case 0:{e.setEffectTypeRaw(h,62,d),e.dispatchEvent(`efx${h>2?"delay":"insert"+(h-4)}`,e.getEffectType(h));break}}}),console.debug(`SD MFX message:
%o`,a);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,a)}break}case 1:{let c=e.chRedir(n,l,!0),o=a[1],h=N[c];a.subarray(2).forEach((d,y)=>{let E=o+y;E<37?([()=>{},()=>{},0,()=>{},()=>{switch(d){case 104:case 105:case 106:case 107:case 120:{t(e,R)[c]||e.setChType(c,e.CH_DRUMS);break}default:t(e,R)[c]&&e.setChType(c,e.CH_MELODIC)}e.setChCc(c,0,d),e.pushChPrimitives(c),e.dispatchEvent("voice",{part:c})},()=>{t(e,v)[h+C[32]]=d,e.pushChPrimitives(c),e.dispatchEvent("voice",{part:c})},()=>{t(e,I)[c]=d,e.dispatchEvent("voice",{part:c})},()=>{t(e,v)[h+C[7]]=d},()=>{t(e,v)[h+C[10]]=d},()=>{},()=>{},()=>{d<2&&(t(e,ae)[c]=d)},()=>{d<2&&(t(e,v)[h+C[68]]=d?127:0)},()=>{},()=>{d<2&&(t(e,v)[h+C[65]]=d?127:0)},()=>{t(e,v)[h+C[5]]=d&15<<4|t(e,v)[h+C[5]]&15},()=>{t(e,v)[h+C[5]]=d&15|(t(e,v)[h+C[5]]&240)>>4},()=>{t(e,v)[h+C[74]]=d},()=>{t(e,v)[h+C[71]]=d},()=>{t(e,v)[h+C[73]]=d},()=>{t(e,v)[h+C[72]]=d},0,0,0,0,0,0,0,()=>{t(e,v)[h+C[128]]=d,e.allocateAce(128)},()=>{t(e,v)[h+C[93]]=d},()=>{t(e,v)[h+C[91]]=d},0,0,()=>{t(e,v)[h+C[75]]=d},()=>{t(e,v)[h+C[76]]=d},()=>{t(e,v)[h+C[77]]=d},()=>{t(e,v)[h+C[78]]=d}][E]||(()=>{}))():E<63||(E<64?(t(e,R)[c]?(t(e,v)[h+C[0]]=104|d,e.pushChPrimitives(c),e.dispatchEvent("voice",{part:c})):(t(e,v)[h+C[0]]=96|d,e.pushChPrimitives(c),e.dispatchEvent("voice",{part:c})),e.dispatchEvent("voice",{part:c})):console.debug(`Unknown SD-90 global CH${c+1} param setup message:
%o`,a))});break}case 2:{let c=e.chRedir(n,l,!0),o=a[1];console.debug(`Unknown SD-90 global CH${c+1} MIDI setup message:
%o`,a.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,a)}}),t(e,$e).add([0,1,73,78],(a,l,i)=>{e.switchMode("krs"),e.setPortMode(e.getTrackPort(l),1,w.krs),console.debug("Might be KORG KROSS 2 mode reset... Not sure.")}).add([0,1,73,117,2,37],(a,l,i)=>{e.switchMode("krs");let s=e.getTrackPort(l);if(t(e,W)[s]&&t(e,W)[s]!==w.krs)if(t(e,ke).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled. Port ${String.fromCharCode(65+s)} mode "${z[t(e,W)[s]]}" mismatch, should be "krs".`);return}else console.info(`Track ${l} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);e.setPortMode(e.getTrackPort(l),1,w.krs);let n="KROSS 2 BMT1 ",c="";be(a,(o,h)=>{if(h<24)c+=String.fromCharCode(Math.max(32,o));else if(!(h<1276)){let d=h-1276,y=e.chRedir(Math.floor(d/44),l,!0),E=d%44,T=N[y];E<15?([()=>{o&&e.setChActive(y,1),t(e,I)[y]=o,e.dispatchEvent("voice",{part:y})},()=>{o&&e.setChActive(y,1),o<10?(t(e,v)[T+C[0]]=63,t(e,v)[T+C[32]]=o):o<20?(t(e,v)[T+C[0]]=121,t(e,v)[T+C[32]]=o-10):o<24&&(t(e,v)[T+C[0]]=[120,0,56,62][o-20],t(e,v)[T+C[32]]=0),e.pushChPrimitives(y),e.dispatchEvent("voice",{part:y})},()=>{let D=e.chRedir(o&15,l,!0);t(e,B)[y]=D,console.info(`${n}CH${y+1} receives from CH${D+1}`)},!1,!1,()=>{t(e,v)[T+C[7]]=o},!1,()=>{},()=>{},!1,!1,!1,!1,!1,()=>{t(e,v)[T+C[10]]=o||128}][E]||(()=>{}))():E<36||([()=>{t(e,v)[T+C[74]]=(o+128&255)-64},()=>{t(e,v)[T+C[71]]=(o+128&255)-64},!1,!1,()=>{t(e,v)[T+C[73]]=(o+128&255)-64},()=>{t(e,v)[T+C[75]]=(o+128&255)-64},!1,()=>{t(e,v)[T+C[72]]=(o+128&255)-64}][E]||(()=>{}))()}}),c=c.trimRight(),e.dispatchEvent("metacommit",{type:"EORTitle",data:c})}),t(e,j).add([92,0,0],(a,l,i)=>{let s=a[0];a.subarray(1).forEach((n,c)=>{let o=c+s;o<2||([!1,!1,!1,!1,!1,!1,()=>{e.setChMode(n,w.an1x),e.pushChPrimitives(n),console.debug(`Yamaha AN1x slot 1 receives from CH${n+1}`)},()=>{e.setChMode(n,w.an1x),e.pushChPrimitives(n),console.debug(`Yamaha AN1x slot 2 receives from CH${n+1}.`)}][o-2]||(()=>{}))()})}),t(e,j).add([75,80,0],(a,l,i)=>{let s=a[0];a.subarray(1).forEach((n,c)=>{let o=c+s;([()=>{e.modelEx.cs1x.perfCh=n,e.pushChPrimitives(n),console.debug(`Yamaha CS1x performance on CH${n+1}.`)},!1,!1,!1,()=>{},!1,()=>{switch(n){case 1:{e.switchMode("xg",!0),e.setPortMode(e.getTrackPort(l),1,w.xg),console.debug("Yamaha CS1x set to XG mode.");break}case 3:{e.switchMode("cs1x",!0),e.setPortMode(e.getTrackPort(l),1,w.cs1x),console.debug("Yamaha CS1x set to performance mode.");break}default:console.warn(`Unknown Yamaha CS1x mode: ${n}`)}},()=>{}][o]||(()=>{}))()})}).add([75,96,0],(a,l,i)=>{let s=a[0],n=!1,c=e.modelEx.cs1x.perfCh;a.subarray(1).forEach((o,h)=>{let d=h+s;d<8?(n=!0,t(e,he)[c]=1,e.setChCvnRegister(c,d,o)):d<48?([!1,()=>{e.setChCc(c,7,o)}][d]||(()=>{}))():d<80?([()=>{e.setEffectTypeRaw(0,!1,o)},()=>{e.setEffectTypeRaw(0,!0,o),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{e.setEffectTypeRaw(1,!1,o)},()=>{e.setEffectTypeRaw(1,!0,o),e.dispatchEvent("efxchorus",e.getEffectType(1))},()=>{e.setEffectTypeRaw(2,!1,o)},()=>{e.setEffectTypeRaw(2,!0,o),e.dispatchEvent("efxdelay",e.getEffectType(2))}][d-48]||(()=>{}))():O()&&console.debug(`Unknown CS1x effect register: ${d}.`)}),n&&(e.setChActive(c,1),e.pushChPrimitives(c))})}chRedir(e,r,f){let u=this;if(t(u,Le)[r])return(t(u,Le)[r]-1)*16+e;if(t(u,_)===w.sc||t(u,_)===w.sd){if(f===1)return e;let p=0,m=!0;for(;m;)t(u,Pe)[e+p]===0?(t(u,Pe)[e+p]=r,console.debug(`Assign track ${r} to channel ${e+p+1}.`),m=!1):t(this,Pe)[e+p]===r?m=!1:(p+=16,p>=128&&(p=0,m=!1));return e+p}else return e}getTrackPort(e){return this.chRedir(0,e,!0)>>4}forceVoiceRefresh(){for(let e=0;e<g.ch;e++)t(this,oe)[e]&&this.dispatchEvent("voice",{part:e})}buildRchTree(){let e=[];t(this,B).forEach((r,f)=>{var u;r<g.ch&&((u=e[r])!=null&&u.constructor||(e[r]=[]),e[r].push(f))}),S(this,Et,e)}buildRccMap(){let e=this;for(let r=0;r<g.ch;r++)t(e,Ye)[r]={};t(e,_e).forEach((r,f)=>{r&&(t(e,Ye)[Math.floor(f/g.redir)][r]=f%g.redir|128)}),O()&&console.debug(t(e,Ye))}invokeSysExIndicator(){this.dispatchEvent("mupromptex",t(this,lt))}getActive(){return t(this,oe)}getChActive(e){return t(this,oe)[e]}getCc(e){if(typeof e!="number"||e<0||e>=g.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let r=this,f=N[e];return t(r,v).subarray(f,f+g.cc)}getChCc(e,r){let f=this;if(Ne.indexOf(r)<0)throw new Error("CC number not accepted");return t(f,v)[N[e]+C[r]]}getChCcWritten(e,r){let f=this;if(Ne.indexOf(r)<0)throw new Error("CC number not accepted");return t(f,v)[g.chcc+N[e]+C[r]]}setChCc(e=0,r,f){let u=this;if(Ne.indexOf(r)<0)throw new Error("CC number not accepted");if((f==null?void 0:f.constructor)!==Number)throw new TypeError("Expected numbers for value");let p=f&255,m=N[e]+C[r];t(u,v)[m]=p,t(u,v)[m+g.chcc]=1,u.dispatchEvent("cc",{part:e,cc:r,data:p})}getCcAll(){return t(this,v).slice()}resetCc(e){let r=this,f=N[e]+g.chcc;t(r,v).fill(0,f,f+g.cc)}resetChCc(e,r,f){let u=this;f!=null&&f.constructor&&u.setChCc(e,r,f),t(u,v)[N[e]+C[r]+g.chcc]=0}resetCcAll(){t(this,v).fill(0,g.chcc,g.chcc<<1)}isChCcWritten(e,r){if(Ne.indexOf(r)<0)throw new Error("CC number not accepted");return t(upThis,v)[N[e]+C[r]+g.chcc]}getChSource(){return t(this,B)}getChType(){return t(this,R)}setChType(e,r,f=0,u=!1){r&=15;let p=this;f=f||p.getChModeId(e),t(p,R)[e]=r,r>0&&!u&&(p.setChCc(e,0,t(p,Y)[f][2]),p.pushChPrimitives(e))}setChActive(e,r=0){t(this,oe)[e]!==r&&this.dispatchEvent("channeltoggle",{part:e,active:r}),t(this,oe)[e]=r}getExt(e){let r=g.ext*e,f=t(this,re).subarray(r,r+g.ext),u=new Uint8Array(f.length);return u.set(f),u[1]=u[1]||t(this,$t),u}getPitch(){return t(this,Me)}getProgram(){return t(this,I)}getTexts(){return t(this,de).slice()}getVel(e){let r=new Map,f=this;return t(f,F).forEach(function(u,p){let m=u>>7,k=u&127;e===m&&t(f,q)[u]>0&&r.set(k,{v:t(f,q)[u],s:t(f,G)[p]})}),r}getBitmap(){return{bitmap:t(this,fe,xe),expire:t(this,ye)}}getLetter(){return{text:t(this,De),set:t(this,yt),expire:t(this,Ie)}}getMode(){return z[t(this,_)]}getMaster(){return{volume:t(this,K)}}getRawStrength(){let e=this;return t(this,F).forEach(function(r){let f=r>>7;t(e,q)[r]>t(e,Ce)[f]&&(t(e,Ce)[f]=t(e,q)[r])}),t(this,Ce)}getStrength(){let e=[],r=this;return this.getRawStrength().forEach(function(f,u){e[u]=Math.floor(f*r.getChCc(u,7)*r.getChCc(u,11)*t(r,K)/803288)}),e}getRpn(){return t(this,A)}getNrpn(){return t(this,rt)}getSubDb(){return self==null?void 0:self.structuredClone(t(this,Y))}getDetect(){return self==null?void 0:self.structuredClone(t(this,U))}getVoice(e,r,f,u="?"){var i;let p=this;(i=w[u])!=null&&i.constructor||(u="?");let m=w[u],k=e||t(p,Y)[m][0],$=r,a=f||t(p,Y)[m][1];k===bt.bank0&&(k=0),a===bt.bank0&&(a=0),u==="ns5r"&&k>0&&k<56&&(a=3);let l=p.userBank.get(k,$,a,u);if(u==="mt32"&&l.name.indexOf("MT-m:")===0){let s=parseInt(l.name.slice(5)),n=s*g.cmt,c="";t(p,Oe).subarray(n,n+10).forEach(h=>{h>31&&(c+=String.fromCharCode(h))});let o=`MSB	LSB	PRG	NME
49	127	${$}	${c}`;p.userBank.load(o,!0),l.name=c,l.ending=" "}return(l.ending!==" "||!l.name.length)&&(l=p.baseBank.get(k,$,a,u)),l}getChPrimitive(e,r,f){if(r>=g.vxPrim||(r==null?void 0:r.constructor)!==Number)throw new RangeError(`Invalid voice primitive component "${r}"`);if(typeof e!="number"||e<0||e>=g.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let u=this,p=t(u,I)[r<<g.chShift|e];switch(r){case 1:case 2:{u.getChCcWritten(e,[255,0,32][r])||(p=p||t(u,Y)[u.getChModeId(e)][r+2]),f&&(p=p||t(u,Y)[u.getChModeId(e)][r-1]),p===bt.bank0&&(p=0);break}}return p}getChPrimitives(e,r){let f=this,u=new Uint8Array(3);return u[1]=t(f,I)[e],u[0]=f.getChPrimitive(e,1,r),u[2]=f.getChPrimitive(e,2,r),u}pushChPrimitives(e){let r=this;t(r,I)[1<<g.chShift|e]=r.getChCc(e,0),t(r,I)[2<<g.chShift|e]=r.getChCc(e,32),r.dispatchEvent("voice",{part:e})}getChCvnBuffer(e,r=g.cvn){if(r>g.cvn||r<1)throw new RangeError("Invalid custom voice name buffer length");let f=kt[e];return t(this,Ge).subarray(f,f+r)}getChCvnRegister(e,r){if(r>=g.cvn||r<0)throw new RangeError("Invalid custom voice name register");return t(this,Ge)[kt[e]+r]}setChCvnRegister(e,r,f=32){if(r>=g.cvn||r<0)throw new RangeError("Invalid custom voice name register");t(this,Ge)[kt[e]+r]=Math.max(32,f&255)}getChCvnString(e,r){let f=Ba.decode(this.getChCvnBuffer(e));return r||(f=f.trimEnd()),f}getChVoice(e){let r=this,f=r.getVoice(...r.getChPrimitives(e),r.getChMode(e));if(t(r,he)[e]){let u="";switch(t(r,_)){case w.mt32:{t(r,ve).subarray(g.cmt*(e-1),g.cmt*(e-1)+10).forEach(p=>{u+=String.fromCharCode(Math.max(p,32))}),u=u.trimEnd();break}default:u=r.getChCvnString(e)}u.length&&(f.ending="~",f.name=u)}return f}getRawPitch(){return t(this,Me)}getPitchShift(e){let r=this,f=e*g.rpn,u=t(r,A)[f];return t(r,L)[e*g.rpnt]?u>>7&&(u-=256):t(r,_)===w.mt32&&(u=12),t(r,Me)[e]/8192*u+(t(r,A)[f+3]-64)+((t(r,A)[f+1]<<7)+t(r,A)[f+2]-8192)/8192}getEffectType(e=0){let r=3*e+1;return t(this,le).subarray(r,r+2)}getPolyState(e=0){return t(this,G)[e]}setEffectTypeRaw(e=0,r,f){let u=3*e;t(this,le)[u]=1,t(this,le)[u+1+ +r]=f}setEffectType(e=0,r,f){this.setEffectTypeRaw(e,!1,r),this.setEffectTypeRaw(e,!0,f)}getEffectSink(){return t(this,st)}setLetterDisplay(e,r,f=0,u=3200){let p=this,m;S(p,De," ".repeat(f)),e.forEach(k=>{S(p,De,t(p,De)+String.fromCharCode(k>31?k:32)),k<32&&(m=m||new Set,m.add(k))}),S(p,yt,Date.now()),S(p,Ie,Date.now()+u),p.dispatchEvent("letter"),m&&(m=Array.from(m),m.forEach((k,$,a)=>{a[$]=k.toString(16).padStart(2,"0")}),console.warn(`${r}${r?" ":""}invalid code point${m.length>1?"s":""}: 0x${m.join(", 0x")}`))}setDetectionTargets(e="?",r=0){let f=this,u=-1;switch(e.replaceAll(", ",",").split(",").forEach(p=>{p=p.toLowerCase();let m=z.indexOf(Ra[p]||p);O()&&console.debug(`Mapped mode "${p}" to ID "${m}".`),m>-1&&(u=m)}),O()&&console.debug(`Set detection target to ID "${u}".`),u>0&&(t(f,U).x5=82,t(f,U).ds=w.krs),u){case w["05rw"]:{t(f,U).x5=81;break}case w.s90es:t(f,U).ds=w.s90es,t(f,U).smotif=w.s90es;case w.motif:t(f,U).ds=w.motif,t(f,U).smotif=w.motif}}setGsTargets(e=!1,r=4){if(!r)r=e?3:4;else{if(r>4||r<0)throw new Error(`Invalid GS level ${r}`);if(e&&r>>1!==1)throw new Error(`Invalid SC level ${r}`)}let f=this;t(f,U)[e?"sc":"gs"]=r,t(f,Y)[w[e?"sc":"gs"]][1]=r,f.forceVoiceRefresh()}getConfigs(){return t(this,gt)}setDumpLimit(e){if(e>2||e<0)throw new RangeError("Invalid dump limit.");t(this,ke).dumpLimit=e}allocateAce(e=0,r){let f=this;if(!r||r<128&&r>95){console.warn(`cc${r} cannot be allocated as an active custom effect.`);return}let u=!0,p=0,m=g.ace*e;for(;u&&p<g.ace;)t(f,J)[p+m]===r?u=!1:t(f,J)[p+m]||(u=!1,t(f,J)[p+m]=r,console.debug(`Allocated cc${r} to ACE slot ${p} in CH${e+1}.`)),p++;p>=g.ace&&console.warn(`ACE slots are full in CH${e+1}.`)}allocateAceAll(e){let r=this;if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}for(let f=0;f<g.ch;f++){let u=!0,p=0,m=g.ace*f;for(;u&&p<g.ace;)t(r,J)[p+m]===e?u=!1:t(r,J)[p+m]||(u=!1,t(r,J)[p+m]=e),p++;p>=g.ace&&console.warn(`ACE slots are full in CH${f+1}.`)}}resetAce(){t(this,J).fill(0),console.info("All ACE slots have been reset.")}resetChAceAll(e=0){t(this,J).subarray(Ct[e],Ct[e]+g.ace).fill(0)}resetChAce(e=0,r){let f=!0,u=Ct[e],p=u+g.ace;for(;f&&u<p;)t(this,J)[u]===r&&(t(this,J)[u]=0,f=!1),u++;f&&O()&&console.debug(`No ACE slot was allocated to cc${r} in CH${e+1}.`)}getAce(){return t(this,J)}getChAce(e=0,r=0){if(r<0||r>=g.ace)throw new RangeError("No such ACE slot");let f=t(this,J)[g.ace*e+r];if(f){if(Ne.indexOf(f)>=0)return this.getChCc(e,f);throw new Error(`Invalid ACE source in CH${e+1}: ${f}`)}else return 0}initDrums(){let e=this;t(e,ie).fill(64);for(let r=0;r<g.drm;r++){let f=r*g.dpn;for(let u in la){let p=la[u],m=(f+ge[u])*g.dnc;t(e,ie).subarray(m,m+g.dnc).fill(p)}}}init(e=0){let r=this;S(r,Xe,0),t(r,Y)[w.xg][1]=0,r.dispatchEvent("banklevel",{mode:"xg",data:0}),t(r,oe).fill(0),t(r,v).fill(0),t(r,J).fill(0),t(r,I).fill(0),t(r,q).fill(0),t(r,F).fill(0),t(r,G).fill(0),t(r,ae).fill(0),t(r,Ce).fill(0),t(r,Me).fill(0),t(r,rt).fill(0),t(r,L).fill(0),t(r,re).fill(0),t(r,W).fill(0),t(r,it).fill(0),t(r,He).fill(0),t(r,_e).fill(0),S(r,K,100),S(r,de,[]),S(r,ct,500),S(r,Ke,0),S(r,Ve,0),S(r,Fe,!1),S(r,ye,0),S(r,te,0),t(r,fe,xe).fill(0),S(r,H,r.KARAOKE_NONE),S(r,ot,0),S(r,we,!0),S(r,V,!1),S(r,lt,0),r.initDrums(),r.polyIndexLatest=0,r.polyIndexLast=0,t(r,B).forEach(function(f,u,p){p[u]=u}),e===0&&(r.dispatchEvent("mode","?"),S(r,_,0),t(r,Pe).fill(0),t(r,Le).fill(0),S(r,Ie,0),S(r,De,"")),Oa.forEach(f=>{r.setChCc(f,0,t(r,Y)[r.getChModeId(f)][2])}),t(r,R).fill(r.CH_MELODIC),t(r,R)[9]=r.CH_DRUM1,t(r,R)[25]=r.CH_DRUM3,t(r,R)[41]=r.CH_DRUMS,t(r,R)[57]=r.CH_DRUMS,t(r,R)[73]=r.CH_DRUM5,t(r,R)[89]=r.CH_DRUM7,t(r,R)[105]=r.CH_DRUMS,t(r,R)[121]=r.CH_DRUMS;for(let f=0;f<g.drm;f++)t(r,Ee)[f<<1]=0,t(r,Ee)[f<<1|1]=g.invalidCh;t(r,nt).fill(0),t(r,Oe).fill(0),t(r,Ae).fill(0),t(r,ve).fill(0),t(r,he).fill(0),t(r,Ge).fill(32),t(r,le).fill(0),t(r,st).fill(0),r.aiEfxName="",r.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),r.modelEx.sc.showBar=!0,r.modelEx.sc.invBar=!1,r.modelEx.sc.invDisp=!1,r.modelEx.sc.peakHold=1,r.modelEx.cs1x.perfCh=0;for(let f=0;f<g.ch;f++){let u=N[f];t(r,v)[u+C[7]]=100,t(r,v)[u+C[11]]=127,t(r,v)[u+C[2]]=127,t(r,v)[u+C[10]]=64,t(r,v).subarray(u+C[71],u+C[71]+8).fill(64),t(r,v)[u+C[128]]=127,t(r,v).subarray(u+C[130],u+C[157]+1).fill(64),t(r,v)[u+C[91]]=40,t(r,v)[u+C[101]]=127,t(r,v)[u+C[100]]=127,t(r,v)[u+C[99]]=127,t(r,v)[u+C[98]]=127;let p=f*g.rpn;t(r,A)[p]=2,t(r,A)[p+1]=64,t(r,A)[p+2]=0,t(r,A)[p+3]=64,t(r,A)[p+4]=0,t(r,A)[p+5]=0;let m=f*g.ext;t(r,re)[m+1]=r.VLBC_BRTHEXPR;let k=f*g.redir;t(r,_e)[k+8]=13}r.buildRchTree(),r.buildRccMap(),r.dispatchEvent("mastervolume",t(r,K)),r.dispatchEvent("efxreverb",r.getEffectType(0)),r.dispatchEvent("efxchorus",r.getEffectType(1)),r.dispatchEvent("efxdelay",r.getEffectType(2)),r.dispatchEvent("efxinsert0",r.getEffectType(3)),r.dispatchEvent("efxinsert1",r.getEffectType(4)),r.dispatchEvent("efxinsert2",r.getEffectType(5)),r.dispatchEvent("efxinsert3",r.getEffectType(6)),r.dispatchEvent("reset"),r.switchMode("?")}setChMode(e,r){let f=this;if(typeof e!="number"||e<0||e>=g.ch)throw new RangeError(`Invalid part number: CH${e+1}`);if(e<0||r>=z.length)throw new RangeError(`Invalid mode ID ${r}`);t(f,He)[e]=r,f.dispatchEvent("chmode",{part:e,id:r,mode:z[r]}),f.dispatchEvent("voice",{part:e})}getChMode(e,r){return z[this.getChModeId(e,r)]}getChModeId(e,r){return r?t(this,He)[e]||t(this,W)[e>>4]:t(this,He)[e]||t(this,W)[e>>4]||t(this,_)}setPortMode(e,r,f){let u=this;if(e<0||e>=g.ch>>4)throw new RangeError(`Invalid port ${e+1}`);if(r<1)throw new RangeError("Range must be a positive integer");if(e+r>=g.ch>>4)throw new RangeError("Range must be in bound");if(e<0||f>=z.length)throw new RangeError(`Invalid mode ID ${f}`);t(u,it)[e]=f;for(let p=e;p<e+r;p++){let m=t(u,it)[p];if(r>1&&m!==0&&m!==f)break;t(u,W)[p]=f;for(let k=p<<4;k<p+1<<4;k++)u.dispatchEvent("chmode",{part:k,id:f,mode:z[f]}),u.dispatchEvent("voice",{part:k})}}copyChSetup(e,r,f){if(e===r){console.warn(`Failed attempt at overwriting CH${e+1} with its own data.`);return}let u=this;if(f&&t(u,oe)[r]){console.warn(`Failed attempt at copying setup data from CH${e+1} to CH${r+1}.`);return}let p=N[e],m=N[r];t(u,I)[r]=t(u,I)[e],t(u,v).set(t(u,v).subarray(p,p+g.cc),m),u.pushChPrimitives(r)}setDrumFirstWrite(e,r){let f=this,u=t(f,R)[e];if(u<2)return;let p=u-2;if(t(f,Ee)[p<<1])if(r)t(f,Ee)[p<<1]=0,O()&&console.debug(`First write part for drum set ${p+1} has been reset.`);else return;else r?console.warn(`First write part for drum set ${p+1} is already blank.`):(t(f,Ee)[p<<1]=1,t(f,Ee)[p<<1|1]=e,console.debug(`First write part for drum set ${p+1} is set to CH${e+1}.`))}getChDrumFirstWrite(e){let r=this,f=t(r,R)[e];if(f<2)return;let u=f-2;return t(r,Ee).subarray(u<<1,u+1<<1)}getDrumFirstWrite(e){if(e>=0&&e<g.drm)return t(this,Ee).subarray(e<<1,e+1<<1)}switchMode(e,r=!1,f=!1){var m;let u=this,p=w[e];if(p>-1){if(t(u,_)===0||r){u.initOnReset&&r&&this.init(1),S(u,_,p),S(u,te,0);for(let $=0;$<g.ch;$++){let a=u.getChModeId($,!0);t(u,R)[$]>0&&a===w["?"]&&(u.setChCc($,0,t(u,Y)[p][2]),O()&&console.debug(`CH${$+1} (${t(u,R)[$]}) (${u.getChMode($)}), ${z[a]} (${t(u,Y)[a][2]}) -> ${z[p]} (${t(u,Y)[p][2]})`),u.pushChPrimitives($))}switch(p){case w.mt32:{Dt.forEach(($,a)=>{let l=a+1;t(u,oe)[l]||(t(u,I)[l]=$,u.setChCc(l,91,127),u.pushChPrimitives(l))});for(let $=1;$<10;$++)u.dispatchEvent("voice",{part:$});break}}let k;switch(p){case w["?"]:case w.g2:{k=[52,4,52,18,0,255,0,255];break}case w.xg:case w.cs1x:{k=[1,0,65,0,5,0,64,0];break}case w.gm:case w.gs:case w.sc:{k=[40,4,40,18,40,32,32,0];break}case w.sd:{k=[58,0,60,0,61,0,61,0];break}case w["05rw"]:case w.x5d:case w.ns5r:{k=[44,1,44,19,0,255,0,255];break}case w.k11:case w.sg:{k=[24,0,0,255,0,255,0,255];break}case w.mt32:{k=[40,4,0,255,0,255,0,255];break}case w.doc:{k=[24,16,0,255,0,255,0,255];break}case w.motif:case w.s90es:case w.cs6x:{k=[129,0,133,0,130,0,0,0];break}default:k=[0,0,0,0,0,0,0,0]}for(let $=0;$<g.efx;$++)!t(u,le)[3*$]&&((m=k[$<<1])!=null&&m.constructor)&&(t(u,le)[3*$+1]=k[2*$],t(u,le)[3*$+2]=k[2*$+1],u.dispatchEvent(`efx${["reverb","chorus","delay","insert0"][$]}`,u.getEffectType($)));f&&u.setDetectionTargets(e),u.dispatchEvent("mode",e),u.forceVoiceRefresh()}}else throw new Error(`Unknown mode ${e}`)}newStrength(){t(this,Ce).fill(0)}runJson(e){var r;if(e.type>14)return e.type===15&&e.data.constructor!==Uint8Array&&(e.data=Uint8Array.from(e.data)),t(this,vt)[e.type].call(this,e);{let f=this.chRedir(e.part,e.track),u=!1;(r=t(this,Et)[f])==null||r.forEach(p=>{e.channel=p,u=!0,t(this,vt)[e.type].call(this,e)}),u||console.warn(`${na[e.type]?na[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!==void 0?e.data[0]:e.data).toString():""} event sent to CH${f+1} without any recipient.`)}t(this,de).length>100&&t(this,de).splice(100,t(this,de).length-99)}runRaw(e){}async loadBank(e,r){let f=this;switch(e=e.toLowerCase(),e){case"s7e":{f.userBank.clearRange({msb:63,lsb:[21,22]}),f.userBank.clearRange({msb:63,lsb:[24,27]});break}case"pcg":{f.userBank.clearRange({msb:63,lsb:[6,9]}),f.userBank.clearRange({msb:63,lsb:[13,16]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":case"pcg":{ft.context=this,await f.userBank.load(await ft.read(e,r),!1);break}}f.forceVoiceRefresh()}},_=new WeakMap,te=new WeakMap,ye=new WeakMap,Te=new WeakMap,fe=new WeakSet,xe=function(){return t(this,Te)[t(this,te)]},ua=function(e){t(this,Te)[t(this,te)]=e},oe=new WeakMap,B=new WeakMap,R=new WeakMap,v=new WeakMap,J=new WeakMap,I=new WeakMap,q=new WeakMap,ae=new WeakMap,F=new WeakMap,G=new WeakMap,Me=new WeakMap,Ce=new WeakMap,Be=new WeakMap,re=new WeakMap,A=new WeakMap,L=new WeakMap,rt=new WeakMap,ie=new WeakMap,Ee=new WeakMap,le=new WeakMap,st=new WeakMap,_e=new WeakMap,W=new WeakMap,it=new WeakMap,He=new WeakMap,he=new WeakMap,Ge=new WeakMap,Ae=new WeakMap,ve=new WeakMap,nt=new WeakMap,Oe=new WeakMap,Y=new WeakMap,U=new WeakMap,ke=new WeakMap,gt=new WeakMap,K=new WeakMap,Xe=new WeakMap,ct=new WeakMap,Ke=new WeakMap,Ve=new WeakMap,wt=new WeakMap,Fe=new WeakMap,De=new WeakMap,Ie=new WeakMap,yt=new WeakMap,ot=new WeakMap,we=new WeakMap,H=new WeakMap,$t=new WeakMap,Et=new WeakMap,V=new WeakMap,lt=new WeakMap,Ye=new WeakMap,de=new WeakMap,Pe=new WeakMap,Le=new WeakMap,se=new WeakMap,ze=new WeakMap,Q=new WeakMap,vt=new WeakMap,St=new WeakMap,We=new WeakMap,qe=new WeakMap,j=new WeakMap,ue=new WeakMap,$e=new WeakMap,Qe=new WeakMap,je=new WeakMap,Ze=new WeakMap,ha);export{Or as OctaviaDevice,g as allocated,C as ccToPos,ge as dnToPos,O as getDebugState,bt as overrides};
