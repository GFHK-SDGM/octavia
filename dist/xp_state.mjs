var Wt=Object.defineProperty;var qt=(y,e,r)=>e in y?Wt(y,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):y[e]=r;var T=(y,e,r)=>(qt(y,typeof e!="symbol"?e+"":e,r),r),mt=(y,e,r)=>{if(!e.has(y))throw TypeError("Cannot "+r)};var t=(y,e,r)=>(mt(y,e,"read from private field"),r?r.call(y):e.get(y)),C=(y,e,r)=>{if(e.has(y))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(y):e.set(y,r)},x=(y,e,r,h)=>(mt(y,e,"write to private field"),h?h.call(y,r):e.set(y,r),r);(function(){var y=function(k,M,a){var c,d;if(self.MessageEvent)switch(k){case"message":{d=new MessageEvent(k,{data:M,ports:a==null?void 0:a.ports}),Object.defineProperty(d,"source",{value:a==null?void 0:a.source});break}default:d=new Event(k)}else d=document.createEvent("Event"),d.initEvent(k,!1,!1),a&&k=="message"&&(d.data=M,a.source&&Object.defineProperty(d,"source",{value:a.source}),(c=a.ports)!=null&&c.length&&Object.defineProperty(d,"ports",{value:a.ports}));return d};self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),r=[],h={},u=function(k){var M,a=this;if((this==null?void 0:this.constructor)!=u)throw new TypeError("Illegal constructor");r.push(this),(M=h[k])!=null&&M.constructor||(h[k]=[]),h[k].push(this);var c=Math.floor(Math.random()*281474976710656),d=[],s=0,i=[],o=!0,n=!1;Object.defineProperty(this,"id",{get:function(){return c}}),Object.defineProperty(this,"name",{value:k}),this.close=function(){var l,m=r.indexOf(a);m>-1?(e.postMessage({t:"d",c:k,i:c}),r.splice(m,1),(l=h[k])!=null&&l.constructor&&(m=h[k].indexOf(a),m>-1&&h[k].splice(m,1)),h[k].length||delete h[k],console.debug("[Snowy] BroadcastChannel closed."),n=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(l){if(e){if(n)throw new Error("Channel already closed");e.postMessage({t:"m",c:k,i:c,m:s,d:l}),s++,s>4294967295&&(s=0)}else i.push(l),console.debug("[Snowy] Message is cached.")},this.flush=function(){if(e){if(o){for(e.postMessage({t:"r",c:k,i:c}),console.debug("[Snowy] ".concat(i.length," message(s) in cache."));i.length;){var l=i.shift();a.postMessage(l)}o=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(l){l.c==k?l.i!=c&&a.dispatchEvent(y("message",l.d,{source:a})):console.debug("[Snowy] Channel ID mismatch. Instance ".concat(c," receives from ").concat(k,", not ").concat(l.c,"."))};var f={};this.dispatchEvent=function(l){var m,$;if(Object.defineProperty(l,"target",{value:a}),Object.defineProperty(l,"currentTarget",{value:a}),(m=f[l.type])!=null&&m.length)for(var S=f[l.type],L=0;L<S.length;L++)(($=S[L])==null?void 0:$.constructor)==Function&&S[L].call(a,l);a["on".concat(l.type)]&&a["on".concat(l.type)].constructor==Function&&a["on".concat(l.type)].call(a,l)},this.addEventListener=function(l,m){var $;($=f[l])!=null&&$.constructor||(f[l]=[]);var S=f[l].indexOf(m);S==-1&&f[l].push(m)},this.removeEventListener=function(l,m){var $,S;if(($=f[l])!=null&&$.length){var L=f[l].indexOf(m);L>-1&&f[l].splice(L,1)}!((S=f[l])!=null&&S.length)&&f[l].constructor&&delete f[l]}},self.BroadcastChannel=u,b=function(){if(e){e.addEventListener("message",function(M){var a=M.data,c=!1;switch(a.t){case"k":{c=!1,e.postMessage({t:"k"});break}case"m":{var d=h[a.c];if(d!=null&&d.length)for(var s=0;s<d.length;s++)d[s].receiveMessage(a);break}case"c":{for(var i=[],o=0;o<r.length;o++){var n=r[o].name;i.indexOf(n)<0&&i.push(n)}e.postMessage({t:"k",c:i});break}default:c=!0}c&&console.info("ReceiveBroadcast",a)});for(var k=0;k<r.length;k++)r[k].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},v=function(){if(!e){var k=new SharedWorker(self.SNOWY_PATH||"/snowy.js");k.port.start();var M=function(a){a.data.t=="swc"&&(k.port.removeEventListener("message",M),e=k.port,e.postMessage({t:"k"}),b())};k.port.addEventListener("message",M)}},v());var e,r,h,u,b,v})();{let y=function(e,r){let h=new FileReader;return new Promise((u,b)=>{switch(h.addEventListener("abort",()=>{b(new Error("Blob read aborted"))}),h.addEventListener("error",v=>{b(h.error||v.data||new Error("Blob read error"))}),h.addEventListener("load",()=>{u(h.result)}),r.toLowerCase()){case"arraybuffer":case"buffer":{h.readAsArrayBuffer(e);break}case"string":case"text":{h.readAsText(e);break}default:b(new Error(`Unknown target ${r}`))}})};Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||function(){return y(this,"buffer")},Blob.prototype.text=Blob.prototype.text||function(){return y(this,"text")}}String.prototype.replaceAll=String.prototype.replaceAll||function(y,e){let r=0,h=16,u=this,b=[];for(;r<h&&u.lastIndexOf(y)>-1;){let v=u.lastIndexOf(y);b.unshift(u.slice(v+y.length)),u=u.slice(0,v),v==0&&b.unshift(""),r++}return u.length&&b.unshift(u),b.join(e)||""},String.prototype.padStart=String.prototype.padStart||function(y,e){if(e){let r=this;for(;r.length<y;)r=`${e}${r}`;return r}},String.prototype.padEnd=String.prototype.padEnd||function(y,e){if(e){let r=this;for(;r.length<y;)r+=e;return r}};var $t=function(y,e){let r=Math.min(y.length,e.length),h=y.slice(0,r),u=e.slice(0,r),b=0,v=0;for(;v<r&&b==0;)b=Math.sign(h[v]-u[v]),v++;return b},oe=function(y=""){this.name=y,this.pool=[],this.point=function(e,r=!1){if(this.pool.length>0){let h=this.pool.length,u=1<<Math.floor(Math.log2(h)),b=u,v=64;for(;u>=1&&v>=0;){if(v<=0)throw new Error("TTL reached.");if(b==h)b-=u;else{let M=$t(e,this.pool[b]);switch(M){case 0:{v=0;break}case 1:{b+u<=h&&(b+=u);break}case-1:{b!=0&&(b-=u);break}default:console.warn(`Unexpected result ${M}.`)}}u=u>>1,v--}let k=!0;if(b>=this.pool.length)k=!1;else{let M=this;this.pool[b].forEach(function(a,c,d){k&&a!=e[c]&&(k=!1)}),!k&&$t(e,this.pool[b])>0&&b++}return k||r?b:-1}else return r?0:-1},this.add=function(e,r){return e.data=r,this.pool.splice(this.point(e,!0),0,e),this},this.default=function(e){console.warn(`No match in "${this.name||"(unknown)"}" for "${e}". Default action not defined.`)},this.get=function(e){let r=this.point(e);if(r>-1)return this.pool[r].data;this.default(e)},this.run=function(e,...r){let h=this.point(e);h>-1?e.subarray?this.pool[h].data(e.subarray(this.pool[h].length),...r):this.pool[h].data(e.slice(this.pool[h].length),...r):this.default(e,...r)}};var J,vt,wt=(vt=class{constructor(){C(this,J,{})}addEventListener(y,e){t(this,J)[y]||(t(this,J)[y]=[]),t(this,J)[y].unshift(e)}removeEventListener(y,e){if(t(this,J)[y]){let r=t(this,J)[y].indexOf(e);r>-1&&t(this,J)[y].splice(r,1),t(this,J)[y].length<1&&delete t(this,J)[y]}}dispatchEvent(y,e){var u;let r=new Event(y),h=this;r.data=e,((u=t(this,J)[y])==null?void 0:u.length)>0&&t(this,J)[y].forEach(function(b){try{b==null||b.call(h,r)}catch(v){console.error(v)}}),this[`on${y}`]&&this[`on${y}`](r)}},J=new WeakMap,vt);var Qt=["MSB","PRG","LSB","NME","ELC","DRM"],ht=function(y){let e=Math.floor(y/10),r=y%10;return`${e.toString(16)}${r}`},Y,kt,ut=(kt=class{constructor(...y){C(this,Y,void 0);T(this,"strictMode",!1);this.loadFiles(...y)}get(y=0,e=0,r=0,h){var m,$;let u=[y,e,r],b,v=1,k=0,M,a=Array.from(arguments);switch(h){case"xg":{switch(y){case 0:{r==126?a[2]=125:r==127&&(a[2]=0);break}case 16:{r==126&&(a[2]=0);break}case 32:{r>125&&(a[2]=0),a[2]+=4;break}case 33:case 34:case 35:case 36:{r>125&&(a[2]=0),a[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:a[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{r==126&&(a[2]=0);break}case 48:case 64:case 126:case 127:{r==126&&(a[2]=0);break}}break}case"gs":case"sc":{y==0&&r<5?a[2]=0:y>125&&r<5&&r!=2&&(a[2]=y,a[0]=0);break}case"g2":case"sd":{y>>1==40?a[2]|=16:y>95&&y<100&&(a[2]|=16,e>>4==7&&(a[0]=96));break}case"sg":{y==8&&r==0&&(a[2]=5);break}case"s90es":{r<8?a[2]+=17:r<32?a[2]+=13:a[2]=(a[2]>>3)+19;break}case"motif":{r<8?a[2]+=28:r<32?a[2]+=13:a[2]=(a[2]>>3)+19;break}}let c=" ",d="M",s="",i=0,o=0;switch(a[0]){case 0:{switch(a[2]){case 127:{h=="xg"?d="GM-a":(d="MT-a",s="C/M");break}case 126:{h=="xg"?d="GM-n":(d="MT-b",s="C/M");break}case 7:{d="GM-k",s="GLX";break}case 5:{d="SG-a",s="000";break}case 4:{h=="gs"||h=="sc"?(d="GM-a",s="000"):(d="SP-l",s="C/M");break}case 3:case 2:case 1:{(h=="gs"||h=="sc")&&(d="GM-a",s="000");break}case 0:{d="GM-a";break}default:d="y",i=3}break}case 8:{h=="sg"?d="GM-s":d="r:";break}case 32:case 33:case 34:case 35:case 36:{h=="xg"&&(d=`${["AP","VL","PF","DX","AN"][y&7]}-${"abcdefgh"[r]}`,i=3);break}case 48:{s=`M${(a[2]>>3).toString().padStart(2,"0")}`,d=`y${s}`,i=1;break}case 56:{d="GM-b";break}case 57:d=["yDOC","QY10","QY20"][a[2]-112]||"yMxv",s=["DOC","QY1","QY2"][a[2]-112]||"057";case 61:case 120:{d="rDrm";break}case 62:{d="kDrm";break}case 63:{if(a[2]<17){let S=a[2];d=S<10?"kP:":"kC:",d+=S%10}else a[2]<34?d=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][a[2]-17]:d="Ds";i=1;break}case 64:{d="ySFX",s="SFX";break}case 67:{d="DX:S";break}case 80:case 81:case 82:case 83:{d=`Prg${"UABC"[a[0]-80]}`;break}case 88:case 89:case 90:case 91:{d=`Cmb${"UABC"[a[0]-88]}`;break}case 95:{d=`${["DR","PC"][a[2]]}-d`;break}case 96:{d=a[2]==106?"AP-a":a[2]>>4==1?"SDg":"PF",a[2]>63?o=63:a[2]>>4==1&&(o=16),i=3;break}case 97:{d=a[2]>>4==1?"SDa":"VL:",i=3,a[2]>>4==1?o=16:o=112;break}case 98:{d=a[2]>>4==1?"SDb":"SG-a",i=3,o=16;break}case 99:{d=a[2]>>4==1?"SDc":"DX",a[2]>63?o=63:a[2]>>4==1&&(o=16),i=3;break}case 100:{d="AN",a[2]>63?o=63:a[2]>>4==1&&(o=16),i=3;break}case 104:case 105:case 106:case 107:{d="SDd",o=104;break}case 121:{d=`GM-${a[2]?"":"a"}`,i=3;break}case 122:{d="lDrm";break}case 126:{d="yDrS";break}case 127:{a[2]==127?d="rDrm":d="yDrm";break}default:a[0]<48?d="r:":d="M"}d.length<4&&(d+=`${[y,r,a[0],a[2]][i]-o}`.padStart(4-d.length,"0")),s.length<3&&(s+=`${[y,r,y,r][i]}`.padStart(3-s.length,"0")),h=="xg"&&(y==0?a[2]<100?d=d.replace("y0","y:"):a[2]==125&&(d="y126"):y==16?(b=`Voice${((a[2]<<7)+a[1]+1).toString().padStart(3,"0")}`,c=" "):y==35&&r>>1==2&&(b=`DXCH_${(((a[2]&1)<<7)+e+1).toString().padStart(3,"0")}`,c=" "));let n=[a[0],a[1],a[2]];for(;!((b==null?void 0:b.length)>=0);)if(b=(m=t(this,Y)[a[1]||0][(a[0]<<7)+a[2]])==null?void 0:m.name,b){let S=t(this,Y)[a[1]||0][(a[0]<<7)+a[2]];v=(S==null?void 0:S.poly)||v,k=(S==null?void 0:S.type)||k,M=S==null?void 0:S.drum}else if(this.strictMode)b="",c="?";else if(a[0]==0&&a[1]==0&&a[2]==0)b="Unloaded";else if(t(this,Y)[a[1]||0][a[0]<<7])a[0]==0?(a[2]=0,c="^"):a[2]<1?(a[0]=0,c="*"):(a[2]--,c="^");else if(y==48)a[0]=0,a[2]=0,c="!";else if(y==62)a[1]--,c=" ",a[1]<1&&!(b!=null&&b.length)&&(a[0]=0,c="!");else if(y<63)a[0]==0?(a[2]=0,c="^"):a[2]<1?(a[0]=0,c="*"):a[2]--;else if(y==80)b=`PrgU:${e.toString().padStart(3,"0")}`,c="!";else if(y==88)b=`CmbU:${e.toString().padStart(3,"0")}`,c="!";else if(y==121)b=`GM2Vox0${r}`,c="#";else if(y==122){if(a[1]==32?a[1]==0:a[1]%=7,b=($=t(this,Y)[a[1]||0][(a[0]<<7)+a[2]])==null?void 0:$.name,b){c=" ";let S=t(this,Y)[a[1]||0][(a[0]<<7)+a[2]];v=(S==null?void 0:S.poly)||v,k=(S==null?void 0:S.type)||k,M=S==null?void 0:S.drum}else b="",c="*";}else a[1]==0?(b=`${y.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")} ${r.toString().padStart(3,"0")}`,c="!"):a[0]==0?(a[2]=0,c="^"):a[2]>0?a[2]--:a[1]>0?(a[1]=0,c="!"):(a[0]=0,c="?");let f=[a[0],a[1],a[2]];switch(c){case"^":{switch(h){case"gs":case"sc":case"ns5r":{c=" ";break}}y==127&&c=="^"&&(c=" ");break}}let l="??";switch(a[0]){case 0:{a[2]==0?l="GM":a[2]==5||a[2]==7?l="KG":a[2]<126?l="XG":a[2]==127&&(l="MT");break}case 32:case 33:case 35:case 36:{a[2]>4?l=["AP","VL","PF","DX","AN"][a[0]-32]:l="GS";break}case 48:{l="MU";break}case 56:{l="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{l="AI";break}case 62:case 82:case 90:{l="XD";break}case 63:{a[2]<17?l="KR":a[2]<34?l="ES":l="DS";break}case 64:case 126:{l="XG";break}case 67:case 99:{l=a[2]>>4==1?"SD":"DX";break}case 81:{l="RW";break}case 95:{l=["DR","PC"][a[2]];break}case 96:{l=a[2]==106?"AP":a[2]>>4==1?"SD":"PF";break}case 97:{l=a[2]>>4==1?"SD":"VL";break}case 98:{l=a[2]>>4==1?"SD":"SG";break}case 100:{l="AN";break}case 104:case 105:case 106:case 107:{l="SD";break}case 120:{l="GS";break}case 121:{l=a[2]?"G2":"GM";break}case 122:{l="KG";break}case 127:{l=a[2]==127?"MT":e==0?"GM":"XG";break}default:a[0]<48&&(a[0]==16&&h=="xg"?l="XG":l="GS")}return c!=" "&&(h=="krs"||self.debugMode)&&(b="",l="KR"),{name:b||`${ht(y||0)} ${ht(e||0)} ${ht(r||0)}`,poly:v,type:k,drum:M,iid:n,eid:f,sid:u,ending:c,sect:d,bank:s,standard:l,mode:h}}async load(y,e,r="(internal)"){let h=this,u=[],b=0,v=0;y.split(`
`).forEach(function(k,M){let a=k.split("\t"),c=[];if(M==0){if(a.forEach(function(d,s){u[Qt.indexOf(d)]=s}),u.length<4){console.debug("Debugger launched.");debugger}}else{let d=0,s=0,i=0,o,n=1,f=0,l;a.forEach(async function($,S){switch(S){case u[0]:{d=parseInt($);break}case u[1]:{s=parseInt($);break}case u[2]:{i=parseInt($);break}case u[3]:{o=$;break}case u[4]:{$=parseInt($),$<16?n=$+1:f=($&15)+1;break}case u[5]:{l=$;break}}}),t(h,Y)[s]=t(h,Y)[s]||[];let m=t(h,Y)[s];if(!m[d<<7|i]||e){let $={msb:d,prg:s,lsb:i,name:o,poly:n,type:f,drum:l};m[d<<7|i]=$,b++}v++}}),e||console.debug(`Map "${r}": ${v} total, ${b} loaded.`)}clearRange(y){let e=y.prg!=null?y.prg.constructor==Array?y.prg:[y.prg,y.prg]:[0,127],r=y.msb!=null?y.msb.constructor==Array?y.msb:[y.msb,y.msb]:[0,127],h=y.lsb!=null?y.lsb.constructor==Array?y.lsb:[y.lsb,y.lsb]:[0,127];for(let u=r[0];u<=r[1];u++){let b=u<<7;for(let v=h[0];v<=h[1];v++){let k=b+v;for(let M=e[0];M<=e[1];M++)delete t(this,Y)[M][k]}}}init(){x(this,Y,[]);for(let y=0;y<128;y++)t(this,Y).push([""])}async loadFiles(...y){this.init();let e=this;y.forEach(async function(r){try{await fetch(`./data/bank/${r}.tsv`).then(function(h){return h.text()}).then(h=>{e.load(h,!1,r)})}catch(h){console.error(`Failed loading "${r}.tsv".`)}})}},Y=new WeakMap,kt);var Ve,St,xt=(St=class{constructor(){C(this,Ve,{});T(this,"context")}set(y,e){t(this,Ve)[y]=e}has(y){return!!t(this,Ve)[y]}async read(y,e){if(!this.has(y))throw new Error(`No decoder registered for "${y}"`);return await t(this,Ve)[y].call(this.context||this,e)}},Ve=new WeakMap,St);var Yt=function(y,e){let r=!0;return e.forEach((h,u)=>{r=r&&y[u]==h}),r},je=function(y){let e=0;return y.forEach(r=>{e*=256,e+=r}),e},be=new TextDecoder,Je=new xt;Je.set("s7e",async function(y){let e=new Uint8Array(await y.slice(0,65536).arrayBuffer()),r="MSB\tLSB\tPRG\tNME",h=[0,0,0,0],u=32,b=0,v=0,k=!0,M=[],a=0;for(;k;){let c=e.subarray(b);([()=>{be.decode(c.subarray(0,4))=="YSFC"?(b+=80,v=1):b++},()=>{if(Yt(c.subarray(0,4),h))M.forEach((d,s,i)=>{let o=je(e.subarray(d.start+4,d.start+8));d.length=o}),v=2;else{let d=be.decode(c.subarray(0,4)),s=je(c.subarray(4,8));M.push({type:d,start:s}),b+=8}},()=>{let d=M[a],s=e.subarray(d.start,d.start+d.length),i=32;switch(d.type){case"ENVC":{let o=u;for(;o<s.length;){let n=s.subarray(o,o+i),f=be.decode(n.subarray(0,10)).trimEnd();f.slice(0,5)=="Init "&&(f=""),f&&(r+=`
063	${(n[17]+13).toString().padStart(3,"0")}	${n[19].toString().padStart(3,"0")}	${f}`),o+=i}break}case"EDVC":{let o=u;for(;o<s.length;){let n=s.subarray(o,o+i),f=be.decode(n.subarray(0,10)).trimEnd();f.slice(0,5)=="Init "&&(f=""),f&&(r+=`
063	024	${n[19].toString().padStart(3,"0")}	${f}`),o+=i}break}case"EPVC":{let o=32,n=u;for(;n<s.length;){let f=s.subarray(n,n+o),l=be.decode(f.subarray(0,10)).trimEnd();l=="----------"&&(l=""),l&&(r+=`
063	${(f[17]+1).toString().padStart(3,"0")}	${f[19].toString().padStart(3,"0")}	${l}`),n+=o}break}}a++,a>=M.length&&(v=3,k=!1)}][v]||(()=>{k=!1}))()}return r});Je.set("pcg",async function(y){let e=new Uint8Array(await y.arrayBuffer()),r="MSB\tLSB\tPRG\tNME",h=100,u=0,b=0,v=!0,k=[],M=0;for(;v;){let a=e.subarray(h);([()=>{v=be.decode(a.subarray(0,4))=="INI2",b=a[15],h+=16,u=1},()=>{let c=be.decode(a.subarray(0,4)),d=a[5],s=a[7],i=a[11],o=je(a.subarray(12,16)),n=je(a.subarray(16,20)),f=je(a.subarray(36,40)),l=be.decode(a.subarray(44,44+i));k.push({type:c,tipMsb:d,tipLsb:s,nameLen:i,length:o,start:n,entryLen:f,name:l}),h+=64,b--,b<1&&(u=2)},()=>{let c=k[M],d=e.subarray(c.start,c.start+c.length);switch(c.type){case"PRG1":break;case"PBK1":{let s=63,i=(c.tipMsb?6:0)+c.tipLsb;for(let o=0;o<128;o++){let n=o*c.entryLen,f=d.subarray(n,n+c.entryLen),l=be.decode(f.subarray(0,24)).trimEnd().replace("InitProg","");l.length&&i>5&&(r+=`
${s.toString().padStart(3,"0")}	${i.toString().padStart(3,"0")}	${o.toString().padStart(3,"0")}	${l}`)}break}case"CBK1":{let s=63,i=(c.tipMsb?3:0)+c.tipLsb+10;for(let o=0;o<128;o++){let n=o*c.entryLen,f=d.subarray(n,n+c.entryLen),l=be.decode(f.subarray(0,24)).trimEnd().replace("InitCombi","");l.length&&i>12&&(r+=`
${s.toString().padStart(3,"0")}	${i.toString().padStart(3,"0")}	${o.toString().padStart(3,"0")}	${l}`)}break}}M++,M>=k.length&&(u=3,v=!1)}][u]||(()=>{v=!1}))()}return r});var Ze=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),et=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],jt=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],Fe=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],Ct=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],Mt=function(y){let e=.1,r=-.3;return y>66?(e=5,r=315):y>56?(e=1,r=47):y>46&&(e=.5,r=18.5),e*y-r},Tt=function(y){return y>105?jt[y-106]:y>100?y*1.1-100:y/10},Rt=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),pt={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,うぃ
we,うぇ
wo,を
nga,ガ
ngi,ギ
ngu,グ
nge,ゲ
ngo,ゴ
ngy,ギ!
ng,
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,いぇ
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(y=>{let e=y.split(",");pt[e[0]]=e[1]});var Dt=function(y){let e=y;y[0]=="*"&&(e=e.slice(1)),["aa","ii","uu","ee","oo"].forEach(h=>{for(;e.indexOf(h)>-1;)e=e.replace(h,h[0])});for(let h in pt)e=e.replaceAll(h,pt[h]);e.indexOf("\u3093")==0&&e.length>1&&(e=e.slice(1));let r=e.indexOf("!");return r>-1&&e.length>1&&(e=e.slice(r+1)),e},Pt=function(y){return y?y<96?`cc${y}`:["aftertouch","velocity","pitch bend"][y-96]:"off"};var bt=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],Ot=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],At=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var Jt={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},Zt={66307:["drive"],66309:["vowel",y=>"aiueo"[y]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",y=>["off","LPF","HPF"][y]],94984:["noise type",y=>["white","pink"][y]],94987:["disc type",y=>["LP","SP","EP","RND"]],94990:["hum type",y=>`${y+5}0Hz`],94993:["M/S",y=>["mono","stereo"][y]]},gt=function(y){return Jt[(y[0]-32<<8)+y[1]]||`0x${y[0].toString(16).padStart(2,"0")}${y[1].toString(16).padStart(2,"0")}`},Lt=function(y,e,r){let h=(y[0]-32<<16)+(y[1]<<8)+e,u=Zt[h]||{},b=u[0];if(b!=null&&b.length)return b+=`: ${(u[1]||function(){})(r)||r}`,b},Et=[68,48,95,78,41,3,110,122,0];var Z=function(y=64){return Math.round(2e3*Math.log10(y/64))/100};var xe=function(y){let e=0;return y.forEach(r=>{e+=r,e=e&127}),~e+1&127},le=function(y,e){let r=0,h=0;for(let u=0;u<y.length;u++){let b=u%8-1,v=(h>>b&1)<<7,k=y[u];k+=v,u%8!=0?(e(k,r,y),r++):h=y[u]}};var tt=function(y){let e=Math.floor(y*14.2);return e<128?e:0},P=function(){return!!self.Bun||self.debugMode||!1};var z=["?","gm","gs","sc","xg","g2","mt32","doc","qy10","qy20","ns5r","x5d","05rw","k11","sg","sd","krs","s90es","motif","trin"],ea={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es",trinity:"trin","tr-rack":"trin"},ta=["melodic","drum","menu"],Ut={"?":[0,0,120],gm:[0,0,127],gs:[0,0,120],sc:[0,0,120],xg:[0,0,127],g2:[0,0,120],mt32:[0,127,127],doc:[57,112,127],qy10:[57,113,127],qy20:[57,114,127],ns5r:[0,0,61],x5d:[82,0,62],"05rw":[81,0,62],k11:[0,0,122],sg:[0,0,122],sd:[97,0,105],krs:[121,0,120],s90es:[0,0,127],motif:[0,0,127],trin:[0,0,127]},Ht=[9,25,41,57,73,89,105,121],aa=[0,3,81,84,88],Bt={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},It={0:0,1:1,2:3,5:4},Nt={0:0,1:1,2:2,5:3},Gt=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],_t=[36,37,48,49,52,53],ft=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],Xt={26:127,29:0,30:0,31:0,52:12,53:54},at=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,128,12,13,16,17,18,19,14,15,20,21,26,28,80,81,83,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],ra=[2,12,13,14,15,16,17,18,19,20,21,80,81,83,136,130,131,132,133,134,135,137,138,139,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],sa=[33,99,100,32,102,8,9,10],Vt=[0,16,25,40,32,64,26,48],w={};z.forEach((y,e)=>{w[y]=e});var E={length:at.length};at.forEach((y,e)=>{E[y]=e});var de={length:ft.length};ft.forEach((y,e)=>{de[y]=e});var ia={};ta.forEach((y,e)=>{ia[y]=e});var ca=function(y){let e=[],r=0;return y==null||y.forEach(function(h,u){h==247?e.push(y.subarray(r,u)):h==240&&(r=u+1)}),e.length||e.push(y.subarray(0)),P()&&console.debug(e),e};var Ft=8,g={port:Ft,ch:Ft<<4,cc:at.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,ace:8,drm:8,dpn:ft.length,dnc:128,ext:3,efx:7,cvn:12,redir:32,invalidCh:255},Oe={bank0:128},H,W,fe,we,ie,ve,zt,ce,X,D,p,q,O,V,ee,F,K,ke,ge,Ae,te,R,A,Ke,j,he,ae,ze,Le,G,Ce,ue,rt,Me,pe,We,Te,I,U,Ee,st,B,Ue,qe,Qe,Re,De,it,Ye,ye,N,lt,ct,He,re,Se,Pe,Q,Be,_,nt,dt,Ie,Ne,se,ne,me,Ge,_e,Xe,Kt,za=(Kt=class extends wt{constructor(){super();C(this,ie);T(this,"NOTE_IDLE",0);T(this,"NOTE_ATTACK",1);T(this,"NOTE_DECAY",2);T(this,"NOTE_SUSTAIN",3);T(this,"NOTE_HELD",4);T(this,"NOTE_RELEASE",5);T(this,"NOTE_SOSTENUTO_ATTACK",8);T(this,"NOTE_SOSTENUTO_DECAY",9);T(this,"NOTE_SOSTENUTO_SUSTAIN",10);T(this,"NOTE_SOSTENUTO_HELD",11);T(this,"CH_MELODIC",0);T(this,"CH_DRUMS",1);T(this,"CH_DRUM1",2);T(this,"CH_DRUM2",3);T(this,"CH_DRUM3",4);T(this,"CH_DRUM4",5);T(this,"CH_DRUM5",6);T(this,"CH_DRUM6",7);T(this,"CH_DRUM7",8);T(this,"CH_DRUM8",9);T(this,"DUMP_ALL",0);T(this,"DUMP_ONCE",1);T(this,"DUMP_MODE",2);T(this,"EXT_NONE",0);T(this,"EXT_VL",1);T(this,"EXT_DX",3);T(this,"VLBC_BRTHEXPR",1);T(this,"VLBC_VELOINIT",2);T(this,"VLBC_VELOALL",3);T(this,"CH_INACTIVE",0);T(this,"CH_ACTIVE",1);T(this,"CH_DISABLED",2);C(this,H,0);C(this,W,0);C(this,fe,0);C(this,we,new Array(11));C(this,ce,new Uint8Array(g.ch));C(this,X,new Uint8Array(g.ch));C(this,D,new Uint8Array(g.ch));C(this,p,new Uint8Array(g.ch*g.cc));C(this,q,new Uint8Array(g.ch*g.ace));C(this,O,new Uint8Array(g.ch));C(this,V,new Uint8Array(g.ch*g.nn));C(this,ee,new Uint8Array(g.ch));C(this,F,new Uint16Array(g.pl));C(this,K,new Uint8Array(g.pl));C(this,ke,new Int16Array(g.ch));C(this,ge,new Uint8Array(g.ch));C(this,Ae,new Uint8Array(g.ch));C(this,te,new Uint8Array(g.ch*g.ext));C(this,R,new Uint8Array(g.ch*g.rpn));C(this,A,new Uint8Array(g.ch*g.rpnt));C(this,Ke,new Int8Array(g.ch*_t.length));C(this,j,new Uint8Array(g.drm*g.dpn*g.dnc));C(this,he,new Uint8Array(g.drm*2));C(this,ae,new Uint8Array(g.efx*3));C(this,ze,new Uint8Array(g.ch));C(this,Le,new Uint8Array(g.ch*g.redir));C(this,G,new Uint8Array(g.port));C(this,Ce,new Uint8Array(g.ch));C(this,ue,new Uint8Array(g.ch));C(this,rt,new Uint8Array(g.ch*g.cvn));C(this,Me,new Uint8Array(128));C(this,pe,new Uint8Array(g.cmt*8));C(this,We,new Uint8Array(1024));C(this,Te,new Uint8Array(g.cmt*64));C(this,I,{});C(this,U,void 0);C(this,Ee,void 0);C(this,st,void 0);C(this,B,100);C(this,Ue,0);C(this,qe,500);C(this,Qe,0);C(this,Re,"");C(this,De,0);C(this,it,0);C(this,Ye,0);C(this,ye,!0);C(this,N,!1);C(this,lt,1);C(this,ct,void 0);C(this,He,new Array(g.ch));C(this,re,[]);C(this,Se,new Uint8Array(g.ch));C(this,Pe,new Uint8Array(g.tr));T(this,"baseBank",new ut("gm","gm2","xg","gs","ns5r","sd","gmega","plg-vl","plg-pf","plg-dx","plg-an","plg-dr","plg-sg","kross","s90es"));T(this,"userBank",new ut("gm"));T(this,"initOnReset",!1);T(this,"aiEfxName","");C(this,Q,[]);C(this,Be,void 0);C(this,_,{nOff:(e,r)=>{let h=e*128+r,u=t(this,F).lastIndexOf(h);if(u>-1)if(t(this,p)[g.cc*e+E[64]]>63)t(this,K)[u]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:r,velo:t(this,V)[h],state:this.NOTE_HELD});else if(t(this,p)[g.cc*e+E[66]]>63&&t(this,K)[u]==this.NOTE_SOSTENUTO_SUSTAIN)t(this,K)[u]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:r,velo:t(this,V)[h],state:this.NOTE_SOSTENUTO_HELD});else{t(this,F)[u]=0,t(this,V)[h]=0,t(this,K)[u]=this.NOTE_IDLE;let b=this.getExt(e)[1];(b==this.VLBC_VELOINIT||b==this.VLBC_VELOALL)&&(t(this,p)[g.cc*e+E[129]]=0),this.dispatchEvent("note",{part:e,note:r,velo:0,state:this.NOTE_IDLE})}},nOn:(e,r,h)=>{let u=e*128+r,b=0;for(t(this,ee)[e]&&t(this,_).ano(e);t(this,K)[b]>0&&t(this,F)[b]!=u;)b++;if(b<g.pl){t(this,F)[b]=u,t(this,V)[u]=h,t(this,K)[b]=this.NOTE_SUSTAIN,t(this,ge)[e]<h&&(t(this,ge)[e]=h);let v=this.getExt(e)[1];(v==this.VLBC_VELOINIT||v==this.VLBC_VELOALL)&&(t(this,p)[g.cc*e+E[129]]=h),this.dispatchEvent("note",{part:e,note:r,velo:h,state:this.NOTE_SUSTAIN})}else console.error("Polyphony exceeded.")},nAt:(e,r,h)=>{},cAt:(e,r)=>{},hoOf:e=>{t(this,K).forEach((r,h)=>{if(r==this.NOTE_HELD){let u=t(this,F)[h],b=u>>7;e==b&&(t(this,K)[h]=this.NOTE_IDLE,t(this,F)[h]=0,t(this,V)[u]=0,this.dispatchEvent("note",{part:e,note:u&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{t(this,K).forEach((r,h)=>{let u;switch(r){case this.NOTE_ATTACK:{u=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{u=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{u=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(u){t(this,K)[h]=u;let b=t(this,F)[h];this.dispatchEvent("note",{part:e,note:b&127,velo:t(this,V)[b],state:u})}})},soOf:e=>{t(this,K).forEach((r,h)=>{if(r==this.NOTE_SOSTENUTO_HELD){let u=t(this,F)[h],b=u>>7;e==b&&(t(this,K)[h]=this.NOTE_IDLE,t(this,F)[h]=0,t(this,V)[u]=0,this.dispatchEvent("note",{part:e,note:u&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{t(this,F).forEach((r,h,u)=>{let b=r>>7,v=r&127;r==0&&t(this,V)[0]==0||b==e&&t(this,_).nOff(b,v)})}});C(this,nt,{8:function(e){let r=e.channel,h=e.data[0];t(this,_).nOff(r,h)},9:function(e){let r=e.channel,h=this;if(h.getChModeId(r)==w.xg&&t(h,D)[r]>1){let v=h.getChDrumFirstWrite(r);v[0]&&v[1]!=g.invalidCh&&!t(h,ce)[r]&&(h.copyChSetup(v[1],r),h.dispatchEvent("voice",{part:r}),console.debug(`Part CH${r+1} copied from CH${v[1]}.`))}h.setChActive(r,1);let u=e.data[0],b=e.data[1];b>0?t(h,_).nOn(r,u,b):t(h,_).nOff(r,u)},10:function(e){let r=e.channel,h=r*128+e.data[0];t(this,F).indexOf(h)>-1&&(t(this,V)[h]=data[1],this.getExt(r)[1]==this.VLBC_VELOALL&&(t(this,p)[g.cc*r+E[129]]=data[1]),this.dispatchEvent("note",{part:r,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let r=e.channel,h=this,u=t(this,He)[r],b=u[e.data[0]];b&&(e.data[0]=b),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(t(this,H)){case w.s90es:case w.motif:{if(e.data[0]==0){[0,63].indexOf(e.data[1])>-1&&this.setChActive(r,1);break}e.data[1]&&this.setChActive(r,1);break}default:{this.setChActive(r,1);break}}})();let v=r*g.cc,k=r*g.ext,M=this.getChModeId(r);switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{t(this,_).ano(r),t(this,ke)[r]=0,t(this,p)[v+E[1]]=0,t(this,p)[v+E[5]]=0,t(this,p)[v+E[64]]=0,t(this,p)[v+E[65]]=0,t(this,p)[v+E[66]]=0,t(this,p)[v+E[67]]=0,t(this,p)[v+E[11]]=127,t(this,p)[v+E[101]]=127,t(this,p)[v+E[100]]=127,t(this,p)[v+E[99]]=127,t(this,p)[v+E[98]]=127;return}case 123:{t(this,_).ano(r);return}case 124:{t(this,_).ano(r);return}case 125:{t(this,_).ano(r);return}case 126:{t(this,ee)[r]=1,t(this,_).ano(r);return}case 127:{t(this,ee)[r]=0,t(this,_).ano(r);return}}if(E[e.data[0]]==null)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(ra.indexOf(e.data[0])>-1&&this.allocateAce(r,e.data[0]),e.data[0]){case 0:{switch(P()&&console.debug(`${z[t(this,H)]}, CH${r+1}: ${e.data[1]}`),t(this,H)==0?e.data[1]<48?(t(this,D)[r]>0&&(e.data[1]=t(this,p)[v],e.data[1]=120,console.debug(`Forced channel ${r+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]==56?this.switchMode(t(this,U).x5==82?"x5d":"05rw"):e.data[1]==62?this.switchMode(t(this,U).x5==82?"x5d":"05rw"):e.data[1]==63?this.switchMode(z[t(this,U).ds]):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg"):t(this,H)==w.gs||t(this,H)==w.sc?e.data[1]<56&&t(this,D)[r]>0&&(e.data[1]=t(this,p)[v],e.data[1]=120,console.debug(`Forced channel ${r+1} to stay drums.`)):t(this,H)==w.gm&&(e.data[1]<48?t(this,D)[r]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${r+1} to stay drums.`)):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg",!0)),t(this,H)){case w.xg:{[79,95,126,127].indexOf(e.data[1])>-1?t(this,D)[r]==0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):t(this,D)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?t(this,te)[k]=this.EXT_VL:[35,67,83,99].indexOf(e.data[1])>-1?t(this,te)[k]=this.EXT_DX:t(this,te)[k]=this.EXT_NONE;break}case w["05rw"]:case w.x5d:case w.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?t(this,D)[r]==this.CH_MELODIC&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):[80,81,82,83].indexOf(e.data[1])>-1||t(this,D)[r]!=this.CH_MELODIC&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case w.sd:{[104,105,106,107].indexOf(e.data[1])>-1?t(this,D)[r]==0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):t(this,D)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case w.g2:{e.data[1]==120?t(this,D)[r]==0&&(this.setChType(r,this.CH_DRUMS),console.debug(`CH${r+1} set to drums by MSB.`)):t(this,D)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}}this.dispatchEvent("voice",{part:r});break}case 2:{this.getExt(r)[1]==this.VLBC_BRTHEXPR&&(t(this,p)[v+E[129]]=e.data[1]);break}case 6:{if(t(this,Ae)[r]){[w.xg,w.gs,w.sc,w.ns5r].indexOf(t(this,H))<0&&console.warn(`NRPN commits are not available under "${z[t(this,H)]}" mode, even when they are supported in Octavia.`);let a=t(this,p)[v+E[99]],c=t(this,p)[v+E[98]];if(a==1){let d=sa.indexOf(c);if(d>-1)t(this,p)[v+E[71+d]]=e.data[1],P()&&console.debug(`Redirected NRPN 1 ${c} to cc${71+d}.`),this.dispatchEvent("cc",{part:r,cc:71+d,data:e.data[1]});else{let s=_t.indexOf(c);s>-1?t(this,Ke)[r*10+s]=e.data[1]-64:console.warn(`NRPN 0x01${c.toString(16).padStart(2,"0")} is not supported.`),P()&&console.debug(`CH${r+1} voice NRPN ${c} commit`)}}else{if(ft.indexOf(a)<0){let s=`NRPN 0x${a.toString(16).padStart(2,"0")}${c.toString(16).padStart(2,"0")} `;a==127?console.warn(`${s}is not necessary. Consider removing it.`):console.warn(`${s}is not supported.`)}else{let s=t(this,D)[r]-2;s<0?console.warn(`CH${r+1} cannot accept drum NRPN as type ${et[t(this,D)[r]]}.`):t(this,j)[(s*g.dpn+de[a])*g.dnc+c]=e.data[1]}P()&&console.debug(`CH${r+1} (${et[t(this,D)[r]]}) drum NRPN ${a} commit`)}}else{let a=It[t(this,p)[v+E[100]]],c=Nt[t(this,p)[v+E[100]]];if(t(this,p)[v+E[101]]==0&&a!=null)switch(P()&&console.debug(`CH${r+1} RPN 0 ${t(this,p)[v+E[100]]} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],Gt[a][0]),Gt[a][1]),t(this,R)[r*g.rpn+a]=e.data[1],t(this,A)[r*g.rpnt+c]=1,M){case w.xg:case w.gs:case w.sc:case w.mt32:case w.s90es:case w.motif:{switch(t(this,p)[v+E[100]]){case 1:case 2:{this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)});break}}break}default:this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)})}}break}case 32:{switch(P()&&console.debug(`${z[t(this,H)]}, CH${r+1} LSB: ${e.data[1]}`),t(this,H)){case w.s90es:case w.motif:{this.setChType(r,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,t(this,H),!0);break}}this.getExt(r)[0]==this.EXT_DX,this.dispatchEvent("voice",{part:r});break}case 38:{if(!t(this,Ae)[r]){let a=It[t(this,p)[v+100]],c=Nt[t(this,p)[v+100]];t(this,p)[v+101]==0&&a!=null&&(t(this,R)[r*g.rpn+a+1]=e.data[1],t(this,A)[r*g.rpnt+c]=1)}break}case 64:{e.data[1]<64&&t(this,_).hoOf(r);break}case 66:{e.data[1]>>6?t(this,_).soOn(r):t(this,_).soOf(r);break}case 98:case 99:{t(this,Ae)[r]=1;break}case 100:case 101:{t(this,Ae)[r]=0;break}}t(this,p)[v+E[e.data[0]]]=e.data[1],this.dispatchEvent("cc",{part:r,cc:e.data[0],data:e.data[1]})}h.getChModeId(r)==w.xg&&t(h,D)[r]&&h.setDrumFirstWrite(r)},12:function(e){let r=e.channel,h=this;switch(t(h,H)){case w.s90es:case w.motif:{e.data&&h.setChActive(r,1);break}default:h.setChActive(r,1)}if(h.getExt(r)[0]==h.EXT_DX){let u=g.cc*r}t(h,O)[r]=e.data,t(h,ue)[r]=0,P()&&console.debug(`T:${e.track} C:${r} P:${e.data}`),h.dispatchEvent("voice",{part:r}),h.getChModeId(r)==w.xg&&t(h,D)[r]&&h.setDrumFirstWrite(r)},13:function(e){let r=this,h=e.channel;t(this,F).forEach(function(u){let b=u>>7;h==b&&(t(r,V)[u]=e.data,r.dispatchEvent("note",{part:h,note:u&127,velo:e.data,state:r.NOTE_SUSTAIN}))})},14:function(e){let r=e.channel;t(this,ke)[r]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)})},15:function(e){ca(e.data).forEach(r=>{let h=r[0],u=r[1];(t(this,dt)[h]||function(){console.debug(`Unknown manufacturer ${h}.`)})(u,r.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(t(this,Q)[e.meta]||function(h,u,b){}).call(this,e.data,e.track,e.meta),e.meta!=32&&x(this,Ue,0);let r=aa.indexOf(e.meta)>-1;if(P()&&console.debug(e),r)return e.reply="meta",e}});C(this,dt,{64:(e,r,h)=>{t(this,Ge).run(r,h,e)},65:(e,r,h)=>{if(r[0]<16){if(r[1]==72){let u=r[r.length-1],b=xe(r.subarray(3,r.length-1));u==b?t(this,ne).run(r.subarray(0,r.length-1),h,e):console.warn(`Bad SD checksum ${u} - should be ${b}.`)}else t(this,ne).run(r,h,e);}else{let u=r[r.length-1],b=xe(r.subarray(2,r.length-1));u==b?t(this,ne).run(r.subarray(0,r.length-1),h,e):console.warn(`Bad GS checksum ${u} - should be ${b}.`)}},66:(e,r,h)=>{t(this,me).run(r,h,e)},67:(e,r,h)=>{t(this,se).run(r,h,e)},68:(e,r,h)=>{t(this,Xe).run(r,h,e)},71:(e,r,h)=>{t(this,_e).run(r,h,e)},126:(e,r,h)=>{t(this,Ie).run(r,h,e)},127:(e,r,h)=>{this.switchMode("gm"),t(this,Ne).run(r,h,e)}});C(this,Ie,void 0);C(this,Ne,void 0);C(this,se,void 0);C(this,ne,void 0);C(this,me,void 0);C(this,Ge,void 0);C(this,_e,void 0);C(this,Xe,void 0);let e=this;x(e,ie,new Uint8Array(256),zt),t(e,we)[10]=new Uint8Array(512),x(e,Be,new oe),x(e,U,{x5:82,ds:w.krs,smotif:w.s90es,gs:4,sc:3}),x(e,Ee,{dumpLimit:e.DUMP_MODE}),x(e,st,new Proxy(t(e,Ee),{set:()=>{}}));for(let a in Ut){let c=w[a];c==null?console.debug(`SubDB build error: "${a}" does not exist`):t(e,I)[c]=new Uint8Array(Ut[a])}e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(a){var d,s;let{data:c}=a;((d=t(e,re)[0])==null?void 0:d.type)==c.type&&(s=t(e,re)[0])!=null&&s.amend?(t(e,re)[0].amend=c.amend,t(e,re)[0].data+=c.data):t(e,re).unshift(c)}),t(e,Q)[1]=function(a){var c,d,s,i,o;switch(a=a.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),a.slice(0,2)){case"@I":{x(this,N,!0),this.dispatchEvent("metacommit",{type:"Kar.Info",data:(c=a.slice(2))==null?void 0:c.trimLeft()});break}case"@K":{x(this,N,!0),this.dispatchEvent("metacommit",{type:"Kar.Mode",data:(d=a.slice(2))==null?void 0:d.trimLeft()}),console.debug(`Karaoke mode active: ${a.slice(2)}`);break}case"@L":{x(this,N,!0),this.dispatchEvent("metacommit",{type:"Kar.Lang",data:(s=a.slice(2))==null?void 0:s.trimLeft()});break}case"@T":{x(this,N,!0),this.dispatchEvent("metacommit",{type:"KarTitle",data:(i=a.slice(2))==null?void 0:i.trimLeft()});break}case"@V":{x(this,N,!0),this.dispatchEvent("metacommit",{type:"Kar.Ver.",data:(o=a.slice(2))==null?void 0:o.trimLeft()});break}case"XF":{let n=a.slice(2).split(":");switch(n[0]){case"hd":{n.slice(1).forEach((f,l)=>{f.length&&this.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][l],data:f})});break}case"ln":{n.slice(1).forEach((f,l)=>{f.length&&this.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][l],data:f})});break}default:this.dispatchEvent("metacommit",{type:"XfUnData",data:a})}break}default:t(this,N)?a[0]=="\\"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:a.slice(1),amend:!0})):a[0]=="/"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:a.slice(1),mask:!0,amend:!0})):this.dispatchEvent("metacommit",{type:"KarLyric",data:a,amend:!0}):a.split(`
`).forEach((n,f)=>{this.dispatchEvent("metacommit",{type:"Cmn.Text",data:n,mask:f!=0})})}},t(e,Q)[2]=function(a){this.dispatchEvent("metacommit",{type:"Copyrite",data:a})},t(e,Q)[3]=function(a,c){c<1&&t(this,Ue)<1&&this.dispatchEvent("metacommit",{type:"TrkTitle",data:a})},t(e,Q)[4]=function(a,c){this.dispatchEvent("metacommit",{type:"Instrmnt",data:a})},t(e,Q)[5]=function(a){a.trim()==""?this.dispatchEvent("metacommit",{type:"C.Lyrics",data:"",amend:!1}):this.dispatchEvent("metacommit",{type:"C.Lyrics",data:a,amend:!0})},t(e,Q)[6]=function(a){this.dispatchEvent("metacommit",{type:"C.Marker",data:a})},t(e,Q)[7]=function(a){this.dispatchEvent("metacommit",{type:"CuePoint",data:a})},t(e,Q)[32]=function(a){x(this,Ue,a[0]+1)},t(e,Q)[33]=function(a,c){P()&&console.debug(`Track ${c} requests to get assigned to output ${a}.`),t(e,Pe)[c]=a+1},t(e,Q)[81]=function(a,c){x(e,qe,a/1e3)},t(e,Q)[127]=function(a,c){t(e,Be).run(a,c)},t(e,Be).default=function(a){console.warn(`Unrecognized sequencer-specific byte sequence: ${a}`)},t(e,Be).add([67,0,1],function(a,c){P()&&console.debug(`XGworks requests assigning track ${c} to output ${a[0]}.`),t(e,Pe)[c]=a[0]+1}),x(e,Ie,new oe("universal non-realtime")),x(e,Ne,new oe("universal realtime")),x(e,se,new oe("Yamaha")),x(e,ne,new oe("Roland")),x(e,me,new oe("Korg")),x(e,Ge,new oe("Kawai")),x(e,_e,new oe("Akai")),x(e,Xe,new oe("Casio"));let r=new oe("DX7+ Dump"),h=function(a){console.info(`Unrecognized SysEx in "${this.name}" set.
%o`,a)};t(e,Ie).default=h,t(e,Ne).default=h,t(e,se).default=h,t(e,ne).default=h,t(e,me).default=h,t(e,Ge).default=h,t(e,_e).default=h,t(e,Xe).default=h,r.default=h,t(e,Ie).add([9],(a,c,d)=>{e.switchMode(["gm","?","g2"][a[0]-1],!0),e.setPortMode(e.getTrackPort(c),1,w[["gm","?","g2"][a[0]-1]]),x(e,N,t(e,N)||!1),console.info(`MIDI reset: ${["GM","Init","GM2"][a[0]-1]}`),a[0]==2&&e.init()}),t(e,Ne).add([4,1],(a,c,d)=>{e.dispatchEvent("mupromptex"),x(e,B,((a[1]<<7)+a[0])/16383*100),e.dispatchEvent("mastervolume",t(e,B))}).add([4,3],(a,c,d)=>((a[1]<<7)+a[0]-8192)/8192).add([4,4],(a,c,d)=>a[1]-64).add([4,5],(a,c,d)=>{e.dispatchEvent("mupromptex");let s=a[0],i=a[1],o=a[2],n=3,f=n+(s<<1),l=f+i;if(s!=1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${s})!
`,a);return}let m=0,$=0,S=0;switch(a.subarray(n,f).forEach(L=>{m=m<<7,m|=L}),a.subarray(f,l).forEach((L,$e)=>{$|=L<<$e*7}),a.subarray(l).forEach((L,$e)=>{S|=L<<$e*7}),P()&&console.debug(`GM2 global parameter: (${a.subarray(3,f)}; p: ${$}, v: ${S})`),m){case 129:{$==0&&(e.setEffectType(0,52,S),e.dispatchEvent("efxreverb",e.getEffectType(0)));break}case 130:{$==0&&(e.setEffectType(1,52,S|16),e.dispatchEvent("efxchorus",e.getEffectType(1)));break}default:P()&&console.debug("GM2 global paramater slot path unknown.")}}),t(this,se).add([76,0,0],(a,c,d)=>{switch(a[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset: ${a}`);break}case 126:{e.switchMode("xg",!0),e.setPortMode(e.getTrackPort(c),4,w.xg),x(e,N,!1),console.info("MIDI reset: XG");break}default:{e.dispatchEvent("mupromptex");let s=[0,0,0,0],i=(o,n)=>{s[n]=o};if(a.subarray(1).forEach((o,n)=>{let f=n+a[0];([i,i,i,i,l=>{x(this,B,l*129/16383*100),e.dispatchEvent("mastervolume",t(e,B))},l=>{},l=>{}][f]||(()=>{}))(o,n)}),a[0]<4){let o=0;s.forEach(n=>{o=o<<4,o+=n}),o-=1024}}}}).add([76,2,1],(a,c,d)=>{e.dispatchEvent("mupromptex");let s="XG ";a[0]<32?(s+="reverb ",a.subarray(1).forEach((i,o)=>{([n=>{e.setEffectTypeRaw(0,!1,n),console.info(`${s}main type: ${Ze[n]}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},n=>{e.setEffectTypeRaw(0,!0,n),console.debug(`${s}sub type: ${n+1}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},n=>{console.debug(`${s}time: ${Mt(n)}s`)},n=>{console.debug(`${s}diffusion: ${n}`)},n=>{console.debug(`${s}initial delay: ${n}`)},n=>{console.debug(`${s}HPF cutoff: ${Fe[n]}Hz`)},n=>{console.debug(`${s}LPF cutoff: ${Fe[n]}Hz`)},n=>{console.debug(`${s}width: ${n}`)},n=>{console.debug(`${s}height: ${n}`)},n=>{console.debug(`${s}depth: ${n}`)},n=>{console.debug(`${s}wall type: ${n}`)},n=>{console.debug(`${s}dry/wet: ${n}`)},n=>{console.debug(`${s}send: ${Z(n)}dB`)},n=>{console.debug(`${s}pan: ${n-64}`)},!1,!1,n=>{console.debug(`${s}delay: ${n}`)},n=>{console.debug(`${s}density: ${n}`)},n=>{console.debug(`${s}balance: ${n}`)},n=>{},n=>{console.debug(`${s}feedback: ${n}`)},n=>{}][a[0]+o]||function(){console.warn(`Unknown XG reverb address: ${a[0]}.`)})(i)})):a[0]<64?(s+="chorus ",a.subarray(1).forEach((i,o)=>{([n=>{e.setEffectTypeRaw(1,!1,n),console.info(`${s}main type: ${Ze[n]}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},n=>{e.setEffectTypeRaw(1,!0,n),console.debug(`${s}sub type: ${n+1}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},n=>{console.debug(`${s}LFO: ${Ct[n]}Hz`)},n=>{},n=>{console.debug(`${s}feedback: ${n}`)},n=>{console.debug(`${s}delay offset: ${Tt(n)}ms`)},n=>{},n=>{console.debug(`${s}low: ${Fe[n]}Hz`)},n=>{console.debug(`${s}low: ${n-64}dB`)},n=>{console.debug(`${s}high: ${Fe[n]}Hz`)},n=>{console.debug(`${s}high: ${n-64}dB`)},n=>{console.debug(`${s}dry/wet: ${n}`)},n=>{console.debug(`${s}send: ${Z(n)}dB`)},n=>{console.debug(`${s}pan: ${n-64}`)},n=>{console.debug(`${s}to reverb: ${Z(n)}dB`)},!1,n=>{},n=>{},n=>{},n=>{console.debug(`${s}LFO phase diff: ${(n-64)*3}deg`)},n=>{console.debug(`${s}input mode: ${n?"stereo":"mono"}`)},n=>{}][a[0]-32+o]||function(){console.warn(`Unknown XG chorus address: ${a[0]}.`)})(i)})):a[0]<86?(s+="variation ",a.subarray(1).forEach((i,o)=>{([n=>{e.setEffectTypeRaw(2,!1,n),console.info(`${s}main type: ${Ze[n]}`),e.dispatchEvent("efxdelay",e.getEffectType(2))},n=>{e.setEffectTypeRaw(2,!0,n),console.debug(`${s}sub type: ${n+1}`),e.dispatchEvent("efxdelay",e.getEffectType(2))}][a[0]-64+o]||function(){})(i)})):a[0]<97?(s+="variation ",a.subarray(1).forEach((i,o)=>{[n=>{console.debug(`${s}send: ${Z(n)}dB`)},n=>{console.debug(`${s}pan: ${n-64}`)},n=>{console.debug(`${s}to reverb: ${Z(n)}dB`)},n=>{console.debug(`${s}to chorus: ${Z(n)}dB`)},n=>{console.debug(`${s}connection: ${n?"system":"insertion"}`)},n=>{console.debug(`${s}channel: CH${n+1}`)},n=>{console.debug(`${s}mod wheel: ${n-64}`)},n=>{console.debug(`${s}bend wheel: ${n-64}`)},n=>{console.debug(`${s}channel after touch: ${n-64}`)},n=>{console.debug(`${s}AC1: ${n-64}`)},n=>{console.debug(`${s}AC2: ${n-64}`)}][a[0]-86+o](i)})):a[0]>111&&a[0]<118?s+="variation ":console.warn(`Unknown XG variation address: ${a[0]}`)}).add([76,2,64],(a,c,d)=>{a.subarray(1).forEach((s,i)=>{let o=i+a[0];if(o==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][s]}`);else{let n=o-1>>2,f=o-1&3,l=`XG EQ ${n} ${["gain","freq","Q","shape"][f]}: `;[()=>{console.debug(`${l}${s-64}dB`)},()=>{console.debug(`${l}${s} (raw)`)},()=>{console.debug(`${l}${s/10}`)},()=>{console.debug(`${l}${["shelf","peak"][+!!s]}`)}][f]()}})}).add([76,3],(a,c,d)=>{e.dispatchEvent("mupromptex");let s=a[0],i=a[1],o=`XG Insertion ${a[0]+1} `;a.subarray(2).forEach((n,f)=>{([l=>{e.setEffectTypeRaw(3+s,!1,l),console.info(`${o}main type: ${Ze[l]}`),e.dispatchEvent(`efxinsert${s}`,e.getEffectType(3+s))},l=>{e.setEffectTypeRaw(3+s,!0,l),console.debug(`${o}sub type: ${l+1}`),e.dispatchEvent(`efxinsert${s}`,e.getEffectType(3+s))}][i+f]||function(){})(n)})}).add([76,6,0],(a,c,d)=>{let s=a[0];s<64?e.setLetterDisplay(a.subarray(1),"XG letter display",s):x(e,De,Date.now())}).add([76,7,0],(a,c,d)=>{let s=a[0];x(e,W,0),x(e,fe,Date.now()+3200),t(e,ie,ve).fill(0);let i=a.subarray(1);for(let o=0;o<s;o++)i.unshift(0);i.forEach(function(o,n){let f=Math.floor(n/16),l=n%16,m=(l*3+f)*7,$=7,S=0;for(m-=l*5,f==2&&($=2);S<$;)t(e,ie,ve)[m+S]=o>>6-S&1,S++})}).add([76,8],(a,c)=>{e.dispatchEvent("mupromptex");let d=e.chRedir(a[0],c,!0),s=a[1],i=g.cc*d,o=`XG CH${d+1} `,n=`Unknown XG part address ${s}.`,f=!0;a.subarray(2).forEach((l,m)=>{f=!0,s<1?console.debug(n):s<41?([()=>{t(e,p)[i+E[0]]=l,e.dispatchEvent("voice",{part:d})},()=>{t(e,p)[i+E[32]]=l,e.dispatchEvent("voice",{part:d})},()=>{t(e,O)[d]=l,e.dispatchEvent("voice",{part:d})},()=>{f=!1;let $=e.chRedir(l,c,!0);t(e,X)[d]=$,d!=$&&(e.buildRchTree(),console.info(`${o}receives from CH${$+1}`)),t(e,ce)[d]||(e.copyChSetup($,d,!0),console.debug(`${o}copied from CH${$+1}.`),e.setChActive(d,1),e.dispatchEvent("voice",{part:d}))},()=>{t(e,ee)[d]=+!l},()=>{},()=>{f=!1,e.setChType(d,l,w.xg),console.debug(`${o}type: ${et[l]||l}`),e.dispatchEvent("voice",{part:d})},()=>{t(e,R)[g.rpn*d+3]=l,t(e,A)[g.rpnt*d+2]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)})},!1,!1,()=>{t(e,p)[i+E[7]]=l},!1,!1,()=>{t(e,p)[i+E[10]]=l||128},!1,!1,()=>{t(e,p)[i+E[128]]=l,e.allocateAce(d,128)},()=>{t(e,p)[i+E[93]]=l},()=>{t(e,p)[i+E[91]]=l},()=>{t(e,p)[i+E[94]]=l},()=>{t(e,p)[i+E[76]]=l},()=>{t(e,p)[i+E[77]]=l},()=>{t(e,p)[i+E[78]]=l},()=>{t(e,p)[i+E[74]]=l},()=>{t(e,p)[i+E[71]]=l},()=>{t(e,p)[i+E[73]]=l},()=>{t(e,p)[i+E[75]]=l},()=>{t(e,p)[i+E[72]]=l}][s+m-1]||(()=>{}))():s<48?console.debug(n):s<111?s>102&&s<105&&(t(e,p)[i+E[[5,65][s&1]]]=l):s<114?console.debug(n):s<116?console.debug(`${o}EQ ${["bass","treble"][s&1]} gain: ${l-64}dB`):s<118?console.debug(n):s<120?console.debug(`${o}EQ ${["bass","treble"][s&1]} freq: ${l}`):console.debug(n)}),f&&t(e,D)[d]>1&&e.setDrumFirstWrite(d)}).add([76,9],(a,c)=>{let d=e.chRedir(a[0],c,!0),s=a[1],i=g.cc*d,o=`PLG-VL CH${d+1} `;a.subarray(2).forEach((n,f)=>{let l=f+s;switch(l){case 1:{console.info(`${o}breath mode: ${["system","breath","velocity","touch EG"][n]}`);break}case 0:case 27:case 28:break;default:if(l<27){let m=l-3>>1,$=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][m];l&1?l<23?(console.debug(`${o}${$} control source: ${Pt(n)}`),n&&n<96&&e.allocateAce(d,130+m),t(e,Le)[g.redir*d+m+2]=n,e.buildRccMap()):console.debug(`${o}${$} scale break point: ${n}`):(console.debug(`${o}${$} depth: ${n-64}`),t(e,p)[i+E[130+m]]=n)}}})}).add([76,10],(a,c,d)=>{}).add([76,16],(a,c,d)=>{}).add([76,17,0,0],(a,c,d)=>{}).add([76,112],(a,c,d)=>{switch(console.debug(`XG enable PLG-${["VL","SG","DX","AN","PF","DR","PC","AP"][a[0]]} for CH${a[2]+1}.`),a[0]){case 0:{t(e,te)[g.ext*a[2]]=e.EXT_VL;break}case 2:{t(e,te)[g.ext*a[2]]=e.EXT_DX;break}default:t(e,te)[g.ext*a[2]]=e.EXT_NONE}}).add([73,0,0],(a,c)=>{let d=a[0],s="MU1000 System - ";a.subarray(1).forEach((i,o)=>{let n=d+o;n==8?console.debug(`${s}LCD contrast: ${i}.`):n==18?(t(e,I)[w.xg][1]=i?126:0,console.debug(`${s}default bank: ${i?"MU100 Native":"MU Basic"}.`),e.dispatchEvent("banklevel",{mode:"xg",data:+!!i}),e.forceVoiceRefresh()):n>=64&&n<69&&[()=>{e.dispatchEvent("channelactive",i)},()=>{i<8?(e.dispatchEvent("channelmin",i<<4),console.debug(`Octavia System: Minimum CH${(i<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{i<8?(e.dispatchEvent("channelmax",(i<<4)+15),console.debug(`Octavia System: Maximum CH${(i<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{x(e,ye,!!i),console.info(`Octavia System: RS receiving ${["dis","en"][i]}abled.`)}][n-64]()})}).add([73,10,0],(a,c)=>{let d=a[0],s=`MU1000 RS${t(e,ye)?"":" (ignored)"}: `;if(d<16)switch(d){case 2:{let i=e.chRedir(0,c,!0);t(e,ye)&&(e.dispatchEvent("portrange",4),e.dispatchEvent("portstart",i)),console.info(`${s}Show CH${i+1}~CH${i+64}`);break}case 3:{let i=e.chRedir(a[1]<<5,c,!0);t(e,ye)&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",i)),console.info(`${s}Show CH${i+1}~CH${i+32}`);break}default:console.debug(`${s}unknown switch ${d} invoked.`)}else if(d<32){if(t(e,ye)){let i=e.chRedir(d-16+(t(e,Ye)<<4),c,!0);e.dispatchEvent("channelactive",i)}}else if(d<36){let i=e.chRedir(d-32<<4,c,!0);t(e,ye)&&(e.dispatchEvent("portrange",1),e.dispatchEvent("portstart",i>>4),x(e,Ye,d-32)),console.info(`${s}Show CH${i+1}~CH${i+16}`)}}).add([73,11,0],(a,c)=>{let d="MU1000 System - channel ",s="Octavia System - channel ",i=a[0];a.subarray(1).forEach((o,n)=>{let f=i+n;([()=>{e.setChActive(o,1),e.dispatchEvent("channelactive",o),P()&&console.debug(`${d}current part: CH${o+1}`)},()=>{o<5?(e.dispatchEvent("portrange",1<<o),console.debug(`${d}port range: ${1<<o} port(s)`)):(e.dispatchEvent("portrange",0),console.debug(`${d}port range: reset`))},()=>{o<16?(e.dispatchEvent("portstart",o),console.debug(`${s}start port: ${"ABCDEFGHIJKLMNOP"[o]}`)):(e.dispatchEvent("portstart",255),console.debug(`${s}start port: reset`))}][f]||(()=>{console.debug(`${d}unknown address: ${f}`)}))()})}).add([93,3],(a,c)=>{let d=e.chRedir(a[0],c,!0),s=`PLG-SG CH${d+1} `,i=Date.now();if(a[1]==0){let o="",n=0;a.subarray(2).forEach((f,l)=>{l%2==0?o+=Rt[f]||f.toString().padStart("0"):n+=f*13}),i>=t(e,Qe)&&this.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"SGLyrics",data:`${Dt(o)}`,amend:!0}),x(e,Qe,i+Math.ceil(n/2)+t(e,qe)),P()&&console.debug(`${s}vocals: ${o}`)}else console.warn(`Unknown PLG-SG data: ${a}`)}).add([98,0],(a,c,d)=>{e.dispatchEvent("mupromptex");let s=a[0],i=a.length-5,o=a.length-1;if(s!=i){console.info(`PLG-DX native dump size mismatch! Gave ${s} instead of ${a.length-5}.`);return}let n=xe(a.subarray(4,o));if(n!=a[o]){console.info(`Bad PLG-DX checksum ${a[o]} - should be ${n}.`);return}a[0]=98,t(e,se).run(a.subarray(0,o),c,d,{noAce:!0})}).add([98,96],(a,c,d,s)=>{let i=e.chRedir(a[0],c,!0),o=g.cc*i,n=a[1];a.subarray(2).forEach((f,l)=>{let m=n+l;if(!(m<10)){if(m==10)e.resetAce();else if(m<27){let $=m+131;s!=null&&s.noAce||e.allocateAce(i,$),t(e,p)[o+E[$]]=f,e.dispatchEvent("cc",{part:i,cc:$,data:f})}}})}).add([100,0],(a,c,d)=>{let s=a.subarray(0,a.length-1);if(a[0]+5!=a.length){console.warn(`Yamaha DX7+ dump SysEx size mismatch! Expected ${a.length}, but got ${a[0]}:
`,a);return}let i=xe(s),o=a[a.length-1];if(i!=o){console.warn(`Yamaha DX7+ dump SysEx checksum mismatch! Expected ${i}, but got ${o}:
`,a);return}r.run(s.subarray(1))}).add([100,76],(a,c,d)=>{let s=a[0]>>4,i=a[0]&15,o=a[1];switch(s){case 2:{let n=e.chRedir(i,c,!0),f=g.cc*n;a.subarray(2).forEach((l,m)=>{let $=m+o;if(!($<7)){if($<23){let S=$+135;e.allocateAce(n,S),t(e,p)[f+E[S]]=l,e.dispatchEvent("cc",{part:n,cc:S,data:l})}}});break}default:console.info("Unknown DX7+ multipart: %o",a)}}).add([1,20],(a,c,d)=>{d==115?(e.switchMode("doc",!0),e.setPortMode(e.getTrackPort(c),1,w.doc),console.info("MIDI reset: DOC")):console.debug(`Unknown Yamaha SysEx: 67, ${d}, ${a.join(", ")}`)}).add([1,17,15,89],(a,c,d)=>{d==115?(e.setEffectType(0,24,a[0]|16),e.dispatchEvent("efxreverb",e.getEffectType(0))):console.debug(`Unknown Yamaha SysEx: 67, ${d}, ${a.join(", ")}`)}).add([1,24],(a,c,d)=>{if(d==115){for(let s=0;s<16;s++){let i=e.chRedir(s,c,!0);t(e,p)[i*g.cc+E[91]]=127}console.info("DOC Global Reverb: on")}else console.debug(`Unknown Yamaha SysEx: 67, ${d}, ${a.join(", ")}`)}),r.add([14,31],(a,c,d)=>{t(e,p)[g.cc*a[0]+E[64]]=0,t(e,_).ano(a[0]),e.switchMode("xg"),e.setPortMode(e.getTrackPort(c),1,w.xg),e.resetAce(),console.debug(`Yamaha DX7+ reset CH${a[0]+1}.`)}).add([76,112],async a=>{let c=a[0],d=g.cc*c,s=g.ext*c,i=g.cvn*c;t(e,te)[s]=e.EXT_DX,t(e,ue)[c]=1;let o=t(e,rt).subarray(i,i+g.cvn);o.fill(32),a.subarray(1).forEach((n,f)=>{if(f<10)o[f]=Math.max(n,32);else if(!(f<40)){if(f<56){let l=f+102;t(e,p)[d+E[l]]=n,e.dispatchEvent("cc",{part:c,cc:l,data:n})}}}),t(e,O)[c]=c&127,t(e,p)[g.cc*c+E[0]]=35,t(e,p)[g.cc*c+E[32]]=c>>7|4,e.dispatchEvent("voice",{part:c}),console.debug(`DX7+ CH${c+1} dump: %o`,a)});let u=function(a,c,d,s){},b=function(a,c){e.dispatchEvent("mupromptex");let d=a*g.dpn,s=c[0],i=c[1];c.subarray(2).forEach((o,n)=>{let f=n+i,l=-1;f<16?([()=>{l=24},()=>{l=25},()=>{l=26},()=>{},()=>{l=28},()=>{l=29},()=>{l=30},()=>{l=31},()=>{},()=>{},()=>{},()=>{l=20},()=>{l=21},()=>{l=22},()=>{l=23},()=>{}][f]||(()=>{console.debug(`Unknown XG-style drum param ${f} on set ${a+1}.`)}))():f<32||(f<40?([()=>{l=48},()=>{l=49},!1,!1,()=>{l=52},()=>{l=53}][f-32]||(()=>{console.debug(`Unknown XG-style drum param ${f} on set ${a+1}.`)}))():f<80||([()=>{l=36}][f-80]||(()=>{console.debug(`Unknown XG-style drum param ${f} on set ${a+1}.`)}))()),l>=0?(P()&&console.debug(d,l,s,o),t(e,j)[(d+de[l])*g.dnc+s]=o):P()&&console.debug(`XG-style drum param ${f} has no writes.`)})},v=function(a,c,d){e.dispatchEvent("mupromptex");let s=a*g.dpn,i=(c<<7)+d[0];d.subarray(1).forEach((o,n)=>{let f=n+i,l=f&127,m=f>>7,$=-1;m>1&&([()=>{$=26},()=>{},()=>{$=28},()=>{$=29},()=>{$=30},()=>{},()=>{},()=>{$=31}][m-2]||(()=>{console.debug(`Unknown GS-style drum param ${m} on set ${a+1}.`)}))(),$>-1?(P()&&console.debug(s,$,l,o),t(e,j)[(s+de[$])*g.dnc+l]=o):P()&&console.debug(`GS-style drum param ${m} has no writes.`)})};t(this,se).add([76,48],(a,c,d)=>{b(0,a)}).add([76,49],(a,c,d)=>{b(1,a)}).add([76,50],(a,c,d)=>{b(2,a)}).add([76,51],(a,c,d)=>{b(3,a)}).add([76,52],(a,c,d)=>{b(4,a)}).add([76,53],(a,c,d)=>{b(5,a)}).add([76,54],(a,c,d)=>{b(6,a)}).add([76,55],(a,c,d)=>{b(7,a)}),t(this,se).add([89,0],(a,c,d)=>{if(e.eprom){let s=a[0],i=(a[1]<<14)+(a[2]<<7)+a[3]+(e.eprom.offset||0);P()&&console.debug(`MU1000 EPROM trail to 0x${i.toString(16).padStart(6,"0")}, ${s} bytes.`);let o=e.eprom.data;a.subarray(4).forEach((n,f)=>{let l=f>>3,m=f&7;if(m==7)for(let $=0;$<7;$++)o[i+7*l+$]+=(n>>6-$&1)<<7;else o[i+7*l+m]=n})}}).add([89,1],(a,c,d)=>{let s=(a[0]<<21)+(a[1]<<14)+(a[2]<<7)+a[3];P()&&console.debug(`MU1000 EPROM jump to 0x${s.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=s)}).add([89,2],(a,c,d)=>{if(e.eprom){let s=(a[0]<<21)+(a[1]<<14)+(a[2]<<7)+a[3]+(e.eprom.offset||0);P()&&console.debug(`MU1000 EPROM write to 0x${s.toString(16).padStart(6,"0")}.`);let i=e.eprom.data;a.subarray(4).forEach((o,n)=>{let f=n>>3,l=n&7;if(l==7)for(let m=0;m<7;m++)i[s+7*f+m]+=(o>>6-m&1)<<7;else i[s+7*f+l]=o})}}).add([89,3],(a,c,d)=>{}),t(this,se).add([39,48],(a,c,d)=>{}).add([43,0,0],(a,c,d)=>{e.dispatchEvent("mupromptex");let s=[0,0,0,0],i=(o,n)=>{s[n]=o};if(a.subarray(1).forEach((o,n)=>{let f=n+a[0];[i,i,i,i,()=>{x(this,B,o*129/16383*100),e.dispatchEvent("mastervolume",t(e,B))},()=>o-64,()=>o||128,()=>o,()=>o,()=>{console.debug(`TG300 variation on cc${o}.`)}][f](o,f)}),a[0]<4){let o=0;s.forEach(n=>{o=o<<4,o+=n}),o-=1024}}).add([43,1,0],(a,c,d)=>{e.dispatchEvent("mupromptex")}).add([43,2],(a,c,d)=>{e.dispatchEvent("mupromptex");let s=e.chRedir(a[0],c,!0),i=a[1],o=g.cc*s,n=`TG300 CH${s+1} `;a.subarray(2).forEach((f,l)=>{l<5?([()=>{},()=>{t(e,p)[o+E[0]]=f,e.dispatchEvent("voice",{part:s})},()=>{t(e,p)[o+E[32]]=f,e.dispatchEvent("voice",{part:s})},()=>{t(e,O)[s]=f,e.dispatchEvent("voice",{part:s})},()=>{let m=e.chRedir(f,c,!0);t(e,X)[s]=m,s!=m&&(e.buildRchTree(),console.info(`${n}receives from CH${m+1}`))}][l+i]||(()=>{}))(f,l+i):l<21||(l<47?([()=>{t(e,ee)[s]=+!f},()=>{},()=>{},()=>{t(e,R)[g.rpn*s+3]=f,t(e,A)[g.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{},()=>{t(e,p)[o+E[7]]=f},!1,!1,()=>{t(e,p)[o+E[10]]=f||128},!1,!1,()=>{console.debug(`${n} AC1 at cc${f}`)},()=>{console.debug(`${n} AC2 at cc${f}`)},()=>{t(e,p)[o+E[128]]=f,e.allocateAce(s,128)},()=>{t(e,p)[o+E[93]]=f},()=>{t(e,p)[o+E[91]]=f},()=>{t(e,p)[o+E[94]]=f},()=>{t(e,p)[o+E[76]]=f},()=>{t(e,p)[o+E[77]]=f},()=>{t(e,p)[o+E[74]]=f},()=>{t(e,p)[o+E[71]]=f},()=>{t(e,p)[o+E[73]]=f},()=>{t(e,p)[o+E[75]]=f},()=>{t(e,p)[o+E[72]]=f},()=>{t(e,p)[o+E[78]]=f}][l+i-21]||(()=>{}))(f,l+i):l<95||([()=>{t(e,p)[o+E[65]]=f},()=>{t(e,p)[o+E[5]]=f}][l+i-95]||(()=>{}))(f,l+i))})}).add([43,7,0],(a,c,d)=>{let s=a[0];e.setLetterDisplay(a.subarray(1),"TG300 letter display",s)}).add([43,7,1],(a,c,d)=>{x(e,W,0),x(e,fe,Date.now()+3200),t(e,ie,ve).fill(0),a.forEach(function(s,i){let o=Math.floor(i/16),n=i%16,f=(n*3+o)*7,l=7,m=0;for(f-=n*5,o==2&&(l=2);m<l;)t(e,ie,ve)[f+m]=s>>6-m&1,m++})}),t(this,ne).add([66,18,0,0,127],(a,c,d)=>{e.switchMode("sc",!0),e.setPortMode(e.getTrackPort(c),2,w.sc),t(e,p)[g.cc*9]=120,t(e,p)[g.cc*25]=120,t(e,p)[g.cc*41]=120,t(e,p)[g.cc*57]=120,t(e,I)[w.sc][1]=t(e,U).sc,x(e,N,!1),t(e,Se).fill(0),console.info(`GS system to ${["single","dual"][a[0]]} mode.`)}).add([66,18,64,0],(a,c,d)=>{switch(a[0]){case 127:{e.switchMode("gs",!0),e.setPortMode(e.getTrackPort(c),2,w.gs),t(e,I)[w.gs][1]=t(e,U).gs,t(e,p)[g.cc*9]=120,t(e,p)[g.cc*25]=120,t(e,p)[g.cc*41]=120,t(e,p)[g.cc*57]=120,x(e,N,!1),t(e,Se).fill(0),console.info("MIDI reset: GS");break}default:{e.dispatchEvent("mupromptex");let s=[0,0,0,0],i=(o,n)=>{s[n]=o};if(a.subarray(1).forEach((o,n)=>{let f=n+a[0];[i,i,i,i,l=>{x(this,B,l*129/16383*100),e.dispatchEvent("mastervolume",t(e,B))},l=>{},l=>{}][f](o,n)}),a[0]<4){let o=0;s.forEach(n=>{o=o<<4,o+=n}),o-=1024}}}}).add([66,18,64,1],(a,c,d)=>{e.dispatchEvent("mupromptex");let s=a[0];if(s<16){let i="".padStart(s," ");a.subarray(1).forEach((o,n)=>{i+=String.fromCharCode(Math.max(32,o))}),i=i.padEnd(16," "),console.debug(`GS patch name: ${i}`)}else s<48||(s<65?a.subarray(1).forEach((i,o)=>{let n=`GS ${s+o>55?"chorus":"reverb"} `;([()=>{console.info(`${n}type: ${bt[i]}`),e.setEffectType(0,40,i),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${n}predelay: ${i}ms`)},()=>{console.info(`${n}type: ${Ot[i]}`),e.setEffectType(1,40,16+i),e.dispatchEvent("efxchorus",e.getEffectType(1))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${n}to reverb: ${Z(i)}`)},()=>{console.debug(`${n}to delay: ${Z(i)}`)}][s+o-48]||(()=>{}))()}):s<80?console.debug(`Unknown GS patch address: ${s}`):s<91?a.subarray(1).forEach((i,o)=>{let n="GS delay ";([()=>{console.info(`${n}type: ${At[i]}`),e.setEffectType(2,40,32+i),e.dispatchEvent("efxdelay",e.getEffectType(2))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${n}to reverb: ${Z(i)}`)}][s+o-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${s}`))}).add([66,18,64,2],(a,c,d)=>{let s="GS EQ ";a.subarray(1).forEach((i,o)=>{([()=>{console.debug(`${s}low freq: ${[200,400][i]}Hz`)},()=>{console.debug(`${s}low gain: ${i-64}dB`)},()=>{console.debug(`${s}high freq: ${[3e3,6e3][i]}Hz`)},()=>{console.debug(`${s}high gain: ${i-64}dB`)}][a[0]+o]||function(){console.warn(`Unknown GS EQ address: ${a[0]+o}`)})()})}).add([66,18,64,3],(a,c,d)=>{e.dispatchEvent("mupromptex");let s="GS EFX ",i=function(o,n){let f=Lt(t(e,ae).subarray(10,12),n,o);f&&console.debug(`${s}${gt(t(e,ae).subarray(10,12))} ${f}`)};a.subarray(1).forEach((o,n)=>{([()=>{e.setEffectTypeRaw(3,!1,32+o),e.dispatchEvent("efxinsert0",e.getEffectType(3))},()=>{e.setEffectTypeRaw(3,!0,o),console.info(`${s}type: ${gt(t(e,ae).subarray(10,12))}`),e.dispatchEvent("efxinsert0",e.getEffectType(3))},!1,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,()=>{console.debug(`${s}to reverb: ${Z(o)}dB`)},()=>{console.debug(`${s}to chorus: ${Z(o)}dB`)},()=>{console.debug(`${s}to delay: ${Z(o)}dB`)},!1,()=>{console.debug(`${s}1 source: ${o}`),o&&o<96&&e.allocateAceAll(o)},()=>{console.debug(`${s}1 depth: ${o-64}`)},()=>{console.debug(`${s}2 source: ${o}`),o&&o<96&&e.allocateAceAll(o)},()=>{console.debug(`${s}2 depth: ${o-64}`)},()=>{console.debug(`${s}to EQ: ${o?"ON":"OFF"}`)}][a[0]+n]||function(f,l){console.warn(`Unknown GS EFX address: ${l}`)})(o,a[0]+n)})}).add([66,18,65],(a,c,d)=>{v((a[0]>>4)+1<<1,a[0]&15,a.subarray(1))}).add([69,18,16],(a,c,d)=>{var s;switch(a[0]){case 0:{let i=a[1];e.setLetterDisplay(a.subarray(2),"GS display text",i);break}case 32:{x(e,fe,Date.now()+3200),a[1]==0&&(a[2]?(x(e,W,Math.max(Math.min(a[2]-1,9),0)),P()&&console.debug(`GS switch display page ${a[2]-1}.`)):(x(e,W,0),x(e,fe,Date.now()),P()&&console.debug("GS disable display page.")));break}default:if(a[0]<6){t(e,W)>9&&x(e,W,0);let i=a[0]-1<<1|a[1]>>6;t(e,W)==i&&x(e,fe,Date.now()+3200),(s=t(e,we)[i])!=null&&s.length||(t(e,we)[i]=new Uint8Array(256));let o=t(e,we)[i];P()&&console.debug(`GS frame draw page ${i}.`);let n=a[1]&63;o.fill(0),a.subarray(2).forEach(function(l,m){let $=m+n,S=Math.floor($/16),L=$%16,$e=(L*4+S)*5,yt=5,ot=0;for($e-=L*4,S==3&&(yt=1);ot<yt;)o[$e+ot]=l>>4-ot&1,ot++})}else console.warn(`Unknown GS display section: ${a[0]}`)}});let k=function(a,c,d){e.dispatchEvent("mupromptex");let s=a[0],i=g.cc*c,o=g.rpn*c,n=`GS CH${c+1} `;s<3?(a.subarray(1).forEach((f,l)=>{[()=>{t(e,p)[i+E[0]]=f},()=>{t(e,O)[c]=f},()=>{let m=0;f<16?m=e.chRedir(f,d,!0):m=g.ch,t(e,X)[c]=m,c!=m&&(e.buildRchTree(),console.info(`${n}receives from CH${m+1}`))}][s+l]()}),e.dispatchEvent("voice",{part:c})):s<19||(s<44?a.subarray(1).forEach((f,l)=>{([()=>{t(e,ee)[c]=+!f},!1,()=>{e.setChType(c,f<<1,w.gs),console.debug(`${n}type: ${f?"drum ":"melodic"}${f||""}`)},()=>{t(e,R)[o+3]=f,t(e,A)[g.rpnt*c+2]=1,e.dispatchEvent("pitch",{part:c,pitch:e.getPitchShift(c)})},!1,()=>{t(e,p)[i+E[7]]=f},!1,!1,()=>{t(e,p)[i+E[10]]=f||128},!1,!1,()=>{console.debug(`${n}CC 1: cc${f}`)},()=>{console.debug(`${n}CC 2: cc${f}`)},()=>{t(e,p)[i+E[93]]=f},()=>{t(e,p)[i+E[91]]=f},!1,!1,()=>{t(e,R)[o+1]=f,t(e,A)[g.rpnt*c+1]=1,e.dispatchEvent("pitch",{part:c,pitch:e.getPitchShift(c)})},()=>{t(e,R)[o+2]=f,t(e,A)[g.rpnt*c+1]=1,e.dispatchEvent("pitch",{part:c,pitch:e.getPitchShift(c)})},()=>{t(e,p)[i+E[94]]=f}][s+l-19]||(()=>{}))()}):s<76||console.debug(`Unknown GS part address: ${s}`))},M=function(a,c){let d=a[0],s=`GS CH${c+1} `;d<2?a.subarray(1).forEach((i,o)=>{[()=>{t(e,p)[g.cc*c+E[32]]=i},()=>{}][d+o]()}):d<32?console.warn(`Unknown GS misc address: ${d}`):d<35?a.subarray(1).forEach((i,o)=>{[()=>{console.debug(`${s}EQ: o${["ff","n"][i]}`)},()=>{},()=>{console.debug(`${s}EFX: o${["ff","n"][i]}`),t(e,ze)[c]=i,e.dispatchEvent("partefxtoggle",{part:c,active:i})}][d+o-32]()}):console.warn(`Unknown GS misc address: ${d}`)};t(this,ne).add([66,18,64,16],(a,c)=>{k(a,e.chRedir(9,c,!0),c)}).add([66,18,64,17],(a,c)=>{k(a,e.chRedir(0,c,!0),c)}).add([66,18,64,18],(a,c)=>{k(a,e.chRedir(1,c,!0),c)}).add([66,18,64,19],(a,c)=>{k(a,e.chRedir(2,c,!0),c)}).add([66,18,64,20],(a,c)=>{k(a,e.chRedir(3,c,!0),c)}).add([66,18,64,21],(a,c)=>{k(a,e.chRedir(4,c,!0),c)}).add([66,18,64,22],(a,c)=>{k(a,e.chRedir(5,c,!0),c)}).add([66,18,64,23],(a,c)=>{k(a,e.chRedir(6,c,!0),c)}).add([66,18,64,24],(a,c)=>{k(a,e.chRedir(7,c,!0),c)}).add([66,18,64,25],(a,c)=>{k(a,e.chRedir(8,c,!0),c)}).add([66,18,64,26],(a,c)=>{k(a,e.chRedir(10,c,!0),c)}).add([66,18,64,27],(a,c)=>{k(a,e.chRedir(11,c,!0),c)}).add([66,18,64,28],(a,c)=>{k(a,e.chRedir(12,c,!0),c)}).add([66,18,64,29],(a,c)=>{k(a,e.chRedir(13,c,!0),c)}).add([66,18,64,30],(a,c)=>{k(a,e.chRedir(14,c,!0),c)}).add([66,18,64,31],(a,c)=>{k(a,e.chRedir(15,c,!0),c)}).add([66,18,64,64],(a,c)=>{M(a,e.chRedir(9,c,!0))}).add([66,18,64,65],(a,c)=>{M(a,e.chRedir(0,c,!0))}).add([66,18,64,66],(a,c)=>{M(a,e.chRedir(1,c,!0))}).add([66,18,64,67],(a,c)=>{M(a,e.chRedir(2,c,!0))}).add([66,18,64,68],(a,c)=>{M(a,e.chRedir(3,c,!0))}).add([66,18,64,69],(a,c)=>{M(a,e.chRedir(4,c,!0))}).add([66,18,64,70],(a,c)=>{M(a,e.chRedir(5,c,!0))}).add([66,18,64,71],(a,c)=>{M(a,e.chRedir(6,c,!0))}).add([66,18,64,72],(a,c)=>{M(a,e.chRedir(7,c,!0))}).add([66,18,64,73],(a,c)=>{M(a,e.chRedir(8,c,!0))}).add([66,18,64,74],(a,c)=>{M(a,e.chRedir(10,c,!0))}).add([66,18,64,75],(a,c)=>{M(a,e.chRedir(11,c,!0))}).add([66,18,64,76],(a,c)=>{M(a,e.chRedir(12,c,!0))}).add([66,18,64,77],(a,c)=>{M(a,e.chRedir(13,c,!0))}).add([66,18,64,78],(a,c)=>{M(a,e.chRedir(14,c,!0))}).add([66,18,64,79],(a,c)=>{M(a,e.chRedir(15,c,!0))}),t(this,me).add([54,65],(a,c)=>{let d=t(e,U).x5=="81"?"05rw":"x5d";e.switchMode(d,!0),e.setPortMode(e.getTrackPort(c),1,w[d]);let s=a[a.length-1],i=a.subarray(0,a.length-1),o=xe(i);o!=s&&(console.info(`X5D multi parameters checksum mismatch! Expected ${o}, got ${s}.`),console.debug(a));let n=(a[1]<<7)+a[0],f=(a[3]<<7)+a[2],l=e.chRedir(n&15,c,!0),m=g.cc*l;[()=>{f<1||(f<101?(e.setChType(l,e.CH_MELODIC,w.x5d),t(e,O)[l]=f-1,t(e,p)[m+E[0]]=t(e,U).x5):f<229?(e.setChType(l,e.CH_MELODIC,w.x5d),t(e,O)[l]=f-101,t(e,p)[m+E[0]]=56):(e.setChType(l,e.CH_DRUMS,w.x5d),t(e,O)[l]=Vt[f-229]||0,t(e,p)[m+E[0]]=62)),e.dispatchEvent("voice",{part:l})},()=>{t(e,p)[m+E[7]]=f},()=>{f<31&&(t(e,p)[m+E[10]]=Math.round((f-15)*4.2+64))},()=>{t(e,p)[m+E[93]]=tt(f)},()=>{t(e,p)[m+E[91]]=tt(f)},()=>{t(e,R)[l*g.rpn+3]=f>8191?f-16320:64+f,t(e,A)[g.rpnt*l+2]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)})},()=>{t(e,R)[l*g.rpn+1]=f>8191?f-16320:64+f,t(e,A)[g.rpnt*l+1]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)})},()=>{f>0&&(t(e,R)[l*g.rpn]=f,t(e,A)[g.rpnt*l]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)}))},()=>{}][n>>4]()}).add([54,76,0],(a,c)=>{e.dispatchEvent("mupromptex");let d=t(e,U).x5=="81"?"05rw":"x5d";e.switchMode(d),e.setPortMode(e.getTrackPort(c),1,w[d]);let s="",i=t(e,U).x5,o=0,n=0,f="MSB\tPRG\tLSB\tNME";le(a,function(l,m){if(m<16400){let $=m%164;switch(!0){case $<10:{l>31&&(s+=String.fromCharCode(l));break}case $==10:break;case $==11:{f+=`
${i}	${o}	${n}	${s.trim().replace("Init Voice","")}`,o++,s="";break}}o>99&&(i=90,o=0)}}),e.userBank.clearRange({msb:t(e,U).x5,prg:[0,99],lsb:0}),e.userBank.load(f),P()&&console.debug(f),e.forceVoiceRefresh()}).add([54,77,0],(a,c)=>{e.dispatchEvent("mupromptex");let d=t(e,U).x5=="81"?"05rw":"x5d";e.switchMode(d),e.setPortMode(e.getTrackPort(c),1,w[d]);let s="",i=90,o=0,n=0,f="MSB\tPRG\tLSB\tNME";le(a,function(l,m){if(m<13600){let $=m%136;switch(!0){case $<10:{l>31&&(s+=String.fromCharCode(l));break}case $==11:{f+=`
${i}	${o}	${n}	${s.trim().replace("Init Combi","")}`,o++,s="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(f),P()&&console.debug(f),e.forceVoiceRefresh()}).add([54,78],(a,c)=>{let d=t(e,U).x5=="81"?"05rw":"x5d";e.switchMode(d),e.setPortMode(e.getTrackPort(c),1,w[d]),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][a[0]]} mode.`)}).add([54,85],(a,c)=>{e.dispatchEvent("mupromptex");let d=t(e,U).x5=="81"?"05rw":"x5d";e.switchMode(d),e.setPortMode(e.getTrackPort(c),1,w[d]),le(a,(s,i)=>{i>0&&i<3&&(e.setEffectType(i-1,44,s),e.dispatchEvent(`efx${["reverb","chorus"][i-1]}`,e.getEffectType(i-1)))})}).add([54,104],(a,c)=>{e.dispatchEvent("mupromptex");let d=t(e,U).x5=="81"?"05rw":"x5d";e.switchMode(d,!0);let s=e.getTrackPort(c);if(t(e,G)[s]&&t(e,G)[s]!=w[d])if(t(e,Ee).dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${c}. Port ${String.fromCharCode(65+s)} mode "${z[t(e,G)[s]]}" mismatch, should be "${d}".`);return}else console.info(`Track ${c} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);e.setPortMode(s,1,w[d]),le(a,function(i,o,n,f){if(o<192){let l=e.chRedir(Math.floor(o/12),c,!0),m=l*g.cc;switch(o%12){case 0:{i<128?(e.setChType(l,e.CH_MELODIC,w.x5d),t(e,p)[m+E[0]]=t(e,U).x5,t(e,O)[l]=i):(e.setChType(l,e.CH_DRUMS,w.x5d),t(e,p)[m+E[0]]=62,t(e,O)[l]=Vt[i-128]),i>0&&e.setChActive(l,1),e.dispatchEvent("voice",{part:l});break}case 1:{t(e,p)[m+E[7]]=i;break}case 2:{t(e,R)[l*g.rpn+3]=i>127?i-192:64+i,t(e,A)[g.rpnt*l+2]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)});break}case 3:{t(e,R)[l*g.rpn+1]=i>127?i-192:64+i,t(e,A)[g.rpnt*l+1]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)});break}case 4:{i<31&&(t(e,p)[m+E[10]]=Math.round((i-15)*4.2+64));break}case 5:{let $=i>>4,S=i&15;t(e,p)[m+E[91]]=tt(S),t(e,p)[m+E[93]]=tt($);break}case 10:break;case 11:{let $=e.chRedir(i&15,c,!0),S=i>>4;t(e,X)[l]=i,($!=l||S)&&(console.info(`X5D Part CH${l+1} receives from CH${$+1}.`),e.buildRchTree())}}}else{let l=e.chRedir(o-192,c,!0)}})}),t(this,ne).add([22,18,127],(a,c,d)=>{e.switchMode("mt32",!0),e.setPortMode(e.getTrackPort(c),1,w.mt32),x(e,N,!1),e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(a,c,d)=>{e.switchMode("mt32");let s=e.chRedir(d,c,!0),i=a[1];a.subarray(2).forEach((o,n)=>{let f=n+i;t(e,Me)[f+(s-1)*16]=o,([!1,()=>{let l=t(e,Me)[s-1<<4];if(l<3){if(t(e,ue)[s]=1,l==2)for(let m=0;m<name.length;m++)t(e,pe)[(s-1)*g.cmt+m]=t(e,Te)[o*g.cmt+m];else{let m=e.baseBank.get(0,o+(l<<6),127,"mt32").name;for(let $=0;$<m.length;$++)t(e,pe)[(s-1)*g.cmt+$]=m.charCodeAt($)}e.dispatchEvent("voice",{part:s})}},()=>{t(e,R)[s*g.rpn+3]=o+40,t(e,A)[g.rpnt*s+2]=1},()=>{t(e,R)[s*g.rpn+1]=o+14,t(e,A)[g.rpnt*s+1]=1},()=>{t(e,R)[s*g.rpn]=o,t(e,A)[g.rpnt*s]=1},!1,()=>{t(e,p)[g.cc*s+E[91]]=o?127:0},!1,()=>{t(e,p)[g.cc*s+E[7]]=o},()=>{t(e,p)[g.cc*s+E[10]]=Math.ceil(o*9.05)}][f]||(()=>{}))()})}).add([22,18,1],(a,c,d)=>{e.switchMode("mt32");let s=d&7;console.debug(`MT-32 slot #${d+1} Drum: ${a}`);let i=a[0]<<7|a[1];a.subarray(2).forEach((o,n)=>{let f=n+i,l=(f>>2)+24,m=f&3,$=s*g.dpn;if(P()&&console.debug(`MT-32 temp drum note ${l} param ${m}: ${o}`),l<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${l}`);return}[()=>{},()=>{t(e,j)[($+de[26])*g.dnc+l]=Math.round(o*1.27)},()=>{t(e,j)[($+de[26])*g.dnc+l]=o*9+1&127},()=>{t(e,j)[($+de[26])*g.dnc+l]=o?127:0}][m]()})}).add([22,18,2],(a,c,d)=>{e.switchMode("mt32");let s=e.chRedir(d,c,!0),i=a[1]+(a[0]<<7);i<10&&(t(e,ue)[s]=1),a.subarray(2).forEach((o,n)=>{let f=n+i;f<14&&(t(e,pe)[(s-1)*g.cmt+f]=o)}),e.dispatchEvent("voice",{part:s})}).add([22,18,3],(a,c,d)=>{e.switchMode("mt32");let s=d&7;if(a[0]){let i=(a[0]-1<<7)+a[1]-16;a.subarray(2).forEach((o,n)=>{let f=n+i,l=(f>>2)+24,m=f&3,$=s*g.dpn;if(P()&&console.debug(`MT-32 dev drum note ${l} param ${m}: ${o}`),l<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${l}`);return}[()=>{},()=>{t(e,j)[($+de[26])*g.dnc+l]=Math.round(o*1.27)},()=>{t(e,j)[($+de[26])*g.dnc+l]=o*9+1&127},()=>{t(e,j)[($+de[26])*g.dnc+l]=o?127:0}][m]()})}else{let i=a[1];a.subarray(2).forEach((o,n)=>{let f=n+i;t(e,Me)[f]=o;let l=e.chRedir(1+(f>>4),c,!0),m=f&15;([!1,()=>{let $=t(e,Me)[l-1<<4];if($<3)if(t(e,ue)[l]=1,$==2)for(let S=0;S<name.length;S++)t(e,pe)[(l-1)*g.cmt+S]=t(e,Te)[o*g.cmt+S];else{let S=e.baseBank.get(0,o+($<<6),127,"mt32").name;for(let L=0;L<S.length;L++)t(e,pe)[(l-1)*g.cmt+L]=S.charCodeAt(L)}e.dispatchEvent("voice",{part:l})},()=>{t(e,R)[l*g.rpn+3]=o+40,t(e,A)[g.rpnt*l+2]=1},()=>{t(e,R)[l*g.rpn+1]=o+14,t(e,A)[g.rpnt*l+1]=1},()=>{t(e,R)[l*g.rpn]=o,t(e,A)[g.rpnt*l]=1},!1,()=>{t(e,p)[g.cc*l+E[91]]=o?127:0},!1,()=>{t(e,p)[g.cc*l+E[7]]=o},()=>{t(e,p)[g.cc*l+E[10]]=Math.ceil(o*9.05)}][m]||(()=>{}))()})}}).add([22,18,4],(a,c,d)=>{e.switchMode("mt32");let s=a[1]+(a[0]<<7),i=[];a.subarray(2).forEach((o,n)=>{let f=n+s,l=e.chRedir(Math.floor(f/246+1),c,!0),m=f%246;m<14&&(t(e,pe)[(l-1)*g.cmt+m]=o),m<10&&(t(e,ue)[l]=1),i.indexOf(l)<0&&i.push(l)}),i.forEach(o=>{e.dispatchEvent("voice",{part:o})})}).add([22,18,5],(a,c,d)=>{e.switchMode("mt32");let s=(a[0]<<7)+a[1];a.subarray(2).forEach((i,o)=>{let n=s+o,f=Math.floor(n/8),l=n&7,m=f*8;t(e,We)[n]=i,([!1,()=>{let $=t(e,We)[m];if($<3){let S="";if($==2){let $e=g.cmt*f;S=`MT-m:${i.toString().padStart(3,"0")}`}else S=e.baseBank.get(0,i+($<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:f});let L=`MSB	LSB	PRG	NME
000	127	${f}	${S}`;e.userBank.load(L,!0)}}][l]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(a,c,d)=>{e.switchMode("mt32");let s=((a[0]&1)<<7)+a[1],i=a[0]>>1,o=!1;if(a.subarray(2).forEach((n,f)=>{let l=s+f;l<g.cmt&&(t(e,Te)[i*g.cmt+l]=n,o=!0)}),o){e.userBank.clearRange({msb:0,lsb:127,prg:i});let n=`MSB	LSB	PRG	NME
000	127	${i}	MT-m:${i}`;e.userBank.load(n,!0)}e.forceVoiceRefresh()}).add([22,18,16],(a,c,d)=>{e.switchMode("mt32");let s=a[1],i=!1,o=function(n,f){t(e,X)[f-12]=n,i=!0};a.subarray(2).forEach((n,f)=>{let l=f+s;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,o,o,o,o,o,o,o,o,o,()=>{x(e,B,n),e.dispatchEvent("mastervolume",t(e,B))}][l]||(()=>{}))(n,f)}),i&&e.buildRchTree()}).add([22,18,32],(a,c,d)=>{e.switchMode("mt32");let s=a[1],i=" ".repeat(s);a.subarray(2).forEach(o=>{o>31?i+=String.fromCharCode(o):i+=" "}),x(e,Re,i.padStart(20," ")),x(e,De,Date.now()+3200)}).add([22,18,82],(a,c)=>{let d=e.chRedir(0,c,!0);for(let s=0;s<16;s++)t(e,_).ano(d+s),s&&s<10&&(t(e,O)[d+s]=Et[s-1]);console.info("MT-32 alt reset complete.")}),t(this,me).add([66,0],(a,c)=>{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(c),2,w.ns5r),x(e,N,!1),console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][a[0]]} mode.`)}).add([66,1],(a,c)=>{let d=["ns5r","05rw"][a[0]];e.switchMode(d,!0),e.setPortMode(e.getTrackPort(c),2,w[d]),x(e,N,!1)}).add([66,18,0,0],(a,c)=>{let d=a[0];switch(d){case 124:case 126:case 127:{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(c),2,w.ns5r),x(e,N,!1);break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset: ${a}`);break}default:if(d<10){let s=[0,0,0,0],i=(o,n)=>{s[n]=o};if(a.subarray(1).forEach((o,n)=>{[i,i,i,i,()=>{x(e,B,o*129/16383*100),e.dispatchEvent("mastervolume",t(e,B))},()=>o-64,()=>o-64,()=>{},()=>{},()=>{}][d+n]()}),a[0]<4){let o=0;s.forEach(n=>{o=o<<4,o+=n}),o-=1024}}}}).add([66,18,0,1],(a,c)=>{}).add([66,18,0,2],(a,c)=>{}).add([66,18,1],(a,c)=>{e.dispatchEvent("mupromptex");let d=e.chRedir(a[0],c,!0),s=d*g.cc,i=a[1],o=`NS5R CH${d+1} `;a.subarray(2).forEach((n,f)=>{let l=i+f;l<3?([()=>{t(e,p)[s+E[0]]=n||Oe.bank0},()=>{t(e,p)[s+E[32]]=n},()=>{t(e,O)[d]=n}][l](),e.dispatchEvent("voice",{part:d})):l<8||(l<14?[()=>{let m=e.chRedir(n,c,!0);t(e,X)[d]=m,d!=m&&(e.buildRchTree(),console.info(`${o}receives from CH${m+1}`))},()=>{t(e,ee)[d]=+!n},()=>{e.setChType(d,n,w.ns5r),console.debug(`${o}type: ${et[n]}`)},()=>{t(e,R)[g.rpn*d+3]=n,t(e,A)[g.rpnt*d+2]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)})},()=>{},()=>{}][l-8]():l<16||(l<33?[()=>{t(e,p)[s+E[7]]=n},()=>{t(e,p)[s+E[11]]=n},()=>{},()=>{},()=>{t(e,p)[s+E[10]]=n||128},()=>{},()=>{},()=>{t(e,p)[s+E[93]]=n},()=>{t(e,p)[s+E[91]]=n},()=>{t(e,p)[s+E[76]]=n},()=>{t(e,p)[s+E[77]]=n},()=>{t(e,p)[s+E[78]]=n},()=>{t(e,p)[s+E[74]]=n},()=>{t(e,p)[s+E[71]]=n},()=>{t(e,p)[s+E[73]]=n},()=>{t(e,p)[s+E[75]]=n},()=>{t(e,p)[s+E[72]]=n}][l-16]():l<112||l<114&&[()=>{t(e,p)[s+E[5]]=n},()=>{t(e,p)[s+E[65]]=n}][l-112]()))})}).add([66,18,8,0],(a,c)=>{let d=a[0];if(d<32)e.setLetterDisplay(a.subarray(1,33),"NS5R letter display");else{let s=d-32;x(e,fe,Date.now()+3200),x(e,W,10),t(e,ie,ve).fill(0);let i=a.subarray(1),o=4;i.forEach(function(n,f){let l=f+s,m=l>>4,$=l&15;if(l<80){let S=m<o?n:n>>3,L=0,$e=m<o?6:3;for(;S>0;)t(e,ie,ve)[$*32+m*7+($e-L)]=S&1,S=S>>1,L++}})}}).add([66,18,48],(a,c,d)=>{b(0,a)}).add([66,18,49],(a,c,d)=>{b(1,a)}).add([66,18,50],(a,c,d)=>{b(2,a)}).add([66,18,51],(a,c,d)=>{b(3,a)}).add([66,18,52],(a,c,d)=>{b(4,a)}).add([66,18,53],(a,c,d)=>{b(5,a)}).add([66,18,54],(a,c,d)=>{b(6,a)}).add([66,18,55],(a,c,d)=>{b(7,a)}).add([66,52],(a,c)=>{e.switchMode("ns5r"),x(e,N,!1);let d="";le(a,(s,i)=>{i<8?(s>31&&(d+=String.fromCharCode(s)),i==7&&(e.aiEfxName=d)):i<10&&(e.setEffectType(i-8,44,s),e.dispatchEvent(`efx${["reverb","chorus"][i-8]}`,e.getEffectType(i-8)))})}).add([66,53],(a,c)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r"),x(e,N,!1);let d="",s=a[a.length-1],i=a.subarray(0,a.length-1),o=xe(i);o!=s&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${o}, got ${s}.`),console.debug(a));let n=e.getTrackPort(c);if(t(e,G)[n]&&t(e,G)[n]!=w.ns5r)if(t(e,Ee).dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${c}. Port ${String.fromCharCode(65+n)} mode "${z[t(e,G)[n]]}" mismatch, should be "ns5r".`);return}else console.info(`Track ${c} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+n)}.`);e.setPortMode(n,2,w.ns5r),le(i,function(f,l){switch(!0){case l<2944:{let m=e.chRedir(Math.floor(l/92),c,!0),$=m*g.cc;switch(l%92){case 0:{t(e,p)[$+E[0]]=f,e.dispatchEvent("voice",{part:m});break}case 1:{t(e,p)[$+E[32]]=f,!f&&!t(e,p)[$+E[0]]&&(t(e,p)[$+E[0]]=Oe.bank0),e.dispatchEvent("voice",{part:m});break}case 2:{t(e,O)[m]=f,f>0&&e.setChActive(m,1),e.dispatchEvent("voice",{part:m});break}case 3:{let S=e.chRedir(f,c,!0);t(e,X)[m]=S,m!=S&&(console.info(`NS5R CH${m+1} receives from CH${S+1}.`),e.buildRchTree());break}case 7:{t(e,D)[m]=f,e.dispatchEvent("voice",{part:m});break}case 8:{t(e,R)[m*g.rpn+3]=f<40||f>88?f+(f>63?-192:64):f,t(e,A)[g.rpnt*m+2]=1,e.dispatchEvent("pitch",{part:m,pitch:e.getPitchShift(m)});break}case 9:case 10:{t(e,p)[$+E[7]]=f;break}case 11:{t(e,p)[$+E[11]]=f;break}case 14:{t(e,p)[$+E[10]]=f||128;break}case 19:{t(e,p)[$+E[93]]=f;break}case 20:{t(e,p)[$+E[91]]=f;break}case 84:{t(e,p)[$+E[65]]=f;break}case 85:{t(e,p)[$+E[5]]=f;break}}break}case l<3096:break;case l<3134:{let m=l-3096;m<8?(f>31&&(d+=String.fromCharCode(f)),m==7&&(e.aiEfxName=d)):m<10&&(e.setEffectType(m-8,44,f),e.dispatchEvent(`efx${["reverb","chorus"][m-8]}`,e.getEffectType(m-8)));break}case l<8566:break}})}).add([66,54],(a,c)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r");let d="",s=80,i=0,o=0,n="MSB\tPRG\tLSB\tNME";le(a,function(f,l){let m=l%158;switch(!0){case m<10:{f>31&&(d+=String.fromCharCode(f));break}case m==10:break;case m==11:{s=f&127;break}case m==12:{o=f&127;break}case m==13:{n+=`
${s}	${i}	${o}	${d.trim().replace("Init Voice","")}`,i++,d="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(n),P()&&console.debug(n),e.forceVoiceRefresh()}).add([66,55],(a,c)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r");let d="",s=88,i=0,o=0,n="MSB\tPRG\tLSB\tNME";le(a,function(f,l){let m=l%126;switch(!0){case m<10:{f>31&&(d+=String.fromCharCode(f));break}case m==11:break;case m==12:break;case m==13:{n+=`
${s}	${i}	${o}	${d.trim().replace("Init Combi","")}`,i++,d="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(n),P()&&console.debug(n),e.forceVoiceRefresh()}).add([66,125],(a,c,d)=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][a[0]]||"white")}).add([66,127],(a,c,d)=>{let s=a[a.length-1],i=a.subarray(0,a.length-1),o=xe(i);o!=s&&(console.info(`NS5R screen dump checksum mismatch! Expected ${o}, got ${s}.`),console.debug(a));let n=new Uint8Array(5760);le(a,(f,l,m)=>{if(l<720)for(let $=0;$<8;$++)n[l*8+$]=f>>7-$&1}),e.dispatchEvent("screen",{type:"ns5r",data:n})}).add([76],(a,c,d)=>{t(e,me).run([66,...a],c,d)}),t(this,Ge).add([16,0,8,0],(a,c,d)=>{let s=(a[2]<<4)+a[3],i="K11 ";([()=>{e.switchMode("k11",!0),e.setPortMode(e.getTrackPort(c),2,w.k11),x(e,N,!1),t(e,I)[w.k11][1]=s?4:0,console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,s),console.debug(`${i}reverb type: ${s}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{console.debug(`${i}reverb time: ${s}`)},()=>{console.debug(`${i}reverb time: ${s}`)},()=>{console.debug(`${i}reverb predelay: ${s}`)},()=>{console.debug(`${i}reverb predelay: ${s}`)},()=>{console.debug(`${i}depth high: ${s}`)},()=>{console.debug(`${i}depth high: ${s}`)},()=>{console.debug(`${i}depth low: ${s}`)},()=>{console.debug(`${i}depth low: ${s}`)}][a[0]]||(()=>{}))()}).add([16,0,8,1],(a,c,d)=>{e.dispatchEvent("mupromptex");let s=e.chRedir(a[1],c,!0),i=g.cc*s,o=g.rpn*s,n=(a[3]<<4)+a[4],f=`K11 CH${s+1} `;([()=>{n<128?(e.setChType(s,e.CH_MELODIC,w.k11),t(e,p)[i+E[0]]=0,t(e,O)[s]=n):(e.setChType(s,e.CH_DRUMS,w.k11),t(e,O)[s]=n-128),e.dispatchEvent("voice",{part:s})},()=>{let l=e.chRedir(n,c,!0);t(e,X)[s]=l,s!=l&&(e.buildRchTree(),console.info(`${f}receives from CH${l+1}`))},()=>{t(e,p)[i+E[7]]=n},()=>{uupThis.setChActive(s,n)},()=>{t(e,p)[i+E[10]]=n},()=>{t(e,R)[o+3]=n+40,t(e,A)[g.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{t(e,R)[o+1]=n>>1,t(e,R)[o+2]=n&1,t(e,A)[g.rpnt*s+1]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{t(e,p)[i+E[91]]=n?127:0},()=>{},()=>{t(e,p)[i+E[74]]=n},()=>{t(e,p)[i+E[73]]=n},()=>{t(e,p)[i+E[72]]=n}][a[0]]||(()=>{}))()}).add([16,0,9,0],(a,c,d)=>{e.dispatchEvent("mupromptex");let s=(a[2]<<4)+a[3],i="GMLX ";([()=>{console.debug(`${i}reverb type: ${s}`)},()=>{console.debug(`${i}reverb time: ${s}`)},()=>{console.debug(`${i}reverb predelay: ${s}`)},()=>{console.debug(`${i}depth high: ${s}`)},()=>{console.debug(`${i}depth low: ${s}`)}][a[0]]||(()=>{}))()}).add([16,0,9,3],(a,c,d)=>{e.dispatchEvent("mupromptex");let s=(a[2]<<4)+a[3],i=e.chRedir(a[1],c,!0),o=i*g.cc;[()=>{s<128?(e.setChType(i,e.CH_MELODIC,w.k11),t(e,p)[o+E[0]]=0,t(e,p)[o+E[32]]=0,t(e,O)[i]=s):s<160?(e.setChType(i,e.CH_MELODIC,w.k11),t(e,p)[o+E[0]]=0,t(e,p)[o+E[32]]=7,t(e,O)[i]=s-100):(e.setChType(i,e.CH_DRUMS,w.k11),t(e,p)[o+E[0]]=122,t(e,p)[o+E[32]]=0,t(e,O)[i]=s-160),e.dispatchEvent("voice",{part:i})},()=>{let n=e.chRedir(s,c,!0);t(e,X)[i]=n,i!=n&&(e.buildRchTree(),console.info(`GMLX CH${i+1} receives from CH${n+1}`))}][a[0]]()}).add([16,0,9,4],(a,c,d)=>{e.dispatchEvent("mupromptex");let s=(a[2]<<4)+a[3],i=e.chRedir(a[1],c,!0),o=i*g.cc,n=i*g.rpn,f=`GMLX CH${i+1} `;[()=>{e.setChActive(i,s)},()=>{t(e,p)[o+E[7]]=s},()=>{t(e,p)[o+E[10]]=s},()=>{t(e,p)[o+E[91]]=s?127:0},()=>{t(e,R)[n+3]=s+40,t(e,A)[g.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{t(e,R)[n+1]=s,t(e,A)[g.rpnt*i+1]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{t(e,R)[n]=s,t(e,A)[g.rpnt*i]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{}][a[0]]()}),t(this,_e).add([66,93,64],(a,c,d)=>{let s=a[2];switch(a[0]){case 0:{switch(a[1]){case 4:{e.dispatchEvent("mupromptex"),x(e,B,s*129/16383*100),e.dispatchEvent("mastervolume",t(e,B));break}case 5:{e.dispatchEvent("mupromptex"),s-64;break}case 6:{e.dispatchEvent("mupromptex"),console.debug(`SG global reverb: ${s?"on":"off"}`);break}case 127:{e.switchMode("sg",!0),e.setPortMode(e.getTrackPort(c),1,w.sg);break}}break}case 1:{switch(a[1]){case 48:{e.dispatchEvent("mupromptex"),console.debug(`SG reverb type: ${bt[s]}`);break}}break}default:if(a[0]>>4==1){e.dispatchEvent("mupromptex");let i=e.chRedir(a[0]&15,c,!0);if(a[1]==2){let o=e.chRedir(s,c,!0);t(e,X)[i]=o,i!=o&&(e.buildRchTree(),console.info(`SG CH${i+1} receives from CH${o+1}`))}else a[1]==19&&(t(e,p)[g.cc*i+E[7]]=s)}else console.warn(`Unknown AKAI SG SysEx: ${a}`)}}),t(this,Xe).add([9],(a,c,d)=>{e.dispatchEvent("mupromptex"),console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremolo","phaser","rotary speaker","enhancer","flanger","EQ"][a[0]]||"off"}`)}),t(this,se).add([127,0],(a,c,d)=>{e.switchMode("motif");let s=new Uint8Array([127,1,...a]);t(e,se).run(s,c,d)}).add([127,1,0,0],(a,c,d)=>{e.switchMode("s90es");let s="S90/Motif ES system ",i=a[0];a.subarray(1).forEach((o,n)=>{([()=>{x(e,B,o*12900/16383),e.dispatchEvent("mastervolume",t(e,B))}][i+n]||(()=>{console.info(`Unrecognized ${s}ID: ${i+n}`)}))()})}).add([127,1,0,36,54,1],(a,c,d)=>{e.switchMode("s90es");let s="S90/Motif ES reverb ",i=a[0];a.subarray(1).forEach((o,n)=>{([()=>{e.setEffectTypeRaw(0,!1,o&15|112)},()=>{e.setEffectTypeRaw(0,!0,o)}][i+n]||(()=>{}))()}),e.dispatchEvent("efxreverb",e.getEffectType(0))}).add([127,1,0,37,54,2],(a,c,d)=>{e.switchMode("s90es");let s="S90/Motif ES chorus ",i=a[0];a.subarray(1).forEach((o,n)=>{([()=>{e.setEffectTypeRaw(1,!1,o&15|112)},()=>{e.setEffectTypeRaw(1,!0,o)}][i+n]||(()=>{}))()}),e.dispatchEvent("efxchorus",e.getEffectType(1))}).add([127,1,0,34,54,3],(a,c,d)=>{e.switchMode("s90es");let s="S90/Motif ES insert 1 ",i=a[0];a.subarray(1).forEach((o,n)=>{([()=>{e.setEffectTypeRaw(3,!1,o&15|112)},()=>{e.setEffectTypeRaw(3,!0,o)}][i+n]||(()=>{}))()}),e.dispatchEvent("efxinsert0",e.getEffectType(3))}).add([127,1,0,34,54,4],(a,c,d)=>{e.switchMode("s90es");let s="S90/Motif ES insert 2 ",i=a[0];a.subarray(1).forEach((o,n)=>{([()=>{e.setEffectTypeRaw(4,!1,o&15|112)},()=>{e.setEffectTypeRaw(4,!0,o)}][i+n]||(()=>{}))()}),e.dispatchEvent("efxinsert1",e.getEffectType(4))}).add([127,1,0,35,54,17],(a,c,d)=>{e.switchMode("s90es");let s="S90/Motif ES variation ",i=a[0];a.subarray(1).forEach((o,n)=>{([()=>{e.setEffectTypeRaw(2,!1,o&15|112)},()=>{e.setEffectTypeRaw(2,!0,o)}][i+n]||(()=>{}))()}),e.dispatchEvent("efxdelay",e.getEffectType(2))}).add([127,1,0,58,55],(a,c,d)=>{e.dispatchEvent("mupromptex"),e.switchMode("s90es");let s=e.getTrackPort(c);if(t(e,G)[s]&&t(e,G)[s]!=t(e,U).smotif)if(t(e,Ee).dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${c}. Port ${String.fromCharCode(65+s)} mode "${z[t(e,G)[s]]}" mismatch, should be "${z[t(e,U).smotif]}".`);return}else console.info(`Track ${c} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);let i=e.chRedir(a[0],c,!0),o=g.cc*i,n=a[1];a[0]>15&&(i=a[0]+32);let f=`Track ${c} S90/Motif ES bulk CH${i<128?i+1:"U"+(i-127)} `;console.debug(f,a),!(a[0]>15)&&a.subarray(2).forEach((l,m)=>{([()=>{t(e,p)[o+E[0]]=l,e.dispatchEvent("voice",{part:i})},()=>{l&&e.setChActive(i,1),t(e,p)[o+E[32]]=l,e.setChType(i,[32,40].indexOf(l)>-1?e.CH_DRUMS:e.CH_MELODIC,t(e,H),!0),e.dispatchEvent("voice",{part:i})},()=>{l&&e.setChActive(i,1),t(e,O)[i]=l,e.dispatchEvent("voice",{part:i})},()=>{let $=e.chRedir(l,c,!0);t(e,X)[i]=$,i!=$&&(e.buildRchTree(),console.info(`${f}receives from CH${$+1}`))},()=>{t(e,ee)[i]=l?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{l!=100&&e.setChActive(i,1),t(e,p)[o+E[7]]=l},()=>{l!=64&&e.setChActive(i,1),t(e,p)[o+E[10]]=l},!1,!1,!1,()=>{t(e,p)[o+E[91]]=l},()=>{l&&e.setChActive(i,1),t(e,p)[o+E[93]]=l},()=>{l&&e.setChActive(i,1),t(e,p)[o+E[94]]=l},()=>{l!=127&&e.setChActive(i,1),t(e,p)[o+E[128]]=l,e.allocateAce(i,128)},()=>{},()=>{l!=64&&e.setChActive(i,1),t(e,p)[o+E[74]]=l},()=>{l!=64&&e.setChActive(i,1),t(e,p)[o+E[71]]=l},!1,()=>{t(e,p)[o+E[65]]=l},()=>{t(e,p)[o+E[5]]=l},()=>{}][n+m]||(()=>{}))()})}).add([127,1,54,16],(a,c,d)=>{e.switchMode("s90es");let s=a[0];a.subarray(1).forEach((i,o)=>{let f=`S90/Motif ES EQ${(o>>2)+1} `;([()=>{let l=i-64},()=>{let l=Fe[i]},()=>{let l=i/10},()=>{let l=i}][s+o&3]||(()=>{}))()})}),t(this,ne).add([0,72,18,0,0,0,0],(a,c,d)=>{e.switchMode("sd",!0),e.setPortMode(e.getTrackPort(c),2,w.sd),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(a,c,d)=>{e.dispatchEvent("mupromptex");let s=a[0]>>5,i=a[0]&31;switch(s){case 0:{let o=a[0]>>1,n=a[1];switch(o){case 1:{a.subarray(2).forEach((f,l,m)=>{let $=l+n;switch($){case 0:{f&&(e.setEffectType(1,60,f-1),e.dispatchEvent("efxchorus",e.getEffectType(1)),console.debug(`SD MFX Cho: ${$} - ${f}`));break}}});break}case 2:{a.subarray(2).forEach((f,l)=>{let m=l+n;switch(m){case 0:{f&&(e.setEffectType(0,55+f,0),e.dispatchEvent("efxreverb",e.getEffectType(0)),console.debug(`SD MFX Rev: ${m} - ${f}`));break}}});break}case 3:case 4:case 5:{let f=o-1;a.subarray(2).forEach((l,m)=>{let $=m+n;switch(console.debug(`SD MFX ${f-2}: ${$} - ${l}`),$){case 0:{e.setEffectTypeRaw(f,62,l),e.dispatchEvent(`efx${f>2?"delay":"insert"+(f-4)}`,e.getEffectType(f));break}}}),console.debug(`SD MFX message:
%o`,a);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,a)}break}case 1:{let o=e.chRedir(i,c,!0),n=a[1],f=o*g.cc;a.subarray(2).forEach((l,m)=>{let $=n+m;$<37?([()=>{},()=>{},0,()=>{},()=>{switch(t(e,p)[f+E[0]]=l,l){case 104:case 105:case 106:case 107:case 120:{t(e,D)[o]||e.setChType(o,e.CH_DRUMS);break}default:t(e,D)[o]&&e.setChType(o,e.CH_MELODIC)}e.dispatchEvent("voice",{part:o})},()=>{t(e,p)[f+E[32]]=l,e.dispatchEvent("voice",{part:o})},()=>{t(e,O)[o]=l,e.dispatchEvent("voice",{part:o})},()=>{t(e,p)[f+E[7]]=l},()=>{t(e,p)[f+E[10]]=l},()=>{},()=>{},()=>{l<2&&(t(e,ee)[o]=l)},()=>{l<2&&(t(e,p)[f+E[68]]=l?127:0)},()=>{},()=>{l<2&&(t(e,p)[f+E[65]]=l?127:0)},()=>{t(e,p)[f+E[5]]=l&15<<4|t(e,p)[f+E[5]]&15},()=>{t(e,p)[f+E[5]]=l&15|(t(e,p)[f+E[5]]&240)>>4},()=>{t(e,p)[f+E[74]]=l},()=>{t(e,p)[f+E[71]]=l},()=>{t(e,p)[f+E[73]]=l},()=>{t(e,p)[f+E[72]]=l},0,0,0,0,0,0,0,()=>{t(e,p)[f+E[128]]=l,e.allocateAce(128)},()=>{t(e,p)[f+E[93]]=l},()=>{t(e,p)[f+E[91]]=l},0,0,()=>{t(e,p)[f+E[75]]=l},()=>{t(e,p)[f+E[76]]=l},()=>{t(e,p)[f+E[77]]=l},()=>{t(e,p)[f+E[78]]=l}][$]||(()=>{}))():$<63||($<64?(t(e,D)[o]?t(e,p)[f+E[0]]=104|l:t(e,p)[f+E[0]]=96|l,e.dispatchEvent("voice",{part:o})):console.debug(`Unknown SD-90 global CH${o+1} param setup message:
%o`,a))});break}case 2:{let o=e.chRedir(i,c,!0),n=a[1];console.debug(`Unknown SD-90 global CH${o+1} MIDI setup message:
%o`,a.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,a)}}),t(e,me).add([0,1,73,78],(a,c,d)=>{e.switchMode("krs"),e.setPortMode(e.getTrackPort(c),1,w.krs),console.debug("Might be KORG KROSS 2 mode reset... Not sure.")}).add([0,1,73,117,2,37],(a,c,d)=>{e.switchMode("krs");let s=e.getTrackPort(c);if(t(e,G)[s]&&t(e,G)[s]!=w.krs)if(t(e,Ee).dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled. Port ${String.fromCharCode(65+s)} mode "${z[t(e,G)[s]]}" mismatch, should be "krs".`);return}else console.info(`Track ${c} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);e.setPortMode(e.getTrackPort(c),1,w.krs);let i="KROSS 2 BMT1 ",o="";le(a,(n,f)=>{if(f<24)o+=String.fromCharCode(Math.max(32,n));else if(!(f<1276)){let l=f-1276,m=e.chRedir(Math.floor(l/44),c,!0),$=l%44,S=g.cc*m;$<15?([()=>{n&&e.setChActive(m,1),t(e,O)[m]=n,e.dispatchEvent("voice",{part:m})},()=>{n&&e.setChActive(m,1),n<10?(t(e,p)[S+E[0]]=63,t(e,p)[S+E[32]]=n):n<20?(t(e,p)[S+E[0]]=121,t(e,p)[S+E[32]]=n-10):n<24&&(t(e,p)[S+E[0]]=[120,0,56,62][n-20],t(e,p)[S+E[32]]=0),e.dispatchEvent("voice",{part:m})},()=>{let L=e.chRedir(n&15,c,!0);t(e,X)[m]=L,console.info(`${i}CH${m+1} receives from CH${L+1}`)},!1,!1,()=>{t(e,p)[S+E[7]]=n},!1,()=>{},()=>{},!1,!1,!1,!1,!1,()=>{t(e,p)[S+E[10]]=n||128}][$]||(()=>{}))():$<36||([()=>{t(e,p)[S+E[74]]=(n+128&255)-64},()=>{t(e,p)[S+E[71]]=(n+128&255)-64},!1,!1,()=>{t(e,p)[S+E[73]]=(n+128&255)-64},()=>{t(e,p)[S+E[75]]=(n+128&255)-64},!1,()=>{t(e,p)[S+E[72]]=(n+128&255)-64}][$]||(()=>{}))()}}),o=o.trimRight(),e.dispatchEvent("metacommit",{type:"EORTitle",data:o})})}chRedir(e,r,h){let u=this;if(t(u,Pe)[r])return(t(u,Pe)[r]-1)*16+e;if(t(u,H)==w.sc){if(h==1)return e;let b=0,v=!0;for(;v;)t(u,Se)[e+b]==0?(t(u,Se)[e+b]=r,console.debug(`Assign track ${r} to channel ${e+b+1}.`),v=!1):t(this,Se)[e+b]==r?v=!1:(b+=16,b>=128&&(b=0,v=!1));return e+b}else return e}getTrackPort(e){return this.chRedir(0,e,!0)>>4}forceVoiceRefresh(){for(let e=0;e<g.ch;e++)t(this,ce)[e]&&this.dispatchEvent("voice",{part:e})}buildRchTree(){let e=[];t(this,X).forEach((r,h)=>{var u;r<g.ch&&((u=e[r])!=null&&u.constructor||(e[r]=[]),e[r].push(h))}),x(this,ct,e)}buildRccMap(){let e=this;for(let r=0;r<g.ch;r++)t(e,He)[r]={};t(e,Le).forEach((r,h)=>{r&&(t(e,He)[Math.floor(h/g.redir)][r]=h%g.redir|128)}),P()&&console.debug(t(e,He))}getActive(){return t(this,ce)}getCc(e){let r=this,h=e*g.cc,u=t(r,p).subarray(h,h+g.cc);return u[E[0]]=u[E[0]]||t(r,I)[r.getChModeId(e)][0],u[E[32]]=u[E[32]]||t(r,I)[r.getChModeId(e)][1],u[E[0]]==Oe.bank0&&(u[E[0]]=0),u}getCcCh(e,r){let h=this;if(at.indexOf(r)<0)throw new Error("CC number not accepted");let u=t(h,p)[g.cc*e+E[r]];switch(r){case 0:{u=u||t(h,I)[h.getChModeId(e)][0],u==Oe.bank0&&(u=0);break}case 32:{u=u||t(h,I)[h.getChModeId(e)][1];break}}return u}getCcAll(){let e=this,r=t(e,p).slice();for(let h=0;h<g.ch;h++){let u=h*g.cc;r[u+E[0]]=r[u+E[0]]||t(e,I)[e.getChModeId(h)][0],r[u+E[32]]=r[u+E[32]]||t(e,I)[e.getChModeId(h)][1],r[E[0]]==Oe.bank0&&(r[E[0]]=0)}return r}getChSource(){return t(this,X)}getChType(){return t(this,D)}setChType(e,r,h=0,u=!1){r&=15;let b=this;h=h||b.getChModeId(e),t(b,D)[e]=r,r>0&&!u&&(t(b,p)[e*g.cc+E[0]]=t(b,I)[h][2])}setChActive(e,r=0){t(this,ce)[e]!=r&&this.dispatchEvent("channeltoggle",{part:e,active:r}),t(this,ce)[e]=r}getExt(e){let r=g.ext*e,h=t(this,te).subarray(r,r+g.ext),u=new Uint8Array(h.length);return u.set(h),u[1]=u[1]||t(this,lt),u}getPitch(){return t(this,ke)}getProgram(){return t(this,O)}getTexts(){return t(this,re).slice()}getVel(e){let r=new Map,h=this;return t(h,F).forEach(function(u,b){let v=Math.floor(u/128),k=u%128;e==v&&t(h,V)[u]>0&&r.set(k,{v:t(h,V)[u],s:t(h,K)[b]})}),r}getBitmap(){return{bitmap:t(this,ie,ve),expire:t(this,fe)}}getLetter(){return{text:t(this,Re),set:t(this,it),expire:t(this,De)}}getMode(){return z[t(this,H)]}getMaster(){return{volume:t(this,B)}}getRawStrength(){let e=this;return t(this,F).forEach(function(r){let h=Math.floor(r/128);t(e,V)[r]>t(e,ge)[h]&&(t(e,ge)[h]=t(e,V)[r])}),t(this,ge)}getStrength(){let e=[],r=this;return this.getRawStrength().forEach(function(h,u){e[u]=Math.floor(h*t(r,p)[u*g.cc+E[7]]*t(r,p)[u*g.cc+E[11]]*t(r,B)/803288)}),e}getRpn(){return t(this,R)}getNrpn(){return t(this,Ke)}getSubDb(){return self==null?void 0:self.structuredClone(t(this,I))}getVoice(e,r,h,u="?"){var d;let b=this;(d=w[u])!=null&&d.constructor||(u="?");let v=w[u],k=e||t(b,I)[v][0],M=r,a=h||t(b,I)[v][1];k==Oe.bank0&&(k=0),a==Oe.bank0&&(a=0),u=="ns5r"&&k>0&&k<56&&(a=3);let c=b.userBank.get(k,M,a,u);if(u=="mt32"&&c.name.indexOf("MT-m:")==0){let s=parseInt(c.name.slice(5)),i=s*g.cmt,o="";t(b,Te).subarray(i,i+10).forEach(f=>{f>31&&(o+=String.fromCharCode(f))});let n=`MSB	LSB	PRG	NME
0	127	${M}	${o}`;b.userBank.load(n,!0),c.name=o,c.ending=" "}return(c.ending!=" "||!c.name.length)&&(c=b.baseBank.get(k,M,a,u)),c}getChVoice(e){let r=this,h=r.getVoice(r.getCcCh(e,0),t(r,O)[e],r.getCcCh(e,32),r.getChMode(e));if(t(r,ue)[e]){let u="";switch(t(r,H)){case w.mt32:{t(r,pe).subarray(g.cmt*(e-1),g.cmt*(e-1)+10).forEach(b=>{u+=String.fromCharCode(Math.max(b,32))}),u=u.trimRight();break}default:{let b=g.cvn*e;t(r,rt).subarray(b,b+g.cvn).forEach(v=>{u+=String.fromCharCode(Math.max(v,32))}),u=u.trimRight()}}u.length&&(h.ending="~",h.name=u)}return h}getRawPitch(){return t(this,ke)}getPitchShift(e){let r=this,h=e*g.rpn,u=t(r,R)[h];return t(r,A)[e*g.rpnt]||t(r,H)==w.mt32&&(u=12),t(r,ke)[e]/8192*u+(t(r,R)[h+3]-64)+((t(r,R)[h+1]<<7)+t(r,R)[h+2]-8192)/8192}getEffectType(e=0){let r=3*e+1;return t(this,ae).subarray(r,r+2)}setEffectTypeRaw(e=0,r,h){let u=3*e;t(this,ae)[u]=1,t(this,ae)[u+1+ +r]=h}setEffectType(e=0,r,h){this.setEffectTypeRaw(e,!1,r),this.setEffectTypeRaw(e,!0,h)}getEffectSink(){return t(this,ze)}setLetterDisplay(e,r,h=0,u=3200){let b=this,v;x(b,Re," ".repeat(h)),e.forEach(k=>{x(b,Re,t(b,Re)+String.fromCharCode(k>31?k:32)),k<32&&(v=v||new Set,v.add(k))}),x(b,it,Date.now()),x(b,De,Date.now()+u),v&&(v=Array.from(v),v.forEach((k,M,a)=>{a[M]=k.toString(16).padStart(2,"0")}),console.warn(`${r}${r?" ":""}invalid code point${v.length>1?"s":""}: 0x${v.join(", 0x")}`))}setDetectionTargets(e="?",r=0){let h=this,u=-1;switch(e.replaceAll(", ",",").split(",").forEach(b=>{b=b.toLowerCase();let v=z.indexOf(ea[b]||b);P()&&console.debug(`Mapped mode "${b}" to ID "${v}".`),v>-1&&(u=v)}),P()&&console.debug(`Set detection target to ID "${u}".`),u>0&&(t(h,U).x5=82,t(h,U).ds=w.krs),u){case w["05rw"]:{t(h,U).x5=81;break}case w.s90es:t(h,U).ds=w.s90es,t(h,U).smotif=w.s90es;case w.motif:t(h,U).ds=w.motif,t(h,U).smotif=w.motif}}setGsTargets(e=!1,r=4){if(!r)r=e?3:4;else{if(r>4||r<0)throw new Error(`Invalid GS level ${r}`);if(e&&r>>1!=1)throw new Error(`Invalid SC level ${r}`)}let h=this;t(h,U)[e?"sc":"gs"]=r,t(h,I)[w[e?"sc":"gs"]][1]=r,h.forceVoiceRefresh()}getConfigs(){return t(this,st)}setDumpLimit(e){if(e>2||e<0)throw new RangeError("Invalid dump limit.");t(this,Ee).dumpLimit=e}allocateAce(e=0,r){let h=this;if(!r||r<128&&r>95){console.warn(`cc${r} cannot be allocated as an active custom effect.`);return}let u=!0,b=0,v=g.ace*e;for(;u&&b<g.ace;)t(h,q)[b+v]==r?u=!1:t(h,q)[b+v]||(u=!1,t(h,q)[b+v]=r,console.info(`Allocated cc${r} to ACE slot ${b} in CH${e+1}.`)),b++;b>=g.ace&&console.warn(`ACE slots are full in CH${e+1}.`)}allocateAceAll(e){let r=this;if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}for(let h=0;h<g.ch;h++){let u=!0,b=0,v=g.ace*h;for(;u&&b<g.ace;)t(r,q)[b+v]==e?u=!1:t(r,q)[b+v]||(u=!1,t(r,q)[b+v]=e),b++;b>=g.ace&&console.warn(`ACE slots are full in CH${h+1}.`)}}releaseAce(e=0,r){let h=!0,u=g.ace*e,b=u+g.ace;for(;h&&u<b;)t(this,q)[u]==r&&(t(this,q)[u]=0,h=!1),u++;h&&P()&&console.debug(`No ACE slot was allocated to cc${r} in CH${e+1}.`)}resetAce(){t(this,q).fill(0),console.info("All ACE slots have been reset.")}getAce(){return t(this,q)}getChAce(e=0,r=0){if(r<0||r>=g.ace)throw new RangeError("No such ACE slot");let h=t(this,q)[g.ace*e+r];if(h){if(at.indexOf(h)>=0)return t(this,p)[e*g.cc+E[h]];throw new Error(`Invalid ACE source in CH${e+1}: ${h}`)}else return 0}initDrums(){let e=this;t(e,j).fill(64);for(let r=0;r<g.drm;r++){let h=r*g.dpn;for(let u in Xt){let b=Xt[u],v=(h+de[u])*g.dnc;t(e,j).subarray(v,v+g.dnc).fill(b)}}}init(e=0){let r=this;x(r,Ue,0),t(r,I)[w.xg][1]=0,r.dispatchEvent("banklevel",{mode:"xg",data:0}),t(r,ce).fill(0),t(r,p).fill(0),t(r,q).fill(0),t(r,O).fill(0),t(r,V).fill(0),t(r,F).fill(0),t(r,ee).fill(0),t(r,ge).fill(0),t(r,ke).fill(0),t(r,Ke).fill(0),t(r,A).fill(0),t(r,te).fill(0),t(r,G).fill(0),t(r,Ce).fill(0),t(r,Le).fill(0),x(r,B,100),x(r,re,[]),x(r,qe,500),x(r,Qe,0),x(r,fe,0),x(r,W,0),t(r,ie,ve).fill(0),x(r,N,!1),x(r,Ye,0),x(r,ye,!0),r.initDrums(),t(r,X).forEach(function(h,u,b){b[u]=u}),e==0&&(r.dispatchEvent("mode","?"),x(r,H,0),t(r,Se).fill(0),t(r,Pe).fill(0),x(r,De,0),x(r,Re,"")),Ht.forEach(h=>{t(r,p)[g.cc*h]=t(r,I)[r.getChModeId(h)][2]}),t(r,D).fill(r.CH_MELODIC),t(r,D)[9]=r.CH_DRUM1,t(r,D)[25]=r.CH_DRUM3,t(r,D)[41]=r.CH_DRUMS,t(r,D)[57]=r.CH_DRUMS,t(r,D)[73]=r.CH_DRUM5,t(r,D)[89]=r.CH_DRUM7,t(r,D)[105]=r.CH_DRUMS,t(r,D)[121]=r.CH_DRUMS;for(let h=0;h<g.drm;h++)t(r,he)[h<<1]=0,t(r,he)[h<<1|1]=g.invalidCh;t(r,We).fill(0),t(r,Te).fill(0),t(r,Me).fill(0),t(r,pe).fill(0),t(r,ue).fill(0),t(r,ae).fill(0),t(r,ze).fill(0),r.aiEfxName="",r.userBank.clearRange({msb:0,lsb:127,prg:[0,127]});for(let h=0;h<g.ch;h++){let u=h*g.cc;t(r,p)[u+E[7]]=100,t(r,p)[u+E[11]]=127,t(r,p)[u+E[2]]=127,t(r,p)[u+E[10]]=64,t(r,p).subarray(u+E[71],u+E[71]+8).fill(64),t(r,p)[u+E[128]]=127,t(r,p).subarray(u+E[130],u+E[157]+1).fill(64),t(r,p)[u+E[91]]=40,t(r,p)[u+E[101]]=127,t(r,p)[u+E[100]]=127,t(r,p)[u+E[99]]=127,t(r,p)[u+E[98]]=127;let b=h*g.rpn;t(r,R)[b]=2,t(r,R)[b+1]=64,t(r,R)[b+2]=0,t(r,R)[b+3]=64,t(r,R)[b+4]=0,t(r,R)[b+5]=0;let v=h*g.ext;t(r,te)[v+1]=r.VLBC_BRTHEXPR;let k=h*g.redir;t(r,Le)[k+8]=13}r.buildRchTree(),r.buildRccMap(),r.dispatchEvent("mastervolume",t(r,B)),r.dispatchEvent("efxreverb",r.getEffectType(0)),r.dispatchEvent("efxchorus",r.getEffectType(1)),r.dispatchEvent("efxdelay",r.getEffectType(2)),r.dispatchEvent("efxinsert0",r.getEffectType(3)),r.dispatchEvent("efxinsert1",r.getEffectType(4)),r.dispatchEvent("efxinsert2",r.getEffectType(5)),r.dispatchEvent("efxinsert3",r.getEffectType(6)),r.dispatchEvent("reset"),r.switchMode("?")}setChMode(e,r){let h=this;if(e<0||e>=g.ch)throw new RangeError(`Invalid CH${e+1}`);if(port<0||r>=z.length)throw new RangeError(`Invalid mode ID ${r}`);t(h,Ce)[e]=r,h.dispatchEvent("voice",{part:e})}getChMode(e,r){return z[this.getChModeId(e,r)]}getChModeId(e,r){return r?t(this,Ce)[e]||t(this,G)[e>>4]:t(this,Ce)[e]||t(this,G)[e>>4]||t(this,H)}setPortMode(e,r,h){let u=this;if(e<0||e>=g.ch>>4)throw new RangeError(`Invalid port ${e+1}`);if(r<1)throw new RangeError("Range must be a positive integer");if(e+r>=g.ch>>4)throw new RangeError("Range must be in bound");if(e<0||h>=z.length)throw new RangeError(`Invalid mode ID ${h}`);for(let b=e;b<e+r;b++){t(u,G)[b]=h;for(let v=b<<4;v<b+1<<4;v++)u.dispatchEvent("voice",{part:v})}}copyChSetup(e,r,h){if(e==r){console.warn(`Failed attempt at overwriting CH${e+1} with its own data.`);return}let u=this;if(h&&t(u,ce)[r]){console.warn(`Failed attempt at copying setup data from CH${e+1} to CH${r+1}.`);return}let b=g.cc*e,v=g.cc*r;t(u,O)[r]=t(u,O)[e],t(u,p).set(t(u,p).subarray(b,b+g.cc),v)}setDrumFirstWrite(e,r){let h=this,u=t(h,D)[e];if(u<2)return;let b=u-2;if(t(h,he)[b<<1]){if(r)t(h,he)[b<<1]=0,P()&&console.debug(`First write part for drum set ${b+1} has been reset.`);else return;}else r?console.warn(`First write part for drum set ${b+1} is already blank.`):(t(h,he)[b<<1]=1,t(h,he)[b<<1|1]=e,console.debug(`First write part for drum set ${b+1} is set to CH${e+1}.`))}getChDrumFirstWrite(e){let r=this,h=t(r,D)[e];if(h<2)return;let u=h-2;return t(r,he).subarray(u<<1,u+1<<1)}getDrumFirstWrite(e){if(e>=0&&e<g.drm)return t(this,he).subarray(e<<1,e+1<<1)}switchMode(e,r=!1,h=!1){var v;let u=this,b=w[e];if(b>-1){if(t(u,H)==0||r){let k=t(u,H);u.initOnReset&&r&&(this.init(1),k=w["?"]),x(u,H,b),x(u,W,0);for(let a=0;a<g.ch;a++)t(u,D)[a]>0&&t(u,Ce)[a]==0&&(t(u,p)[a*g.cc]=t(u,I)[b][2]);switch(b){case w.mt32:{Et.forEach((a,c)=>{let d=c+1;t(u,ce)[d]||(t(u,O)[d]=a,t(u,p)[d*g.cc+E[91]]=127)});for(let a=1;a<10;a++)u.dispatchEvent("voice",{part:a});break}}let M;switch(b){case w["?"]:case w.g2:{M=[52,4,52,18,0,0,0,0];break}case w.xg:{M=[1,0,65,0,5,0,0,0];break}case w.gm:case w.gs:case w.sc:{M=[40,4,40,18,40,32,32,0];break}case w.sd:{M=[58,0,60,0,61,0,61,0];break}case w["05rw"]:case w.x5d:case w.ns5r:{M=[44,1,44,19,44,0,44,0];break}case w.k11:case w.sg:{M=[24,0,0,0,0,0,0,0];break}case w.mt32:{M=[40,4,0,0,0,0,0,0];break}case w.doc:{M=[24,16,0,0,0,0,0,0];break}case w.motif:case w.s90es:{M=[113,0,117,0,114,0,0,0];break}default:M=[0,0,0,0,0,0,0,0]}for(let a=0;a<g.efx;a++)!t(u,ae)[3*a]&&(v=M[a<<1])!=null&&v.constructor&&(t(u,ae)[3*a+1]=M[2*a],t(u,ae)[3*a+2]=M[2*a+1],u.dispatchEvent(`efx${["reverb","chorus","delay","insert0"][a]}`,u.getEffectType(a)));h&&u.setDetectionTargets(e),u.dispatchEvent("mode",e),u.forceVoiceRefresh(),Ht.forEach(a=>{u.dispatchEvent("voice",{part:a})})}}else throw new Error(`Unknown mode ${e}`)}newStrength(){t(this,ge).fill(0)}runJson(e){var r;if(e.type>14)return e.type==15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),t(this,nt)[e.type].call(this,e);{let h=this.chRedir(e.part,e.track),u=!1;(r=t(this,ct)[h])==null||r.forEach(b=>{e.channel=b,u=!0,t(this,nt)[e.type].call(this,e)}),u||console.warn(`${Bt[e.type]?Bt[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${h+1} without any recipient.`)}t(this,re).length>100&&t(this,re).splice(100,t(this,re).length-99)}runRaw(e){}async loadBank(e,r){let h=this;switch(e=e.toLowerCase(),e){case"s7e":{h.userBank.clearRange({msb:63,lsb:[21,22]}),h.userBank.clearRange({msb:63,lsb:[24,27]});break}case"pcg":{h.userBank.clearRange({msb:63,lsb:[6,9]}),h.userBank.clearRange({msb:63,lsb:[13,16]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":case"pcg":{Je.context=this,await h.userBank.load(await Je.read(e,r),!1);break}}h.forceVoiceRefresh()}},H=new WeakMap,W=new WeakMap,fe=new WeakMap,we=new WeakMap,ie=new WeakSet,ve=function(){return t(this,we)[t(this,W)]},zt=function(e){t(this,we)[t(this,W)]=e},ce=new WeakMap,X=new WeakMap,D=new WeakMap,p=new WeakMap,q=new WeakMap,O=new WeakMap,V=new WeakMap,ee=new WeakMap,F=new WeakMap,K=new WeakMap,ke=new WeakMap,ge=new WeakMap,Ae=new WeakMap,te=new WeakMap,R=new WeakMap,A=new WeakMap,Ke=new WeakMap,j=new WeakMap,he=new WeakMap,ae=new WeakMap,ze=new WeakMap,Le=new WeakMap,G=new WeakMap,Ce=new WeakMap,ue=new WeakMap,rt=new WeakMap,Me=new WeakMap,pe=new WeakMap,We=new WeakMap,Te=new WeakMap,I=new WeakMap,U=new WeakMap,Ee=new WeakMap,st=new WeakMap,B=new WeakMap,Ue=new WeakMap,qe=new WeakMap,Qe=new WeakMap,Re=new WeakMap,De=new WeakMap,it=new WeakMap,Ye=new WeakMap,ye=new WeakMap,N=new WeakMap,lt=new WeakMap,ct=new WeakMap,He=new WeakMap,re=new WeakMap,Se=new WeakMap,Pe=new WeakMap,Q=new WeakMap,Be=new WeakMap,_=new WeakMap,nt=new WeakMap,dt=new WeakMap,Ie=new WeakMap,Ne=new WeakMap,se=new WeakMap,ne=new WeakMap,me=new WeakMap,Ge=new WeakMap,_e=new WeakMap,Xe=new WeakMap,Kt);export{za as OctaviaDevice,g as allocated,E as ccToPos,de as dnToPos,Oe as overrides};