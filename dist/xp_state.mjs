var It=Object.defineProperty;var Xt=(E,e,r)=>e in E?It(E,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):E[e]=r;var R=(E,e,r)=>(Xt(E,typeof e!="symbol"?e+"":e,r),r),pt=(E,e,r)=>{if(!e.has(E))throw TypeError("Cannot "+r)};var a=(E,e,r)=>(pt(E,e,"read from private field"),r?r.call(E):e.get(E)),x=(E,e,r)=>{if(e.has(E))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(E):e.set(E,r)},w=(E,e,r,h)=>(pt(E,e,"write to private field"),h?h.call(E,r):e.set(E,r),r);(function(){var E=function(m,k,t){var s,c;if(self.MessageEvent)switch(m){case"message":{c=new MessageEvent(m,{data:k,ports:t==null?void 0:t.ports}),Object.defineProperty(c,"source",{value:t==null?void 0:t.source});break}default:c=new Event(m)}else c=document.createEvent("Event"),c.initEvent(m,!1,!1),t&&m=="message"&&(c.data=k,t.source&&Object.defineProperty(c,"source",{value:t.source}),(s=t.ports)!=null&&s.length&&Object.defineProperty(c,"ports",{value:t.ports}));return c};self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),r=[],h={},b=function(m){var k,t=this;if((this==null?void 0:this.constructor)!=b)throw new TypeError("Illegal constructor");r.push(this),(k=h[m])!=null&&k.constructor||(h[m]=[]),h[m].push(this);var s=Math.floor(Math.random()*281474976710656),c=[],n=0,i=[],d=!0,l=!1;Object.defineProperty(this,"id",{get:function(){return s}}),Object.defineProperty(this,"name",{value:m}),this.close=function(){var f,$=r.indexOf(t);$>-1?(e.postMessage({t:"d",c:m,i:s}),r.splice($,1),(f=h[m])!=null&&f.constructor&&($=h[m].indexOf(t),$>-1&&h[m].splice($,1)),h[m].length||delete h[m],console.debug("[Snowy] BroadcastChannel closed."),l=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(f){if(e){if(l)throw new Error("Channel already closed");e.postMessage({t:"m",c:m,i:s,m:n,d:f}),n++,n>4294967295&&(n=0)}else i.push(f),console.debug("[Snowy] Message is cached.")},this.flush=function(){if(e){if(d){for(e.postMessage({t:"r",c:m,i:s}),console.debug("[Snowy] ".concat(i.length," message(s) in cache."));i.length;){var f=i.shift();t.postMessage(f)}d=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(f){f.c==m?f.i!=s&&t.dispatchEvent(E("message",f.d,{source:t})):console.debug("[Snowy] Channel ID mismatch. Instance ".concat(s," receives from ").concat(m,", not ").concat(f.c,"."))};var o={};this.dispatchEvent=function(f){var $,v;if(Object.defineProperty(f,"target",{value:t}),Object.defineProperty(f,"currentTarget",{value:t}),($=o[f.type])!=null&&$.length)for(var T=o[f.type],B=0;B<T.length;B++)((v=T[B])==null?void 0:v.constructor)==Function&&T[B].call(t,f);t["on".concat(f.type)]&&t["on".concat(f.type)].constructor==Function&&t["on".concat(f.type)].call(t,f)},this.addEventListener=function(f,$){var v;(v=o[f])!=null&&v.constructor||(o[f]=[]);var T=o[f].indexOf($);T==-1&&o[f].push($)},this.removeEventListener=function(f,$){var v,T;if((v=o[f])!=null&&v.length){var B=o[f].indexOf($);B>-1&&o[f].splice(B,1)}!((T=o[f])!=null&&T.length)&&o[f].constructor&&delete o[f]}},self.BroadcastChannel=b,g=function(){if(e){e.addEventListener("message",function(k){var t=k.data,s=!1;switch(t.t){case"k":{s=!1,e.postMessage({t:"k"});break}case"m":{var c=h[t.c];if(c!=null&&c.length)for(var n=0;n<c.length;n++)c[n].receiveMessage(t);break}case"c":{for(var i=[],d=0;d<r.length;d++){var l=r[d].name;i.indexOf(l)<0&&i.push(l)}e.postMessage({t:"k",c:i});break}default:s=!0}s&&console.info("ReceiveBroadcast",t)});for(var m=0;m<r.length;m++)r[m].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},S=function(){if(!e){var m=new SharedWorker(self.SNOWY_PATH||"/snowy.js");m.port.start();var k=function(t){t.data.t=="swc"&&(m.port.removeEventListener("message",k),e=m.port,e.postMessage({t:"k"}),g())};m.port.addEventListener("message",k)}},S());var e,r,h,b,g,S})();{let E=function(e,r){let h=new FileReader;return new Promise((b,g)=>{switch(h.addEventListener("abort",()=>{g(new Error("Blob read aborted"))}),h.addEventListener("error",S=>{g(h.error||S.data||new Error("Blob read error"))}),h.addEventListener("load",()=>{b(h.result)}),r.toLowerCase()){case"arraybuffer":case"buffer":{h.readAsArrayBuffer(e);break}case"string":case"text":{h.readAsText(e);break}default:g(new Error(`Unknown target ${r}`))}})};Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||function(){return E(this,"buffer")},Blob.prototype.text=Blob.prototype.text||function(){return E(this,"text")}}String.prototype.replaceAll=String.prototype.replaceAll||function(E,e){let r=0,h=16,b=this,g=[];for(;r<h&&b.lastIndexOf(E)>-1;){let S=b.lastIndexOf(E);g.unshift(b.slice(S+E.length)),b=b.slice(0,S),S==0&&g.unshift(""),r++}return b.length&&g.unshift(b),g.join(e)||""},String.prototype.padStart=String.prototype.padStart||function(E,e){if(e){let r=this;for(;r.length<E;)r=`${e}${r}`;return r}},String.prototype.padEnd=String.prototype.padEnd||function(E,e){if(e){let r=this;for(;r.length<E;)r+=e;return r}};var bt=function(E,e){let r=Math.min(E.length,e.length),h=E.slice(0,r),b=e.slice(0,r),g=0,S=0;for(;S<r&&g==0;)g=Math.sign(h[S]-b[S]),S++;return g},ie=function(E=""){this.name=E,this.pool=[],this.point=function(e,r=!1){if(this.pool.length>0){let h=this.pool.length,b=1<<Math.floor(Math.log2(h)),g=b,S=64;for(;b>=1&&S>=0;){if(S<=0)throw new Error("TTL reached.");if(g==h)g-=b;else{let k=bt(e,this.pool[g]);switch(k){case 0:{S=0;break}case 1:{g+b<=h&&(g+=b);break}case-1:{g!=0&&(g-=b);break}default:console.warn(`Unexpected result ${k}.`)}}b=b>>1,S--}let m=!0;if(g>=this.pool.length)m=!1;else{let k=this;this.pool[g].forEach(function(t,s,c){m&&t!=e[s]&&(m=!1)}),!m&&bt(e,this.pool[g])>0&&g++}return m||r?g:-1}else return r?0:-1},this.add=function(e,r){return e.data=r,this.pool.splice(this.point(e,!0),0,e),this},this.default=function(e){console.warn(`No match in "${this.name||"(unknown)"}" for "${e}". Default action not defined.`)},this.get=function(e){let r=this.point(e);if(r>-1)return this.pool[r].data;this.default(e)},this.run=function(e,...r){let h=this.point(e);h>-1?e.subarray?this.pool[h].data(e.subarray(this.pool[h].length),...r):this.pool[h].data(e.slice(this.pool[h].length),...r):this.default(e,...r)}};var q,yt,gt=(yt=class{constructor(){x(this,q,{})}addEventListener(E,e){a(this,q)[E]||(a(this,q)[E]=[]),a(this,q)[E].unshift(e)}removeEventListener(E,e){if(a(this,q)[E]){let r=a(this,q)[E].indexOf(e);r>-1&&a(this,q)[E].splice(r,1),a(this,q)[E].length<1&&delete a(this,q)[E]}}dispatchEvent(E,e){var b;let r=new Event(E),h=this;r.data=e,((b=a(this,q)[E])==null?void 0:b.length)>0&&a(this,q)[E].forEach(function(g){try{g==null||g.call(h,r)}catch(S){console.error(S)}}),this[`on${E}`]&&this[`on${E}`](r)}},q=new WeakMap,yt);var Vt=["MSB","PRG","LSB","NME","ELC","DRM"],ct=function(E){let e=Math.floor(E/10),r=E%10;return`${e.toString(16)}${r}`},K,Et,ot=(Et=class{constructor(...E){x(this,K,void 0);R(this,"strictMode",!1);this.loadFiles(...E)}get(E=0,e=0,r=0,h){var f,$;let b=[E,e,r],g,S=1,m=0,k,t=Array.from(arguments);switch(h){case"xg":{switch(E){case 0:{r==126?t[2]=125:r==127&&(t[2]=0);break}case 16:{r==126&&(t[2]=0);break}case 32:{r>125&&(t[2]=0),t[2]+=4;break}case 33:case 34:case 35:case 36:{r>125&&(t[2]=0),t[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:t[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{r==126&&(t[2]=0);break}case 48:case 64:case 126:case 127:{r==126&&(t[2]=0);break}}break}case"gs":{E==0&&r<5?t[2]=0:E>125&&r<5&&r!=2&&(t[2]=E,t[0]=0);break}case"g2":case"sd":{E>>1==40?t[2]|=16:E>95&&E<100&&(t[2]|=16,e>>3==15&&(t[0]=96));break}case"sg":{E==8&&r==0&&(t[2]=5);break}case"s90es":{r<8?t[2]+=17:r<32?t[2]+=13:t[2]=(t[2]>>3)+19;break}case"motif":{r<8?t[2]+=28:r<32?t[2]+=13:t[2]=(t[2]>>3)+19;break}}let s=" ",c="M",n=0,i=0;switch(t[0]){case 0:{t[2]==127?c="MT-a":t[2]==126?c="MT-b":t[2]==7?c="GM-k":t[2]==5?c="SG-a":t[2]==4?c="SP-l":t[2]==0||h=="gs"&&t[2]<5?c="GM-a":(c="y",n=3);break}case 8:{h=="sg"?c="GM-s":c="r:";break}case 32:case 33:case 34:case 35:case 36:{h=="xg"&&(c=`${["AP","VL","PF","DX","AN"][E&7]}-${"abcdefgh"[r]}`);break}case 48:{c=`yM${(t[2]>>3).toString().padStart(2,"0")}`,n=1;break}case 56:{c="GM-b";break}case 61:case 120:{c="rDrm";break}case 62:{c="kDrm";break}case 63:{if(t[2]<17){let v=t[2];c=v<10?"kP:":"kC:",c+=v%10}else t[2]<34?c=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][t[2]-17]:c="Ds";break}case 64:{c="ySFX";break}case 67:{c="DX:S";break}case 80:case 81:case 82:case 83:{c=`Prg${"UABC"[t[0]-80]}`;break}case 88:case 89:case 90:case 91:{c=`Cmb${"UABC"[t[0]-88]}`;break}case 95:{c=`${["DR","PC"][t[2]]}-d`;break}case 96:{c=t[2]==106?"AP-a":t[2]>>4==1?"SDg":"PF",t[2]>63?i=63:t[2]>>4==1&&(i=16),n=3;break}case 97:{c=t[2]>>4==1?"SDa":"VL:",n=3,t[2]>>4==1?i=16:i=112;break}case 98:{c=t[2]>>4==1?"SDb":"SG-a",n=3,i=16;break}case 99:{c=t[2]>>4==1?"SDc":"DX",t[2]>63?i=63:t[2]>>4==1&&(i=16),n=3;break}case 100:{c="AN",t[2]>63?i=63:t[2]>>4==1&&(i=16),n=3;break}case 104:case 105:case 106:case 107:{c="SDd",i=104;break}case 121:{c=`GM-${t[2]?"":"a"}`,n=3;break}case 122:{c="lDrm";break}case 126:{c="yDrS";break}case 127:{t[2]==127?c="rDrm":c="yDrm";break}default:t[0]<48?c="r:":c="M"}c.length<4&&(c+=`${[E,r,t[0],t[2]][n]-i}`.padStart(4-c.length,"0")),h=="xg"&&(E==0?t[2]<100?c=c.replace("y0","y:"):t[2]==125&&(c="y126"):E==16?(g=`Voice${((t[2]<<7)+t[1]+1).toString().padStart(3,"0")}`,s=" "):E==35&&r>>1==2&&(g=`DXCH_${(((t[2]&1)<<7)+e+1).toString().padStart(3,"0")}`,s=" "));let d=[t[0],t[1],t[2]];for(;!((g==null?void 0:g.length)>=0);)if(g=(f=a(this,K)[t[1]||0][(t[0]<<7)+t[2]])==null?void 0:f.name,g){let v=a(this,K)[t[1]||0][(t[0]<<7)+t[2]];S=(v==null?void 0:v.poly)||S,m=(v==null?void 0:v.type)||m,k=v==null?void 0:v.drum}else if(this.strictMode)g="",s="?";else if(t[0]==0&&t[1]==0&&t[2]==0)g="Unloaded";else if(a(this,K)[t[1]||0][t[0]<<7])t[0]==0?(t[2]=0,s="^"):t[2]<1?(t[0]=0,s="*"):(t[2]--,s="^");else if(E==48)t[0]=0,t[2]=0,s="!";else if(E==62)t[1]--,s=" ",t[1]<1&&!(g!=null&&g.length)&&(t[0]=0,s="!");else if(E<63)t[0]==0?(t[2]=0,s="^"):t[2]<1?(t[0]=0,s="*"):t[2]--;else if(E==80)g=`PrgU:${e.toString().padStart(3,"0")}`,s="!";else if(E==88)g=`CmbU:${e.toString().padStart(3,"0")}`,s="!";else if(E==121)g=`GM2Vox0${r}`,s="#";else if(E==122){if(t[1]==32?t[1]==0:t[1]%=7,g=($=a(this,K)[t[1]||0][(t[0]<<7)+t[2]])==null?void 0:$.name,g){s=" ";let v=a(this,K)[t[1]||0][(t[0]<<7)+t[2]];S=(v==null?void 0:v.poly)||S,m=(v==null?void 0:v.type)||m,k=v==null?void 0:v.drum}else g="",s="*";}else t[1]==0?(g=`${E.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")} ${r.toString().padStart(3,"0")}`,s="!"):t[0]==0?(t[2]=0,s="^"):t[2]>0?t[2]--:t[1]>0?(t[1]=0,s="!"):(t[0]=0,s="?");let l=[t[0],t[1],t[2]];(h=="gs"||h=="ns5r")&&s=="^"&&(s=" "),E==127&&s=="^"&&(s=" "),s!=" "&&self.debugMode&&(g="");let o="??";switch(t[0]){case 0:{t[2]==0?o="GM":t[2]==5||t[2]==7?o="KG":t[2]<126?o="XG":t[2]==127&&(o="MT");break}case 32:case 33:case 35:case 36:{t[2]>4?o=["AP","VL","PF","DX","AN"][t[0]-32]:o="GS";break}case 48:{o="MU";break}case 56:{o="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{o="AI";break}case 62:case 82:case 90:{o="XD";break}case 63:{t[2]<17?o="KR":t[2]<34?o="ES":o="DS";break}case 64:case 126:{o="XG";break}case 67:case 99:{o=t[2]>>4==1?"SD":"DX";break}case 81:{o="RW";break}case 95:{o=["DR","PC"][t[2]];break}case 96:{o=t[2]==106?"AP":t[2]>>4==1?"SD":"PF";break}case 97:{o=t[2]>>4==1?"SD":"VL";break}case 98:{o=t[2]>>4==1?"SD":"SG";break}case 100:{o="AN";break}case 104:case 105:case 106:case 107:{o="SD";break}case 120:{o="GS";break}case 121:{o=t[2]?"G2":"GM";break}case 122:{o="KG";break}case 127:{o=t[2]==127?"MT":e==0?"GM":"XG";break}default:t[0]<48&&(t[0]==16&&h=="xg"?o="XG":o="GS")}return{name:g||`${ct(E||0)} ${ct(e||0)} ${ct(r||0)}`,poly:S,type:m,drum:k,iid:d,eid:l,sid:b,ending:s,sect:c,standard:o}}async load(E,e,r="(internal)"){let h=this,b=[],g=0,S=0;E.split(`
`).forEach(function(m,k){let t=m.split("\t"),s=[];if(k==0){if(t.forEach(function(c,n){b[Vt.indexOf(c)]=n}),b.length<4){console.debug("Debugger launched.");debugger}}else{let c=0,n=0,i=0,d,l=1,o=0,f;t.forEach(async function(v,T){switch(T){case b[0]:{c=parseInt(v);break}case b[1]:{n=parseInt(v);break}case b[2]:{i=parseInt(v);break}case b[3]:{d=v;break}case b[4]:{v=parseInt(v),v<16?l=v+1:o=(v&15)+1;break}case b[5]:{f=v;break}}}),a(h,K)[n]=a(h,K)[n]||[];let $=a(h,K)[n];if(!$[c<<7|i]||e){let v={msb:c,prg:n,lsb:i,name:d,poly:l,type:o,drum:f};$[c<<7|i]=v,g++}S++}}),e||console.debug(`Map "${r}": ${S} total, ${g} loaded.`)}clearRange(E){let e=E.prg!=null?E.prg.constructor==Array?E.prg:[E.prg,E.prg]:[0,127],r=E.msb!=null?E.msb.constructor==Array?E.msb:[E.msb,E.msb]:[0,127],h=E.lsb!=null?E.lsb.constructor==Array?E.lsb:[E.lsb,E.lsb]:[0,127];for(let b=r[0];b<=r[1];b++){let g=b<<7;for(let S=h[0];S<=h[1];S++){let m=g+S;for(let k=e[0];k<=e[1];k++)delete a(this,K)[k][m]}}}init(){w(this,K,[]);for(let E=0;E<128;E++)a(this,K).push([""])}async loadFiles(...E){this.init();let e=this;E.forEach(async function(r){try{await fetch(`./data/bank/${r}.tsv`).then(function(h){return h.text()}).then(h=>{e.load(h,!1,r)})}catch(h){console.error(`Failed loading "${r}.tsv".`)}})}},K=new WeakMap,Et);var _e,$t,vt=($t=class{constructor(){x(this,_e,{});R(this,"context")}set(E,e){a(this,_e)[E]=e}has(E){return!!a(this,_e)[E]}async read(E,e){if(!this.has(E))throw new Error(`No decoder registered for "${E}"`);return await a(this,_e)[E].call(this.context||this,e)}},_e=new WeakMap,$t);var Ft=function(E,e){let r=!0;return e.forEach((h,b)=>{r=r&&E[b]==h}),r},mt=function(E){let e=0;return E.forEach(r=>{e*=256,e+=r}),e},Qe=new TextDecoder,rt=new vt;rt.set("s7e",async function(E){let e=new Uint8Array(await E.slice(0,65536).arrayBuffer()),r="MSB\tLSB\tPRG\tNME",h=[0,0,0,0],b=32,g=0,S=0,m=!0,k=[],t=0;for(;m;){let s=e.subarray(g);([()=>{Qe.decode(s.subarray(0,4))=="YSFC"?(g+=80,S=1):g++},()=>{if(Ft(s.subarray(0,4),h))k.forEach((c,n,i)=>{let d=mt(e.subarray(c.start+4,c.start+8));c.length=d}),S=2;else{let c=Qe.decode(s.subarray(0,4)),n=mt(s.subarray(4,8));k.push({type:c,start:n}),g+=8}},()=>{let c=k[t],n=e.subarray(c.start,c.start+c.length),i=32;switch(c.type){case"ENVC":{let d=b;for(;d<n.length;){let l=n.subarray(d,d+i),o=Qe.decode(l.subarray(0,10)).trimEnd();o.slice(0,5)=="Init "&&(o=""),o&&(r+=`
063	${(l[17]+13).toString().padStart(3,"0")}	${l[19].toString().padStart(3,"0")}	${o}`),d+=i}break}case"EDVC":{let d=b;for(;d<n.length;){let l=n.subarray(d,d+i),o=Qe.decode(l.subarray(0,10)).trimEnd();o.slice(0,5)=="Init "&&(o=""),o&&(r+=`
063	024	${l[19].toString().padStart(3,"0")}	${o}`),d+=i}break}case"EPVC":{let d=32,l=b;for(;l<n.length;){let o=n.subarray(l,l+d),f=Qe.decode(o.subarray(0,10)).trimEnd();f=="----------"&&(f=""),f&&(r+=`
063	${(o[17]+1).toString().padStart(3,"0")}	${o[19].toString().padStart(3,"0")}	${f}`),l+=d}break}}t++,t>=k.length&&(S=3,m=!1)}][S]||(()=>{m=!1}))()}return r});var qe=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),Ye=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],Kt=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],Ge=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],wt=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],kt=function(E){let e=.1,r=-.3;return E>66?(e=5,r=315):E>56?(e=1,r=47):E>46&&(e=.5,r=18.5),e*E-r},St=function(E){return E>105?Kt[E-106]:E>100?E*1.1-100:E/10},xt=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),lt={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,うぃ
we,うぇ
wo,を
nga,ガ
ngi,ギ
ngu,グ
nge,ゲ
ngo,ゴ
ngy,ギ!
ng,
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,いぇ
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(E=>{let e=E.split(",");lt[e[0]]=e[1]});var Ct=function(E){let e=E;E[0]=="*"&&(e=e.slice(1)),["aa","ii","uu","ee","oo"].forEach(h=>{for(;e.indexOf(h)>-1;)e=e.replace(h,h[0])});for(let h in lt)e=e.replaceAll(h,lt[h]);e.indexOf("\u3093")==0&&e.length>1&&(e=e.slice(1));let r=e.indexOf("!");return r>-1&&e.length>1&&(e=e.slice(r+1)),e},Mt=function(E){return E?E<96?`cc${E}`:["aftertouch","velocity","pitch bend"][E-96]:"off"};var ft=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],Tt=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],Rt=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var zt={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},Qt={66307:["drive"],66309:["vowel",E=>"aiueo"[E]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",E=>["off","LPF","HPF"][E]],94984:["noise type",E=>["white","pink"][E]],94987:["disc type",E=>["LP","SP","EP","RND"]],94990:["hum type",E=>`${E+5}0Hz`],94993:["M/S",E=>["mono","stereo"][E]]},dt=function(E){return zt[(E[0]-32<<8)+E[1]]||`0x${E[0].toString(16).padStart(2,"0")}${E[1].toString(16).padStart(2,"0")}`},Dt=function(E,e,r){let h=(E[0]-32<<16)+(E[1]<<8)+e,b=Qt[h]||{},g=b[0];if(g!=null&&g.length)return g+=`: ${(b[1]||function(){})(r)||r}`,g},ht=[68,48,95,78,41,3,110,122,0];var Y=function(E=64){return Math.round(2e3*Math.log10(E/64))/100};var ve=function(E){let e=0;return E.forEach(r=>{e+=r,e=e&127}),~e+1&127},fe=function(E,e){let r=0,h=0;for(let b=0;b<E.length;b++){let g=b%8-1,S=(h>>g&1)<<7,m=E[b];m+=S,b%8!=0?(e(m,r,E),r++):h=E[b]}};var We=function(E){let e=Math.floor(E*14.2);return e<128?e:0};var de=["?","gm","gs","xg","g2","mt32","ns5r","x5d","05rw","sd","k11","sg","krs","s90es","motif"],qt={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es"},Yt=["melodic","drum","menu"],Ot=[[0,0,0,0,121,0,0,82,81,97,0,0,63,63,63],[0,0,4,0,0,127,0,0,0,0,0,0,0,0,0]],Te=[120,127,120,127,120,127,61,62,62,105,122,122,120,127,127],Wt=[0,3,81,84,88],At={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},Lt={0:0,1:1,2:3,5:4},Ut={0:0,1:1,2:2,5:3},Pt=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],Nt=[36,37,48,49,52,53],nt=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],Bt={26:127,29:0,30:0,31:0,52:12,53:54},Ze=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,128,12,13,16,17,18,19,14,15,20,21,26,28,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],Jt=[2,12,13,14,15,16,17,18,19,20,21,136,130,131,132,133,134,135,137,138,139,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],Zt=[33,99,100,32,102,8,9,10],Ht=[0,16,25,40,32,64,26,48],C={};de.forEach((E,e)=>{C[E]=e});var p={length:Ze.length};Ze.forEach((E,e)=>{p[E]=e});var ne={length:nt.length};nt.forEach((E,e)=>{ne[E]=e});var jt={};Yt.forEach((E,e)=>{jt[E]=e});var O=function(){return!!self.Bun||self.debugMode||!1},ea=function(E){let e=[],r=0;return E==null||E.forEach(function(h,b){h==247?e.push(E.subarray(r,b)):h==240&&(r=b+1)}),e.length||e.push(E.subarray(0)),O()&&console.debug(e),e};var y={ch:128,cc:Ze.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,ace:8,drm:8,dpn:nt.length,dnc:128,ext:2,efx:7,cvn:12,redir:32},Je={bank0:128},L,z,he,be,te,pe,Gt,ye,X,D,u,ae,U,G,W,I,V,ge,ue,Re,J,M,A,Ie,Q,Z,Xe,De,ce,je,me,oe,Ve,we,ke,re,H,P,Oe,Fe,Ke,Se,xe,et,ze,le,N,st,tt,Ae,ut,j,Ee,Ce,F,Le,_,at,it,Ue,Pe,ee,se,$e,Ne,Be,He,_t,Ga=(_t=class extends gt{constructor(){super();x(this,te);R(this,"NOTE_IDLE",0);R(this,"NOTE_ATTACK",1);R(this,"NOTE_DECAY",2);R(this,"NOTE_SUSTAIN",3);R(this,"NOTE_HELD",4);R(this,"NOTE_RELEASE",5);R(this,"NOTE_SOSTENUTO_ATTACK",8);R(this,"NOTE_SOSTENUTO_DECAY",9);R(this,"NOTE_SOSTENUTO_SUSTAIN",10);R(this,"NOTE_SOSTENUTO_HELD",11);R(this,"CH_MELODIC",0);R(this,"CH_DRUMS",1);R(this,"CH_DRUM1",2);R(this,"CH_DRUM2",3);R(this,"CH_DRUM3",4);R(this,"CH_DRUM4",5);R(this,"CH_DRUM5",6);R(this,"CH_DRUM6",7);R(this,"CH_DRUM7",8);R(this,"CH_DRUM8",9);R(this,"EXT_NONE",0);R(this,"EXT_VL",1);R(this,"EXT_DX",3);R(this,"VLBC_BRTHEXPR",1);R(this,"VLBC_VELOINIT",2);R(this,"VLBC_VELOALL",3);x(this,L,0);x(this,z,0);x(this,he,0);x(this,be,new Array(11));x(this,ye,new Uint8Array(y.ch));x(this,X,new Uint8Array(y.ch));x(this,D,new Uint8Array(y.ch));x(this,u,new Uint8Array(y.ch*y.cc));x(this,ae,new Uint8Array(y.ace));x(this,U,new Uint8Array(y.ch));x(this,G,new Uint8Array(y.ch*y.nn));x(this,W,new Uint8Array(y.ch));x(this,I,new Uint16Array(y.pl));x(this,V,new Uint8Array(y.pl));x(this,ge,new Int16Array(y.ch));x(this,ue,new Uint8Array(y.ch));x(this,Re,0);x(this,J,new Uint8Array(y.ch*y.ext));x(this,M,new Uint8Array(y.ch*y.rpn));x(this,A,new Uint8Array(y.ch*y.rpnt));x(this,Ie,new Int8Array(y.ch*Nt.length));x(this,Q,new Uint8Array(y.drm*y.dpn*y.dnc));x(this,Z,new Uint8Array(y.efx*3));x(this,Xe,new Uint8Array(y.ch));x(this,De,new Uint8Array(y.ch*y.redir));x(this,ce,new Uint8Array(y.ch));x(this,je,new Uint8Array(y.ch*y.cvn));x(this,me,new Uint8Array(128));x(this,oe,new Uint8Array(y.cmt*8));x(this,Ve,new Uint8Array(1024));x(this,we,new Uint8Array(y.cmt*64));x(this,ke,0);x(this,re,0);x(this,H,void 0);x(this,P,100);x(this,Oe,0);x(this,Fe,500);x(this,Ke,0);x(this,Se,"");x(this,xe,0);x(this,et,0);x(this,ze,0);x(this,le,!0);x(this,N,!1);x(this,st,1);x(this,tt,void 0);x(this,Ae,new Array(y.ch));x(this,ut,new Uint8Array(2));x(this,j,[]);x(this,Ee,new Uint8Array(y.ch));x(this,Ce,new Uint8Array(y.tr));R(this,"baseBank",new ot("gm","gm2","xg","gs","ns5r","sd","gmega","plg-150vl","plg-150pf","plg-150dx","plg-150an","plg-150dr","plg-100sg","krs","s90es"));R(this,"userBank",new ot("gm"));R(this,"initOnReset",!1);R(this,"aiEfxName","");x(this,F,[]);x(this,Le,void 0);x(this,_,{nOff:(e,r)=>{let h=e*128+r,b=a(this,I).lastIndexOf(h);if(b>-1)if(a(this,u)[y.cc*e+p[64]]>63)a(this,V)[b]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:r,velo:a(this,G)[h],state:this.NOTE_HELD});else if(a(this,u)[y.cc*e+p[66]]>63&&a(this,V)[b]==this.NOTE_SOSTENUTO_SUSTAIN)a(this,V)[b]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:r,velo:a(this,G)[h],state:this.NOTE_SOSTENUTO_HELD});else{a(this,I)[b]=0,a(this,G)[h]=0,a(this,V)[b]=this.NOTE_IDLE;let g=this.getExt(e)[1];(g==this.VLBC_VELOINIT||g==this.VLBC_VELOALL)&&(a(this,u)[y.cc*e+p[129]]=0),this.dispatchEvent("note",{part:e,note:r,velo:0,state:this.NOTE_IDLE})}},nOn:(e,r,h)=>{let b=e*128+r,g=0;for(a(this,W)[e]&&a(this,_).ano(e);a(this,V)[g]>0&&a(this,I)[g]!=b;)g++;if(g<y.pl){a(this,I)[g]=b,a(this,G)[b]=h,a(this,V)[g]=this.NOTE_SUSTAIN,a(this,ue)[e]<h&&(a(this,ue)[e]=h);let S=this.getExt(e)[1];(S==this.VLBC_VELOINIT||S==this.VLBC_VELOALL)&&(a(this,u)[y.cc*e+p[129]]=h),this.dispatchEvent("note",{part:e,note:r,velo:h,state:this.NOTE_SUSTAIN})}else console.error("Polyphony exceeded.")},nAt:(e,r,h)=>{},cAt:(e,r)=>{},hoOf:e=>{a(this,V).forEach((r,h)=>{if(r==this.NOTE_HELD){let b=a(this,I)[h],g=b>>7;e==g&&(a(this,V)[h]=this.NOTE_IDLE,a(this,I)[h]=0,a(this,G)[b]=0,this.dispatchEvent("note",{part:e,note:b&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{a(this,V).forEach((r,h)=>{let b;switch(r){case this.NOTE_ATTACK:{b=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{b=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{b=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(b){a(this,V)[h]=b;let g=a(this,I)[h];this.dispatchEvent("note",{part:e,note:g&127,velo:a(this,G)[g],state:b})}})},soOf:e=>{a(this,V).forEach((r,h)=>{if(r==this.NOTE_SOSTENUTO_HELD){let b=a(this,I)[h],g=b>>7;e==g&&(a(this,V)[h]=this.NOTE_IDLE,a(this,I)[h]=0,a(this,G)[b]=0,this.dispatchEvent("note",{part:e,note:b&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{a(this,I).forEach((r,h,b)=>{let g=r>>7,S=r&127;r==0&&a(this,G)[0]==0||g==e&&a(this,_).nOff(g,S)})}});x(this,at,{8:function(e){let r=e.channel,h=e.data[0];a(this,_).nOff(r,h)},9:function(e){let r=e.channel;this.setChActive(r,1);let h=e.data[0],b=e.data[1];b>0?a(this,_).nOn(r,h,b):a(this,_).nOff(r,h)},10:function(e){let r=e.channel,h=r*128+e.data[0];a(this,I).indexOf(h)>-1&&(a(this,G)[h]=data[1],this.getExt(r)[1]==this.VLBC_VELOALL&&(a(this,u)[y.cc*r+p[129]]=data[1]),this.dispatchEvent("note",{part:r,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let r=e.channel,h=a(this,Ae)[r],b=h[e.data[0]];b&&(e.data[0]=b),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(a(this,L)){case C.s90es:case C.motif:{if(e.data[0]==0){[0,63].indexOf(e.data[1])>-1&&this.setChActive(r,1);break}e.data[1]&&this.setChActive(r,1);break}default:{this.setChActive(r,1);break}}})();let g=r*y.cc,S=r*y.ext;switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{a(this,_).ano(r),a(this,ge)[r]=0,a(this,u)[g+p[1]]=0,a(this,u)[g+p[5]]=0,a(this,u)[g+p[64]]=0,a(this,u)[g+p[65]]=0,a(this,u)[g+p[66]]=0,a(this,u)[g+p[67]]=0,a(this,u)[g+p[11]]=127,a(this,u)[g+p[101]]=127,a(this,u)[g+p[100]]=127,a(this,u)[g+p[99]]=127,a(this,u)[g+p[98]]=127;return}case 123:{a(this,_).ano(r);return}case 124:{a(this,_).ano(r);return}case 125:{a(this,_).ano(r);return}case 126:{a(this,W)[r]=1,a(this,_).ano(r);return}case 127:{a(this,W)[r]=0,a(this,_).ano(r);return}}if(p[e.data[0]]==null)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(Jt.indexOf(e.data[0])>-1&&this.allocateAce(e.data[0]),e.data[0]){case 0:{switch(O()&&console.debug(`${de[a(this,L)]}, CH${r+1}: ${e.data[1]}`),a(this,L)==0?e.data[1]<48?(a(this,D)[r]>0&&(e.data[1]=a(this,u)[g],e.data[1]=120,console.debug(`Forced channel ${r+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]==62?this.switchMode(a(this,H).x5==82?"x5d":"05rw"):e.data[1]==63?this.switchMode(this.modeIdx[a(this,H).ds]):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg"):a(this,L)==C.gs?e.data[1]<56&&a(this,D)[r]>0&&(e.data[1]=a(this,u)[g],e.data[1]=120,console.debug(`Forced channel ${r+1} to stay drums.`)):a(this,L)==C.gm&&(e.data[1]<48?a(this,D)[r]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${r+1} to stay drums.`)):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg",!0)),a(this,L)){case C.xg:{[79,95,126,127].indexOf(e.data[1])>-1?a(this,D)[r]==0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):a(this,D)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?a(this,J)[S]=this.EXT_VL:[35,67,83,99].indexOf(e.data[1])>-1?a(this,J)[S]=this.EXT_DX:a(this,J)[S]=this.EXT_NONE;break}case C["05rw"]:case C.x5d:case C.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?a(this,D)[r]==this.CH_MELODIC&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):[80,81,82,83].indexOf(e.data[1])>-1||a(this,D)[r]!=this.CH_MELODIC&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case C.sd:{[104,105,106,107].indexOf(e.data[1])>-1?a(this,D)[r]==0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):a(this,D)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case C.g2:{e.data[1]==120?a(this,D)[r]==0&&(this.setChType(r,this.CH_DRUMS),console.debug(`CH${r+1} set to drums by MSB.`)):a(this,D)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}}this.dispatchEvent("voice",{part:r});break}case 2:{this.getExt(r)[1]==this.VLBC_BRTHEXPR&&(a(this,u)[g+p[129]]=e.data[1]);break}case 6:{if(a(this,Re)){[C.xg,C.gs,C.ns5r].indexOf(a(this,L))<0&&console.warn(`NRPN commits are not available under "${de[a(this,L)]}" mode, even when they are supported in Octavia.`);let m=a(this,u)[g+p[99]],k=a(this,u)[g+p[98]];if(m==1){let t=Zt.indexOf(k);if(t>-1)a(this,u)[g+p[71+t]]=e.data[1],O()&&console.debug(`Redirected NRPN 1 ${k} to cc${71+t}.`),this.dispatchEvent("cc",{part:r,cc:71+t,data:e.data[1]});else{let s=Nt.indexOf(k);s>-1?a(this,Ie)[r*10+s]=e.data[1]-64:console.warn(`NRPN 0x01${k.toString(16).padStart(2,"0")} is not supported.`),O()&&console.debug(`CH${r+1} voice NRPN ${k} commit`)}}else{if(nt.indexOf(m)<0){let s=`NRPN 0x${m.toString(16).padStart(2,"0")}${k.toString(16).padStart(2,"0")} `;m==127?console.warn(`${s}is not necessary. Consider removing it.`):console.warn(`${s}is not supported.`)}else{let s=a(this,D)[r]-2;s<0?console.warn(`CH${r+1} cannot accept drum NRPN as type ${Ye[a(this,D)[r]]}.`):a(this,Q)[(s*y.dpn+ne[m])*y.dnc+k]=e.data[1]}O()&&console.debug(`CH${r+1} (${Ye[a(this,D)[r]]}) drum NRPN ${m} commit`)}}else{let m=Lt[a(this,u)[g+p[100]]],k=Ut[a(this,u)[g+p[100]]];a(this,u)[g+p[101]]==0&&m!=null&&(O()&&console.debug(`CH${r+1} RPN 0 ${a(this,u)[g+p[100]]} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],Pt[m][0]),Pt[m][1]),a(this,M)[r*y.rpn+m]=e.data[1],a(this,A)[r*y.rpnt+k]=1)}break}case 32:{switch(O()&&console.debug(`${de[a(this,L)]}, CH${r+1} LSB: ${e.data[1]}`),a(this,L)){case C.s90es:case C.motif:{this.setChType(r,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,a(this,L),!0);break}}this.getExt(r)[0]==this.EXT_DX,this.dispatchEvent("voice",{part:r});break}case 38:{if(!a(this,Re)){let m=Lt[a(this,u)[g+100]],k=Ut[a(this,u)[g+100]];a(this,u)[g+101]==0&&m!=null&&(a(this,M)[r*y.rpn+m+1]=e.data[1],a(this,A)[r*y.rpnt+k]=1)}break}case 64:{e.data[1]<64&&a(this,_).hoOf(r);break}case 66:{e.data[1]>>6?a(this,_).soOn(r):a(this,_).soOf(r);break}case 98:case 99:{w(this,Re,1);break}case 100:case 101:{w(this,Re,0);break}}a(this,u)[g+p[e.data[0]]]=e.data[1],this.dispatchEvent("cc",{part:r,cc:e.data[0],data:e.data[1]})}},12:function(e){let r=e.channel;switch(a(this,L)){case C.s90es:case C.motif:{e.data&&this.setChActive(r,1);break}default:this.setChActive(r,1)}if(this.getExt(r)[0]==this.EXT_DX){let h=y.cc*r}a(this,U)[r]=e.data,a(this,ce)[r]=0,O()&&console.debug(`T:${e.track} C:${r} P:${e.data}`),this.dispatchEvent("voice",{part:r})},13:function(e){let r=this,h=e.channel;a(this,I).forEach(function(b){let g=b>>7;h==g&&(a(r,G)[b]=e.data,r.dispatchEvent("note",{part:h,note:b&127,velo:e.data,state:r.NOTE_SUSTAIN}))})},14:function(e){let r=e.channel;a(this,ge)[r]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)})},15:function(e){ea(e.data).forEach(r=>{let h=r[0],b=r[1];(a(this,it)[h]||function(){console.debug(`Unknown manufacturer ${h}.`)})(b,r.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(a(this,F)[e.meta]||function(h,b,g){}).call(this,e.data,e.track,e.meta),e.meta!=32&&w(this,Oe,0);let r=Wt.indexOf(e.meta)>-1;if(O()&&console.debug(e),r)return e.reply="meta",e}});x(this,it,{64:(e,r,h)=>{a(this,Ne).run(r,h,e)},65:(e,r,h)=>{if(r[0]<16){if(r[1]==72){let b=r[r.length-1],g=ve(r.subarray(3,r.length-1));b==g?a(this,se).run(r.subarray(0,r.length-1),h,e):console.warn(`Bad SD checksum ${b} - should be ${g}.`)}else a(this,se).run(r,h,e);}else{let b=r[r.length-1],g=ve(r.subarray(2,r.length-1));b==g?a(this,se).run(r.subarray(0,r.length-1),h,e):console.warn(`Bad GS checksum ${b} - should be ${g}.`)}},66:(e,r,h)=>{a(this,$e).run(r,h,e)},67:(e,r,h)=>{a(this,ee).run(r,h,e)},68:(e,r,h)=>{a(this,He).run(r,h,e)},71:(e,r,h)=>{a(this,Be).run(r,h,e)},126:(e,r,h)=>{a(this,Ue).run(r,h,e)},127:(e,r,h)=>{this.switchMode("gm"),a(this,Pe).run(r,h,e)}});x(this,Ue,void 0);x(this,Pe,void 0);x(this,ee,void 0);x(this,se,void 0);x(this,$e,void 0);x(this,Ne,void 0);x(this,Be,void 0);x(this,He,void 0);let e=this;w(e,te,new Uint8Array(256),Gt),a(e,be)[10]=new Uint8Array(512),w(e,Le,new ie),w(e,H,{x5:82,ds:C.krs}),e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(t){var c,n;let{data:s}=t;((c=a(e,j)[0])==null?void 0:c.type)==s.type&&(n=a(e,j)[0])!=null&&n.amend?(a(e,j)[0].amend=s.amend,a(e,j)[0].data+=s.data):a(e,j).unshift(s)}),a(e,F)[1]=function(t){var s,c,n,i,d;switch(t=t.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),t.slice(0,2)){case"@I":{w(this,N,!0),this.dispatchEvent("metacommit",{type:"Kar.Info",data:(s=t.slice(2))==null?void 0:s.trimLeft()});break}case"@K":{w(this,N,!0),this.dispatchEvent("metacommit",{type:"Kar.Mode",data:(c=t.slice(2))==null?void 0:c.trimLeft()}),console.debug(`Karaoke mode active: ${t.slice(2)}`);break}case"@L":{w(this,N,!0),this.dispatchEvent("metacommit",{type:"Kar.Lang",data:(n=t.slice(2))==null?void 0:n.trimLeft()});break}case"@T":{w(this,N,!0),this.dispatchEvent("metacommit",{type:"KarTitle",data:(i=t.slice(2))==null?void 0:i.trimLeft()});break}case"@V":{w(this,N,!0),this.dispatchEvent("metacommit",{type:"Kar.Ver.",data:(d=t.slice(2))==null?void 0:d.trimLeft()});break}case"XF":{let l=t.slice(2).split(":");switch(l[0]){case"hd":{l.slice(1).forEach((o,f)=>{o.length&&this.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][f],data:o})});break}case"ln":{l.slice(1).forEach((o,f)=>{o.length&&this.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][f],data:o})});break}default:this.dispatchEvent("metacommit",{type:"XfUnData",data:t})}break}default:a(this,N)?t[0]=="\\"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:t.slice(1),amend:!0})):t[0]=="/"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:t.slice(1),mask:!0,amend:!0})):this.dispatchEvent("metacommit",{type:"KarLyric",data:t,amend:!0}):t.split(`
`).forEach((l,o)=>{this.dispatchEvent("metacommit",{type:"Cmn.Text",data:l,mask:o!=0})})}},a(e,F)[2]=function(t){this.dispatchEvent("metacommit",{type:"Copyrite",data:t})},a(e,F)[3]=function(t,s){s<1&&a(this,Oe)<1&&this.dispatchEvent("metacommit",{type:"TrkTitle",data:t})},a(e,F)[4]=function(t,s){this.dispatchEvent("metacommit",{type:"Instrmnt",data:t})},a(e,F)[5]=function(t){t.trim()==""?this.dispatchEvent("metacommit",{type:"C.Lyrics",data:"",amend:!1}):this.dispatchEvent("metacommit",{type:"C.Lyrics",data:t,amend:!0})},a(e,F)[6]=function(t){this.dispatchEvent("metacommit",{type:"C.Marker",data:t})},a(e,F)[7]=function(t){this.dispatchEvent("metacommit",{type:"CuePoint",data:t})},a(e,F)[32]=function(t){w(this,Oe,t[0]+1)},a(e,F)[33]=function(t,s){a(e,Ce)[s]=t+1},a(e,F)[81]=function(t,s){w(e,Fe,t/1e3)},a(e,F)[127]=function(t,s){a(e,Le).run(t,s)},a(e,Le).default=function(t){console.warn(`Unrecognized sequencer-specific byte sequence: ${t}`)},a(e,Le).add([67,0,1],function(t,s){a(e,Ce)[s]=t[0]+1}),w(e,Ue,new ie("universal non-realtime")),w(e,Pe,new ie("universal realtime")),w(e,ee,new ie("Yamaha")),w(e,se,new ie("Roland")),w(e,$e,new ie("Korg")),w(e,Ne,new ie("Kawai")),w(e,Be,new ie("Akai")),w(e,He,new ie("Casio"));let r=new ie("DX7+ Dump"),h=function(t){console.info(`Unrecognized SysEx in "${this.name}" set.
%o`,t)};a(e,Ue).default=h,a(e,Pe).default=h,a(e,ee).default=h,a(e,se).default=h,a(e,$e).default=h,a(e,Ne).default=h,a(e,Be).default=h,a(e,He).default=h,r.default=h,a(e,Ue).add([9],t=>{e.switchMode(["gm","?","g2"][t[0]-1],!0),w(e,N,a(e,N)||!1),console.info(`MIDI reset: ${["GM","Init","GM2"][t[0]-1]}`),t[0]==2&&e.init()}),a(e,Pe).add([4,1],t=>{w(e,P,((t[1]<<7)+t[0])/16383*100),e.dispatchEvent("mastervolume",a(e,P))}).add([4,3],t=>((t[1]<<7)+t[0]-8192)/8192).add([4,4],t=>t[1]-64).add([4,5],t=>{let s=t[0],c=t[1],n=t[2],i=3,d=i+(s<<1),l=d+c;if(s!=1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${s})!
`,t);return}let o=0,f=0,$=0;switch(t.subarray(i,d).forEach(v=>{o=o<<7,o|=v}),t.subarray(d,l).forEach((v,T)=>{f|=v<<T*7}),t.subarray(l).forEach((v,T)=>{$|=v<<T*7}),O()&&console.debug(`GM2 global parameter: (${t.subarray(3,d)}; p: ${f}, v: ${$})`),o){case 129:{f==0&&(e.setEffectType(0,52,$),e.dispatchEvent("efxreverb",e.getEffectType(0)));break}case 130:{f==0&&(e.setEffectType(1,52,$|16),e.dispatchEvent("efxchorus",e.getEffectType(1)));break}default:O()&&console.debug("GM2 global paramater slot path unknown.")}}),a(this,ee).add([76,0,0],t=>{switch(t[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset: ${t}`);break}case 126:{e.switchMode("xg",!0),w(e,N,!1),console.info("MIDI reset: XG");break}default:{let s=[0,0,0,0],c=(n,i)=>{s[i]=n};if(t.subarray(1).forEach((n,i)=>{let d=i+t[0];([c,c,c,c,l=>{w(this,P,l*129/16383*100),e.dispatchEvent("mastervolume",a(e,P))},l=>{},l=>{}][d]||(()=>{}))(n,i)}),t[0]<4){let n=0;s.forEach(i=>{n=n<<4,n+=i}),n-=1024}}}}).add([76,2,1],t=>{let s="XG ";t[0]<32?(s+="reverb ",t.subarray(1).forEach((c,n)=>{([i=>{e.setEffectTypeRaw(0,!1,i),console.info(`${s}main type: ${qe[i]}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},i=>{e.setEffectTypeRaw(0,!0,i),console.debug(`${s}sub type: ${i+1}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},i=>{console.debug(`${s}time: ${kt(i)}s`)},i=>{console.debug(`${s}diffusion: ${i}`)},i=>{console.debug(`${s}initial delay: ${i}`)},i=>{console.debug(`${s}HPF cutoff: ${Ge[i]}Hz`)},i=>{console.debug(`${s}LPF cutoff: ${Ge[i]}Hz`)},i=>{console.debug(`${s}width: ${i}`)},i=>{console.debug(`${s}height: ${i}`)},i=>{console.debug(`${s}depth: ${i}`)},i=>{console.debug(`${s}wall type: ${i}`)},i=>{console.debug(`${s}dry/wet: ${i}`)},i=>{console.debug(`${s}send: ${Y(i)}dB`)},i=>{console.debug(`${s}pan: ${i-64}`)},!1,!1,i=>{console.debug(`${s}delay: ${i}`)},i=>{console.debug(`${s}density: ${i}`)},i=>{console.debug(`${s}balance: ${i}`)},i=>{},i=>{console.debug(`${s}feedback: ${i}`)},i=>{}][t[0]+n]||function(){console.warn(`Unknown XG reverb address: ${t[0]}.`)})(c)})):t[0]<64?(s+="chorus ",t.subarray(1).forEach((c,n)=>{([i=>{e.setEffectTypeRaw(1,!1,i),console.info(`${s}main type: ${qe[i]}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},i=>{e.setEffectTypeRaw(1,!0,i),console.debug(`${s}sub type: ${i+1}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},i=>{console.debug(`${s}LFO: ${wt[i]}Hz`)},i=>{},i=>{console.debug(`${s}feedback: ${i}`)},i=>{console.debug(`${s}delay offset: ${St(i)}ms`)},i=>{},i=>{console.debug(`${s}low: ${Ge[i]}Hz`)},i=>{console.debug(`${s}low: ${i-64}dB`)},i=>{console.debug(`${s}high: ${Ge[i]}Hz`)},i=>{console.debug(`${s}high: ${i-64}dB`)},i=>{console.debug(`${s}dry/wet: ${i}`)},i=>{console.debug(`${s}send: ${Y(i)}dB`)},i=>{console.debug(`${s}pan: ${i-64}`)},i=>{console.debug(`${s}to reverb: ${Y(i)}dB`)},!1,i=>{},i=>{},i=>{},i=>{console.debug(`${s}LFO phase diff: ${(i-64)*3}deg`)},i=>{console.debug(`${s}input mode: ${i?"stereo":"mono"}`)},i=>{}][t[0]-32+n]||function(){console.warn(`Unknown XG chorus address: ${t[0]}.`)})(c)})):t[0]<86?(s+="variation ",t.subarray(1).forEach((c,n)=>{([i=>{e.setEffectTypeRaw(2,!1,i),console.info(`${s}main type: ${qe[i]}`),e.dispatchEvent("efxdelay",e.getEffectType(2))},i=>{e.setEffectTypeRaw(2,!0,i),console.debug(`${s}sub type: ${i+1}`),e.dispatchEvent("efxdelay",e.getEffectType(2))}][t[0]-64+n]||function(){})(c)})):t[0]<97?(s+="variation ",t.subarray(1).forEach((c,n)=>{[i=>{console.debug(`${s}send: ${Y(i)}dB`)},i=>{console.debug(`${s}pan: ${i-64}`)},i=>{console.debug(`${s}to reverb: ${Y(i)}dB`)},i=>{console.debug(`${s}to chorus: ${Y(i)}dB`)},i=>{console.debug(`${s}connection: ${i?"system":"insertion"}`)},i=>{console.debug(`${s}channel: CH${i+1}`)},i=>{console.debug(`${s}mod wheel: ${i-64}`)},i=>{console.debug(`${s}bend wheel: ${i-64}`)},i=>{console.debug(`${s}channel after touch: ${i-64}`)},i=>{console.debug(`${s}AC1: ${i-64}`)},i=>{console.debug(`${s}AC2: ${i-64}`)}][t[0]-86+n](c)})):t[0]>111&&t[0]<118?s+="variation ":console.warn(`Unknown XG variation address: ${t[0]}`)}).add([76,2,64],t=>{t.subarray(1).forEach((s,c)=>{let n=c+t[0];if(n==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][s]}`);else{let i=n-1>>2,d=n-1&3,l=`XG EQ ${i} ${["gain","freq","Q","shape"][d]}: `;[()=>{console.debug(`${l}${s-64}dB`)},()=>{console.debug(`${l}${s} (raw)`)},()=>{console.debug(`${l}${s/10}`)},()=>{console.debug(`${l}${["shelf","peak"][+!!s]}`)}][d]()}})}).add([76,3],t=>{let s=t[0],c=t[1],n=`XG Insertion ${t[0]+1} `;t.subarray(2).forEach((i,d)=>{([l=>{e.setEffectTypeRaw(3+s,!1,l),console.info(`${n}main type: ${qe[l]}`),e.dispatchEvent(`efxinsert${s}`,e.getEffectType(3+s))},l=>{e.setEffectTypeRaw(3+s,!0,l),console.debug(`${n}sub type: ${l+1}`),e.dispatchEvent(`efxinsert${s}`,e.getEffectType(3+s))}][c+d]||function(){})(i)})}).add([76,6,0],t=>{let s=t[0];s<64?e.setLetterDisplay(t.subarray(1),"XG letter display",s):w(e,xe,Date.now())}).add([76,7,0],t=>{let s=t[0];w(e,z,0),w(e,he,Date.now()+3200),a(e,te,pe).fill(0);let c=t.subarray(1);for(let n=0;n<s;n++)c.unshift(0);c.forEach(function(n,i){let d=Math.floor(i/16),l=i%16,o=(l*3+d)*7,f=7,$=0;for(o-=l*5,d==2&&(f=2);$<f;)a(e,te,pe)[o+$]=n>>6-$&1,$++})}).add([76,8],(t,s)=>{let c=e.chRedir(t[0],s,!0),n=t[1],i=y.cc*c,d=`XG CH${c+1} `,l=`Unknown XG part address ${n}.`;t.subarray(2).forEach((o,f)=>{n<1?console.debug(l):n<41?([()=>{a(e,u)[i+p[0]]=o,e.dispatchEvent("voice",{part:c})},()=>{a(e,u)[i+p[32]]=o,e.dispatchEvent("voice",{part:c})},()=>{a(e,U)[c]=o,e.dispatchEvent("voice",{part:c})},()=>{let $=e.chRedir(o,s,!0);a(e,X)[c]=$,c!=$&&(e.buildRchTree(),console.info(`${d}receives from CH${$+1}`))},()=>{a(e,W)[c]=+!o},()=>{},()=>{e.setChType(c,o,C.xg),console.debug(`${d}type: ${Ye[o]||o}`)},()=>{a(e,M)[y.rpn*c+3]=o,a(e,A)[y.rpnt*c+2]=1},!1,!1,()=>{a(e,u)[i+p[7]]=o},!1,!1,()=>{a(e,u)[i+p[10]]=o||128},!1,!1,()=>{a(e,u)[i+p[128]]=o},()=>{a(e,u)[i+p[93]]=o},()=>{a(e,u)[i+p[91]]=o},()=>{a(e,u)[i+p[94]]=o},()=>{a(e,u)[i+p[76]]=o},()=>{a(e,u)[i+p[77]]=o},()=>{a(e,u)[i+p[78]]=o},()=>{a(e,u)[i+p[74]]=o},()=>{a(e,u)[i+p[71]]=o},()=>{a(e,u)[i+p[73]]=o},()=>{a(e,u)[i+p[75]]=o},()=>{a(e,u)[i+p[72]]=o}][n+f-1]||(()=>{}))():n<48?console.debug(l):n<111?n>102&&n<105&&(a(e,u)[i+p[[5,65][n&1]]]=o):n<114?console.debug(l):n<116?console.debug(`${d}EQ ${["bass","treble"][n&1]} gain: ${o-64}dB`):n<118?console.debug(l):n<120?console.debug(`${d}EQ ${["bass","treble"][n&1]} freq: ${o}`):console.debug(l)})}).add([76,9],(t,s)=>{let c=e.chRedir(t[0],s,!0),n=t[1],i=y.cc*c,d=`PLG-VL CH${c+1} `;t.subarray(2).forEach((l,o)=>{let f=o+n;switch(f){case 1:{console.info(`${d}breath mode: ${["system","breath","velocity","touch EG"][l]}`);break}case 0:case 27:case 28:break;default:if(f<27){let $=f-3>>1,v=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][$];f&1?f<23?(console.debug(`${d}${v} control source: ${Mt(l)}`),l&&l<96&&e.allocateAce(130+$),a(e,De)[y.redir*c+$+2]=l,e.buildRccMap()):console.debug(`${d}${v} scale break point: ${l}`):(console.debug(`${d}${v} depth: ${l-64}`),a(e,u)[i+p[130+$]]=l)}}})}).add([76,10],t=>{}).add([76,16],t=>{}).add([76,17,0,0],t=>{}).add([76,112],t=>{switch(console.debug(`XG enable PLG-${["VL","SG","DX","AN","PF","DR","PC","AP"][t[0]]} for CH${t[2]+1}.`),t[0]){case 0:{a(e,J)[y.ext*t[2]]=e.EXT_VL;break}case 2:{a(e,J)[y.ext*t[2]]=e.EXT_DX;break}default:a(e,J)[y.ext*t[2]]=e.EXT_NONE}}).add([73,0,0],(t,s)=>{let c=t[0],n="MU1000 System: ";t.subarray(1).forEach((i,d)=>{let l=c+d;l==8?console.debug(`${n}LCD contrast set to ${i}.`):l==18?(w(e,re,i?126:0),console.debug(`${n}bank defaults to ${i?"MU100 Native":"MU Basic"}.`)):l>=64&&l<69&&[()=>{e.dispatchEvent("channelactive",i)},()=>{i<8?(e.dispatchEvent("channelmin",i<<4),console.debug(`Octavia System: Minimum CH${(i<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{i<8?(e.dispatchEvent("channelmax",(i<<4)+15),console.debug(`Octavia System: Maximum CH${(i<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{w(e,le,!!i),console.info(`Octavia System: RS receiving ${["dis","en"][i]}abled.`)}][l-64]()})}).add([73,10,0],(t,s)=>{let c=t[0],n=`MU1000 RS${a(e,le)?"":" (ignored)"}: `;if(c<16)switch(c){case 2:{let i=e.chRedir(0,s,!0);a(e,le)&&(e.dispatchEvent("channelmin",i),e.dispatchEvent("channelmax",i+63)),console.info(`${n}Show CH1~64`);break}case 3:{let i=e.chRedir(t[1]<<5,s,!0);a(e,le)&&e.dispatchEvent("channelmin",i),a(e,le)&&e.dispatchEvent("channelmax",i+31),console.info(`${n}Show CH${i+1}~CH${i+32}`);break}default:console.debug(`${n}unknown switch ${c} invoked.`)}else if(c<32){if(a(e,le)){let i=e.chRedir(c-16+(a(e,ze)<<4),s,!0);e.dispatchEvent("channelactive",i)}}else if(c<36){let i=e.chRedir(c-32<<4,s,!0);a(e,le)&&(e.dispatchEvent("channelmin",i),e.dispatchEvent("channelmax",i+15),w(e,ze,c-32)),console.info(`${n}Show CH${i+1}~CH${i+16}`)}}).add([93,3],(t,s)=>{let c=e.chRedir(t[0],s,!0),n=`PLG-100SG CH${c+1} `,i=Date.now();if(t[1]==0){let d="",l=0;t.subarray(2).forEach((o,f)=>{f%2==0?d+=xt[o]||o.toString().padStart("0"):l+=o*13}),i>=a(e,Ke)&&this.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"SGLyrics",data:`${Ct(d)}`,amend:!0}),w(e,Ke,i+Math.ceil(l/2)+a(e,Fe)),O()&&console.debug(`${n}vocals: ${d}`)}else console.warn(`Unknown PLG-100SG data: ${t}`)}).add([98,0],(t,s,c)=>{let n=t[0],i=t.length-5,d=t.length-1;if(n!=i){console.info(`PLG-DX native dump size mismatch! Gave ${n} instead of ${t.length-5}.`);return}let l=ve(t.subarray(4,d));if(l!=t[d]){console.info(`Bad PLG-DX checksum ${t[d]} - should be ${l}.`);return}t[0]=98,a(e,ee).run(t.subarray(0,d),s,c,{noAce:!0})}).add([98,96],(t,s,c,n)=>{let i=e.chRedir(t[0],s,!0),d=y.cc*i,l=t[1];t.subarray(2).forEach((o,f)=>{let $=l+f;if(!($<10)){if($==10)e.resetAce();else if($<27){let v=$+131;n!=null&&n.noAce||e.allocateAce(v),a(e,u)[d+p[v]]=o,e.dispatchEvent("cc",{part:i,cc:v,data:o})}}})}).add([100,0],(t,s,c)=>{let n=t.subarray(0,t.length-1);if(t[0]+5!=t.length){console.warn(`Yamaha DX7+ dump SysEx size mismatch! Expected ${t.length}, but got ${t[0]}:
`,t);return}let i=ve(n),d=t[t.length-1];if(i!=d){console.warn(`Yamaha DX7+ dump SysEx checksum mismatch! Expected ${i}, but got ${d}:
`,t);return}r.run(n.subarray(1))}).add([100,76],(t,s,c)=>{let n=t[0]>>4,i=t[0]&15,d=t[1];switch(n){case 2:{let l=e.chRedir(i,s,!0),o=y.cc*l;t.subarray(2).forEach((f,$)=>{let v=$+d;if(!(v<7)){if(v<23){let T=v+135;e.allocateAce(T),a(e,u)[o+p[T]]=f,e.dispatchEvent("cc",{part:l,cc:T,data:f})}}});break}default:console.info("Unknown DX7+ multipart: %o",t)}}),r.add([14,31],t=>{a(e,u)[y.cc*t[0]+p[64]]=0,a(e,_).ano(t[0]),e.switchMode("xg"),e.resetAce(),console.debug(`Yamaha DX7+ reset CH${t[0]+1}.`)}).add([76,112],async t=>{let s=t[0],c=y.cc*s,n=y.ext*s,i=y.cvn*s;a(e,J)[n]=e.EXT_DX,a(e,ce)[s]=1;let d=a(e,je).subarray(i,i+y.cvn);d.fill(32),t.subarray(1).forEach((l,o)=>{if(o<10)d[o]=Math.max(l,32);else if(!(o<40)){if(o<56){let f=o+102;a(e,u)[c+p[f]]=l,e.dispatchEvent("cc",{part:s,cc:f,data:l})}}}),a(e,U)[s]=s&127,a(e,u)[y.cc*s+p[0]]=35,a(e,u)[y.cc*s+p[32]]=s>>7|4,e.dispatchEvent("voice",{part:s}),console.debug(`DX7+ CH${s+1} dump: %o`,t)});let b=function(t,s,c,n){},g=function(t,s){let c=t*y.dpn,n=s[0],i=s[1];s.subarray(2).forEach((d,l)=>{let o=l+i,f=-1;o<16?([()=>{f=24},()=>{f=25},()=>{f=26},()=>{},()=>{f=28},()=>{f=29},()=>{f=30},()=>{f=31},()=>{},()=>{},()=>{},()=>{f=20},()=>{f=21},()=>{f=22},()=>{f=23},()=>{}][o]||(()=>{console.debug(`Unknown XG-style drum param ${o} on set ${t+1}.`)}))():o<32||(o<40?([()=>{f=48},()=>{f=49},!1,!1,()=>{f=52},()=>{f=53}][o-32]||(()=>{console.debug(`Unknown XG-style drum param ${o} on set ${t+1}.`)}))():o<80||([()=>{f=36}][o-80]||(()=>{console.debug(`Unknown XG-style drum param ${o} on set ${t+1}.`)}))()),f>=0?(O()&&console.debug(c,f,n,d),a(e,Q)[(c+ne[f])*y.dnc+n]=d):O()&&console.debug(`XG-style drum param ${o} has no writes.`)})},S=function(t,s,c){let n=t*y.dpn,i=(s<<7)+c[0];c.subarray(1).forEach((d,l)=>{let o=l+i,f=o&127,$=o>>7,v=-1;$>1&&([()=>{v=26},()=>{},()=>{v=28},()=>{v=29},()=>{v=30},()=>{},()=>{},()=>{v=31}][$-2]||(()=>{console.debug(`Unknown GS-style drum param ${$} on set ${t+1}.`)}))(),v>-1?(O()&&console.debug(n,v,f,d),a(e,Q)[(n+ne[v])*y.dnc+f]=d):O()&&console.debug(`GS-style drum param ${$} has no writes.`)})};a(this,ee).add([76,48],(t,s,c)=>{g(0,t)}).add([76,49],(t,s,c)=>{g(1,t)}).add([76,50],(t,s,c)=>{g(2,t)}).add([76,51],(t,s,c)=>{g(3,t)}).add([76,52],(t,s,c)=>{g(4,t)}).add([76,53],(t,s,c)=>{g(5,t)}).add([76,54],(t,s,c)=>{g(6,t)}).add([76,55],(t,s,c)=>{g(7,t)}),a(this,ee).add([89,0],(t,s,c)=>{if(e.eprom){let n=t[0],i=(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);O()&&console.debug(`MU1000 EPROM trail to 0x${i.toString(16).padStart(6,"0")}, ${n} bytes.`);let d=e.eprom.data;t.subarray(4).forEach((l,o)=>{let f=o>>3,$=o&7;if($==7)for(let v=0;v<7;v++)d[i+7*f+v]+=(l>>6-v&1)<<7;else d[i+7*f+$]=l})}}).add([89,1],(t,s,c)=>{let n=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3];O()&&console.debug(`MU1000 EPROM jump to 0x${n.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=n)}).add([89,2],(t,s,c)=>{if(e.eprom){let n=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);O()&&console.debug(`MU1000 EPROM write to 0x${n.toString(16).padStart(6,"0")}.`);let i=e.eprom.data;t.subarray(4).forEach((d,l)=>{let o=l>>3,f=l&7;if(f==7)for(let $=0;$<7;$++)i[n+7*o+$]+=(d>>6-$&1)<<7;else i[n+7*o+f]=d})}}).add([89,3],(t,s,c)=>{}),a(this,ee).add([39,48],(t,s,c)=>{}).add([43,0,0],(t,s,c)=>{let n=[0,0,0,0],i=(d,l)=>{n[l]=d};if(t.subarray(1).forEach((d,l)=>{let o=l+t[0];[i,i,i,i,()=>{w(this,P,d*129/16383*100),e.dispatchEvent("mastervolume",a(e,P))},()=>d-64,()=>d||128,()=>d,()=>d,()=>{console.debug(`TG300 variation on cc${d}.`)}][o](d,o)}),t[0]<4){let d=0;n.forEach(l=>{d=d<<4,d+=l}),d-=1024}}).add([43,1,0],(t,s,c)=>{}).add([43,2],(t,s,c)=>{let n=e.chRedir(t[0],s,!0),i=t[1],d=y.cc*n,l=`TG300 CH${n+1} `;t.subarray(2).forEach((o,f)=>{f<5?([()=>{},()=>{a(e,u)[d+p[0]]=o,e.dispatchEvent("voice",{part:n})},()=>{a(e,u)[d+p[32]]=o,e.dispatchEvent("voice",{part:n})},()=>{a(e,U)[n]=o,e.dispatchEvent("voice",{part:n})},()=>{let $=e.chRedir(o,s,!0);a(e,X)[n]=$,n!=$&&(e.buildRchTree(),console.info(`${l}receives from CH${$+1}`))}][f+i]||(()=>{}))(o,f+i):f<21||(f<47?([()=>{a(e,W)[n]=+!o},()=>{},()=>{},()=>{a(e,M)[y.rpn*n+3]=o,a(e,A)[y.rpnt*n+2]=1},()=>{},()=>{a(e,u)[d+p[7]]=o},!1,!1,()=>{a(e,u)[d+p[10]]=o||128},!1,!1,()=>{console.debug(`${l} AC1 at cc${o}`)},()=>{console.debug(`${l} AC2 at cc${o}`)},()=>{a(e,u)[d+p[128]]=o},()=>{a(e,u)[d+p[93]]=o},()=>{a(e,u)[d+p[91]]=o},()=>{a(e,u)[d+p[94]]=o},()=>{a(e,u)[d+p[76]]=o},()=>{a(e,u)[d+p[77]]=o},()=>{a(e,u)[d+p[74]]=o},()=>{a(e,u)[d+p[71]]=o},()=>{a(e,u)[d+p[73]]=o},()=>{a(e,u)[d+p[75]]=o},()=>{a(e,u)[d+p[72]]=o},()=>{a(e,u)[d+p[78]]=o}][f+i-21]||(()=>{}))(o,f+i):f<95||([()=>{a(e,u)[d+p[65]]=o},()=>{a(e,u)[d+p[5]]=o}][f+i-95]||(()=>{}))(o,f+i))})}).add([43,7,0],(t,s,c)=>{let n=t[0];e.setLetterDisplay(t.subarray(1),"TG300 letter display",n)}).add([43,7,1],(t,s,c)=>{w(e,z,0),w(e,he,Date.now()+3200),a(e,te,pe).fill(0),t.forEach(function(n,i){let d=Math.floor(i/16),l=i%16,o=(l*3+d)*7,f=7,$=0;for(o-=l*5,d==2&&(f=2);$<f;)a(e,te,pe)[o+$]=n>>6-$&1,$++})}),a(this,se).add([66,18,0,0,127],(t,s,c)=>{e.switchMode("gs",!0),a(e,u)[y.cc*9]=120,a(e,u)[y.cc*25]=120,a(e,u)[y.cc*41]=120,a(e,u)[y.cc*57]=120,w(e,re,3),w(e,N,!1),a(e,Ee).fill(0),console.info(`GS system to ${["single","dual"][t[0]]} mode.`)}).add([66,18,64,0],(t,s,c)=>{switch(t[0]){case 127:{e.switchMode("gs",!0),a(e,u)[y.cc*9]=120,a(e,u)[y.cc*25]=120,a(e,u)[y.cc*41]=120,a(e,u)[y.cc*57]=120,w(e,N,!1),a(e,Ee).fill(0),console.info("MIDI reset: GS");break}default:{let n=[0,0,0,0],i=(d,l)=>{n[l]=d};if(t.subarray(1).forEach((d,l)=>{let o=l+t[0];[i,i,i,i,f=>{w(this,P,f*129/16383*100),e.dispatchEvent("mastervolume",a(e,P))},f=>{},f=>{}][o](d,l)}),t[0]<4){let d=0;n.forEach(l=>{d=d<<4,d+=l}),d-=1024}}}}).add([66,18,64,1],t=>{let s=t[0];if(s<16){let c="".padStart(s," ");t.subarray(1).forEach((n,i)=>{c+=String.fromCharCode(Math.max(32,n))}),c=c.padEnd(16," "),console.debug(`GS patch name: ${c}`)}else s<48||(s<65?t.subarray(1).forEach((c,n)=>{let i=`GS ${s+n>55?"chorus":"reverb"} `;([()=>{console.info(`${i}type: ${ft[c]}`),e.setEffectType(0,40,c),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${i}predelay: ${c}ms`)},()=>{console.info(`${i}type: ${Tt[c]}`),e.setEffectType(1,40,16+c),e.dispatchEvent("efxchorus",e.getEffectType(1))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${i}to reverb: ${Y(c)}`)},()=>{console.debug(`${i}to delay: ${Y(c)}`)}][s+n-48]||(()=>{}))()}):s<80?console.debug(`Unknown GS patch address: ${s}`):s<91?t.subarray(1).forEach((c,n)=>{let i="GS delay ";([()=>{console.info(`${i}type: ${Rt[c]}`),e.setEffectType(2,40,32+c),e.dispatchEvent("efxdelay",e.getEffectType(2))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${i}to reverb: ${Y(c)}`)}][s+n-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${s}`))}).add([66,18,64,2],t=>{let s="GS EQ ";t.subarray(1).forEach((c,n)=>{([()=>{console.debug(`${s}low freq: ${[200,400][c]}Hz`)},()=>{console.debug(`${s}low gain: ${c-64}dB`)},()=>{console.debug(`${s}high freq: ${[3e3,6e3][c]}Hz`)},()=>{console.debug(`${s}high gain: ${c-64}dB`)}][t[0]+n]||function(){console.warn(`Unknown GS EQ address: ${t[0]+n}`)})()})}).add([66,18,64,3],t=>{let s="GS EFX ",c=function(n,i){let d=Dt(a(e,Z).subarray(10,12),i,n);d&&console.debug(`${s}${dt(a(e,Z).subarray(10,12))} ${d}`)};t.subarray(1).forEach((n,i)=>{([()=>{e.setEffectTypeRaw(3,!1,32+n),e.dispatchEvent("efxinsert0",e.getEffectType(3))},()=>{e.setEffectTypeRaw(3,!0,n),console.info(`${s}type: ${dt(a(e,Z).subarray(10,12))}`),e.dispatchEvent("efxinsert0",e.getEffectType(3))},!1,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,()=>{console.debug(`${s}to reverb: ${Y(n)}dB`)},()=>{console.debug(`${s}to chorus: ${Y(n)}dB`)},()=>{console.debug(`${s}to delay: ${Y(n)}dB`)},!1,()=>{console.debug(`${s}1 source: ${n}`),n&&n<96&&e.allocateAce(n)},()=>{console.debug(`${s}1 depth: ${n-64}`)},()=>{console.debug(`${s}2 source: ${n}`),n&&n<96&&e.allocateAce(n)},()=>{console.debug(`${s}2 depth: ${n-64}`)},()=>{console.debug(`${s}to EQ: ${n?"ON":"OFF"}`)}][t[0]+i]||function(d,l){console.warn(`Unknown GS EFX address: ${l}`)})(n,t[0]+i)})}).add([66,18,65],t=>{S((t[0]>>4)+1<<1,t[0]&15,t.subarray(1))}).add([69,18,16],t=>{var s;switch(t[0]){case 0:{let c=t[1];e.setLetterDisplay(t.subarray(2),"GS display text",c);break}case 32:{w(e,he,Date.now()+3200),t[1]==0&&(w(e,z,Math.max(Math.min(t[2]-1,9),0)),O()&&console.debug(`GS switch display page ${t[2]-1}.`));break}default:if(t[0]<6){a(e,z)>9&&w(e,z,0);let c=t[0]-1<<1|t[1]>>6;a(e,z)==c&&w(e,he,Date.now()+3200),(s=a(e,be)[c])!=null&&s.length||(a(e,be)[c]=new Uint8Array(256));let n=a(e,be)[c];O()&&console.debug(`GS frame draw page ${c}.`);let i=t[1]&63;n.fill(0),t.subarray(2).forEach(function(l,o){let f=o+i,$=Math.floor(f/16),v=f%16,T=(v*4+$)*5,B=5,Me=0;for(T-=v*4,$==3&&(B=1);Me<B;)n[T+Me]=l>>4-Me&1,Me++})}else console.warn(`Unknown GS display section: ${t[0]}`)}});let m=function(t,s,c){let n=t[0],i=y.cc*s,d=y.rpn*s,l=`GS CH${s+1} `;n<3?(t.subarray(1).forEach((o,f)=>{[()=>{a(e,u)[i+p[0]]=o},()=>{a(e,U)[s]=o},()=>{let $=0;o<16?$=e.chRedir(o,c,!0):$=y.ch,a(e,X)[s]=$,s!=$&&(e.buildRchTree(),console.info(`${l}receives from CH${$+1}`))}][n+f]()}),e.dispatchEvent("voice",{part:s})):n<19||(n<44?t.subarray(1).forEach((o,f)=>{([()=>{a(e,W)[s]=+!o},!1,()=>{e.setChType(s,o<<1,C.gs),console.debug(`${l}type: ${o?"drum ":"melodic"}${o||""}`)},()=>{a(e,M)[d+3]=o,a(e,A)[y.rpnt*s+2]=1},!1,()=>{a(e,u)[i+p[7]]=o},!1,!1,()=>{a(e,u)[i+p[10]]=o||128},!1,!1,()=>{console.debug(`${l}CC 1: cc${o}`)},()=>{console.debug(`${l}CC 2: cc${o}`)},()=>{a(e,u)[i+p[93]]=o},()=>{a(e,u)[i+p[91]]=o},!1,!1,()=>{a(e,M)[d+1]=o,a(e,A)[y.rpnt*s+1]=1},()=>{a(e,M)[d+2]=o,a(e,A)[y.rpnt*s+1]=1},()=>{a(e,u)[i+p[94]]=o}][n+f-19]||(()=>{}))()}):n<76||console.debug(`Unknown GS part address: ${n}`))},k=function(t,s){let c=t[0],n=`GS CH${s+1} `;c<2?t.subarray(1).forEach((i,d)=>{[()=>{a(e,u)[y.cc*s+p[32]]=i},()=>{}][c+d]()}):c<32?console.warn(`Unknown GS misc address: ${c}`):c<35?t.subarray(1).forEach((i,d)=>{[()=>{console.debug(`${n}EQ: o${["ff","n"][i]}`)},()=>{},()=>{console.debug(`${n}EFX: o${["ff","n"][i]}`),a(e,Xe)[s]=i,e.dispatchEvent("partefxtoggle",{part:s,active:i})}][c+d-32]()}):console.warn(`Unknown GS misc address: ${c}`)};a(this,se).add([66,18,64,16],(t,s)=>{m(t,e.chRedir(9,s,!0),s)}).add([66,18,64,17],(t,s)=>{m(t,e.chRedir(0,s,!0),s)}).add([66,18,64,18],(t,s)=>{m(t,e.chRedir(1,s,!0),s)}).add([66,18,64,19],(t,s)=>{m(t,e.chRedir(2,s,!0),s)}).add([66,18,64,20],(t,s)=>{m(t,e.chRedir(3,s,!0),s)}).add([66,18,64,21],(t,s)=>{m(t,e.chRedir(4,s,!0),s)}).add([66,18,64,22],(t,s)=>{m(t,e.chRedir(5,s,!0),s)}).add([66,18,64,23],(t,s)=>{m(t,e.chRedir(6,s,!0),s)}).add([66,18,64,24],(t,s)=>{m(t,e.chRedir(7,s,!0),s)}).add([66,18,64,25],(t,s)=>{m(t,e.chRedir(8,s,!0),s)}).add([66,18,64,26],(t,s)=>{m(t,e.chRedir(10,s,!0),s)}).add([66,18,64,27],(t,s)=>{m(t,e.chRedir(11,s,!0),s)}).add([66,18,64,28],(t,s)=>{m(t,e.chRedir(12,s,!0),s)}).add([66,18,64,29],(t,s)=>{m(t,e.chRedir(13,s,!0),s)}).add([66,18,64,30],(t,s)=>{m(t,e.chRedir(14,s,!0),s)}).add([66,18,64,31],(t,s)=>{m(t,e.chRedir(15,s,!0),s)}).add([66,18,64,64],(t,s)=>{k(t,e.chRedir(9,s,!0))}).add([66,18,64,65],(t,s)=>{k(t,e.chRedir(0,s,!0))}).add([66,18,64,66],(t,s)=>{k(t,e.chRedir(1,s,!0))}).add([66,18,64,67],(t,s)=>{k(t,e.chRedir(2,s,!0))}).add([66,18,64,68],(t,s)=>{k(t,e.chRedir(3,s,!0))}).add([66,18,64,69],(t,s)=>{k(t,e.chRedir(4,s,!0))}).add([66,18,64,70],(t,s)=>{k(t,e.chRedir(5,s,!0))}).add([66,18,64,71],(t,s)=>{k(t,e.chRedir(6,s,!0))}).add([66,18,64,72],(t,s)=>{k(t,e.chRedir(7,s,!0))}).add([66,18,64,73],(t,s)=>{k(t,e.chRedir(8,s,!0))}).add([66,18,64,74],(t,s)=>{k(t,e.chRedir(10,s,!0))}).add([66,18,64,75],(t,s)=>{k(t,e.chRedir(11,s,!0))}).add([66,18,64,76],(t,s)=>{k(t,e.chRedir(12,s,!0))}).add([66,18,64,77],(t,s)=>{k(t,e.chRedir(13,s,!0))}).add([66,18,64,78],(t,s)=>{k(t,e.chRedir(14,s,!0))}).add([66,18,64,79],(t,s)=>{k(t,e.chRedir(15,s,!0))}),a(this,$e).add([54,65],(t,s)=>{e.switchMode("x5d");let c=t[t.length-1],n=t.subarray(0,t.length-1),i=ve(n);i!=c&&(console.info(`X5D multi parameters checksum mismatch! Expected ${i}, got ${c}.`),console.debug(t));let d=(t[1]<<7)+t[0],l=(t[3]<<7)+t[2],o=e.chRedir(d&15,s,!0),f=y.cc*o;[()=>{l<1||(l<101?(e.setChType(o,e.CH_MELODIC,C.x5d),a(e,U)[o]=l-1,a(e,u)[f+p[0]]=a(e,H).x5):l<229?(e.setChType(o,e.CH_MELODIC,C.x5d),a(e,U)[o]=l-101,a(e,u)[f+p[0]]=56):(e.setChType(o,e.CH_DRUMS,C.x5d),a(e,U)[o]=Ht[l-229]||0,a(e,u)[f+p[0]]=62)),e.dispatchEvent("voice",{part:o})},()=>{a(e,u)[f+p[7]]=l},()=>{l<31&&(a(e,u)[f+p[10]]=Math.round((l-15)*4.2+64))},()=>{a(e,u)[f+p[93]]=We(l)},()=>{a(e,u)[f+p[91]]=We(l)},()=>{a(e,M)[o*y.rpn+3]=l>8191?l-16320:64+l,a(e,A)[y.rpnt*o+2]=1},()=>{a(e,M)[o*y.rpn+1]=l>8191?l-16320:64+l,a(e,A)[y.rpnt*o+1]=1},()=>{l>0&&(a(e,M)[o*y.rpn]=l,a(e,A)[y.rpnt*o]=1)},()=>{}][d>>4]()}).add([54,76,0],(t,s)=>{e.switchMode(a(e,H).x5=="81"?"05rw":"x5d",!0);let c="",n=a(e,H).x5,i=0,d=0,l="MSB\tPRG\tLSB\tNME";fe(t,function(o,f){if(f<16400){let $=f%164;switch(!0){case $<10:{o>31&&(c+=String.fromCharCode(o));break}case $==10:break;case $==11:{l+=`
${n}	${i}	${d}	${c.trim().replace("Init Voice","")}`,i++,c="";break}}i>99&&(n=90,i=0)}}),e.userBank.clearRange({msb:a(e,H).x5,prg:[0,99],lsb:0}),e.userBank.load(l),O()&&console.debug(l),e.forceVoiceRefresh()}).add([54,77,0],(t,s)=>{e.switchMode(a(e,H).x5=="81"?"05rw":"x5d",!0);let c="",n=90,i=0,d=0,l="MSB\tPRG\tLSB\tNME";fe(t,function(o,f){if(f<13600){let $=f%136;switch(!0){case $<10:{o>31&&(c+=String.fromCharCode(o));break}case $==11:{l+=`
${n}	${i}	${d}	${c.trim().replace("Init Combi","")}`,i++,c="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(l),O()&&console.debug(l),e.forceVoiceRefresh()}).add([54,78],(t,s)=>{e.switchMode(a(e,H).x5=="81"?"05rw":"x5d",!0),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][t[0]]} mode.`)}).add([54,85],(t,s)=>{e.switchMode(a(e,H).x5=="81"?"05rw":"x5d",!0),fe(t,(c,n)=>{n>0&&n<3&&(e.setEffectType(n-1,44,c),e.dispatchEvent(`efx${["reverb","chorus"][n-1]}`,e.getEffectType(n-1)))})}).add([54,104],(t,s)=>{e.switchMode(a(e,H).x5=="81"?"05rw":"x5d",!0),fe(t,function(c,n,i,d){if(n<192){let l=e.chRedir(Math.floor(n/12),s,!0),o=l*y.cc;switch(n%12){case 0:{c<128?(e.setChType(l,e.CH_MELODIC,C.x5d),a(e,u)[o+p[0]]=a(e,H).x5,a(e,U)[l]=c):(e.setChType(l,e.CH_DRUMS,C.x5d),a(e,u)[o+p[0]]=62,a(e,U)[l]=Ht[c-128]),c>0&&e.setChActive(l,1),e.dispatchEvent("voice",{part:l});break}case 1:{a(e,u)[o+p[7]]=c;break}case 2:{a(e,M)[l*y.rpn+3]=c>127?c-192:64+c,a(e,A)[y.rpnt*l+2]=1;break}case 3:{a(e,M)[l*y.rpn+1]=c>127?c-192:64+c,a(e,A)[y.rpnt*l+1]=1;break}case 4:{c<31&&(a(e,u)[o+p[10]]=Math.round((c-15)*4.2+64));break}case 5:{let f=c>>4,$=c&15;a(e,u)[o+p[91]]=We($),a(e,u)[o+p[93]]=We(f);break}case 10:break;case 11:{let f=e.chRedir(c&15,s,!0),$=c>>4;a(e,X)[l]=c,(f!=l||$)&&(console.info(`X5D Part CH${l+1} receives from CH${f+1}.`),e.buildRchTree())}}}else{let l=e.chRedir(n-192,s,!0)}})}),a(this,se).add([22,18,127],t=>{e.switchMode("mt32",!0),w(e,N,!1),e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(t,s,c)=>{e.switchMode("mt32");let n=e.chRedir(c,s,!0),i=t[1];t.subarray(2).forEach((d,l)=>{let o=l+i;a(e,me)[o+(n-1)*16]=d,([!1,()=>{let f=a(e,me)[n-1<<4];if(f<3){if(a(e,ce)[n]=1,f==2)for(let $=0;$<name.length;$++)a(e,oe)[(n-1)*y.cmt+$]=a(e,we)[d*y.cmt+$];else{let $=e.baseBank.get(0,d+(f<<6),127,"mt32").name;for(let v=0;v<$.length;v++)a(e,oe)[(n-1)*y.cmt+v]=$.charCodeAt(v)}e.dispatchEvent("voice",{part:n})}},()=>{a(e,M)[n*y.rpn+3]=d+40,a(e,A)[y.rpnt*n+2]=1},()=>{a(e,M)[n*y.rpn+1]=d+14,a(e,A)[y.rpnt*n+1]=1},()=>{a(e,M)[n*y.rpn]=d,a(e,A)[y.rpnt*n]=1},!1,()=>{a(e,u)[y.cc*n+p[91]]=d?127:0},!1,()=>{a(e,u)[y.cc*n+p[7]]=d},()=>{a(e,u)[y.cc*n+p[10]]=Math.ceil(d*9.05)}][o]||(()=>{}))()})}).add([22,18,1],(t,s,c)=>{e.switchMode("mt32");let n=c&7;console.debug(`MT-32 slot #${c+1} Drum: ${t}`);let i=t[0]<<7|t[1];t.subarray(2).forEach((d,l)=>{let o=l+i,f=(o>>2)+24,$=o&3,v=n*y.dpn;if(O()&&console.debug(`MT-32 temp drum note ${f} param ${$}: ${d}`),f<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${f}`);return}[()=>{},()=>{a(e,Q)[(v+ne[26])*y.dnc+f]=Math.round(d*1.27)},()=>{a(e,Q)[(v+ne[26])*y.dnc+f]=d*9+1&127},()=>{a(e,Q)[(v+ne[26])*y.dnc+f]=d?127:0}][$]()})}).add([22,18,2],(t,s,c)=>{e.switchMode("mt32");let n=e.chRedir(c,s,!0),i=t[1]+(t[0]<<7);i<10&&(a(e,ce)[n]=1),t.subarray(2).forEach((d,l)=>{let o=l+i;o<14&&(a(e,oe)[(n-1)*y.cmt+o]=d)}),e.dispatchEvent("voice",{part:n})}).add([22,18,3],(t,s,c)=>{e.switchMode("mt32");let n=c&7;if(t[0]){let i=(t[0]-1<<7)+t[1]-16;t.subarray(2).forEach((d,l)=>{let o=l+i,f=(o>>2)+24,$=o&3,v=n*y.dpn;if(O()&&console.debug(`MT-32 dev drum note ${f} param ${$}: ${d}`),f<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${f}`);return}[()=>{},()=>{a(e,Q)[(v+ne[26])*y.dnc+f]=Math.round(d*1.27)},()=>{a(e,Q)[(v+ne[26])*y.dnc+f]=d*9+1&127},()=>{a(e,Q)[(v+ne[26])*y.dnc+f]=d?127:0}][$]()})}else{let i=t[1];t.subarray(2).forEach((d,l)=>{let o=l+i;a(e,me)[o]=d;let f=e.chRedir(1+(o>>4),s,!0),$=o&15;([!1,()=>{let v=a(e,me)[f-1<<4];if(v<3)if(a(e,ce)[f]=1,v==2)for(let T=0;T<name.length;T++)a(e,oe)[(f-1)*y.cmt+T]=a(e,we)[d*y.cmt+T];else{let T=e.baseBank.get(0,d+(v<<6),127,"mt32").name;for(let B=0;B<T.length;B++)a(e,oe)[(f-1)*y.cmt+B]=T.charCodeAt(B)}e.dispatchEvent("voice",{part:f})},()=>{a(e,M)[f*y.rpn+3]=d+40,a(e,A)[y.rpnt*f+2]=1},()=>{a(e,M)[f*y.rpn+1]=d+14,a(e,A)[y.rpnt*f+1]=1},()=>{a(e,M)[f*y.rpn]=d,a(e,A)[y.rpnt*f]=1},!1,()=>{a(e,u)[y.cc*f+p[91]]=d?127:0},!1,()=>{a(e,u)[y.cc*f+p[7]]=d},()=>{a(e,u)[y.cc*f+p[10]]=Math.ceil(d*9.05)}][$]||(()=>{}))()})}}).add([22,18,4],(t,s,c)=>{e.switchMode("mt32");let n=t[1]+(t[0]<<7),i=[];t.subarray(2).forEach((d,l)=>{let o=l+n,f=e.chRedir(Math.floor(o/246+1),s,!0),$=o%246;$<14&&(a(e,oe)[(f-1)*y.cmt+$]=d),$<10&&(a(e,ce)[f]=1),i.indexOf(f)<0&&i.push(f)}),i.forEach(d=>{e.dispatchEvent("voice",{part:d})})}).add([22,18,5],(t,s,c)=>{e.switchMode("mt32");let n=(t[0]<<7)+t[1];t.subarray(2).forEach((i,d)=>{let l=n+d,o=Math.floor(l/8),f=l&7,$=o*8;a(e,Ve)[l]=i,([!1,()=>{let v=a(e,Ve)[$];if(v<3){let T="";if(v==2){let Me=y.cmt*o;T=`MT-m:${i.toString().padStart(3,"0")}`}else T=e.baseBank.get(0,i+(v<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:o});let B=`MSB	LSB	PRG	NME
000	127	${o}	${T}`;e.userBank.load(B,!0)}}][f]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(t,s,c)=>{e.switchMode("mt32");let n=((t[0]&1)<<7)+t[1];t.subarray(2).forEach((i,d)=>{let l=n+d;l<y.cmt&&(a(e,we)[(t[0]>>1)*y.cmt+l]=i)}),e.forceVoiceRefresh()}).add([22,18,16],(t,s,c)=>{e.switchMode("mt32");let n=t[1],i=!1,d=function(l,o){a(e,X)[o-12]=l,i=!0};t.subarray(2).forEach((l,o)=>{let f=o+n;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,d,d,d,d,d,d,d,d,d,()=>{w(e,P,l),e.dispatchEvent("mastervolume",a(e,P))}][f]||(()=>{}))(l,o)}),i&&e.buildRchTree()}).add([22,18,32],t=>{e.switchMode("mt32");let s=t[1],c=" ".repeat(s);t.subarray(2).forEach(n=>{n>31?c+=String.fromCharCode(n):c+=" "}),w(e,Se,c.padStart(20," ")),w(e,xe,Date.now()+3200)}).add([22,18,82],(t,s)=>{let c=e.chRedir(0,s,!0);for(let n=0;n<16;n++)a(e,_).ano(c+n),n&&n<10&&(a(e,U)[c+n]=ht[n-1]);console.info("MT-32 alt reset complete.")}),a(this,$e).add([66,0],(t,s)=>{e.switchMode("ns5r",!0),w(e,N,!1),console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][t[0]]} mode.`)}).add([66,1],(t,s)=>{e.switchMode(["ns5r","05rw"][t[0]],!0),w(e,N,!1)}).add([66,18,0,0],(t,s)=>{let c=t[0];switch(c){case 124:case 126:case 127:{e.switchMode("ns5r",!0),w(e,N,!1);break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset: ${t}`);break}default:if(c<10){let n=[0,0,0,0],i=(d,l)=>{n[l]=d};if(t.subarray(1).forEach((d,l)=>{[i,i,i,i,()=>{w(e,P,d*129/16383*100),e.dispatchEvent("mastervolume",a(e,P))},()=>d-64,()=>d-64,()=>{},()=>{},()=>{}][c+l]()}),t[0]<4){let d=0;n.forEach(l=>{d=d<<4,d+=l}),d-=1024}}}}).add([66,18,0,1],(t,s)=>{}).add([66,18,0,2],(t,s)=>{}).add([66,18,1],(t,s)=>{let c=e.chRedir(t[0],s,!0),n=c*y.cc,i=t[1],d=`NS5R CH${c+1} `;t.subarray(2).forEach((l,o)=>{let f=i+o;f<3?([()=>{a(e,u)[n+p[0]]=l||Je.bank0},()=>{a(e,u)[n+p[32]]=l},()=>{a(e,U)[c]=l}][f](),e.dispatchEvent("voice",{part:c})):f<8||(f<14?[()=>{let $=e.chRedir(l,s,!0);a(e,X)[c]=$,c!=$&&(e.buildRchTree(),console.info(`${d}receives from CH${$+1}`))},()=>{a(e,W)[c]=+!l},()=>{e.setChType(c,l,C.ns5r),console.debug(`${d}type: ${Ye[l]}`)},()=>{a(e,M)[y.rpn*c+3]=l,a(e,A)[y.rpnt*c+2]=1},()=>{},()=>{}][f-8]():f<16||(f<33?[()=>{a(e,u)[n+p[7]]=l},()=>{a(e,u)[n+p[11]]=l},()=>{},()=>{},()=>{a(e,u)[n+p[10]]=l||128},()=>{},()=>{},()=>{a(e,u)[n+p[93]]=l},()=>{a(e,u)[n+p[91]]=l},()=>{a(e,u)[n+p[76]]=l},()=>{a(e,u)[n+p[77]]=l},()=>{a(e,u)[n+p[78]]=l},()=>{a(e,u)[n+p[74]]=l},()=>{a(e,u)[n+p[71]]=l},()=>{a(e,u)[n+p[73]]=l},()=>{a(e,u)[n+p[75]]=l},()=>{a(e,u)[n+p[72]]=l}][f-16]():f<112||f<114&&[()=>{a(e,u)[n+p[5]]=l},()=>{a(e,u)[n+p[65]]=l}][f-112]()))})}).add([66,18,8,0],(t,s)=>{let c=t[0];if(c<32)e.setLetterDisplay(t.subarray(1,33),"NS5R letter display");else{let n=c-32;w(e,he,Date.now()+3200),w(e,z,10),a(e,te,pe).fill(0);let i=t.subarray(1),d=4;i.forEach(function(l,o){let f=o+n,$=f>>4,v=f&15;if(f<80){let T=$<d?l:l>>3,B=0,Me=$<d?6:3;for(;T>0;)a(e,te,pe)[v*32+$*7+(Me-B)]=T&1,T=T>>1,B++}})}}).add([66,18,48],(t,s,c)=>{g(0,t)}).add([66,18,49],(t,s,c)=>{g(1,t)}).add([66,18,50],(t,s,c)=>{g(2,t)}).add([66,18,51],(t,s,c)=>{g(3,t)}).add([66,18,52],(t,s,c)=>{g(4,t)}).add([66,18,53],(t,s,c)=>{g(5,t)}).add([66,18,54],(t,s,c)=>{g(6,t)}).add([66,18,55],(t,s,c)=>{g(7,t)}).add([66,52],(t,s)=>{e.switchMode("ns5r",!0),w(e,N,!1);let c="";fe(t,(n,i)=>{i<8?(n>31&&(c+=String.fromCharCode(n)),i==7&&(e.aiEfxName=c)):i<10&&(e.setEffectType(i-8,44,n),e.dispatchEvent(`efx${["reverb","chorus"][i-8]}`,e.getEffectType(i-8)))})}).add([66,53],(t,s)=>{e.switchMode("ns5r",!0),w(e,N,!1);let c="",n=t[t.length-1],i=t.subarray(0,t.length-1),d=ve(i);d!=n&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${d}, got ${n}.`),console.debug(t)),fe(i,function(l,o){switch(!0){case o<2944:{let f=e.chRedir(Math.floor(o/92),s,!0),$=f*y.cc;switch(o%92){case 0:{a(e,u)[$+p[0]]=l,e.dispatchEvent("voice",{part:f});break}case 1:{a(e,u)[$+p[32]]=l,!l&&!a(e,u)[$+p[0]]&&(a(e,u)[$+p[0]]=Je.bank0),e.dispatchEvent("voice",{part:f});break}case 2:{a(e,U)[f]=l,l>0&&e.setChActive(f,1),e.dispatchEvent("voice",{part:f});break}case 3:{let v=e.chRedir(l,s,!0);a(e,X)[f]=v,f!=v&&(console.info(`NS5R CH${f+1} receives from CH${v+1}.`),e.buildRchTree());break}case 7:{a(e,D)[f]=l,e.dispatchEvent("voice",{part:f});break}case 8:{a(e,M)[f*y.rpn+3]=l<40||l>88?l+(l>63?-192:64):l,a(e,A)[y.rpnt*f+2]=1;break}case 9:case 10:{a(e,u)[$+p[7]]=l;break}case 11:{a(e,u)[$+p[11]]=l;break}case 14:{a(e,u)[$+p[10]]=l||128;break}case 19:{a(e,u)[$+p[93]]=l;break}case 20:{a(e,u)[$+p[91]]=l;break}case 84:{a(e,u)[$+p[65]]=l;break}case 85:{a(e,u)[$+p[5]]=l;break}}break}case o<3096:break;case o<3134:{let f=o-3096;f<8?(l>31&&(c+=String.fromCharCode(l)),f==7&&(e.aiEfxName=c)):f<10&&(e.setEffectType(f-8,44,l),e.dispatchEvent(`efx${["reverb","chorus"][f-8]}`,e.getEffectType(f-8)));break}case o<8566:break}})}).add([66,54],(t,s)=>{e.switchMode("ns5r",!0);let c="",n=80,i=0,d=0,l="MSB\tPRG\tLSB\tNME";fe(t,function(o,f){let $=f%158;switch(!0){case $<10:{o>31&&(c+=String.fromCharCode(o));break}case $==10:break;case $==11:{n=o&127;break}case $==12:{d=o&127;break}case $==13:{l+=`
${n}	${i}	${d}	${c.trim().replace("Init Voice","")}`,i++,c="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(l),O()&&console.debug(l),e.forceVoiceRefresh()}).add([66,55],(t,s)=>{e.switchMode("ns5r",!0);let c="",n=88,i=0,d=0,l="MSB\tPRG\tLSB\tNME";fe(t,function(o,f){let $=f%126;switch(!0){case $<10:{o>31&&(c+=String.fromCharCode(o));break}case $==11:break;case $==12:break;case $==13:{l+=`
${n}	${i}	${d}	${c.trim().replace("Init Combi","")}`,i++,c="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(l),O()&&console.debug(l),e.forceVoiceRefresh()}).add([66,125],t=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][t[0]]||"white")}).add([66,127],t=>{let s=t[t.length-1],c=t.subarray(0,t.length-1),n=ve(c);n!=s&&(console.info(`NS5R screen dump checksum mismatch! Expected ${n}, got ${s}.`),console.debug(t));let i=new Uint8Array(5760);fe(t,(d,l,o)=>{if(l<720)for(let f=0;f<8;f++)i[l*8+f]=d>>7-f&1}),e.dispatchEvent("screen",{type:"ns5r",data:i})}).add([76],(t,s,c)=>{a(e,$e).run([66,...t],s,c)}),a(this,Ne).add([16,0,8,0],(t,s,c)=>{let n=(t[2]<<4)+t[3],i="K11 ";([()=>{e.switchMode("k11",!0),w(e,N,!1),w(e,re,n?4:0),console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,n),console.debug(`${i}reverb type: ${n}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{console.debug(`${i}reverb time: ${n}`)},()=>{console.debug(`${i}reverb time: ${n}`)},()=>{console.debug(`${i}reverb predelay: ${n}`)},()=>{console.debug(`${i}reverb predelay: ${n}`)},()=>{console.debug(`${i}depth high: ${n}`)},()=>{console.debug(`${i}depth high: ${n}`)},()=>{console.debug(`${i}depth low: ${n}`)},()=>{console.debug(`${i}depth low: ${n}`)}][t[0]]||(()=>{}))()}).add([16,0,8,1],(t,s,c)=>{let n=e.chRedir(t[1],s,!0),i=y.cc*n,d=y.rpn*n,l=(t[3]<<4)+t[4],o=`K11 CH${n+1} `;([()=>{l<128?(e.setChType(n,e.CH_MELODIC,C.k11),a(e,u)[i+p[0]]=0,a(e,U)[n]=l):(e.setChType(n,e.CH_DRUMS,C.k11),a(e,U)[n]=l-128),e.dispatchEvent("voice",{part:n})},()=>{let f=e.chRedir(l,s,!0);a(e,X)[n]=f,n!=f&&(e.buildRchTree(),console.info(`${o}receives from CH${f+1}`))},()=>{a(e,u)[i+p[7]]=l},()=>{uupThis.setChActive(n,l)},()=>{a(e,u)[i+p[10]]=l},()=>{a(e,M)[d+3]=l+40,a(e,A)[y.rpnt*n+2]=1},()=>{a(e,M)[d+1]=l>>1,a(e,M)[d+2]=l&1,a(e,A)[y.rpnt*n+1]=1},()=>{a(e,u)[i+p[91]]=l?127:0},()=>{},()=>{a(e,u)[i+p[74]]=l},()=>{a(e,u)[i+p[73]]=l},()=>{a(e,u)[i+p[72]]=l}][t[0]]||(()=>{}))()}).add([16,0,9,0],(t,s,c)=>{let n=(t[2]<<4)+t[3],i="GMLX ";([()=>{console.debug(`${i}reverb type: ${n}`)},()=>{console.debug(`${i}reverb time: ${n}`)},()=>{console.debug(`${i}reverb predelay: ${n}`)},()=>{console.debug(`${i}depth high: ${n}`)},()=>{console.debug(`${i}depth low: ${n}`)}][t[0]]||(()=>{}))()}).add([16,0,9,3],(t,s,c)=>{let n=(t[2]<<4)+t[3],i=e.chRedir(t[1],s,!0),d=i*y.cc;[()=>{n<128?(e.setChType(i,e.CH_MELODIC,C.k11),a(e,u)[d+p[0]]=0,a(e,u)[d+p[32]]=0,a(e,U)[i]=n):n<160?(e.setChType(i,e.CH_MELODIC,C.k11),a(e,u)[d+p[0]]=0,a(e,u)[d+p[32]]=7,a(e,U)[i]=n-100):(e.setChType(i,e.CH_DRUMS,C.k11),a(e,u)[d+p[0]]=122,a(e,u)[d+p[32]]=0,a(e,U)[i]=n-160),e.dispatchEvent("voice",{part:i})},()=>{let l=e.chRedir(n,s,!0);a(e,X)[i]=l,i!=l&&(e.buildRchTree(),console.info(`GMLX CH${i+1} receives from CH${l+1}`))}][t[0]]()}).add([16,0,9,4],(t,s,c)=>{let n=(t[2]<<4)+t[3],i=e.chRedir(t[1],s,!0),d=i*y.cc,l=i*y.rpn,o=`GMLX CH${i+1} `;[()=>{e.setChActive(i,n)},()=>{a(e,u)[d+p[7]]=n},()=>{a(e,u)[d+p[10]]=n},()=>{a(e,u)[d+p[91]]=n?127:0},()=>{a(e,M)[l+3]=n+40,a(e,A)[y.rpnt*i+2]=1},()=>{a(e,M)[l+1]=n,a(e,A)[y.rpnt*i+1]=1},()=>{a(e,M)[l]=n,a(e,A)[y.rpnt*i]=1},()=>{}][t[0]]()}),a(this,Be).add([66,93,64],(t,s,c)=>{let n=t[2];switch(t[0]){case 0:{switch(t[1]){case 4:{w(e,P,n*129/16383*100),e.dispatchEvent("mastervolume",a(e,P));break}case 5:{n-64;break}case 6:{console.debug(`SG global reverb: ${n?"on":"off"}`);break}case 127:{e.switchMode("sg",!0);break}}break}case 1:{switch(t[1]){case 48:{console.debug(`SG reverb type: ${ft[n]}`);break}}break}default:if(t[0]>>4==1){let i=e.chRedir(t[0]&15,s,!0);if(t[1]==2){let d=e.chRedir(n,s,!0);a(e,X)[i]=d,i!=d&&(e.buildRchTree(),console.info(`SG CH${i+1} receives from CH${d+1}`))}else t[1]==19&&(a(e,u)[y.cc*i+p[7]]=n)}else console.warn(`Unknown AKAI SG SysEx: ${t}`)}}),a(this,He).add([9],(t,s,c)=>{console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremelo","phaser","rotary speaker","enhancer","flanger","EQ"][t[0]]||"off"}`)}),a(this,ee).add([127,0],(t,s,c)=>{e.switchMode("motif");let n=new Uint8Array([127,1,...t]);a(e,ee).run(n,s,c)}).add([127,1,0,0],(t,s,c)=>{e.switchMode("s90es");let n="S90/Motif ES system ",i=t[0];t.subarray(1).forEach((d,l)=>{([()=>{w(e,P,d*12900/16383),e.dispatchEvent("mastervolume",a(e,P))}][i+l]||(()=>{console.info(`Unrecognized ${n}ID: ${i+l}`)}))()})}).add([127,1,0,0,14],(t,s,c)=>{e.switchMode("s90es");let n="S90/Motif ES bulk header ",i=[];i[95]=(d,l,o)=>{console.debug(`${n}multi edit buffer: ${d[1]}`)},(i[t[0]]||(()=>{console.info(`Unrecognized ${n}ID: ${t[0]}.`)}))(t.subarray(1))}).add([127,1,0,0,15],(t,s,c)=>{e.switchMode("s90es");let n="S90/Motif ES bulk footer ",i=[];i[95]=(d,l,o)=>{console.debug(`${n}multi edit buffer: ${d[1]}`)},(i[t[0]]||(()=>{console.info(`Unrecognized ${n}ID: ${t[0]}.`)}))(t.subarray(1))}).add([127,1,0,58,55],(t,s,c)=>{e.switchMode("s90es");let n=e.chRedir(t[0],s,!0),i=y.cc*n,d=t[1],l=`S90/Motif ES bulk CH${n<16?n+1:"U"+(n-95)} `;console.debug(l,t),!(t[0]>15)&&t.subarray(2).forEach((o,f)=>{([()=>{a(e,u)[i+p[0]]=o,e.dispatchEvent("voice",{part:n})},()=>{o&&e.setChActive(n,1),a(e,u)[i+p[32]]=o,e.setChType(n,[32,40].indexOf(o)>-1?e.CH_DRUMS:e.CH_MELODIC,a(e,L),!0),e.dispatchEvent("voice",{part:n})},()=>{o&&e.setChActive(n,1),a(e,U)[n]=o,e.dispatchEvent("voice",{part:n})},()=>{let $=e.chRedir(o,s,!0);a(e,X)[n]=$,n!=$&&(e.buildRchTree(),console.info(`${l}receives from CH${$+1}`))},()=>{a(e,W)[n]=o?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{a(e,u)[i+p[7]]=o},()=>{a(e,u)[i+p[10]]=o},!1,!1,!1,()=>{a(e,u)[i+p[91]]=o},()=>{a(e,u)[i+p[93]]=o},()=>{a(e,u)[i+p[94]]=o},()=>{a(e,u)[i+p[128]]=o},()=>{},()=>{a(e,u)[i+p[74]]=o},()=>{a(e,u)[i+p[71]]=o},!1,()=>{a(e,u)[i+p[65]]=o},()=>{a(e,u)[i+p[5]]=o},()=>{}][d+f]||(()=>{}))()})}).add([127,1,54,16],(t,s,c)=>{e.switchMode("s90es");let n=t[0];t.subarray(1).forEach((i,d)=>{let o=`S90/Motif ES EQ${(d>>2)+1} `;([()=>{let f=i-64},()=>{let f=Ge[i]},()=>{let f=i/10},()=>{let f=i}][n+d&3]||(()=>{}))()})}),a(this,se).add([0,72,18,0,0,0,0],(t,s,c)=>{e.switchMode("sd",!0),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(t,s,c)=>{let n=t[0]>>5,i=t[0]&31;switch(n){case 0:{let d=t[0]>>1,l=t[1];switch(d){case 1:{t.subarray(2).forEach((o,f,$)=>{let v=f+l;switch(v){case 0:{o&&(e.setEffectType(1,60,o-1),e.dispatchEvent("efxchorus",e.getEffectType(1)),console.debug(`SD MFX Cho: ${v} - ${o}`));break}}});break}case 2:{t.subarray(2).forEach((o,f)=>{let $=f+l;switch($){case 0:{o&&(e.setEffectType(0,55+o,0),e.dispatchEvent("efxreverb",e.getEffectType(0)),console.debug(`SD MFX Rev: ${$} - ${o}`));break}}});break}case 3:case 4:case 5:{let o=d-1;t.subarray(2).forEach((f,$)=>{let v=$+l;switch(console.debug(`SD MFX ${o-2}: ${v} - ${f}`),v){case 0:{e.setEffectTypeRaw(o,62,f),e.dispatchEvent(`efx${o>2?"delay":"insert"+(o-4)}`,e.getEffectType(o));break}}}),console.debug(`SD MFX message:
%o`,t);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,t)}break}case 1:{let d=e.chRedir(i,s,!0),l=t[1],o=d*y.cc;t.subarray(2).forEach((f,$)=>{let v=l+$;v<37?([()=>{},()=>{},0,()=>{},()=>{switch(a(e,u)[o+p[0]]=f,f){case 104:case 105:case 106:case 107:case 120:{a(e,D)[d]||e.setChType(d,e.CH_DRUMS);break}default:a(e,D)[d]&&e.setChType(d,e.CH_MELODIC)}e.dispatchEvent("voice",{part:d})},()=>{a(e,u)[o+p[32]]=f,e.dispatchEvent("voice",{part:d})},()=>{a(e,U)[d]=f,e.dispatchEvent("voice",{part:d})},()=>{a(e,u)[o+p[7]]=f},()=>{a(e,u)[o+p[10]]=f},()=>{},()=>{},()=>{f<2&&(a(e,W)[d]=f)},()=>{f<2&&(a(e,u)[o+p[68]]=f?127:0)},()=>{},()=>{f<2&&(a(e,u)[o+p[65]]=f?127:0)},()=>{a(e,u)[o+p[5]]=f&15<<4|a(e,u)[o+p[5]]&15},()=>{a(e,u)[o+p[5]]=f&15|(a(e,u)[o+p[5]]&240)>>4},()=>{a(e,u)[o+p[74]]=f},()=>{a(e,u)[o+p[71]]=f},()=>{a(e,u)[o+p[73]]=f},()=>{a(e,u)[o+p[72]]=f},0,0,0,0,0,0,0,()=>{a(e,u)[o+p[128]]=f},()=>{a(e,u)[o+p[93]]=f},()=>{a(e,u)[o+p[91]]=f},0,0,()=>{a(e,u)[o+p[75]]=f},()=>{a(e,u)[o+p[76]]=f},()=>{a(e,u)[o+p[77]]=f},()=>{a(e,u)[o+p[78]]=f}][v]||(()=>{}))():v<63||(v<64?(a(e,D)[d]?a(e,u)[o+p[0]]=104|f:a(e,u)[o+p[0]]=96|f,e.dispatchEvent("voice",{part:d})):console.debug(`Unknown SD-90 global CH${d+1} param setup message:
%o`,t))});break}case 2:{let d=e.chRedir(i,s,!0),l=t[1];console.debug(`Unknown SD-90 global CH${d+1} MIDI setup message:
%o`,t.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,t)}})}chRedir(e,r,h){if(a(this,Ce)[r])return(a(this,Ce)[r]-1)*16+e;if([2,3].indexOf(a(this,re))>-1){if(h==1)return e;let b=0,g=!0;for(;g;)a(this,Ee)[e+b]==0?(a(this,Ee)[e+b]=r,console.debug(`Assign track ${r} to channel ${e+b+1}.`),g=!1):a(this,Ee)[e+b]==r?g=!1:(b+=16,b>=128&&(b=0,g=!1));return e+b}else return e}forceVoiceRefresh(){for(let e=0;e<y.ch;e++)a(this,ye)[e]&&this.dispatchEvent("voice",{part:e})}buildRchTree(){let e=[];a(this,X).forEach((r,h)=>{var b;r<y.ch&&((b=e[r])!=null&&b.constructor||(e[r]=[]),e[r].push(h))}),w(this,tt,e)}buildRccMap(){let e=this;for(let r=0;r<y.ch;r++)a(e,Ae)[r]={};a(e,De).forEach((r,h)=>{r&&(a(e,Ae)[Math.floor(h/y.redir)][r]=h%y.redir|128)}),O()&&console.debug(a(e,Ae))}getActive(){return a(this,ye)}getCc(e){let r=e*y.cc,h=a(this,u).subarray(r,r+y.cc);return h[p[0]]=h[p[0]]||a(this,ke),h[p[32]]=h[p[32]]||a(this,re),h[p[0]]==Je.bank0&&(h[p[0]]=0),h}getCcCh(e,r){if(Ze.indexOf(r)<0)throw new Error("CC number not accepted");return a(this,u)[y.cc*e+p[r]]}getCcAll(){let e=a(this,u).slice();for(let r=0;r<y.ch;r++){let h=r*y.cc;e[h+p[0]]=e[h+p[0]]||a(this,ke),e[h+p[32]]=e[h+p[32]]||a(this,re),e[p[0]]==Je.bank0&&(e[p[0]]=0)}return e}getChSource(){return a(this,X)}getChType(){return a(this,D)}setChType(e,r,h=a(this,L),b=!1){r&=15,a(this,D)[e]=r,r>0&&!b&&(a(this,u)[e*y.cc+p[0]]=Te[h])}setChActive(e,r=0){a(this,ye)[e]!=r&&this.dispatchEvent("channeltoggle",{part:e,active:r}),a(this,ye)[e]=r}getExt(e){let r=y.ext*e,h=a(this,J).subarray(r,r+y.ext),b=new Uint8Array(h.length);return b.set(h),b[1]=b[1]||a(this,st),b}getPitch(){return a(this,ge)}getProgram(){return a(this,U)}getTexts(){return a(this,j).slice()}getVel(e){let r=new Map,h=this;return a(h,I).forEach(function(b,g){let S=Math.floor(b/128),m=b%128;e==S&&a(h,G)[b]>0&&r.set(m,{v:a(h,G)[b],s:a(h,V)[g]})}),r}getBitmap(){return{bitmap:a(this,te,pe),expire:a(this,he)}}getLetter(){return{text:a(this,Se),set:a(this,et),expire:a(this,xe)}}getMode(){return de[a(this,L)]}getMaster(){return{volume:a(this,P)}}getRawStrength(){let e=this;return a(this,I).forEach(function(r){let h=Math.floor(r/128);a(e,G)[r]>a(e,ue)[h]&&(a(e,ue)[h]=a(e,G)[r])}),a(this,ue)}getStrength(){let e=[],r=this;return this.getRawStrength().forEach(function(h,b){e[b]=Math.floor(h*a(r,u)[b*y.cc+p[7]]*a(r,u)[b*y.cc+p[11]]*a(r,P)/803288)}),e}getRpn(){return a(this,M)}getNrpn(){return a(this,Ie)}getVoice(e,r,h,b){let g=e||a(this,ke),S=r,m=h||a(this,re);g==Je.bank0&&(g=0),de[a(this,L)]=="ns5r"&&g>0&&g<56&&(m=3);let k=this.userBank.get(g,S,m,b);if(de[a(this,L)]=="mt32"&&k.name.indexOf("MT-m:")==0){let t=parseInt(k.name.slice(5)),s=t*y.cmt,c="";a(this,we).subarray(s,s+10).forEach(i=>{i>31&&(c+=String.fromCharCode(i))});let n=`MSB	LSB	PRG	NME
0	127	${S}	${c}`;this.userBank.load(n,!0),k.name=c,k.ending=" "}return(k.ending!=" "||!k.name.length)&&(k=this.baseBank.get(g,S,m,b)),k}getChVoice(e){let r=this.getVoice(a(this,u)[e*y.cc+p[0]],a(this,U)[e],a(this,u)[e*y.cc+p[32]],de[a(this,L)]);if(a(this,ce)[e]){let h="";switch(a(this,L)){case C.mt32:{a(this,oe).subarray(y.cmt*(e-1),y.cmt*(e-1)+10).forEach(b=>{h+=String.fromCharCode(Math.max(b,32))}),h=h.trimRight();break}default:{let b=y.cvn*e;a(this,je).subarray(b,b+y.cvn).forEach(g=>{h+=String.fromCharCode(Math.max(g,32))}),h=h.trimRight()}}h.length&&(r.ending="~",r.name=h)}return r}getRawPitch(){return a(this,ge)}getPitchShift(e){let r=this,h=e*y.rpn,b=a(r,M)[h];return a(r,A)[e*y.rpnt]||a(r,L)==C.mt32&&(b=12),a(r,ge)[e]/8192*b+(a(r,M)[h+3]-64)+((a(r,M)[h+1]<<7)+a(r,M)[h+2]-8192)/8192}getEffectType(e=0){let r=3*e+1;return a(this,Z).subarray(r,r+2)}setEffectTypeRaw(e=0,r,h){let b=3*e;a(this,Z)[b]=1,a(this,Z)[b+1+ +r]=h}setEffectType(e=0,r,h){this.setEffectTypeRaw(e,!1,r),this.setEffectTypeRaw(e,!0,h)}getEffectSink(){return a(this,Xe)}setLetterDisplay(e,r,h=0,b=3200){let g=this,S;w(g,Se," ".repeat(h)),e.forEach(m=>{w(g,Se,a(g,Se)+String.fromCharCode(m>31?m:32)),m<32&&(S=S||new Set,S.add(m))}),w(g,et,Date.now()),w(g,xe,Date.now()+b),S&&(S=Array.from(S),S.forEach((m,k,t)=>{t[k]=m.toString(16).padStart(2,"0")}),console.warn(`${r}${r?" ":""}invalid code point${S.length>1?"s":""}: 0x${S.join(", 0x")}`))}setDetectionTargets(e="?",r=0){let h=this,b=-1;switch(e.replaceAll(", ",",").split(",").forEach(g=>{g=g.toLowerCase();let S=de.indexOf(qt[g]||g);O()&&console.debug(`Mapped mode "${g}" to ID "${S}".`),S>-1&&(b=S)}),O()&&console.debug(`Set detection target to ID "${b}".`),b>0&&(a(h,H).x5=82,a(h,H).ds=C.krs),b){case C["05rw"]:{a(h,H).x5=81;break}case C.s90es:a(h,H).ds=C.s90es;case C.motif:a(h,H).ds=C.motif}}allocateAce(e){if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}let r=!0,h=0;for(;r&&h<y.ace;)a(this,ae)[h]==e?r=!1:a(this,ae)[h]||(r=!1,a(this,ae)[h]=e,console.info(`Allocated cc${e} to ACE slot ${h}.`)),h++;h>=y.ace&&console.warn("ACE slots are full.")}releaseAce(e){let r=!0,h=0;for(;r&&h<y.ace;)a(this,ae)[h]==e&&(a(this,ae)[h]=0,r=!1),h++;r&&O()&&console.debug(`No ACE slot was allocated to cc${e}.`)}resetAce(){a(this,ae).fill(0),console.info("All ACE slots have been reset.")}getAce(){return a(this,ae)}getChAce(e,r){if(r<0||r>=y.ace)throw new RangeError("No such ACE slot");let h=a(this,ae)[r];if(h){if(Ze.indexOf(h)>=0)return a(this,u)[e*y.cc+p[h]];throw new Error(`Invalid ACE source: ${h}`)}else return 0}initDrums(){let e=this;a(e,Q).fill(64);for(let r=0;r<y.drm;r++){let h=r*y.dpn;for(let b in Bt){let g=Bt[b],S=(h+ne[b])*y.dnc;a(e,Q).subarray(S,S+y.dnc).fill(g)}}}init(e=0){let r=this;w(r,ke,0),w(r,re,0),w(r,Oe,0),a(r,ye).fill(0),a(r,u).fill(0),a(r,ae).fill(0),a(r,U).fill(0),a(r,G).fill(0),a(r,I).fill(0),a(r,W).fill(0),a(r,ue).fill(0),a(r,ge).fill(0),a(r,Ie).fill(0),a(r,A).fill(0),a(r,J).fill(0),a(r,De).fill(0),w(r,P,100),w(r,j,[]),w(r,Fe,500),w(r,Ke,0),w(r,he,0),w(r,z,0),a(r,te,pe).fill(0),w(r,N,!1),w(r,ze,0),w(r,le,!0),r.initDrums(),a(r,X).forEach(function(h,b,g){g[b]=b}),e==0&&(r.dispatchEvent("mode","?"),w(r,L,0),a(r,Ee).fill(0),a(r,Ce).fill(0),w(r,xe,0),w(r,Se,"")),a(r,u)[y.cc*9]=Te[0],a(r,u)[y.cc*25]=Te[0],a(r,u)[y.cc*41]=Te[0],a(r,u)[y.cc*57]=Te[0],a(r,D).fill(r.CH_MELODIC),a(r,D)[9]=r.CH_DRUM1,a(r,D)[25]=r.CH_DRUM3,a(r,D)[41]=r.CH_DRUMS,a(r,D)[57]=r.CH_DRUMS,a(r,D)[73]=r.CH_DRUM5,a(r,D)[89]=r.CH_DRUM7,a(r,D)[105]=r.CH_DRUMS,a(r,D)[121]=r.CH_DRUMS,a(r,Ve).fill(0),a(r,we).fill(0),a(r,me).fill(0),a(r,oe).fill(0),a(r,ce).fill(0),a(r,Z).fill(0),a(r,Xe).fill(0),r.aiEfxName="",r.userBank.clearRange({msb:0,lsb:127,prg:[0,127]});for(let h=0;h<y.ch;h++){let b=h*y.cc;a(r,u)[b+p[7]]=100,a(r,u)[b+p[11]]=127,a(r,u)[b+p[2]]=127,a(r,u)[b+p[10]]=64,a(r,u).subarray(b+p[71],b+p[71]+8).fill(64),a(r,u).subarray(b+p[130],b+p[157]+1).fill(64),a(r,u)[b+p[91]]=40,a(r,u)[b+p[101]]=127,a(r,u)[b+p[100]]=127,a(r,u)[b+p[99]]=127,a(r,u)[b+p[98]]=127;let g=h*y.rpn;a(r,M)[g]=2,a(r,M)[g+1]=64,a(r,M)[g+2]=0,a(r,M)[g+3]=64,a(r,M)[g+4]=0,a(r,M)[g+5]=0;let S=h*y.ext;a(r,J)[S+1]=r.VLBC_BRTHEXPR;let m=h*y.redir;a(r,De)[m+8]=13}r.buildRchTree(),r.buildRccMap(),r.dispatchEvent("mastervolume",a(r,P)),r.dispatchEvent("efxreverb",r.getEffectType(0)),r.dispatchEvent("efxchorus",r.getEffectType(1)),r.dispatchEvent("efxdelay",r.getEffectType(2)),r.dispatchEvent("efxinsert0",r.getEffectType(3)),r.dispatchEvent("efxinsert1",r.getEffectType(4)),r.dispatchEvent("efxinsert2",r.getEffectType(5)),r.dispatchEvent("efxinsert3",r.getEffectType(6)),r.dispatchEvent("reset"),r.switchMode("?")}switchMode(e,r=!1,h=!1){var S;let b=this,g=de.indexOf(e);if(g>-1){if(a(b,L)==0||r){let m=a(b,L);b.initOnReset&&r&&(this.init(1),m=C["?"]),w(b,L,g),w(b,z,0),w(b,ke,Ot[0][g]),w(b,re,Ot[1][g]);for(let t=0;t<y.ch;t++)a(b,D)[t]>0&&a(b,u)[t*y.cc+p[0]]==Te[m]&&(a(b,u)[t*y.cc]=Te[g]);switch(g){case C.mt32:{ht.forEach((t,s)=>{let c=s+1;a(b,ye)[c]||(a(b,U)[c]=t,a(b,u)[c*y.cc+p[91]]=127)});for(let t=1;t<10;t++)b.dispatchEvent("voice",{part:t});break}}let k;switch(g){case C["?"]:case C.g2:{k=[52,4,52,18,0,0,0,0];break}case C.xg:{k=[1,0,65,0,5,0,0,0];break}case C.gm:case C.gs:{k=[40,4,40,18,40,32,32,0];break}case C.sd:{k=[58,0,60,0,61,0,61,0];break}case C["05rw"]:case C.x5d:case C.ns5r:{k=[44,1,44,19,44,0,44,0];break}case C.k11:case C.sg:{k=[24,0,0,0,0,0,0,0];break}case C.mt32:{k=[40,4,0,0,0,0,0,0];break}default:k=[0,0,0,0,0,0,0,0]}for(let t=0;t<y.efx;t++)!a(b,Z)[3*t]&&(S=k[t<<1])!=null&&S.constructor&&(a(b,Z)[3*t+1]=k[2*t],a(b,Z)[3*t+2]=k[2*t+1],b.dispatchEvent(`efx${["reverb","chorus","delay","insert0"][t]}`,b.getEffectType(t)));h&&b.setDetectionTargets(e),b.dispatchEvent("mode",e),b.forceVoiceRefresh()}}else throw new Error(`Unknown mode ${e}`)}newStrength(){a(this,ue).fill(0)}runJson(e){var r;if(e.type>14)return e.type==15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),a(this,at)[e.type].call(this,e);{let h=this.chRedir(e.part,e.track),b=!1;(r=a(this,tt)[h])==null||r.forEach(g=>{e.channel=g,b=!0,a(this,at)[e.type].call(this,e)}),b||console.warn(`${At[e.type]?At[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${h+1} without any recipient.`)}a(this,j).length>100&&a(this,j).splice(100,a(this,j).length-99)}runRaw(e){}async loadBank(e,r){let h=this;switch(e=e.toLowerCase(),e){case"s7e":{h.userBank.clearRange({msb:63,lsb:[21,22]}),h.userBank.clearRange({msb:63,lsb:[24,27]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":{rt.context=this,h.userBank.load(await rt.read(e,r));break}}h.forceVoiceRefresh()}},L=new WeakMap,z=new WeakMap,he=new WeakMap,be=new WeakMap,te=new WeakSet,pe=function(){return a(this,be)[a(this,z)]},Gt=function(e){a(this,be)[a(this,z)]=e},ye=new WeakMap,X=new WeakMap,D=new WeakMap,u=new WeakMap,ae=new WeakMap,U=new WeakMap,G=new WeakMap,W=new WeakMap,I=new WeakMap,V=new WeakMap,ge=new WeakMap,ue=new WeakMap,Re=new WeakMap,J=new WeakMap,M=new WeakMap,A=new WeakMap,Ie=new WeakMap,Q=new WeakMap,Z=new WeakMap,Xe=new WeakMap,De=new WeakMap,ce=new WeakMap,je=new WeakMap,me=new WeakMap,oe=new WeakMap,Ve=new WeakMap,we=new WeakMap,ke=new WeakMap,re=new WeakMap,H=new WeakMap,P=new WeakMap,Oe=new WeakMap,Fe=new WeakMap,Ke=new WeakMap,Se=new WeakMap,xe=new WeakMap,et=new WeakMap,ze=new WeakMap,le=new WeakMap,N=new WeakMap,st=new WeakMap,tt=new WeakMap,Ae=new WeakMap,ut=new WeakMap,j=new WeakMap,Ee=new WeakMap,Ce=new WeakMap,F=new WeakMap,Le=new WeakMap,_=new WeakMap,at=new WeakMap,it=new WeakMap,Ue=new WeakMap,Pe=new WeakMap,ee=new WeakMap,se=new WeakMap,$e=new WeakMap,Ne=new WeakMap,Be=new WeakMap,He=new WeakMap,_t);export{Ga as OctaviaDevice,y as allocated,p as ccToPos,ne as dnToPos};