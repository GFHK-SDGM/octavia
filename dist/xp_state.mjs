var Gt=Object.defineProperty;var _t=(E,e,r)=>e in E?Gt(E,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):E[e]=r;var R=(E,e,r)=>(_t(E,typeof e!="symbol"?e+"":e,r),r),ut=(E,e,r)=>{if(!e.has(E))throw TypeError("Cannot "+r)};var a=(E,e,r)=>(ut(E,e,"read from private field"),r?r.call(E):e.get(E)),x=(E,e,r)=>{if(e.has(E))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(E):e.set(E,r)},w=(E,e,r,h)=>(ut(E,e,"write to private field"),h?h.call(E,r):e.set(E,r),r);(function(){var E=function(v,k,t){var i,c;if(self.MessageEvent)switch(v){case"message":{c=new MessageEvent(v,{data:k,ports:t==null?void 0:t.ports}),Object.defineProperty(c,"source",{value:t==null?void 0:t.source});break}default:c=new Event(v)}else c=document.createEvent("Event"),c.initEvent(v,!1,!1),t&&v=="message"&&(c.data=k,t.source&&Object.defineProperty(c,"source",{value:t.source}),(i=t.ports)!=null&&i.length&&Object.defineProperty(c,"ports",{value:t.ports}));return c};self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),r=[],h={},b=function(v){var k,t=this;if((this==null?void 0:this.constructor)!=b)throw new TypeError("Illegal constructor");r.push(this),(k=h[v])!=null&&k.constructor||(h[v]=[]),h[v].push(this);var i=Math.floor(Math.random()*281474976710656),c=[],n=0,s=[],f=!0,l=!1;Object.defineProperty(this,"id",{get:function(){return i}}),Object.defineProperty(this,"name",{value:v}),this.close=function(){var d,$=r.indexOf(t);$>-1?(e.postMessage({t:"d",c:v,i}),r.splice($,1),(d=h[v])!=null&&d.constructor&&($=h[v].indexOf(t),$>-1&&h[v].splice($,1)),h[v].length||delete h[v],console.debug("[Snowy] BroadcastChannel closed."),l=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(d){if(e){if(l)throw new Error("Channel already closed");e.postMessage({t:"m",c:v,i,m:n,d}),n++,n>4294967295&&(n=0)}else s.push(d),console.debug("[Snowy] Message is cached.")},this.flush=function(){if(e){if(f){for(e.postMessage({t:"r",c:v,i}),console.debug("[Snowy] ".concat(s.length," message(s) in cache."));s.length;){var d=s.shift();t.postMessage(d)}f=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(d){d.c==v?d.i!=i&&t.dispatchEvent(E("message",d.d,{source:t})):console.debug("[Snowy] Channel ID mismatch. Instance ".concat(i," receives from ").concat(v,", not ").concat(d.c,"."))};var o={};this.dispatchEvent=function(d){var $,m;if(Object.defineProperty(d,"target",{value:t}),Object.defineProperty(d,"currentTarget",{value:t}),($=o[d.type])!=null&&$.length)for(var T=o[d.type],B=0;B<T.length;B++)((m=T[B])==null?void 0:m.constructor)==Function&&T[B].call(t,d);t["on".concat(d.type)]&&t["on".concat(d.type)].constructor==Function&&t["on".concat(d.type)].call(t,d)},this.addEventListener=function(d,$){var m;(m=o[d])!=null&&m.constructor||(o[d]=[]);var T=o[d].indexOf($);T==-1&&o[d].push($)},this.removeEventListener=function(d,$){var m,T;if((m=o[d])!=null&&m.length){var B=o[d].indexOf($);B>-1&&o[d].splice(B,1)}!((T=o[d])!=null&&T.length)&&o[d].constructor&&delete o[d]}},self.BroadcastChannel=b,y=function(){if(e){e.addEventListener("message",function(k){var t=k.data,i=!1;switch(t.t){case"k":{i=!1,e.postMessage({t:"k"});break}case"m":{var c=h[t.c];if(c!=null&&c.length)for(var n=0;n<c.length;n++)c[n].receiveMessage(t);break}case"c":{for(var s=[],f=0;f<r.length;f++){var l=r[f].name;s.indexOf(l)<0&&s.push(l)}e.postMessage({t:"k",c:s});break}default:i=!0}i&&console.info("ReceiveBroadcast",t)});for(var v=0;v<r.length;v++)r[v].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},S=function(){if(!e){var v=new SharedWorker(self.SNOWY_PATH||"/snowy.js");v.port.start();var k=function(t){t.data.t=="swc"&&(v.port.removeEventListener("message",k),e=v.port,e.postMessage({t:"k"}),y())};v.port.addEventListener("message",k)}},S());var e,r,h,b,y,S})();{let E=function(e,r){let h=new FileReader;return new Promise((b,y)=>{switch(h.addEventListener("abort",()=>{y(new Error("Blob read aborted"))}),h.addEventListener("error",S=>{y(h.error||S.data||new Error("Blob read error"))}),h.addEventListener("load",()=>{b(h.result)}),r.toLowerCase()){case"arraybuffer":case"buffer":{h.readAsArrayBuffer(e);break}case"string":case"text":{h.readAsText(e);break}default:y(new Error(`Unknown target ${r}`))}})};Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||function(){return E(this,"buffer")},Blob.prototype.text=Blob.prototype.text||function(){return E(this,"text")}}String.prototype.replaceAll=String.prototype.replaceAll||function(E,e){let r=0,h=16,b=this,y=[];for(;r<h&&b.lastIndexOf(E)>-1;){let S=b.lastIndexOf(E);y.unshift(b.slice(S+E.length)),b=b.slice(0,S),S==0&&y.unshift(""),r++}return b.length&&y.unshift(b),y.join(e)||""},String.prototype.padStart=String.prototype.padStart||function(E,e){if(e){let r=this;for(;r.length<E;)r=`${e}${r}`;return r}},String.prototype.padEnd=String.prototype.padEnd||function(E,e){if(e){let r=this;for(;r.length<E;)r+=e;return r}};var pt=function(E,e){let r=Math.min(E.length,e.length),h=E.slice(0,r),b=e.slice(0,r),y=0,S=0;for(;S<r&&y==0;)y=Math.sign(h[S]-b[S]),S++;return y},re=function(E=""){this.name=E,this.pool=[],this.point=function(e,r=!1){if(this.pool.length>0){let h=this.pool.length,b=1<<Math.floor(Math.log2(h)),y=b,S=64;for(;b>=1&&S>=0;){if(S<=0)throw new Error("TTL reached.");if(y==h)y-=b;else{let k=pt(e,this.pool[y]);switch(k){case 0:{S=0;break}case 1:{y+b<=h&&(y+=b);break}case-1:{y!=0&&(y-=b);break}default:console.warn(`Unexpected result ${k}.`)}}b=b>>1,S--}let v=!0;if(y>=this.pool.length)v=!1;else{let k=this;this.pool[y].forEach(function(t,i,c){v&&t!=e[i]&&(v=!1)}),!v&&pt(e,this.pool[y])>0&&y++}return v||r?y:-1}else return r?0:-1},this.add=function(e,r){return e.data=r,this.pool.splice(this.point(e,!0),0,e),this},this.default=function(e){console.warn(`No match in "${this.name||"(unknown)"}" for "${e}". Default action not defined.`)},this.get=function(e){let r=this.point(e);if(r>-1)return this.pool[r].data;this.default(e)},this.run=function(e,...r){let h=this.point(e);h>-1?e.subarray?this.pool[h].data(e.subarray(this.pool[h].length),...r):this.pool[h].data(e.slice(this.pool[h].length),...r):this.default(e,...r)}};var q,bt,yt=(bt=class{constructor(){x(this,q,{})}addEventListener(E,e){a(this,q)[E]||(a(this,q)[E]=[]),a(this,q)[E].unshift(e)}removeEventListener(E,e){if(a(this,q)[E]){let r=a(this,q)[E].indexOf(e);r>-1&&a(this,q)[E].splice(r,1),a(this,q)[E].length<1&&delete a(this,q)[E]}}dispatchEvent(E,e){var b;let r=new Event(E),h=this;r.data=e,((b=a(this,q)[E])==null?void 0:b.length)>0&&a(this,q)[E].forEach(function(y){try{y==null||y.call(h,r)}catch(S){console.error(S)}}),this[`on${E}`]&&this[`on${E}`](r)}},q=new WeakMap,bt);var Xt=["MSB","PRG","LSB","NME","ELC","DRM"],nt=function(E){let e=Math.floor(E/10),r=E%10;return`${e.toString(16)}${r}`},K,gt,ct=(gt=class{constructor(...E){x(this,K,void 0);R(this,"strictMode",!1);this.loadFiles(...E)}get(E=0,e=0,r=0,h){var d,$;let b=[E,e,r],y,S=1,v=0,k,t=Array.from(arguments);switch(h){case"xg":{switch(E){case 0:{r==126?t[2]=125:r==127&&(t[2]=0);break}case 16:{r==126&&(t[2]=0);break}case 32:{r>125&&(t[2]=0),t[2]+=4;break}case 33:case 34:case 35:case 36:{r>125&&(t[2]=0),t[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:t[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{r==126&&(t[2]=0);break}case 48:case 64:case 126:case 127:{r==126&&(t[2]=0);break}}break}case"gs":{E==0&&r<5?t[2]=0:E>125&&r<5&&r!=2&&(t[2]=E,t[0]=0);break}case"g2":case"sd":{E>>1==40?t[2]|=16:E>95&&E<100&&(t[2]|=16,e>>3==15&&(t[0]=96));break}case"sg":{E==8&&r==0&&(t[2]=5);break}case"s90es":{r<8?t[2]+=17:r<32?t[2]+=13:t[2]=(t[2]>>3)+19;break}case"motif":{r<8?t[2]+=28:r<32?t[2]+=13:t[2]=(t[2]>>3)+19;break}}let i=" ",c="M",n=0,s=0;switch(t[0]){case 0:{t[2]==127?c="MT-a":t[2]==126?c="MT-b":t[2]==7?c="GM-k":t[2]==5?c="SG-a":t[2]==4?c="SP-l":t[2]==0||h=="gs"&&t[2]<5?c="GM-a":(c="y",n=3);break}case 8:{h=="sg"?c="GM-s":c="r:";break}case 32:case 33:case 34:case 35:case 36:{h=="xg"&&(c=`${["AP","VL","PF","DX","AN"][E&7]}-${"abcdefgh"[r]}`);break}case 48:{c=`yM${(t[2]>>3).toString().padStart(2,"0")}`,n=1;break}case 56:{c="GM-b";break}case 61:case 120:{c="rDrm";break}case 62:{c="kDrm";break}case 63:{if(t[2]<17){let m=t[2];c=m<10?"kP:":"kC:",c+=m%10}else t[2]<34?c=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][t[2]-17]:c="Ds";break}case 64:{c="ySFX";break}case 67:{c="DX:S";break}case 80:case 81:case 82:case 83:{c=`Prg${"UABC"[t[0]-80]}`;break}case 88:case 89:case 90:case 91:{c=`Cmb${"UABC"[t[0]-88]}`;break}case 95:{c=`${["DR","PC"][t[2]]}-d`;break}case 96:{c=t[2]==106?"AP-a":t[2]>>4==1?"SDg":"PF",t[2]>63?s=63:t[2]>>4==1&&(s=16),n=3;break}case 97:{c=t[2]>>4==1?"SDa":"VL:",n=3,t[2]>>4==1?s=16:s=112;break}case 98:{c=t[2]>>4==1?"SDb":"SG-a",n=3,s=16;break}case 99:{c=t[2]>>4==1?"SDc":"DX",t[2]>63?s=63:t[2]>>4==1&&(s=16),n=3;break}case 100:{c="AN",t[2]>63?s=63:t[2]>>4==1&&(s=16),n=3;break}case 104:case 105:case 106:case 107:{c="SDd",s=104;break}case 121:{c=`GM-${t[2]?"":"a"}`,n=3;break}case 122:{c="lDrm";break}case 126:{c="yDrS";break}case 127:{t[2]==127?c="rDrm":c="yDrm";break}default:t[0]<48?c="r:":c="M"}c.length<4&&(c+=`${[E,r,t[0],t[2]][n]-s}`.padStart(4-c.length,"0")),h=="xg"&&(E==0?t[2]<100?c=c.replace("y0","y:"):t[2]==125&&(c="y126"):E==16&&(y=`Voice${(t[2]*128+t[1]+1).toString().padStart(3,"0")}`,i=" "));let f=[t[0],t[1],t[2]];for(;!((y==null?void 0:y.length)>=0);)if(y=(d=a(this,K)[t[1]||0][(t[0]<<7)+t[2]])==null?void 0:d.name,y){let m=a(this,K)[t[1]||0][(t[0]<<7)+t[2]];S=(m==null?void 0:m.poly)||S,v=(m==null?void 0:m.type)||v,k=m==null?void 0:m.drum}else if(this.strictMode)y="",i="?";else if(t[0]==0&&t[1]==0&&t[2]==0)y="Unloaded";else if(a(this,K)[t[1]||0][t[0]<<7])t[0]==0?(t[2]=0,i="^"):t[2]<1?(t[0]=0,i="*"):(t[2]--,i="^");else if(E==48)t[0]=0,t[2]=0,i="!";else if(E==62)t[1]--,i=" ",t[1]<1&&!(y!=null&&y.length)&&(t[0]=0,i="!");else if(E<63)t[0]==0?(t[2]=0,i="^"):t[2]<1?(t[0]=0,i="*"):t[2]--;else if(E==80)y=`PrgU:${e.toString().padStart(3,"0")}`,i="!";else if(E==88)y=`CmbU:${e.toString().padStart(3,"0")}`,i="!";else if(E==121)y=`GM2Vox0${r}`,i="#";else if(E==122){if(t[1]==32?t[1]==0:t[1]%=7,y=($=a(this,K)[t[1]||0][(t[0]<<7)+t[2]])==null?void 0:$.name,y){i=" ";let m=a(this,K)[t[1]||0][(t[0]<<7)+t[2]];S=(m==null?void 0:m.poly)||S,v=(m==null?void 0:m.type)||v,k=m==null?void 0:m.drum}else y="",i="*"}else t[1]==0?(y=`${E.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")} ${r.toString().padStart(3,"0")}`,i="!"):t[0]==0?(t[2]=0,i="^"):t[2]>0?t[2]--:t[1]>0?(t[1]=0,i="!"):(t[0]=0,i="?");let l=[t[0],t[1],t[2]];(h=="gs"||h=="ns5r")&&i=="^"&&(i=" "),E==127&&i=="^"&&(i=" "),i!=" "&&self.debugMode&&(y="");let o="??";switch(t[0]){case 0:{t[2]==0?o="GM":t[2]==5||t[2]==7?o="KG":t[2]<126?o="XG":t[2]==127&&(o="MT");break}case 32:case 33:case 35:case 36:{t[2]>4?o=["AP","VL","PF","DX","AN"][t[0]-32]:o="GS";break}case 48:{o="MU";break}case 56:{o="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{o="AI";break}case 62:case 82:case 90:{o="XD";break}case 63:{t[2]<17?o="KR":t[2]<34?o="ES":o="DS";break}case 64:case 126:{o="XG";break}case 67:case 99:{o=t[2]>>4==1?"SD":"DX";break}case 81:{o="RW";break}case 95:{o=["DR","PC"][t[2]];break}case 96:{o=t[2]==106?"AP":t[2]>>4==1?"SD":"PF";break}case 97:{o=t[2]>>4==1?"SD":"VL";break}case 98:{o=t[2]>>4==1?"SD":"SG";break}case 100:{o="AN";break}case 104:case 105:case 106:case 107:{o="SD";break}case 120:{o="GS";break}case 121:{o=t[2]?"G2":"GM";break}case 122:{o="KG";break}case 127:{o=t[2]==127?"MT":e==0?"GM":"XG";break}default:t[0]<48&&(t[0]==16&&h=="xg"?o="XG":o="GS")}return{name:y||`${nt(E||0)} ${nt(e||0)} ${nt(r||0)}`,poly:S,type:v,drum:k,iid:f,eid:l,sid:b,ending:i,sect:c,standard:o}}async load(E,e,r="(internal)"){let h=this,b=[],y=0,S=0;E.split(`
`).forEach(function(v,k){let t=v.split("\t"),i=[];if(k==0){if(t.forEach(function(c,n){b[Xt.indexOf(c)]=n}),b.length<4){console.debug("Debugger launched.");debugger}}else{let c=0,n=0,s=0,f,l=1,o=0,d;t.forEach(async function(m,T){switch(T){case b[0]:{c=parseInt(m);break}case b[1]:{n=parseInt(m);break}case b[2]:{s=parseInt(m);break}case b[3]:{f=m;break}case b[4]:{m=parseInt(m),m<16?l=m+1:o=(m&15)+1;break}case b[5]:{d=m;break}}}),a(h,K)[n]=a(h,K)[n]||[];let $=a(h,K)[n];if(!$[c<<7|s]||e){let m={msb:c,prg:n,lsb:s,name:f,poly:l,type:o,drum:d};$[c<<7|s]=m,y++}S++}}),e||console.debug(`Map "${r}": ${S} total, ${y} loaded.`)}clearRange(E){let e=E.prg!=null?E.prg.constructor==Array?E.prg:[E.prg,E.prg]:[0,127],r=E.msb!=null?E.msb.constructor==Array?E.msb:[E.msb,E.msb]:[0,127],h=E.lsb!=null?E.lsb.constructor==Array?E.lsb:[E.lsb,E.lsb]:[0,127];for(let b=r[0];b<=r[1];b++){let y=b<<7;for(let S=h[0];S<=h[1];S++){let v=y+S;for(let k=e[0];k<=e[1];k++)delete a(this,K)[k][v]}}}init(){w(this,K,[]);for(let E=0;E<128;E++)a(this,K).push([""])}async loadFiles(...E){this.init();let e=this;E.forEach(async function(r){try{await fetch(`./data/bank/${r}.tsv`).then(function(h){return h.text()}).then(h=>{e.load(h,!1,r)})}catch(h){console.error(`Failed loading "${r}.tsv".`)}})}},K=new WeakMap,gt);var Ie,Et,$t=(Et=class{constructor(){x(this,Ie,{});R(this,"context")}set(E,e){a(this,Ie)[E]=e}has(E){return!!a(this,Ie)[E]}async read(E,e){if(!this.has(E))throw new Error(`No decoder registered for "${E}"`);return await a(this,Ie)[E].call(this.context||this,e)}},Ie=new WeakMap,Et);var Vt=function(E,e){let r=!0;return e.forEach((h,b)=>{r=r&&E[b]==h}),r},mt=function(E){let e=0;return E.forEach(r=>{e*=256,e+=r}),e},Qe=new TextDecoder,at=new $t;at.set("s7e",async function(E){let e=new Uint8Array(await E.slice(0,65536).arrayBuffer()),r="MSB\tLSB\tPRG\tNME",h=[0,0,0,0],b=32,y=0,S=0,v=!0,k=[],t=0;for(;v;){let i=e.subarray(y);([()=>{Qe.decode(i.subarray(0,4))=="YSFC"?(y+=80,S=1):y++},()=>{if(Vt(i.subarray(0,4),h))k.forEach((c,n,s)=>{let f=mt(e.subarray(c.start+4,c.start+8));c.length=f}),S=2;else{let c=Qe.decode(i.subarray(0,4)),n=mt(i.subarray(4,8));k.push({type:c,start:n}),y+=8}},()=>{let c=k[t],n=e.subarray(c.start,c.start+c.length),s=32;switch(c.type){case"ENVC":{let f=b;for(;f<n.length;){let l=n.subarray(f,f+s),o=Qe.decode(l.subarray(0,10)).trimEnd();o.slice(0,5)=="Init "&&(o=""),o&&(r+=`
063	${(l[17]+13).toString().padStart(3,"0")}	${l[19].toString().padStart(3,"0")}	${o}`),f+=s}break}case"EDVC":{let f=b;for(;f<n.length;){let l=n.subarray(f,f+s),o=Qe.decode(l.subarray(0,10)).trimEnd();o.slice(0,5)=="Init "&&(o=""),o&&(r+=`
063	024	${l[19].toString().padStart(3,"0")}	${o}`),f+=s}break}case"EPVC":{let f=32,l=b;for(;l<n.length;){let o=n.subarray(l,l+f),d=Qe.decode(o.subarray(0,10)).trimEnd();d=="----------"&&(d=""),d&&(r+=`
063	${(o[17]+1).toString().padStart(3,"0")}	${o[19].toString().padStart(3,"0")}	${d}`),l+=f}break}}t++,t>=k.length&&(S=3,v=!1)}][S]||(()=>{v=!1}))()}return r});var qe=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),Ye=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],Ft=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],Ge=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],vt=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],wt=function(E){let e=.1,r=-.3;return E>66?(e=5,r=315):E>56?(e=1,r=47):E>46&&(e=.5,r=18.5),e*E-r},kt=function(E){return E>105?Ft[E-106]:E>100?E*1.1-100:E/10},St=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),ot={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,うぃ
we,うぇ
wo,を
nga,ガ
ngi,ギ
ngu,グ
nge,ゲ
ngo,ゴ
ngy,ギ!
ng,
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,いぇ
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(E=>{let e=E.split(",");ot[e[0]]=e[1]});var xt=function(E){let e=E;E[0]=="*"&&(e=e.slice(1)),["aa","ii","uu","ee","oo"].forEach(h=>{for(;e.indexOf(h)>-1;)e=e.replace(h,h[0])});for(let h in ot)e=e.replaceAll(h,ot[h]);e.indexOf("\u3093")==0&&e.length>1&&(e=e.slice(1));let r=e.indexOf("!");return r>-1&&e.length>1&&(e=e.slice(r+1)),e},Ct=function(E){return E?E<96?`cc${E}`:["aftertouch","velocity","pitch bend"][E-96]:"off"};var lt=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],Mt=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],Tt=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var Kt={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},zt={66307:["drive"],66309:["vowel",E=>"aiueo"[E]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",E=>["off","LPF","HPF"][E]],94984:["noise type",E=>["white","pink"][E]],94987:["disc type",E=>["LP","SP","EP","RND"]],94990:["hum type",E=>`${E+5}0Hz`],94993:["M/S",E=>["mono","stereo"][E]]},dt=function(E){return Kt[(E[0]-32<<8)+E[1]]||`0x${E[0].toString(16).padStart(2,"0")}${E[1].toString(16).padStart(2,"0")}`},Rt=function(E,e,r){let h=(E[0]-32<<16)+(E[1]<<8)+e,b=zt[h]||{},y=b[0];if(y!=null&&y.length)return y+=`: ${(b[1]||function(){})(r)||r}`,y},ft=[68,48,95,78,41,3,110,122,0];var Y=function(E=64){return Math.round(2e3*Math.log10(E/64))/100};var Me=function(E){let e=0;return E.forEach(r=>{e+=r,e=e&127}),~e+1&127},ce=function(E,e){let r=0,h=0;for(let b=0;b<E.length;b++){let y=b%8-1,S=(h>>y&1)<<7,v=E[b];v+=S,b%8!=0?(e(v,r,E),r++):h=E[b]}};var We=function(E){let e=Math.floor(E*14.2);return e<128?e:0};var oe=["?","gm","gs","xg","g2","mt32","ns5r","x5d","05rw","sd","k11","sg","krs","s90es","motif"],Qt={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es"},qt=["melodic","drum","menu"],Dt=[[0,0,0,0,121,0,0,82,81,97,0,0,63,63,63],[0,0,4,0,0,127,0,0,0,0,0,0,0,0,0]],Te=[120,127,120,127,120,127,61,62,62,105,122,122,120,127,127],Yt=[0,3,81,84,88],Ot={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},Lt={0:0,1:1,2:3,5:4},At={0:0,1:1,2:2,5:3},Ut=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],Pt=[36,37,48,49,52,53],it=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],Nt={26:127,29:0,30:0,31:0,52:12,53:54},Ze=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,128,12,13,16,17,18,19,14,15,20,21,26,28,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],Wt=[2,12,13,14,15,16,17,18,19,20,21,136,130,131,132,133,134,135,137,138,139],Jt=[33,99,100,32,102,8,9,10],Bt=[0,16,25,40,32,64,26,48],C={};oe.forEach((E,e)=>{C[E]=e});var p={length:Ze.length};Ze.forEach((E,e)=>{p[E]=e});var se={length:it.length};it.forEach((E,e)=>{se[E]=e});var Zt={};qt.forEach((E,e)=>{Zt[E]=e});var O=function(){return!!self.Bun||self.debugMode||!1},jt=function(E){let e=[],r=0;return E==null||E.forEach(function(h,b){h==247?e.push(E.subarray(r,b)):h==240&&(r=b+1)}),e.length||e.push(E.subarray(0)),O()&&console.debug(e),e};var g={ch:128,cc:Ze.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,ace:8,drm:8,dpn:it.length,dnc:128,ext:2,efx:7,redir:32},Je={bank0:128},A,z,le,pe,j,ue,It,be,X,D,u,ye,U,G,W,_,V,ge,de,Re,fe,M,L,_e,Q,J,Xe,De,he,me,ie,Ve,ve,we,ee,H,P,Oe,Fe,Ke,ke,Se,je,ze,ne,N,rt,et,Le,ht,Z,Ee,xe,F,Ae,I,tt,st,Ue,Pe,te,ae,$e,Ne,Be,He,Ht,Ia=(Ht=class extends yt{constructor(){super();x(this,j);R(this,"NOTE_IDLE",0);R(this,"NOTE_ATTACK",1);R(this,"NOTE_DECAY",2);R(this,"NOTE_SUSTAIN",3);R(this,"NOTE_HELD",4);R(this,"NOTE_RELEASE",5);R(this,"NOTE_SOSTENUTO_ATTACK",8);R(this,"NOTE_SOSTENUTO_DECAY",9);R(this,"NOTE_SOSTENUTO_SUSTAIN",10);R(this,"NOTE_SOSTENUTO_HELD",11);R(this,"CH_MELODIC",0);R(this,"CH_DRUMS",1);R(this,"CH_DRUM1",2);R(this,"CH_DRUM2",3);R(this,"CH_DRUM3",4);R(this,"CH_DRUM4",5);R(this,"CH_DRUM5",6);R(this,"CH_DRUM6",7);R(this,"CH_DRUM7",8);R(this,"CH_DRUM8",9);R(this,"EXT_NONE",0);R(this,"EXT_VL",1);R(this,"VLBC_BRTHEXPR",1);R(this,"VLBC_VELOINIT",2);R(this,"VLBC_VELOALL",3);x(this,A,0);x(this,z,0);x(this,le,0);x(this,pe,new Array(11));x(this,be,new Uint8Array(g.ch));x(this,X,new Uint8Array(g.ch));x(this,D,new Uint8Array(g.ch));x(this,u,new Uint8Array(g.ch*g.cc));x(this,ye,new Uint8Array(g.ace));x(this,U,new Uint8Array(g.ch));x(this,G,new Uint8Array(g.ch*g.nn));x(this,W,new Uint8Array(g.ch));x(this,_,new Uint16Array(g.pl));x(this,V,new Uint8Array(g.pl));x(this,ge,new Int16Array(g.ch));x(this,de,new Uint8Array(g.ch));x(this,Re,0);x(this,fe,new Uint8Array(g.ch*g.ext));x(this,M,new Uint8Array(g.ch*g.rpn));x(this,L,new Uint8Array(g.ch*g.rpnt));x(this,_e,new Int8Array(g.ch*Pt.length));x(this,Q,new Uint8Array(g.drm*g.dpn*g.dnc));x(this,J,new Uint8Array(g.efx*3));x(this,Xe,new Uint8Array(g.ch));x(this,De,new Uint8Array(g.ch*g.redir));x(this,he,new Uint8Array(g.ch));x(this,me,new Uint8Array(128));x(this,ie,new Uint8Array(g.cmt*8));x(this,Ve,new Uint8Array(1024));x(this,ve,new Uint8Array(g.cmt*64));x(this,we,0);x(this,ee,0);x(this,H,void 0);x(this,P,100);x(this,Oe,0);x(this,Fe,500);x(this,Ke,0);x(this,ke,"");x(this,Se,0);x(this,je,0);x(this,ze,0);x(this,ne,!0);x(this,N,!1);x(this,rt,1);x(this,et,void 0);x(this,Le,new Array(g.ch));x(this,ht,new Uint8Array(2));x(this,Z,[]);x(this,Ee,new Uint8Array(g.ch));x(this,xe,new Uint8Array(g.tr));R(this,"baseBank",new ct("gm","gm2","xg","gs","ns5r","sd","gmega","plg-150vl","plg-150pf","plg-150dx","plg-150an","plg-150dr","plg-100sg","krs","s90es"));R(this,"userBank",new ct("gm"));R(this,"initOnReset",!1);R(this,"aiEfxName","");x(this,F,[]);x(this,Ae,void 0);x(this,I,{nOff:(e,r)=>{let h=e*128+r,b=a(this,_).lastIndexOf(h);if(b>-1)if(a(this,u)[g.cc*e+p[64]]>63)a(this,V)[b]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:r,velo:a(this,G)[h],state:this.NOTE_HELD});else if(a(this,u)[g.cc*e+p[66]]>63&&a(this,V)[b]==this.NOTE_SOSTENUTO_SUSTAIN)a(this,V)[b]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:r,velo:a(this,G)[h],state:this.NOTE_SOSTENUTO_HELD});else{a(this,_)[b]=0,a(this,G)[h]=0,a(this,V)[b]=this.NOTE_IDLE;let y=this.getExt(e)[1];(y==this.VLBC_VELOINIT||y==this.VLBC_VELOALL)&&(a(this,u)[g.cc*e+p[129]]=0),this.dispatchEvent("note",{part:e,note:r,velo:0,state:this.NOTE_IDLE})}},nOn:(e,r,h)=>{let b=e*128+r,y=0;for(a(this,W)[e]&&a(this,I).ano(e);a(this,V)[y]>0&&a(this,_)[y]!=b;)y++;if(y<g.pl){a(this,_)[y]=b,a(this,G)[b]=h,a(this,V)[y]=this.NOTE_SUSTAIN,a(this,de)[e]<h&&(a(this,de)[e]=h);let S=this.getExt(e)[1];(S==this.VLBC_VELOINIT||S==this.VLBC_VELOALL)&&(a(this,u)[g.cc*e+p[129]]=h),this.dispatchEvent("note",{part:e,note:r,velo:h,state:this.NOTE_SUSTAIN})}else console.error("Polyphony exceeded.")},nAt:(e,r,h)=>{},cAt:(e,r)=>{},hoOf:e=>{a(this,V).forEach((r,h)=>{if(r==this.NOTE_HELD){let b=a(this,_)[h],y=b>>7;e==y&&(a(this,V)[h]=this.NOTE_IDLE,a(this,_)[h]=0,a(this,G)[b]=0,this.dispatchEvent("note",{part:e,note:b&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{a(this,V).forEach((r,h)=>{let b;switch(r){case this.NOTE_ATTACK:{b=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{b=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{b=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(b){a(this,V)[h]=b;let y=a(this,_)[h];this.dispatchEvent("note",{part:e,note:y&127,velo:a(this,G)[y],state:b})}})},soOf:e=>{a(this,V).forEach((r,h)=>{if(r==this.NOTE_SOSTENUTO_HELD){let b=a(this,_)[h],y=b>>7;e==y&&(a(this,V)[h]=this.NOTE_IDLE,a(this,_)[h]=0,a(this,G)[b]=0,this.dispatchEvent("note",{part:e,note:b&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{a(this,_).forEach((r,h,b)=>{let y=r>>7,S=r&127;r==0&&a(this,G)[0]==0||y==e&&a(this,I).nOff(y,S)})}});x(this,tt,{8:function(e){let r=e.channel,h=e.data[0];a(this,I).nOff(r,h)},9:function(e){let r=e.channel;this.setChActive(r,1);let h=e.data[0],b=e.data[1];b>0?a(this,I).nOn(r,h,b):a(this,I).nOff(r,h)},10:function(e){let r=e.channel,h=r*128+e.data[0];a(this,_).indexOf(h)>-1&&(a(this,G)[h]=data[1],this.getExt(r)[1]==this.VLBC_VELOALL&&(a(this,u)[g.cc*r+p[129]]=data[1]),this.dispatchEvent("note",{part:r,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let r=e.channel,h=a(this,Le)[r],b=h[e.data[0]];b&&(e.data[0]=b),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(a(this,A)){case C.s90es:case C.motif:{if(e.data[0]==0){[0,63].indexOf(e.data[1])>-1&&this.setChActive(r,1);break}e.data[1]&&this.setChActive(r,1);break}default:{this.setChActive(r,1);break}}})();let y=r*g.cc,S=r*g.ext;switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{a(this,I).ano(r),a(this,ge)[r]=0,a(this,u)[y+p[1]]=0,a(this,u)[y+p[5]]=0,a(this,u)[y+p[64]]=0,a(this,u)[y+p[65]]=0,a(this,u)[y+p[66]]=0,a(this,u)[y+p[67]]=0,a(this,u)[y+p[11]]=127,a(this,u)[y+p[101]]=127,a(this,u)[y+p[100]]=127,a(this,u)[y+p[99]]=127,a(this,u)[y+p[98]]=127;return}case 123:{a(this,I).ano(r);return}case 124:{a(this,I).ano(r);return}case 125:{a(this,I).ano(r);return}case 126:{a(this,W)[r]=1,a(this,I).ano(r);return}case 127:{a(this,W)[r]=0,a(this,I).ano(r);return}}if(p[e.data[0]]==null)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(Wt.indexOf(e.data[0])>-1&&this.allocateAce(e.data[0]),e.data[0]){case 0:{switch(O()&&console.debug(`${oe[a(this,A)]}, CH${r+1}: ${e.data[1]}`),a(this,A)==0?e.data[1]<48?(a(this,D)[r]>0&&(e.data[1]=a(this,u)[y],e.data[1]=120,console.debug(`Forced channel ${r+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]==62?this.switchMode(a(this,H).x5==82?"x5d":"05rw"):e.data[1]==63?this.switchMode(this.modeIdx[a(this,H).ds]):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg"):a(this,A)==C.gs?e.data[1]<56&&a(this,D)[r]>0&&(e.data[1]=a(this,u)[y],e.data[1]=120,console.debug(`Forced channel ${r+1} to stay drums.`)):a(this,A)==C.gm&&(e.data[1]<48?a(this,D)[r]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${r+1} to stay drums.`)):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg",!0)),a(this,A)){case C.xg:{[79,95,126,127].indexOf(e.data[1])>-1?a(this,D)[r]==0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):a(this,D)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?a(this,fe)[S]=this.EXT_VL:a(this,fe)[S]=this.EXT_NONE;break}case C["05rw"]:case C.x5d:case C.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?a(this,D)[r]==this.CH_MELODIC&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):[80,81,82,83].indexOf(e.data[1])>-1||a(this,D)[r]!=this.CH_MELODIC&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case C.sd:{[104,105,106,107].indexOf(e.data[1])>-1?a(this,D)[r]==0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):a(this,D)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case C.g2:{e.data[1]==120?a(this,D)[r]==0&&(this.setChType(r,this.CH_DRUMS),console.debug(`CH${r+1} set to drums by MSB.`)):a(this,D)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}}this.dispatchEvent("voice",{part:r});break}case 2:{this.getExt(r)[1]==this.VLBC_BRTHEXPR&&(a(this,u)[y+p[129]]=e.data[1]);break}case 6:{if(a(this,Re)){[C.xg,C.gs,C.ns5r].indexOf(a(this,A))<0&&console.warn(`NRPN commits are not available under "${oe[a(this,A)]}" mode, even when they are supported in Octavia.`);let v=a(this,u)[y+p[99]],k=a(this,u)[y+p[98]];if(v==1){let t=Jt.indexOf(k);if(t>-1)a(this,u)[y+p[71+t]]=e.data[1],O()&&console.debug(`Redirected NRPN 1 ${k} to cc${71+t}.`),this.dispatchEvent("cc",{part:r,cc:71+t,data:e.data[1]});else{let i=Pt.indexOf(k);i>-1?a(this,_e)[r*10+i]=e.data[1]-64:console.warn(`NRPN 0x01${k.toString(16).padStart(2,"0")} is not supported.`),O()&&console.debug(`CH${r+1} voice NRPN ${k} commit`)}}else{if(it.indexOf(v)<0){let i=`NRPN 0x${v.toString(16).padStart(2,"0")}${k.toString(16).padStart(2,"0")} `;v==127?console.warn(`${i}is not necessary. Consider removing it.`):console.warn(`${i}is not supported.`)}else{let i=a(this,D)[r]-2;i<0?console.warn(`CH${r+1} cannot accept drum NRPN as type ${Ye[a(this,D)[r]]}.`):a(this,Q)[(i*g.dpn+se[v])*g.dnc+k]=e.data[1]}O()&&console.debug(`CH${r+1} (${Ye[a(this,D)[r]]}) drum NRPN ${v} commit`)}}else{let v=Lt[a(this,u)[y+p[100]]],k=At[a(this,u)[y+p[100]]];a(this,u)[y+p[101]]==0&&v!=null&&(O()&&console.debug(`CH${r+1} RPN 0 ${a(this,u)[y+p[100]]} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],Ut[v][0]),Ut[v][1]),a(this,M)[r*g.rpn+v]=e.data[1],a(this,L)[r*g.rpnt+k]=1)}break}case 32:{switch(O()&&console.debug(`${oe[a(this,A)]}, CH${r+1} LSB: ${e.data[1]}`),a(this,A)){case C.s90es:case C.motif:{this.setChType(r,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,a(this,A),!0);break}}this.dispatchEvent("voice",{part:r});break}case 38:{if(!a(this,Re)){let v=Lt[a(this,u)[y+100]],k=At[a(this,u)[y+100]];a(this,u)[y+101]==0&&v!=null&&(a(this,M)[r*g.rpn+v+1]=e.data[1],a(this,L)[r*g.rpnt+k]=1)}break}case 64:{e.data[1]<64&&a(this,I).hoOf(r);break}case 66:{e.data[1]>>6?a(this,I).soOn(r):a(this,I).soOf(r);break}case 98:case 99:{w(this,Re,1);break}case 100:case 101:{w(this,Re,0);break}}a(this,u)[y+p[e.data[0]]]=e.data[1],this.dispatchEvent("cc",{part:r,cc:e.data[0],data:e.data[1]})}},12:function(e){let r=e.channel;switch(a(this,A)){case C.s90es:case C.motif:{e.data&&this.setChActive(r,1);break}default:this.setChActive(r,1)}a(this,U)[r]=e.data,a(this,he)[r]=0,O()&&console.debug(`T:${e.track} C:${r} P:${e.data}`),this.dispatchEvent("voice",{part:r})},13:function(e){let r=this,h=e.channel;a(this,_).forEach(function(b){let y=b>>7;h==y&&(a(r,G)[b]=e.data,r.dispatchEvent("note",{part:h,note:b&127,velo:e.data,state:r.NOTE_SUSTAIN}))})},14:function(e){let r=e.channel;a(this,ge)[r]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)})},15:function(e){jt(e.data).forEach(r=>{let h=r[0],b=r[1];(a(this,st)[h]||function(){console.debug(`Unknown manufacturer ${h}.`)})(b,r.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(a(this,F)[e.meta]||function(h,b,y){}).call(this,e.data,e.track,e.meta),e.meta!=32&&w(this,Oe,0);let r=Yt.indexOf(e.meta)>-1;if(O()&&console.debug(e),r)return e.reply="meta",e}});x(this,st,{64:(e,r,h)=>{a(this,Ne).run(r,h,e)},65:(e,r,h)=>{if(r[0]<16){if(r[1]==72){let b=r[r.length-1],y=Me(r.subarray(3,r.length-1));b==y?a(this,ae).run(r.subarray(0,r.length-1),h,e):console.warn(`Bad SD checksum ${b}. Should be ${y}.`)}else a(this,ae).run(r,h,e)}else{let b=r[r.length-1],y=Me(r.subarray(2,r.length-1));b==y?a(this,ae).run(r.subarray(0,r.length-1),h,e):console.warn(`Bad GS checksum ${b}. Should be ${y}.`)}},66:(e,r,h)=>{a(this,$e).run(r,h,e)},67:(e,r,h)=>{a(this,te).run(r,h,e)},68:(e,r,h)=>{a(this,He).run(r,h,e)},71:(e,r,h)=>{a(this,Be).run(r,h,e)},126:(e,r,h)=>{a(this,Ue).run(r,h,e)},127:(e,r,h)=>{this.switchMode("gm"),a(this,Pe).run(r,h,e)}});x(this,Ue,void 0);x(this,Pe,void 0);x(this,te,void 0);x(this,ae,void 0);x(this,$e,void 0);x(this,Ne,void 0);x(this,Be,void 0);x(this,He,void 0);let e=this;w(e,j,new Uint8Array(256),It),a(e,pe)[10]=new Uint8Array(512),w(e,Ae,new re),w(e,H,{x5:82,ds:C.krs}),e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(t){var c,n;let{data:i}=t;((c=a(e,Z)[0])==null?void 0:c.type)==i.type&&(n=a(e,Z)[0])!=null&&n.amend?(a(e,Z)[0].amend=i.amend,a(e,Z)[0].data+=i.data):a(e,Z).unshift(i)}),a(e,F)[1]=function(t){var i,c,n,s,f;switch(t=t.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),t.slice(0,2)){case"@I":{w(this,N,!0),this.dispatchEvent("metacommit",{type:"Kar.Info",data:(i=t.slice(2))==null?void 0:i.trimLeft()});break}case"@K":{w(this,N,!0),this.dispatchEvent("metacommit",{type:"Kar.Mode",data:(c=t.slice(2))==null?void 0:c.trimLeft()}),console.debug(`Karaoke mode active: ${t.slice(2)}`);break}case"@L":{w(this,N,!0),this.dispatchEvent("metacommit",{type:"Kar.Lang",data:(n=t.slice(2))==null?void 0:n.trimLeft()});break}case"@T":{w(this,N,!0),this.dispatchEvent("metacommit",{type:"KarTitle",data:(s=t.slice(2))==null?void 0:s.trimLeft()});break}case"@V":{w(this,N,!0),this.dispatchEvent("metacommit",{type:"Kar.Ver.",data:(f=t.slice(2))==null?void 0:f.trimLeft()});break}case"XF":{let l=t.slice(2).split(":");switch(l[0]){case"hd":{l.slice(1).forEach((o,d)=>{o.length&&this.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][d],data:o})});break}case"ln":{l.slice(1).forEach((o,d)=>{o.length&&this.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][d],data:o})});break}default:this.dispatchEvent("metacommit",{type:"XfUnData",data:t})}break}default:a(this,N)?t[0]=="\\"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:t.slice(1),amend:!0})):t[0]=="/"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:t.slice(1),mask:!0,amend:!0})):this.dispatchEvent("metacommit",{type:"KarLyric",data:t,amend:!0}):t.split(`
`).forEach((l,o)=>{this.dispatchEvent("metacommit",{type:"Cmn.Text",data:l,mask:o!=0})})}},a(e,F)[2]=function(t){this.dispatchEvent("metacommit",{type:"Copyrite",data:t})},a(e,F)[3]=function(t,i){i<1&&a(this,Oe)<1&&this.dispatchEvent("metacommit",{type:"TrkTitle",data:t})},a(e,F)[4]=function(t,i){this.dispatchEvent("metacommit",{type:"Instrmnt",data:t})},a(e,F)[5]=function(t){t.trim()==""?this.dispatchEvent("metacommit",{type:"C.Lyrics",data:"",amend:!1}):this.dispatchEvent("metacommit",{type:"C.Lyrics",data:t,amend:!0})},a(e,F)[6]=function(t){this.dispatchEvent("metacommit",{type:"C.Marker",data:t})},a(e,F)[7]=function(t){this.dispatchEvent("metacommit",{type:"CuePoint",data:t})},a(e,F)[32]=function(t){w(this,Oe,t[0]+1)},a(e,F)[33]=function(t,i){a(e,xe)[i]=t+1},a(e,F)[81]=function(t,i){w(e,Fe,t/1e3)},a(e,F)[127]=function(t,i){a(e,Ae).run(t,i)},a(e,Ae).default=function(t){console.warn(`Unrecognized sequencer-specific byte sequence: ${t}`)},a(e,Ae).add([67,0,1],function(t,i){a(e,xe)[i]=t[0]+1}),w(e,Ue,new re("universal non-realtime")),w(e,Pe,new re("universal realtime")),w(e,te,new re("Yamaha")),w(e,ae,new re("Roland")),w(e,$e,new re("Korg")),w(e,Ne,new re("Kawai")),w(e,Be,new re("Akai")),w(e,He,new re("Casio"));let r=new re("DX7+ Dump"),h=function(t){console.info(`Unrecognized SysEx in "${this.name}" set.
%o`,t)};a(e,Ue).default=h,a(e,Pe).default=h,a(e,te).default=h,a(e,ae).default=h,a(e,$e).default=h,a(e,Ne).default=h,a(e,Be).default=h,a(e,He).default=h,r.default=h,a(e,Ue).add([9],t=>{e.switchMode(["gm","?","g2"][t[0]-1],!0),w(e,N,a(e,N)||!1),console.info(`MIDI reset: ${["GM","Init","GM2"][t[0]-1]}`),t[0]==2&&e.init()}),a(e,Pe).add([4,1],t=>{w(e,P,((t[1]<<7)+t[0])/16383*100),e.dispatchEvent("mastervolume",a(e,P))}).add([4,3],t=>((t[1]<<7)+t[0]-8192)/8192).add([4,4],t=>t[1]-64).add([4,5],t=>{let i=t[0],c=t[1],n=t[2],s=3,f=s+(i<<1),l=f+c;if(i!=1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${i})!
`,t);return}let o=0,d=0,$=0;switch(t.subarray(s,f).forEach(m=>{o=o<<7,o|=m}),t.subarray(f,l).forEach((m,T)=>{d|=m<<T*7}),t.subarray(l).forEach((m,T)=>{$|=m<<T*7}),O()&&console.debug(`GM2 global parameter: (${t.subarray(3,f)}; p: ${d}, v: ${$})`),o){case 129:{d==0&&(e.setEffectType(0,52,$),e.dispatchEvent("efxreverb",e.getEffectType(0)));break}case 130:{d==0&&(e.setEffectType(1,52,$|16),e.dispatchEvent("efxchorus",e.getEffectType(1)));break}default:O()&&console.debug("GM2 global paramater slot path unknown.")}}),a(this,te).add([76,0,0],t=>{switch(t[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset: ${t}`);break}case 126:{e.switchMode("xg",!0),w(e,N,!1),console.info("MIDI reset: XG");break}default:{let i=[0,0,0,0],c=(n,s)=>{i[s]=n};if(t.subarray(1).forEach((n,s)=>{let f=s+t[0];([c,c,c,c,l=>{w(this,P,l*129/16383*100),e.dispatchEvent("mastervolume",a(e,P))},l=>{},l=>{}][f]||(()=>{}))(n,s)}),t[0]<4){let n=0;i.forEach(s=>{n=n<<4,n+=s}),n-=1024}}}}).add([76,2,1],t=>{let i="XG ";t[0]<32?(i+="reverb ",t.subarray(1).forEach((c,n)=>{([s=>{e.setEffectTypeRaw(0,!1,s),console.info(`${i}main type: ${qe[s]}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},s=>{e.setEffectTypeRaw(0,!0,s),console.debug(`${i}sub type: ${s+1}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},s=>{console.debug(`${i}time: ${wt(s)}s`)},s=>{console.debug(`${i}diffusion: ${s}`)},s=>{console.debug(`${i}initial delay: ${s}`)},s=>{console.debug(`${i}HPF cutoff: ${Ge[s]}Hz`)},s=>{console.debug(`${i}LPF cutoff: ${Ge[s]}Hz`)},s=>{console.debug(`${i}width: ${s}`)},s=>{console.debug(`${i}height: ${s}`)},s=>{console.debug(`${i}depth: ${s}`)},s=>{console.debug(`${i}wall type: ${s}`)},s=>{console.debug(`${i}dry/wet: ${s}`)},s=>{console.debug(`${i}send: ${Y(s)}dB`)},s=>{console.debug(`${i}pan: ${s-64}`)},!1,!1,s=>{console.debug(`${i}delay: ${s}`)},s=>{console.debug(`${i}density: ${s}`)},s=>{console.debug(`${i}balance: ${s}`)},s=>{},s=>{console.debug(`${i}feedback: ${s}`)},s=>{}][t[0]+n]||function(){console.warn(`Unknown XG reverb address: ${t[0]}.`)})(c)})):t[0]<64?(i+="chorus ",t.subarray(1).forEach((c,n)=>{([s=>{e.setEffectTypeRaw(1,!1,s),console.info(`${i}main type: ${qe[s]}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},s=>{e.setEffectTypeRaw(1,!0,s),console.debug(`${i}sub type: ${s+1}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},s=>{console.debug(`${i}LFO: ${vt[s]}Hz`)},s=>{},s=>{console.debug(`${i}feedback: ${s}`)},s=>{console.debug(`${i}delay offset: ${kt(s)}ms`)},s=>{},s=>{console.debug(`${i}low: ${Ge[s]}Hz`)},s=>{console.debug(`${i}low: ${s-64}dB`)},s=>{console.debug(`${i}high: ${Ge[s]}Hz`)},s=>{console.debug(`${i}high: ${s-64}dB`)},s=>{console.debug(`${i}dry/wet: ${s}`)},s=>{console.debug(`${i}send: ${Y(s)}dB`)},s=>{console.debug(`${i}pan: ${s-64}`)},s=>{console.debug(`${i}to reverb: ${Y(s)}dB`)},!1,s=>{},s=>{},s=>{},s=>{console.debug(`${i}LFO phase diff: ${(s-64)*3}deg`)},s=>{console.debug(`${i}input mode: ${s?"stereo":"mono"}`)},s=>{}][t[0]-32+n]||function(){console.warn(`Unknown XG chorus address: ${t[0]}.`)})(c)})):t[0]<86?(i+="variation ",t.subarray(1).forEach((c,n)=>{([s=>{e.setEffectTypeRaw(2,!1,s),console.info(`${i}main type: ${qe[s]}`),e.dispatchEvent("efxdelay",e.getEffectType(2))},s=>{e.setEffectTypeRaw(2,!0,s),console.debug(`${i}sub type: ${s+1}`),e.dispatchEvent("efxdelay",e.getEffectType(2))}][t[0]-64+n]||function(){})(c)})):t[0]<97?(i+="variation ",t.subarray(1).forEach((c,n)=>{[s=>{console.debug(`${i}send: ${Y(s)}dB`)},s=>{console.debug(`${i}pan: ${s-64}`)},s=>{console.debug(`${i}to reverb: ${Y(s)}dB`)},s=>{console.debug(`${i}to chorus: ${Y(s)}dB`)},s=>{console.debug(`${i}connection: ${s?"system":"insertion"}`)},s=>{console.debug(`${i}channel: CH${s+1}`)},s=>{console.debug(`${i}mod wheel: ${s-64}`)},s=>{console.debug(`${i}bend wheel: ${s-64}`)},s=>{console.debug(`${i}channel after touch: ${s-64}`)},s=>{console.debug(`${i}AC1: ${s-64}`)},s=>{console.debug(`${i}AC2: ${s-64}`)}][t[0]-86+n](c)})):t[0]>111&&t[0]<118?i+="variation ":console.warn(`Unknown XG variation address: ${t[0]}`)}).add([76,2,64],t=>{t.subarray(1).forEach((i,c)=>{let n=c+t[0];if(n==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][i]}`);else{let s=n-1>>2,f=n-1&3,l=`XG EQ ${s} ${["gain","freq","Q","shape"][f]}: `;[()=>{console.debug(`${l}${i-64}dB`)},()=>{console.debug(`${l}${i} (raw)`)},()=>{console.debug(`${l}${i/10}`)},()=>{console.debug(`${l}${["shelf","peak"][+!!i]}`)}][f]()}})}).add([76,3],t=>{let i=t[0],c=t[1],n=`XG Insertion ${t[0]+1} `;t.subarray(2).forEach((s,f)=>{([l=>{e.setEffectTypeRaw(3+i,!1,l),console.info(`${n}main type: ${qe[l]}`),e.dispatchEvent(`efxinsert${i}`,e.getEffectType(3+i))},l=>{e.setEffectTypeRaw(3+i,!0,l),console.debug(`${n}sub type: ${l+1}`),e.dispatchEvent(`efxinsert${i}`,e.getEffectType(3+i))}][c+f]||function(){})(s)})}).add([76,6,0],t=>{let i=t[0];i<64?e.setLetterDisplay(t.subarray(1),"XG letter display",i):w(e,Se,Date.now())}).add([76,7,0],t=>{let i=t[0];w(e,z,0),w(e,le,Date.now()+3200),a(e,j,ue).fill(0);let c=t.subarray(1);for(let n=0;n<i;n++)c.unshift(0);c.forEach(function(n,s){let f=Math.floor(s/16),l=s%16,o=(l*3+f)*7,d=7,$=0;for(o-=l*5,f==2&&(d=2);$<d;)a(e,j,ue)[o+$]=n>>6-$&1,$++})}).add([76,8],(t,i)=>{let c=e.chRedir(t[0],i,!0),n=t[1],s=g.cc*c,f=`XG CH${c+1} `,l=`Unknown XG part address ${n}.`;t.subarray(2).forEach((o,d)=>{n<1?console.debug(l):n<41?([()=>{a(e,u)[s+p[0]]=o,e.dispatchEvent("voice",{part:c})},()=>{a(e,u)[s+p[32]]=o,e.dispatchEvent("voice",{part:c})},()=>{a(e,U)[c]=o,e.dispatchEvent("voice",{part:c})},()=>{let $=e.chRedir(o,i,!0);a(e,X)[c]=$,c!=$&&(e.buildRchTree(),console.info(`${f}receives from CH${$+1}`))},()=>{a(e,W)[c]=+!o},()=>{},()=>{e.setChType(c,o,C.xg),console.debug(`${f}type: ${Ye[o]||o}`)},()=>{a(e,M)[g.rpn*c+3]=o,a(e,L)[g.rpnt*c+2]=1},!1,!1,()=>{a(e,u)[s+p[7]]=o},!1,!1,()=>{a(e,u)[s+p[10]]=o||128},!1,!1,()=>{a(e,u)[s+p[128]]=o},()=>{a(e,u)[s+p[93]]=o},()=>{a(e,u)[s+p[91]]=o},()=>{a(e,u)[s+p[94]]=o},()=>{a(e,u)[s+p[76]]=o},()=>{a(e,u)[s+p[77]]=o},()=>{a(e,u)[s+p[78]]=o},()=>{a(e,u)[s+p[74]]=o},()=>{a(e,u)[s+p[71]]=o},()=>{a(e,u)[s+p[73]]=o},()=>{a(e,u)[s+p[75]]=o},()=>{a(e,u)[s+p[72]]=o}][n+d-1]||(()=>{}))():n<48?console.debug(l):n<111?n>102&&n<105&&(a(e,u)[s+p[[5,65][n&1]]]=o):n<114?console.debug(l):n<116?console.debug(`${f}EQ ${["bass","treble"][n&1]} gain: ${o-64}dB`):n<118?console.debug(l):n<120?console.debug(`${f}EQ ${["bass","treble"][n&1]} freq: ${o}`):console.debug(l)})}).add([76,9],(t,i)=>{let c=e.chRedir(t[0],i,!0),n=t[1],s=g.cc*c,f=`PLG-VL CH${c+1} `;t.subarray(2).forEach((l,o)=>{let d=o+n;switch(d){case 1:{console.info(`${f}breath mode: ${["system","breath","velocity","touch EG"][l]}`);break}case 0:case 27:case 28:break;default:if(d<27){let $=d-3>>1,m=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][$];d&1?d<23?(console.debug(`${f}${m} control source: ${Ct(l)}`),l&&l<96&&e.allocateAce(130+$),a(e,De)[g.redir*c+$+2]=l,e.buildRccMap()):console.debug(`${f}${m} scale break point: ${l}`):(console.debug(`${f}${m} depth: ${l-64}`),a(e,u)[s+p[130+$]]=l)}}})}).add([76,10],t=>{}).add([76,16],t=>{}).add([76,17,0,0],t=>{}).add([76,112],t=>{switch(console.debug(`XG enable PLG-${["VL","SG","DX","AN","PF","DR","PC","AP"][t[0]]} for CH${t[2]+1}.`),t[0]){case 0:{a(e,fe)[g.ext*t[2]]=e.EXT_VL;break}default:a(e,fe)[g.ext*t[2]]=e.EXT_NONE}}).add([73,0,0],(t,i)=>{let c=t[0],n="MU1000 System: ";t.subarray(1).forEach((s,f)=>{let l=c+f;l==8?console.debug(`${n}LCD contrast set to ${s}.`):l==18?(w(e,ee,s?126:0),console.debug(`${n}bank defaults to ${s?"MU100 Native":"MU Basic"}.`)):l>=64&&l<69&&[()=>{e.dispatchEvent("channelactive",s)},()=>{s<8?(e.dispatchEvent("channelmin",s<<4),console.debug(`Octavia System: Minimum CH${(s<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{s<8?(e.dispatchEvent("channelmax",(s<<4)+15),console.debug(`Octavia System: Maximum CH${(s<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{w(e,ne,!!s),console.info(`Octavia System: RS receiving ${["dis","en"][s]}abled.`)}][l-64]()})}).add([73,10,0],(t,i)=>{let c=t[0],n=`MU1000 RS${a(e,ne)?"":" (ignored)"}: `;if(c<16)switch(c){case 2:{let s=e.chRedir(0,i,!0);a(e,ne)&&(e.dispatchEvent("channelmin",s),e.dispatchEvent("channelmax",s+63)),console.info(`${n}Show CH1~64`);break}case 3:{let s=e.chRedir(t[1]<<5,i,!0);a(e,ne)&&e.dispatchEvent("channelmin",s),a(e,ne)&&e.dispatchEvent("channelmax",s+31),console.info(`${n}Show CH${s+1}~CH${s+32}`);break}default:console.debug(`${n}unknown switch ${c} invoked.`)}else if(c<32){if(a(e,ne)){let s=e.chRedir(c-16+(a(e,ze)<<4),i,!0);e.dispatchEvent("channelactive",s)}}else if(c<36){let s=e.chRedir(c-32<<4,i,!0);a(e,ne)&&(e.dispatchEvent("channelmin",s),e.dispatchEvent("channelmax",s+15),w(e,ze,c-32)),console.info(`${n}Show CH${s+1}~CH${s+16}`)}}).add([93,3],(t,i)=>{let c=e.chRedir(t[0],i,!0),n=`PLG-100SG CH${c+1} `,s=Date.now();if(t[1]==0){let f="",l=0;t.subarray(2).forEach((o,d)=>{d%2==0?f+=St[o]||o.toString().padStart("0"):l+=o*13}),s>=a(e,Ke)&&this.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"SGLyrics",data:`${xt(f)}`,amend:!0}),w(e,Ke,s+Math.ceil(l/2)+a(e,Fe)),O()&&console.debug(`${n}vocals: ${f}`)}else console.warn(`Unknown PLG-100SG data: ${t}`)}).add([100,0],(t,i,c)=>{let n=t.subarray(0,t.length-1),s=Me(n),f=t[t.length-1];if(s!=f){console.warn(`Yamaha DX7 dump SysEx checksum mismatch! Expected ${s}, but got ${f}:
`,t);return}else r.run(n)}),r.add([0,14,31],t=>{a(e,u)[g.cc*t[0]+p[64]]=0,a(e,I).ano(t[0]),e.switchMode("xg"),console.debug(`Yamaha DX7+ reset CH${t[0]+1}.`)}).add([56,76,112],async t=>{let i=t[0],c="";t.subarray(1).forEach((n,s)=>{s<10&&(c+=String.fromCharCode(Math.max(n,32)))}),a(e,U)[i]=i&127,a(e,u)[g.cc*i+p[0]]=35,a(e,u)[g.cc*i+p[32]]=i>>7|2,e.dispatchEvent("voice",{part:i}),c.length>0&&(c=c.trimRight(),console.debug(`DX7+ CH${i+1} dumped voice name: "${c}"`))});let b=function(t,i,c,n){},y=function(t,i){let c=t*g.dpn,n=i[0],s=i[1];i.subarray(2).forEach((f,l)=>{let o=l+s,d=-1;o<16?([()=>{d=24},()=>{d=25},()=>{d=26},()=>{},()=>{d=28},()=>{d=29},()=>{d=30},()=>{d=31},()=>{},()=>{},()=>{},()=>{d=20},()=>{d=21},()=>{d=22},()=>{d=23},()=>{}][o]||(()=>{console.debug(`Unknown XG-style drum param ${o} on set ${t+1}.`)}))():o<32||(o<40?([()=>{d=48},()=>{d=49},!1,!1,()=>{d=52},()=>{d=53}][o-32]||(()=>{console.debug(`Unknown XG-style drum param ${o} on set ${t+1}.`)}))():o<80||([()=>{d=36}][o-80]||(()=>{console.debug(`Unknown XG-style drum param ${o} on set ${t+1}.`)}))()),d>=0?(O()&&console.debug(c,d,n,f),a(e,Q)[(c+se[d])*g.dnc+n]=f):O()&&console.debug(`XG-style drum param ${o} has no writes.`)})},S=function(t,i,c){let n=t*g.dpn,s=(i<<7)+c[0];c.subarray(1).forEach((f,l)=>{let o=l+s,d=o&127,$=o>>7,m=-1;$>1&&([()=>{m=26},()=>{},()=>{m=28},()=>{m=29},()=>{m=30},()=>{},()=>{},()=>{m=31}][$-2]||(()=>{console.debug(`Unknown GS-style drum param ${$} on set ${t+1}.`)}))(),m>-1?(O()&&console.debug(n,m,d,f),a(e,Q)[(n+se[m])*g.dnc+d]=f):O()&&console.debug(`GS-style drum param ${$} has no writes.`)})};a(this,te).add([76,48],(t,i,c)=>{y(0,t)}).add([76,49],(t,i,c)=>{y(1,t)}).add([76,50],(t,i,c)=>{y(2,t)}).add([76,51],(t,i,c)=>{y(3,t)}).add([76,52],(t,i,c)=>{y(4,t)}).add([76,53],(t,i,c)=>{y(5,t)}).add([76,54],(t,i,c)=>{y(6,t)}).add([76,55],(t,i,c)=>{y(7,t)}),a(this,te).add([89,0],(t,i,c)=>{if(e.eprom){let n=t[0],s=(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);O()&&console.debug(`MU1000 EPROM trail to 0x${s.toString(16).padStart(6,"0")}, ${n} bytes.`);let f=e.eprom.data;t.subarray(4).forEach((l,o)=>{let d=o>>3,$=o&7;if($==7)for(let m=0;m<7;m++)f[s+7*d+m]+=(l>>6-m&1)<<7;else f[s+7*d+$]=l})}}).add([89,1],(t,i,c)=>{let n=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3];O()&&console.debug(`MU1000 EPROM jump to 0x${n.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=n)}).add([89,2],(t,i,c)=>{if(e.eprom){let n=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);O()&&console.debug(`MU1000 EPROM write to 0x${n.toString(16).padStart(6,"0")}.`);let s=e.eprom.data;t.subarray(4).forEach((f,l)=>{let o=l>>3,d=l&7;if(d==7)for(let $=0;$<7;$++)s[n+7*o+$]+=(f>>6-$&1)<<7;else s[n+7*o+d]=f})}}).add([89,3],(t,i,c)=>{}),a(this,te).add([39,48],(t,i,c)=>{}).add([43,0,0],(t,i,c)=>{let n=[0,0,0,0],s=(f,l)=>{n[l]=f};if(t.subarray(1).forEach((f,l)=>{let o=l+t[0];[s,s,s,s,()=>{w(this,P,f*129/16383*100),e.dispatchEvent("mastervolume",a(e,P))},()=>f-64,()=>f||128,()=>f,()=>f,()=>{console.debug(`TG300 variation on cc${f}.`)}][o](f,o)}),t[0]<4){let f=0;n.forEach(l=>{f=f<<4,f+=l}),f-=1024}}).add([43,1,0],(t,i,c)=>{}).add([43,2],(t,i,c)=>{let n=e.chRedir(t[0],i,!0),s=t[1],f=g.cc*n,l=`TG300 CH${n+1} `;t.subarray(2).forEach((o,d)=>{d<5?([()=>{},()=>{a(e,u)[f+p[0]]=o,e.dispatchEvent("voice",{part:n})},()=>{a(e,u)[f+p[32]]=o,e.dispatchEvent("voice",{part:n})},()=>{a(e,U)[n]=o,e.dispatchEvent("voice",{part:n})},()=>{let $=e.chRedir(o,i,!0);a(e,X)[n]=$,n!=$&&(e.buildRchTree(),console.info(`${l}receives from CH${$+1}`))}][d+s]||(()=>{}))(o,d+s):d<21||(d<47?([()=>{a(e,W)[n]=+!o},()=>{},()=>{},()=>{a(e,M)[g.rpn*n+3]=o,a(e,L)[g.rpnt*n+2]=1},()=>{},()=>{a(e,u)[f+p[7]]=o},!1,!1,()=>{a(e,u)[f+p[10]]=o||128},!1,!1,()=>{console.debug(`${l} AC1 at cc${o}`)},()=>{console.debug(`${l} AC2 at cc${o}`)},()=>{a(e,u)[f+p[128]]=o},()=>{a(e,u)[f+p[93]]=o},()=>{a(e,u)[f+p[91]]=o},()=>{a(e,u)[f+p[94]]=o},()=>{a(e,u)[f+p[76]]=o},()=>{a(e,u)[f+p[77]]=o},()=>{a(e,u)[f+p[74]]=o},()=>{a(e,u)[f+p[71]]=o},()=>{a(e,u)[f+p[73]]=o},()=>{a(e,u)[f+p[75]]=o},()=>{a(e,u)[f+p[72]]=o},()=>{a(e,u)[f+p[78]]=o}][d+s-21]||(()=>{}))(o,d+s):d<95||([()=>{a(e,u)[f+p[65]]=o},()=>{a(e,u)[f+p[5]]=o}][d+s-95]||(()=>{}))(o,d+s))})}).add([43,7,0],(t,i,c)=>{let n=t[0];e.setLetterDisplay(t.subarray(1),"TG300 letter display",n)}).add([43,7,1],(t,i,c)=>{w(e,z,0),w(e,le,Date.now()+3200),a(e,j,ue).fill(0),t.forEach(function(n,s){let f=Math.floor(s/16),l=s%16,o=(l*3+f)*7,d=7,$=0;for(o-=l*5,f==2&&(d=2);$<d;)a(e,j,ue)[o+$]=n>>6-$&1,$++})}),a(this,ae).add([66,18,0,0,127],(t,i,c)=>{e.switchMode("gs",!0),a(e,u)[g.cc*9]=120,a(e,u)[g.cc*25]=120,a(e,u)[g.cc*41]=120,a(e,u)[g.cc*57]=120,w(e,ee,3),w(e,N,!1),a(e,Ee).fill(0),console.info(`GS system to ${["single","dual"][t[0]]} mode.`)}).add([66,18,64,0],(t,i,c)=>{switch(t[0]){case 127:{e.switchMode("gs",!0),a(e,u)[g.cc*9]=120,a(e,u)[g.cc*25]=120,a(e,u)[g.cc*41]=120,a(e,u)[g.cc*57]=120,w(e,N,!1),a(e,Ee).fill(0),console.info("MIDI reset: GS");break}default:{let n=[0,0,0,0],s=(f,l)=>{n[l]=f};if(t.subarray(1).forEach((f,l)=>{let o=l+t[0];[s,s,s,s,d=>{w(this,P,d*129/16383*100),e.dispatchEvent("mastervolume",a(e,P))},d=>{},d=>{}][o](f,l)}),t[0]<4){let f=0;n.forEach(l=>{f=f<<4,f+=l}),f-=1024}}}}).add([66,18,64,1],t=>{let i=t[0];if(i<16){let c="".padStart(i," ");t.subarray(1).forEach((n,s)=>{c+=String.fromCharCode(Math.max(32,n))}),c=c.padEnd(16," "),console.debug(`GS patch name: ${c}`)}else i<48||(i<65?t.subarray(1).forEach((c,n)=>{let s=`GS ${i+n>55?"chorus":"reverb"} `;([()=>{console.info(`${s}type: ${lt[c]}`),e.setEffectType(0,40,c),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${s}predelay: ${c}ms`)},()=>{console.info(`${s}type: ${Mt[c]}`),e.setEffectType(1,40,16+c),e.dispatchEvent("efxchorus",e.getEffectType(1))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${s}to reverb: ${Y(c)}`)},()=>{console.debug(`${s}to delay: ${Y(c)}`)}][i+n-48]||(()=>{}))()}):i<80?console.debug(`Unknown GS patch address: ${i}`):i<91?t.subarray(1).forEach((c,n)=>{let s="GS delay ";([()=>{console.info(`${s}type: ${Tt[c]}`),e.setEffectType(2,40,32+c),e.dispatchEvent("efxdelay",e.getEffectType(2))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${s}to reverb: ${Y(c)}`)}][i+n-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${i}`))}).add([66,18,64,2],t=>{let i="GS EQ ";t.subarray(1).forEach((c,n)=>{([()=>{console.debug(`${i}low freq: ${[200,400][c]}Hz`)},()=>{console.debug(`${i}low gain: ${c-64}dB`)},()=>{console.debug(`${i}high freq: ${[3e3,6e3][c]}Hz`)},()=>{console.debug(`${i}high gain: ${c-64}dB`)}][t[0]+n]||function(){console.warn(`Unknown GS EQ address: ${t[0]+n}`)})()})}).add([66,18,64,3],t=>{let i="GS EFX ",c=function(n,s){let f=Rt(a(e,J).subarray(10,12),s,n);f&&console.debug(`${i}${dt(a(e,J).subarray(10,12))} ${f}`)};t.subarray(1).forEach((n,s)=>{([()=>{e.setEffectTypeRaw(3,!1,32+n),e.dispatchEvent("efxinsert0",e.getEffectType(3))},()=>{e.setEffectTypeRaw(3,!0,n),console.info(`${i}type: ${dt(a(e,J).subarray(10,12))}`),e.dispatchEvent("efxinsert0",e.getEffectType(3))},!1,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,()=>{console.debug(`${i}to reverb: ${Y(n)}dB`)},()=>{console.debug(`${i}to chorus: ${Y(n)}dB`)},()=>{console.debug(`${i}to delay: ${Y(n)}dB`)},!1,()=>{console.debug(`${i}1 source: ${n}`),n&&n<96&&e.allocateAce(n)},()=>{console.debug(`${i}1 depth: ${n-64}`)},()=>{console.debug(`${i}2 source: ${n}`),n&&n<96&&e.allocateAce(n)},()=>{console.debug(`${i}2 depth: ${n-64}`)},()=>{console.debug(`${i}to EQ: ${n?"ON":"OFF"}`)}][t[0]+s]||function(f,l){console.warn(`Unknown GS EFX address: ${l}`)})(n,t[0]+s)})}).add([66,18,65],t=>{S((t[0]>>4)+1<<1,t[0]&15,t.subarray(1))}).add([69,18,16],t=>{var i;switch(t[0]){case 0:{let c=t[1];e.setLetterDisplay(t.subarray(2),"GS display text",c);break}case 32:{w(e,le,Date.now()+3200),t[1]==0&&(w(e,z,Math.max(Math.min(t[2]-1,9),0)),O()&&console.debug(`GS switch display page ${t[2]-1}.`));break}default:if(t[0]<6){a(e,z)>9&&w(e,z,0);let c=t[0]-1<<1|t[1]>>6;a(e,z)==c&&w(e,le,Date.now()+3200),(i=a(e,pe)[c])!=null&&i.length||(a(e,pe)[c]=new Uint8Array(256));let n=a(e,pe)[c];O()&&console.debug(`GS frame draw page ${c}.`);let s=t[1]&63;n.fill(0),t.subarray(2).forEach(function(l,o){let d=o+s,$=Math.floor(d/16),m=d%16,T=(m*4+$)*5,B=5,Ce=0;for(T-=m*4,$==3&&(B=1);Ce<B;)n[T+Ce]=l>>4-Ce&1,Ce++})}else console.warn(`Unknown GS display section: ${t[0]}`)}});let v=function(t,i,c){let n=t[0],s=g.cc*i,f=g.rpn*i,l=`GS CH${i+1} `;n<3?(t.subarray(1).forEach((o,d)=>{[()=>{a(e,u)[s+p[0]]=o},()=>{a(e,U)[i]=o},()=>{let $=0;o<16?$=e.chRedir(o,c,!0):$=g.ch,a(e,X)[i]=$,i!=$&&(e.buildRchTree(),console.info(`${l}receives from CH${$+1}`))}][n+d]()}),e.dispatchEvent("voice",{part:i})):n<19||(n<44?t.subarray(1).forEach((o,d)=>{([()=>{a(e,W)[i]=+!o},!1,()=>{e.setChType(i,o<<1,C.gs),console.debug(`${l}type: ${o?"drum ":"melodic"}${o||""}`)},()=>{a(e,M)[f+3]=o,a(e,L)[g.rpnt*i+2]=1},!1,()=>{a(e,u)[s+p[7]]=o},!1,!1,()=>{a(e,u)[s+p[10]]=o||128},!1,!1,()=>{console.debug(`${l}CC 1: cc${o}`)},()=>{console.debug(`${l}CC 2: cc${o}`)},()=>{a(e,u)[s+p[93]]=o},()=>{a(e,u)[s+p[91]]=o},!1,!1,()=>{a(e,M)[f+1]=o,a(e,L)[g.rpnt*i+1]=1},()=>{a(e,M)[f+2]=o,a(e,L)[g.rpnt*i+1]=1},()=>{a(e,u)[s+p[94]]=o}][n+d-19]||(()=>{}))()}):n<76||console.debug(`Unknown GS part address: ${n}`))},k=function(t,i){let c=t[0],n=`GS CH${i+1} `;c<2?t.subarray(1).forEach((s,f)=>{[()=>{a(e,u)[g.cc*i+p[32]]=s},()=>{}][c+f]()}):c<32?console.warn(`Unknown GS misc address: ${c}`):c<35?t.subarray(1).forEach((s,f)=>{[()=>{console.debug(`${n}EQ: o${["ff","n"][s]}`)},()=>{},()=>{console.debug(`${n}EFX: o${["ff","n"][s]}`),a(e,Xe)[i]=s,e.dispatchEvent("partefxtoggle",{part:i,active:s})}][c+f-32]()}):console.warn(`Unknown GS misc address: ${c}`)};a(this,ae).add([66,18,64,16],(t,i)=>{v(t,e.chRedir(9,i,!0),i)}).add([66,18,64,17],(t,i)=>{v(t,e.chRedir(0,i,!0),i)}).add([66,18,64,18],(t,i)=>{v(t,e.chRedir(1,i,!0),i)}).add([66,18,64,19],(t,i)=>{v(t,e.chRedir(2,i,!0),i)}).add([66,18,64,20],(t,i)=>{v(t,e.chRedir(3,i,!0),i)}).add([66,18,64,21],(t,i)=>{v(t,e.chRedir(4,i,!0),i)}).add([66,18,64,22],(t,i)=>{v(t,e.chRedir(5,i,!0),i)}).add([66,18,64,23],(t,i)=>{v(t,e.chRedir(6,i,!0),i)}).add([66,18,64,24],(t,i)=>{v(t,e.chRedir(7,i,!0),i)}).add([66,18,64,25],(t,i)=>{v(t,e.chRedir(8,i,!0),i)}).add([66,18,64,26],(t,i)=>{v(t,e.chRedir(10,i,!0),i)}).add([66,18,64,27],(t,i)=>{v(t,e.chRedir(11,i,!0),i)}).add([66,18,64,28],(t,i)=>{v(t,e.chRedir(12,i,!0),i)}).add([66,18,64,29],(t,i)=>{v(t,e.chRedir(13,i,!0),i)}).add([66,18,64,30],(t,i)=>{v(t,e.chRedir(14,i,!0),i)}).add([66,18,64,31],(t,i)=>{v(t,e.chRedir(15,i,!0),i)}).add([66,18,64,64],(t,i)=>{k(t,e.chRedir(9,i,!0))}).add([66,18,64,65],(t,i)=>{k(t,e.chRedir(0,i,!0))}).add([66,18,64,66],(t,i)=>{k(t,e.chRedir(1,i,!0))}).add([66,18,64,67],(t,i)=>{k(t,e.chRedir(2,i,!0))}).add([66,18,64,68],(t,i)=>{k(t,e.chRedir(3,i,!0))}).add([66,18,64,69],(t,i)=>{k(t,e.chRedir(4,i,!0))}).add([66,18,64,70],(t,i)=>{k(t,e.chRedir(5,i,!0))}).add([66,18,64,71],(t,i)=>{k(t,e.chRedir(6,i,!0))}).add([66,18,64,72],(t,i)=>{k(t,e.chRedir(7,i,!0))}).add([66,18,64,73],(t,i)=>{k(t,e.chRedir(8,i,!0))}).add([66,18,64,74],(t,i)=>{k(t,e.chRedir(10,i,!0))}).add([66,18,64,75],(t,i)=>{k(t,e.chRedir(11,i,!0))}).add([66,18,64,76],(t,i)=>{k(t,e.chRedir(12,i,!0))}).add([66,18,64,77],(t,i)=>{k(t,e.chRedir(13,i,!0))}).add([66,18,64,78],(t,i)=>{k(t,e.chRedir(14,i,!0))}).add([66,18,64,79],(t,i)=>{k(t,e.chRedir(15,i,!0))}),a(this,$e).add([54,65],(t,i)=>{e.switchMode("x5d");let c=t[t.length-1],n=t.subarray(0,t.length-1),s=Me(n);s!=c&&(console.info(`X5D multi parameters checksum mismatch! Expected ${s}, got ${c}.`),console.debug(t));let f=(t[1]<<7)+t[0],l=(t[3]<<7)+t[2],o=e.chRedir(f&15,i,!0),d=g.cc*o;[()=>{l<1||(l<101?(e.setChType(o,e.CH_MELODIC,C.x5d),a(e,U)[o]=l-1,a(e,u)[d+p[0]]=a(e,H).x5):l<229?(e.setChType(o,e.CH_MELODIC,C.x5d),a(e,U)[o]=l-101,a(e,u)[d+p[0]]=56):(e.setChType(o,e.CH_DRUMS,C.x5d),a(e,U)[o]=Bt[l-229]||0,a(e,u)[d+p[0]]=62)),e.dispatchEvent("voice",{part:o})},()=>{a(e,u)[d+p[7]]=l},()=>{l<31&&(a(e,u)[d+p[10]]=Math.round((l-15)*4.2+64))},()=>{a(e,u)[d+p[93]]=We(l)},()=>{a(e,u)[d+p[91]]=We(l)},()=>{a(e,M)[o*g.rpn+3]=l>8191?l-16320:64+l,a(e,L)[g.rpnt*o+2]=1},()=>{a(e,M)[o*g.rpn+1]=l>8191?l-16320:64+l,a(e,L)[g.rpnt*o+1]=1},()=>{l>0&&(a(e,M)[o*g.rpn]=l,a(e,L)[g.rpnt*o]=1)},()=>{}][f>>4]()}).add([54,76,0],(t,i)=>{e.switchMode(a(e,H).x5=="81"?"05rw":"x5d",!0);let c="",n=a(e,H).x5,s=0,f=0,l="MSB\tPRG\tLSB\tNME";ce(t,function(o,d){if(d<16400){let $=d%164;switch(!0){case $<10:{o>31&&(c+=String.fromCharCode(o));break}case $==10:break;case $==11:{l+=`
${n}	${s}	${f}	${c.trim().replace("Init Voice","")}`,s++,c="";break}}s>99&&(n=90,s=0)}}),e.userBank.clearRange({msb:a(e,H).x5,prg:[0,99],lsb:0}),e.userBank.load(l),O()&&console.debug(l),e.forceVoiceRefresh()}).add([54,77,0],(t,i)=>{e.switchMode(a(e,H).x5=="81"?"05rw":"x5d",!0);let c="",n=90,s=0,f=0,l="MSB\tPRG\tLSB\tNME";ce(t,function(o,d){if(d<13600){let $=d%136;switch(!0){case $<10:{o>31&&(c+=String.fromCharCode(o));break}case $==11:{l+=`
${n}	${s}	${f}	${c.trim().replace("Init Combi","")}`,s++,c="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(l),O()&&console.debug(l),e.forceVoiceRefresh()}).add([54,78],(t,i)=>{e.switchMode(a(e,H).x5=="81"?"05rw":"x5d",!0),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][t[0]]} mode.`)}).add([54,85],(t,i)=>{e.switchMode(a(e,H).x5=="81"?"05rw":"x5d",!0),ce(t,(c,n)=>{n>0&&n<3&&(e.setEffectType(n-1,44,c),e.dispatchEvent(`efx${["reverb","chorus"][n-1]}`,e.getEffectType(n-1)))})}).add([54,104],(t,i)=>{e.switchMode(a(e,H).x5=="81"?"05rw":"x5d",!0),ce(t,function(c,n,s,f){if(n<192){let l=e.chRedir(Math.floor(n/12),i,!0),o=l*g.cc;switch(n%12){case 0:{c<128?(e.setChType(l,e.CH_MELODIC,C.x5d),a(e,u)[o+p[0]]=a(e,H).x5,a(e,U)[l]=c):(e.setChType(l,e.CH_DRUMS,C.x5d),a(e,u)[o+p[0]]=62,a(e,U)[l]=Bt[c-128]),c>0&&e.setChActive(l,1),e.dispatchEvent("voice",{part:l});break}case 1:{a(e,u)[o+p[7]]=c;break}case 2:{a(e,M)[l*g.rpn+3]=c>127?c-192:64+c,a(e,L)[g.rpnt*l+2]=1;break}case 3:{a(e,M)[l*g.rpn+1]=c>127?c-192:64+c,a(e,L)[g.rpnt*l+1]=1;break}case 4:{c<31&&(a(e,u)[o+p[10]]=Math.round((c-15)*4.2+64));break}case 5:{let d=c>>4,$=c&15;a(e,u)[o+p[91]]=We($),a(e,u)[o+p[93]]=We(d);break}case 10:break;case 11:{let d=e.chRedir(c&15,i,!0),$=c>>4;a(e,X)[l]=c,(d!=l||$)&&(console.info(`X5D Part CH${l+1} receives from CH${d+1}.`),e.buildRchTree())}}}else{let l=e.chRedir(n-192,i,!0)}})}),a(this,ae).add([22,18,127],t=>{e.switchMode("mt32",!0),w(e,N,!1),e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(t,i,c)=>{e.switchMode("mt32");let n=e.chRedir(c,i,!0),s=t[1];t.subarray(2).forEach((f,l)=>{let o=l+s;a(e,me)[o+(n-1)*16]=f,([!1,()=>{let d=a(e,me)[n-1<<4];if(d<3){if(a(e,he)[n]=1,d==2)for(let $=0;$<name.length;$++)a(e,ie)[(n-1)*g.cmt+$]=a(e,ve)[f*g.cmt+$];else{let $=e.baseBank.get(0,f+(d<<6),127,"mt32").name;for(let m=0;m<$.length;m++)a(e,ie)[(n-1)*g.cmt+m]=$.charCodeAt(m)}e.dispatchEvent("voice",{part:n})}},()=>{a(e,M)[n*g.rpn+3]=f+40,a(e,L)[g.rpnt*n+2]=1},()=>{a(e,M)[n*g.rpn+1]=f+14,a(e,L)[g.rpnt*n+1]=1},()=>{a(e,M)[n*g.rpn]=f,a(e,L)[g.rpnt*n]=1},!1,()=>{a(e,u)[g.cc*n+p[91]]=f?127:0},!1,()=>{a(e,u)[g.cc*n+p[7]]=f},()=>{a(e,u)[g.cc*n+p[10]]=Math.ceil(f*9.05)}][o]||(()=>{}))()})}).add([22,18,1],(t,i,c)=>{e.switchMode("mt32");let n=c&7;console.debug(`MT-32 slot #${c+1} Drum: ${t}`);let s=t[0]<<7|t[1];t.subarray(2).forEach((f,l)=>{let o=l+s,d=(o>>2)+24,$=o&3,m=n*g.dpn;if(O()&&console.debug(`MT-32 temp drum note ${d} param ${$}: ${f}`),d<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${d}`);return}[()=>{},()=>{a(e,Q)[(m+se[26])*g.dnc+d]=Math.round(f*1.27)},()=>{a(e,Q)[(m+se[26])*g.dnc+d]=f*9+1&127},()=>{a(e,Q)[(m+se[26])*g.dnc+d]=f?127:0}][$]()})}).add([22,18,2],(t,i,c)=>{e.switchMode("mt32");let n=e.chRedir(c,i,!0),s=t[1]+(t[0]<<7);s<10&&(a(e,he)[n]=1),t.subarray(2).forEach((f,l)=>{let o=l+s;o<14&&(a(e,ie)[(n-1)*g.cmt+o]=f)}),e.dispatchEvent("voice",{part:n})}).add([22,18,3],(t,i,c)=>{e.switchMode("mt32");let n=c&7;if(t[0]){let s=(t[0]-1<<7)+t[1]-16;t.subarray(2).forEach((f,l)=>{let o=l+s,d=(o>>2)+24,$=o&3,m=n*g.dpn;if(O()&&console.debug(`MT-32 dev drum note ${d} param ${$}: ${f}`),d<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${d}`);return}[()=>{},()=>{a(e,Q)[(m+se[26])*g.dnc+d]=Math.round(f*1.27)},()=>{a(e,Q)[(m+se[26])*g.dnc+d]=f*9+1&127},()=>{a(e,Q)[(m+se[26])*g.dnc+d]=f?127:0}][$]()})}else{let s=t[1];t.subarray(2).forEach((f,l)=>{let o=l+s;a(e,me)[o]=f;let d=e.chRedir(1+(o>>4),i,!0),$=o&15;([!1,()=>{let m=a(e,me)[d-1<<4];if(m<3)if(a(e,he)[d]=1,m==2)for(let T=0;T<name.length;T++)a(e,ie)[(d-1)*g.cmt+T]=a(e,ve)[f*g.cmt+T];else{let T=e.baseBank.get(0,f+(m<<6),127,"mt32").name;for(let B=0;B<T.length;B++)a(e,ie)[(d-1)*g.cmt+B]=T.charCodeAt(B)}e.dispatchEvent("voice",{part:d})},()=>{a(e,M)[d*g.rpn+3]=f+40,a(e,L)[g.rpnt*d+2]=1},()=>{a(e,M)[d*g.rpn+1]=f+14,a(e,L)[g.rpnt*d+1]=1},()=>{a(e,M)[d*g.rpn]=f,a(e,L)[g.rpnt*d]=1},!1,()=>{a(e,u)[g.cc*d+p[91]]=f?127:0},!1,()=>{a(e,u)[g.cc*d+p[7]]=f},()=>{a(e,u)[g.cc*d+p[10]]=Math.ceil(f*9.05)}][$]||(()=>{}))()})}}).add([22,18,4],(t,i,c)=>{e.switchMode("mt32");let n=t[1]+(t[0]<<7),s=[];t.subarray(2).forEach((f,l)=>{let o=l+n,d=e.chRedir(Math.floor(o/246+1),i,!0),$=o%246;$<14&&(a(e,ie)[(d-1)*g.cmt+$]=f),$<10&&(a(e,he)[d]=1),s.indexOf(d)<0&&s.push(d)}),s.forEach(f=>{e.dispatchEvent("voice",{part:f})})}).add([22,18,5],(t,i,c)=>{e.switchMode("mt32");let n=(t[0]<<7)+t[1];t.subarray(2).forEach((s,f)=>{let l=n+f,o=Math.floor(l/8),d=l&7,$=o*8;a(e,Ve)[l]=s,([!1,()=>{let m=a(e,Ve)[$];if(m<3){let T="";if(m==2){let Ce=g.cmt*o;T=`MT-m:${s.toString().padStart(3,"0")}`}else T=e.baseBank.get(0,s+(m<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:o});let B=`MSB	LSB	PRG	NME
000	127	${o}	${T}`;e.userBank.load(B,!0)}}][d]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(t,i,c)=>{e.switchMode("mt32");let n=((t[0]&1)<<7)+t[1];t.subarray(2).forEach((s,f)=>{let l=n+f;l<g.cmt&&(a(e,ve)[(t[0]>>1)*g.cmt+l]=s)}),e.forceVoiceRefresh()}).add([22,18,16],(t,i,c)=>{e.switchMode("mt32");let n=t[1],s=!1,f=function(l,o){a(e,X)[o-12]=l,s=!0};t.subarray(2).forEach((l,o)=>{let d=o+n;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,f,f,f,f,f,f,f,f,f,()=>{w(e,P,l),e.dispatchEvent("mastervolume",a(e,P))}][d]||(()=>{}))(l,o)}),s&&e.buildRchTree()}).add([22,18,32],t=>{e.switchMode("mt32");let i=t[1],c=" ".repeat(i);t.subarray(2).forEach(n=>{n>31?c+=String.fromCharCode(n):c+=" "}),w(e,ke,c.padStart(20," ")),w(e,Se,Date.now()+3200)}).add([22,18,82],(t,i)=>{let c=e.chRedir(0,i,!0);for(let n=0;n<16;n++)a(e,I).ano(c+n),n&&n<10&&(a(e,U)[c+n]=ft[n-1]);console.info("MT-32 alt reset complete.")}),a(this,$e).add([66,0],(t,i)=>{e.switchMode("ns5r",!0),w(e,N,!1),console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][t[0]]} mode.`)}).add([66,1],(t,i)=>{e.switchMode(["ns5r","05rw"][t[0]],!0),w(e,N,!1)}).add([66,18,0,0],(t,i)=>{let c=t[0];switch(c){case 124:case 126:case 127:{e.switchMode("ns5r",!0),w(e,N,!1);break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset: ${t}`);break}default:if(c<10){let n=[0,0,0,0],s=(f,l)=>{n[l]=f};if(t.subarray(1).forEach((f,l)=>{[s,s,s,s,()=>{w(e,P,f*129/16383*100),e.dispatchEvent("mastervolume",a(e,P))},()=>f-64,()=>f-64,()=>{},()=>{},()=>{}][c+l]()}),t[0]<4){let f=0;n.forEach(l=>{f=f<<4,f+=l}),f-=1024}}}}).add([66,18,0,1],(t,i)=>{}).add([66,18,0,2],(t,i)=>{}).add([66,18,1],(t,i)=>{let c=e.chRedir(t[0],i,!0),n=c*g.cc,s=t[1],f=`NS5R CH${c+1} `;t.subarray(2).forEach((l,o)=>{let d=s+o;d<3?([()=>{a(e,u)[n+p[0]]=l||Je.bank0},()=>{a(e,u)[n+p[32]]=l},()=>{a(e,U)[c]=l}][d](),e.dispatchEvent("voice",{part:c})):d<8||(d<14?[()=>{let $=e.chRedir(l,i,!0);a(e,X)[c]=$,c!=$&&(e.buildRchTree(),console.info(`${f}receives from CH${$+1}`))},()=>{a(e,W)[c]=+!l},()=>{e.setChType(c,l,C.ns5r),console.debug(`${f}type: ${Ye[l]}`)},()=>{a(e,M)[g.rpn*c+3]=l,a(e,L)[g.rpnt*c+2]=1},()=>{},()=>{}][d-8]():d<16||(d<33?[()=>{a(e,u)[n+p[7]]=l},()=>{a(e,u)[n+p[11]]=l},()=>{},()=>{},()=>{a(e,u)[n+p[10]]=l||128},()=>{},()=>{},()=>{a(e,u)[n+p[93]]=l},()=>{a(e,u)[n+p[91]]=l},()=>{a(e,u)[n+p[76]]=l},()=>{a(e,u)[n+p[77]]=l},()=>{a(e,u)[n+p[78]]=l},()=>{a(e,u)[n+p[74]]=l},()=>{a(e,u)[n+p[71]]=l},()=>{a(e,u)[n+p[73]]=l},()=>{a(e,u)[n+p[75]]=l},()=>{a(e,u)[n+p[72]]=l}][d-16]():d<112||d<114&&[()=>{a(e,u)[n+p[5]]=l},()=>{a(e,u)[n+p[65]]=l}][d-112]()))})}).add([66,18,8,0],(t,i)=>{let c=t[0];if(c<32)e.setLetterDisplay(t.subarray(1,33),"NS5R letter display");else{let n=c-32;w(e,le,Date.now()+3200),w(e,z,10),a(e,j,ue).fill(0);let s=t.subarray(1),f=4;s.forEach(function(l,o){let d=o+n,$=d>>4,m=d&15;if(d<80){let T=$<f?l:l>>3,B=0,Ce=$<f?6:3;for(;T>0;)a(e,j,ue)[m*32+$*7+(Ce-B)]=T&1,T=T>>1,B++}})}}).add([66,18,48],(t,i,c)=>{y(0,t)}).add([66,18,49],(t,i,c)=>{y(1,t)}).add([66,18,50],(t,i,c)=>{y(2,t)}).add([66,18,51],(t,i,c)=>{y(3,t)}).add([66,18,52],(t,i,c)=>{y(4,t)}).add([66,18,53],(t,i,c)=>{y(5,t)}).add([66,18,54],(t,i,c)=>{y(6,t)}).add([66,18,55],(t,i,c)=>{y(7,t)}).add([66,52],(t,i)=>{e.switchMode("ns5r",!0),w(e,N,!1);let c="";ce(t,(n,s)=>{s<8?(n>31&&(c+=String.fromCharCode(n)),s==7&&(e.aiEfxName=c)):s<10&&(e.setEffectType(s-8,44,n),e.dispatchEvent(`efx${["reverb","chorus"][s-8]}`,e.getEffectType(s-8)))})}).add([66,53],(t,i)=>{e.switchMode("ns5r",!0),w(e,N,!1);let c="",n=t[t.length-1],s=t.subarray(0,t.length-1),f=Me(s);f!=n&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${f}, got ${n}.`),console.debug(t)),ce(s,function(l,o){switch(!0){case o<2944:{let d=e.chRedir(Math.floor(o/92),i,!0),$=d*g.cc;switch(o%92){case 0:{a(e,u)[$+p[0]]=l,e.dispatchEvent("voice",{part:d});break}case 1:{a(e,u)[$+p[32]]=l,!l&&!a(e,u)[$+p[0]]&&(a(e,u)[$+p[0]]=Je.bank0),e.dispatchEvent("voice",{part:d});break}case 2:{a(e,U)[d]=l,l>0&&e.setChActive(d,1),e.dispatchEvent("voice",{part:d});break}case 3:{let m=e.chRedir(l,i,!0);a(e,X)[d]=m,d!=m&&(console.info(`NS5R CH${d+1} receives from CH${m+1}.`),e.buildRchTree());break}case 7:{a(e,D)[d]=l,e.dispatchEvent("voice",{part:d});break}case 8:{a(e,M)[d*g.rpn+3]=l<40||l>88?l+(l>63?-192:64):l,a(e,L)[g.rpnt*d+2]=1;break}case 9:case 10:{a(e,u)[$+p[7]]=l;break}case 11:{a(e,u)[$+p[11]]=l;break}case 14:{a(e,u)[$+p[10]]=l||128;break}case 19:{a(e,u)[$+p[93]]=l;break}case 20:{a(e,u)[$+p[91]]=l;break}case 84:{a(e,u)[$+p[65]]=l;break}case 85:{a(e,u)[$+p[5]]=l;break}}break}case o<3096:break;case o<3134:{let d=o-3096;d<8?(l>31&&(c+=String.fromCharCode(l)),d==7&&(e.aiEfxName=c)):d<10&&(e.setEffectType(d-8,44,l),e.dispatchEvent(`efx${["reverb","chorus"][d-8]}`,e.getEffectType(d-8)));break}case o<8566:break}})}).add([66,54],(t,i)=>{e.switchMode("ns5r",!0);let c="",n=80,s=0,f=0,l="MSB\tPRG\tLSB\tNME";ce(t,function(o,d){let $=d%158;switch(!0){case $<10:{o>31&&(c+=String.fromCharCode(o));break}case $==10:break;case $==11:{n=o&127;break}case $==12:{f=o&127;break}case $==13:{l+=`
${n}	${s}	${f}	${c.trim().replace("Init Voice","")}`,s++,c="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(l),O()&&console.debug(l),e.forceVoiceRefresh()}).add([66,55],(t,i)=>{e.switchMode("ns5r",!0);let c="",n=88,s=0,f=0,l="MSB\tPRG\tLSB\tNME";ce(t,function(o,d){let $=d%126;switch(!0){case $<10:{o>31&&(c+=String.fromCharCode(o));break}case $==11:break;case $==12:break;case $==13:{l+=`
${n}	${s}	${f}	${c.trim().replace("Init Combi","")}`,s++,c="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(l),O()&&console.debug(l),e.forceVoiceRefresh()}).add([66,125],t=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][t[0]]||"white")}).add([66,127],t=>{let i=t[t.length-1],c=t.subarray(0,t.length-1),n=Me(c);n!=i&&(console.info(`NS5R screen dump checksum mismatch! Expected ${n}, got ${i}.`),console.debug(t));let s=new Uint8Array(5760);ce(t,(f,l,o)=>{if(l<720)for(let d=0;d<8;d++)s[l*8+d]=f>>7-d&1}),e.dispatchEvent("screen",{type:"ns5r",data:s})}).add([76],(t,i,c)=>{a(e,$e).run([66,...t],i,c)}),a(this,Ne).add([16,0,8,0],(t,i,c)=>{let n=(t[2]<<4)+t[3],s="K11 ";([()=>{e.switchMode("k11",!0),w(e,N,!1),w(e,ee,n?4:0),console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,n),console.debug(`${s}reverb type: ${n}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{console.debug(`${s}reverb time: ${n}`)},()=>{console.debug(`${s}reverb time: ${n}`)},()=>{console.debug(`${s}reverb predelay: ${n}`)},()=>{console.debug(`${s}reverb predelay: ${n}`)},()=>{console.debug(`${s}depth high: ${n}`)},()=>{console.debug(`${s}depth high: ${n}`)},()=>{console.debug(`${s}depth low: ${n}`)},()=>{console.debug(`${s}depth low: ${n}`)}][t[0]]||(()=>{}))()}).add([16,0,8,1],(t,i,c)=>{let n=e.chRedir(t[1],i,!0),s=g.cc*n,f=g.rpn*n,l=(t[3]<<4)+t[4],o=`K11 CH${n+1} `;([()=>{l<128?(e.setChType(n,e.CH_MELODIC,C.k11),a(e,u)[s+p[0]]=0,a(e,U)[n]=l):(e.setChType(n,e.CH_DRUMS,C.k11),a(e,U)[n]=l-128),e.dispatchEvent("voice",{part:n})},()=>{let d=e.chRedir(l,i,!0);a(e,X)[n]=d,n!=d&&(e.buildRchTree(),console.info(`${o}receives from CH${d+1}`))},()=>{a(e,u)[s+p[7]]=l},()=>{uupThis.setChActive(n,l)},()=>{a(e,u)[s+p[10]]=l},()=>{a(e,M)[f+3]=l+40,a(e,L)[g.rpnt*n+2]=1},()=>{a(e,M)[f+1]=l>>1,a(e,M)[f+2]=l&1,a(e,L)[g.rpnt*n+1]=1},()=>{a(e,u)[s+p[91]]=l?127:0},()=>{},()=>{a(e,u)[s+p[74]]=l},()=>{a(e,u)[s+p[73]]=l},()=>{a(e,u)[s+p[72]]=l}][t[0]]||(()=>{}))()}).add([16,0,9,0],(t,i,c)=>{let n=(t[2]<<4)+t[3],s="GMLX ";([()=>{console.debug(`${s}reverb type: ${n}`)},()=>{console.debug(`${s}reverb time: ${n}`)},()=>{console.debug(`${s}reverb predelay: ${n}`)},()=>{console.debug(`${s}depth high: ${n}`)},()=>{console.debug(`${s}depth low: ${n}`)}][t[0]]||(()=>{}))()}).add([16,0,9,3],(t,i,c)=>{let n=(t[2]<<4)+t[3],s=e.chRedir(t[1],i,!0),f=s*g.cc;[()=>{n<128?(e.setChType(s,e.CH_MELODIC,C.k11),a(e,u)[f+p[0]]=0,a(e,u)[f+p[32]]=0,a(e,U)[s]=n):n<160?(e.setChType(s,e.CH_MELODIC,C.k11),a(e,u)[f+p[0]]=0,a(e,u)[f+p[32]]=7,a(e,U)[s]=n-100):(e.setChType(s,e.CH_DRUMS,C.k11),a(e,u)[f+p[0]]=122,a(e,u)[f+p[32]]=0,a(e,U)[s]=n-160),e.dispatchEvent("voice",{part:s})},()=>{let l=e.chRedir(n,i,!0);a(e,X)[s]=l,s!=l&&(e.buildRchTree(),console.info(`GMLX CH${s+1} receives from CH${l+1}`))}][t[0]]()}).add([16,0,9,4],(t,i,c)=>{let n=(t[2]<<4)+t[3],s=e.chRedir(t[1],i,!0),f=s*g.cc,l=s*g.rpn,o=`GMLX CH${s+1} `;[()=>{e.setChActive(s,n)},()=>{a(e,u)[f+p[7]]=n},()=>{a(e,u)[f+p[10]]=n},()=>{a(e,u)[f+p[91]]=n?127:0},()=>{a(e,M)[l+3]=n+40,a(e,L)[g.rpnt*s+2]=1},()=>{a(e,M)[l+1]=n,a(e,L)[g.rpnt*s+1]=1},()=>{a(e,M)[l]=n,a(e,L)[g.rpnt*s]=1},()=>{}][t[0]]()}),a(this,Be).add([66,93,64],(t,i,c)=>{let n=t[2];switch(t[0]){case 0:{switch(t[1]){case 4:{w(e,P,n*129/16383*100),e.dispatchEvent("mastervolume",a(e,P));break}case 5:{n-64;break}case 6:{console.debug(`SG global reverb: ${n?"on":"off"}`);break}case 127:{e.switchMode("sg",!0);break}}break}case 1:{switch(t[1]){case 48:{console.debug(`SG reverb type: ${lt[n]}`);break}}break}default:if(t[0]>>4==1){let s=e.chRedir(t[0]&15,i,!0);if(t[1]==2){let f=e.chRedir(n,i,!0);a(e,X)[s]=f,s!=f&&(e.buildRchTree(),console.info(`SG CH${s+1} receives from CH${f+1}`))}else t[1]==19&&(a(e,u)[g.cc*s+p[7]]=n)}else console.warn(`Unknown AKAI SG SysEx: ${t}`)}}),a(this,He).add([9],(t,i,c)=>{console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremelo","phaser","rotary speaker","enhancer","flanger","EQ"][t[0]]||"off"}`)}),a(this,te).add([127,0],(t,i,c)=>{e.switchMode("motif");let n=new Uint8Array([127,1,...t]);a(e,te).run(n,i,c)}).add([127,1,0,0],(t,i,c)=>{e.switchMode("s90es");let n="S90/Motif ES system ",s=t[0];t.subarray(1).forEach((f,l)=>{([()=>{w(e,P,f*12900/16383),e.dispatchEvent("mastervolume",a(e,P))}][s+l]||(()=>{console.info(`Unrecognized ${n}ID: ${s+l}`)}))()})}).add([127,1,0,0,14],(t,i,c)=>{e.switchMode("s90es");let n="S90/Motif ES bulk header ",s=[];s[95]=(f,l,o)=>{console.debug(`${n}multi edit buffer: ${f[1]}`)},(s[t[0]]||(()=>{console.info(`Unrecognized ${n}ID: ${t[0]}.`)}))(t.subarray(1))}).add([127,1,0,0,15],(t,i,c)=>{e.switchMode("s90es");let n="S90/Motif ES bulk footer ",s=[];s[95]=(f,l,o)=>{console.debug(`${n}multi edit buffer: ${f[1]}`)},(s[t[0]]||(()=>{console.info(`Unrecognized ${n}ID: ${t[0]}.`)}))(t.subarray(1))}).add([127,1,0,58,55],(t,i,c)=>{e.switchMode("s90es");let n=e.chRedir(t[0],i,!0),s=g.cc*n,f=t[1],l=`S90/Motif ES bulk CH${n<16?n+1:"U"+(n-95)} `;console.debug(l,t),!(t[0]>15)&&t.subarray(2).forEach((o,d)=>{([()=>{a(e,u)[s+p[0]]=o,e.dispatchEvent("voice",{part:n})},()=>{o&&e.setChActive(n,1),a(e,u)[s+p[32]]=o,e.setChType(n,[32,40].indexOf(o)>-1?e.CH_DRUMS:e.CH_MELODIC,a(e,A),!0),e.dispatchEvent("voice",{part:n})},()=>{o&&e.setChActive(n,1),a(e,U)[n]=o,e.dispatchEvent("voice",{part:n})},()=>{let $=e.chRedir(o,i,!0);a(e,X)[n]=$,n!=$&&(e.buildRchTree(),console.info(`${l}receives from CH${$+1}`))},()=>{a(e,W)[n]=o?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{a(e,u)[s+p[7]]=o},()=>{a(e,u)[s+p[10]]=o},!1,!1,!1,()=>{a(e,u)[s+p[91]]=o},()=>{a(e,u)[s+p[93]]=o},()=>{a(e,u)[s+p[94]]=o},()=>{a(e,u)[s+p[128]]=o},()=>{},()=>{a(e,u)[s+p[74]]=o},()=>{a(e,u)[s+p[71]]=o},!1,()=>{a(e,u)[s+p[65]]=o},()=>{a(e,u)[s+p[5]]=o},()=>{}][f+d]||(()=>{}))()})}).add([127,1,54,16],(t,i,c)=>{e.switchMode("s90es");let n=t[0];t.subarray(1).forEach((s,f)=>{let o=`S90/Motif ES EQ${(f>>2)+1} `;([()=>{let d=s-64},()=>{let d=Ge[s]},()=>{let d=s/10},()=>{let d=s}][n+f&3]||(()=>{}))()})}),a(this,ae).add([0,72,18,0,0,0,0],(t,i,c)=>{e.switchMode("sd",!0),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(t,i,c)=>{let n=t[0]>>5,s=t[0]&31;switch(n){case 0:{let f=t[0]>>1,l=t[1];switch(f){case 1:{t.subarray(2).forEach((o,d,$)=>{let m=d+l;switch(m){case 0:{o&&(e.setEffectType(1,60,o-1),e.dispatchEvent("efxchorus",e.getEffectType(1)),console.debug(`SD MFX Cho: ${m} - ${o}`));break}}});break}case 2:{t.subarray(2).forEach((o,d)=>{let $=d+l;switch($){case 0:{o&&(e.setEffectType(0,55+o,0),e.dispatchEvent("efxreverb",e.getEffectType(0)),console.debug(`SD MFX Rev: ${$} - ${o}`));break}}});break}case 3:case 4:case 5:{let o=f-1;t.subarray(2).forEach((d,$)=>{let m=$+l;switch(console.debug(`SD MFX ${o-2}: ${m} - ${d}`),m){case 0:{e.setEffectTypeRaw(o,62,d),e.dispatchEvent(`efx${o>2?"delay":"insert"+(o-4)}`,e.getEffectType(o));break}}}),console.debug(`SD MFX message:
%o`,t);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,t)}break}case 1:{let f=e.chRedir(s,i,!0),l=t[1],o=f*g.cc;t.subarray(2).forEach((d,$)=>{let m=l+$;m<37?([()=>{},()=>{},0,()=>{},()=>{switch(a(e,u)[o+p[0]]=d,d){case 104:case 105:case 106:case 107:case 120:{a(e,D)[f]||e.setChType(f,e.CH_DRUMS);break}default:a(e,D)[f]&&e.setChType(f,e.CH_MELODIC)}e.dispatchEvent("voice",{part:f})},()=>{a(e,u)[o+p[32]]=d,e.dispatchEvent("voice",{part:f})},()=>{a(e,U)[f]=d,e.dispatchEvent("voice",{part:f})},()=>{a(e,u)[o+p[7]]=d},()=>{a(e,u)[o+p[10]]=d},()=>{},()=>{},()=>{d<2&&(a(e,W)[f]=d)},()=>{d<2&&(a(e,u)[o+p[68]]=d?127:0)},()=>{},()=>{d<2&&(a(e,u)[o+p[65]]=d?127:0)},()=>{a(e,u)[o+p[5]]=d&15<<4|a(e,u)[o+p[5]]&15},()=>{a(e,u)[o+p[5]]=d&15|(a(e,u)[o+p[5]]&240)>>4},()=>{a(e,u)[o+p[74]]=d},()=>{a(e,u)[o+p[71]]=d},()=>{a(e,u)[o+p[73]]=d},()=>{a(e,u)[o+p[72]]=d},0,0,0,0,0,0,0,()=>{a(e,u)[o+p[128]]=d},()=>{a(e,u)[o+p[93]]=d},()=>{a(e,u)[o+p[91]]=d},0,0,()=>{a(e,u)[o+p[75]]=d},()=>{a(e,u)[o+p[76]]=d},()=>{a(e,u)[o+p[77]]=d},()=>{a(e,u)[o+p[78]]=d}][m]||(()=>{}))():m<63||(m<64?(a(e,D)[f]?a(e,u)[o+p[0]]=104|d:a(e,u)[o+p[0]]=96|d,e.dispatchEvent("voice",{part:f})):console.debug(`Unknown SD-90 global CH${f+1} param setup message:
%o`,t))});break}case 2:{let f=e.chRedir(s,i,!0),l=t[1];console.debug(`Unknown SD-90 global CH${f+1} MIDI setup message:
%o`,t.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,t)}})}chRedir(e,r,h){if(a(this,xe)[r])return(a(this,xe)[r]-1)*16+e;if([2,3].indexOf(a(this,ee))>-1){if(h==1)return e;let b=0,y=!0;for(;y;)a(this,Ee)[e+b]==0?(a(this,Ee)[e+b]=r,console.debug(`Assign track ${r} to channel ${e+b+1}.`),y=!1):a(this,Ee)[e+b]==r?y=!1:(b+=16,b>=128&&(b=0,y=!1));return e+b}else return e}forceVoiceRefresh(){for(let e=0;e<g.ch;e++)a(this,be)[e]&&this.dispatchEvent("voice",{part:e})}buildRchTree(){let e=[];a(this,X).forEach((r,h)=>{var b;r<g.ch&&((b=e[r])!=null&&b.constructor||(e[r]=[]),e[r].push(h))}),w(this,et,e)}buildRccMap(){let e=this;for(let r=0;r<g.ch;r++)a(e,Le)[r]={};a(e,De).forEach((r,h)=>{r&&(a(e,Le)[Math.floor(h/g.redir)][r]=h%g.redir|128)}),O()&&console.debug(a(e,Le))}getActive(){return a(this,be)}getCc(e){let r=e*g.cc,h=a(this,u).subarray(r,r+g.cc);return h[p[0]]=h[p[0]]||a(this,we),h[p[32]]=h[p[32]]||a(this,ee),h[p[0]]==Je.bank0&&(h[p[0]]=0),h}getCcCh(e,r){if(Ze.indexOf(r)<0)throw new Error("CC number not accepted");return a(this,u)[g.cc*e+p[r]]}getCcAll(){let e=a(this,u).slice();for(let r=0;r<g.ch;r++){let h=r*g.cc;e[h+p[0]]=e[h+p[0]]||a(this,we),e[h+p[32]]=e[h+p[32]]||a(this,ee),e[p[0]]==Je.bank0&&(e[p[0]]=0)}return e}getChSource(){return a(this,X)}getChType(){return a(this,D)}setChType(e,r,h=a(this,A),b=!1){r&=15,a(this,D)[e]=r,r>0&&!b&&(a(this,u)[e*g.cc+p[0]]=Te[h])}setChActive(e,r=0){a(this,be)[e]!=r&&this.dispatchEvent("channeltoggle",{part:e,active:r}),a(this,be)[e]=r}getExt(e){let r=g.ext*e,h=a(this,fe).subarray(r,r+g.ext),b=new Uint8Array(h.length);return b.set(h),b[1]=b[1]||a(this,rt),b}getPitch(){return a(this,ge)}getProgram(){return a(this,U)}getTexts(){return a(this,Z).slice()}getVel(e){let r=new Map,h=this;return a(h,_).forEach(function(b,y){let S=Math.floor(b/128),v=b%128;e==S&&a(h,G)[b]>0&&r.set(v,{v:a(h,G)[b],s:a(h,V)[y]})}),r}getBitmap(){return{bitmap:a(this,j,ue),expire:a(this,le)}}getLetter(){return{text:a(this,ke),set:a(this,je),expire:a(this,Se)}}getMode(){return oe[a(this,A)]}getMaster(){return{volume:a(this,P)}}getRawStrength(){let e=this;return a(this,_).forEach(function(r){let h=Math.floor(r/128);a(e,G)[r]>a(e,de)[h]&&(a(e,de)[h]=a(e,G)[r])}),a(this,de)}getStrength(){let e=[],r=this;return this.getRawStrength().forEach(function(h,b){e[b]=Math.floor(h*a(r,u)[b*g.cc+p[7]]*a(r,u)[b*g.cc+p[11]]*a(r,P)/803288)}),e}getRpn(){return a(this,M)}getNrpn(){return a(this,_e)}getVoice(e,r,h,b){let y=e||a(this,we),S=r,v=h||a(this,ee);y==Je.bank0&&(y=0),oe[a(this,A)]=="ns5r"&&y>0&&y<56&&(v=3);let k=this.userBank.get(y,S,v,b);if(oe[a(this,A)]=="mt32"&&k.name.indexOf("MT-m:")==0){let t=parseInt(k.name.slice(5)),i=t*g.cmt,c="";a(this,ve).subarray(i,i+10).forEach(s=>{s>31&&(c+=String.fromCharCode(s))});let n=`MSB	LSB	PRG	NME
0	127	${S}	${c}`;this.userBank.load(n,!0),k.name=c,k.ending=" "}return(k.ending!=" "||!k.name.length)&&(k=this.baseBank.get(y,S,v,b)),k}getChVoice(e){let r=this.getVoice(a(this,u)[e*g.cc+p[0]],a(this,U)[e],a(this,u)[e*g.cc+p[32]],oe[a(this,A)]);if(a(this,he)[e])switch(a(this,A)){case C.mt32:r.ending="~",r.name="",a(this,ie).subarray(14*(e-1),14*(e-1)+10).forEach(h=>{r.name+=String.fromCharCode(Math.max(h,32))}),r.name=r.name.trimRight()}return r}getRawPitch(){return a(this,ge)}getPitchShift(e){let r=this,h=e*g.rpn,b=a(r,M)[h];return a(r,L)[e*g.rpnt]||a(r,A)==C.mt32&&(b=12),a(r,ge)[e]/8192*b+(a(r,M)[h+3]-64)+((a(r,M)[h+1]<<7)+a(r,M)[h+2]-8192)/8192}getEffectType(e=0){let r=3*e+1;return a(this,J).subarray(r,r+2)}setEffectTypeRaw(e=0,r,h){let b=3*e;a(this,J)[b]=1,a(this,J)[b+1+ +r]=h}setEffectType(e=0,r,h){this.setEffectTypeRaw(e,!1,r),this.setEffectTypeRaw(e,!0,h)}getEffectSink(){return a(this,Xe)}setLetterDisplay(e,r,h=0,b=3200){let y=this,S;w(y,ke," ".repeat(h)),e.forEach(v=>{w(y,ke,a(y,ke)+String.fromCharCode(v>31?v:32)),v<32&&(S=S||new Set,S.add(v))}),w(y,je,Date.now()),w(y,Se,Date.now()+b),S&&(S=Array.from(S),S.forEach((v,k,t)=>{t[k]=v.toString(16).padStart(2,"0")}),console.warn(`${r}${r?" ":""}invalid code point${S.length>1?"s":""}: 0x${S.join(", 0x")}`))}setDetectionTargets(e="?",r=0){let h=this,b=-1;switch(e.replaceAll(", ",",").split(",").forEach(y=>{y=y.toLowerCase();let S=oe.indexOf(Qt[y]||y);O()&&console.debug(`Mapped mode "${y}" to ID "${S}".`),S>-1&&(b=S)}),O()&&console.debug(`Set detection target to ID "${b}".`),b>0&&(a(h,H).x5=82,a(h,H).ds=C.krs),b){case C["05rw"]:{a(h,H).x5=81;break}case C.s90es:a(h,H).ds=C.s90es;case C.motif:a(h,H).ds=C.motif}}allocateAce(e){if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}let r=!0,h=0;for(;r&&h<g.ace;)a(this,ye)[h]==e?r=!1:a(this,ye)[h]||(r=!1,a(this,ye)[h]=e,console.info(`Allocated cc${e} to ACE slot ${h}.`)),h++;h>=g.ace&&console.warn("ACE slots are full.")}getAce(){return a(this,ye)}getChAce(e,r){if(r<0||r>=g.ace)throw new RangeError("No such ACE slot");let h=a(this,ye)[r];if(h){if(Ze.indexOf(h)>=0)return a(this,u)[e*g.cc+p[h]];throw new Error(`Invalid ACE source: ${h}`)}else return 0}initDrums(){let e=this;a(e,Q).fill(64);for(let r=0;r<g.drm;r++){let h=r*g.dpn;for(let b in Nt){let y=Nt[b],S=(h+se[b])*g.dnc;a(e,Q).subarray(S,S+g.dnc).fill(y)}}}init(e=0){let r=this;w(r,we,0),w(r,ee,0),w(r,Oe,0),a(r,be).fill(0),a(r,u).fill(0),a(r,ye).fill(0),a(r,U).fill(0),a(r,G).fill(0),a(r,_).fill(0),a(r,W).fill(0),a(r,de).fill(0),a(r,ge).fill(0),a(r,_e).fill(0),a(r,L).fill(0),a(r,fe).fill(0),a(r,De).fill(0),w(r,P,100),w(r,Z,[]),w(r,Fe,500),w(r,Ke,0),w(r,le,0),w(r,z,0),a(r,j,ue).fill(0),w(r,N,!1),w(r,ze,0),w(r,ne,!0),r.initDrums(),a(r,X).forEach(function(h,b,y){y[b]=b}),e==0&&(r.dispatchEvent("mode","?"),w(r,A,0),a(r,Ee).fill(0),a(r,xe).fill(0),w(r,Se,0),w(r,ke,"")),a(r,u)[g.cc*9]=Te[0],a(r,u)[g.cc*25]=Te[0],a(r,u)[g.cc*41]=Te[0],a(r,u)[g.cc*57]=Te[0],a(r,D).fill(r.CH_MELODIC),a(r,D)[9]=r.CH_DRUM1,a(r,D)[25]=r.CH_DRUM3,a(r,D)[41]=r.CH_DRUMS,a(r,D)[57]=r.CH_DRUMS,a(r,D)[73]=r.CH_DRUM5,a(r,D)[89]=r.CH_DRUM7,a(r,D)[105]=r.CH_DRUMS,a(r,D)[121]=r.CH_DRUMS,a(r,Ve).fill(0),a(r,ve).fill(0),a(r,me).fill(0),a(r,ie).fill(0),a(r,he).fill(0),a(r,J).fill(0),a(r,Xe).fill(0),r.aiEfxName="",r.userBank.clearRange({msb:0,lsb:127,prg:[0,127]});for(let h=0;h<g.ch;h++){let b=h*g.cc;a(r,u)[b+p[7]]=100,a(r,u)[b+p[11]]=127,a(r,u)[b+p[2]]=127,a(r,u)[b+p[10]]=64,a(r,u).subarray(b+p[71],b+p[71]+8).fill(64),a(r,u).subarray(b+p[130],b+p[130]+28).fill(64),a(r,u)[b+p[91]]=40,a(r,u)[b+p[101]]=127,a(r,u)[b+p[100]]=127,a(r,u)[b+p[99]]=127,a(r,u)[b+p[98]]=127;let y=h*g.rpn;a(r,M)[y]=2,a(r,M)[y+1]=64,a(r,M)[y+2]=0,a(r,M)[y+3]=64,a(r,M)[y+4]=0,a(r,M)[y+5]=0;let S=h*g.ext;a(r,fe)[S+1]=r.VLBC_BRTHEXPR;let v=h*g.redir;a(r,De)[v+8]=13}r.buildRchTree(),r.buildRccMap(),r.dispatchEvent("mastervolume",a(r,P)),r.dispatchEvent("efxreverb",r.getEffectType(0)),r.dispatchEvent("efxchorus",r.getEffectType(1)),r.dispatchEvent("efxdelay",r.getEffectType(2)),r.dispatchEvent("efxinsert0",r.getEffectType(3)),r.dispatchEvent("efxinsert1",r.getEffectType(4)),r.dispatchEvent("efxinsert2",r.getEffectType(5)),r.dispatchEvent("efxinsert3",r.getEffectType(6)),r.dispatchEvent("reset"),r.switchMode("?")}switchMode(e,r=!1,h=!1){var S;let b=this,y=oe.indexOf(e);if(y>-1){if(a(b,A)==0||r){let v=a(b,A);b.initOnReset&&r&&(this.init(1),v=C["?"]),w(b,A,y),w(b,z,0),w(b,we,Dt[0][y]),w(b,ee,Dt[1][y]);for(let t=0;t<g.ch;t++)a(b,D)[t]>0&&a(b,u)[t*g.cc+p[0]]==Te[v]&&(a(b,u)[t*g.cc]=Te[y]);switch(y){case C.mt32:{ft.forEach((t,i)=>{let c=i+1;a(b,be)[c]||(a(b,U)[c]=t,a(b,u)[c*g.cc+p[91]]=127)});for(let t=1;t<10;t++)b.dispatchEvent("voice",{part:t});break}}let k;switch(y){case C["?"]:case C.g2:{k=[52,4,52,18,0,0,0,0];break}case C.xg:{k=[1,0,65,0,5,0,0,0];break}case C.gm:case C.gs:{k=[40,4,40,18,40,32,32,0];break}case C.sd:{k=[58,0,60,0,61,0,61,0];break}case C["05rw"]:case C.x5d:case C.ns5r:{k=[44,1,44,19,44,0,44,0];break}case C.k11:case C.sg:{k=[24,0,0,0,0,0,0,0];break}case C.mt32:{k=[40,4,0,0,0,0,0,0];break}default:k=[0,0,0,0,0,0,0,0]}for(let t=0;t<g.efx;t++)!a(b,J)[3*t]&&(S=k[t<<1])!=null&&S.constructor&&(a(b,J)[3*t+1]=k[2*t],a(b,J)[3*t+2]=k[2*t+1],b.dispatchEvent(`efx${["reverb","chorus","delay","insert0"][t]}`,b.getEffectType(t)));h&&b.setDetectionTargets(e),b.dispatchEvent("mode",e),b.forceVoiceRefresh()}}else throw new Error(`Unknown mode ${e}`)}newStrength(){a(this,de).fill(0)}runJson(e){var r;if(e.type>14)return e.type==15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),a(this,tt)[e.type].call(this,e);{let h=this.chRedir(e.part,e.track),b=!1;(r=a(this,et)[h])==null||r.forEach(y=>{e.channel=y,b=!0,a(this,tt)[e.type].call(this,e)}),b||console.warn(`${Ot[e.type]?Ot[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${h+1} without any recipient.`)}a(this,Z).length>100&&a(this,Z).splice(100,a(this,Z).length-99)}runRaw(e){}async loadBank(e,r){let h=this;switch(e=e.toLowerCase(),e){case"s7e":{h.userBank.clearRange({msb:63,lsb:[21,22]}),h.userBank.clearRange({msb:63,lsb:[24,27]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":{at.context=this,h.userBank.load(await at.read(e,r));break}}h.forceVoiceRefresh()}},A=new WeakMap,z=new WeakMap,le=new WeakMap,pe=new WeakMap,j=new WeakSet,ue=function(){return a(this,pe)[a(this,z)]},It=function(e){a(this,pe)[a(this,z)]=e},be=new WeakMap,X=new WeakMap,D=new WeakMap,u=new WeakMap,ye=new WeakMap,U=new WeakMap,G=new WeakMap,W=new WeakMap,_=new WeakMap,V=new WeakMap,ge=new WeakMap,de=new WeakMap,Re=new WeakMap,fe=new WeakMap,M=new WeakMap,L=new WeakMap,_e=new WeakMap,Q=new WeakMap,J=new WeakMap,Xe=new WeakMap,De=new WeakMap,he=new WeakMap,me=new WeakMap,ie=new WeakMap,Ve=new WeakMap,ve=new WeakMap,we=new WeakMap,ee=new WeakMap,H=new WeakMap,P=new WeakMap,Oe=new WeakMap,Fe=new WeakMap,Ke=new WeakMap,ke=new WeakMap,Se=new WeakMap,je=new WeakMap,ze=new WeakMap,ne=new WeakMap,N=new WeakMap,rt=new WeakMap,et=new WeakMap,Le=new WeakMap,ht=new WeakMap,Z=new WeakMap,Ee=new WeakMap,xe=new WeakMap,F=new WeakMap,Ae=new WeakMap,I=new WeakMap,tt=new WeakMap,st=new WeakMap,Ue=new WeakMap,Pe=new WeakMap,te=new WeakMap,ae=new WeakMap,$e=new WeakMap,Ne=new WeakMap,Be=new WeakMap,He=new WeakMap,Ht);export{Ia as OctaviaDevice,g as allocated,p as ccToPos,se as dnToPos};