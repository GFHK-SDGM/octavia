var Ca=Object.create;var Mt=Object.defineProperty;var ma=Object.getOwnPropertyDescriptor;var ka=Object.getOwnPropertyNames;var va=Object.getPrototypeOf,wa=Object.prototype.hasOwnProperty;var $a=(b,e,r)=>e in b?Mt(b,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):b[e]=r;var Xt=(b,e)=>()=>(b&&(e=b(b=0)),e);var Sa=(b,e)=>()=>(e||b((e={exports:{}}).exports,e),e.exports);var xa=(b,e,r,l)=>{if(e&&typeof e=="object"||typeof e=="function")for(let h of ka(e))!wa.call(b,h)&&h!==r&&Mt(b,h,{get:()=>e[h],enumerable:!(l=ma(e,h))||l.enumerable});return b};var Ta=(b,e,r)=>(r=b!=null?Ca(va(b)):{},xa(e||!b||!b.__esModule?Mt(r,"default",{value:b,enumerable:!0}):r,b));var A=(b,e,r)=>($a(b,typeof e!="symbol"?e+"":e,r),r),Kt=(b,e,r)=>{if(!e.has(b))throw TypeError("Cannot "+r)};var a=(b,e,r)=>(Kt(b,e,"read from private field"),r?r.call(b):e.get(b)),T=(b,e,r)=>{if(e.has(b))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(b):e.set(b,r)},x=(b,e,r,l)=>(Kt(b,e,"write to private field"),l?l.call(b,r):e.set(b,r),r);var Ft=Xt(()=>{"use strict";F();(function(){var b=function(m,$,S){var M,t;if(self.MessageEvent)switch(m){case"message":{t=new MessageEvent(m,{data:$,ports:S==null?void 0:S.ports}),Object.defineProperty(t,"source",{value:S==null?void 0:S.source});break}default:t=new Event(m)}else t=document.createEvent("Event"),t.initEvent(m,!1,!1),S&&m=="message"&&(t.data=$,S.source&&Object.defineProperty(t,"source",{value:S.source}),(M=S.ports)!=null&&M.length&&Object.defineProperty(t,"ports",{value:S.ports}));return t};self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),r=[],l={},h=function(m){var $,S=this;if((this==null?void 0:this.constructor)!=h)throw new TypeError("Illegal constructor");r.push(this),($=l[m])!=null&&$.constructor||(l[m]=[]),l[m].push(this);var M=Math.floor(Math.random()*281474976710656),t=[],s=0,d=[],i=!0,o=!1;Object.defineProperty(this,"id",{get:function(){return M}}),Object.defineProperty(this,"name",{value:m}),this.close=function(){var n,u=r.indexOf(S);u>-1?(e.postMessage({t:"d",c:m,i:M}),r.splice(u,1),(n=l[m])!=null&&n.constructor&&(u=l[m].indexOf(S),u>-1&&l[m].splice(u,1)),l[m].length||delete l[m],console.debug("[Snowy] BroadcastChannel closed."),o=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(n){if(e){if(o)throw new Error("Channel already closed");e.postMessage({t:"m",c:m,i:M,m:s,d:n}),s++,s>4294967295&&(s=0)}else d.push(n),console.debug("[Snowy] Message is cached.")},this.flush=function(){if(e){if(i){for(e.postMessage({t:"r",c:m,i:M}),console.debug("[Snowy] ".concat(d.length," message(s) in cache."));d.length;){var n=d.shift();S.postMessage(n)}i=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(n){n.c==m?n.i!=M&&S.dispatchEvent(b("message",n.d,{source:S})):console.debug("[Snowy] Channel ID mismatch. Instance ".concat(M," receives from ").concat(m,", not ").concat(n.c,"."))};var c={};this.dispatchEvent=function(n){var u,f;if(Object.defineProperty(n,"target",{value:S}),Object.defineProperty(n,"currentTarget",{value:S}),(u=c[n.type])!=null&&u.length)for(var y=c[n.type],C=0;C<y.length;C++)((f=y[C])==null?void 0:f.constructor)==Function&&y[C].call(S,n);S["on".concat(n.type)]&&S["on".concat(n.type)].constructor==Function&&S["on".concat(n.type)].call(S,n)},this.addEventListener=function(n,u){var f;(f=c[n])!=null&&f.constructor||(c[n]=[]);var y=c[n].indexOf(u);y==-1&&c[n].push(u)},this.removeEventListener=function(n,u){var f,y;if((f=c[n])!=null&&f.length){var C=c[n].indexOf(u);C>-1&&c[n].splice(C,1)}!((y=c[n])!=null&&y.length)&&c[n].constructor&&delete c[n]}},self.BroadcastChannel=h,p=function(){if(e){e.addEventListener("message",function($){var S=$.data,M=!1;switch(S.t){case"k":{M=!1,e.postMessage({t:"k"});break}case"m":{var t=l[S.c];if(t!=null&&t.length)for(var s=0;s<t.length;s++)t[s].receiveMessage(S);break}case"c":{for(var d=[],i=0;i<r.length;i++){var o=r[i].name;d.indexOf(o)<0&&d.push(o)}e.postMessage({t:"k",c:d});break}default:M=!0}M&&console.info("ReceiveBroadcast",S)});for(var m=0;m<r.length;m++)r[m].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},E=function(){if(!e){var m=new SharedWorker(self.SNOWY_PATH||"/snowy.js");m.port.start();var $=function(S){S.data.t=="swc"&&(m.port.removeEventListener("message",$),e=m.port,e.postMessage({t:"k"}),p())};m.port.addEventListener("message",$)}},E());var e,r,l,h,p,E})()});var F=Xt(()=>{"use strict";Ft();{let b=function(e,r){let l=new FileReader;return new Promise((h,p)=>{switch(l.addEventListener("abort",()=>{p(new Error("Blob read aborted"))}),l.addEventListener("error",E=>{p(l.error||E.data||new Error("Blob read error"))}),l.addEventListener("load",()=>{h(l.result)}),r.toLowerCase()){case"arraybuffer":case"buffer":{l.readAsArrayBuffer(e);break}case"string":case"text":{l.readAsText(e);break}default:p(new Error(`Unknown target ${r}`))}})};Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||function(){return b(this,"buffer")},Blob.prototype.text=Blob.prototype.text||function(){return b(this,"text")}}String.prototype.replaceAll=String.prototype.replaceAll||function(b,e){let r=0,l=16,h=this,p=[];for(;r<l&&h.lastIndexOf(b)>-1;){let E=h.lastIndexOf(b);p.unshift(h.slice(E+b.length)),h=h.slice(0,E),E==0&&p.unshift(""),r++}return h.length&&p.unshift(h),p.join(e)||""},String.prototype.padStart=String.prototype.padStart||function(b,e){if(e){let r=this;for(;r.length<b;)r=`${e}${r}`;return r}},String.prototype.padEnd=String.prototype.padEnd||function(b,e){if(e){let r=this;for(;r.length<b;)r+=e;return r}}});var da=Sa((wr,Lt)=>{F();(function(){"use strict";let b={fatal:!0},e=[new TextDecoder("iso-8859-15",b),new TextDecoder("utf-8",b),new TextDecoder("sjis",b),new TextDecoder("euc-jp",b),new TextDecoder("ascii")],r={debug:!1,parse:function(l,h){if(l instanceof Uint8Array)return r.Uint8(l);if(typeof l=="string")return r.Base64(l);if(l instanceof HTMLElement&&l.type==="file")return r.addListener(l,h);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(l,h){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(l===void 0||!(l instanceof HTMLElement)||l.tagName!=="INPUT"||l.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;h=h||function(){},l.addEventListener("change",function(p){if(!p.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let E=new FileReader;E.readAsArrayBuffer(p.target.files[0]),E.onload=function(m){h(r.Uint8(new Uint8Array(m.target.result)))}})},Base64:function(l){let h=function(m){var $="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(m=m.replace(/^.*?base64,/,""),m=String(m).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(m))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");m+="==".slice(2-(3&m.length));let S,M="",t,s,d=0;for(;d<m.length;)S=$.indexOf(m.charAt(d++))<<18|$.indexOf(m.charAt(d++))<<12|(t=$.indexOf(m.charAt(d++)))<<6|(s=$.indexOf(m.charAt(d++))),M+=t===64?String.fromCharCode(S>>16&255):s===64?String.fromCharCode(S>>16&255,S>>8&255):String.fromCharCode(S>>16&255,S>>8&255,255&S);return M}(l=String(l));var p=h.length;let E=new Uint8Array(new ArrayBuffer(p));for(let m=0;m<p;m++)E[m]=h.charCodeAt(m);return r.Uint8(E)},Uint8:function(E){let h={data:null,pointer:0,movePointer:function(t){return this.pointer+=t,this.pointer},readInt:function(t){if((t=Math.min(t,this.data.byteLength-this.pointer))<1)return-1;let s=0;if(1<t)for(let d=1;d<=t-1;d++)s+=this.data.getUint8(this.pointer)*Math.pow(256,t-d),this.pointer++;return s+=this.data.getUint8(this.pointer),this.pointer++,s},readStr:function(t){let s=new Uint8Array(t),d=!1,i;s.forEach((o,c)=>{s[c]=this.readInt(1)});for(let o=0;o<e.length;o++)if(!d)try{if(i=e[o].decode(s),o===0)for(let c=0;c<i.length;c++){let n=i.charCodeAt(c);if(n>191||n>127&&n<160)throw new RangeError(`Invalid code point: ${n}`)}d=!0,console.debug(`String byte sequence in ${e[o].encoding}`)}catch(c){console.debug(`SMF string ${c}`)}return i||"String byte sequence read failed."},backOne:function(){this.pointer--},readIntVLV:function(){let t=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)t=this.readInt(1);else{let d=[];for(;128<=this.data.getUint8(this.pointer);)d.push(this.readInt(1)-128);var s=this.readInt(1);for(let i=1;i<=d.length;i++)t+=d[d.length-i]*Math.pow(128,i);t+=s}return t}};if(h.data=new DataView(E.buffer,E.byteOffset,E.byteLength),h.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;h.readInt(4);let p={};p.formatType=h.readInt(2),p.tracks=h.readInt(2),p.track=[];var E=h.readInt(1),m=h.readInt(1);128<=E?(p.timeDivision=[],p.timeDivision[0]=E-128,p.timeDivision[1]=m):p.timeDivision=256*E+m;for(let t=1;t<=p.tracks;t++){p.track[t-1]={event:[]};var $,S=h.readInt(4);if(S===-1)break;if(S!==1297379947)return!1;h.readInt(4);let s=0,d=!1,i,o;for(;!d&&(s++,p.track[t-1].event[s-1]={},p.track[t-1].event[s-1].deltaTime=h.readIntVLV(),(i=h.readInt(1))!==-1);)if(128<=i?o=i:(i=o,h.movePointer(-1)),i===255){p.track[t-1].event[s-1].type=255,p.track[t-1].event[s-1].metaType=h.readInt(1);var M=h.readIntVLV();switch(p.track[t-1].event[s-1].metaType){case 47:case-1:d=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:p.track[t-1].event[s-1].data=h.readStr(M);break;case 33:case 89:case 81:p.track[t-1].event[s-1].data=h.readInt(M);break;case 84:p.track[t-1].event[s-1].data=[],p.track[t-1].event[s-1].data[0]=h.readInt(1),p.track[t-1].event[s-1].data[1]=h.readInt(1),p.track[t-1].event[s-1].data[2]=h.readInt(1),p.track[t-1].event[s-1].data[3]=h.readInt(1),p.track[t-1].event[s-1].data[4]=h.readInt(1);break;case 88:p.track[t-1].event[s-1].data=[],p.track[t-1].event[s-1].data[0]=h.readInt(1),p.track[t-1].event[s-1].data[1]=h.readInt(1),p.track[t-1].event[s-1].data[2]=h.readInt(1),p.track[t-1].event[s-1].data[3]=h.readInt(1);break;default:this.customInterpreter!==null&&(p.track[t-1].event[s-1].data=this.customInterpreter(p.track[t-1].event[s-1].metaType,h,M)),this.customInterpreter!==null&&p.track[t-1].event[s-1].data!==!1||(h.readInt(M),p.track[t-1].event[s-1].data=h.readInt(M),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch((i=i.toString(16).split(""))[1]||i.unshift("0"),p.track[t-1].event[s-1].type=parseInt(i[0],16),p.track[t-1].event[s-1].channel=parseInt(i[1],16),p.track[t-1].event[s-1].type){case 15:this.customInterpreter!==null&&(p.track[t-1].event[s-1].data=this.customInterpreter(p.track[t-1].event[s-1].type,h,!1)),this.customInterpreter!==null&&p.track[t-1].event[s-1].data!==!1||($=h.readIntVLV(),p.track[t-1].event[s-1].data=h.readInt($),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:p.track[t-1].event[s-1].data=[],p.track[t-1].event[s-1].data[0]=h.readInt(1),p.track[t-1].event[s-1].data[1]=h.readInt(1);break;case 12:case 13:p.track[t-1].event[s-1].data=h.readInt(1);break;case-1:d=!0;break;default:if(this.customInterpreter!==null&&(p.track[t-1].event[s-1].data=this.customInterpreter(p.track[t-1].event[s-1].metaType,h,!1)),this.customInterpreter===null||p.track[t-1].event[s-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return p},customInterpreter:null};if(typeof Lt<"u")Lt.exports=r;else{let l=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;l.MidiParser=r}})()});F();F();var Vt=function(b,e){let r=Math.min(b.length,e.length),l=b.slice(0,r),h=e.slice(0,r),p=0,E=0;for(;E<r&&p==0;)p=Math.sign(l[E]-h[E]),E++;return p},be=function(b=""){this.name=b,this.pool=[],this.point=function(e,r=!1){if(this.pool.length>0){let l=this.pool.length,h=1<<Math.floor(Math.log2(l)),p=h,E=64;for(;h>=1&&E>=0;){if(E<=0)throw new Error("TTL reached.");if(p==l)p-=h;else{let $=Vt(e,this.pool[p]);switch($){case 0:{E=0;break}case 1:{p+h<=l&&(p+=h);break}case-1:{p!=0&&(p-=h);break}default:console.warn(`Unexpected result ${$}.`)}}h=h>>1,E--}let m=!0;if(p>=this.pool.length)m=!1;else{let $=this;this.pool[p].forEach(function(S,M,t){m&&S!=e[M]&&(m=!1)}),!m&&Vt(e,this.pool[p])>0&&p++}return m||r?p:-1}else return r?0:-1},this.add=function(e,r){return e.data=r,this.pool.splice(this.point(e,!0),0,e),this},this.default=function(e){console.warn(`No match in "${this.name||"(unknown)"}" for "${e}". Default action not defined.`)},this.get=function(e){let r=this.point(e);if(r>-1)return this.pool[r].data;this.default(e)},this.run=function(e,...r){let l=this.point(e);l>-1?e.subarray?this.pool[l].data(e.subarray(this.pool[l].length),...r):this.pool[l].data(e.slice(this.pool[l].length),...r):this.default(e,...r)}};F();var oe,Yt,zt=(Yt=class{constructor(){T(this,oe,{})}addEventListener(b,e){a(this,oe)[b]||(a(this,oe)[b]=[]),a(this,oe)[b].unshift(e)}removeEventListener(b,e){if(a(this,oe)[b]){let r=a(this,oe)[b].indexOf(e);r>-1&&a(this,oe)[b].splice(r,1),a(this,oe)[b].length<1&&delete a(this,oe)[b]}}dispatchEvent(b,e){var h;let r=new Event(b),l=this;r.data=e,((h=a(this,oe)[b])==null?void 0:h.length)>0&&a(this,oe)[b].forEach(function(p){try{p==null||p.call(l,r)}catch(E){console.error(E)}}),this[`on${b}`]&&this[`on${b}`](r)}},oe=new WeakMap,Yt);F();var Ma=["MSB","PRG","LSB","NME","ELC","DRM","LVL","VXP"],Pa={krs:"KR",s90es:"ES",motif:"ES"},Ra={krs:"Kr",s90es:"SE",motif:"ME"},Pt=function(b){let e=Math.floor(b/10),r=b%10;return`${e.toString(16)}${r}`},ae,Wt,Rt=(Wt=class{constructor(...b){T(this,ae,void 0);A(this,"strictMode",!1);this.loadFiles(...b)}get bankInfo(){return a(this,ae)}get(b=0,e=0,r=0,l,h=0){var C,P,I;let p=[b,e,r],E,m=1,$=0,S,M,t,s=Array.from(arguments);switch(l){case"xg":{switch(b){case 0:{r===126?s[2]=125:r===127&&(s[2]=0);break}case 16:{r===126&&(s[2]=0);break}case 32:{r>125&&(s[2]=0),s[2]+=4;break}case 33:{(r>125||r===3)&&(s[2]=0),s[2]+=5;break}case 34:case 35:case 36:{r>125&&(s[2]=0),s[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:s[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{r===126&&(s[2]=0);break}case 48:case 64:case 126:case 127:{r===126&&(b===127&&e===0||(s[2]=0));break}case 121:{switch(r){case 126:{s[2]=0;break}case 16:{s[2]=15;break}default:s[2]=s[2]&15}break}}break}case"gs":case"sc":{b===0&&r<5?s[0]=49:b<128&&b>125&&r<5&&r!==2&&(s[2]=b,s[0]=49);break}case"mt32":{b===0&&(s[0]=49);break}case"sd":{switch(b){case 121:{s[0]=96;break}case 120:{s[0]=104;break}}s[0]>>1===40?s[2]|=16:s[0]>95&&s[0]<100&&(s[2]|=16,e>>4===7&&(s[0]=96));break}case"pa":{switch(b){case 120:{r==64?s[2]=2:s[2]=1;break}case 121:{switch(r){case 127:{s[2]=79;break}default:s[2]=(s[2]&63)+32}break}}break}case"g2":{b>>1===40?s[2]|=16:b>95&&b<100&&(s[2]|=16,e>>4===7&&(s[0]=96));break}case"sg":{b===8&&r===0&&(s[2]=5);break}case"05rw":case"x5d":{b&&b<56&&(s[0]=56);break}case"s90es":case"motif":case"an1x":case"cs1x":case"cs6x":{if(b===0)break;switch(b){case 63:{switch(l){case"s90es":{r<8?s[2]+=17:r<32?s[2]+=13:s[2]=(s[2]>>3)+19;break}case"motif":{r<8?s[2]+=28:r<32?s[2]+=13:s[2]=(s[2]>>3)+19;break}case"cs1x":{switch(r>>1){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:{s[2]+=34;break}case 32:{s[2]=34+((r&1)<<2);break}case 33:{s[2]=47+((r&1)<<2);break}case 61:{s[2]=34+((r&1)<<2);break}case 62:{s[2]=47+((r&1)<<2);break}}break}}break}case 32:{r>125&&(s[2]=0),s[2]+=4;break}case 33:{(r>125||r===3)&&(s[2]=0),s[2]+=5;break}case 34:case 35:case 36:{r>125&&(s[2]=0),s[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:s[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{r===126&&(s[2]=0);break}}break}}let d=" ",i="M",o="",c=0,n=0;switch(s[0]){case 0:{switch(s[2]){case 127:{i="GM-a";break}case 126:{i="GM-n";break}case 7:{i="GM-k",o="GLX";break}case 5:{i="SG-a",o="000";break}case 4:{l==="gs"||l==="sc"?(i="GM-a",o="000"):(i="SP-l",o="C/M");break}case 3:case 2:case 1:{(l==="gs"||l==="sc")&&(i="GM-a",o="000");break}case 0:{i="GM-a";break}default:i="y",c=3}break}case 8:{l==="sg"?i="GM-s":i="r:";break}case 32:case 33:case 34:case 35:case 36:{l==="xg"&&(i=`${["AP","VL","PF","DX","AN"][b&7]}-${"abcdefgh"[r]}`,c=3);break}case 48:{o=`M${(s[2]>>3).toString().padStart(2,"0")}`,i=`y${o}`,c=1;break}case 49:{s[2]>>1===63?(i=`MT-${"ba"[s[2]&1]}`,o=`C${"-/"[s[2]&1]}M`):(i="GM-a",o="000");break}case 56:{i="GM-b";break}case 57:i=["yDOC","QY10","QY20"][s[2]-112]||"yMxv",o=["DOC","QY1","QY2"][s[2]-112]||"057";case 61:case 128:{i="rDrm";break}case 120:{i="gDrm";break}case 62:{i="kDrm";break}case 63:{if(s[2]<17){let R=s[2];i=R<10?"kP:":"kC:",i+=R%10}else if(s[2]<34)i=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][s[2]-17];else if(s[2]<55){let R=s[2]-34;switch(R>12&&R--,r>>1){case 32:case 33:{i=`Pr${r-63}U`;break}case 61:case 62:{i=`Pr${r-121}U`;break}default:i=s[2]===46?"PrDr":`Pr${(R>>2)+1}${String.fromCharCode(65+(R&3))}`}}else i="Ds";c=1;break}case 64:{i="ySFX",o="SFX";break}case 67:{i="DX:S";break}case 80:case 81:case 82:case 83:{i=`Prg${"UABC"[s[0]-80]}`;break}case 88:case 89:case 90:case 91:{i=`Cmb${"UABC"[s[0]-88]}`;break}case 95:{i=`${["DR","PC"][s[2]]}-d`;break}case 96:{i=s[2]===106?"AP-a":s[2]>>4===1?"SDg":"PF",s[2]>63?n=63:s[2]>>4===1&&(n=16),c=3;break}case 97:{i=s[2]>>4===1?"SDa":"VL:",c=3,s[2]>>4===1?n=16:n=112;break}case 98:{i=s[2]>>4===1?"SDb":"SG-a",c=3,n=16;break}case 99:{i=s[2]>>4===1?"SDc":"DX",s[2]>63?n=63:s[2]>>4===1&&(n=16),c=3;break}case 100:{i="AN",s[2]>63?n=63:s[2]>>4===1&&(n=16),c=3;break}case 104:case 105:case 106:case 107:{i="SDd",n=104;break}case 121:{i=`GM${s[2]?"":"-a"}`,c=1;break}case 122:{i="lDrm";break}case 126:{i="yDrS";break}case 127:{s[2]===127?i="rDrm":i="yDrm";break}default:s[0]<48?i="r:":i="M"}i.length<4&&(i+=`${[b,r,s[0],s[2]][c]-n}`.padStart(4-i.length,"0")),o.length<3&&(o+=`${[b,r,b,r][c]}`.padStart(3-o.length,"0")),l==="xg"&&(b===0?s[2]<100?i=i.replace("y0","y:"):s[2]===125&&(i="y126"):b===16?(E=`Voice${((s[2]<<7)+s[1]+1).toString().padStart(3,"0")}`,d=" "):b===35&&r>>1===2&&(E=`DXCH_${(((s[2]&1)<<7)+e+1).toString().padStart(3,"0")}`,d=" "));let u=[s[0],s[1],s[2]];for(;!((E==null?void 0:E.length)>=0);)if(E=(C=a(this,ae)[s[1]||0][(s[0]<<8)+s[2]])==null?void 0:C.name,E){let R=a(this,ae)[s[1]||0][(s[0]<<8)+s[2]];m=(R==null?void 0:R.poly)||m,$=(R==null?void 0:R.type)||$,S=R==null?void 0:R.drum,M=R==null?void 0:R.level,t=R==null?void 0:R.voice}else if(this.strictMode)E="",d="?";else if(s[0]===0&&s[1]===0&&s[2]===0)E="Unloaded";else if(a(this,ae)[s[1]||0][s[0]<<8])s[0]===0?(s[2]=0,d="^"):s[2]<1?(s[0]=0,d="*"):(s[2]--,d="^");else if(b===48)s[0]=0,s[2]=0,d="!";else if(b===62)s[1]--,d=" ",s[1]<1&&!(E!=null&&E.length)&&(s[0]=0,d="!");else if(b<63)s[0]===0?(s[2]=0,d="^"):s[2]<1?(s[0]=0,d="*"):s[2]--;else if(b===80)E=`PrgU:${e.toString().padStart(3,"0")}`,d="!";else if(b===88)E=`CmbU:${e.toString().padStart(3,"0")}`,d="!";else if(b===121)E=`GM2Vox0${r}`,d="#";else if(b===122){if(s[1]===32?s[1]:s[1]%=7,E=(P=a(this,ae)[s[1]||0][(s[0]<<8)+s[2]])==null?void 0:P.name,E){d=" ";let R=a(this,ae)[s[1]||0][(s[0]<<8)+s[2]];m=(R==null?void 0:R.poly)||m,$=(R==null?void 0:R.type)||$,S=R==null?void 0:R.drum,M=R==null?void 0:R.level}else E="",d="*";}else s[1]===0?(E=`${b.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")} ${r.toString().padStart(3,"0")}`,d="!"):s[0]===0?(s[2]=0,d="^"):s[2]>0?s[2]--:s[1]>0?(s[1]=0,d="!"):(s[0]=0,d="?");let f=[s[0],s[1],s[2]];switch(d){case"^":{switch(l){case"gs":case"sc":case"ns5r":{d=" ";break}case"xg":{r===126&&(d=" ");break}}b===127&&(d=" ");break}case"*":break;case"!":break;case"?":break}let y="??";switch(s[0]){case 0:{s[2]===0?y="GM":s[2]===5||s[2]===7?y="KG":s[2]<126&&(y="XG");break}case 32:case 33:case 35:case 36:{s[2]>4?y=["AP","VL","PF","DX","AN"][s[0]-32]:y="GS";break}case 48:{y="MU";break}case 49:{s[2]>>1===63?y="MT":s[2]<5&&(y="GM");break}case 56:{y="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{y="AI";break}case 62:case 82:case 90:{y="XD";break}case 63:{s[2]<17?y="KR":s[2]<34?y="ES":s[2]<55?y="CS":y="DS";break}case 64:case 126:{y="XG";break}case 67:case 99:{y=s[2]>>4===1?"SD":"DX";break}case 81:{y="RW";break}case 95:{y=["DR","PC"][s[2]];break}case 96:{y=s[2]===106?"AP":s[2]>>4===1?"SD":"PF";break}case 97:{y=s[2]>>4===1?"SD":"VL";break}case 98:{y=s[2]>>4===1?"SD":"SG";break}case 100:{y="AN";break}case 104:case 105:case 106:case 107:{y="SD";break}case 120:{y=e===0?"GM":(I=["G2","PA","PA"][s[2]])!=null?I:"G2";break}case 128:{y=e===0?"GM":"GS";break}case 121:{y=s[2]?["G2","XG","PA","PA","PA"][s[2]>>4]:"GM";break}case 122:{y="KG";break}case 127:{y=s[2]===127?"MT":e===0?"GM":"XG";break}default:s[0]<48&&(s[0]===16&&l==="xg"?y="XG":y="GS")}if(d!==" ")switch(l){case"krs":case"s90es":case"motif":{E="",y=Pa[l],d="?";break}case"g2":{E="GM2 Ext?",d="?";break}case"pa":{d==="^"&&(E="Unknown",d="?");break}default:self.debugMode&&(E="",d="?")}return{name:E||`${Ra[l]||l.toUpperCase()}${Pt(b||0)}${Pt(e||0)}${Pt(r||0)}`,poly:m,type:$,drum:S,level:M,voice:t,iid:u,eid:f,sid:p,ending:d,sect:i,bank:o,standard:y,mode:l}}async load(b,e,r="(internal)",l){let h=this,p=[],E=0,m=0,$=0;b.split(`
`).forEach(function(S,M){var d;let t=S.split("\t"),s=[];if(M===0){if(t.forEach(function(i,o){p[Ma.indexOf(i)]=o}),p.length<4){console.debug("Debugger launched.");debugger}}else{let i=0,o=0,c=0,n,u=1,f=0,y,C,P;t.forEach(function(q,Tt){switch(Tt){case p[0]:{i=parseInt(q);break}case p[1]:{o=parseInt(q);break}case p[2]:{c=parseInt(q);break}case p[3]:{n=q;break}case p[4]:{q=parseInt(q),q<16?u=q+1:(f=(q&15)+1,u=f);break}case p[5]:{C=q;break}case p[6]:{typeof q=="string"&&(y=parseInt(q));break}case p[7]:{P=q;break}}}),a(h,ae)[o]=a(h,ae)[o]||[];let I=a(h,ae)[o],R={msb:i,prg:o,lsb:c,name:n,poly:u,type:f,drum:C,level:y,voice:P,priority:l},Me=!1;l<((d=I[i<<8|c])==null?void 0:d.priority)&&(Me=!0,$++),(!I[i<<8|c]||Me||e)&&(I[i<<8|c]=R,E++),m++}}),e||console.debug(`Map: From "${r}", ${m} total, ${E} loaded (${E-$} + ${$}).`)}clearRange(b){let e=b.prg!==void 0?b.prg.constructor===Array?b.prg:[b.prg,b.prg]:[0,127],r=b.msb!==void 0?b.msb.constructor===Array?b.msb:[b.msb,b.msb]:[0,127],l=b.lsb!==void 0?b.lsb.constructor===Array?b.lsb:[b.lsb,b.lsb]:[0,127];for(let h=r[0];h<=r[1];h++){let p=h<<8;for(let E=l[0];E<=l[1];E++){let m=p+E;for(let $=e[0];$<=e[1];$++)delete a(this,ae)[$][m]}}}init(){x(this,ae,[]);for(let b=0;b<128;b++)a(this,ae).push([""])}async loadFiles(...b){this.init();let e=this;b.forEach(async function(r,l){try{e.load(await(await fetch(`./data/bank/${r}.tsv`)).text(),!1,r,l)}catch(h){console.error(`Failed loading "${r}.tsv".`)}})}},ae=new WeakMap,Wt);F();F();var Ze,qt,Qt=(qt=class{constructor(){T(this,Ze,{});A(this,"context")}set(b,e){a(this,Ze)[b]=e}has(b){return!!a(this,Ze)[b]}async read(b,e){if(!this.has(b))throw new Error(`No decoder registered for "${b}"`);return await a(this,Ze)[b].call(this.context||this,e)}},Ze=new WeakMap,qt);var Aa=function(b,e){let r=!0;return e.forEach((l,h)=>{r=r&&b[h]===l}),r},dt=function(b){let e=0;return b.forEach(r=>{e*=256,e+=r}),e},$e=new TextDecoder,ft=new Qt;ft.set("s7e",async function(b){let e=new Uint8Array(await b.slice(0,65536).arrayBuffer()),r="MSB\tLSB\tPRG\tNME",l=[0,0,0,0],h=32,p=0,E=0,m=!0,$=[],S=0;for(;m;){let M=e.subarray(p);([()=>{$e.decode(M.subarray(0,4))==="YSFC"?(p+=80,E=1):p++},()=>{if(Aa(M.subarray(0,4),l))$.forEach((t,s,d)=>{let i=dt(e.subarray(t.start+4,t.start+8));t.length=i}),E=2;else{let t=$e.decode(M.subarray(0,4)),s=dt(M.subarray(4,8));$.push({type:t,start:s}),p+=8}},()=>{let t=$[S],s=e.subarray(t.start,t.start+t.length),d=32;switch(t.type){case"ENVC":{let i=h;for(;i<s.length;){let o=s.subarray(i,i+d),c=$e.decode(o.subarray(0,10)).trimEnd();c.slice(0,5)==="Init "&&(c=""),c&&(r+=`
063	${(o[17]+13).toString().padStart(3,"0")}	${o[19].toString().padStart(3,"0")}	${c}`),i+=d}break}case"EDVC":{let i=h;for(;i<s.length;){let o=s.subarray(i,i+d),c=$e.decode(o.subarray(0,10)).trimEnd();c.slice(0,5)==="Init "&&(c=""),c&&(r+=`
063	024	${o[19].toString().padStart(3,"0")}	${c}`),i+=d}break}case"EPVC":{let i=32,o=h;for(;o<s.length;){let c=s.subarray(o,o+i),n=$e.decode(c.subarray(0,10)).trimEnd();n==="----------"&&(n=""),n&&(r+=`
063	${(c[17]+1).toString().padStart(3,"0")}	${c[19].toString().padStart(3,"0")}	${n}`),o+=i}break}}S++,S>=$.length&&(E=3,m=!1)}][E]||(()=>{m=!1}))()}return r});ft.set("pcg",async function(b){let e=new Uint8Array(await b.arrayBuffer()),r="MSB\tLSB\tPRG\tNME",l=100,h=0,p=0,E=!0,m=[],$=0;for(;E;){let S=e.subarray(l);([()=>{E=$e.decode(S.subarray(0,4))==="INI2",p=S[15],l+=16,h=1},()=>{let M=$e.decode(S.subarray(0,4)),t=S[5],s=S[7],d=S[11],i=dt(S.subarray(12,16)),o=dt(S.subarray(16,20)),c=dt(S.subarray(36,40)),n=$e.decode(S.subarray(44,44+d));m.push({type:M,tipMsb:t,tipLsb:s,nameLen:d,length:i,start:o,entryLen:c,name:n}),l+=64,p--,p<1&&(h=2)},()=>{let M=m[$],t=e.subarray(M.start,M.start+M.length);switch(M.type){case"PRG1":break;case"PBK1":{let s=63,d=(M.tipMsb?6:0)+M.tipLsb;for(let i=0;i<128;i++){let o=i*M.entryLen,c=t.subarray(o,o+M.entryLen),n=$e.decode(c.subarray(0,24)).trimEnd().replace("InitProg","");n.length&&d>5&&(r+=`
${s.toString().padStart(3,"0")}	${d.toString().padStart(3,"0")}	${i.toString().padStart(3,"0")}	${n}`)}break}case"CBK1":{let s=63,d=(M.tipMsb?3:0)+M.tipLsb+10;for(let i=0;i<128;i++){let o=i*M.entryLen,c=t.subarray(o,o+M.entryLen),n=$e.decode(c.subarray(0,24)).trimEnd().replace("InitCombi","");n.length&&d>12&&(r+=`
${s.toString().padStart(3,"0")}	${d.toString().padStart(3,"0")}	${i.toString().padStart(3,"0")}	${n}`)}break}}$++,$>=m.length&&(h=3,E=!1)}][h]||(()=>{E=!1}))()}return r});F();var ht=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),ut=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],Oa=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],Je=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],jt=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],Zt=function(b){let e=.1,r=-.3;return b>66?(e=5,r=315):b>56?(e=1,r=47):b>46&&(e=.5,r=18.5),e*b-r},Jt=function(b){return b>105?Oa[b-106]:b>100?b*1.1-100:b/10},ea=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),At={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,ㇺ
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,ゐ
we,ゑ
wo,を
nga,か゚
ngi,き゚
ngu,く゚
nge,け゚
ngo,こ゚
ngy,き゚!
ng,ン
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,𛀁
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(b=>{let e=b.split(",");At[e[0]]=e[1]});var ta=function(b){let e=b;b[0]=="*"&&(e=e.slice(1)),["aa","ii","uu","ee","oo"].forEach(l=>{for(;e.indexOf(l)>-1;)e=e.replace(l,l[0])});for(let l in At)e=e.replaceAll(l,At[l]);e.indexOf("\u3093")==0&&e.length>1&&(e=e.slice(1));let r=e.indexOf("!");return r>-1&&e.length>1&&(e=e.slice(r+1)),e},aa=function(b){return b?b<96?`cc${b}`:["aftertouch","velocity","pitch bend"][b-96]:"off"},ra={u8:["utf-8","Unicode"],l1:["l9","Pan-Latin"],jp:["sjis","Japanese"],kr:["iso-2022-kr","Korean"],hz:["gb18030","Simplified Chinese"],b5:["big5","Traditional Chinese"],cy:["koi8-ru","Cyrillic"],vn:["tcvn-5773-1993","Vietnamese"]},sa={m:"Male",f:"Female",c:"Chorus",s:"Solo",p:"Plural",w:"Words",x:"Non-vocal"};F();var Ot=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],ia=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],na=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var Ia={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},Da={66307:["drive"],66309:["vowel",b=>"aiueo"[b]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",b=>["off","LPF","HPF"][b]],94984:["noise type",b=>["white","pink"][b]],94987:["disc type",b=>["LP","SP","EP","RND"]],94990:["hum type",b=>`${b+5}0Hz`],94993:["M/S",b=>["mono","stereo"][b]]},It=function(b){return Ia[(b[0]-32<<8)+b[1]]||`0x${b[0].toString(16).padStart(2,"0")}${b[1].toString(16).padStart(2,"0")}`},ca=function(b,e,r){let l=(b[0]-32<<16)+(b[1]<<8)+e,h=Da[l]||{},p=h[0];if(p!=null&&p.length)return p+=`: ${(h[1]||function(){})(r)||r}`,p},Dt=[68,48,95,78,41,3,110,122,0];F();var le=function(b=64){return Math.round(2e3*Math.log10(b/64))/100};var Ne=function(b){let e=0;return b.forEach(r=>{e+=r,e=e&127}),~e+1&127},ye=function(b,e){let r=0,l=0;for(let h=0;h<b.length;h++){let p=(h&7)-1,E=(l>>p&1)<<7,m=b[h];m+=E,h&7?(e(m,r,b),r++):l=b[h]}};var La=function(b,e){let r=0;for(let l=0;l<b.length;l++)if(l&1){r=r<<4|b[l]&15;let h=l>>1;e(r,h,b)}else r=b[l]&15},oa=function(b){let e=b.length>>1,r=new Uint8Array(e);return La(b,(l,h)=>{r[h]=l}),r},pt=function(b){let e=Math.floor(b*14.2);return e<128?e:0},L=function(){var b;return self.Bun?!0:(b=self.debugMode)!=null?b:!1},la=function(b){let e=(b.length+1)*3>>2,r=new Uint8Array(e),l=b.length+3>>2;for(let h=0;h<l;h++){let p=h<<2,E=h*3,m=0;for(let $=0;$<4;$++)m<<=6,m|=b.charCodeAt(p+$)-32&63;r[E]=m>>16,r[E+1]=m>>8&255,r[E+2]=m&255}return r};var mr="\u266D\uD834\uDD2B,\uD834\uDD2B,\u266D,,\u266F,\uD834\uDD2A,\uD834\uDD2A\u266F".split(",");var Hr=Ta(da(),1);var Y=["?","gm","gs","sc","xg","g2","mt32","doc","qy10","qy20","ns5r","x5d","05rw","k11","sg","sd","pa","krs","s90es","motif","cs6x","trin","an1x","cs1x"],Ua={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es",trinity:"trin","tr-rack":"trin"},Na=["melodic","drum","menu"],bt={"?":[0,0,120,0,0],gm:[0,0,120,0,0],gs:[0,0,128,0,0],sc:[0,0,128,0,0],xg:[0,0,127,0,0],g2:[0,0,120,0,0],mt32:[0,127,127,0,127],doc:[57,112,127,57,112],qy10:[57,113,127,57,113],qy20:[57,114,127,57,114],ns5r:[0,0,61,0,0],x5d:[82,0,62,56,0],"05rw":[81,0,62,56,0],k11:[0,0,122,0,0],sg:[0,0,122,0,0],sd:[97,0,105,0,0],pa:[0,0,120,121,0],krs:[121,0,120,0,0],s90es:[0,0,127,0,0],motif:[0,0,127,0,0],cs6x:[0,0,127,0,0],trin:[0,0,61,0,0],an1x:[36,3,127,0,0],cs1x:[0,0,127,63,0],cs2x:[0,0,127,63,0]},Ba=[9,25,41,57,73,89,105,121],Ha=[0,3,81,84,88],fa={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},vt={0:0,1:1,2:3,5:4},ha={0:0,1:1,2:2,5:3},ua=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],Nt=[36,37,48,49,52,53],xt=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],pa={26:127,29:0,30:0,31:0,52:12,53:54},Be=[0,1,2,4,5,6,7,8,10,11,12,13,14,15,16,17,18,19,20,21,22,26,28,32,38,40,41,42,43,44,45,46,47,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,80,81,82,83,84,91,92,93,94,95,98,99,100,101,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],_a=[2,4,12,13,14,15,16,17,18,19,20,21,40,41,42,43,44,45,46,47,80,81,83,136,130,131,132,133,134,135,137,138,139,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],Ga=[33,102,99,32,100,8,9,10],ba=[0,16,25,40,32,64,24,48],ya="reverb,chorus,delay,insert0,insert1,insert2,insert3,insert4".split(","),ge=[["VL",32,8,1],["SG",8,1,1],["DX",16,1,16],["AN",16,2,5],["PF",2,1,64],["DR",2,1,32],["PC",2,1,32],["AP",2,1,64]],v={};Y.forEach((b,e)=>{v[b]=e});var w=[];Be.forEach((b,e)=>{w[b]=e});var Ee={length:xt.length};xt.forEach((b,e)=>{Ee[b]=e});var Xa={};Na.forEach((b,e)=>{Xa[b]=e});var Ka=function(b){let e=[],r=0;return b==null||b.forEach(function(l,h){l===247?e.push(b.subarray(r,h)):l===240&&(r=h+1)}),e.length||e.push(b.subarray(0)),L()&&console.debug(e),e};var Ut=8,g={port:Ut,ch:Ut<<4,chShift:Math.ceil(Math.log2(Ut))+4,cc:Be.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,nrpn:Nt.length,ace:8,drm:8,dpn:xt.length,dnc:128,ext:3,efx:8,cvn:12,redir:32,vxPrim:3,invalidCh:255};g.chcc=g.cc*g.ch;var yt={bank0:255},Fa=new TextDecoder("l9"),_=new Uint16Array(g.ch),et=new Uint16Array(g.ch),Va=new Uint16Array(g.ch),wt=new Uint16Array(g.ch),Ya=new Uint16Array(g.ch),tt=new Uint16Array(g.ch),ga=new Array(g.drm);for(let b=0;b<g.ch;b++)_[b]=b*g.cc,et[b]=b*g.rpn,Va[b]=b*g.nrpn,wt[b]=b*g.ace,Ya[b]=b*g.ext,tt[b]=b*g.cvn;for(let b=0;b<g.drm;b++){ga[b]=new Uint16Array(g.dpn);let e=b*g.dpn*g.dnc;for(let r=0;r<g.dpn;r++)ga[b][r]=e+r*g.dnc}var H,re,Ce,me,Ae,at,za,de,G,O,k,te,N,Z,se,Q,X,Pe,Se,He,ie,D,B,rt,ce,ke,fe,_e,Ge,z,st,Xe,ue,Ke,it,Oe,ve,nt,Ie,j,U,xe,gt,V,Fe,ct,Bt,Ht,_t,Gt,De,Le,Et,ot,Te,K,$t,Ct,W,lt,Ve,he,Re,Ue,ne,Ye,J,mt,St,ze,We,ee,pe,we,qe,Qe,je,Ea,Gr=(Ea=class extends zt{constructor(){super();T(this,Ae);A(this,"NOTE_IDLE",0);A(this,"NOTE_ATTACK",1);A(this,"NOTE_DECAY",2);A(this,"NOTE_SUSTAIN",3);A(this,"NOTE_HELD",4);A(this,"NOTE_RELEASE",5);A(this,"NOTE_SOSTENUTO_ATTACK",8);A(this,"NOTE_SOSTENUTO_DECAY",9);A(this,"NOTE_SOSTENUTO_SUSTAIN",10);A(this,"NOTE_SOSTENUTO_HELD",11);A(this,"NOTE_MUTED_RECOVERABLE",16);A(this,"CH_MELODIC",0);A(this,"CH_DRUMS",1);A(this,"CH_DRUM1",2);A(this,"CH_DRUM2",3);A(this,"CH_DRUM3",4);A(this,"CH_DRUM4",5);A(this,"CH_DRUM5",6);A(this,"CH_DRUM6",7);A(this,"CH_DRUM7",8);A(this,"CH_DRUM8",9);A(this,"DUMP_ALL",0);A(this,"DUMP_ONCE",1);A(this,"DUMP_MODE",2);A(this,"EXT_NONE",0);A(this,"EXT_VL",1);A(this,"EXT_DX",3);A(this,"VLBC_SYSTEM",0);A(this,"VLBC_BRTHEXPR",1);A(this,"VLBC_VELOINIT",2);A(this,"VLBC_VELOALL",3);A(this,"CH_INACTIVE",0);A(this,"CH_ACTIVE",1);A(this,"CH_DISABLED",2);A(this,"KARAOKE_NONE",0);A(this,"KARAOKE_TEXT",1);A(this,"KARAOKE_XF",2);T(this,H,0);T(this,re,0);T(this,Ce,0);T(this,me,new Array(11));T(this,de,new Uint8Array(g.ch));T(this,G,new Uint8Array(g.ch));T(this,O,new Uint8Array(g.ch));T(this,k,new Uint8Array(g.chcc<<1));T(this,te,new Uint8Array(g.ch*g.ace));T(this,N,new Uint8Array(g.ch*g.vxPrim));T(this,Z,new Uint8Array(g.ch*g.nn));T(this,se,new Uint8Array(g.ch));T(this,Q,new Uint16Array(g.pl));T(this,X,new Uint8Array(g.pl));T(this,Pe,new Int16Array(g.ch));T(this,Se,new Uint8Array(g.ch));T(this,He,new Uint8Array(g.ch));T(this,ie,new Uint8Array(g.ch*g.ext));T(this,D,new Uint8Array(g.ch*g.rpn));T(this,B,new Uint8Array(g.ch*g.rpnt));T(this,rt,new Int8Array(g.ch*Nt.length));T(this,ce,new Uint8Array(g.drm*g.dpn*g.dnc));T(this,ke,new Uint8Array(g.drm*2));T(this,fe,new Uint8Array(g.efx*3));T(this,_e,new Uint8Array(g.ch));T(this,Ge,new Uint8Array(g.ch*g.redir));T(this,z,new Uint8Array(g.port));T(this,st,new Uint8Array(g.port));T(this,Xe,new Uint8Array(g.ch));T(this,ue,new Uint8Array(g.ch));T(this,Ke,new Uint8Array(g.ch*g.cvn));T(this,it,new Uint8Array(g.ch));T(this,Oe,new Uint8Array(128));T(this,ve,new Uint8Array(g.cmt*8));T(this,nt,new Uint8Array(1024));T(this,Ie,new Uint8Array(g.cmt*64));T(this,j,{});A(this,"modelEx",{xg:{varSys:!1,insPart:new Uint8Array(5)},yPlg:[],sc:{showBar:!0,invBar:!1,invDisp:!1,peakHold:1},cs1x:{perfCh:0},kross:{chToggle:!1},sg:{convLastSyll:0,runLineLen:0,maxLineLen:32,splitMask:!1}});T(this,U,void 0);T(this,xe,void 0);T(this,gt,void 0);T(this,V,100);T(this,Fe,0);T(this,ct,500);T(this,Bt,0);T(this,Ht,0);T(this,_t,32);T(this,Gt,!1);T(this,De,"");T(this,Le,0);T(this,Et,0);T(this,ot,0);T(this,Te,!0);T(this,K,0);T(this,$t,1);T(this,Ct,void 0);T(this,W,!1);T(this,lt,0);T(this,Ve,new Array(g.ch));T(this,he,[]);T(this,Re,new Uint8Array(g.ch));T(this,Ue,new Uint8Array(g.tr));A(this,"baseBank",new Rt("gm2","ns5r","xg","gs","sd","gmega","plg-vl","plg-pf","plg-dx","plg-an","plg-dr","plg-sg","kross","s90es","cs2x","pa"));A(this,"userBank",new Rt("gm2"));A(this,"initOnReset",!1);A(this,"aiEfxName","");A(this,"polyIndexShrink",!0);A(this,"polyIndexLatest",0);A(this,"polyIndexLast",0);T(this,ne,[]);T(this,Ye,void 0);T(this,J,{nOff:(e,r)=>{let l=e*128+r,h=a(this,Q).lastIndexOf(l);if(h>-1)if(this.getChCc(e,64)>>6)a(this,X)[h]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:r,velo:a(this,Z)[l],state:this.NOTE_HELD});else if(this.getChCc(e,66)>>6&&a(this,X)[h]===this.NOTE_SOSTENUTO_SUSTAIN)a(this,X)[h]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:r,velo:a(this,Z)[l],state:this.NOTE_SOSTENUTO_HELD});else{a(this,Q)[h]=0,a(this,Z)[l]=0,a(this,X)[h]=this.NOTE_IDLE;let p=this.getExt(e)[1];(p===this.VLBC_VELOINIT||p===this.VLBC_VELOALL)&&this.setChCc(e,129,0),this.dispatchEvent("note",{part:e,note:r,velo:0,state:this.NOTE_IDLE})}if(a(this,se)[e]){for(let p=this.polyIndexLast;p>=0;p--)if(a(this,Q)[p]>>7===e&&a(this,X)[p]!==0){a(this,X)[p]===this.NOTE_MUTED_RECOVERABLE&&(a(this,X)[p]=this.NOTE_SUSTAIN);break}}if(this.polyIndexShrink&&this.polyIndexLast>0){let E=!1,m=this.polyIndexLast-8,$=this.polyIndexLast;for(;$>m&&a(this,X)[$]===0;$--)E=!0;E&&(this.polyIndexLast=$,a(this,X)[$+1]!==0&&console.error("Polyphonic slot shrinking edge case."))}},nOn:(e,r,l)=>{let h=e*128+r,p=0;if(a(this,se)[e])for(let E=0;E<=this.polyIndexLast;E++)a(this,Q)[E]>>7===e&&a(this,X)[E]!==0&&(a(this,X)[E]=this.NOTE_MUTED_RECOVERABLE);for(;a(this,X)[p]>0&&a(this,Q)[p]!==h;)p++;if(p<g.pl){a(this,Q)[p]=h,a(this,Z)[h]=l,a(this,X)[p]=this.NOTE_SUSTAIN,a(this,Se)[e]<l&&(a(this,Se)[e]=l);let E=this.getExt(e)[1];(E===this.VLBC_VELOINIT||E===this.VLBC_VELOALL)&&this.setChCc(e,129,l),this.dispatchEvent("note",{part:e,note:r,velo:l,state:this.NOTE_SUSTAIN}),this.polyIndexLatest=p+1,p>this.polyIndexLast&&(this.polyIndexLast=p)}else console.error("Polyphony exceeded.")},nAt:(e,r,l)=>{},cAt:(e,r)=>{},hoOf:e=>{a(this,X).forEach((r,l)=>{if(r===this.NOTE_HELD){let h=a(this,Q)[l],p=h>>7;e===p&&(a(this,X)[l]=this.NOTE_IDLE,a(this,Q)[l]=0,a(this,Z)[h]=0,this.dispatchEvent("note",{part:e,note:h&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{a(this,X).forEach((r,l)=>{let h;switch(r){case this.NOTE_ATTACK:{h=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{h=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{h=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(h){a(this,X)[l]=h;let p=a(this,Q)[l];this.dispatchEvent("note",{part:e,note:p&127,velo:a(this,Z)[p],state:h})}})},soOf:e=>{a(this,X).forEach((r,l)=>{if(r===this.NOTE_SOSTENUTO_HELD){let h=a(this,Q)[l],p=h>>7;e===p&&(a(this,X)[l]=this.NOTE_IDLE,a(this,Q)[l]=0,a(this,Z)[h]=0,this.dispatchEvent("note",{part:e,note:h&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{a(this,Q).forEach(r=>{let l=r>>7,h=r&127;r===0&&a(this,Z)[0]===0||l===e&&a(this,J).nOff(l,h)})}});T(this,mt,{8:function(e){let r=e.channel,l=e.data[0];a(this,J).nOff(r,l)},9:function(e){let r=e.channel,l=this;if(l.getChModeId(r)===v.xg&&a(l,O)[r]>1){let E=l.getChDrumFirstWrite(r);E[0]&&E[1]!==g.invalidCh&&!a(l,de)[r]&&(l.copyChSetup(E[1],r),l.pushChPrimitives(r),console.debug(`Part CH${r+1} copied from CH${E[1]+1}.`))}l.setChActive(r,1);let h=e.data[0],p=e.data[1];p>0?a(l,J).nOn(r,h,p):a(l,J).nOff(r,h)},10:function(e){let r=e.channel,l=r*128+e.data[0];a(this,Q).indexOf(l)>-1&&(a(this,Z)[l]=data[1],this.getExt(r)[1]===this.VLBC_VELOALL&&this.setChCc(r,129,data[1]),this.dispatchEvent("note",{part:r,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let r=e.channel,l=this,h=a(l,Ve)[r],p=h[e.data[0]];p&&(e.data[0]=p),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(a(this,H)){case v.s90es:case v.motif:{if(e.data[0]===0){[0,63].indexOf(e.data[1])>-1&&l.setChActive(r,1);break}e.data[1]&&l.setChActive(r,1);break}default:break}})();let E=r*g.ext,m=l.getChModeId(r);switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{a(this,J).ano(r),a(this,Pe)[r]=0,l.resetChCc(r,1,0),l.resetChCc(r,5,0),l.resetChCc(r,64,0),l.resetChCc(r,65,0),l.resetChCc(r,66,0),l.resetChCc(r,67,0),l.resetChCc(r,11,127),l.resetChCc(r,101,127),l.resetChCc(r,100,127),l.resetChCc(r,99,127),l.resetChCc(r,98,127);return}case 123:{a(this,J).ano(r);return}case 124:{a(this,J).ano(r);return}case 125:{a(this,J).ano(r);return}case 126:{a(this,se)[r]=1,a(this,J).ano(r);return}case 127:{a(this,se)[r]=0,a(this,J).ano(r);return}}if(w[e.data[0]]===void 0)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(_a.indexOf(e.data[0])>-1&&this.allocateAce(r,e.data[0]),e.data[0]){case 0:{switch(L()&&console.debug(`${Y[a(this,H)]}, CH${r+1}: ${e.data[1]}`),a(this,H)===0?e.data[1]<48?(a(this,O)[r]>0&&(e.data[1]=this.getChPrimitive(r,1,!1),e.data[1]=bt.gs[2],console.debug(`Forced channel ${r+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]===56?this.switchMode(a(this,U).x5===82?"x5d":"05rw"):e.data[1]===62?this.switchMode(a(this,U).x5===82?"x5d":"05rw"):e.data[1]===63?this.switchMode(Y[a(this,U).ds]):e.data[1]===64||e.data[1]===127?this.switchMode("xg"):(e.data[1]===120||e.data[1]===121)&&this.switchMode("g2"):a(this,H)===v.gs||a(this,H)===v.sc?e.data[1]<56&&a(this,O)[r]>0&&(e.data[1]=this.getChPrimitive(r,1,!1),e.data[1]=bt.gs[2],console.debug(`Forced channel ${r+1} to stay drums.`)):a(this,H)===v.gm&&(e.data[1]<48?a(this,O)[r]>0&&(e.data[1]=bt.gs[2],this.switchMode("gs",!0),console.debug(`Forced channel ${r+1} to stay drums.`)):(e.data[1]===64||e.data[1]===127)&&this.switchMode("xg",!0)),a(this,H)){case v.xg:{[79,95,126,127].indexOf(e.data[1])>-1?a(this,O)[r]===0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):a(this,O)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?a(this,ie)[E]=this.EXT_VL:[35,67,83,99].indexOf(e.data[1])>-1?a(this,ie)[E]=this.EXT_DX:a(this,ie)[E]=this.EXT_NONE;break}case v["05rw"]:case v.x5d:case v.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?a(this,O)[r]===this.CH_MELODIC&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):[80,81,82,83].indexOf(e.data[1])>-1||a(this,O)[r]!==this.CH_MELODIC&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case v.sd:{[104,105,106,107,120].indexOf(e.data[1])>-1?a(this,O)[r]===0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):a(this,O)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case v.g2:{e.data[1]===120?a(this,O)[r]===0&&(this.setChType(r,this.CH_DRUMS),console.debug(`CH${r+1} set to drums by MSB.`)):a(this,O)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}}break}case 2:{this.getExt(r)[1]===this.VLBC_BRTHEXPR&&this.setChCc(r,129,e.data[1]);break}case 6:{if(a(this,He)[r]){[v.xg,v.gs,v.sc,v.ns5r].indexOf(a(this,H))<0&&console.warn(`NRPN commits are not available under "${Y[a(this,H)]}" mode, even when they are supported in Octavia.`);let $=this.getChCc(r,99),S=this.getChCc(r,98);if($===1){let M=Ga.indexOf(S);if(M>-1)this.setChCc(r,71+M,e.data[1]),L()&&console.debug(`Redirected NRPN 1 ${S} to cc${71+M}.`),this.dispatchEvent("cc",{part:r,cc:71+M,data:e.data[1]});else{let t=Nt.indexOf(S);t>-1?a(this,rt)[r*10+t]=e.data[1]-64:console.warn(`NRPN 0x01${S.toString(16).padStart(2,"0")} is not supported.`),L()&&console.debug(`CH${r+1} voice NRPN ${S} commit`)}}else{if(xt.indexOf($)<0){let t=`NRPN 0x${$.toString(16).padStart(2,"0")}${S.toString(16).padStart(2,"0")} `;console.warn($===127?`${t}is not necessary. Consider removing it.`:`${t}is not supported.`)}else{let t=a(this,O)[r]-2;t<0?console.warn(`CH${r+1} cannot accept drum NRPN as type ${ut[a(this,O)[r]]}.`):a(this,ce)[(t*g.dpn+Ee[$])*g.dnc+S]=e.data[1]}L()&&console.debug(`CH${r+1} (${ut[a(this,O)[r]]}) drum NRPN ${$} commit`)}}else{let $=vt[this.getChCc(r,100)],S=ha[this.getChCc(r,100)];if(this.getChCc(r,101)===0&&$!==void 0)switch(L()&&console.debug(`CH${r+1} RPN 0 ${this.getChCc(r,100)} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],ua[$][0]),ua[$][1]),a(this,D)[r*g.rpn+$]=e.data[1],a(this,B)[r*g.rpnt+S]=1,m){case v.xg:case v.gs:case v.sc:case v.mt32:case v.s90es:case v.motif:case v.cs1x:case v.cs6x:{switch(this.getChCc(r,100)){case 1:case 2:{this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)});break}}break}default:this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)})}}break}case 32:{switch(L()&&console.debug(`${Y[a(this,H)]}, CH${r+1} LSB: ${e.data[1]}`),a(this,H)){case v.s90es:case v.motif:{this.setChType(r,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,a(this,H),!0);break}}this.getExt(r)[0],this.EXT_DX;break}case 38:{if(!a(this,He)[r]){let $=vt[this.getChCc(r,100)],S=ha[this.getChCc(r,100)];this.getChCc(r,101)===0&&$!==void 0&&(a(this,D)[r*g.rpn+$+1]=e.data[1],a(this,B)[r*g.rpnt+S]=1)}break}case 64:{e.data[1]<64&&a(this,J).hoOf(r);break}case 66:{e.data[1]>>6?a(this,J).soOn(r):a(this,J).soOf(r);break}case 98:case 99:{a(this,He)[r]=1;break}case 100:case 101:{a(this,He)[r]=0;break}}this.setChCc(r,e.data[0],e.data[1]),this.dispatchEvent("cc",{part:r,cc:e.data[0],data:e.data[1]})}l.getChModeId(r)===v.xg&&a(l,O)[r]&&l.setDrumFirstWrite(r)},12:function(e){let r=e.channel,l=this;switch(a(l,H)){case v.s90es:case v.motif:{e.data&&l.setChActive(r,1);break}default:l.setChActive(r,1)}let h=_[r];switch(l.getExt(r)[0]){case l.EXT_VL:break}a(l,N)[r]=e.data,a(l,ue)[r]=0,l.pushChPrimitives(r),L()&&console.debug(`T:${e.track} C:${r} P:${e.data}`),l.getChModeId(r)===v.xg&&a(l,O)[r]&&l.setDrumFirstWrite(r)},13:function(e){let r=this,l=e.channel;a(this,Q).forEach(function(h){let p=h>>7;l===p&&(a(r,Z)[h]=e.data,r.dispatchEvent("note",{part:l,note:h&127,velo:e.data,state:r.NOTE_SUSTAIN}))})},14:function(e){let r=e.channel;a(this,Pe)[r]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)})},15:function(e){Ka(e.data).forEach(r=>{let l=r[0],h=r[1];x(this,lt,r.length),(a(this,St)[l]||function(){console.debug(`Unknown manufacturer ${l}.`)})(h,r.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(a(this,ne)[e.meta]||function(l,h,p){}).call(this,e.data,e.track,e.meta),e.meta!==32&&x(this,Fe,0);let r=Ha.indexOf(e.meta)>-1;if(L()&&console.debug(e),r)return e.reply="meta",e}});T(this,St,{64:(e,r,l)=>{a(this,qe).run(r,l,e)},65:(e,r,l)=>{if(r[0]<16){if(r[1]===72){let h=r[r.length-1],p=Ne(r.subarray(3,r.length-1));h===p?a(this,pe).run(r.subarray(0,r.length-1),l,e):console.warn(`Bad SD checksum ${h} - should be ${p}.`)}else a(this,pe).run(r,l,e);}else{let h=r[r.length-1],p=Ne(r.subarray(2,r.length-1));h===p?a(this,pe).run(r.subarray(0,r.length-1),l,e):console.warn(`Bad GS checksum ${h} - should be ${p}.`)}},66:(e,r,l)=>{a(this,we).run(r,l,e)},67:(e,r,l)=>{switch(e>>4){case 0:{let h=0;for(;r[h]===127&&h<4;)h++;let p=r[1+h]<<7|r[2+h];if(p+7+h!==r.length){console.warn(`Yamaha bulk dump length mismatch! Expected ${r.length-7-h}, received ${p}.`),console.debug(r);break}let E=Ne(r.subarray(1+h,r.length-1)),m=r[r.length-1];if(r[r.length-1]>>7)console.warn(`Yamaha bulk dump checksum invalid! Expected ${E}, received ${m}:
`),console.debug(r);else if(E!==m)console.warn(`Yamaha bulk dump checksum mismatch! Expected ${E}, received ${m}:
`),console.debug(r);else{let $=r.slice(2,r.length-1);for(let S=0;S<=h;S++)$[S]=r[S];a(this,ee).run($,l,e&15)}break}case 1:{a(this,ee).run(r,l,e&15);break}case 2:{console.warn("Octavia doesn't yet support Yamaha bulk dump requests.");break}case 3:{console.warn("Octavia doesn't yet support Yamaha parameter requests.");break}case 7:{switch(e&15){case 14:{let h=new Uint8Array(r.length+1);h[0]=126,h.set(r,1),a(this,ee).run(h,l,0);break}default:console.warn(`Unknown Yamaha special SysEx type: ${e}.`)}break}default:console.warn(`Unknown Yamaha SysEx type: ${e>>4}.`)}},68:(e,r,l)=>{a(this,je).run(r,l,e)},71:(e,r,l)=>{a(this,Qe).run(r,l,e)},126:(e,r,l)=>{a(this,ze).run(r,l,e)},127:(e,r,l)=>{this.switchMode("gm"),a(this,We).run(r,l,e)}});T(this,ze,void 0);T(this,We,void 0);T(this,ee,void 0);T(this,pe,void 0);T(this,we,void 0);T(this,qe,void 0);T(this,Qe,void 0);T(this,je,void 0);let e=this;for(let t=0;t<10;t++)a(e,me)[t]=new Uint8Array(256);a(e,me)[10]=new Uint8Array(512),x(e,Ye,new be),x(e,U,{x5:82,ds:v.krs,smotif:v.s90es,gs:4,sc:3,gm:v.gm,g2:v.g2}),x(e,xe,{dumpLimit:e.DUMP_MODE}),x(e,gt,new Proxy(a(e,xe),{set:()=>{}}));for(let t in bt){let s=v[t];s===void 0?console.debug(`SubDB build error: "${t}" does not exist`):a(e,j)[s]=new Uint8Array(bt[t])}for(let t of ge)e.modelEx.yPlg.push(new Uint8Array(t[1]));e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(t){var d,i;let{data:s}=t;((d=a(e,he)[0])==null?void 0:d.type)===s.type&&(i=a(e,he)[0])!=null&&i.amend?(a(e,he)[0].amend=s.amend,a(e,he)[0].data+=s.data):a(e,he).unshift(s)}),a(e,ne)[1]=function(t){var s,d,i,o;switch(t=t.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),t.substring(0,2)){case"@I":{x(e,K,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Info",data:(s=t.substring(2))==null?void 0:s.trimStart()});break}case"@K":{x(e,K,e.KARAOKE_TEXT);let c=t.substring(2);c!=="MIDI KARAOKE FILE"&&e.dispatchEvent("metacommit",{type:"Kar.Mode",data:c==null?void 0:c.trimStart()}),console.debug(`Karaoke mode active: ${c}`);break}case"@L":{x(e,K,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Lang",data:(d=t.substring(2))==null?void 0:d.trimStart()});break}case"@T":{x(e,K,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"KarTitle",data:(i=t.substring(2))==null?void 0:i.trimStart()});break}case"@V":{x(e,K,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Ver.",data:(o=t.substring(2))==null?void 0:o.trimStart()});break}case"Mi":{if(t.substring(2,16)==="dStamp-1.00: 0"){let c=t.length;for(let u=t.length;u>0;u--)if((t.charCodeAt(u-1)>>5)+1>>1===1){c=u;break}let n=t.substring(16,c);e.dispatchEvent("metacommit",{type:"MidStamp",data:la(n)})}else t.split(`
`).forEach((c,n)=>{e.dispatchEvent("metacommit",{type:"Cmn.Text",data:c,mask:n!==0})});break}case"XF":{let c=t.slice(2).split(":");switch(c[0]){case"hd":{c.slice(1).forEach((n,u)=>{n.length&&e.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][u],data:n})});break}case"ln":{c.slice(1).forEach((n,u)=>{n.length&&e.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][u],data:n})});break}default:e.dispatchEvent("metacommit",{type:"XfUnData",data:t})}break}default:switch(a(e,K)){case e.KARAOKE_TEXT:{switch(t[0]){case"\\":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:t.substring(1),amend:!0});break}case"/":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:t.substring(1),mask:!0,amend:!0});break}default:e.dispatchEvent("metacommit",{type:"KarLyric",data:t,amend:!0})}break}default:t.split(`
`).forEach((c,n)=>{e.dispatchEvent("metacommit",{type:"Cmn.Text",data:c,mask:n!==0})})}}},a(e,ne)[2]=function(t){e.dispatchEvent("metacommit",{type:"Copyrite",data:t})},a(e,ne)[3]=function(t,s){s<1&&a(e,Fe)<1&&e.dispatchEvent("metacommit",{type:"TrkTitle",data:t})},a(e,ne)[4]=function(t,s){e.dispatchEvent("metacommit",{type:"Instrmnt",data:t})},a(e,ne)[5]=function(t){switch(a(e,K)){case e.KARAOKE_XF:{let s="";for(let d of t)switch(d){case"^":case"%":{s+=" ";break}case">":{s+="\t";break}case"<":{e.dispatchEvent("metacommit",{type:"KarLyric",data:s,mask:a(e,W),amend:!1}),s="",x(e,W,!1);break}case"/":{e.dispatchEvent("metacommit",{type:"KarLyric",data:s,mask:!1,amend:!1}),s="",x(e,W,!0);break}default:s+=d}s.length>0&&(e.dispatchEvent("metacommit",{type:"KarLyric",data:s,mask:a(e,W),amend:!0}),x(e,W,!1));break}default:{let s=0,d=!0,i=t.length-1;for(;d&&s<8;)switch(t.charCodeAt(s)){case 32:{s++;break}default:d=!1}switch(s>0&&(e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(0,s),amend:!0,mask:a(e,W),untimed:!0}),x(e,W,!1)),t.charCodeAt(i)){case 10:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(s,i),amend:!1,mask:a(e,W)}),x(e,W,!1);break}case 11:case 13:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(s,i),amend:!1,mask:a(e,W)}),x(e,W,!0);break}case 32:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(s,i),amend:!0,mask:a(e,W)}),e.dispatchEvent("metacommit",{type:"C.Lyrics",data:" ",amend:!0,mask:!1,untimed:!0}),x(e,W,!1);break}default:t.trim()===""?console.info("Blank line? Shouldn't happen."):e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t,amend:!0,mask:a(e,W)}),x(e,W,!1)}break}}},a(e,ne)[6]=function(t){e.dispatchEvent("metacommit",{type:"C.Marker",data:t})},a(e,ne)[7]=function(t){switch(t[0]){case"$":{if(t.substring(1,5)==="Lyrc"){x(e,K,e.KARAOKE_XF);let s=t.substring(6).split(":"),d=s[0].replaceAll(" ","").split(",");d.forEach((o,c,n)=>{n[c]=parseInt(o)-1});let i=ra[s[2].substring(0,2).toLowerCase()];e.dispatchEvent("metacommit",{type:"XfMeloCh",data:`CH${s[0].replaceAll(" ","").split(",").join(", CH")}`,parsed:d}),e.dispatchEvent("metacommit",{type:"XfLyrOff",data:s[1],parsed:parseInt(s[1])}),e.dispatchEvent("metacommit",{type:"XfLyrEnc",data:i[1],parsed:i[0]}),x(e,W,!1)}else e.dispatchEvent("metacommit",{type:"CuePoint",data:t});break}case"#":{e.dispatchEvent("metacommit",{type:"XfScneNo",data:t.substring(1)});break}case"&":{t.length===2?(e.dispatchEvent("metacommit",{type:"XfSngPrt",data:sa[t[1]]||`Unknown "${t[1]}"`}),x(e,W,!1)):e.dispatchEvent("metacommit",{type:"CuePoint",data:t});break}default:e.dispatchEvent("metacommit",{type:"CuePoint",data:t})}},a(e,ne)[32]=function(t){x(e,Fe,t[0]+1)},a(e,ne)[33]=function(t,s){L()&&console.debug(`Track ${s} requests getting assigned to port ${t}.`),a(e,Ue)[s]=t+1},a(e,ne)[81]=function(t,s){x(e,ct,t/1e3)},a(e,ne)[127]=function(t,s){a(e,Ye).run(t,s)},a(e,Ye).default=function(t){let s=[];for(let d=0;d<8&&d<t.length;d++)s.push(t[d].toString(16).padStart(2,"0").toUpperCase());console.warn(`Unrecognized implementation-specific byte sequence: ${s.join(" ")}${t.length>8?" ...":""}
%o`,t)},a(e,Ye).add([67,0,1],(t,s)=>{L()&&console.debug(`XGworks port assign requests assigning track ${s} to port ${t[0]}.`),a(e,Ue)[s]=t[0]+1}).add([67,123,1],(t,s)=>{let d=[];for(let i=0;i<t.length;i+=2){let o=t[i]>>4,c=t[i]&15;if(o<7&&c&&c<8){let n=new Uint8Array(5);n[0]=c-1,n[1]=o-3<<2,n[2]=t[i|1],d.push(n)}}e.dispatchEvent("metacommit",{type:"ChordCtl",src:"yxf",data:d}),console.debug("Yamaha XF chord data: %o",d)}).add([67,123,2],(t,s)=>{var i;let d=new Uint8Array(2);d[0]=t[0]&15,d[1]=t[0]>>4,e.dispatchEvent("metacommit",{type:"RhrslMrk",src:"yxf",data:d}),console.debug(`Yamaha XF rehearsal mark: ${(i=["Intro","Ending","Fill-in"][d[0]])!=null?i:String.fromCharCode(62+d[0])}${"'".repeat(d[1])} %o`,d)}).add([67,123,96],(t,s)=>{let d=[0,0];t.subarray(1,3).forEach(i=>{d[0]=d[0]<<7,d[0]|=i&127}),t.subarray(3,5).forEach(i=>{d[1]=d[1]<<7,d[1]|=i&127}),e.dispatchEvent("metacommit",{type:"YStyleId",data:d}),console.debug(`Yamaha style ID: model ${d[0].toString(16)}, style ${d[1]+1}`)}),x(e,ze,new be("universal non-realtime")),x(e,We,new be("universal realtime")),x(e,ee,new be("Yamaha")),x(e,pe,new be("Roland")),x(e,we,new be("Korg")),x(e,qe,new be("Kawai")),x(e,Qe,new be("Akai")),x(e,je,new be("Casio"));let r=new be("DX7+ Dump"),l=function(t){let s=[];for(let d=0;d<8&&d<t.length;d++)s.push(t[d].toString(16).padStart(2,"0").toUpperCase());console.info(`Unrecognized SysEx in "${this.name}" set: ${s.join(" ")}${t.length>8?" ...":""}
%o`,t)};a(e,ze).default=l,a(e,We).default=l,a(e,ee).default=l,a(e,pe).default=l,a(e,we).default=l,a(e,qe).default=l,a(e,Qe).default=l,a(e,je).default=l,r.default=l,a(e,ze).add([9],(t,s,d)=>{e.switchMode(["gm","?","g2"][t[0]-1],!0),e.setPortMode(e.getTrackPort(s),1,[v.gm,v["?"],a(e,U).g2][t[0]-1]),x(e,K,a(e,K)||e.KARAOKE_NONE),console.info(`MIDI reset: ${["GM","Init","GM2"][t[0]-1]}`),t[0]===2&&e.init()}),a(e,We).add([4,1],(t,s,d)=>{e.invokeSysExIndicator(),x(e,V,((t[1]<<7)+t[0])/16383*100),e.dispatchEvent("mastervolume",a(e,V))}).add([4,3],(t,s,d)=>((t[1]<<7)+t[0]-8192)/8192).add([4,4],(t,s,d)=>t[1]-64).add([4,5],(t,s,d)=>{e.invokeSysExIndicator();let i=t[0],o=t[1],c=t[2],n=3,u=n+(i<<1),f=u+o;if(i!==1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${i})!
`,t);return}let y=0,C=0,P=0;switch(t.subarray(n,u).forEach(I=>{y=y<<7,y|=I}),t.subarray(u,f).forEach((I,R)=>{C|=I<<R*7}),t.subarray(f).forEach((I,R)=>{P|=I<<R*7}),L()&&console.debug(`GM2 global parameter: (${t.subarray(3,u)}; p: ${C}, v: ${P})`),y){case 129:{C===0&&(e.setEffectType(0,52,P),e.pushEffectType(0));break}case 130:{C===0&&(e.setEffectType(1,52,P|16),e.pushEffectType(1));break}default:L()&&console.debug("GM2 global paramater slot path unknown.")}}),a(this,ee).add([76,0,0],(t,s,d)=>{switch(t[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset on drum kit ${t[1]}.`);break}case 126:{e.switchMode("xg",!0),e.setPortMode(e.getTrackPort(s),4,v.xg),x(e,K,a(e,K)||e.KARAOKE_NONE),console.info("MIDI reset: XG");break}default:{e.invokeSysExIndicator();let i=[0,0,0,0],o=(c,n)=>{i[n]=c};if(t.subarray(1).forEach((c,n)=>{let u=n+t[0];([o,o,o,o,f=>{x(this,V,f*129/16383*100),e.dispatchEvent("mastervolume",a(e,V))},f=>{},f=>{}][u]||(()=>{}))(c,n)}),t[0]<4){let c=0;i.forEach(n=>{c=c<<4,c+=n}),c-=1024,console.debug(`Master tune: ${c}`)}}}}).add([76,2,1],(t,s,d)=>{e.invokeSysExIndicator();let i="XG ";t[0]<32?(i+="reverb ",t.subarray(1).forEach((o,c)=>{([n=>{e.setEffectTypeRaw(0,!1,n),console.info(`${i}main type: ${ht[n]}`),e.pushEffectType(0)},n=>{e.setEffectTypeRaw(0,!0,n),console.debug(`${i}sub type: ${n+1}`),e.pushEffectType(0)},n=>{console.debug(`${i}time: ${Zt(n)}s`)},n=>{console.debug(`${i}diffusion: ${n}`)},n=>{console.debug(`${i}initial delay: ${n}`)},n=>{console.debug(`${i}HPF cutoff: ${Je[n]}Hz`)},n=>{console.debug(`${i}LPF cutoff: ${Je[n]}Hz`)},n=>{console.debug(`${i}width: ${n}`)},n=>{console.debug(`${i}height: ${n}`)},n=>{console.debug(`${i}depth: ${n}`)},n=>{console.debug(`${i}wall type: ${n}`)},n=>{console.debug(`${i}dry/wet: ${n}`)},n=>{console.debug(`${i}send: ${le(n)}dB`)},n=>{console.debug(`${i}pan: ${n-64}`)},!1,!1,n=>{console.debug(`${i}delay: ${n}`)},n=>{console.debug(`${i}density: ${n}`)},n=>{console.debug(`${i}balance: ${n}`)},n=>{},n=>{console.debug(`${i}feedback: ${n}`)},n=>{}][t[0]+c]||function(){console.warn(`Unknown XG reverb address: ${t[0]}.`)})(o)})):t[0]<64?(i+="chorus ",t.subarray(1).forEach((o,c)=>{([n=>{e.setEffectTypeRaw(1,!1,n),console.info(`${i}main type: ${ht[n]}`),e.pushEffectType(1)},n=>{e.setEffectTypeRaw(1,!0,n),console.debug(`${i}sub type: ${n+1}`),e.pushEffectType(1)},n=>{console.debug(`${i}LFO: ${jt[n]}Hz`)},n=>{},n=>{console.debug(`${i}feedback: ${n}`)},n=>{console.debug(`${i}delay offset: ${Jt(n)}ms`)},n=>{},n=>{console.debug(`${i}low: ${Je[n]}Hz`)},n=>{console.debug(`${i}low: ${n-64}dB`)},n=>{console.debug(`${i}high: ${Je[n]}Hz`)},n=>{console.debug(`${i}high: ${n-64}dB`)},n=>{console.debug(`${i}dry/wet: ${n}`)},n=>{console.debug(`${i}send: ${le(n)}dB`)},n=>{console.debug(`${i}pan: ${n-64}`)},n=>{console.debug(`${i}to reverb: ${le(n)}dB`)},!1,n=>{},n=>{},n=>{},n=>{console.debug(`${i}LFO phase diff: ${(n-64)*3}deg`)},n=>{console.debug(`${i}input mode: ${n?"stereo":"mono"}`)},n=>{}][t[0]-32+c]||function(){console.warn(`Unknown XG chorus address: ${t[0]}.`)})(o)})):t[0]<86?(i+="variation ",t.subarray(1).forEach((o,c)=>{([n=>{e.setEffectTypeRaw(2,!1,n),console.info(`${i}main type: ${ht[n]}`),e.pushEffectType(2)},n=>{e.setEffectTypeRaw(2,!0,n),console.debug(`${i}sub type: ${n+1}`),e.pushEffectType(2)}][t[0]-64+c]||function(){})(o)})):t[0]<97?(i+="variation ",t.subarray(1).forEach((o,c)=>{[n=>{console.debug(`${i}send: ${le(n)}dB`)},n=>{console.debug(`${i}pan: ${n-64}`)},n=>{console.debug(`${i}to reverb: ${le(n)}dB`)},n=>{console.debug(`${i}to chorus: ${le(n)}dB`)},n=>{e.modelEx.xg.varSys=!!n,console.debug(`${i}connection: ${n?"system":"insertion"}`)},n=>{if(e.modelEx.xg.varSys){console.warn(`${i}effect is applied system-wide. Setting its effective channel to CH${n+1} will not have any effect.`);return}if(n<64){let u=e.chRedir(n,s,!0);e.setXgChEffectSink(u,2),console.debug(`${i}channel: CH${n+1} (CH${u+1})`)}else e.setXgChEffectSink(g.invalidCh,2),console.info(`${i}channel: CH${n+1} (unsupported)`)},n=>{console.debug(`${i}mod wheel: ${n-64}`)},n=>{console.debug(`${i}bend wheel: ${n-64}`)},n=>{console.debug(`${i}channel after touch: ${n-64}`)},n=>{console.debug(`${i}AC1: ${n-64}`)},n=>{console.debug(`${i}AC2: ${n-64}`)}][t[0]-86+c](o)})):t[0]>111&&t[0]<118?i+="variation ":console.warn(`Unknown XG variation address: ${t[0]}`)}).add([76,2,64],(t,s,d)=>{t.subarray(1).forEach((i,o)=>{let c=o+t[0];if(c===0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][i]}`);else{let n=c-1>>2,u=c-1&3,f=`XG EQ ${n} ${["gain","freq","Q","shape"][u]}: `;[()=>{console.debug(`${f}${i-64}dB`)},()=>{console.debug(`${f}${i} (raw)`)},()=>{console.debug(`${f}${i/10}`)},()=>{console.debug(`${f}${["shelf","peak"][+!!i]}`)}][u]()}})}).add([76,3],(t,s,d)=>{e.invokeSysExIndicator();let i=t[0],o=t[1],c=`XG Insertion ${t[0]+1} `;t.subarray(2).forEach((n,u)=>{([()=>{e.setEffectTypeRaw(3+i,!1,n),console.info(`${c}main type: ${ht[n]}`),e.pushEffectType(3+i)},()=>{e.setEffectTypeRaw(3+i,!0,n),console.debug(`${c}sub type: ${n+1}`),e.pushEffectType(3+i)},!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,()=>{if(n<64){let f=e.chRedir(n,s,!0);e.setXgChEffectSink(f,3+i),console.debug(`${c}channel: CH${n+1} (CH${f+1})`)}else e.setXgChEffectSink(g.invalidCh,3+i),console.info(`${c}channel: CH${n+1} (unsupported)`)}][o+u]||function(){})(n)})}).add([76,6,0],(t,s,d)=>{let i=t[0];i<64?e.setLetterDisplay(t.subarray(1),"XG letter display",i):x(e,Le,Date.now())}).add([76,7,0],(t,s,d)=>{let i=t[0];x(e,re,0),x(e,Ce,Date.now()+3200),t.subarray(1).forEach(function(c,n){let u=n+i,f=u>>4,y=u&15,C=(y*3+f)*7,P=7,I=0;for(C-=y*5,f===2&&(P=2);I<P;)a(e,Ae,at)[C+I]=c>>6-I&1,I++})}).add([76,8],(t,s)=>{e.invokeSysExIndicator();let d=e.chRedir(t[0],s,!0),i=t[1],o=_[d],c=`XG CH${d+1} `,n=`Unknown XG part address ${i}.`,u=!0;t.subarray(2).forEach((f,y)=>{u=!0,i<1?console.debug(n):i<41?([()=>{e.setChCc(d,0,f),e.pushChPrimitives(d)},()=>{e.setChCc(d,32,f),e.pushChPrimitives(d)},()=>{a(e,N)[d]=f,e.pushChPrimitives(d)},()=>{u=!1;let C=e.chRedir(f,s,!0),P=a(e,G)[d];a(e,G)[d]=C,(d!==C||C!==P)&&(e.buildRchTree(),console.info(`${c}receives from CH${C+1}`)),a(e,de)[d]||(e.copyChSetup(C,d,!0),console.debug(`${c}copied from CH${C+1}.`),e.setChActive(d,1),e.pushChPrimitives(d))},()=>{a(e,se)[d]=+!f},()=>{},()=>{u=!1,e.setChType(d,f,v.xg),console.debug(`${c}type: ${ut[f]||f}`),e.pushChPrimitives(d)},()=>{a(e,D)[g.rpn*d+3]=f,a(e,B)[g.rpnt*d+2]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)})},!1,!1,()=>{e.setChCc(d,7,f)},!1,!1,()=>{e.setChCc(d,10,f||128)},!1,!1,()=>{e.setChCc(d,128,f),e.allocateAce(d,128)},()=>{e.setChCc(d,93,f)},()=>{e.setChCc(d,91,f)},()=>{e.setChCc(d,94,f)},()=>{e.setChCc(d,76,f)},()=>{e.setChCc(d,77,f)},()=>{e.setChCc(d,78,f)},()=>{e.setChCc(d,74,f)},()=>{e.setChCc(d,71,f)},()=>{e.setChCc(d,73,f)},()=>{e.setChCc(d,75,f)},()=>{e.setChCc(d,72,f)}][i+y-1]||(()=>{}))():i<48?console.debug(n):i<111?i>102&&i<105&&e.setChCc(d,[5,65][i&1],f):i<114?console.debug(n):i<116?console.debug(`${c}EQ ${["bass","treble"][i&1]} gain: ${f-64}dB`):i<118?console.debug(n):i<120?console.debug(`${c}EQ ${["bass","treble"][i&1]} freq: ${f}`):console.debug(n)}),u&&a(e,O)[d]>1&&e.setDrumFirstWrite(d)}).add([76,9],(t,s)=>{let d=e.chRedir(t[0],s,!0),i=t[1],o=_[d],c=`PLG-VL CH${d+1} `;t.subarray(2).forEach((n,u)=>{let f=u+i;switch(f){case 1:{console.info(`${c}breath mode: ${["system","breath","velocity","touch EG"][n]}`);break}case 0:case 27:case 28:break;default:if(f<27){let y=f-3>>1,C=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][y];f&1?f<23?(console.debug(`${c}${C} control source: ${aa(n)}`),n&&n<96&&e.allocateAce(d,130+y),a(e,Ge)[g.redir*d+y+2]=n,e.buildRccMap()):console.debug(`${c}${C} scale break point: ${n}`):(console.debug(`${c}${C} depth: ${n-64}`),e.setChCc(d,130+y,n))}}})}).add([76,10],(t,s,d)=>{}).add([76,16],(t,s,d)=>{}).add([76,17,0,0],(t,s,d)=>{}).add([76,112],(t,s,d)=>{if(t[0]>=ge.length){console.error(`Supplied invalid plugin board ID: ${t[0]}`);return}if(t[1]>=ge[t[0]][1]){console.error(`Supplied invalid slot ID for board type "${ge[t[0]][0]}" (${t[0]}): ${t[1]} (#${t[1]+1}))`);return}switch(t[1]>=ge[t[0]][2]?console.warn(`While enabled in Octavia, slot #${t[1]+1} for board type "${ge[t[0]][0]}" (${t[0]}) may not function outside software recreation.`):t[2]>63?console.debug(`XG disable PLG-${ge[t[0]][0]} (${t[0]}) slot #${t[1]+1} as it's set to CH${t[2]+1}.`):console.debug(`XG enable PLG-${ge[t[0]][0]} (${t[0]}) slot #${t[1]+1} for CH${t[2]+1}.`),e.modelEx.yPlg[t[0]][t[1]]=t[2]<64?e.chRedir(t[2],s,!0):g.invalidCh,t[0]){case 0:{a(e,ie)[g.ext*t[2]]=e.EXT_VL;break}case 2:{a(e,ie)[g.ext*t[2]]=e.EXT_DX;break}default:a(e,ie)[g.ext*t[2]]=e.EXT_NONE}}).add([73,0,0],(t,s)=>{let d=t[0],i="MU1000 System - ";t.subarray(1).forEach((o,c)=>{let n=d+c;n===8?console.debug(`${i}LCD contrast: ${o}.`):n===18?(a(e,j)[v.xg][1]=o?126:0,console.debug(`${i}default bank: ${o?"MU100 Native":"MU Basic"}.`),e.dispatchEvent("banklevel",{mode:"xg",data:+!!o}),e.forceVoiceRefresh()):n>=64&&n<69&&[()=>{e.dispatchEvent("channelactive",o)},()=>{o<8?(e.dispatchEvent("channelmin",o<<4),console.debug(`Octavia System: Minimum CH${(o<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{o<8?(e.dispatchEvent("channelmax",(o<<4)+15),console.debug(`Octavia System: Maximum CH${(o<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{x(e,Te,!!o),console.info(`Octavia System: RS receiving ${["dis","en"][o]}abled.`)}][n-64]()})}).add([73,10,0],(t,s)=>{let d=t[0],i=`MU1000 RS${a(e,Te)?"":" (ignored)"}: `;if(d<16)switch(d){case 2:{let o=e.chRedir(0,s,!0);a(e,Te)&&(e.dispatchEvent("portrange",4),e.dispatchEvent("portstart",o)),console.info(`${i}Show CH${o+1}~CH${o+64}`);break}case 3:{let o=e.chRedir(t[1]<<5,s,!0);a(e,Te)&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",o)),console.info(`${i}Show CH${o+1}~CH${o+32}`);break}default:console.debug(`${i}unknown switch ${d} invoked.`)}else if(d<32){if(a(e,Te)){let o=e.chRedir(d-16+(a(e,ot)<<4),s,!0);e.dispatchEvent("channelactive",o)}}else if(d<36){let o=e.chRedir(d-32<<4,s,!0);a(e,Te)&&(e.dispatchEvent("portrange",1),e.dispatchEvent("portstart",o>>4),x(e,ot,d-32)),console.info(`${i}Show CH${o+1}~CH${o+16}`)}}).add([73,11,0],(t,s)=>{let d="MU1000 System - channel ",i="Octavia System - channel ",o=t[0];t.subarray(1).forEach((c,n)=>{let u=o+n;([()=>{e.setChActive(c,1),e.dispatchEvent("channelactive",c),L()&&console.debug(`${d}current part: CH${c+1}`)},()=>{c<5?(e.dispatchEvent("portrange",1<<c),console.debug(`${d}port range: ${1<<c} port(s)`)):(e.dispatchEvent("portrange",0),console.debug(`${d}port range: reset`))},()=>{c<16?(e.dispatchEvent("portstart",c),console.debug(`${i}start port: ${"ABCDEFGHIJKLMNOP"[c]}`)):(e.dispatchEvent("portstart",255),console.debug(`${i}start port: reset`))}][u]||(()=>{console.debug(`${d}unknown address: ${u}`)}))()})}).add([93,3],(t,s)=>{let d=e.chRedir(t[0],s,!0),i=`PLG-SG CH${d+1} `,o=Date.now(),c=e.modelEx.sg;if(t[1]===0){let n="",u=0;t.subarray(2).forEach((f,y)=>{y%2===0?n+=ea[f]||f.toString().padStart("0"):u+=f*13}),(o>=c.convLastSyll||c.runLineLen>=c.maxLineLen)&&(e.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),c.splitMask=o<c.convLastSyll,c.runLineLen=0),e.dispatchEvent("metacommit",{type:"SGLyrics",data:`${ta(n)}`,amend:!0,mask:c.splitMask}),c.runLineLen++,c.splitMask=!1,c.convLastSyll=o+Math.ceil(u/2)+a(e,ct),L()&&console.debug(`${i}vocals: ${n}`)}else console.warn(`Unknown PLG-SG data: ${t}`)}).add([98,96],(t,s,d,i)=>{let o=e.chRedir(t[0],s,!0),c=_[o],n=t[1];t.subarray(2).forEach((u,f)=>{let y=n+f;if(!(y<10)){if(y===10)e.resetAce();else if(y<27){let C=y+131;e.setChCc(o,C,u),!(i!=null&&i.noAce)&&u>0&&u!==64&&e.allocateAce(o,C),e.dispatchEvent("cc",{part:o,cc:C,data:u})}}})}).add([1,20],(t,s,d)=>{d===115?(e.switchMode("doc",!0),e.setPortMode(e.getTrackPort(s),1,v.doc),console.info("MIDI reset: DOC")):console.debug(`Unknown Yamaha SysEx: 67, ${d}, ${t.join(", ")}`)}).add([1,17,15,89],(t,s,d)=>{d===115?(e.setEffectType(0,24,t[0]|16),e.pushEffectType(0)):console.debug(`Unknown Yamaha SysEx: 67, ${d}, ${t.join(", ")}`)}).add([1,24],(t,s,d)=>{if(d===115){for(let i=0;i<16;i++){let o=e.chRedir(i,s,!0);e.setChCc(o,91,127)}console.info("DOC Global Reverb: on")}else console.debug(`Unknown Yamaha SysEx: 67, ${d}, ${t.join(", ")}`)}).add([126,0],(t,s,d)=>{var i,o,c;switch(t[1]){case 0:{e.dispatchEvent("metacommit",{type:"YMCSSect",data:"Disabled",raw:"Intro "}),console.debug("Yamaha Section Control is off.");break}case 127:{e.dispatchEvent("metacommit",{type:"YMCSSect",data:(i=["Intro","Main A","Main B","Fill-in AB","Fill-in BA","Ending","Blank"][t[0]-8])!=null?i:`invalid section ${t[0]}`,raw:(o=["Intro ","Main A","Main B","FillAB","FillBA","Ending","Blank "][t[0]-8])!=null?o:`ID: ${t[0]}`}),console.debug(`Yamaha Section Control switches to "${(c=["intro","main A","main B","fill-in AB","fill-in BA","ending","blank"][t[0]-8])!=null?c:`Invalid section ${t[0]}`}".`);break}default:console.debug(`Unknown YMCS section control: ${t[1]}`)}}).add([126,2],(t,s,d)=>{let i=[];for(let o=0;o<t.length;o+=2){let c=t[o]>>4,n=t[o]&15;if(c<7&&n&&n<8){let u=new Uint8Array(5);u[0]=n-1,u[1]=c-3<<2,u[2]=t[o|1],i.push(u)}}e.dispatchEvent("metacommit",{type:"ChordCtl",src:"ymcs",data:i}),console.debug("YMCS chord data: %o",i)});let h=function(t,s,d,i){},p=function(t,s){e.invokeSysExIndicator();let d=t*g.dpn,i=s[0],o=s[1];s.subarray(2).forEach((c,n)=>{let u=n+o,f=-1;u<16?([()=>{f=24},()=>{f=25},()=>{f=26},()=>{},()=>{f=28},()=>{f=29},()=>{f=30},()=>{f=31},()=>{},()=>{},()=>{},()=>{f=20},()=>{f=21},()=>{f=22},()=>{f=23},()=>{}][u]||(()=>{console.debug(`Unknown XG-style drum param ${u} on set ${t+1}.`)}))():u<32||(u<40?([()=>{f=48},()=>{f=49},!1,!1,()=>{f=52},()=>{f=53}][u-32]||(()=>{console.debug(`Unknown XG-style drum param ${u} on set ${t+1}.`)}))():u<80||([()=>{f=36}][u-80]||(()=>{console.debug(`Unknown XG-style drum param ${u} on set ${t+1}.`)}))()),f>=0?(L()&&console.debug(d,f,i,c),a(e,ce)[(d+Ee[f])*g.dnc+i]=c):L()&&console.debug(`XG-style drum param ${u} has no writes.`)})},E=function(t,s,d){e.invokeSysExIndicator();let i=t*g.dpn,o=(s<<7)+d[0];d.subarray(1).forEach((c,n)=>{let u=n+o,f=u&127,y=u>>7,C=-1;y>1&&([()=>{C=26},()=>{},()=>{C=28},()=>{C=29},()=>{C=30},()=>{},()=>{},()=>{C=31}][y-2]||(()=>{console.debug(`Unknown GS-style drum param ${y} on set ${t+1}.`)}))(),C>-1?(L()&&console.debug(i,C,f,c),a(e,ce)[(i+Ee[C])*g.dnc+f]=c):L()&&console.debug(`GS-style drum param ${y} has no writes.`)})};a(this,ee).add([76,48],(t,s,d)=>{p(0,t)}).add([76,49],(t,s,d)=>{p(1,t)}).add([76,50],(t,s,d)=>{p(2,t)}).add([76,51],(t,s,d)=>{p(3,t)}).add([76,52],(t,s,d)=>{p(4,t)}).add([76,53],(t,s,d)=>{p(5,t)}).add([76,54],(t,s,d)=>{p(6,t)}).add([76,55],(t,s,d)=>{p(7,t)}),a(this,ee).add([89,0],(t,s,d)=>{if(e.eprom){let i=t[0],o=(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);L()&&console.debug(`MU1000 EPROM trail to 0x${o.toString(16).padStart(6,"0")}, ${i} bytes.`);let c=e.eprom.data;t.subarray(4).forEach((n,u)=>{let f=u>>3,y=u&7;if(y===7)for(let C=0;C<7;C++)c[o+7*f+C]+=(n>>6-C&1)<<7;else c[o+7*f+y]=n})}}).add([89,1],(t,s,d)=>{let i=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3];L()&&console.debug(`MU1000 EPROM jump to 0x${i.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=i)}).add([89,2],(t,s,d)=>{if(e.eprom){let i=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);L()&&console.debug(`MU1000 EPROM write to 0x${i.toString(16).padStart(6,"0")}.`);let o=e.eprom.data;t.subarray(4).forEach((c,n)=>{let u=n>>3,f=n&7;if(f===7)for(let y=0;y<7;y++)o[i+7*u+y]+=(c>>6-y&1)<<7;else o[i+7*u+f]=c})}}).add([89,3],(t,s,d)=>{}),a(this,ee).add([39,48],(t,s,d)=>{}).add([43,0,0],(t,s,d)=>{e.invokeSysExIndicator();let i=[0,0,0,0],o=(c,n)=>{i[n]=c};if(t.subarray(1).forEach((c,n)=>{let u=n+t[0];[o,o,o,o,()=>{x(this,V,c*129/16383*100),e.dispatchEvent("mastervolume",a(e,V))},()=>c-64,()=>c||128,()=>c,()=>c,()=>{console.debug(`TG300 variation on cc${c}.`)}][u](c,u)}),t[0]<4){let c=0;i.forEach(n=>{c=c<<4,c+=n}),c-=1024,console.debug(`Master tune: ${c}`)}}).add([43,1,0],(t,s,d)=>{e.invokeSysExIndicator()}).add([43,2],(t,s,d)=>{e.invokeSysExIndicator();let i=e.chRedir(t[0],s,!0),o=t[1],c=_[i],n=`TG300 CH${i+1} `;t.subarray(2).forEach((u,f)=>{f<5?([()=>{},()=>{e.setChCc(i,0,u),e.pushChPrimitives(i)},()=>{e.setChCc(i,32,u),e.pushChPrimitives(i)},()=>{a(e,N)[i]=u,e.pushChPrimitives(i)},()=>{let y=e.chRedir(u,s,!0),C=a(e,G)[i];a(e,G)[i]=y,(i!==y||y!==C)&&(e.buildRchTree(),console.info(`${n}receives from CH${y+1}`))}][f+o]||(()=>{}))(u,f+o):f<21||(f<47?([()=>{a(e,se)[i]=+!u},()=>{},()=>{},()=>{a(e,D)[g.rpn*i+3]=u,a(e,B)[g.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{},()=>{e.setChCc(i,7,u)},!1,!1,()=>{e.setChCc(i,10,u||128)},!1,!1,()=>{console.debug(`${n} AC1 at cc${u}`)},()=>{console.debug(`${n} AC2 at cc${u}`)},()=>{a(e,k)[c+w[128]]=u,e.allocateAce(i,128)},()=>{a(e,k)[c+w[93]]=u},()=>{a(e,k)[c+w[91]]=u},()=>{a(e,k)[c+w[94]]=u},()=>{a(e,k)[c+w[76]]=u},()=>{a(e,k)[c+w[77]]=u},()=>{a(e,k)[c+w[74]]=u},()=>{a(e,k)[c+w[71]]=u},()=>{a(e,k)[c+w[73]]=u},()=>{a(e,k)[c+w[75]]=u},()=>{a(e,k)[c+w[72]]=u},()=>{a(e,k)[c+w[78]]=u}][f+o-21]||(()=>{}))(u,f+o):f<95||([()=>{a(e,k)[c+w[65]]=u},()=>{a(e,k)[c+w[5]]=u}][f+o-95]||(()=>{}))(u,f+o))})}).add([43,7,0],(t,s,d)=>{let i=t[0];e.setLetterDisplay(t.subarray(1),"TG300 letter display",i)}).add([43,7,1],(t,s,d)=>{x(e,re,0),x(e,Ce,Date.now()+3200),t.forEach(function(i,o){let c=o>>4,n=o&15,u=(n*3+c)*7,f=7,y=0;for(u-=n*5,c===2&&(f=2);y<f;)a(e,Ae,at)[u+y]=i>>6-y&1,y++})}),a(this,pe).add([66,18,0,0,127],(t,s,d)=>{e.switchMode("sc",!0),e.setPortMode(e.getTrackPort(s),2,v.sc),x(e,K,e.KARAOKE_NONE),a(e,Re).fill(0),console.info(`GS system to ${["single","dual"][t[0]]} mode.`)}).add([66,18,64,0],(t,s,d)=>{switch(t[0]){case 127:{e.switchMode("gs",!0),e.setPortMode(e.getTrackPort(s),4,v.gs),x(e,K,e.KARAOKE_NONE),a(e,Re).fill(0),console.info("MIDI reset: GS");break}default:{e.invokeSysExIndicator();let i=[0,0,0,0],o=(c,n)=>{i[n]=c};if(t.subarray(1).forEach((c,n)=>{let u=n+t[0];[o,o,o,o,f=>{x(this,V,f*129/16383*100),e.dispatchEvent("mastervolume",a(e,V))},f=>{},f=>{}][u](c,n)}),t[0]<4){let c=0;i.forEach(n=>{c=c<<4,c+=n}),c-=1024,console.debug(`Master tune: ${c}`)}}}}).add([66,18,64,1],(t,s,d)=>{e.invokeSysExIndicator();let i=t[0];if(i<16){let o="".padStart(i," ");t.subarray(1).forEach((c,n)=>{o+=String.fromCharCode(Math.max(32,c))}),o=o.padEnd(16," "),console.debug(`GS patch name: ${o}`)}else i<48||(i<65?t.subarray(1).forEach((o,c)=>{let n=`GS ${i+c>55?"chorus":"reverb"} `;([()=>{console.info(`${n}type: ${Ot[o]}`),e.setEffectType(0,40,o),e.pushEffectType(0)},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${n}predelay: ${o}ms`)},()=>{console.info(`${n}type: ${ia[o]}`),e.setEffectType(1,40,16+o),e.pushEffectType(1)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${n}to reverb: ${le(o)}`)},()=>{console.debug(`${n}to delay: ${le(o)}`)}][i+c-48]||(()=>{}))()}):i<80?console.debug(`Unknown GS patch address: ${i}`):i<91?t.subarray(1).forEach((o,c)=>{let n="GS delay ";([()=>{console.info(`${n}type: ${na[o]}`),e.setEffectType(2,40,32+o),e.pushEffectType(2)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${n}to reverb: ${le(o)}`)}][i+c-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${i}`))}).add([66,18,64,2],(t,s,d)=>{let i="GS EQ ";t.subarray(1).forEach((o,c)=>{([()=>{console.debug(`${i}low freq: ${[200,400][o]}Hz`)},()=>{console.debug(`${i}low gain: ${o-64}dB`)},()=>{console.debug(`${i}high freq: ${[3e3,6e3][o]}Hz`)},()=>{console.debug(`${i}high gain: ${o-64}dB`)}][t[0]+c]||function(){console.warn(`Unknown GS EQ address: ${t[0]+c}`)})()})}).add([66,18,64,3],(t,s,d)=>{e.invokeSysExIndicator();let i="GS EFX ",o=function(c,n){let u=ca(a(e,fe).subarray(10,12),n,c);u&&console.debug(`${i}${It(a(e,fe).subarray(10,12))} ${u}`)};t.subarray(1).forEach((c,n)=>{([()=>{e.setEffectTypeRaw(3,!1,32+c),e.pushEffectType(3)},()=>{e.setEffectTypeRaw(3,!0,c),console.info(`${i}type: ${It(a(e,fe).subarray(10,12))}`),e.pushEffectType(3)},!1,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,()=>{console.debug(`${i}to reverb: ${le(c)}dB`)},()=>{console.debug(`${i}to chorus: ${le(c)}dB`)},()=>{console.debug(`${i}to delay: ${le(c)}dB`)},!1,()=>{console.debug(`${i}1 source: ${c}`),c&&c<96&&e.allocateAceAll(c)},()=>{console.debug(`${i}1 depth: ${c-64}`)},()=>{console.debug(`${i}2 source: ${c}`),c&&c<96&&e.allocateAceAll(c)},()=>{console.debug(`${i}2 depth: ${c-64}`)},()=>{console.debug(`${i}to EQ: ${c?"ON":"OFF"}`)}][t[0]+n]||function(u,f){console.warn(`Unknown GS EFX address: ${f}`)})(c,t[0]+n)})}).add([66,18,65],(t,s,d)=>{E((t[0]>>4)+1<<1,t[0]&15,t.subarray(1))}).add([66,18,72],(t,s,d)=>{let i=(t[0]&127)<<7|t[1]&127;console.debug(i,oa(t.subarray(2)))}).add([69,18,16],(t,s,d)=>{var i;switch(t[0]){case 0:{let o=t[1];e.setLetterDisplay(t.subarray(2),"GS display text",o);break}case 8:{let o=t[1],c=e.modelEx.sc;t.subarray(2).forEach((n,u)=>{([()=>{c.showBar=!(n&1),c.invBar=n>>1&1,c.invDisp=n>>2&1},()=>{c.peakHold=n<4?n:1}][u+o]||(()=>{console.debug("Unsupported GS display type SysEx.")}))()});break}case 32:{x(e,Ce,Date.now()+3200),t[1]===0&&(t[2]?(x(e,re,Math.max(Math.min(t[2]-1,9),0)),L()&&console.debug(`GS switch display page ${t[2]-1}.`)):(x(e,re,0),x(e,Ce,Date.now()),L()&&console.debug("GS disable display page.")));break}default:if(t[0]<6){a(e,re)>9&&x(e,re,0);let o=t[0]-1<<1|t[1]>>6;a(e,re)===o&&x(e,Ce,Date.now()+3200),(i=a(e,me)[o])!=null&&i.length||(a(e,me)[o]=new Uint8Array(256));let c=a(e,me)[o];L()&&console.debug(`GS frame draw page ${o}.`);let n=t[1]&63;t.subarray(2).forEach(function(f,y){let C=y+n,P=C>>4,I=C&15,R=(I*4+P)*5,Me=5,q=0;for(R-=I*4,P===3&&(Me=1);q<Me;)c[R+q]=f>>4-q&1,q++})}else console.warn(`Unknown GS display section: ${t[0]}`)}}).add([69,18,32],(t,s,d)=>{let i=t[0],o=t[1],c=t.subarray(2);if(i>>4){console.warn(`SC-8850 partial screen dump out of bounds: invalid bundle.
`,t);return}let n=o+c.length,u=o*6-(o*2428>>16<<1),f=n*6-(n*2428>>16<<1);if(u>640){console.warn(`SC-8850 partial screen dump out of bounds: invalid buffer range.
`,t);return}f>640&&(console.info(`SC-8850 partial screen dump out of bounds: invalid buffer end, automatically restricted.
`,t),f=640);let y=new Uint8Array(f-u);c.forEach((I,R)=>{let Me=R+o,q=(Me*2428&65535)*27>>16===26,Tt=Me*6-(Me*2428>>16<<1),kt=q?2:0;for(;kt<6;)y[Tt+(5-kt)]=I>>kt&1,kt++});let C=i*108+o,P=C*6-(C*2428>>16<<1);e.dispatchEvent("screen",{type:"sc8850",offset:P,data:y}),L()&&console.debug(`SC-8850 screen dump: bundle ${i+1}, range ${u}~${f}`)});let m=function(t,s,d){e.invokeSysExIndicator();let i=t[0],o=_[s],c=et[s],n=`GS CH${s+1} `;i<3?(t.subarray(1).forEach((u,f)=>{[()=>{a(e,k)[o+w[0]]=u,e.pushChPrimitives(s)},()=>{a(e,N)[s]=u},()=>{let y=0;u<16?y=e.chRedir(u,d,!0):y=g.ch;let C=a(e,G)[s];a(e,G)[s]=y,(s!==y||y!==C)&&(e.buildRchTree(),console.info(`${n}receives from CH${y+1}`))}][i+f]()}),e.pushChPrimitives(s)):i<19||(i<44?t.subarray(1).forEach((u,f)=>{([()=>{a(e,se)[s]=+!u},!1,()=>{e.setChType(s,u<<1,v.gs),console.debug(`${n}type: ${u?"drum ":"melodic"}${u||""}`)},()=>{a(e,D)[c+3]=u,a(e,B)[g.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},!1,()=>{a(e,k)[o+w[7]]=u},!1,!1,()=>{a(e,k)[o+w[10]]=u||128},!1,!1,()=>{console.debug(`${n}CC 1: cc${u}`)},()=>{console.debug(`${n}CC 2: cc${u}`)},()=>{a(e,k)[o+w[93]]=u},()=>{a(e,k)[o+w[91]]=u},!1,!1,()=>{a(e,D)[c+1]=u,a(e,B)[g.rpnt*s+1]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{a(e,D)[c+2]=u,a(e,B)[g.rpnt*s+1]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{a(e,k)[o+w[94]]=u}][i+f-19]||(()=>{}))()}):i<76||console.debug(`Unknown GS part address: ${i}`))},$=function(t,s){let d=t[0],i=`GS CH${s+1} `;d<2?t.subarray(1).forEach((o,c)=>{[()=>{e.setChCc(s,32,o)},()=>{}][d+c]()}):d<32?console.warn(`Unknown GS misc address: ${d}`):d<35?t.subarray(1).forEach((o,c)=>{[()=>{console.debug(`${i}EQ: o${["ff","n"][o]}`)},()=>{},()=>{console.debug(`${i}EFX: o${["ff","n"][o]}`),e.setChEffectSink(s,o?3:0)}][d+c-32]()}):console.warn(`Unknown GS misc address: ${d}`)};a(this,pe).add([66,18,64,16],(t,s)=>{m(t,e.chRedir(9,s,!0),s)}).add([66,18,64,17],(t,s)=>{m(t,e.chRedir(0,s,!0),s)}).add([66,18,64,18],(t,s)=>{m(t,e.chRedir(1,s,!0),s)}).add([66,18,64,19],(t,s)=>{m(t,e.chRedir(2,s,!0),s)}).add([66,18,64,20],(t,s)=>{m(t,e.chRedir(3,s,!0),s)}).add([66,18,64,21],(t,s)=>{m(t,e.chRedir(4,s,!0),s)}).add([66,18,64,22],(t,s)=>{m(t,e.chRedir(5,s,!0),s)}).add([66,18,64,23],(t,s)=>{m(t,e.chRedir(6,s,!0),s)}).add([66,18,64,24],(t,s)=>{m(t,e.chRedir(7,s,!0),s)}).add([66,18,64,25],(t,s)=>{m(t,e.chRedir(8,s,!0),s)}).add([66,18,64,26],(t,s)=>{m(t,e.chRedir(10,s,!0),s)}).add([66,18,64,27],(t,s)=>{m(t,e.chRedir(11,s,!0),s)}).add([66,18,64,28],(t,s)=>{m(t,e.chRedir(12,s,!0),s)}).add([66,18,64,29],(t,s)=>{m(t,e.chRedir(13,s,!0),s)}).add([66,18,64,30],(t,s)=>{m(t,e.chRedir(14,s,!0),s)}).add([66,18,64,31],(t,s)=>{m(t,e.chRedir(15,s,!0),s)}).add([66,18,64,64],(t,s)=>{$(t,e.chRedir(9,s,!0))}).add([66,18,64,65],(t,s)=>{$(t,e.chRedir(0,s,!0))}).add([66,18,64,66],(t,s)=>{$(t,e.chRedir(1,s,!0))}).add([66,18,64,67],(t,s)=>{$(t,e.chRedir(2,s,!0))}).add([66,18,64,68],(t,s)=>{$(t,e.chRedir(3,s,!0))}).add([66,18,64,69],(t,s)=>{$(t,e.chRedir(4,s,!0))}).add([66,18,64,70],(t,s)=>{$(t,e.chRedir(5,s,!0))}).add([66,18,64,71],(t,s)=>{$(t,e.chRedir(6,s,!0))}).add([66,18,64,72],(t,s)=>{$(t,e.chRedir(7,s,!0))}).add([66,18,64,73],(t,s)=>{$(t,e.chRedir(8,s,!0))}).add([66,18,64,74],(t,s)=>{$(t,e.chRedir(10,s,!0))}).add([66,18,64,75],(t,s)=>{$(t,e.chRedir(11,s,!0))}).add([66,18,64,76],(t,s)=>{$(t,e.chRedir(12,s,!0))}).add([66,18,64,77],(t,s)=>{$(t,e.chRedir(13,s,!0))}).add([66,18,64,78],(t,s)=>{$(t,e.chRedir(14,s,!0))}).add([66,18,64,79],(t,s)=>{$(t,e.chRedir(15,s,!0))}),a(this,we).add([54,65],(t,s)=>{let d=a(e,U).x5===81?"05rw":"x5d";e.switchMode(d,!0),e.setPortMode(e.getTrackPort(s),1,v[d]);let i=t[t.length-1],o=t.subarray(0,t.length-1),c=Ne(o);c!==i&&(console.info(`X5D multi parameters checksum mismatch! Expected ${c}, got ${i}.`),console.debug(t));let n=(t[1]<<7)+t[0],u=(t[3]<<7)+t[2],f=e.chRedir(n&15,s,!0),y=_[f];[()=>{u<1||(u<101?(e.setChType(f,e.CH_MELODIC,v.x5d),a(e,N)[f]=u-1,a(e,k)[y+w[0]]=a(e,U).x5):u<229?(e.setChType(f,e.CH_MELODIC,v.x5d),a(e,N)[f]=u-101,a(e,k)[y+w[0]]=56):(e.setChType(f,e.CH_DRUMS,v.x5d),a(e,N)[f]=ba[u-229]||0,a(e,k)[y+w[0]]=62)),e.pushChPrimitives(f)},()=>{a(e,k)[y+w[7]]=u},()=>{u<31&&(a(e,k)[y+w[10]]=Math.round((u-15)*4.2+64))},()=>{a(e,k)[y+w[93]]=pt(u)},()=>{a(e,k)[y+w[91]]=pt(u)},()=>{a(e,D)[f*g.rpn+3]=u>8191?u-16320:64+u,a(e,B)[g.rpnt*f+2]=1,e.dispatchEvent("pitch",{part:f,pitch:e.getPitchShift(f)})},()=>{a(e,D)[f*g.rpn+1]=u>8191?u-16320:64+u,a(e,B)[g.rpnt*f+1]=1,e.dispatchEvent("pitch",{part:f,pitch:e.getPitchShift(f)})},()=>{u>0&&(a(e,D)[f*g.rpn]=u,a(e,B)[g.rpnt*f]=1,e.dispatchEvent("pitch",{part:f,pitch:e.getPitchShift(f)}))},()=>{}][n>>4]()}).add([54,76,0],(t,s)=>{e.invokeSysExIndicator();let d=a(e,U).x5===81?"05rw":"x5d";e.switchMode(d),e.setPortMode(e.getTrackPort(s),1,v[d]);let i="",o=a(e,U).x5,c=0,n=0,u="MSB\tPRG\tLSB\tNME";ye(t,function(f,y){if(y<16400){let C=y%164;switch(!0){case C<10:{f>31&&(i+=String.fromCharCode(f));break}case C===10:break;case C===11:{u+=`
${o}	${c}	${n}	${i.trim().replace("Init Voice","")}`,c++,i="";break}}c>99&&(o=90,c=0)}}),e.userBank.clearRange({msb:a(e,U).x5,prg:[0,99],lsb:0}),e.userBank.load(u),L()&&console.debug(u),e.forceVoiceRefresh()}).add([54,77,0],(t,s)=>{e.invokeSysExIndicator();let d=a(e,U).x5===81?"05rw":"x5d";e.switchMode(d),e.setPortMode(e.getTrackPort(s),1,v[d]);let i="",o=90,c=0,n=0,u="MSB\tPRG\tLSB\tNME";ye(t,function(f,y){if(y<13600){let C=y%136;switch(!0){case C<10:{f>31&&(i+=String.fromCharCode(f));break}case C===11:{u+=`
${o}	${c}	${n}	${i.trim().replace("Init Combi","")}`,c++,i="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(u),L()&&console.debug(u),e.forceVoiceRefresh()}).add([54,78],(t,s)=>{let d=a(e,U).x5===81?"05rw":"x5d";e.switchMode(d),e.setPortMode(e.getTrackPort(s),1,v[d]),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][t[0]]} mode.`)}).add([54,85],(t,s)=>{e.invokeSysExIndicator();let d=a(e,U).x5===81?"05rw":"x5d";e.switchMode(d),e.setPortMode(e.getTrackPort(s),1,v[d]),ye(t,(i,o)=>{o>0&&o<3&&(e.setEffectType(o-1,44,i),e.pushEffectType(o-1))})}).add([54,104],(t,s)=>{e.invokeSysExIndicator();let d=a(e,U).x5===81?"05rw":"x5d";e.switchMode(d,!0);let i=e.getTrackPort(s);if(a(e,z)[i]&&a(e,z)[i]!==v[d])if(a(e,xe).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${s}. Port ${String.fromCharCode(65+i)} mode "${Y[a(e,z)[i]]}" mismatch, should be "${d}".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);e.setPortMode(i,1,v[d]),ye(t,function(o,c,n,u){if(c<192){let f=e.chRedir(Math.floor(c/12),s,!0),y=_[f];switch(c%12){case 0:{o<128?(e.setChType(f,e.CH_MELODIC,v.x5d),a(e,k)[y+w[0]]=a(e,U).x5,a(e,N)[f]=o):(e.setChType(f,e.CH_DRUMS,v.x5d),a(e,k)[y+w[0]]=62,a(e,N)[f]=ba[o-128]),o>0&&e.setChActive(f,1),e.pushChPrimitives(f);break}case 1:{a(e,k)[y+w[7]]=o;break}case 2:{a(e,D)[f*g.rpn+3]=o>127?o-192:64+o,a(e,B)[g.rpnt*f+2]=1,e.dispatchEvent("pitch",{part:f,pitch:e.getPitchShift(f)});break}case 3:{a(e,D)[f*g.rpn+1]=o>127?o-192:64+o,a(e,B)[g.rpnt*f+1]=1,e.dispatchEvent("pitch",{part:f,pitch:e.getPitchShift(f)});break}case 4:{o<31&&(a(e,k)[y+w[10]]=Math.round((o-15)*4.2+64));break}case 5:{let C=o>>4,P=o&15;a(e,k)[y+w[91]]=pt(P),a(e,k)[y+w[93]]=pt(C);break}case 10:{a(e,O)[f]||(a(e,k)[y+w[0]]=o>>6?56:a(e,U).x5,e.pushChPrimitives(f));break}case 11:{let C=e.chRedir(o&15,s,!0),P=o>>4;a(e,G)[f]=o,(C!==f||P)&&console.info(`X5D Part CH${f+1} receives from CH${C+1}.`)}}}else{let f=e.chRedir(c-192,s,!0)}}),e.buildRchTree()}),a(this,pe).add([22,18,127],(t,s,d)=>{e.switchMode("mt32",!0),e.setPortMode(e.getTrackPort(s),1,v.mt32),x(e,K,e.KARAOKE_NONE),e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(t,s,d)=>{e.switchMode("mt32");let i=e.chRedir(d,s,!0),o=t[1];t.subarray(2).forEach((c,n)=>{let u=n+o;a(e,Oe)[u+(i-1)*16]=c,([!1,()=>{let f=a(e,Oe)[i-1<<4];if(f<3){if(a(e,ue)[i]=1,f===2)for(let y=0;y<name.length;y++)a(e,ve)[(i-1)*g.cmt+y]=a(e,Ie)[c*g.cmt+y];else{let y=e.baseBank.get(0,c+(f<<6),127,"mt32").name;for(let C=0;C<y.length;C++)a(e,ve)[(i-1)*g.cmt+C]=y.charCodeAt(C)}e.pushChPrimitives(i)}},()=>{a(e,D)[i*g.rpn+3]=c+40,a(e,B)[g.rpnt*i+2]=1},()=>{a(e,D)[i*g.rpn+1]=c+14,a(e,B)[g.rpnt*i+1]=1},()=>{a(e,D)[i*g.rpn]=c,a(e,B)[g.rpnt*i]=1},!1,()=>{e.setChCc(i,91,c?127:0)},!1,()=>{e.setChCc(i,7,c)},()=>{e.setChCc(i,10,Math.ceil(c*9.05))}][u]||(()=>{}))()})}).add([22,18,1],(t,s,d)=>{e.switchMode("mt32");let i=d&7;console.debug(`MT-32 slot #${d+1} Drum: ${t}`);let o=t[0]<<7|t[1];t.subarray(2).forEach((c,n)=>{let u=n+o,f=(u>>2)+24,y=u&3,C=i*g.dpn;if(L()&&console.debug(`MT-32 temp drum note ${f} param ${y}: ${c}`),f<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${f}`);return}[()=>{},()=>{a(e,ce)[(C+Ee[26])*g.dnc+f]=Math.round(c*1.27)},()=>{a(e,ce)[(C+Ee[26])*g.dnc+f]=c*9+1&127},()=>{a(e,ce)[(C+Ee[26])*g.dnc+f]=c?127:0}][y]()})}).add([22,18,2],(t,s,d)=>{e.switchMode("mt32");let i=e.chRedir(d,s,!0),o=t[1]+(t[0]<<7);o<10&&(a(e,ue)[i]=1),t.subarray(2).forEach((c,n)=>{let u=n+o;u<14&&(a(e,ve)[(i-1)*g.cmt+u]=c)}),e.pushChPrimitives(i)}).add([22,18,3],(t,s,d)=>{e.switchMode("mt32");let i=d&7;if(t[0]){let o=(t[0]-1<<7)+t[1]-16;t.subarray(2).forEach((c,n)=>{let u=n+o,f=(u>>2)+24,y=u&3,C=i*g.dpn;if(L()&&console.debug(`MT-32 dev drum note ${f} param ${y}: ${c}`),f<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${f}`);return}[()=>{},()=>{a(e,ce)[(C+Ee[26])*g.dnc+f]=Math.round(c*1.27)},()=>{a(e,ce)[(C+Ee[26])*g.dnc+f]=c*9+1&127},()=>{a(e,ce)[(C+Ee[26])*g.dnc+f]=c?127:0}][y]()})}else{let o=t[1];t.subarray(2).forEach((c,n)=>{let u=n+o;a(e,Oe)[u]=c;let f=e.chRedir(1+(u>>4),s,!0),y=u&15;([!1,()=>{let C=a(e,Oe)[f-1<<4];if(C<3)if(a(e,ue)[f]=1,C===2)for(let P=0;P<name.length;P++)a(e,ve)[(f-1)*g.cmt+P]=a(e,Ie)[c*g.cmt+P];else{let P=e.baseBank.get(0,c+(C<<6),127,"mt32").name;for(let I=0;I<P.length;I++)a(e,ve)[(f-1)*g.cmt+I]=P.charCodeAt(I)}e.pushChPrimitives(f)},()=>{a(e,D)[f*g.rpn+3]=c+40,a(e,B)[g.rpnt*f+2]=1},()=>{a(e,D)[f*g.rpn+1]=c+14,a(e,B)[g.rpnt*f+1]=1},()=>{a(e,D)[f*g.rpn]=c,a(e,B)[g.rpnt*f]=1},!1,()=>{e.setChCc(f,91,c?127:0)},!1,()=>{e.setChCc(f,7,c)},()=>{e.setChCc(f,10,Math.ceil(c*9.05))}][y]||(()=>{}))()})}}).add([22,18,4],(t,s,d)=>{e.switchMode("mt32");let i=t[1]+(t[0]<<7),o=[];t.subarray(2).forEach((c,n)=>{let u=n+i,f=e.chRedir(Math.floor(u/246+1),s,!0),y=u%246;y<14&&(a(e,ve)[(f-1)*g.cmt+y]=c),y<10&&(a(e,ue)[f]=1),o.indexOf(f)<0&&o.push(f)}),o.forEach(c=>{e.pushChPrimitives(c)})}).add([22,18,5],(t,s,d)=>{e.switchMode("mt32");let i=(t[0]<<7)+t[1];t.subarray(2).forEach((o,c)=>{let n=i+c,u=Math.floor(n/8),f=n&7,y=u*8;a(e,nt)[n]=o,([!1,()=>{let C=a(e,nt)[y];if(C<3){let P="";if(C===2){let R=g.cmt*u;P=`MT-m:${o.toString().padStart(3,"0")}`}else P=e.baseBank.get(0,o+(C<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:u});let I=`MSB	LSB	PRG	NME
49	127	${u}	${P}`;e.userBank.load(I,!0)}}][f]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(t,s,d)=>{e.switchMode("mt32");let i=((t[0]&1)<<7)+t[1],o=t[0]>>1,c=!1;if(t.subarray(2).forEach((n,u)=>{let f=i+u;f<g.cmt&&(a(e,Ie)[o*g.cmt+f]=n,c=!0)}),c){e.userBank.clearRange({msb:0,lsb:127,prg:o});let n=`MSB	LSB	PRG	NME
49	127	${o}	MT-m:${o}`;e.userBank.load(n,!0)}e.forceVoiceRefresh()}).add([22,18,16],(t,s,d)=>{e.switchMode("mt32");let i=t[1],o=!1,c=function(n,u){a(e,G)[u-12]=n,o=!0};t.subarray(2).forEach((n,u)=>{let f=u+i;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,c,c,c,c,c,c,c,c,c,()=>{x(e,V,n),e.dispatchEvent("mastervolume",a(e,V))}][f]||(()=>{}))(n,u)}),o&&e.buildRchTree()}).add([22,18,32],(t,s,d)=>{e.switchMode("mt32");let i=t[1],o=" ".repeat(i);t.subarray(2).forEach(c=>{c>31?o+=String.fromCharCode(c):o+=" "}),x(e,De,o.padStart(20," ")),x(e,Le,Date.now()+3200)}).add([22,18,82],(t,s)=>{let d=e.chRedir(0,s,!0);for(let i=0;i<16;i++)a(e,J).ano(d+i),i&&i<10&&(a(e,N)[d+i]=Dt[i-1]);console.info("MT-32 alt reset complete.")}),a(this,we).add([66,0],(t,s)=>{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(s),2,v.ns5r),x(e,K,e.KARAOKE_NONE),console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][t[0]]} mode.`)}).add([66,1],(t,s)=>{let d=["ns5r","05rw"][t[0]];e.switchMode(d,!0),e.setPortMode(e.getTrackPort(s),2,v[d]),x(e,K,e.KARAOKE_NONE)}).add([66,18,0,0],(t,s)=>{let d=t[0];switch(d){case 124:case 126:case 127:{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(s),2,v.ns5r),x(e,K,e.KARAOKE_NONE);break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset on drum kit ${t[1]}.`);break}default:if(d<10){let i=[0,0,0,0],o=(c,n)=>{i[n]=c};if(t.subarray(1).forEach((c,n)=>{[o,o,o,o,()=>{x(e,V,c*129/16383*100),e.dispatchEvent("mastervolume",a(e,V))},()=>c-64,()=>c-64,()=>{},()=>{},()=>{}][d+n]()}),t[0]<4){let c=0;i.forEach(n=>{c=c<<4,c+=n}),c-=1024,console.debug(`Master tune: ${c}`)}}}}).add([66,18,0,1],(t,s)=>{}).add([66,18,0,2],(t,s)=>{}).add([66,18,1],(t,s)=>{e.invokeSysExIndicator();let d=e.chRedir(t[0],s,!0),i=_[d],o=t[1],c=`NS5R CH${d+1} `;t.subarray(2).forEach((n,u)=>{let f=o+u;f<3?([()=>{a(e,k)[i+w[0]]=n||yt.bank0,e.pushChPrimitives(d)},()=>{a(e,k)[i+w[32]]=n,e.pushChPrimitives(d)},()=>{a(e,N)[d]=n}][f](),e.pushChPrimitives(d)):f<8||(f<14?[()=>{let y=e.chRedir(n,s,!0),C=a(e,G)[d];a(e,G)[d]=y,(d!==y||y!==C)&&(e.buildRchTree(),console.info(`${c}receives from CH${y+1}`))},()=>{a(e,se)[d]=+!n},()=>{e.setChType(d,n,v.ns5r),console.debug(`${c}type: ${ut[n]}`)},()=>{a(e,D)[g.rpn*d+3]=n,a(e,B)[g.rpnt*d+2]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)})},()=>{},()=>{}][f-8]():f<16||(f<33?[()=>{a(e,k)[i+w[7]]=n},()=>{a(e,k)[i+w[11]]=n},()=>{},()=>{},()=>{a(e,k)[i+w[10]]=n||128},()=>{},()=>{},()=>{a(e,k)[i+w[93]]=n},()=>{a(e,k)[i+w[91]]=n},()=>{a(e,k)[i+w[76]]=n},()=>{a(e,k)[i+w[77]]=n},()=>{a(e,k)[i+w[78]]=n},()=>{a(e,k)[i+w[74]]=n},()=>{a(e,k)[i+w[71]]=n},()=>{a(e,k)[i+w[73]]=n},()=>{a(e,k)[i+w[75]]=n},()=>{a(e,k)[i+w[72]]=n}][f-16]():f<112||f<114&&[()=>{a(e,k)[i+w[5]]=n},()=>{a(e,k)[i+w[65]]=n}][f-112]()))})}).add([66,18,8,0],(t,s)=>{let d=t[0];if(d<32)e.setLetterDisplay(t.subarray(1,33),"NS5R letter display");else{let i=d-32;x(e,Ce,Date.now()+3200),x(e,re,10);let o=t.subarray(1),c=4;o.forEach(function(n,u){let f=u+i,y=f>>4,C=f&15;if(f<80){let P=y<c?n:n>>3,I=0,R=y<c?6:3;for(;P>0;)a(e,Ae,at)[C*32+y*7+(R-I)]=P&1,P=P>>1,I++}})}}).add([66,18,48],(t,s,d)=>{p(0,t)}).add([66,18,49],(t,s,d)=>{p(1,t)}).add([66,18,50],(t,s,d)=>{p(2,t)}).add([66,18,51],(t,s,d)=>{p(3,t)}).add([66,18,52],(t,s,d)=>{p(4,t)}).add([66,18,53],(t,s,d)=>{p(5,t)}).add([66,18,54],(t,s,d)=>{p(6,t)}).add([66,18,55],(t,s,d)=>{p(7,t)}).add([66,52],(t,s)=>{e.switchMode("ns5r"),x(e,K,e.KARAOKE_NONE);let d="";ye(t,(i,o)=>{o<8?(i>31&&(d+=String.fromCharCode(i)),o===7&&(e.aiEfxName=d)):o<10&&(e.setEffectType(o-8,44,i),e.pushEffectType(o-8))})}).add([66,53],(t,s)=>{e.invokeSysExIndicator(),e.switchMode("ns5r"),x(e,K,e.KARAOKE_NONE);let d="",i=t[t.length-1],o=t.subarray(0,t.length-1),c=Ne(o);c!==i&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${c}, got ${i}.`),console.debug(t));let n=e.getTrackPort(s);if(a(e,z)[n]&&a(e,z)[n]!==v.ns5r)if(a(e,xe).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${s}. Port ${String.fromCharCode(65+n)} mode "${Y[a(e,z)[n]]}" mismatch, should be "ns5r".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+n)}.`);e.setPortMode(n,2,v.ns5r),ye(o,function(u,f){switch(!0){case f<2944:{let y=e.chRedir(Math.floor(f/92),s,!0),C=_[y];switch(f%92){case 0:{a(e,k)[C+w[0]]=u,e.pushChPrimitives(y),e.pushChPrimitives(y);break}case 1:{a(e,k)[C+w[32]]=u,!u&&!a(e,k)[C+w[0]]&&(a(e,k)[C+w[0]]=yt.bank0),e.pushChPrimitives(y);break}case 2:{a(e,N)[y]=u,u>0&&e.setChActive(y,1);break}case 3:{let P=e.chRedir(u,s,!0);a(e,G)[y]=P,y!==P&&console.info(`NS5R CH${y+1} receives from CH${P+1}.`);break}case 7:{a(e,O)[y]=u,e.pushChPrimitives(y);break}case 8:{a(e,D)[y*g.rpn+3]=u<40||u>88?u+(u>63?-192:64):u,a(e,B)[g.rpnt*y+2]=1,e.dispatchEvent("pitch",{part:y,pitch:e.getPitchShift(y)});break}case 9:case 10:{a(e,k)[C+w[7]]=u;break}case 11:{a(e,k)[C+w[11]]=u;break}case 14:{a(e,k)[C+w[10]]=u||128;break}case 19:{a(e,k)[C+w[93]]=u;break}case 20:{a(e,k)[C+w[91]]=u;break}case 84:{a(e,k)[C+w[65]]=u;break}case 85:{a(e,k)[C+w[5]]=u;break}}break}case f<3096:break;case f<3134:{let y=f-3096;y<8?(u>31&&(d+=String.fromCharCode(u)),y===7&&(e.aiEfxName=d)):y<10&&(e.setEffectType(y-8,44,u),e.pushEffectType(y-8));break}case f<8566:break}}),e.buildRchTree()}).add([66,54],(t,s)=>{e.invokeSysExIndicator(),e.switchMode("ns5r");let d="",i=80,o=0,c=0,n="MSB\tPRG\tLSB\tNME";ye(t,function(u,f){let y=f%158;switch(!0){case y<10:{u>31&&(d+=String.fromCharCode(u));break}case y===10:break;case y===11:{i=u&127;break}case y===12:{c=u&127;break}case y===13:{n+=`
${i}	${o}	${c}	${d.trim().replace("Init Voice","")}`,o++,d="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(n),L()&&console.debug(n),e.forceVoiceRefresh()}).add([66,55],(t,s)=>{e.invokeSysExIndicator(),e.switchMode("ns5r");let d="",i=88,o=0,c=0,n="MSB\tPRG\tLSB\tNME";ye(t,function(u,f){let y=f%126;switch(!0){case y<10:{u>31&&(d+=String.fromCharCode(u));break}case y===11:break;case y===12:break;case y===13:{n+=`
${i}	${o}	${c}	${d.trim().replace("Init Combi","")}`,o++,d="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(n),L()&&console.debug(n),e.forceVoiceRefresh()}).add([66,125],(t,s,d)=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][t[0]]||"white")}).add([66,127],(t,s,d)=>{let i=t[t.length-1],o=t.subarray(0,t.length-1),c=Ne(o);c!==i&&(console.info(`NS5R screen dump checksum mismatch! Expected ${c}, got ${i}.`),console.debug(t));let n=new Uint8Array(5760);ye(t,(u,f,y)=>{if(f<720)for(let C=0;C<8;C++)n[f*8+C]=u>>7-C&1}),e.dispatchEvent("screen",{type:"ns5r",data:n})}).add([76],(t,s,d)=>{a(e,we).run([66,...t],s,d)}),a(e,qe).add([16,0,8,0],(t,s,d)=>{let i=(t[2]<<4)+t[3],o="K11 ";([()=>{e.switchMode("k11",!0),e.setPortMode(e.getTrackPort(s),2,v.k11),x(e,K,e.KARAOKE_NONE),a(e,j)[v.k11][1]=i?4:0,console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,i),console.debug(`${o}reverb type: ${i}`),e.pushEffectType(0)},()=>{console.debug(`${o}reverb time: ${i}`)},()=>{console.debug(`${o}reverb time: ${i}`)},()=>{console.debug(`${o}reverb predelay: ${i}`)},()=>{console.debug(`${o}reverb predelay: ${i}`)},()=>{console.debug(`${o}depth high: ${i}`)},()=>{console.debug(`${o}depth high: ${i}`)},()=>{console.debug(`${o}depth low: ${i}`)},()=>{console.debug(`${o}depth low: ${i}`)}][t[0]]||(()=>{}))()}).add([16,0,8,1],(t,s,d)=>{e.invokeSysExIndicator();let i=e.chRedir(t[1],s,!0),o=_[i],c=et[i],n=(t[3]<<4)+t[4],u=`GMega CH${i+1} `;([()=>{n<128?(e.setChType(i,e.CH_MELODIC,v.k11),a(e,k)[o+w[0]]=0,a(e,N)[i]=n):(e.setChType(i,e.CH_DRUMS,v.k11),a(e,N)[i]=n-128),e.pushChPrimitives(i)},()=>{let f=e.chRedir(n,s,!0),y=a(e,G)[i];a(e,G)[i]=f,(i!==f||f!==y)&&(e.buildRchTree(),console.info(`${u}receives from CH${f+1}`))},()=>{a(e,k)[o+w[7]]=n},()=>{uupThis.setChActive(i,n)},()=>{a(e,k)[o+w[10]]=n},()=>{a(e,D)[c+3]=n+40,a(e,B)[g.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{a(e,D)[c+1]=n>>1,a(e,D)[c+2]=n&1,a(e,B)[g.rpnt*i+1]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{a(e,k)[o+w[91]]=n?127:0},()=>{},()=>{a(e,k)[o+w[74]]=n},()=>{a(e,k)[o+w[73]]=n},()=>{a(e,k)[o+w[72]]=n}][t[0]]||(()=>{}))()}).add([16,0,9,0],(t,s,d)=>{e.invokeSysExIndicator();let i=(t[2]<<4)+t[3],o="GMLX ";([()=>{console.debug(`${o}reverb type: ${i}`)},()=>{console.debug(`${o}reverb time: ${i}`)},()=>{console.debug(`${o}reverb predelay: ${i}`)},()=>{console.debug(`${o}depth high: ${i}`)},()=>{console.debug(`${o}depth low: ${i}`)}][t[0]]||(()=>{}))()}).add([16,0,9,3],(t,s,d)=>{e.invokeSysExIndicator();let i=(t[2]<<4)+t[3],o=e.chRedir(t[1],s,!0),c=_[o],n=`GMLX CH${o+1} `;[()=>{i<128?(e.setChType(o,e.CH_MELODIC,v.k11),a(e,k)[c+w[0]]=0,a(e,k)[c+w[32]]=0,a(e,N)[o]=i):i<160?(e.setChType(o,e.CH_MELODIC,v.k11),a(e,k)[c+w[0]]=0,a(e,k)[c+w[32]]=7,a(e,N)[o]=i-100):(e.setChType(o,e.CH_DRUMS,v.k11),a(e,k)[c+w[0]]=122,a(e,k)[c+w[32]]=0,a(e,N)[o]=i-160),e.pushChPrimitives(o)},()=>{let u=e.chRedir(i,s,!0),f=a(e,G)[o];a(e,G)[o]=u,(o!==u||u!==f)&&(e.buildRchTree(),console.info(`${n}receives from CH${u+1}`))}][t[0]]()}).add([16,0,9,4],(t,s,d)=>{e.invokeSysExIndicator();let i=(t[2]<<4)+t[3],o=e.chRedir(t[1],s,!0),c=_[o],n=et[o];[()=>{e.setChActive(o,i)},()=>{a(e,k)[c+w[7]]=i},()=>{a(e,k)[c+w[10]]=i},()=>{a(e,k)[c+w[91]]=i?127:0},()=>{a(e,D)[n+3]=i+40,a(e,B)[g.rpnt*o+2]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)})},()=>{a(e,D)[n+1]=i,a(e,B)[g.rpnt*o+1]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)})},()=>{a(e,D)[n]=i,a(e,B)[g.rpnt*o]=1,e.dispatchEvent("pitch",{part:o,pitch:e.getPitchShift(o)})},()=>{}][t[0]]()}),a(this,Qe).add([66,93,64],(t,s,d)=>{let i=t[2];switch(t[0]){case 0:{switch(t[1]){case 4:{e.invokeSysExIndicator(),x(e,V,i*129/16383*100),e.dispatchEvent("mastervolume",a(e,V));break}case 5:{e.invokeSysExIndicator(),i-64;break}case 6:{e.invokeSysExIndicator(),console.debug(`SG global reverb: ${i?"on":"off"}`);break}case 127:{e.switchMode("sg",!0),e.setPortMode(e.getTrackPort(s),1,v.sg);break}}break}case 1:{switch(t[1]){case 48:{e.invokeSysExIndicator(),console.debug(`SG reverb type: ${Ot[i]}`);break}}break}default:if(t[0]>>4===1){e.invokeSysExIndicator();let o=e.chRedir(t[0]&15,s,!0);if(t[1]===2){let c=e.chRedir(i,s,!0),n=a(e,G)[o];a(e,G)[o]=c,(o!==c||c!==n)&&(e.buildRchTree(),console.info(`SG CH${o+1} receives from CH${c+1}`))}else t[1]===19&&e.setChCc(o,7,i)}else console.warn(`Unknown AKAI SG SysEx: ${t}`)}}),a(this,je).add([9],(t,s,d)=>{e.invokeSysExIndicator(),console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremolo","phaser","rotary speaker","enhancer","flanger","EQ"][t[0]]||"off"}`)}),a(this,ee).add([127,0],(t,s,d)=>{e.switchMode("motif");let i=new Uint8Array([127,1,...t]);a(e,ee).run(i,s,d)}).add([127,1,0,0],(t,s,d)=>{e.switchMode("s90es");let i="S90/Motif ES system ",o=t[0];t.subarray(1).forEach((c,n)=>{([()=>{x(e,V,c*12900/16383),e.dispatchEvent("mastervolume",a(e,V))}][o+n]||(()=>{console.info(`Unrecognized ${i}ID: ${o+n}`)}))()})}).add([127,1,14],(t,s,d)=>{e.switchMode("s90es");let i="S90/Motif ES bulk header ",o=[];o[95]=(c,n,u)=>{console.debug(`${i}multi edit buffer: ${c[1]}`)},(o[t[0]]||(()=>{console.info(`Unrecognized ${i}ID: ${t[0]}.`)}))(t.subarray(1))}).add([127,1,15],(t,s,d)=>{e.switchMode("s90es");let i="S90/Motif ES bulk footer ",o=[];o[95]=(c,n,u)=>{console.debug(`${i}multi edit buffer: ${c[1]}`)},(o[t[0]]||(()=>{console.info(`Unrecognized ${i}ID: ${t[0]}.`)}))(t.subarray(1))}).add([127,1,54,1],(t,s,d)=>{e.switchMode("s90es");let i="S90/Motif ES reverb ",o=t[0];t.subarray(1).forEach((c,n)=>{([()=>{e.setEffectTypeRaw(0,!1,c&15|128)},()=>{e.setEffectTypeRaw(0,!0,c)}][o+n]||(()=>{}))()}),e.pushEffectType(0)}).add([127,1,54,2],(t,s,d)=>{e.switchMode("s90es");let i="S90/Motif ES chorus ",o=t[0];t.subarray(1).forEach((c,n)=>{([()=>{e.setEffectTypeRaw(1,!1,c&15|128)},()=>{e.setEffectTypeRaw(1,!0,c)}][o+n]||(()=>{}))()}),e.pushEffectType(1)}).add([127,1,54,3],(t,s,d)=>{e.switchMode("s90es");let i="S90/Motif ES insert 1 ",o=t[0];t.subarray(1).forEach((c,n)=>{([()=>{e.setEffectTypeRaw(3,!1,c&15|128)},()=>{e.setEffectTypeRaw(3,!0,c)}][o+n]||(()=>{}))()}),e.pushEffectType(3)}).add([127,1,54,4],(t,s,d)=>{e.switchMode("s90es");let i="S90/Motif ES insert 2 ",o=t[0];t.subarray(1).forEach((c,n)=>{([()=>{e.setEffectTypeRaw(4,!1,c&15|128)},()=>{e.setEffectTypeRaw(4,!0,c)}][o+n]||(()=>{}))()}),e.pushEffectType(4)}).add([127,1,54,16],(t,s,d)=>{e.switchMode("s90es");let i=t[0];t.subarray(1).forEach((o,c)=>{let u=`S90/Motif ES EQ${(c>>2)+1} `;([()=>{let f=o-64},()=>{let f=Je[o]},()=>{let f=o/10},()=>{let f=o}][i+c&3]||(()=>{}))()})}).add([127,1,54,17],(t,s,d)=>{e.switchMode("s90es");let i="S90/Motif ES variation ",o=t[0];t.subarray(1).forEach((c,n)=>{([()=>{e.setEffectTypeRaw(2,!1,c&15|128)},()=>{e.setEffectTypeRaw(2,!0,c)}][o+n]||(()=>{}))()}),e.pushEffectType(2)}).add([127,1,55],(t,s,d)=>{e.invokeSysExIndicator(),e.switchMode("s90es");let i=e.getTrackPort(s);if(a(e,z)[i]&&a(e,z)[i]!==a(e,U).smotif)if(a(e,xe).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${s}. Port ${String.fromCharCode(65+i)} mode "${Y[a(e,z)[i]]}" mismatch, should be "${Y[a(e,U).smotif]}".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);let o=e.chRedir(t[0],s,!0),c=_[o],n=t[1];t[0]>15&&(o=t[0]+32);let u=`Track ${s} S90/Motif ES bulk CH${o<128?o+1:"U"+(o-127)} `;console.debug(u,t),!(t[0]>15)&&t.subarray(2).forEach((f,y)=>{([()=>{e.setChCc(o,0,f),e.pushChPrimitives(o)},()=>{f&&e.setChActive(o,1),e.setChCc(o,32,f),e.getChPrimitive(o,1)===63&&e.setChType(o,[32,40].indexOf(f)>-1?e.CH_DRUMS:e.CH_MELODIC,a(e,H),!0),e.pushChPrimitives(o)},()=>{f&&e.setChActive(o,1),a(e,N)[o]=f,e.pushChPrimitives(o)},()=>{let C=e.chRedir(f,s,!0),P=a(e,G)[o];a(e,G)[o]=C,(o!==C||C!==P)&&(e.buildRchTree(),console.info(`${u}receives from CH${C+1}`))},()=>{a(e,se)[o]=f?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{f!==100&&e.setChActive(o,1),a(e,k)[c+w[7]]=f},()=>{f!==64&&e.setChActive(o,1),a(e,k)[c+w[10]]=f},!1,!1,!1,()=>{a(e,k)[c+w[91]]=f},()=>{f&&e.setChActive(o,1),a(e,k)[c+w[93]]=f},()=>{f&&e.setChActive(o,1),a(e,k)[c+w[94]]=f},()=>{e.setChCc(o,128,f),f!==127&&(e.setChActive(o,1),e.allocateAce(o,128))},()=>{},()=>{f!==64&&e.setChActive(o,1),a(e,k)[c+w[74]]=f},()=>{f!==64&&e.setChActive(o,1),a(e,k)[c+w[71]]=f},!1,()=>{a(e,k)[c+w[65]]=f},()=>{a(e,k)[c+w[5]]=f},()=>{}][n+y]||(()=>{}))()})}),a(e,ee).add([100,14],(t,s,d)=>{var o;e.switchMode("cs6x"),e.setPortMode(e.getTrackPort(s),1,v.cs6x);let i=(o=["normal voice","plugin voice PLG","drums",,"performance",,"phrase clip"][t[0]>>4])!=null?o:"invalid";t[0]&!0?i+=" edit buffer":t[0]>>4==1?i+=`${(t[0]&1)+1}`:i+=` ${["INT","EXT"][t[0]&1]}`,console.debug(`CS6x bulk dump for ${i} started.`)}).add([100,15],(t,s,d)=>{var o;e.switchMode("cs6x");let i=(o=["normal voice","plugin voice PLG","drums",,"performance",,"phrase clip"][t[0]>>4])!=null?o:"invalid";t[0]&!0?i+=" edit buffer":t[0]>>4==1?i+=`${(t[0]&1)+1}`:i+=` ${["INT","EXT"][t[0]&1]}`,console.debug(`CS6x bulk dump for ${i} ended.`)}).add([100,76,112],(t,s,d)=>{e.switchMode("cs6x");let i=0,o=t[0];t.subarray(1).forEach((c,n)=>{let u=n+o;u<10?(e.setChCvnRegister(i,n,c&127),a(e,ue)[i]=1):u<12||u<13&&console.debug(`Plugin voice type: ${c}`)}),e.pushChPrimitives(i)}).add([100,76,0],(t,s,d)=>{e.switchMode("cs6x"),e.setPortMode(e.getTrackPort(s),1,v.cs6x);let i=0,o=t[0];t.subarray(1).forEach((c,n)=>{let u=n+o;([()=>{e.setChCc(i,7,c),c!==100&&e.setChActive(i,1)},,,()=>{a(e,se)[i]=c==0,e.setChCc(i,64,0),a(e,J).ano(i),e.resetChAceAll(i)},,()=>{},,,()=>{e.setChCc(i,65,c?127:0)},()=>{e.setChCc(i,5,c)},,()=>{e.setChCc(i,91,c),c!==40&&e.setChActive(i,1)},()=>{e.setChCc(i,93,c),c&&e.setChActive(i,1)}][u]||(()=>{}))()})}).add([100,76,1],(t,s,d)=>{e.switchMode("cs6x");let i=0,o=t[0],c=!1;t.subarray(1).forEach((n,u)=>{let f=u+o;([()=>{e.setEffectTypeRaw(0,!1,n&15|128),c=!0},()=>{e.setEffectTypeRaw(0,!0,n),c=!0}][f]||(()=>{}))()}),c&&e.pushEffectType(0)}).add([100,76,2],(t,s,d)=>{e.switchMode("cs6x");let i=0,o=t[0],c=!1;t.subarray(1).forEach((n,u)=>{let f=u+o;([()=>{e.setEffectTypeRaw(1,!1,n&15|128),c=!0},()=>{e.setEffectTypeRaw(1,!0,n),c=!0}][f]||(()=>{}))()}),c&&e.pushEffectType(1)}).add([100,76,3],(t,s,d)=>{e.switchMode("cs6x");let i=0,o=t[0],c=!1;t.subarray(1).forEach((n,u)=>{let f=u+o;([()=>{e.setEffectTypeRaw(2,!1,n&15|128),c=!0},()=>{e.setEffectTypeRaw(2,!0,n),c=!0}][f]||(()=>{}))()}),c&&e.pushEffectType(2)}).add([100,76,5],(t,s,d)=>{e.switchMode("cs6x")}).add([100,76,16],(t,s,d)=>{e.switchMode("cs6x");let i=0,o=t[0],c=!1;if(t.subarray(1).forEach((n,u)=>{let f=u+o;([()=>{e.setChCc(i,0,n),c=!0},()=>{e.setChCc(i,32,n),c=!0,n&&e.setChActive(i,1)},()=>{a(e,N)[i]=n,c=!0,n&&e.setChActive(i,1)},()=>{a(e,B)[et[i]+vt[2]]=1,a(e,D)[et[i]+vt[2]]=n,n&&e.setChActive(i,1)}][f]||(()=>{}))()}),c){switch(e.pushChPrimitives(i),e.getChVoice(i).standard){case"DX":{a(e,ie)[i]=e.EXT_DX;break}case"VL":{a(e,ie)[i]=e.EXT_VL;break}}e.dispatchEvent("metacommit",{type:"OSysMeta",msg:"part.rename",data:{part:i}})}}).add([100,76,32],(t,s,d)=>{e.switchMode("cs6x");let i=0,o=t[0],c=a(e,ie)[i];switch(c){case e.EXT_DX:{t.length>2&&console.debug(t),t.subarray(1).forEach((n,u)=>{let f=u+o;if(f<6){let y=f+142;e.setChCc(i,y,n),n!==64&&e.allocateAce(i,y)}else if(f<12){let y=f+144;e.setChCc(i,y,n),n!==64&&e.allocateAce(i,y)}else([()=>{},()=>{},()=>{},()=>{}][f]||(()=>{}))()});break}case e.EXT_VL:{console.info(`Support for Modular System Plug-in writes is not yet present for plugin type ${c}.`);break}default:console.warn(`Unsupported plug-in type: ${c}`)}}),a(this,pe).add([0,72,18,0,0,0,0],(t,s,d)=>{e.switchMode("sd",!0),e.setPortMode(e.getTrackPort(s),2,v.sd),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(t,s,d)=>{e.invokeSysExIndicator();let i=t[0]>>5,o=t[0]&31;switch(i){case 0:{let c=t[0]>>1,n=t[1];switch(c){case 1:{t.subarray(2).forEach((u,f,y)=>{let C=f+n;switch(C){case 0:{u&&(e.setEffectType(1,60,u-1),e.pushEffectType(1),console.debug(`SD MFX Cho: ${C} - ${u}`));break}}});break}case 2:{t.subarray(2).forEach((u,f)=>{let y=f+n;switch(y){case 0:{u&&(e.setEffectType(0,55+u,0),e.pushEffectType(0),console.debug(`SD MFX Rev: ${y} - ${u}`));break}}});break}case 3:case 4:case 5:{let u=c-1;t.subarray(2).forEach((f,y)=>{let C=y+n;switch(console.debug(`SD MFX ${u-2}: ${C} - ${f}`),C){case 0:{e.setEffectTypeRaw(u,62,f),e.pushEffectType(u);break}}}),console.debug(`SD MFX message:
%o`,t);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,t)}break}case 1:{let c=e.chRedir(o,s,!0),n=t[1],u=_[c];t.subarray(2).forEach((f,y)=>{let C=n+y;C<37?([()=>{},()=>{},0,()=>{},()=>{switch(f){case 104:case 105:case 106:case 107:case 120:case 128:{a(e,O)[c]||e.setChType(c,e.CH_DRUMS);break}default:a(e,O)[c]&&e.setChType(c,e.CH_MELODIC)}e.setChCc(c,0,f),e.pushChPrimitives(c)},()=>{a(e,k)[u+w[32]]=f,e.pushChPrimitives(c)},()=>{a(e,N)[c]=f},()=>{a(e,k)[u+w[7]]=f},()=>{a(e,k)[u+w[10]]=f},()=>{},()=>{},()=>{f<2&&(a(e,se)[c]=f)},()=>{f<2&&(a(e,k)[u+w[68]]=f?127:0)},()=>{},()=>{f<2&&(a(e,k)[u+w[65]]=f?127:0)},()=>{a(e,k)[u+w[5]]=f&15<<4|a(e,k)[u+w[5]]&15},()=>{a(e,k)[u+w[5]]=f&15|(a(e,k)[u+w[5]]&240)>>4},()=>{a(e,k)[u+w[74]]=f},()=>{a(e,k)[u+w[71]]=f},()=>{a(e,k)[u+w[73]]=f},()=>{a(e,k)[u+w[72]]=f},0,0,0,0,0,0,0,()=>{a(e,k)[u+w[128]]=f,e.allocateAce(128)},()=>{a(e,k)[u+w[93]]=f},()=>{a(e,k)[u+w[91]]=f},0,0,()=>{a(e,k)[u+w[75]]=f},()=>{a(e,k)[u+w[76]]=f},()=>{a(e,k)[u+w[77]]=f},()=>{a(e,k)[u+w[78]]=f}][C]||(()=>{}))():C<63||(C<64?(a(e,O)[c]?(a(e,k)[u+w[0]]=104|f,e.pushChPrimitives(c)):(a(e,k)[u+w[0]]=96|f,e.pushChPrimitives(c)),e.pushChPrimitives(c)):console.debug(`Unknown SD-90 global CH${c+1} param setup message:
%o`,t))});break}case 2:{let c=e.chRedir(o,s,!0),n=t[1];console.debug(`Unknown SD-90 global CH${c+1} MIDI setup message:
%o`,t.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,t)}}),a(e,we).add([0,1,73,78],(t,s,d)=>{e.switchMode("krs"),e.setPortMode(e.getTrackPort(s),1,v.krs),console.debug("Might be KORG KROSS 2 mode reset... Not sure.")}).add([0,1,73,117,2,37],(t,s,d)=>{e.switchMode("krs");let i=e.getTrackPort(s);if(a(e,z)[i]&&a(e,z)[i]!==v.krs)if(a(e,xe).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled. Port ${String.fromCharCode(65+i)} mode "${Y[a(e,z)[i]]}" mismatch, should be "krs".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);e.setPortMode(e.getTrackPort(s),1,v.krs);let o="KROSS 2 BMT1 ",c="";ye(t,(n,u)=>{if(u<24)c+=String.fromCharCode(Math.max(32,n));else if(!(u<88)){if(u<468){let f=u-88,y=f*863>>16,C=f-y*76;([()=>{e.setEffectType(y+3,45,n),e.pushEffectType(y+3)},!1,()=>{console.debug(`${o}IFX${y+1} sends to ${n<=5&&n>0?`IFX${n}`:"direct out"}.`)}][C]||(()=>{}))()}else if(u<604){let f=u-468,y=f*964>>16,C=f-y*68;([()=>{e.setEffectType(1-y,45,n),e.dispatchEvent(["efxreverb","efxchorus"][1-y],{id:e.getEffectType(1-y)})},!1][C]||(()=>{}))()}else if(!(u<1276)){let f=u-1276,y=f*1490>>16,C=e.chRedir(y,s,!0),P=f-y*44;P<22?([()=>{n&&e.setChActive(C,1),a(e,N)[C]=n,e.pushChPrimitives(C)},()=>{n&&e.setChActive(C,1),n<10?(e.setChCc(C,0,63),e.setChCc(C,32,n)):n<20?(e.setChCc(C,0,121),e.setChCc(C,32,n-10)):n<24&&(e.setChCc(C,0,[120,0,56,62][n-20]),e.setChCc(C,32,0)),e.pushChPrimitives(C)},()=>{let I=e.chRedir(n&15,s,!0);a(e,G)[C]=I,I!==C&&console.info(`${o}CH${C+1} receives from CH${I+1}`);let R=n>>5&1;e.modelEx.kross.chToggle&&(e.setChActive(C,R),R||console.debug(`KORG KROSS 2 CH${C+1} is disabled.`))},!1,!1,()=>{e.setChCc(C,7,n)},!1,()=>{},()=>{},!1,!1,!1,!1,!1,()=>{e.setChCc(C,10,n||128)}][P]||(()=>{}))():P<36?([()=>{let I=n&7;n&8&&(I=1),I>1&&console.debug(`${o}CH${C+1} sends to ${I>1?`IFX${I-1}`:"direct out"} (${n.toString(16)}).`),e.setChEffectSink(C,n>1&&n<7?n+1:0)}][P-22]||(()=>{}))():([()=>{e.setChCc(C,74,(n+128&255)-64)},()=>{e.setChCc(C,71,(n+128&255)-64)},!1,!1,()=>{e.setChCc(C,73,(n+128&255)-64)},()=>{e.setChCc(C,75,(n+128&255)-64)},!1,()=>{e.setChCc(C,72,(n+128&255)-64)}][P-36]||(()=>{}))()}}}),c=c.trimEnd(),e.dispatchEvent("metacommit",{type:"EORTitle",data:c})});let S=function(t,s,d){let i=e.chRedir(t,s,!0);e.setChMode(i,v.an1x),e.pushChPrimitives(i),console.debug(`Yamaha AN1x slot ${d+1} receives from CH${i+1}(${t+1}).`),e.modelEx.yPlg[3][d]=i};a(e,ee).add([92,0,0],(t,s,d)=>{let i=t[0];t.subarray(1).forEach((o,c)=>{let n=c+i;n<2||([!1,!1,!1,!1,!1,!1,()=>{S(o,s,0)},()=>{S(o,s,1)}][n-2]||(()=>{}))()})}),a(e,ee).add([75,80,0],(t,s,d)=>{let i=t[0];t.subarray(1).forEach((o,c)=>{let n=c+i;([()=>{e.modelEx.cs1x.perfCh=o,e.pushChPrimitives(o),console.debug(`Yamaha CS1x performance on CH${o+1}.`)},!1,!1,!1,()=>{},!1,()=>{switch(o){case 1:{e.switchMode("xg",!0),e.setPortMode(e.getTrackPort(s),1,v.xg),console.debug("Yamaha CS1x set to XG mode.");break}case 3:{e.switchMode("cs1x",!0),e.setPortMode(e.getTrackPort(s),1,v.cs1x),console.debug("Yamaha CS1x set to performance mode.");break}default:console.warn(`Unknown Yamaha CS1x mode: ${o}`)}},()=>{}][n]||(()=>{}))()})}).add([75,96,0],(t,s,d)=>{let i=t[0],o=!1,c=e.modelEx.cs1x.perfCh;t.subarray(1).forEach((n,u)=>{let f=u+i;f<8?(o=!0,a(e,ue)[c]=1,e.setChCvnRegister(c,f,n)):f<48?([!1,()=>{e.setChCc(c,7,n)}][f]||(()=>{}))():f<80?([()=>{e.setEffectTypeRaw(0,!1,n)},()=>{e.setEffectTypeRaw(0,!0,n),e.pushEffectType(0)},()=>{e.setEffectTypeRaw(1,!1,n)},()=>{e.setEffectTypeRaw(1,!0,n),e.pushEffectType(1)},()=>{e.setEffectTypeRaw(2,!1,n)},()=>{e.setEffectTypeRaw(2,!0,n),e.pushEffectType(2)}][f-48]||(()=>{}))():L()&&console.debug(`Unknown CS1x effect register: ${f}.`)}),o&&(e.setChActive(c,1),e.pushChPrimitives(c))});let M=(t,s,d)=>{let i=0;d.forEach((o,c)=>{([()=>{i=(o&1)<<7|i&127,e.setEffectTypeRaw(t,!1,28),e.setEffectTypeRaw(t,!0,i)},()=>{i=i&128|o&127,e.setEffectTypeRaw(t,!1,28),e.setEffectTypeRaw(t,!0,i),e.pushEffectType(t)}][c+s]||(()=>{}))()})};a(e,we).add([96,0,1],(t,s,d)=>{let i=t[0];switch(t[1]){case 0:{M(0,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}case 1:{M(1,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}case 2:{M(2,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}case 3:{M(3,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}default:console.debug(`Unparsed KORG PA SysEX:
`,t)}})}get detect(){return structuredClone(a(this,U))}chRedir(e,r,l){let h=this;if(a(h,Ue)[r])return(a(h,Ue)[r]-1)*16+e;if(a(h,H)===v.sc||a(h,H)===v.sd){if(l===1)return e;let p=0,E=!0;for(;E;)a(h,Re)[e+p]===0?(a(h,Re)[e+p]=r,console.debug(`Assign track ${r} to channel ${e+p+1}.`),E=!1):a(this,Re)[e+p]===r?E=!1:(p+=16,p>=128&&(p=0,E=!1));return e+p}else return e}getTrackPort(e){return this.chRedir(0,e,!0)>>4}forceVoiceRefresh(){for(let e=0;e<g.ch;e++)a(this,de)[e]&&this.dispatchEvent("voice",{part:e})}buildRchTree(){let e=[];a(this,G).forEach((r,l)=>{var h;r<g.ch&&((h=e[r])!=null&&h.constructor||(e[r]=[]),e[r].push(l))}),x(this,Ct,e)}buildRccMap(){let e=this;for(let r=0;r<g.ch;r++)a(e,Ve)[r]={};a(e,Ge).forEach((r,l)=>{r&&(a(e,Ve)[Math.floor(l/g.redir)][r]=l%g.redir|128)}),L()&&console.debug(a(e,Ve))}invokeSysExIndicator(){this.dispatchEvent("mupromptex",a(this,lt))}getActive(){return a(this,de)}getChActive(e){return a(this,de)[e]}getCc(e){if(typeof e!="number"||e<0||e>=g.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let r=this,l=_[e];return a(r,k).subarray(l,l+g.cc)}getChCc(e,r){let l=this;if(Be.indexOf(r)<0)throw new Error("CC number not accepted");return a(l,k)[_[e]+w[r]]}getChCcWritten(e,r){let l=this;if(Be.indexOf(r)<0)throw new Error("CC number not accepted");return a(l,k)[g.chcc+_[e]+w[r]]}setChCc(e=0,r,l){let h=this;if(Be.indexOf(r)<0)throw new Error("CC number not accepted");if((l==null?void 0:l.constructor)!==Number)throw new TypeError("Expected numbers for value");let p=l&255,E=_[e]+w[r];a(h,k)[E]=p,a(h,k)[E+g.chcc]=1,h.dispatchEvent("cc",{part:e,cc:r,data:p})}getCcAll(){return a(this,k).slice()}resetCc(e){let r=this,l=_[e]+g.chcc;a(r,k).fill(0,l,l+g.cc)}resetChCc(e,r,l){let h=this;l!=null&&l.constructor&&h.setChCc(e,r,l),a(h,k)[_[e]+w[r]+g.chcc]=0}resetCcAll(){a(this,k).fill(0,g.chcc,g.chcc<<1)}isChCcWritten(e,r){if(Be.indexOf(r)<0)throw new Error("CC number not accepted");return a(upThis,k)[_[e]+w[r]+g.chcc]}getChSource(){return a(this,G)}getChType(e=0){return a(this,O)[e]}getChTypes(){return a(this,O)}setChType(e,r,l=0,h=!1){r&=15;let p=this;l=l||p.getChModeId(e),a(p,O)[e]=r,r>0&&!h&&(p.setChCc(e,0,a(p,j)[l][2]),p.pushChPrimitives(e))}setChActive(e,r=0){a(this,de)[e]!==r&&this.dispatchEvent("channeltoggle",{part:e,active:r}),a(this,de)[e]=r}getExt(e){let r=g.ext*e,l=a(this,ie).subarray(r,r+g.ext),h=new Uint8Array(l.length);return h.set(l),h[1]=h[1]||a(this,$t),h}getPitch(){return a(this,Pe)}getProgram(){return a(this,N)}getTexts(){return a(this,he).slice()}getVel(e){let r=new Map,l=this;return a(l,Q).forEach(function(h,p){let E=h>>7,m=h&127;e===E&&a(l,Z)[h]>0&&r.set(m,{v:a(l,Z)[h],s:a(l,X)[p]})}),r}getBitmap(){return{bitmap:a(this,Ae,at),expire:a(this,Ce)}}getLetter(){return{text:a(this,De),set:a(this,Et),expire:a(this,Le)}}getMode(){return Y[a(this,H)]}getMaster(){return{volume:a(this,V)}}getRpn(){return a(this,D)}getNrpn(){return a(this,rt)}getSubDb(){return self==null?void 0:self.structuredClone(a(this,j))}getDetect(){return self==null?void 0:self.structuredClone(a(this,U))}getVoice(e,r,l,h="?"){var t;let p=this;(t=v[h])!=null&&t.constructor||(h="?");let E=v[h],m=e||a(p,j)[E][0],$=r,S=l||a(p,j)[E][1];m===yt.bank0&&(m=0),S===yt.bank0&&(S=0),h==="ns5r"&&m>0&&m<56&&(S=3);let M=p.userBank.get(m,$,S,h);if(h==="mt32"&&M.name.indexOf("MT-m:")===0){let s=parseInt(M.name.slice(5)),d=s*g.cmt,i="";a(p,Ie).subarray(d,d+10).forEach(c=>{c>31&&(i+=String.fromCharCode(c))});let o=`MSB	LSB	PRG	NME
49	127	${$}	${i}`;p.userBank.load(o,!0),M.name=i,M.ending=" "}return(M.ending!==" "||!M.name.length)&&(M=p.baseBank.get(m,$,S,h)),M}getChPrimitive(e,r,l){if(r>=g.vxPrim||(r==null?void 0:r.constructor)!==Number)throw new RangeError(`Invalid voice primitive component "${r}"`);if(typeof e!="number"||e<0||e>=g.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let h=this,p=a(h,N)[r<<g.chShift|e];switch(r){case 1:case 2:{h.getChCcWritten(e,[255,0,32][r])||(p=p||a(h,j)[h.getChModeId(e)][r+2]),l&&(p=p||a(h,j)[h.getChModeId(e)][r-1]),p===yt.bank0&&(p=0);break}}return p}getChPrimitives(e,r){let l=this,h=new Uint8Array(3);return h[1]=a(l,N)[e],h[0]=l.getChPrimitive(e,1,r),h[2]=l.getChPrimitive(e,2,r),h}pushChPrimitives(e){let r=this;a(r,N)[1<<g.chShift|e]=r.getChCc(e,0),a(r,N)[2<<g.chShift|e]=r.getChCc(e,32),r.dispatchEvent("voice",{part:e})}getChCvnBuffer(e,r=g.cvn){if(r>g.cvn||r<1)throw new RangeError("Invalid custom voice name buffer length");let l=tt[e];return a(this,Ke).subarray(l,l+r)}getChCvnRegister(e,r){if(r>=g.cvn||r<0)throw new RangeError("Invalid custom voice name register");return a(this,Ke)[tt[e]+r]}setChCvnRegister(e,r,l=32){if(r>=g.cvn||r<0)throw new RangeError("Invalid custom voice name register");a(this,it)[e]=1,a(this,Ke)[tt[e]+r]=Math.max(32,l&255)}resetChCvn(e){a(this,Ke).fill(32,tt[e],tt[e]+g.cvn),a(this,it)[e]=0}getChCvnString(e,r){let l=Fa.decode(this.getChCvnBuffer(e));return r||(l=l.trimEnd()),l}getChCvnIsWritten(e){return a(this,it)[e]}getChVoice(e){let r=this,l=r.getVoice(...r.getChPrimitives(e),r.getChMode(e));if(a(r,ue)[e]){let h="";switch(a(r,H)){case v.mt32:{a(r,ve).subarray(g.cmt*(e-1),g.cmt*(e-1)+10).forEach(p=>{h+=String.fromCharCode(Math.max(p,32))}),h=h.trimEnd();break}default:h=r.getChCvnString(e)}h.length&&(l.ending="~",l.name=h)}return l}getRawPitch(){return a(this,Pe)}getPitchShift(e){let r=this,l=e*g.rpn,h=a(r,D)[l];return a(r,B)[e*g.rpnt]?h>>7&&(h-=256):a(r,H)===v.mt32&&(h=12),a(r,Pe)[e]/8192*h+(a(r,D)[l+3]-64)+((a(r,D)[l+1]<<7)+a(r,D)[l+2]-8192)/8192}getEffectType(e=0){let r=3*e+1;return a(this,fe).subarray(r,r+2)}getPolyState(e=0){return a(this,X)[e]}setEffectTypeRaw(e=0,r,l){let h=3*e;a(this,fe)[h]=1,a(this,fe)[h+1+ +r]=l}setEffectType(e=0,r,l){this.setEffectTypeRaw(e,!1,r),this.setEffectTypeRaw(e,!0,l)}pushEffectType(e=0,r=!1){if(e<0||e>=g.efx)throw new RangeError(`Invalid EFX slot ${e}`);let l=this.getEffectType(e);r||l[0]===0&&l[1]>>4===15&&(r=!0),this.dispatchEvent(`efx${ya[e]}`,{id:l,hidden:r})}getEffectSink(){return a(this,_e)}getChEffectSink(e){return a(this,_e)[e]}setChEffectSink(e,r=0){let l=this;if(r<0||r>=g.efx)throw new RangeError(`Invalid EFX slot ${r}`);if(e<0||e>=g.ch)throw new RangeError(`Invalid CH${e+1}`);a(this,_e)[e]=r,this.dispatchEvent("partefxtoggle",{part:e,active:r})}setXgChEffectSink(e,r=0){let l=this,h=l.modelEx.xg,p=r-2;if(r<0||p>=h.insPart.length)throw new RangeError(`Invalid XG insertion slot ${p}`);let E=h.insPart[p];h.insPart[p]=e,E!==g.invalidCh&&l.setChEffectSink(E,0),e===g.invalidCh?E!==g.invalidCh&&l.setChEffectSink(E,0):l.setChEffectSink(e,r)}setLetterDisplay(e,r,l=0,h=3200){let p=this,E;x(p,De," ".repeat(l)),e.forEach(m=>{x(p,De,a(p,De)+String.fromCharCode(m>31?m:32)),m<32&&(E=E||new Set,E.add(m))}),x(p,Et,Date.now()),x(p,Le,Date.now()+h),p.dispatchEvent("letter"),E&&(E=Array.from(E),E.forEach((m,$,S)=>{S[$]=m.toString(16).padStart(2,"0")}),console.warn(`${r}${r?" ":""}invalid code point${E.length>1?"s":""}: 0x${E.join(", 0x")}`))}setDetectionTargets(e="?",r=0){let l=this,h=-1;switch(e.replaceAll(", ",",").split(",").forEach(p=>{p=p.toLowerCase();let E=Y.indexOf(Ua[p]||p);L()&&console.debug(`Mapped mode "${p}" to ID "${E}".`),E>-1&&(h=E)}),L()&&console.debug(`Set detection target to ID "${h}".`),h>0&&(a(l,U).x5=82,a(l,U).ds=v.krs,a(l,U).gm=v.gm,a(l,U).g2=v.g2),h){case v["05rw"]:{a(l,U).x5=81;break}case v.s90es:{a(l,U).ds=v.s90es,a(l,U).smotif=v.s90es;break}case v.motif:{a(l,U).ds=v.motif,a(l,U).smotif=v.motif;break}case v.sd:{a(l,U).g2=v.sd;break}case v.pa:{a(l,U).g2=v.pa;break}}}setGsTargets(e=!1,r=4){if(!r)r=e?3:4;else{if(r>4||r<0)throw new Error(`Invalid GS level ${r}`);if(e&&r>>1!==1)throw new Error(`Invalid SC level ${r}`)}let l=this;a(l,U)[e?"sc":"gs"]=r,a(l,j)[v[e?"sc":"gs"]][1]=r,l.forceVoiceRefresh()}getConfigs(){return a(this,gt)}setDumpLimit(e){if(e>2||e<0)throw new RangeError("Invalid dump limit.");a(this,xe).dumpLimit=e}allocateAce(e=0,r){let l=this;if(!r||r<128&&r>95){console.warn(`cc${r} cannot be allocated as an active custom effect.`);return}let h=!0,p=0,E=g.ace*e;for(;h&&p<g.ace;)a(l,te)[p+E]===r?h=!1:a(l,te)[p+E]||(h=!1,a(l,te)[p+E]=r,console.debug(`Allocated cc${r} to ACE slot ${p} in CH${e+1}.`)),p++;p>=g.ace&&console.warn(`ACE slots are full in CH${e+1}.`)}allocateAceAll(e){let r=this;if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}for(let l=0;l<g.ch;l++){let h=!0,p=0,E=g.ace*l;for(;h&&p<g.ace;)a(r,te)[p+E]===e?h=!1:a(r,te)[p+E]||(h=!1,a(r,te)[p+E]=e),p++;p>=g.ace&&console.warn(`ACE slots are full in CH${l+1}.`)}}resetAce(){a(this,te).fill(0),console.info("All ACE slots have been reset.")}resetChAceAll(e=0){a(this,te).subarray(wt[e],wt[e]+g.ace).fill(0)}resetChAce(e=0,r){let l=!0,h=wt[e],p=h+g.ace;for(;l&&h<p;)a(this,te)[h]===r&&(a(this,te)[h]=0,l=!1),h++;l&&L()&&console.debug(`No ACE slot was allocated to cc${r} in CH${e+1}.`)}getAce(){return a(this,te)}getChAce(e=0,r=0){if(r<0||r>=g.ace)throw new RangeError("No such ACE slot");let l=a(this,te)[g.ace*e+r];if(l){if(Be.indexOf(l)>=0)return this.getChCc(e,l);throw new Error(`Invalid ACE source in CH${e+1}: ${l}`)}else return 0}initDrums(){let e=this;a(e,ce).fill(64);for(let r=0;r<g.drm;r++){let l=r*g.dpn;for(let h in pa){let p=pa[h],E=(l+Ee[h])*g.dnc;a(e,ce).subarray(E,E+g.dnc).fill(p)}}}init(e=0){let r=this;x(r,Fe,0),a(r,j)[v.xg][1]=0,r.dispatchEvent("banklevel",{mode:"xg",data:0}),a(r,de).fill(0),a(r,k).fill(0),a(r,te).fill(0),a(r,N).fill(0),a(r,Z).fill(0),a(r,Q).fill(0),a(r,X).fill(0),a(r,se).fill(0),a(r,Se).fill(0),a(r,Pe).fill(0),a(r,rt).fill(0),a(r,B).fill(0),a(r,ie).fill(0),a(r,z).fill(0),a(r,st).fill(0),a(r,Xe).fill(0),a(r,Ge).fill(0),x(r,V,100),x(r,he,[]),x(r,ct,500),r.modelEx.sg.convLastSyll=0,r.modelEx.sg.runLineLen=0,r.modelEx.sg.splitMask=!1,x(r,Ce,0),x(r,re,0);for(let l=0;l<a(r,me).length;l++)a(r,Ae,at).fill(0);x(r,K,r.KARAOKE_NONE),x(r,ot,0),x(r,Te,!0),x(r,W,!1),x(r,lt,0),r.initDrums(),r.polyIndexLatest=0,r.polyIndexLast=0,a(r,G).forEach(function(l,h,p){p[h]=h}),e===0&&(r.dispatchEvent("mode","?"),x(r,H,0),a(r,Re).fill(0),a(r,Ue).fill(0),x(r,Le,0),x(r,De,"")),Ba.forEach(l=>{r.setChCc(l,0,a(r,j)[r.getChModeId(l)][2])}),a(r,O).fill(r.CH_MELODIC),a(r,O)[9]=r.CH_DRUM1,a(r,O)[25]=r.CH_DRUM3,a(r,O)[41]=r.CH_DRUMS,a(r,O)[57]=r.CH_DRUMS,a(r,O)[73]=r.CH_DRUM5,a(r,O)[89]=r.CH_DRUM7,a(r,O)[105]=r.CH_DRUMS,a(r,O)[121]=r.CH_DRUMS;for(let l=0;l<g.drm;l++)a(r,ke)[l<<1]=0,a(r,ke)[l<<1|1]=g.invalidCh;a(r,nt).fill(0),a(r,Ie).fill(0),a(r,Oe).fill(0),a(r,ve).fill(0),a(r,ue).fill(0),a(r,fe).fill(0),a(r,_e).fill(0),r.aiEfxName="",r.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),r.modelEx.xg.varSys=!1,r.modelEx.xg.insPart.fill(g.invalidCh);for(let l=0;l<ge.length;l++){let h=r.modelEx.yPlg[l];h.fill(0,0,ge[l][2]),h.fill(g.invalidCh,ge[l][2])}r.modelEx.sc.showBar=!0,r.modelEx.sc.invBar=!1,r.modelEx.sc.invDisp=!1,r.modelEx.sc.peakHold=1,r.modelEx.cs1x.perfCh=0;for(let l=0;l<g.ch;l++){r.resetChCvn(l);let h=_[l];a(r,k)[h+w[7]]=100,a(r,k)[h+w[11]]=127,a(r,k)[h+w[2]]=127,a(r,k)[h+w[10]]=64,a(r,k).subarray(h+w[71],h+w[71]+8).fill(64),a(r,k)[h+w[128]]=127,a(r,k).subarray(h+w[130],h+w[157]+1).fill(64),a(r,k)[h+w[91]]=40,a(r,k)[h+w[101]]=127,a(r,k)[h+w[100]]=127,a(r,k)[h+w[99]]=127,a(r,k)[h+w[98]]=127;let p=l*g.rpn;a(r,D)[p]=2,a(r,D)[p+1]=64,a(r,D)[p+2]=0,a(r,D)[p+3]=64,a(r,D)[p+4]=0,a(r,D)[p+5]=0;let E=l*g.ext;a(r,ie)[E+1]=r.VLBC_BRTHEXPR;let m=l*g.redir;a(r,Ge)[m+8]=13}r.buildRchTree(),r.buildRccMap(),r.dispatchEvent("mastervolume",a(r,V));for(let l=0;l<ya.length;l++)r.pushEffectType(l);r.dispatchEvent("reset"),r.switchMode("?")}setChMode(e,r){let l=this;if(typeof e!="number"||e<0||e>=g.ch)throw new RangeError(`Invalid part number: CH${e+1}`);if(e<0||r>=Y.length)throw new RangeError(`Invalid mode ID ${r}`);a(l,Xe)[e]=r,l.dispatchEvent("chmode",{part:e,id:r,mode:Y[r]}),l.pushChPrimitives(e)}getChMode(e,r){return Y[this.getChModeId(e,r)]}getChModeId(e,r){return r?a(this,Xe)[e]||a(this,z)[e>>4]:a(this,Xe)[e]||a(this,z)[e>>4]||a(this,H)}getPortMode(e,r){return Y[this.getPortModeId(e,r)]}getPortModeId(e,r){return r?a(this,z)[e]:a(this,z)[e]||a(this,H)}setPortMode(e,r,l){let h=this;if(e<0||e>=g.ch>>4)throw new RangeError(`Invalid port ${e+1}`);if(r<1)throw new RangeError("Range must be a positive integer");if(e+r>=g.ch>>4)throw new RangeError("Range must be in bound");if(e<0||l>=Y.length)throw new RangeError(`Invalid mode ID ${l}`);a(h,st)[e]=l;for(let p=e;p<e+r;p++){let E=a(h,st)[p];if(r>1&&E!==0&&E!==l)break;a(h,z)[p]=l;for(let m=p<<4;m<p+1<<4;m++)h.dispatchEvent("chmode",{part:m,id:l,mode:Y[l]}),h.pushChPrimitives(m)}}copyChSetup(e,r,l){if(e===r){console.warn(`Failed attempt at overwriting CH${e+1} with its own data.`);return}let h=this;if(l&&a(h,de)[r]){console.warn(`Failed attempt at copying setup data from CH${e+1} to CH${r+1}.`);return}let p=_[e],E=_[r];a(h,N)[r]=a(h,N)[e],a(h,k).set(a(h,k).subarray(p,p+g.cc),E),h.pushChPrimitives(r)}setDrumFirstWrite(e,r){let l=this,h=a(l,O)[e];if(h<2)return;let p=h-2;if(a(l,ke)[p<<1]){if(r)a(l,ke)[p<<1]=0,L()&&console.debug(`First write part for drum set ${p+1} has been reset.`);else return;}else r?console.warn(`First write part for drum set ${p+1} is already blank.`):(a(l,ke)[p<<1]=1,a(l,ke)[p<<1|1]=e,console.debug(`First write part for drum set ${p+1} is set to CH${e+1}.`))}getChDrumFirstWrite(e){let r=this,l=a(r,O)[e];if(l<2)return;let h=l-2;return a(r,ke).subarray(h<<1,h+1<<1)}getDrumFirstWrite(e){if(e>=0&&e<g.drm)return a(this,ke).subarray(e<<1,e+1<<1)}switchMode(e,r=!1,l=!1){let h=this,p=v[e];if(p>-1){if(a(h,H)===0||r){switch(h.initOnReset&&r&&h.init(1),x(h,re,0),p){case v.gm:{p=a(h,U).gm;break}case v.g2:{p=a(h,U).g2;break}}switch(x(h,H,p),p){case v.gs:case v.sc:{a(h,j)[v[e]][1]=a(h,U)[e];break}}for(let $=0;$<g.ch;$++){let S=h.getChModeId($,!0);a(h,O)[$]>0&&S===v["?"]&&(h.setChCc($,0,a(h,j)[p][2]),L()&&console.debug(`CH${$+1} (${a(h,O)[$]}) (${h.getChMode($)}), ${Y[S]} (${a(h,j)[S][2]}) -> ${Y[p]} (${a(h,j)[p][2]})`),h.pushChPrimitives($))}switch(p){case v.mt32:{Dt.forEach(($,S)=>{let M=S+1;a(h,de)[M]||(a(h,N)[M]=$,h.setChCc(M,91,127),h.pushChPrimitives(M))});for(let $=1;$<10;$++)h.pushChPrimitives($);break}}let E,m;switch(p){case v["?"]:case v.g2:{E=[52,4,52,18,0,255,0,255,0,255,0,255,0,255,0,255];break}case v.xg:case v.cs1x:{E=[1,0,65,0,5,0,64,0,64,0,64,0,64,0,0,255],m=[64,0];break}case v.gm:case v.gs:case v.sc:{E=[40,4,40,18,40,32,32,0,0,255,0,255,0,255,0,255],m=[32,0];break}case v.sd:{E=[58,0,60,0,61,0,61,0],m=[61,0];break}case v["05rw"]:case v.x5d:case v.ns5r:{E=[44,1,44,19,0,255,0,255,0,255,0,255,0,255,0,255];break}case v.k11:case v.sg:{E=[24,0,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case v.mt32:{E=[40,4,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case v.doc:{E=[24,16,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case v.motif:case v.s90es:case v.cs6x:{E=[129,0,133,0,130,0,128,0,128,0,0,255,0,255,0,255],m=[128,0];break}case v.pa:{E=[28,52,28,16,28,0,28,0,0,255,0,255,0,255,0,255],m=[28,0];break}case v.krs:{E=[45,0,45,0,0,255,45,0,45,0,45,0,45,0,45,0],m=[45,0];break}default:E=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}for(let $=0;$<g.efx;$++)if(!a(h,fe)[3*$]&&typeof E[$<<1]=="number"){a(h,fe)[3*$+1]=E[$<<1],a(h,fe)[3*$+2]=E[$<<1|1];let S=!1;(m==null?void 0:m.length)>0&&E[$<<1]===m[0]&&E[$<<1|1]===m[1]&&(S=!0),h.pushEffectType($,S)}l&&h.setDetectionTargets(e),h.dispatchEvent("mode",Y[p]),h.forceVoiceRefresh()}}else throw new Error(`Unknown mode ${e}`)}getRawStrength(){let e=this;return a(this,Q).forEach(function(r){let l=r>>7;a(e,Z)[r]>a(e,Se)[l]&&(a(e,Se)[l]=a(e,Z)[r])}),a(this,Se)}getStrength(){let e=[],r=this;return this.getRawStrength().forEach(function(l,h){e[h]=Math.floor(l*r.getChCc(h,7)*r.getChCc(h,11)*a(r,V)/803288)}),e}newStrength(){a(this,Se).fill(0)}runJson(e){var r;if(e.type>14)return e.type===15&&e.data.constructor!==Uint8Array&&(e.data=Uint8Array.from(e.data)),a(this,mt)[e.type].call(this,e);{let l=this.chRedir(e.part,e.track),h=!1;(r=a(this,Ct)[l])==null||r.forEach(p=>{e.channel=p,h=!0,a(this,mt)[e.type].call(this,e)}),h||console.warn(`${fa[e.type]?fa[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!==void 0?e.data[0]:e.data).toString():""} event sent to CH${l+1} without any recipient.`)}a(this,he).length>100&&a(this,he).splice(100,a(this,he).length-99)}runRaw(e){}async loadBank(e,r){let l=this;switch(e=e.toLowerCase(),e){case"s7e":{l.userBank.clearRange({msb:63,lsb:[21,22]}),l.userBank.clearRange({msb:63,lsb:[24,27]});break}case"pcg":{l.userBank.clearRange({msb:63,lsb:[6,9]}),l.userBank.clearRange({msb:63,lsb:[13,16]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":case"pcg":{ft.context=this,await l.userBank.load(await ft.read(e,r),!1);break}}l.forceVoiceRefresh()}},H=new WeakMap,re=new WeakMap,Ce=new WeakMap,me=new WeakMap,Ae=new WeakSet,at=function(){return a(this,me)[a(this,re)]},za=function(e){a(this,me)[a(this,re)]=e},de=new WeakMap,G=new WeakMap,O=new WeakMap,k=new WeakMap,te=new WeakMap,N=new WeakMap,Z=new WeakMap,se=new WeakMap,Q=new WeakMap,X=new WeakMap,Pe=new WeakMap,Se=new WeakMap,He=new WeakMap,ie=new WeakMap,D=new WeakMap,B=new WeakMap,rt=new WeakMap,ce=new WeakMap,ke=new WeakMap,fe=new WeakMap,_e=new WeakMap,Ge=new WeakMap,z=new WeakMap,st=new WeakMap,Xe=new WeakMap,ue=new WeakMap,Ke=new WeakMap,it=new WeakMap,Oe=new WeakMap,ve=new WeakMap,nt=new WeakMap,Ie=new WeakMap,j=new WeakMap,U=new WeakMap,xe=new WeakMap,gt=new WeakMap,V=new WeakMap,Fe=new WeakMap,ct=new WeakMap,Bt=new WeakMap,Ht=new WeakMap,_t=new WeakMap,Gt=new WeakMap,De=new WeakMap,Le=new WeakMap,Et=new WeakMap,ot=new WeakMap,Te=new WeakMap,K=new WeakMap,$t=new WeakMap,Ct=new WeakMap,W=new WeakMap,lt=new WeakMap,Ve=new WeakMap,he=new WeakMap,Re=new WeakMap,Ue=new WeakMap,ne=new WeakMap,Ye=new WeakMap,J=new WeakMap,mt=new WeakMap,St=new WeakMap,ze=new WeakMap,We=new WeakMap,ee=new WeakMap,pe=new WeakMap,we=new WeakMap,qe=new WeakMap,Qe=new WeakMap,je=new WeakMap,Ea);export{Gr as OctaviaDevice,g as allocated,w as ccToPos,Ee as dnToPos,ya as effectSlots,L as getDebugState,yt as overrides};