var Ke=Object.create;var fe=Object.defineProperty;var ze=Object.getOwnPropertyDescriptor;var qe=Object.getOwnPropertyNames;var We=Object.getPrototypeOf,Qe=Object.prototype.hasOwnProperty;var Ye=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var je=(e,t,c,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let h of qe(t))!Qe.call(e,h)&&h!==c&&fe(e,h,{get:()=>t[h],enumerable:!(o=ze(t,h))||o.enumerable});return e};var Ze=(e,t,c)=>(c=e!=null?Ke(We(e)):{},je(t||!e||!e.__esModule?fe(c,"default",{value:e,enumerable:!0}):c,e));var Le=Ye((Vt,re)=>{(function(){"use strict";let e={fatal:!0},t=[new TextDecoder("iso-8859-15",e),new TextDecoder("sjis",e),new TextDecoder("euc-jp",e),new TextDecoder("utf-8",e),new TextDecoder("utf-16",e),new TextDecoder("ascii")],c={debug:!1,parse:function(o,h){if(o instanceof Uint8Array)return c.Uint8(o);if(typeof o=="string")return c.Base64(o);if(o instanceof HTMLElement&&o.type==="file")return c.addListener(o,h);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(o,h){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(o===void 0||!(o instanceof HTMLElement)||o.tagName!=="INPUT"||o.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;h=h||function(){},o.addEventListener("change",function(u){if(!u.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let m=new FileReader;m.readAsArrayBuffer(u.target.files[0]),m.onload=function(r){h(c.Uint8(new Uint8Array(r.target.result)))}})},Base64:function(o){let h=function(r){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(r=r.replace(/^.*?base64,/,""),r=String(r).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(r))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");r+="==".slice(2-(3&r.length));let n,s="",a,l,f=0;for(;f<r.length;)n=i.indexOf(r.charAt(f++))<<18|i.indexOf(r.charAt(f++))<<12|(a=i.indexOf(r.charAt(f++)))<<6|(l=i.indexOf(r.charAt(f++))),s+=a===64?String.fromCharCode(n>>16&255):l===64?String.fromCharCode(n>>16&255,n>>8&255):String.fromCharCode(n>>16&255,n>>8&255,255&n);return s}(o=String(o));var u=h.length;let m=new Uint8Array(new ArrayBuffer(u));for(let r=0;r<u;r++)m[r]=h.charCodeAt(r);return c.Uint8(m)},Uint8:function(m){let h={data:null,pointer:0,movePointer:function(a){return this.pointer+=a,this.pointer},readInt:function(a){if((a=Math.min(a,this.data.byteLength-this.pointer))<1)return-1;let l=0;if(1<a)for(let f=1;f<=a-1;f++)l+=this.data.getUint8(this.pointer)*Math.pow(256,a-f),this.pointer++;return l+=this.data.getUint8(this.pointer),this.pointer++,l},readStr:function(a){let l=new Uint8Array(a),f=!1,d;l.forEach((p,g)=>{l[g]=this.readInt(1)});for(let p=0;p<t.length;p++)if(!f)try{if(d=t[p].decode(l),p==0)for(let g=0;g<d.length;g++){let v=d.charCodeAt(g);if(v>191||v>127&&v<160)throw new RangeError(`Invalid code point: ${v}`)}f=!0,console.debug(`String byte sequence in ${t[p].encoding}`)}catch(g){console.debug(`SMF string ${g}`)}return d||"String byte sequence read failed."},backOne:function(){this.pointer--},readIntVLV:function(){let a=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)a=this.readInt(1);else{let f=[];for(;128<=this.data.getUint8(this.pointer);)f.push(this.readInt(1)-128);var l=this.readInt(1);for(let d=1;d<=f.length;d++)a+=f[f.length-d]*Math.pow(128,d);a+=l}return a}};if(h.data=new DataView(m.buffer,m.byteOffset,m.byteLength),h.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;h.readInt(4);let u={};u.formatType=h.readInt(2),u.tracks=h.readInt(2),u.track=[];var m=h.readInt(1),r=h.readInt(1);128<=m?(u.timeDivision=[],u.timeDivision[0]=m-128,u.timeDivision[1]=r):u.timeDivision=256*m+r;for(let a=1;a<=u.tracks;a++){u.track[a-1]={event:[]};var i,n=h.readInt(4);if(n===-1)break;if(n!==1297379947)return!1;h.readInt(4);let l=0,f=!1,d,p;for(;!f&&(l++,u.track[a-1].event[l-1]={},u.track[a-1].event[l-1].deltaTime=h.readIntVLV(),(d=h.readInt(1))!==-1);)if(128<=d?p=d:(d=p,h.movePointer(-1)),d===255){u.track[a-1].event[l-1].type=255,u.track[a-1].event[l-1].metaType=h.readInt(1);var s=h.readIntVLV();switch(u.track[a-1].event[l-1].metaType){case 47:case-1:f=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:u.track[a-1].event[l-1].data=h.readStr(s);break;case 33:case 89:case 81:u.track[a-1].event[l-1].data=h.readInt(s);break;case 84:u.track[a-1].event[l-1].data=[],u.track[a-1].event[l-1].data[0]=h.readInt(1),u.track[a-1].event[l-1].data[1]=h.readInt(1),u.track[a-1].event[l-1].data[2]=h.readInt(1),u.track[a-1].event[l-1].data[3]=h.readInt(1),u.track[a-1].event[l-1].data[4]=h.readInt(1);break;case 88:u.track[a-1].event[l-1].data=[],u.track[a-1].event[l-1].data[0]=h.readInt(1),u.track[a-1].event[l-1].data[1]=h.readInt(1),u.track[a-1].event[l-1].data[2]=h.readInt(1),u.track[a-1].event[l-1].data[3]=h.readInt(1);break;default:this.customInterpreter!==null&&(u.track[a-1].event[l-1].data=this.customInterpreter(u.track[a-1].event[l-1].metaType,h,s)),this.customInterpreter!==null&&u.track[a-1].event[l-1].data!==!1||(h.readInt(s),u.track[a-1].event[l-1].data=h.readInt(s),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch((d=d.toString(16).split(""))[1]||d.unshift("0"),u.track[a-1].event[l-1].type=parseInt(d[0],16),u.track[a-1].event[l-1].channel=parseInt(d[1],16),u.track[a-1].event[l-1].type){case 15:this.customInterpreter!==null&&(u.track[a-1].event[l-1].data=this.customInterpreter(u.track[a-1].event[l-1].type,h,!1)),this.customInterpreter!==null&&u.track[a-1].event[l-1].data!==!1||(i=h.readIntVLV(),u.track[a-1].event[l-1].data=h.readInt(i),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:u.track[a-1].event[l-1].data=[],u.track[a-1].event[l-1].data[0]=h.readInt(1),u.track[a-1].event[l-1].data[1]=h.readInt(1);break;case 12:case 13:u.track[a-1].event[l-1].data=h.readInt(1);break;case-1:f=!0;break;default:if(this.customInterpreter!==null&&(u.track[a-1].event[l-1].data=this.customInterpreter(u.track[a-1].event[l-1].metaType,h,!1)),this.customInterpreter===null||u.track[a-1].event[l-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return u},customInterpreter:null};if(typeof re<"u")re.exports=c;else{let o=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;o.MidiParser=c}})()});var he=function(e,t){let c=Math.min(e.length,t.length),o=e.slice(0,c),h=t.slice(0,c),u=0,m=0;for(;m<c&&u==0;)u=Math.sign(o[m]-h[m]),m++;return u},D=function(e=""){this.name=e,this.pool=[],this.point=function(t,c=!1){if(this.pool.length>0){let o=this.pool.length,h=1<<Math.floor(Math.log2(o)),u=h,m=64;for(;h>=1&&m>=0;){if(m<=0)throw new Error("TTL reached.");if(u==o)u-=h;else{let i=he(t,this.pool[u]);switch(i){case 0:{m=0;break}case 1:{u+h<=o&&(u+=h);break}case-1:{u!=0&&(u-=h);break}default:console.warn(`Unexpected result ${i}.`)}}h=h>>1,m--}let r=!0;if(u>=this.pool.length)r=!1;else{let i=this;this.pool[u].forEach(function(n,s,a){r&&n!=t[s]&&(r=!1)}),!r&&he(t,this.pool[u])>0&&u++}return r||c?u:-1}else return c?0:-1},this.add=function(t,c){return t.data=c,this.pool.splice(this.point(t,!0),0,t),this},this.default=function(t){console.warn(`No match in "${this.name||"(unknown)"}" for "${t}". Default action not defined.`)},this.get=function(t){let c=this.point(t);if(c>-1)return this.pool[c].data;this.default(t)},this.run=function(t,...c){let o=this.point(t);o>-1?t.subarray?this.pool[o].data(t.subarray(this.pool[o].length),...c):this.pool[o].data(t.slice(this.pool[o].length),...c):this.default(t,...c)}};var K=class{#t={};addEventListener(e,t){this.#t[e]||(this.#t[e]=[]),this.#t[e].unshift(t)}removeEventListener(e,t){if(this.#t[e]){let c=this.#t[e].indexOf(t);c>-1&&this.#t[e].splice(c,1),this.#t[e].length<1&&delete this.#t[e]}}dispatchEvent(e,t){let c=new Event(e),o=this;c.data=t,this.#t[e]?.length>0&&this.#t[e].forEach(function(h){try{h?.call(o,c)}catch(u){console.error(u)}}),this[`on${e}`]&&this[`on${e}`](c)}};var Je=["MSB","PRG","LSB","NME","ELC","DRM"],Y=function(e){let t=Math.floor(e/10),c=e%10;return`${t.toString(16)}${c}`},j=class{#t;strictMode=!1;get(e=0,t=0,c=0,o){let h=[e,t,c],u,m=1,r=0,i,n=Array.from(arguments);switch(o){case"xg":{switch(e){case 0:{c==126?n[2]=125:c==127&&(n[2]=0);break}case 16:{c==126&&(n[2]=0);break}case 32:{c>125&&(n[2]=0),n[2]+=4;break}case 33:case 34:case 35:case 36:{c>125&&(n[2]=0),n[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:n[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{c==126&&(n[2]=0);break}case 48:case 64:case 126:case 127:{c==126&&(n[2]=0);break}}break}case"gs":{e==0&&c<5?n[2]=0:e>125&&c<5&&c!=2&&(n[2]=e,n[0]=0);break}case"g2":case"sd":{(e>>1==40||e>95&&e<100)&&(n[2]|=16);break}case"sg":{e==8&&c==0&&(n[2]=5);break}case"s90es":{c<8?n[2]+=17:c<32?n[2]+=13:n[2]=(n[2]>>3)+19;break}case"motif":{c<8?n[2]+=28:c<32?n[2]+=13:n[2]=(n[2]>>3)+19;break}}let s=" ",a="M",l=0,f=0;switch(n[0]){case 0:{n[2]==127?a="MT-a":n[2]==126?a="MT-b":n[2]==7?a="GM-k":n[2]==5?a="SG-a":n[2]==4?a="SP-l":n[2]==0||o=="gs"&&n[2]<5?a="GM-a":(a="y",l=3);break}case 8:{o=="sg"?a="GM-s":a="r:";break}case 32:case 33:case 34:case 35:case 36:{o=="xg"&&(a=`${["AP","VL","PF","DX","AN"][e&7]}-${"abcdefgh"[c]}`);break}case 48:{a=`yM${(n[2]>>3).toString().padStart(2,"0")}`,l=1;break}case 56:{a="GM-b";break}case 61:case 120:{a="rDrm";break}case 62:{a="kDrm";break}case 63:{if(n[2]<17){let v=n[2];a=v<10?"kP:":"kC:",a+=v%10}else n[2]<34?a=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][n[2]-17]:a="Ds";break}case 64:{a="ySFX";break}case 67:{a="DX:S";break}case 80:case 81:case 82:case 83:{a=`Prg${"UABC"[n[0]-80]}`;break}case 88:case 89:case 90:case 91:{a=`Cmb${"UABC"[n[0]-88]}`;break}case 95:{a=`${["DR","PC"][n[2]]}-d`;break}case 96:{a=n[2]==106?"AP-a":n[2]>>4==1?"SDg":"PF",n[2]>63?f=63:n[2]>>4==1&&(f=16),l=3;break}case 97:{a=n[2]>>4==1?"SDa":"VL:",l=3,n[2]>>4==1?f=16:f=112;break}case 98:{a=n[2]>>4==1?"SDb":"SG-a",l=3,f=16;break}case 99:{a=n[2]>>4==1?"SDc":"DX",n[2]>63?f=63:n[2]>>4==1&&(f=16),l=3;break}case 100:{a="AN",n[2]>63?f=63:n[2]>>4==1&&(f=16),l=3;break}case 104:case 105:case 106:case 107:{a="SDd",f=104;break}case 121:{a=`GM-${n[2]?"":"a"}`,l=3;break}case 122:{a="lDrm";break}case 126:{a="yDrS";break}case 127:{n[2]==127?a="rDrm":a="yDrm";break}default:n[0]<48?a="r:":a="M"}a.length<4&&(a+=`${[e,c,n[0],n[2]][l]-f}`.padStart(4-a.length,"0")),o=="xg"&&(e==0?n[2]<100?a=a.replace("y0","y:"):n[2]==125&&(a="y126"):e==16&&(u=`Voice${(n[2]*128+n[1]+1).toString().padStart(3,"0")}`,s=" "));let d=[n[0],n[1],n[2]];for(;!(u?.length>=0);)if(u=this.#t[n[1]||0][(n[0]<<7)+n[2]]?.name,u){let v=this.#t[n[1]||0][(n[0]<<7)+n[2]];m=v?.poly||m,r=v?.type||r,i=v?.drum}else if(this.strictMode)u="",s="?";else if(n[0]==0&&n[1]==0&&n[2]==0)u="Unloaded";else if(this.#t[n[1]||0][n[0]<<7])n[0]==0?(n[2]=0,s="^"):n[2]<1?(n[0]=0,s="*"):(n[2]--,s="^");else if(e==48)n[0]=0,n[2]=0,s="!";else if(e==62)n[1]--,s=" ",n[1]<1&&!u?.length&&(n[0]=0,s="!");else if(e<63)n[0]==0?(n[2]=0,s="^"):n[2]<1?(n[0]=0,s="*"):n[2]--;else if(e==80)u=`PrgU:${t.toString().padStart(3,"0")}`,s="!";else if(e==88)u=`CmbU:${t.toString().padStart(3,"0")}`,s="!";else if(e==121)u=`GM2Vox0${c}`,s="#";else if(e==122)if(n[1]==32?n[1]==0:n[1]%=7,u=this.#t[n[1]||0][(n[0]<<7)+n[2]]?.name,u){s=" ";let v=this.#t[n[1]||0][(n[0]<<7)+n[2]];m=v?.poly||m,r=v?.type||r,i=v?.drum}else u="",s="*";else n[1]==0?(u=`${e.toString().padStart(3,"0")} ${t.toString().padStart(3,"0")} ${c.toString().padStart(3,"0")}`,s="!"):n[0]==0?(n[2]=0,s="^"):n[2]>0?n[2]--:n[1]>0?(n[1]=0,s="!"):(n[0]=0,s="?");let p=[n[0],n[1],n[2]];(o=="gs"||o=="ns5r")&&s=="^"&&(s=" "),e==127&&s=="^"&&(s=" "),s!=" "&&self.debugMode&&(u="");let g="??";switch(n[0]){case 0:{n[2]==0?g="GM":n[2]==5||n[2]==7?g="KG":n[2]<126?g="XG":n[2]==127&&(g="MT");break}case 32:case 33:case 35:case 36:{n[2]>4?g=["AP","VL","PF","DX","AN"][n[0]-32]:g="GS";break}case 48:{g="MU";break}case 56:{g="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{g="AI";break}case 62:case 82:case 90:{g="XD";break}case 63:{n[2]<17?g="KR":n[2]<34?g="ES":g="DS";break}case 64:case 126:{g="XG";break}case 67:case 99:{g=n[2]>>4==1?"SD":"DX";break}case 81:{g="RW";break}case 95:{g=["DR","PC"][n[2]];break}case 96:{g=n[2]==106?"AP":n[2]>>4==1?"SD":"PF";break}case 97:{g=n[2]>>4==1?"SD":"VL";break}case 98:{g=n[2]>>4==1?"SD":"SG";break}case 100:{g="AN";break}case 104:case 105:case 106:case 107:{g="SD";break}case 120:{g="GS";break}case 121:{g=n[2]?"G2":"GM";break}case 122:{g="KG";break}case 127:{g=n[2]==127?"MT":t==0?"GM":"XG";break}default:n[0]<48&&(n[0]==16&&o=="xg"?g="XG":g="GS")}return{name:u||`${Y(e||0)} ${Y(t||0)} ${Y(c||0)}`,poly:m,type:r,drum:i,iid:d,eid:p,sid:h,ending:s,sect:a,standard:g}}async load(e,t,c="(internal)"){let o=this,h=[],u=0,m=0;e.split(`
`).forEach(function(r,i){let n=r.split("	"),s=[];if(i==0){if(n.forEach(function(a,l){h[Je.indexOf(a)]=l}),h.length<4){console.debug("Debugger launched.");debugger}}else{let a=0,l=0,f=0,d,p=1,g=0,v;n.forEach(async function($,I){switch(I){case h[0]:{a=parseInt($);break}case h[1]:{l=parseInt($);break}case h[2]:{f=parseInt($);break}case h[3]:{d=$;break}case h[4]:{$=parseInt($),$<16?p=$+1:g=($&15)+1;break}case h[5]:{v=$;break}}}),o.#t[l]=o.#t[l]||[];let k=o.#t[l];if(!k[a<<7|f]||t){let $={msb:a,prg:l,lsb:f,name:d,poly:p,type:g,drum:v};k[a<<7|f]=$,u++}m++}}),t||console.debug(`Map "${c}": ${m} total, ${u} loaded.`)}clearRange(e){let t=e.prg!=null?e.prg.constructor==Array?e.prg:[e.prg,e.prg]:[0,127],c=e.msb!=null?e.msb.constructor==Array?e.msb:[e.msb,e.msb]:[0,127],o=e.lsb!=null?e.lsb.constructor==Array?e.lsb:[e.lsb,e.lsb]:[0,127];for(let h=c[0];h<=c[1];h++){let u=h<<7;for(let m=o[0];m<=o[1];m++){let r=u+m;for(let i=t[0];i<=t[1];i++)delete this.#t[i][r]}}}init(){this.#t=[];for(let e=0;e<128;e++)this.#t.push([""])}async loadFiles(...e){this.init();let t=this;e.forEach(async function(c){try{await fetch(`./data/bank/${c}.tsv`).then(function(o){return o.text()}).then(o=>{t.load(o,!1,c)})}catch{console.error(`Failed loading "${c}.tsv".`)}})}constructor(...e){this.loadFiles(...e)}};var ue=class{#t={};context;set(e,t){this.#t[e]=t}has(e){return!!this.#t[e]}async read(e,t){if(!this.has(e))throw new Error(`No decoder registered for "${e}"`);return await this.#t[e].call(this.context||this,t)}};var et=function(e,t){let c=!0;return t.forEach((o,h)=>{c=c&&e[h]==o}),c},pe=function(e){let t=0;return e.forEach(c=>{t*=256,t+=c}),t},H=new TextDecoder,z=new ue;z.set("s7e",async function(e){let t=new Uint8Array(await e.slice(0,65536).arrayBuffer()),c="MSB	LSB	PRG	NME",o=[0,0,0,0],h=32,u=0,m=0,r=!0,i=[],n=0;for(;r;){let s=t.subarray(u);([()=>{H.decode(s.subarray(0,4))=="YSFC"?(u+=80,m=1):u++},()=>{if(et(s.subarray(0,4),o))i.forEach((a,l,f)=>{let d=pe(t.subarray(a.start+4,a.start+8));a.length=d}),m=2;else{let a=H.decode(s.subarray(0,4)),l=pe(s.subarray(4,8));i.push({type:a,start:l}),u+=8}},()=>{let a=i[n],l=t.subarray(a.start,a.start+a.length),f=32;switch(a.type){case"ENVC":{let d=h;for(;d<l.length;){let p=l.subarray(d,d+f),g=H.decode(p.subarray(0,10)).trimEnd();g.slice(0,5)=="Init "&&(g=""),g&&(c+=`
063	${(p[17]+13).toString().padStart(3,"0")}	${p[19].toString().padStart(3,"0")}	${g}`),d+=f}break}case"EDVC":{let d=h;for(;d<l.length;){let p=l.subarray(d,d+f),g=H.decode(p.subarray(0,10)).trimEnd();g.slice(0,5)=="Init "&&(g=""),g&&(c+=`
063	024	${p[19].toString().padStart(3,"0")}	${g}`),d+=f}break}case"EPVC":{let d=32,p=h;for(;p<l.length;){let g=l.subarray(p,p+d),v=H.decode(g.subarray(0,10)).trimEnd();v=="----------"&&(v=""),v&&(c+=`
063	${(g[17]+1).toString().padStart(3,"0")}	${g[19].toString().padStart(3,"0")}	${v}`),p+=d}break}}n++,n>=i.length&&(m=3,r=!1)}][m]||(()=>{r=!1}))()}return c});var G=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),X=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],tt=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],B=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],be=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],ge=function(e){let t=.1,c=-.3;return e>66?(t=5,c=315):e>56?(t=1,c=47):e>46&&(t=.5,c=18.5),t*e-c},me=function(e){return e>105?tt[e-106]:e>100?e*1.1-100:e/10},ye=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),Z={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,うぃ
we,うぇ
wo,を
nga,ガ
ngi,ギ
ngu,グ
nge,ゲ
ngo,ゴ
ngy,ギ!
ng,
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,いぇ
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(e=>{let t=e.split(",");Z[t[0]]=t[1]});var ve=function(e){let t=e;e[0]=="*"&&(t=t.slice(1)),["aa","ii","uu","ee","oo"].forEach(o=>{for(;t.indexOf(o)>-1;)t=t.replace(o,o[0])});for(let o in Z)t=t.replaceAll(o,Z[o]);t.indexOf("ん")==0&&t.length>1&&(t=t.slice(1));let c=t.indexOf("!");return c>-1&&t.length>1&&(t=t.slice(c+1)),t},Ee=function(e){return e?e<96?`cc${e}`:["aftertouch","velocity","pitch bend"][e-96]:"off"};var J=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],we=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],$e=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var at={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},rt={66307:["drive"],66309:["vowel",e=>"aiueo"[e]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",e=>["off","LPF","HPF"][e]],94984:["noise type",e=>["white","pink"][e]],94987:["disc type",e=>["LP","SP","EP","RND"]],94990:["hum type",e=>`${e+5}0Hz`],94993:["M/S",e=>["mono","stereo"][e]]},ee=function(e){return at[(e[0]-32<<8)+e[1]]||`0x${e[0].toString(16).padStart(2,"0")}${e[1].toString(16).padStart(2,"0")}`},ke=function(e,t,c){let o=(e[0]-32<<16)+(e[1]<<8)+t,h=rt[o]||{},u=h[0];if(u?.length)return u+=`: ${(h[1]||function(){})(c)||c}`,u},te=[68,48,95,78,41,3,110,122,0];var C=function(e=64){return Math.round(2e3*Math.log10(e/64))/100},xe=function(e,t,c){let o=[],h=c==!1?t.readIntVLV():c;e==0||e==127;for(let u=0;u<h;u++){let m=t.readInt(1);if(o.push(m),m!=247){if(m!=240){if(m>127)return console.debug(`Early termination: ${o}`),o.pop(),t.backOne(),t.backOne(),new Uint8Array(o)}}}return new Uint8Array(o)},ae=function(e){let t=0;return e.forEach(c=>{t+=c,t=t&127}),~t+1&127},O=function(e,t){let c=0,o=0;for(let h=0;h<e.length;h++){let u=h%8-1,m=(o>>u&1)<<7,r=e[h];r+=m,h%8!=0?(t(r,c,e),c++):o=e[h]}},_=function(e){let t=Math.floor(e*14.2);return t<128?t:0};var A=["?","gm","gs","xg","g2","mt32","ns5r","x5d","05rw","sd","k11","sg","krs","s90es","motif"],it=["melodic","drum","menu"],Se=[[0,0,0,0,121,0,0,82,81,97,0,0,63,63,63],[0,0,4,0,0,127,0,0,0,0,0,0,0,0,0]],U=[120,127,120,127,120,127,61,62,62,105,122,122,120,127,127],st=[0,3,81,84,88],Te={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},Ce={0:0,1:1,2:3,5:4},Me={0:0,1:1,2:2,5:3},Re=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],De=[36,37,48,49,52,53],q=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],Oe={26:127,29:0,30:0,31:0,52:12,53:54},F=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,128,12,13,16,17,18,19,14,15,20,21,26,28],nt=[12,13,14,15,16,17,18,19,20,21],ct=[33,99,100,32,102,8,9,10],Pe=[0,16,25,40,32,64,26,48],w={};A.forEach((e,t)=>{w[e]=t});var b={length:F.length};F.forEach((e,t)=>{b[e]=t});var R={length:q.length};q.forEach((e,t)=>{R[e]=t});var lt={};it.forEach((e,t)=>{lt[e]=t});var x=function(){return!!self.Bun||self.debugMode||!1},ot=function(e){let t=[],c=0;return e?.forEach(function(o,h){o==247?t.push(e.subarray(c,h)):o==240&&(c=h+1)}),t.length||t.push(e.subarray(0)),x()&&console.debug(t),t};var y={ch:128,cc:F.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,ace:8,drm:8,dpn:q.length,dnc:128,efx:7},Ae=class extends K{NOTE_IDLE=0;NOTE_ATTACK=1;NOTE_DECAY=2;NOTE_SUSTAIN=3;NOTE_HELD=4;NOTE_RELEASE=5;NOTE_SOSTENUTO_ATTACK=8;NOTE_SOSTENUTO_DECAY=9;NOTE_SOSTENUTO_SUSTAIN=10;NOTE_SOSTENUTO_HELD=11;CH_MELODIC=0;CH_DRUMS=1;CH_DRUM1=2;CH_DRUM2=3;CH_DRUM3=4;CH_DRUM4=5;CH_DRUM5=6;CH_DRUM6=7;CH_DRUM7=8;CH_DRUM8=9;#t=0;#h=0;#E=0;#o=new Array(11);get#m(){return this.#o[this.#h]}set#m(e){this.#o[this.#h]=e}#w=new Uint8Array(y.ch);#u=new Uint8Array(y.ch);#s=new Uint8Array(y.ch);#e=new Uint8Array(y.ch*y.cc);#d=new Uint8Array(y.ace);#n=new Uint8Array(y.ch);#l=new Uint8Array(y.ch*y.nn);#p=new Uint8Array(y.ch);#b=new Uint16Array(y.pl);#v=new Uint8Array(y.pl);#D=new Int16Array(y.ch);#C=new Uint8Array(y.ch);#H=0;#r=new Uint8Array(y.ch*y.rpn);#i=new Uint8Array(y.ch*y.rpnt);#I=new Int8Array(y.ch*De.length);#x=new Uint8Array(y.drm*y.dpn*y.dnc);#a=new Uint8Array(y.ch);#$=new Uint8Array(128);#c=new Uint8Array(y.cmt*8);#y=new Uint8Array(1024);#S=new Uint8Array(y.cmt*64);#T=new Uint8Array(y.efx*3);#G=new Uint8Array(y.ch);#O=0;#M=0;#f=100;#X=0;#z=500;#U=0;#_="";#N=0;#q=0;#F=0;#B=!0;#g=!1;#te;#ie=new Uint8Array(2);#P=[];#V=new Uint8Array(y.ch);#W=new Uint8Array(y.tr);baseBank=new j("gm","gm2","xg","gs","ns5r","sd","gmega","plg-150vl","plg-150pf","plg-150dx","plg-150an","plg-150dr","plg-100sg","kross","s90es");userBank=new j("gm");initOnReset=!1;aiEfxName="";chRedir(e,t,c){if(this.#W[t])return(this.#W[t]-1)*16+e;if([2,3].indexOf(this.#M)>-1){if(c==1)return e;let o=0,h=!0;for(;h;)this.#V[e+o]==0?(this.#V[e+o]=t,console.debug(`Assign track ${t} to channel ${e+o+1}.`),h=!1):this.#V[e+o]==t?h=!1:(o+=16,o>=128&&(o=0,h=!1));return e+o}else return e}forceVoiceRefresh(){for(let e=0;e<y.ch;e++)this.#w[e]&&this.dispatchEvent("voice",{part:e})}#R=[];#Q;#k={nOff:(e,t)=>{let c=e*128+t,o=this.#b.lastIndexOf(c);o>-1&&(this.#e[y.cc*e+b[64]]>63?(this.#v[o]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:t,velo:this.#l[c],state:this.NOTE_HELD})):this.#e[y.cc*e+b[66]]>63&&this.#v[o]==this.NOTE_SOSTENUTO_SUSTAIN?(this.#v[o]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:t,velo:this.#l[c],state:this.NOTE_SOSTENUTO_HELD})):(this.#b[o]=0,this.#l[c]=0,this.#v[o]=this.NOTE_IDLE,this.dispatchEvent("note",{part:e,note:t,velo:0,state:this.NOTE_IDLE})))},nOn:(e,t,c)=>{let o=e*128+t,h=0;for(this.#p[e]&&this.#k.ano(e);this.#v[h]>0&&this.#b[h]!=o;)h++;h<y.pl?(this.#b[h]=o,this.#l[o]=c,this.#v[h]=this.NOTE_SUSTAIN,this.#C[e]<c&&(this.#C[e]=c),this.dispatchEvent("note",{part:e,note:t,velo:c,state:this.NOTE_SUSTAIN})):console.error("Polyphony exceeded.")},nAt:(e,t,c)=>{},cAt:(e,t)=>{},hoOf:e=>{this.#v.forEach((t,c)=>{if(t==this.NOTE_HELD){let o=this.#b[c],h=o>>7;e==h&&(this.#v[c]=this.NOTE_IDLE,this.#b[c]=0,this.#l[o]=0,this.dispatchEvent("note",{part:e,note:o&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{this.#v.forEach((t,c)=>{let o;switch(t){case this.NOTE_ATTACK:{o=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{o=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{o=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(o){this.#v[c]=o;let h=this.#b[c];this.dispatchEvent("note",{part:e,note:h&127,velo:this.#l[h],state:o})}})},soOf:e=>{this.#v.forEach((t,c)=>{if(t==this.NOTE_SOSTENUTO_HELD){let o=this.#b[c],h=o>>7;e==h&&(this.#v[c]=this.NOTE_IDLE,this.#b[c]=0,this.#l[o]=0,this.dispatchEvent("note",{part:e,note:o&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{this.#b.forEach((t,c,o)=>{let h=t>>7,u=t&127;t==0&&this.#l[0]==0||h==e&&this.#k.nOff(h,u)})}};#ae={8:function(e){let t=e.channel,c=e.data[0];this.#k.nOff(t,c)},9:function(e){let t=e.channel;this.setChActive(t,1);let c=e.data[0],o=e.data[1];o>0?this.#k.nOn(t,c,o):this.#k.nOff(t,c)},10:function(e){let t=e.channel,c=t*128+e.data[0];this.#b.indexOf(c)>-1&&(this.#l[c]=data[1],this.dispatchEvent("note",{part:t,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let t=e.channel;[0,32].indexOf(e.data[0])>-1&&(()=>{switch(this.#t){case w.s90es:case w.motif:{if(e.data[0]==0){[0,63].indexOf(e.data[1])>-1&&this.setChActive(t,1);break}e.data[1]&&this.setChActive(t,1);break}default:{this.setChActive(t,1);break}}})();let c=t*y.cc;switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{this.#k.ano(t),this.#D[t]=0;let o=t*y.cc;this.#e[o+b[1]]=0,this.#e[o+b[5]]=0,this.#e[o+b[64]]=0,this.#e[o+b[65]]=0,this.#e[o+b[66]]=0,this.#e[o+b[67]]=0,this.#e[o+b[11]]=127,this.#e[o+b[101]]=127,this.#e[o+b[100]]=127,this.#e[o+b[99]]=127,this.#e[o+b[98]]=127;return}case 123:{this.#k.ano(t);return}case 124:{this.#k.ano(t);return}case 125:{this.#k.ano(t);return}case 126:{this.#p[t]=1,this.#k.ano(t);return}case 127:{this.#p[t]=0,this.#k.ano(t);return}}if(b[e.data[0]]==null)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(nt.indexOf(e.data[0])>-1&&this.allocateAce(e.data[0]),e.data[0]){case 0:{switch(x()&&console.debug(`${A[this.#t]}, CH${t+1}: ${e.data[1]}`),this.#t==0?e.data[1]<48?(this.#s[t]>0&&(e.data[1]=this.#e[c],e.data[1]=120,console.debug(`Forced channel ${t+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]==62?this.switchMode("x5d"):e.data[1]==63?this.switchMode("krs"):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg"):this.#t==w.gs?e.data[1]<56&&this.#s[t]>0&&(e.data[1]=this.#e[c],e.data[1]=120,console.debug(`Forced channel ${t+1} to stay drums.`)):this.#t==w.gm?e.data[1]<48?this.#s[t]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${t+1} to stay drums.`)):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg",!0):this.#t==w.x5d&&e.data[1]>0&&e.data[1]<8&&this.switchMode("05rw",!0),this.#t){case w.xg:{[79,95,126,127].indexOf(e.data[1])>-1?this.#s[t]==0&&(this.setChType(t,this.CH_DRUM2),console.debug(`CH${t+1} set to drums by MSB.`)):this.#s[t]>0&&(this.setChType(t,this.CH_MELODIC),console.debug(`CH${t+1} set to melodic by MSB.`));break}case w["05rw"]:case w.x5d:case w.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?this.#s[t]==this.CH_MELODIC&&(this.setChType(t,this.CH_DRUM2),console.debug(`CH${t+1} set to drums by MSB.`)):[80,81,82,83].indexOf(e.data[1])>-1||this.#s[t]!=this.CH_MELODIC&&(this.setChType(t,this.CH_MELODIC),console.debug(`CH${t+1} set to melodic by MSB.`));break}case w.sd:{[104,105,106,107].indexOf(e.data[1])>-1?this.#s[t]==0&&(this.setChType(t,this.CH_DRUM2),console.debug(`CH${t+1} set to drums by MSB.`)):this.#s[t]>0&&(this.setChType(t,this.CH_MELODIC),console.debug(`CH${t+1} set to melodic by MSB.`));break}case w.g2:{e.data[1]==120?this.#s[t]==0&&(this.setChType(t,this.CH_DRUMS),console.debug(`CH${t+1} set to drums by MSB.`)):this.#s[t]>0&&(this.setChType(t,this.CH_MELODIC),console.debug(`CH${t+1} set to melodic by MSB.`));break}}this.dispatchEvent("voice",{part:t});break}case 6:{if(this.#H){[w.xg,w.gs,w.ns5r].indexOf(this.#t)<0&&console.warn(`NRPN commits are not available under "${A[this.#t]}" mode, even when they are supported in Octavia.`);let o=this.#e[c+b[99]],h=this.#e[c+b[98]];if(o==1){let u=ct.indexOf(h);if(u>-1)this.#e[c+b[71+u]]=e.data[1],x()&&console.debug(`Redirected NRPN 1 ${h} to cc${71+u}.`),this.dispatchEvent("cc",{part:t,cc:71+u,data:e.data[1]});else{let m=De.indexOf(h);m>-1?this.#I[t*10+m]=e.data[1]-64:console.warn(`NRPN 0x01${h.toString(16).padStart(2,"0")} is not supported.`),x()&&console.debug(`CH${t+1} voice NRPN ${h} commit`)}}else{if(q.indexOf(o)<0){let m=`NRPN 0x${o.toString(16).padStart(2,"0")}${h.toString(16).padStart(2,"0")} `;o==127?console.warn(`${m}is not necessary. Consider removing it.`):console.warn(`${m}is not supported.`)}else{let m=this.#s[t]-2;m<0?console.warn(`CH${t+1} cannot accept drum NRPN as type ${X[this.#s[t]]}.`):this.#x[(m*y.dpn+R[o])*y.dnc+h]=e.data[1]}x()&&console.debug(`CH${t+1} (${X[this.#s[t]]}) drum NRPN ${o} commit`)}}else{let o=Ce[this.#e[c+b[100]]],h=Me[this.#e[c+b[100]]];this.#e[c+b[101]]==0&&o!=null&&(x()&&console.debug(`CH${t+1} RPN 0 ${this.#e[c+b[100]]} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],Re[o][0]),Re[o][1]),this.#r[t*y.rpn+o]=e.data[1],this.#i[t*y.rpnt+h]=1)}break}case 32:{switch(x()&&console.debug(`${A[this.#t]}, CH${t+1} LSB: ${e.data[1]}`),this.#t){case w.s90es:case w.motif:{this.setChType(t,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,this.#t,!0);break}}this.dispatchEvent("voice",{part:t});break}case 38:{if(!this.#H){let o=Ce[this.#e[c+100]],h=Me[this.#e[c+100]];this.#e[c+101]==0&&o!=null&&(this.#r[t*y.rpn+o+1]=e.data[1],this.#i[t*y.rpnt+h]=1)}break}case 64:{e.data[1]<64&&this.#k.hoOf(t);break}case 66:{e.data[1]>>6?this.#k.soOn(t):this.#k.soOf(t);break}case 98:case 99:{this.#H=1;break}case 100:case 101:{this.#H=0;break}}this.#e[c+b[e.data[0]]]=e.data[1],this.dispatchEvent("cc",{part:t,cc:e.data[0],data:e.data[1]})}},12:function(e){let t=e.channel;switch(this.#t){case w.s90es:case w.motif:{e.data&&this.setChActive(t,1);break}default:this.setChActive(t,1)}this.#n[t]=e.data,this.#a[t]=0,x()&&console.debug(`T:${e.track} C:${t} P:${e.data}`),this.dispatchEvent("voice",{part:t})},13:function(e){let t=this,c=e.channel;this.#b.forEach(function(o){let h=o>>7;c==h&&(t.#l[o]=e.data,t.dispatchEvent("note",{part:c,note:o&127,velo:e.data,state:t.NOTE_SUSTAIN}))})},14:function(e){let t=e.channel;this.#D[t]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:t,pitch:this.getPitchShift(t)})},15:function(e){ot(e.data).forEach(t=>{let c=t[0],o=t[1];(this.#re[c]||function(){console.debug(`Unknown manufacturer ${c}.`)})(o,t.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(this.#R[e.meta]||function(c,o,h){}).call(this,e.data,e.track,e.meta),e.meta!=32&&(this.#X=0);let t=st.indexOf(e.meta)>-1;if(x()&&console.debug(e),t)return e.reply="meta",e}};#re={64:(e,t,c)=>{this.#Z.run(t,c,e)},65:(e,t,c)=>{if(t[0]<16)if(t[1]==72){let o=t[t.length-1],h=ae(t.subarray(3,t.length-1));o==h?this.#L.run(t.subarray(0,t.length-1),c,e):console.warn(`Bad SD checksum ${o}. Should be ${h}.`)}else this.#L.run(t,c,e);else{let o=t[t.length-1],h=ae(t.subarray(2,t.length-1));o==h?this.#L.run(t.subarray(0,t.length-1),c,e):console.warn(`Bad GS checksum ${o}. Should be ${h}.`)}},66:(e,t,c)=>{this.#K.run(t,c,e)},67:(e,t,c)=>{this.#A.run(t,c,e)},68:(e,t,c)=>{this.#ee.run(t,c,e)},71:(e,t,c)=>{this.#J.run(t,c,e)},126:(e,t,c)=>{this.#Y.run(t,c,e)},127:(e,t,c)=>{this.switchMode("gm"),this.#j.run(t,c,e)}};#Y;#j;#A;#L;#K;#Z;#J;#ee;buildRchTree(){let e=[];this.#u.forEach((t,c)=>{t<y.ch&&(e[t]?.constructor||(e[t]=[]),e[t].push(c))}),this.#te=e}getActive(){return this.#w}getCc(e){let t=e*y.cc,c=this.#e.subarray(t,t+y.cc);return c[b[0]]=c[b[0]]||this.#O,c[b[32]]=c[b[32]]||this.#M,c}getCcCh(e,t){if(F.indexOf(t)<0)throw new Error("CC number not accepted");return this.#e[y.cc*e+b[t]]}getCcAll(){let e=this.#e.slice();for(let t=0;t<y.ch;t++){let c=t*y.cc;e[c+b[0]]=e[c+b[0]]||this.#O,e[c+b[32]]=e[c+b[32]]||this.#M}return e}getChSource(){return this.#u}getChType(){return this.#s}setChType(e,t,c=this.#t,o=!1){t&=15,this.#s[e]=t,t>0&&!o&&(this.#e[e*y.cc+b[0]]=U[c])}setChActive(e,t=0){this.#w[e]!=t&&this.dispatchEvent("channeltoggle",{part:e,active:t}),this.#w[e]=t}getPitch(){return this.#D}getProgram(){return this.#n}getTexts(){return this.#P.slice()}getVel(e){let t=new Map,c=this;return c.#b.forEach(function(o,h){let u=Math.floor(o/128),m=o%128;e==u&&c.#l[o]>0&&t.set(m,{v:c.#l[o],s:c.#v[h]})}),t}getBitmap(){return{bitmap:this.#m,expire:this.#E}}getLetter(){return{text:this.#_,set:this.#q,expire:this.#N}}getMode(){return A[this.#t]}getMaster(){return{volume:this.#f}}getRawStrength(){let e=this;return this.#b.forEach(function(t){let c=Math.floor(t/128);e.#l[t]>e.#C[c]&&(e.#C[c]=e.#l[t])}),this.#C}getStrength(){let e=[],t=this;return this.getRawStrength().forEach(function(c,o){e[o]=Math.floor(c*t.#e[o*y.cc+b[7]]*t.#e[o*y.cc+b[11]]*t.#f/803288)}),e}getRpn(){return this.#r}getNrpn(){return this.#I}getVoice(e,t,c,o){let h=e||this.#O,u=t,m=c||this.#M;A[this.#t]=="ns5r"&&h>0&&h<56&&(m=3);let r=this.userBank.get(h,u,m,o);if(A[this.#t]=="mt32"&&r.name.indexOf("MT-m:")==0){let i=parseInt(r.name.slice(5)),n=i*y.cmt,s="";this.#S.subarray(n,n+10).forEach(l=>{l>31&&(s+=String.fromCharCode(l))});let a=`MSB	LSB	PRG	NME
0	127	${u}	${s}`;this.userBank.load(a,!0),r.name=s,r.ending=" "}return(r.ending!=" "||!r.name.length)&&(r=this.baseBank.get(h,u,m,o)),r}getChVoice(e){let t=this.getVoice(this.#e[e*y.cc+b[0]],this.#n[e],this.#e[e*y.cc+b[32]],A[this.#t]);if(this.#a[e])switch(this.#t){case w.mt32:t.ending="~",t.name="",this.#c.subarray(14*(e-1),14*(e-1)+10).forEach(c=>{c>31&&(t.name+=String.fromCharCode(c))})}return t}getPitchShift(e){let t=this,c=e*y.rpn,o=t.#r[c];return t.#i[e*y.rpnt]||t.#t==w.mt32&&(o=12),t.#D[e]/8192*o+(t.#r[c+3]-64)+((t.#r[c+1]<<7)+t.#r[c+2]-8192)/8192}getEffectType(e=0){let t=3*e+1;return this.#T.subarray(t,t+2)}setEffectTypeRaw(e=0,t,c){let o=3*e;this.#T[o]=1,this.#T[o+1+ +t]=c}setEffectType(e=0,t,c){this.setEffectTypeRaw(e,!1,t),this.setEffectTypeRaw(e,!0,c)}getEffectSink(){return this.#G}setLetterDisplay(e,t,c=0,o=3200){let h=this,u;h.#_=" ".repeat(c),e.forEach(m=>{h.#_+=String.fromCharCode(m>31?m:32),m<32&&(u=u||new Set,u.add(m))}),h.#q=Date.now(),h.#N=Date.now()+o,u&&(u=Array.from(u),u.forEach((m,r,i)=>{i[r]=m.toString(16).padStart(2,"0")}),console.warn(`${t}${t?" ":""}invalid code point${u.length>1?"s":""}: 0x${u.join(", 0x")}`))}allocateAce(e){if(!e||e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}let t=!0,c=0;for(;t&&c<y.ace;)this.#d[c]==e?t=!1:this.#d[c]||(t=!1,this.#d[c]=e,console.info(`Allocated cc${e} to ACE slot ${c}.`)),c++;c>=y.ace&&console.warn("ACE slots are full.")}getAce(){return this.#d}getChAce(e,t){if(t<0||t>=y.ace)throw new RangeError("No such ACE slot");let c=this.#d[t];if(c){if(F.indexOf(c)>=0)return this.#e[e*y.cc+b[c]];throw new Error(`Invalid ACE source: ${c}`)}else return 0}initDrums(){let e=this;e.#x.fill(64);for(let t=0;t<y.drm;t++){let c=t*y.dpn;for(let o in Oe){let h=Oe[o],u=(c+R[o])*y.dnc;e.#x.subarray(u,u+y.dnc).fill(h)}}}init(e=0){let t=this;t.#O=0,t.#M=0,t.#X=0,t.#w.fill(0),t.#e.fill(0),t.#d.fill(0),t.#n.fill(0),t.#l.fill(0),t.#b.fill(0),t.#p.fill(0),t.#C.fill(0),t.#D.fill(0),t.#I.fill(0),t.#i.fill(0),t.#f=100,t.#P=[],t.#z=500,t.#U=0,t.#E=0,t.#h=0,t.#m.fill(0),t.#g=!1,t.#F=0,t.#B=!0,t.initDrums(),t.#u.forEach(function(c,o,h){h[o]=o}),t.buildRchTree(),e==0&&(t.dispatchEvent("mode","?"),t.#t=0,t.#V.fill(0),t.#W.fill(0),t.#N=0,t.#_=""),t.#e[y.cc*9]=U[0],t.#e[y.cc*25]=U[0],t.#e[y.cc*41]=U[0],t.#e[y.cc*57]=U[0],t.#s.fill(t.CH_MELODIC),t.#s[9]=t.CH_DRUM1,t.#s[25]=t.CH_DRUM3,t.#s[41]=t.CH_DRUMS,t.#s[57]=t.CH_DRUMS,t.#s[73]=t.CH_DRUM5,t.#s[89]=t.CH_DRUM7,t.#s[105]=t.CH_DRUMS,t.#s[121]=t.CH_DRUMS,t.#y.fill(0),t.#S.fill(0),t.#$.fill(0),t.#c.fill(0),t.#a.fill(0),t.#T.fill(0),t.#G.fill(0),t.aiEfxName="",t.userBank.clearRange({msb:0,lsb:127,prg:[0,127]});for(let c=0;c<y.ch;c++){let o=c*y.cc;t.#e[o+b[7]]=100,t.#e[o+b[11]]=127,t.#e[o+b[10]]=64,t.#e[o+b[71]]=64,t.#e[o+b[72]]=64,t.#e[o+b[73]]=64,t.#e[o+b[74]]=64,t.#e[o+b[75]]=64,t.#e[o+b[76]]=64,t.#e[o+b[77]]=64,t.#e[o+b[78]]=64,t.#e[o+b[91]]=40,t.#e[o+b[101]]=127,t.#e[o+b[100]]=127,t.#e[o+b[99]]=127,t.#e[o+b[98]]=127;let h=c*y.rpn;t.#r[h]=2,t.#r[h+1]=64,t.#r[h+2]=0,t.#r[h+3]=64,t.#r[h+4]=0,t.#r[h+5]=0}t.dispatchEvent("mastervolume",t.#f),t.dispatchEvent("efxreverb",t.getEffectType(0)),t.dispatchEvent("efxchorus",t.getEffectType(1)),t.dispatchEvent("efxdelay",t.getEffectType(2)),t.dispatchEvent("efxinsert0",t.getEffectType(3)),t.dispatchEvent("efxinsert1",t.getEffectType(4)),t.dispatchEvent("efxinsert2",t.getEffectType(5)),t.dispatchEvent("efxinsert3",t.getEffectType(6)),t.dispatchEvent("reset"),t.switchMode("?")}switchMode(e,t=!1){let c=this,o=A.indexOf(e);if(o>-1){if(c.#t==0||t){let h=c.#t;c.initOnReset&&t&&(this.init(1),h=w["?"]),c.#t=o,c.#h=0,c.#O=Se[0][o],c.#M=Se[1][o];for(let m=0;m<y.ch;m++)c.#s[m]>0&&c.#e[m*y.cc+b[0]]==U[h]&&(c.#e[m*y.cc]=U[o]);switch(o){case w.mt32:{te.forEach((m,r)=>{let i=r+1;c.#w[i]||(c.#n[i]=m,c.#e[i*y.cc+b[91]]=127)});for(let m=1;m<10;m++)c.dispatchEvent("voice",{part:m});break}}let u;switch(o){case w["?"]:case w.xg:{u=[1,0,65,0,5,0,0,0];break}case w.gm:case w.gs:case w.g2:case w.sd:{u=[40,4,40,18,40,32,32,0];break}case w["05rw"]:case w.x5d:case w.ns5r:{u=[44,1,44,19,44,0,44,0];break}case w.k11:case w.sg:{u=[24,0,0,0,0,0,0,0];break}case w.mt32:{u=[40,4,0,0,0,0,0,0];break}default:u=[0,0,0,0,0,0,0,0]}for(let m=0;m<4;m++)c.#T[3*m]||(c.#T[3*m+1]=u[2*m],c.#T[3*m+2]=u[2*m+1],c.dispatchEvent(`efx${["reverb","chorus","delay","insert"][m]}`,c.getEffectType(m)));c.dispatchEvent("mode",e),c.forceVoiceRefresh()}}else throw new Error(`Unknown mode ${e}`)}newStrength(){this.#C.fill(0)}runJson(e){if(e.type>14)return e.type==15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),this.#ae[e.type].call(this,e);{let t=this.chRedir(e.part,e.track),c=!1;this.#te[t]?.forEach(o=>{e.channel=o,c=!0,this.#ae[e.type].call(this,e)}),c||console.warn(`${Te[e.type]?Te[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${t+1} without any recipient.`)}this.#P.length>100&&this.#P.splice(100,this.#P.length-99)}runRaw(e){}async loadBank(e,t){let c=this;switch(e=e.toLowerCase(),e){case"s7e":{c.userBank.clearRange({msb:63,lsb:[21,22]}),c.userBank.clearRange({msb:63,lsb:[24,27]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":{z.context=this,c.userBank.load(await z.read(e,t));break}}c.forceVoiceRefresh()}constructor(){super();let e=this;this.#m=new Uint8Array(256),this.#o[10]=new Uint8Array(512),this.#Q=new D,this.userBank.strictMode=!0,this.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),this.addEventListener("metacommit",function(r){let{data:i}=r;e.#P[0]?.type==i.type&&e.#P[0]?.amend?(e.#P[0].amend=i.amend,e.#P[0].data+=i.data):e.#P.unshift(i)}),this.#R[1]=function(r){switch(r=r.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),r.slice(0,2)){case"@I":{this.#g=!0,this.dispatchEvent("metacommit",{type:"Kar.Info",data:r.slice(2)?.trimLeft()});break}case"@K":{this.#g=!0,this.dispatchEvent("metacommit",{type:"Kar.Mode",data:r.slice(2)?.trimLeft()}),console.debug(`Karaoke mode active: ${r.slice(2)}`);break}case"@L":{this.#g=!0,this.dispatchEvent("metacommit",{type:"Kar.Lang",data:r.slice(2)?.trimLeft()});break}case"@T":{this.#g=!0,this.dispatchEvent("metacommit",{type:"KarTitle",data:r.slice(2)?.trimLeft()});break}case"@V":{this.#g=!0,this.dispatchEvent("metacommit",{type:"Kar.Ver.",data:r.slice(2)?.trimLeft()});break}case"XF":{let i=r.slice(2).split(":");switch(i[0]){case"hd":{i.slice(1).forEach((n,s)=>{n.length&&this.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][s],data:n})});break}case"ln":{i.slice(1).forEach((n,s)=>{n.length&&this.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][s],data:n})});break}default:this.dispatchEvent("metacommit",{type:"XfUnData",data:r})}break}default:this.#g?r[0]=="\\"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:r.slice(1),amend:!0})):r[0]=="/"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:r.slice(1),mask:!0,amend:!0})):this.dispatchEvent("metacommit",{type:"KarLyric",data:r,amend:!0}):r.split(`
`).forEach((i,n)=>{this.dispatchEvent("metacommit",{type:"Cmn.Text",data:i,mask:n!=0})})}},this.#R[2]=function(r){this.dispatchEvent("metacommit",{type:"Copyrite",data:r})},this.#R[3]=function(r,i){i<1&&this.#X<1&&this.dispatchEvent("metacommit",{type:"TrkTitle",data:r})},this.#R[4]=function(r,i){this.dispatchEvent("metacommit",{type:"Instrmnt",data:r})},this.#R[5]=function(r){r.trim()==""?this.dispatchEvent("metacommit",{type:"C.Lyrics",data:"",amend:!1}):this.dispatchEvent("metacommit",{type:"C.Lyrics",data:r,amend:!0})},this.#R[6]=function(r){this.dispatchEvent("metacommit",{type:"C.Marker",data:r})},this.#R[7]=function(r){this.dispatchEvent("metacommit",{type:"CuePoint",data:r})},this.#R[32]=function(r){this.#X=r[0]+1},this.#R[33]=function(r,i){e.#W[i]=r+1},this.#R[81]=function(r,i){e.#z=r/1e3},this.#R[127]=function(r,i){e.#Q.run(r,i)},this.#Q.default=function(r){console.warn(`Unrecognized sequencer-specific byte sequence: ${r}`)},this.#Q.add([67,0,1],function(r,i){e.#W[i]=r[0]+1}),this.#Y=new D("universal non-realtime"),this.#j=new D("universal realtime"),this.#A=new D("Yamaha"),this.#L=new D("Roland"),this.#K=new D("Korg"),this.#Z=new D("Kawai"),this.#J=new D("Akai"),this.#ee=new D("Casio");let t=function(r){console.info(`Unrecognized SysEx in "${this.name}" set.
%o`,r)};this.#Y.default=t,this.#j.default=t,this.#A.default=t,this.#L.default=t,this.#K.default=t,this.#Z.default=t,this.#J.default=t,this.#ee.default=t,this.#Y.add([9],r=>{e.switchMode(["gm","?","g2"][r[0]-1],!0),e.#g=e.#g||!1,console.info(`MIDI reset: ${["GM","Init","GM2"][r[0]-1]}`),r[0]==2&&e.init()}),this.#j.add([4,1],r=>{e.#f=((r[1]<<7)+r[0])/16383*100,e.dispatchEvent("mastervolume",e.#f)}).add([4,3],r=>((r[1]<<7)+r[0]-8192)/8192).add([4,4],r=>r[1]-64),this.#A.add([76,0,0],r=>{switch(r[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset: ${r}`);break}case 126:{e.switchMode("xg",!0),e.#g=!1,console.info("MIDI reset: XG");break}default:{let i=[0,0,0,0],n=(s,a)=>{i[a]=s};if(r.subarray(1).forEach((s,a)=>{let l=a+r[0];([n,n,n,n,f=>{this.#f=f*129/16383*100,e.dispatchEvent("mastervolume",e.#f)},f=>{},f=>{}][l]||(()=>{}))(s,a)}),r[0]<4){let s=0;i.forEach(a=>{s=s<<4,s+=a}),s-=1024}}}}).add([76,2,1],r=>{let i="XG ";r[0]<32?(i+="reverb ",r.subarray(1).forEach((n,s)=>{([a=>{e.setEffectTypeRaw(0,!1,a),console.info(`${i}main type: ${G[a]}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},a=>{e.setEffectTypeRaw(0,!0,a),console.debug(`${i}sub type: ${a+1}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},a=>{console.debug(`${i}time: ${ge(a)}s`)},a=>{console.debug(`${i}diffusion: ${a}`)},a=>{console.debug(`${i}initial delay: ${a}`)},a=>{console.debug(`${i}HPF cutoff: ${B[a]}Hz`)},a=>{console.debug(`${i}LPF cutoff: ${B[a]}Hz`)},a=>{console.debug(`${i}width: ${a}`)},a=>{console.debug(`${i}height: ${a}`)},a=>{console.debug(`${i}depth: ${a}`)},a=>{console.debug(`${i}wall type: ${a}`)},a=>{console.debug(`${i}dry/wet: ${a}`)},a=>{console.debug(`${i}send: ${C(a)}dB`)},a=>{console.debug(`${i}pan: ${a-64}`)},!1,!1,a=>{console.debug(`${i}delay: ${a}`)},a=>{console.debug(`${i}density: ${a}`)},a=>{console.debug(`${i}balance: ${a}`)},a=>{},a=>{console.debug(`${i}feedback: ${a}`)},a=>{}][r[0]+s]||function(){console.warn(`Unknown XG reverb address: ${r[0]}.`)})(n)})):r[0]<64?(i+="chorus ",r.subarray(1).forEach((n,s)=>{([a=>{e.setEffectTypeRaw(1,!1,a),console.info(`${i}main type: ${G[a]}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},a=>{e.setEffectTypeRaw(1,!0,a),console.debug(`${i}sub type: ${a+1}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},a=>{console.debug(`${i}LFO: ${be[a]}Hz`)},a=>{},a=>{console.debug(`${i}feedback: ${a}`)},a=>{console.debug(`${i}delay offset: ${me(a)}ms`)},a=>{},a=>{console.debug(`${i}low: ${B[a]}Hz`)},a=>{console.debug(`${i}low: ${a-64}dB`)},a=>{console.debug(`${i}high: ${B[a]}Hz`)},a=>{console.debug(`${i}high: ${a-64}dB`)},a=>{console.debug(`${i}dry/wet: ${a}`)},a=>{console.debug(`${i}send: ${C(a)}dB`)},a=>{console.debug(`${i}pan: ${a-64}`)},a=>{console.debug(`${i}to reverb: ${C(a)}dB`)},!1,a=>{},a=>{},a=>{},a=>{console.debug(`${i}LFO phase diff: ${(a-64)*3}deg`)},a=>{console.debug(`${i}input mode: ${a?"stereo":"mono"}`)},a=>{}][r[0]-32+s]||function(){console.warn(`Unknown XG chorus address: ${r[0]}.`)})(n)})):r[0]<86?(i+="variation ",r.subarray(1).forEach((n,s)=>{([a=>{e.setEffectTypeRaw(2,!1,a),console.info(`${i}main type: ${G[a]}`),e.dispatchEvent("efxdelay",e.getEffectType(2))},a=>{e.setEffectTypeRaw(2,!0,a),console.debug(`${i}sub type: ${a+1}`),e.dispatchEvent("efxdelay",e.getEffectType(2))}][r[0]-64+s]||function(){})(n)})):r[0]<97?(i+="variation ",r.subarray(1).forEach((n,s)=>{[a=>{console.debug(`${i}send: ${C(a)}dB`)},a=>{console.debug(`${i}pan: ${a-64}`)},a=>{console.debug(`${i}to reverb: ${C(a)}dB`)},a=>{console.debug(`${i}to chorus: ${C(a)}dB`)},a=>{console.debug(`${i}connection: ${a?"system":"insertion"}`)},a=>{console.debug(`${i}channel: CH${a+1}`)},a=>{console.debug(`${i}mod wheel: ${a-64}`)},a=>{console.debug(`${i}bend wheel: ${a-64}`)},a=>{console.debug(`${i}channel after touch: ${a-64}`)},a=>{console.debug(`${i}AC1: ${a-64}`)},a=>{console.debug(`${i}AC2: ${a-64}`)}][r[0]-86+s](n)})):r[0]>111&&r[0]<118?i+="variation ":console.warn(`Unknown XG variation address: ${r[0]}`)}).add([76,2,64],r=>{r.subarray(1).forEach((i,n)=>{let s=n+r[0];if(s==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][i]}`);else{let a=s-1>>2,l=s-1&3,f=`XG EQ ${a} ${["gain","freq","Q","shape"][l]}: `;[()=>{console.debug(`${f}${i-64}dB`)},()=>{console.debug(`${f}${i} (raw)`)},()=>{console.debug(`${f}${i/10}`)},()=>{console.debug(`${f}${["shelf","peak"][+!!i]}`)}][l]()}})}).add([76,3],r=>{let i=r[0],n=r[1],s=`XG Insertion ${r[0]+1} `;r.subarray(2).forEach((a,l)=>{([f=>{e.setEffectTypeRaw(3+i,!1,f),console.info(`${s}main type: ${G[f]}`),e.dispatchEvent(`efxinsert${i}`,e.getEffectType(3+i))},f=>{e.setEffectTypeRaw(3+i,!0,f),console.debug(`${s}sub type: ${f+1}`),e.dispatchEvent(`efxinsert${i}`,e.getEffectType(3+i))}][n+l]||function(){})(a)})}).add([76,6,0],r=>{let i=r[0];i<64?e.setLetterDisplay(r.subarray(1),"XG letter display",i):e.#N=Date.now()}).add([76,7,0],r=>{let i=r[0];e.#h=0,e.#E=Date.now()+3200,e.#m.fill(0);let n=r.subarray(1);for(let s=0;s<i;s++)n.unshift(0);n.forEach(function(s,a){let l=Math.floor(a/16),f=a%16,d=(f*3+l)*7,p=7,g=0;for(d-=f*5,l==2&&(p=2);g<p;)e.#m[d+g]=s>>6-g&1,g++})}).add([76,8],(r,i)=>{let n=e.chRedir(r[0],i,!0),s=r[1],a=y.cc*n,l=`XG CH${n+1} `,f=`Unknown XG part address ${s}.`;r.subarray(2).forEach((d,p)=>{s<1?console.debug(f):s<41?([()=>{e.#e[a+b[0]]=d,e.dispatchEvent("voice",{part:n})},()=>{e.#e[a+b[32]]=d,e.dispatchEvent("voice",{part:n})},()=>{e.#n[n]=d,e.dispatchEvent("voice",{part:n})},()=>{let g=e.chRedir(d,i,!0);e.#u[n]=g,n!=g&&(e.buildRchTree(),console.info(`${l}receives from CH${g+1}`))},()=>{e.#p[n]=+!d},()=>{},()=>{e.setChType(n,d,w.xg),console.debug(`${l}type: ${X[d]||d}`)},()=>{e.#r[y.rpn*n+3]=d,e.#i[y.rpnt*n+2]=1},!1,!1,()=>{e.#e[a+b[7]]=d},!1,!1,()=>{e.#e[a+b[10]]=d||128},!1,!1,()=>{e.#e[a+b[128]]=d},()=>{e.#e[a+b[93]]=d},()=>{e.#e[a+b[91]]=d},()=>{e.#e[a+b[94]]=d},()=>{e.#e[a+b[76]]=d},()=>{e.#e[a+b[77]]=d},()=>{e.#e[a+b[78]]=d},()=>{e.#e[a+b[74]]=d},()=>{e.#e[a+b[71]]=d},()=>{e.#e[a+b[73]]=d},()=>{e.#e[a+b[75]]=d},()=>{e.#e[a+b[72]]=d}][s+p-1]||(()=>{}))():s<48?console.debug(f):s<111?s>102&&s<105&&(e.#e[a+b[[5,65][s&1]]]=d):s<114?console.debug(f):s<116?console.debug(`${l}EQ ${["bass","treble"][s&1]} gain: ${d-64}dB`):s<118?console.debug(f):s<120?console.debug(`${l}EQ ${["bass","treble"][s&1]} freq: ${d}`):console.debug(f)})}).add([76,9],(r,i)=>{let n=e.chRedir(r[0],i,!0),s=r[1],a=`PLG-150VL CH${n+1} `;r.subarray(2).forEach((l,f)=>{let d=f+s;switch(d){case 1:{console.info(`${a}breath mode: ${["system","breath","velocity","touch EG"][l]}`);break}case 0:case 27:case 28:break;default:if(d<27){let p=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][d-3>>1];d&1?d<23?(console.debug(`${a}${p} control source: ${Ee(l)}`),l&&l<96&&e.allocateAce(l)):console.debug(`${a}${p} scale break point: ${l}`):console.debug(`${a}${p} depth: ${l-64}`)}}})}).add([76,10],r=>{}).add([76,16],r=>{}).add([76,17,0,0],r=>{}).add([76,112],r=>{console.debug(`XG enable PLG1${["50-VL","00-SG","50-DX","50-AN","50-PF","50-DR","50-PC","50-AP"][r[0]]} for CH${r[2]+1}.`)}).add([73,0,0],(r,i)=>{let n=r[0],s="MU1000 System: ";r.subarray(1).forEach((a,l)=>{let f=n+l;f==8?console.debug(`${s}LCD contrast set to ${a}.`):f==18?(e.#M=a?126:0,console.debug(`${s}bank defaults to ${a?"MU100 Native":"MU Basic"}.`)):f>=64&&f<69&&[()=>{e.dispatchEvent("channelactive",a)},()=>{a<8?(e.dispatchEvent("channelmin",a<<4),console.debug(`Octavia System: Minimum CH${(a<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{a<8?(e.dispatchEvent("channelmax",(a<<4)+15),console.debug(`Octavia System: Maximum CH${(a<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{e.#B=!!a,console.info(`Octavia System: RS receiving ${["dis","en"][a]}abled.`)}][f-64]()})}).add([73,10,0],(r,i)=>{let n=r[0],s=`MU1000 RS${e.#B?"":" (ignored)"}: `;if(n<16)switch(n){case 2:{let a=e.chRedir(0,i,!0);e.#B&&(e.dispatchEvent("channelmin",a),e.dispatchEvent("channelmax",a+63)),console.info(`${s}Show CH1~64`);break}case 3:{let a=e.chRedir(r[1]<<5,i,!0);e.#B&&e.dispatchEvent("channelmin",a),e.#B&&e.dispatchEvent("channelmax",a+31),console.info(`${s}Show CH${a+1}~CH${a+32}`);break}default:console.debug(`${s}unknown switch ${n} invoked.`)}else if(n<32){if(e.#B){let a=e.chRedir(n-16+(e.#F<<4),i,!0);e.dispatchEvent("channelactive",a)}}else if(n<36){let a=e.chRedir(n-32<<4,i,!0);e.#B&&(e.dispatchEvent("channelmin",a),e.dispatchEvent("channelmax",a+15),e.#F=n-32),console.info(`${s}Show CH${a+1}~CH${a+16}`)}}).add([93,3],(r,i)=>{let n=e.chRedir(r[0],i,!0),s=`PLG-100SG CH${n+1} `,a=Date.now();if(r[1]==0){let l="",f=0;r.subarray(2).forEach((d,p)=>{p%2==0?l+=ye[d]||d.toString().padStart("0"):f+=d*13}),a>=e.#U&&this.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"SGLyrics",data:`${ve(l)}`,amend:!0}),e.#U=a+Math.ceil(f/2)+e.#z,x()&&console.debug(`${s}vocals: ${l}`)}else console.warn(`Unknown PLG-100SG data: ${r}`)});let c=function(r,i,n,s){},o=function(r,i){let n=r*y.dpn,s=i[0],a=i[1];i.subarray(2).forEach((l,f)=>{let d=f+a,p=-1;d<16?([()=>{p=24},()=>{p=25},()=>{p=26},()=>{},()=>{p=28},()=>{p=29},()=>{p=30},()=>{p=31},()=>{},()=>{},()=>{},()=>{p=20},()=>{p=21},()=>{p=22},()=>{p=23},()=>{}][d]||(()=>{console.debug(`Unknown XG-style drum param ${d} on set ${r+1}.`)}))():d<32||(d<40?([()=>{p=48},()=>{p=49},!1,!1,()=>{p=52},()=>{p=53}][d-32]||(()=>{console.debug(`Unknown XG-style drum param ${d} on set ${r+1}.`)}))():d<80||([()=>{p=36}][d-80]||(()=>{console.debug(`Unknown XG-style drum param ${d} on set ${r+1}.`)}))()),p>=0?(x()&&console.debug(n,p,s,l),e.#x[(n+R[p])*y.dnc+s]=l):x()&&console.debug(`XG-style drum param ${d} has no writes.`)})},h=function(r,i,n){let s=r*y.dpn,a=(i<<7)+n[0];n.subarray(1).forEach((l,f)=>{let d=f+a,p=d&127,g=d>>7,v=-1;g>1&&([()=>{v=26},()=>{},()=>{v=28},()=>{v=29},()=>{v=30},()=>{},()=>{},()=>{v=31}][g-2]||(()=>{console.debug(`Unknown GS-style drum param ${g} on set ${r+1}.`)}))(),v>-1?(x()&&console.debug(s,v,p,l),e.#x[(s+R[v])*y.dnc+p]=l):x()&&console.debug(`GS-style drum param ${g} has no writes.`)})};this.#A.add([76,48],(r,i,n)=>{o(0,r)}).add([76,49],(r,i,n)=>{o(1,r)}).add([76,50],(r,i,n)=>{o(2,r)}).add([76,51],(r,i,n)=>{o(3,r)}).add([76,52],(r,i,n)=>{o(4,r)}).add([76,53],(r,i,n)=>{o(5,r)}).add([76,54],(r,i,n)=>{o(6,r)}).add([76,55],(r,i,n)=>{o(7,r)}),this.#A.add([89,0],(r,i,n)=>{if(e.eprom){let s=r[0],a=(r[1]<<14)+(r[2]<<7)+r[3]+(e.eprom.offset||0);x()&&console.debug(`MU1000 EPROM trail to 0x${a.toString(16).padStart(6,"0")}, ${s} bytes.`);let l=e.eprom.data;r.subarray(4).forEach((f,d)=>{let p=d>>3,g=d&7;if(g==7)for(let v=0;v<7;v++)l[a+7*p+v]+=(f>>6-v&1)<<7;else l[a+7*p+g]=f})}}).add([89,1],(r,i,n)=>{let s=(r[0]<<21)+(r[1]<<14)+(r[2]<<7)+r[3];x()&&console.debug(`MU1000 EPROM jump to 0x${s.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=s)}).add([89,2],(r,i,n)=>{if(e.eprom){let s=(r[0]<<21)+(r[1]<<14)+(r[2]<<7)+r[3]+(e.eprom.offset||0);x()&&console.debug(`MU1000 EPROM write to 0x${s.toString(16).padStart(6,"0")}.`);let a=e.eprom.data;r.subarray(4).forEach((l,f)=>{let d=f>>3,p=f&7;if(p==7)for(let g=0;g<7;g++)a[s+7*d+g]+=(l>>6-g&1)<<7;else a[s+7*d+p]=l})}}).add([89,3],(r,i,n)=>{}),this.#A.add([39,48],(r,i,n)=>{}).add([43,0,0],(r,i,n)=>{let s=[0,0,0,0],a=(l,f)=>{s[f]=l};if(r.subarray(1).forEach((l,f)=>{let d=f+r[0];[a,a,a,a,()=>{this.#f=l*129/16383*100,e.dispatchEvent("mastervolume",e.#f)},()=>l-64,()=>l||128,()=>l,()=>l,()=>{console.debug(`TG300 variation on cc${l}.`)}][d](l,d)}),r[0]<4){let l=0;s.forEach(f=>{l=l<<4,l+=f}),l-=1024}}).add([43,1,0],(r,i,n)=>{}).add([43,2],(r,i,n)=>{let s=e.chRedir(r[0],i,!0),a=r[1],l=y.cc*s,f=`TG300 CH${s+1} `;r.subarray(2).forEach((d,p)=>{p<5?([()=>{},()=>{e.#e[l+b[0]]=d,e.dispatchEvent("voice",{part:s})},()=>{e.#e[l+b[32]]=d,e.dispatchEvent("voice",{part:s})},()=>{e.#n[s]=d,e.dispatchEvent("voice",{part:s})},()=>{let g=e.chRedir(d,i,!0);e.#u[s]=g,s!=g&&(e.buildRchTree(),console.info(`${f}receives from CH${g+1}`))}][p+a]||(()=>{}))(d,p+a):p<21||(p<47?([()=>{e.#p[s]=+!d},()=>{},()=>{},()=>{e.#r[y.rpn*s+3]=d,e.#i[y.rpnt*s+2]=1},()=>{},()=>{e.#e[l+b[7]]=d},!1,!1,()=>{e.#e[l+b[10]]=d||128},!1,!1,()=>{console.debug(`${f} AC1 at cc${d}`)},()=>{console.debug(`${f} AC2 at cc${d}`)},()=>{e.#e[l+b[128]]=d},()=>{e.#e[l+b[93]]=d},()=>{e.#e[l+b[91]]=d},()=>{e.#e[l+b[94]]=d},()=>{e.#e[l+b[76]]=d},()=>{e.#e[l+b[77]]=d},()=>{e.#e[l+b[74]]=d},()=>{e.#e[l+b[71]]=d},()=>{e.#e[l+b[73]]=d},()=>{e.#e[l+b[75]]=d},()=>{e.#e[l+b[72]]=d},()=>{e.#e[l+b[78]]=d}][p+a-21]||(()=>{}))(d,p+a):p<95||([()=>{e.#e[l+b[65]]=d},()=>{e.#e[l+b[5]]=d}][p+a-95]||(()=>{}))(d,p+a))})}).add([43,7,0],(r,i,n)=>{let s=r[0];e.setLetterDisplay(r.subarray(1),"TG300 letter display",s)}).add([43,7,1],(r,i,n)=>{e.#h=0,e.#E=Date.now()+3200,e.#m.fill(0),r.forEach(function(s,a){let l=Math.floor(a/16),f=a%16,d=(f*3+l)*7,p=7,g=0;for(d-=f*5,l==2&&(p=2);g<p;)e.#m[d+g]=s>>6-g&1,g++})}),this.#L.add([66,18,0,0,127],(r,i,n)=>{e.switchMode("gs",!0),e.#e[y.cc*9]=120,e.#e[y.cc*25]=120,e.#e[y.cc*41]=120,e.#e[y.cc*57]=120,e.#M=3,e.#g=!1,e.#V.fill(0),console.info(`GS system to ${["single","dual"][r[0]]} mode.`)}).add([66,18,64,0],(r,i,n)=>{switch(r[0]){case 127:{e.switchMode("gs",!0),e.#e[y.cc*9]=120,e.#e[y.cc*25]=120,e.#e[y.cc*41]=120,e.#e[y.cc*57]=120,e.#g=!1,e.#V.fill(0),console.info("MIDI reset: GS");break}default:{let s=[0,0,0,0],a=(l,f)=>{s[f]=l};if(r.subarray(1).forEach((l,f)=>{let d=f+r[0];[a,a,a,a,p=>{this.#f=p*129/16383*100,e.dispatchEvent("mastervolume",e.#f)},p=>{},p=>{}][d](l,f)}),r[0]<4){let l=0;s.forEach(f=>{l=l<<4,l+=f}),l-=1024}}}}).add([66,18,64,1],r=>{let i=r[0];if(i<16){let n="".padStart(i," ");r.subarray(1).forEach((s,a)=>{n+=String.fromCharCode(Math.max(32,s))}),n=n.padEnd(16," "),console.debug(`GS patch name: ${n}`)}else i<48||(i<65?r.subarray(1).forEach((n,s)=>{let a=`GS ${i+s>55?"chorus":"reverb"} `;([()=>{console.info(`${a}type: ${J[n]}`),e.setEffectType(0,40,n),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${a}predelay: ${n}ms`)},()=>{console.info(`${a}type: ${we[n]}`),e.setEffectType(1,40,16+n),e.dispatchEvent("efxchorus",e.getEffectType(1))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${a}to reverb: ${C(n)}`)},()=>{console.debug(`${a}to delay: ${C(n)}`)}][i+s-48]||(()=>{}))()}):i<80?console.debug(`Unknown GS patch address: ${i}`):i<91?r.subarray(1).forEach((n,s)=>{let a="GS delay ";([()=>{console.info(`${a}type: ${$e[n]}`),e.setEffectType(2,40,32+n),e.dispatchEvent("efxdelay",e.getEffectType(2))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${a}to reverb: ${C(n)}`)}][i+s-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${i}`))}).add([66,18,64,2],r=>{let i="GS EQ ";r.subarray(1).forEach((n,s)=>{([()=>{console.debug(`${i}low freq: ${[200,400][n]}Hz`)},()=>{console.debug(`${i}low gain: ${n-64}dB`)},()=>{console.debug(`${i}high freq: ${[3e3,6e3][n]}Hz`)},()=>{console.debug(`${i}high gain: ${n-64}dB`)}][r[0]+s]||function(){console.warn(`Unknown GS EQ address: ${r[0]+s}`)})()})}).add([66,18,64,3],r=>{let i="GS EFX ",n=function(s,a){let l=ke(e.#T.subarray(10,12),a,s);l&&console.debug(`${i}${ee(e.#T.subarray(10,12))} ${l}`)};r.subarray(1).forEach((s,a)=>{([()=>{e.setEffectTypeRaw(3,!1,32+s),e.dispatchEvent("efxinsert0",e.getEffectType(3))},()=>{e.setEffectTypeRaw(3,!0,s),console.info(`${i}type: ${ee(e.#T.subarray(10,12))}`),e.dispatchEvent("efxinsert0",e.getEffectType(3))},!1,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,()=>{console.debug(`${i}to reverb: ${C(s)}dB`)},()=>{console.debug(`${i}to chorus: ${C(s)}dB`)},()=>{console.debug(`${i}to delay: ${C(s)}dB`)},!1,()=>{console.debug(`${i}1 source: ${s}`),s&&s<96&&e.allocateAce(s)},()=>{console.debug(`${i}1 depth: ${s-64}`)},()=>{console.debug(`${i}2 source: ${s}`),s&&s<96&&e.allocateAce(s)},()=>{console.debug(`${i}2 depth: ${s-64}`)},()=>{console.debug(`${i}to EQ: ${s?"ON":"OFF"}`)}][r[0]+a]||function(l,f){console.warn(`Unknown GS EFX address: ${f}`)})(s,r[0]+a)})}).add([66,18,65],r=>{h((r[0]>>4)+1<<1,r[0]&15,r.subarray(1))}).add([69,18,16],r=>{switch(r[0]){case 0:{let i=r[1];e.setLetterDisplay(r.subarray(2),"GS display text",i);break}case 32:{e.#E=Date.now()+3200,r[1]==0&&(e.#h=Math.max(Math.min(r[2]-1,9),0),x()&&console.debug(`GS switch display page ${r[2]-1}.`));break}default:if(r[0]<6){e.#h>9&&(e.#h=0);let i=r[0]-1<<1|r[1]>>6;e.#h==i&&(e.#E=Date.now()+3200),e.#o[i]?.length||(e.#o[i]=new Uint8Array(256));let n=e.#o[i];x()&&console.debug(`GS frame draw page ${i}.`);let s=r[1]&63;n.fill(0),r.subarray(2).forEach(function(l,f){let d=f+s,p=Math.floor(d/16),g=d%16,v=(g*4+p)*5,k=5,$=0;for(v-=g*4,p==3&&(k=1);$<k;)n[v+$]=l>>4-$&1,$++})}else console.warn(`Unknown GS display section: ${r[0]}`)}});let u=function(r,i,n){let s=r[0],a=y.cc*i,l=y.rpn*i,f=`GS CH${i+1} `;s<3?(r.subarray(1).forEach((d,p)=>{[()=>{e.#e[a+b[0]]=d},()=>{e.#n[i]=d},()=>{let g=0;d<16?g=e.chRedir(d,n,!0):g=y.ch,e.#u[i]=g,i!=g&&(e.buildRchTree(),console.info(`${f}receives from CH${g+1}`))}][s+p]()}),e.dispatchEvent("voice",{part:i})):s<19||(s<44?r.subarray(1).forEach((d,p)=>{([()=>{e.#p[i]=+!d},!1,()=>{e.setChType(i,d<<1,w.gs),console.debug(`${f}type: ${d?"drum ":"melodic"}${d||""}`)},()=>{e.#r[l+3]=d,e.#i[y.rpnt*i+2]=1},!1,()=>{e.#e[a+b[7]]=d},!1,!1,()=>{e.#e[a+b[10]]=d||128},!1,!1,()=>{console.debug(`${f}CC 1: cc${d}`)},()=>{console.debug(`${f}CC 2: cc${d}`)},()=>{e.#e[a+b[93]]=d},()=>{e.#e[a+b[91]]=d},!1,!1,()=>{e.#r[l+1]=d,e.#i[y.rpnt*i+1]=1},()=>{e.#r[l+2]=d,e.#i[y.rpnt*i+1]=1},()=>{e.#e[a+b[94]]=d}][s+p-19]||(()=>{}))()}):s<76||console.debug(`Unknown GS part address: ${s}`))},m=function(r,i){let n=r[0],s=`GS CH${i+1} `;n<2?r.subarray(1).forEach((a,l)=>{[()=>{e.#e[y.cc*i+b[32]]=a},()=>{}][n+l]()}):n<32?console.warn(`Unknown GS misc address: ${n}`):n<35?r.subarray(1).forEach((a,l)=>{[()=>{console.debug(`${s}EQ: o${["ff","n"][a]}`)},()=>{},()=>{console.debug(`${s}EFX: o${["ff","n"][a]}`),e.#G[i]=a,e.dispatchEvent("partefxtoggle",{part:i,active:a})}][n+l-32]()}):console.warn(`Unknown GS misc address: ${n}`)};this.#L.add([66,18,64,16],(r,i)=>{u(r,e.chRedir(9,i,!0),i)}).add([66,18,64,17],(r,i)=>{u(r,e.chRedir(0,i,!0),i)}).add([66,18,64,18],(r,i)=>{u(r,e.chRedir(1,i,!0),i)}).add([66,18,64,19],(r,i)=>{u(r,e.chRedir(2,i,!0),i)}).add([66,18,64,20],(r,i)=>{u(r,e.chRedir(3,i,!0),i)}).add([66,18,64,21],(r,i)=>{u(r,e.chRedir(4,i,!0),i)}).add([66,18,64,22],(r,i)=>{u(r,e.chRedir(5,i,!0),i)}).add([66,18,64,23],(r,i)=>{u(r,e.chRedir(6,i,!0),i)}).add([66,18,64,24],(r,i)=>{u(r,e.chRedir(7,i,!0),i)}).add([66,18,64,25],(r,i)=>{u(r,e.chRedir(8,i,!0),i)}).add([66,18,64,26],(r,i)=>{u(r,e.chRedir(10,i,!0),i)}).add([66,18,64,27],(r,i)=>{u(r,e.chRedir(11,i,!0),i)}).add([66,18,64,28],(r,i)=>{u(r,e.chRedir(12,i,!0),i)}).add([66,18,64,29],(r,i)=>{u(r,e.chRedir(13,i,!0),i)}).add([66,18,64,30],(r,i)=>{u(r,e.chRedir(14,i,!0),i)}).add([66,18,64,31],(r,i)=>{u(r,e.chRedir(15,i,!0),i)}).add([66,18,64,64],(r,i)=>{m(r,e.chRedir(9,i,!0))}).add([66,18,64,65],(r,i)=>{m(r,e.chRedir(0,i,!0))}).add([66,18,64,66],(r,i)=>{m(r,e.chRedir(1,i,!0))}).add([66,18,64,67],(r,i)=>{m(r,e.chRedir(2,i,!0))}).add([66,18,64,68],(r,i)=>{m(r,e.chRedir(3,i,!0))}).add([66,18,64,69],(r,i)=>{m(r,e.chRedir(4,i,!0))}).add([66,18,64,70],(r,i)=>{m(r,e.chRedir(5,i,!0))}).add([66,18,64,71],(r,i)=>{m(r,e.chRedir(6,i,!0))}).add([66,18,64,72],(r,i)=>{m(r,e.chRedir(7,i,!0))}).add([66,18,64,73],(r,i)=>{m(r,e.chRedir(8,i,!0))}).add([66,18,64,74],(r,i)=>{m(r,e.chRedir(10,i,!0))}).add([66,18,64,75],(r,i)=>{m(r,e.chRedir(11,i,!0))}).add([66,18,64,76],(r,i)=>{m(r,e.chRedir(12,i,!0))}).add([66,18,64,77],(r,i)=>{m(r,e.chRedir(13,i,!0))}).add([66,18,64,78],(r,i)=>{m(r,e.chRedir(14,i,!0))}).add([66,18,64,79],(r,i)=>{m(r,e.chRedir(15,i,!0))}),this.#K.add([54,65],(r,i)=>{e.switchMode("x5d");let n=(r[1]<<7)+r[0],s=(r[3]<<7)+r[2],a=e.chRedir(n&15,i,!0),l=y.cc*a;[()=>{s<1||(s<101?(e.setChType(a,e.CH_MELODIC,w.x5d),e.#n[a]=s-1,e.#e[l+b[0]]=82):s<229?(e.setChType(a,e.CH_MELODIC,w.x5d),e.#n[a]=s-101,e.#e[l+b[0]]=56):(e.setChType(a,e.CH_DRUMS,w.x5d),e.#n[a]=Pe[s-229]||0,e.#e[l+b[0]]=62)),e.dispatchEvent("voice",{part:a})},()=>{e.#e[l+b[7]]=s},()=>{s<31&&(e.#e[l+b[10]]=Math.round((s-15)*4.2+64))},()=>{e.#e[l+b[93]]=_(s)},()=>{e.#e[l+b[91]]=_(s)},()=>{e.#r[a*y.rpn+3]=s>8191?s-16320:64+s,e.#i[y.rpnt*a+2]=1},()=>{e.#r[a*y.rpn+1]=s>8191?s-16320:64+s,e.#i[y.rpnt*a+1]=1},()=>{s>0&&(e.#r[a*y.rpn]=s,e.#i[y.rpnt*a]=1)},()=>{}][n>>4]()}).add([54,76,0],(r,i)=>{e.switchMode("x5d",!0);let n="",s=82,a=0,l=0,f="MSB	PRG	LSB	NME";O(r,function(d,p){if(p<16400){let g=p%164;switch(!0){case g<10:{d>31&&(n+=String.fromCharCode(d));break}case g==10:break;case g==11:{f+=`
${s}	${a}	${l}	${n.trim().replace("Init Voice","")}`,a++,n="";break}}a>99&&(s=90,a=0)}}),e.userBank.clearRange({msb:82,prg:[0,99],lsb:0}),e.userBank.load(f),x()&&console.debug(f),e.forceVoiceRefresh()}).add([54,77,0],(r,i)=>{e.switchMode("x5d",!0);let n="",s=90,a=0,l=0,f="MSB	PRG	LSB	NME";O(r,function(d,p){if(p<13600){let g=p%136;switch(!0){case g<10:{d>31&&(n+=String.fromCharCode(d));break}case g==11:{f+=`
${s}	${a}	${l}	${n.trim().replace("Init Combi","")}`,a++,n="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(f),x()&&console.debug(f),e.forceVoiceRefresh()}).add([54,78],(r,i)=>{e.switchMode("x5d",!0),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][r[0]]} mode.`)}).add([54,85],(r,i)=>{e.switchMode("x5d",!0),O(r,(n,s)=>{s>0&&s<3&&(e.setEffectType(s-1,44,n),e.dispatchEvent(`efx${["reverb","chorus"][s-1]}`,e.getEffectType(s-1)))})}).add([54,104],(r,i)=>{e.switchMode("x5d",!0),O(r,function(n,s,a,l){if(s<192){let f=e.chRedir(Math.floor(s/12),i,!0),d=f*y.cc;switch(s%12){case 0:{n<128?(e.setChType(f,e.CH_MELODIC,w.x5d),e.#e[d+b[0]]=82,e.#n[f]=n):(e.setChType(f,e.CH_DRUMS,w.x5d),e.#e[d+b[0]]=62,e.#n[f]=Pe[n-128]),n>0&&e.setChActive(f,1),e.dispatchEvent("voice",{part:f});break}case 1:{e.#e[d+b[7]]=n;break}case 2:{e.#r[f*y.rpn+3]=n>127?n-192:64+n,e.#i[y.rpnt*f+2]=1;break}case 3:{e.#r[f*y.rpn+1]=n>127?n-192:64+n,e.#i[y.rpnt*f+1]=1;break}case 4:{n<31&&(e.#e[d+b[10]]=Math.round((n-15)*4.2+64));break}case 5:{let p=n>>4,g=n&15;e.#e[d+b[91]]=_(g),e.#e[d+b[93]]=_(p);break}case 10:break;case 11:{let p=e.chRedir(n&15,i,!0),g=n>>4;e.#u[f]=n,(p!=f||g)&&(console.info(`X5D Part CH${f+1} receives from CH${p+1}.`),e.buildRchTree())}}}else{let f=e.chRedir(s-192,i,!0)}})}),this.#L.add([22,18,127],r=>{e.switchMode("mt32",!0),e.#g=!1,e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(r,i,n)=>{e.switchMode("mt32");let s=e.chRedir(n,i,!0),a=r[1];r.subarray(2).forEach((l,f)=>{let d=f+a;e.#$[d+(s-1)*16]=l,([!1,()=>{let p=e.#$[s-1<<4];if(p<3){if(e.#a[s]=1,p==2)for(let g=0;g<name.length;g++)e.#c[(s-1)*y.cmt+g]=e.#S[l*y.cmt+g];else{let g=e.baseBank.get(0,l+(p<<6),127,"mt32").name;for(let v=0;v<g.length;v++)e.#c[(s-1)*y.cmt+v]=g.charCodeAt(v)}e.dispatchEvent("voice",{part:s})}},()=>{e.#r[s*y.rpn+3]=l+40,e.#i[y.rpnt*s+2]=1},()=>{e.#r[s*y.rpn+1]=l+14,e.#i[y.rpnt*s+1]=1},()=>{e.#r[s*y.rpn]=l,e.#i[y.rpnt*s]=1},!1,()=>{e.#e[y.cc*s+b[91]]=l?127:0},!1,()=>{e.#e[y.cc*s+b[7]]=l},()=>{e.#e[y.cc*s+b[10]]=Math.ceil(l*9.05)}][d]||(()=>{}))()})}).add([22,18,1],(r,i,n)=>{e.switchMode("mt32");let s=n&7;console.debug(`MT-32 slot #${n+1} Drum: ${r}`);let a=r[0]<<7|r[1];r.subarray(2).forEach((l,f)=>{let d=f+a,p=(d>>2)+24,g=d&3,v=s*y.dpn;if(x()&&console.debug(`MT-32 temp drum note ${p} param ${g}: ${l}`),p<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${p}`);return}[()=>{},()=>{e.#x[(v+R[26])*y.dnc+p]=Math.round(l*1.27)},()=>{e.#x[(v+R[26])*y.dnc+p]=l*9+1&127},()=>{e.#x[(v+R[26])*y.dnc+p]=l?127:0}][g]()})}).add([22,18,2],(r,i,n)=>{e.switchMode("mt32");let s=e.chRedir(n,i,!0),a=r[1]+(r[0]<<7);a<10&&(e.#a[s]=1),r.subarray(2).forEach((l,f)=>{let d=f+a;d<14&&(e.#c[(s-1)*y.cmt+d]=l)}),e.dispatchEvent("voice",{part:s})}).add([22,18,3],(r,i,n)=>{e.switchMode("mt32");let s=n&7;if(r[0]){let a=(r[0]-1<<7)+r[1]-16;r.subarray(2).forEach((l,f)=>{let d=f+a,p=(d>>2)+24,g=d&3,v=s*y.dpn;if(x()&&console.debug(`MT-32 dev drum note ${p} param ${g}: ${l}`),p<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${p}`);return}[()=>{},()=>{e.#x[(v+R[26])*y.dnc+p]=Math.round(l*1.27)},()=>{e.#x[(v+R[26])*y.dnc+p]=l*9+1&127},()=>{e.#x[(v+R[26])*y.dnc+p]=l?127:0}][g]()})}else{let a=r[1];r.subarray(2).forEach((l,f)=>{let d=f+a;e.#$[d]=l;let p=e.chRedir(1+(d>>4),i,!0),g=d&15;([!1,()=>{let v=e.#$[p-1<<4];if(v<3)if(e.#a[p]=1,v==2)for(let k=0;k<name.length;k++)e.#c[(p-1)*y.cmt+k]=e.#S[l*y.cmt+k];else{let k=e.baseBank.get(0,l+(v<<6),127,"mt32").name;for(let $=0;$<k.length;$++)e.#c[(p-1)*y.cmt+$]=k.charCodeAt($)}e.dispatchEvent("voice",{part:p})},()=>{e.#r[p*y.rpn+3]=l+40,e.#i[y.rpnt*p+2]=1},()=>{e.#r[p*y.rpn+1]=l+14,e.#i[y.rpnt*p+1]=1},()=>{e.#r[p*y.rpn]=l,e.#i[y.rpnt*p]=1},!1,()=>{e.#e[y.cc*p+b[91]]=l?127:0},!1,()=>{e.#e[y.cc*p+b[7]]=l},()=>{e.#e[y.cc*p+b[10]]=Math.ceil(l*9.05)}][g]||(()=>{}))()})}}).add([22,18,4],(r,i,n)=>{e.switchMode("mt32");let s=r[1]+(r[0]<<7),a=[];r.subarray(2).forEach((l,f)=>{let d=f+s,p=e.chRedir(Math.floor(d/246+1),i,!0),g=d%246;g<14&&(e.#c[(p-1)*y.cmt+g]=l),g<10&&(e.#a[p]=1),a.indexOf(p)<0&&a.push(p)}),a.forEach(l=>{e.dispatchEvent("voice",{part:l})})}).add([22,18,5],(r,i,n)=>{e.switchMode("mt32");let s=(r[0]<<7)+r[1];r.subarray(2).forEach((a,l)=>{let f=s+l,d=Math.floor(f/8),p=f&7,g=d*8;e.#y[f]=a,([!1,()=>{let v=e.#y[g];if(v<3){let k="";if(v==2){let I=y.cmt*d;k=`MT-m:${a.toString().padStart(3,"0")}`}else k=e.baseBank.get(0,a+(v<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:d});let $=`MSB	LSB	PRG	NME
000	127	${d}	${k}`;e.userBank.load($,!0)}}][p]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(r,i,n)=>{e.switchMode("mt32");let s=((r[0]&1)<<7)+r[1];r.subarray(2).forEach((a,l)=>{let f=s+l;f<y.cmt&&(e.#S[(r[0]>>1)*y.cmt+f]=a)}),e.forceVoiceRefresh()}).add([22,18,16],(r,i,n)=>{e.switchMode("mt32");let s=r[1],a=!1,l=function(f,d){e.#u[d-12]=f,a=!0};r.subarray(2).forEach((f,d)=>{let p=d+s;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,l,l,l,l,l,l,l,l,l,()=>{e.#f=f,e.dispatchEvent("mastervolume",e.#f)}][p]||(()=>{}))(f,d)}),a&&e.buildRchTree()}).add([22,18,32],r=>{e.switchMode("mt32");let i=r[1],n=" ".repeat(i);r.subarray(2).forEach(s=>{s>31?n+=String.fromCharCode(s):n+=" "}),e.#_=n.padStart(20," "),e.#N=Date.now()+3200}).add([22,18,82],(r,i)=>{let n=e.chRedir(0,i,!0);for(let s=0;s<16;s++)e.#k.ano(n+s),s&&s<10&&(e.#n[n+s]=te[s-1]);console.info("MT-32 alt reset complete.")}),this.#K.add([66,0],(r,i)=>{e.switchMode("ns5r",!0),e.#g=!1,console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][r[0]]} mode.`)}).add([66,1],(r,i)=>{e.switchMode(["ns5r","05rw"][r[0]],!0),e.#g=!1}).add([66,18,0,0],(r,i)=>{let n=r[0];switch(n){case 124:case 126:case 127:{e.switchMode("ns5r",!0),e.#g=!1;break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset: ${r}`);break}default:if(n<10){let s=[0,0,0,0],a=(l,f)=>{s[f]=l};if(r.subarray(1).forEach((l,f)=>{[a,a,a,a,()=>{e.#f=l*129/16383*100,e.dispatchEvent("mastervolume",e.#f)},()=>l-64,()=>l-64,()=>{},()=>{},()=>{}][n+f]()}),r[0]<4){let l=0;s.forEach(f=>{l=l<<4,l+=f}),l-=1024}}}}).add([66,18,0,1],(r,i)=>{}).add([66,18,0,2],(r,i)=>{}).add([66,18,1],(r,i)=>{let n=e.chRedir(r[0],i,!0),s=n*y.cc,a=r[1],l=`NS5R CH${n+1} `;r.subarray(2).forEach((f,d)=>{let p=a+d;p<3?([()=>{e.#e[s+b[0]]=f||121},()=>{e.#e[s+b[32]]=f},()=>{e.#n[n]=f}][p](),e.dispatchEvent("voice",{part:n})):p<8||(p<14?[()=>{let g=e.chRedir(f,i,!0);e.#u[n]=g,n!=g&&(e.buildRchTree(),console.info(`${l}receives from CH${g+1}`))},()=>{e.#p[n]=+!f},()=>{e.setChType(n,f,w.ns5r),console.debug(`${l}type: ${X[f]}`)},()=>{e.#r[y.rpn*n+3]=f,e.#i[y.rpnt*n+2]=1},()=>{},()=>{}][p-8]():p<16||(p<33?[()=>{e.#e[s+b[7]]=f},()=>{e.#e[s+b[11]]=f},()=>{},()=>{},()=>{e.#e[s+b[10]]=f||128},()=>{},()=>{},()=>{e.#e[s+b[93]]=f},()=>{e.#e[s+b[91]]=f},()=>{e.#e[s+b[76]]=f},()=>{e.#e[s+b[77]]=f},()=>{e.#e[s+b[78]]=f},()=>{e.#e[s+b[74]]=f},()=>{e.#e[s+b[71]]=f},()=>{e.#e[s+b[73]]=f},()=>{e.#e[s+b[75]]=f},()=>{e.#e[s+b[72]]=f}][p-16]():p<112||p<114&&[()=>{e.#e[s+b[5]]=f},()=>{e.#e[s+b[65]]=f}][p-112]()))})}).add([66,18,8,0],(r,i)=>{let n=r[0];if(n<32)e.setLetterDisplay(r.subarray(1,33),"NS5R letter display");else{let s=n-32;e.#E=Date.now()+3200,e.#h=10,e.#m.fill(0);let a=r.subarray(1),l=4;a.forEach(function(f,d){let p=d+s,g=p>>4,v=p&15;if(p<80){let k=g<l?f:f>>3,$=0,I=g<l?6:3;for(;k>0;)e.#m[v*32+g*7+(I-$)]=k&1,k=k>>1,$++}})}}).add([66,18,48],(r,i,n)=>{o(0,r)}).add([66,18,49],(r,i,n)=>{o(1,r)}).add([66,18,50],(r,i,n)=>{o(2,r)}).add([66,18,51],(r,i,n)=>{o(3,r)}).add([66,18,52],(r,i,n)=>{o(4,r)}).add([66,18,53],(r,i,n)=>{o(5,r)}).add([66,18,54],(r,i,n)=>{o(6,r)}).add([66,18,55],(r,i,n)=>{o(7,r)}).add([66,52],(r,i)=>{e.switchMode("ns5r",!0),e.#g=!1;let n="";O(r,(s,a)=>{a<8?(s>31&&(n+=String.fromCharCode(s)),a==7&&(e.aiEfxName=n)):a<10&&(e.setEffectType(a-8,44,s),e.dispatchEvent(`efx${["reverb","chorus"][a-8]}`,e.getEffectType(a-8)))})}).add([66,53],(r,i)=>{e.switchMode("ns5r",!0),e.#g=!1;let n="";O(r,function(s,a){switch(!0){case a<2944:{let l=e.chRedir(Math.floor(a/92),i,!0),f=l*y.cc;switch(a%92){case 0:{e.#e[f+b[0]]=s,e.dispatchEvent("voice",{part:l});break}case 1:{e.#e[f+b[32]]=s,!s&&!e.#e[f+b[0]]&&(e.#e[f+b[0]]=121),e.dispatchEvent("voice",{part:l});break}case 2:{e.#n[l]=s,s>0&&e.setChActive(l,1),e.dispatchEvent("voice",{part:l});break}case 3:{let d=e.chRedir(s,i,!0);e.#u[l]=d,l!=d&&(console.info(`NS5R CH${l+1} receives from CH${d+1}.`),e.buildRchTree());break}case 7:{e.#s[l]=s,e.dispatchEvent("voice",{part:l});break}case 8:{e.#r[l*y.rpn+3]=s<40||s>88?s+(s>63?-192:64):s,e.#i[y.rpnt*l+2]=1;break}case 9:case 10:{e.#e[f+b[7]]=s;break}case 11:{e.#e[f+b[11]]=s;break}case 14:{e.#e[f+b[10]]=s||128;break}case 19:{e.#e[f+b[93]]=s;break}case 20:{e.#e[f+b[91]]=s;break}case 84:{e.#e[f+b[65]]=s;break}case 85:{e.#e[f+b[5]]=s;break}}break}case a<3096:break;case a<3134:{let l=a-3096;l<8?(s>31&&(n+=String.fromCharCode(s)),l==7&&(e.aiEfxName=n)):l<10&&(e.setEffectType(l-8,44,s),e.dispatchEvent(`efx${["reverb","chorus"][l-8]}`,e.getEffectType(l-8)));break}case a<8566:break}})}).add([66,54],(r,i)=>{e.switchMode("ns5r",!0);let n="",s=80,a=0,l=0,f="MSB	PRG	LSB	NME";O(r,function(d,p){let g=p%158;switch(!0){case g<10:{d>31&&(n+=String.fromCharCode(d));break}case g==10:break;case g==11:{s=d&127;break}case g==12:{l=d&127;break}case g==13:{f+=`
${s}	${a}	${l}	${n.trim().replace("Init Voice","")}`,a++,n="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(f),x()&&console.debug(f),e.forceVoiceRefresh()}).add([66,55],(r,i)=>{e.switchMode("ns5r",!0);let n="",s=88,a=0,l=0,f="MSB	PRG	LSB	NME";O(r,function(d,p){let g=p%126;switch(!0){case g<10:{d>31&&(n+=String.fromCharCode(d));break}case g==11:break;case g==12:break;case g==13:{f+=`
${s}	${a}	${l}	${n.trim().replace("Init Combi","")}`,a++,n="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(f),x()&&console.debug(f),e.forceVoiceRefresh()}).add([66,125],r=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][r[0]]||"white")}).add([66,127],r=>{let i=new Uint8Array(5760);O(r,(n,s,a)=>{if(s<720)for(let l=0;l<8;l++)i[s*8+l]=n>>7-l&1}),e.dispatchEvent("screen",{type:"ns5r",data:i})}).add([76],(r,i,n)=>{e.#K.run([66,...r],i,n)}),this.#Z.add([16,0,8,0],(r,i,n)=>{let s=(r[2]<<4)+r[3],a="K11 ";([()=>{e.switchMode("k11",!0),e.#g=!1,e.#M=s?4:0,console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,s),console.debug(`${a}reverb type: ${s}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{console.debug(`${a}reverb time: ${s}`)},()=>{console.debug(`${a}reverb time: ${s}`)},()=>{console.debug(`${a}reverb predelay: ${s}`)},()=>{console.debug(`${a}reverb predelay: ${s}`)},()=>{console.debug(`${a}depth high: ${s}`)},()=>{console.debug(`${a}depth high: ${s}`)},()=>{console.debug(`${a}depth low: ${s}`)},()=>{console.debug(`${a}depth low: ${s}`)}][r[0]]||(()=>{}))()}).add([16,0,8,1],(r,i,n)=>{let s=e.chRedir(r[1],i,!0),a=y.cc*s,l=y.rpn*s,f=(r[3]<<4)+r[4],d=`K11 CH${s+1} `;([()=>{f<128?(e.setChType(s,e.CH_MELODIC,w.k11),e.#e[a+b[0]]=0,e.#n[s]=f):(e.setChType(s,e.CH_DRUMS,w.k11),e.#n[s]=f-128),e.dispatchEvent("voice",{part:s})},()=>{let p=e.chRedir(f,i,!0);e.#u[s]=p,s!=p&&(e.buildRchTree(),console.info(`${d}receives from CH${p+1}`))},()=>{e.#e[a+b[7]]=f},()=>{uupThis.setChActive(s,f)},()=>{e.#e[a+b[10]]=f},()=>{e.#r[l+3]=f+40,e.#i[y.rpnt*s+2]=1},()=>{e.#r[l+1]=f>>1,e.#r[l+2]=f&1,e.#i[y.rpnt*s+1]=1},()=>{e.#e[a+b[91]]=f?127:0},()=>{},()=>{e.#e[a+b[74]]=f},()=>{e.#e[a+b[73]]=f},()=>{e.#e[a+b[72]]=f}][r[0]]||(()=>{}))()}).add([16,0,9,0],(r,i,n)=>{let s=(r[2]<<4)+r[3],a="GMLX ";([()=>{console.debug(`${a}reverb type: ${s}`)},()=>{console.debug(`${a}reverb time: ${s}`)},()=>{console.debug(`${a}reverb predelay: ${s}`)},()=>{console.debug(`${a}depth high: ${s}`)},()=>{console.debug(`${a}depth low: ${s}`)}][r[0]]||(()=>{}))()}).add([16,0,9,3],(r,i,n)=>{let s=(r[2]<<4)+r[3],a=e.chRedir(r[1],i,!0),l=a*y.cc;[()=>{s<128?(e.setChType(a,e.CH_MELODIC,w.k11),e.#e[l+b[0]]=0,e.#e[l+b[32]]=0,e.#n[a]=s):s<160?(e.setChType(a,e.CH_MELODIC,w.k11),e.#e[l+b[0]]=0,e.#e[l+b[32]]=7,e.#n[a]=s-100):(e.setChType(a,e.CH_DRUMS,w.k11),e.#e[l+b[0]]=122,e.#e[l+b[32]]=0,e.#n[a]=s-160),e.dispatchEvent("voice",{part:a})},()=>{let f=e.chRedir(s,i,!0);e.#u[a]=f,a!=f&&(e.buildRchTree(),console.info(`GMLX CH${a+1} receives from CH${f+1}`))}][r[0]]()}).add([16,0,9,4],(r,i,n)=>{let s=(r[2]<<4)+r[3],a=e.chRedir(r[1],i,!0),l=a*y.cc,f=a*y.rpn,d=`GMLX CH${a+1} `;[()=>{e.setChActive(a,s)},()=>{e.#e[l+b[7]]=s},()=>{e.#e[l+b[10]]=s},()=>{e.#e[l+b[91]]=s?127:0},()=>{e.#r[f+3]=s+40,e.#i[y.rpnt*a+2]=1},()=>{e.#r[f+1]=s,e.#i[y.rpnt*a+1]=1},()=>{e.#r[f]=s,e.#i[y.rpnt*a]=1},()=>{}][r[0]]()}),this.#J.add([66,93,64],(r,i,n)=>{let s=r[2];switch(r[0]){case 0:{switch(r[1]){case 4:{e.#f=s*129/16383*100,e.dispatchEvent("mastervolume",e.#f);break}case 5:{s-64;break}case 6:{console.debug(`SG global reverb: ${s?"on":"off"}`);break}case 127:{e.switchMode("sg",!0);break}}break}case 1:{switch(r[1]){case 48:{console.debug(`SG reverb type: ${J[s]}`);break}}break}default:if(r[0]>>4==1){let a=e.chRedir(r[0]&15,i,!0);if(r[1]==2){let l=e.chRedir(s,i,!0);e.#u[a]=l,a!=l&&(e.buildRchTree(),console.info(`SG CH${a+1} receives from CH${l+1}`))}else r[1]==19&&(e.#e[y.cc*a+b[7]]=s)}else console.warn(`Unknown AKAI SG SysEx: ${r}`)}}),this.#ee.add([9],(r,i,n)=>{console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremelo","phaser","rotary speaker","enhancer","flanger","EQ"][r[0]]||"off"}`)}),this.#A.add([127,0],(r,i,n)=>{e.switchMode("motif");let s=new Uint8Array([127,1,...r]);e.#A.run(s,i,n)}).add([127,1,0,0],(r,i,n)=>{e.switchMode("s90es");let s="S90/Motif ES system ",a=r[0];r.subarray(1).forEach((l,f)=>{([()=>{e.#f=l*12900/16383,e.dispatchEvent("mastervolume",e.#f)}][a+f]||(()=>{console.info(`Unrecognized ${s}ID: ${a+f}`)}))()})}).add([127,1,0,0,14],(r,i,n)=>{e.switchMode("s90es");let s="S90/Motif ES bulk header ",a=[];a[95]=(l,f,d)=>{console.debug(`${s}multi edit buffer: ${l[1]}`)},(a[r[0]]||(()=>{console.info(`Unrecognized ${s}ID: ${r[0]}.`)}))(r.subarray(1))}).add([127,1,0,0,15],(r,i,n)=>{e.switchMode("s90es");let s="S90/Motif ES bulk footer ",a=[];a[95]=(l,f,d)=>{console.debug(`${s}multi edit buffer: ${l[1]}`)},(a[r[0]]||(()=>{console.info(`Unrecognized ${s}ID: ${r[0]}.`)}))(r.subarray(1))}).add([127,1,0,58,55],(r,i,n)=>{e.switchMode("s90es");let s=e.chRedir(r[0],i,!0),a=y.cc*s,l=r[1],f=`S90/Motif ES bulk CH${s<16?s+1:"U"+(s-95)} `;console.debug(f,r),!(r[0]>15)&&r.subarray(2).forEach((d,p)=>{([()=>{e.#e[a+b[0]]=d,e.dispatchEvent("voice",{part:s})},()=>{d&&e.setChActive(s,1),e.#e[a+b[32]]=d,e.setChType(s,[32,40].indexOf(d)>-1?e.CH_DRUMS:e.CH_MELODIC,e.#t,!0),e.dispatchEvent("voice",{part:s})},()=>{d&&e.setChActive(s,1),e.#n[s]=d,e.dispatchEvent("voice",{part:s})},()=>{let g=e.chRedir(d,i,!0);e.#u[s]=g,s!=g&&(e.buildRchTree(),console.info(`${f}receives from CH${g+1}`))},()=>{e.#p[s]=d?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{e.#e[a+b[7]]=d},()=>{e.#e[a+b[10]]=d},!1,!1,!1,()=>{e.#e[a+b[91]]=d},()=>{e.#e[a+b[93]]=d},()=>{e.#e[a+b[94]]=d},()=>{e.#e[a+b[128]]=d},()=>{},()=>{e.#e[a+b[74]]=d},()=>{e.#e[a+b[71]]=d},!1,()=>{e.#e[a+b[65]]=d},()=>{e.#e[a+b[5]]=d},()=>{}][l+p]||(()=>{}))()})}).add([127,1,54,16],(r,i,n)=>{e.switchMode("s90es");let s=r[0];r.subarray(1).forEach((a,l)=>{let d=`S90/Motif ES EQ${(l>>2)+1} `;([()=>{let p=a-64},()=>{let p=B[a]},()=>{let p=a/10},()=>{let p=a}][s+l&3]||(()=>{}))()})}),this.#L.add([0,72,18,0,0,0,0],(r,i,n)=>{e.switchMode("sd",!0),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(r,i,n)=>{let s=r[0]>>5,a=r[0]&31;switch(s){case 0:{console.debug(`Unknown SD-90 global effects message:
%o`,r);break}case 1:{let l=e.chRedir(a,i,!0),f=r[1],d=l*y.cc;r.subarray(2).forEach((p,g)=>{let v=f+g;v<37?([()=>{},()=>{},0,()=>{},()=>{switch(e.#e[d+b[0]]=p,p){case 104:case 105:case 106:case 107:case 120:{e.#s[l]||e.setChType(l,e.CH_DRUMS);break}default:e.#s[l]&&e.setChType(l,e.CH_MELODIC)}e.dispatchEvent("voice",{part:l})},()=>{e.#e[d+b[32]]=p,e.dispatchEvent("voice",{part:l})},()=>{e.#n[l]=p,e.dispatchEvent("voice",{part:l})},()=>{e.#e[d+b[7]]=p},()=>{e.#e[d+b[10]]=p},()=>{},()=>{},()=>{p<2&&(e.#p[l]=p)},()=>{p<2&&(e.#e[d+b[68]]=p?127:0)},()=>{},()=>{p<2&&(e.#e[d+b[65]]=p?127:0)},()=>{e.#e[d+b[5]]=p&15<<4|e.#e[d+b[5]]&15},()=>{e.#e[d+b[5]]=p&15|(e.#e[d+b[5]]&240)>>4},()=>{e.#e[d+b[74]]=p},()=>{e.#e[d+b[71]]=p},()=>{e.#e[d+b[73]]=p},()=>{e.#e[d+b[72]]=p},0,0,0,0,0,0,0,()=>{e.#e[d+b[128]]=p},()=>{e.#e[d+b[93]]=p},()=>{e.#e[d+b[91]]=p},0,0,()=>{e.#e[d+b[75]]=p},()=>{e.#e[d+b[76]]=p},()=>{e.#e[d+b[77]]=p},()=>{e.#e[d+b[78]]=p}][v]||(()=>{}))():v<63||(v<64?e.#s[l]?e.#e[d+b[0]]=104|p:e.#e[d+b[0]]=96|p:console.debug(`Unknown SD-90 global CH${l+1} param setup message:
%o`,r))});break}case 2:{let l=e.chRedir(a,i,!0),f=r[1];console.debug(`Unknown SD-90 global CH${l+1} MIDI setup message:
%o`,r.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,r)}})}};var ne=Ze(Le(),1);var Ie=class{#t=!1;constructor(e,t,c,o){this.#t=e,this.start=t,this.end=c,this.data=o}get duration(){return this.ranged?this.end-this.start:0}get ranged(){return this.#t}},ie=class extends Ie{constructor(e,t,c){super(!0,e,t,c)}},Ue=class extends Ie{constructor(e,t){super(!1,e,e,t)}},se=class extends Array{#t=-1;constructor(){super(...arguments)}resetIndex(e){this.#t=-1}fresh(){this.sort(function(e,t){return e.start==t.start?0:(+(e.start>t.start)<<1)-1}),this.forEach(function(e,t){e.index=t})}step(e,t=!1){let c=[];if(t)for(let o=0;o<this.length&&!(this[o].start>e);o++){if(this[o].end<e)continue;c.push(this[o])}else{let o=this.getRange(this.#t==-1?0:e-1,e),h=this;o.forEach(function(u){u.index>h.#t&&(c.push(u),h.#t=u.index)})}return c}getRange(e,t){e>t&&([e,t]=[t,e]);let c=[],o=-1,h=Math.ceil(Math.sqrt(this.length)),u=!0;for(let m=0;m<this.length;m+=h)this[m+h]?o<0&&this[m+h].start>=e&&(o=m):o=o<0?m:o;for(;u;)this[o]?.end<t?this[o].start>=e&&c.push(this[o]):u=!1,o++;return c}};var dt=0xffffffffffff,Ne=function(e){let t=new se,c=this,o=e.timeDivision,h=120,u=new se,m=0,r=0;u.push(new ie(0,dt,[120,0])),e.track.forEach(function(a){m=0,a.event.forEach(function(l){m+=l.deltaTime,l.type==255&&l?.metaType==81&&(h=6e7/l.data,u[u.length-1]&&u.push(new ie(m,0xffffffffffff,[h,0])))})}),u.fresh(),u.forEach(function(a,l,f){l>0&&(f[l-1].end=a.start)});let i=120;u.forEach(function(a,l,f){l>0&&(a.end==a.start?f.splice(f.indexOf(a),1):i==a.data[0]&&(f[l-1].end=a.end,f.splice(f.indexOf(a),1)),i=a.data[0])});let n=0,s=120;return u.forEach(function(a){let l=a.start,f=l/s/o*60+n;s=a.data[0],n=f-l/s/o*60,a.data[1]=n}),console.debug("All tempo changes: ",u),h=120,m=0,r=0,e.track.forEach(function(a,l){m=0,r=0;let f=l+1;a.event.forEach(function(d,p){m+=d.deltaTime;let g=u.step(m,!0)[0];g&&(h=g.data[0],r=g.data[1]);let v={type:d.type,data:d.data,track:f,part:0};d.type>14?v.meta=d.metaType:v.part=d.channel,t.push(new Ue(m/h/o*60+r,v))})}),t.fresh(),self.midiEvents=t,console.debug(`Parsed a type ${e.formatType} MIDI sequence.`),t};ne.default.customInterpreter=xe;var S=function(e,t,c){e.addEventListener(c,o=>{t.dispatchEvent(c,o.data)})},Be=class extends K{device;#t;#h={};#E=[];#o="";#m=[];#w=new Uint8ClampedArray(128);#u=new Uint8ClampedArray(128);#s=.5;#e=120;#d=4;#n=4;#l=0;#p=0;smoothingAtk=0;smoothingDcy=0;reset(){let e=this;e.dispatchEvent("reset"),e.#t?.resetIndex(),e.device.init(),e.#o="",e.#s=.5,e.#e=120,e.#d=4,e.#n=4,e.#l=0,e.#p=0,e.dispatchEvent("tempo",e.#e),e.dispatchEvent("title",e.#o)}init(){this.reset(),this.#t=void 0}async loadFile(e){this.#t=Ne(ne.default.parse(new Uint8Array(await e.arrayBuffer())))}async loadMap(e,t){let c=this,o=0,h=0,u=0,m,r;e.split(`
`).forEach((i,n)=>{if(!i)return;let s=i.split("	");if(n){if(!u)return;let a="",l="";s.forEach((f,d)=>{switch(d){case m:{a=f;break}case r:{l=f;break}}}),!c.#h[a]||t?(c.#h[a]=l,o++):self.debugMode&&console.debug(`Voice "${l}" (${a}) seems to be in conflict with (${c.#h[a]}).`),h++}else s.forEach((a,l)=>{switch(a){case"ID":{m=l,u++;break}case"Name":{r=l,u++;break}default:console.debug(`Unknown map field: ${a}`)}})}),console.debug(`Voice names: ${h} total, ${o} loaded.`),c?.device.forceVoiceRefresh()}async loadEfx(e,t){let c=this,o=0,h=0,u,m,r;e.split(`
`).forEach((i,n)=>{if(i)if(n){let s=0,a;i.split("	").forEach((l,f)=>{switch(f){case u:{s|=parseInt(l,16)<<8;break}case m:{s|=parseInt(l,16);break}case r:{a=l;break}}}),!c.#E[s]||t?(c.#E[s]=a,o++):self.debugMode&&console.debug(`EFX ID 0x${s.toString(16).padStart(4,"0")} (${a}) seems to be in conflict.`),h++}else i.split("	").forEach((s,a)=>{switch(s){case"MSB":{u=a;break}case"LSB":{m=a;break}case"Name":{r=a;break}default:console.debug(`Unknown EFX field: ${s}`)}})}),console.debug(`EFX: ${h} total, ${o} loaded.`),c.dispatchEvent("efxreverb",c.device.getEffectType(0)),c.dispatchEvent("efxchorus",c.device.getEffectType(1)),c.dispatchEvent("efxdelay",c.device.getEffectType(2)),c.dispatchEvent("efxinsert0",c.device.getEffectType(3)),c.dispatchEvent("efxinsert1",c.device.getEffectType(4)),c.dispatchEvent("efxinsert2",c.device.getEffectType(5)),c.dispatchEvent("efxinsert3",c.device.getEffectType(6))}switchMode(e,t=!1){this.device.switchMode(e,t)}getMode(){return this.device.getMode()}getVoice(){return this.device.getVoice(...arguments)}getChVoice(e){return this.device.getChVoice(e)}getMapped(e){return this.#h[e]||e}getEfx([e,t]){let c=e<<8|t;return this.#E[c]||`0x${c.toString(16).padStart(4,"0")}`}get noteProgress(){return this.#p/this.#s}get noteOverall(){return this.noteProgress-this.#l}get noteBar(){return Math.floor(this.noteOverall/this.#d)}get noteBeat(){let e=this.noteOverall%this.#d;return e<0&&(e+=this.#d),e}getTimeSig(){return[this.#d,this.#n]}getTempo(){return this.#e}sendCmd(e){this.device.runJson(e)}render(e){e>this.#p&&(this.#p=e);let t=this.#t?.step(e)||[],c=0,o=new Set,h=this,u=[];this.device.getStrength().forEach((p,g)=>{this.#u[g]=p}),h.device.newStrength(),t.forEach(function(p){let g=p.data;g.type==9&&(g.data[1]>0?o.add(g.part*128+g.data[0]):o.has(g.part*128+g.data[0])&&c++),p.data.type==8&&o.has(g.part*128+g.data[0])&&c++;let v=h.device.runJson(g);switch(v?.reply){case"meta":{u.push(v);break}}v?.reply&&delete v.reply}),u?.length>0&&this.dispatchEvent("meta",u);let m=this.device.getActive(),r=[],i=h.device.getPitch(),n=h.device.getCcAll(),s=h.device.getProgram(),a=h.device.getChType(),l=this.device.getStrength();l.forEach(function(p,g,v){v[g]=Math.max(h.#u[g],p);let k=v[g]-h.#w[g],$=b.length*g;if(k>=0){let I=4*.25**(n[$+b[73]]/64);h.#w[g]+=Math.ceil(k-k*h.smoothingAtk**I)}else{let I=4*.25**(n[$+b[72]]/64);h.#w[g]+=Math.floor(k-k*h.smoothingDcy**I)}});let f=0;return m.forEach(function(p,g){p&&(r[g]=h.device.getVel(g),f+=r[g].size)}),{extraPoly:c,curPoly:f,chInUse:m,chKeyPr:r,chPitch:i,chProgr:s,chContr:n,chType:a,eventCount:t.length,title:this.#o,bitmap:this.device.getBitmap(),letter:this.device.getLetter(),texts:this.device.getTexts(),master:this.device.getMaster(),mode:this.device.getMode(),strength:this.#w.slice(),velo:l,rpn:this.device.getRpn(),tSig:this.getTimeSig(),tempo:this.getTempo(),noteBar:this.noteBar,noteBeat:this.noteBeat,ace:this.device.getAce(),efxSink:this.device.getEffectSink()}}constructor(e,t=.5,c=.5){super();let o=this;o.smoothingAtk=t,o.smoothingDcy=c,o.device=e,o.addEventListener("meta",function(h){h?.data?.forEach(function(u){(o.#m[u.meta]||console.debug).call(o,u.meta,u.data)})}),S(o.device,o,"mode"),S(o.device,o,"mastervolume"),S(o.device,o,"channelactive"),S(o.device,o,"channelmin"),S(o.device,o,"channelmax"),S(o.device,o,"channelreset"),S(o.device,o,"channeltoggle"),S(o.device,o,"screen"),S(o.device,o,"metacommit"),S(o.device,o,"voice"),S(o.device,o,"pitch"),S(o.device,o,"note"),S(o.device,o,"reset"),S(o.device,o,"efxreverb"),S(o.device,o,"efxchorus"),S(o.device,o,"efxdelay"),S(o.device,o,"efxinsert0"),S(o.device,o,"efxinsert1"),S(o.device,o,"efxinsert2"),S(o.device,o,"efxinsert3"),S(o.device,o,"partefxtoggle"),o.#m[3]=function(h,u){o.#o?.length<1&&(o.#o=u,o.dispatchEvent("title",o.#o))},o.#m[81]=function(h,u){let m=o.noteProgress,r=o.#s||.5;o.#e=6e7/u,o.#s=u/1e6,o.#l+=m*(r/o.#s)-m,o.dispatchEvent("tempo",o.#e)},o.#m[88]=function(h,u){let m=o.noteProgress,r=o.noteOverall,i=o.noteBar,n=o.noteBeat,s=o.#d,a=o.#n;o.#d=u[0],o.#n=1<<u[1];let l=24*(32/u[3])/u[2];if(s!=o.#d){let f=i;o.#l-=f*(o.#d-s),n+1>=s&&(s<o.#d?o.#l-=Math.ceil(o.#d-n-1):o.#l+=o.#d)}o.dispatchEvent("tsig",o.getTimeSig())}}};var ce=new Uint8Array(40),V=0,le,ia=setInterval(()=>{le&&(ce[V]=!ce[V],V++,V>34&&(V=0))},1e3/50);Uint8Array.prototype.render=function(e){let t=0,c=0,o=this.width||5,h=this.height||8;for(let u=0;u<this.length;u++)e(this[u],t,c,this),t++,t>=o&&(t=0,c++)};var He=class{#t=[];async load(e,t=!1,c="(internal)"){let o=this,h=0,u=0;console.debug(`Font "${c||"(internal)"}": loading started.`),e.split(`
`).forEach(function(m,r){if(r>0&&m?.length>0){let i=m.split("	"),n=parseInt(i[0],16);if(u++,o.#t[n]&&!t)return;let s=new Uint8Array(40);Array.from(i[1]).forEach(async function(a,l){let f=l%2?4:0,d=Math.floor(l/2),p=parseInt(a,16),g=3;for(;p>0||g>=0;){let v=(f+g)*5+d;s[v]=p&1,p=p>>1,g--}}),o.#t[n]=s,h++}}),console.debug(`Font "${c||"(internal)"}": ${u} total, ${h} loaded.`)}async loadFile(e,t=!1){let c=this;console.debug(`Requested font file from "${e}".`),await c.load(await(await fetch(e)).text(),t,e),le=!1}constructor(...e){le=!0,(async()=>{for(let t=0;t<e.length;t++)await this.loadFile(e[t])})()}getCP(e){return this.#t[e]}getStr(e){let t=[],c=this;return Array.from(e).forEach(function(o){t.push(c.#t[o.charCodeAt(0)]||c.#t[32]||ce)}),t}};var W=16/9,Q=64,ft="Vx,Dr,D1,D2,D3,D4,D5,D6,D7,D8".split(","),ht=[1,3,6,8,10],Ge=[0,.5,1,1.5,2,3,3.5,4,4.5,5,5.5,6],ut={"?":"Unset",gm:"General MIDI",g2:"General MIDI 2",xg:"Yamaha XG",gs:"Roland GS",mt32:"Roland MT-32",sd:"Roland SD",x5d:"Korg X5D","05rw":"Korg 05R/W",ns5r:"Korg NS5R",k11:"Kawai K11",sg:"Akai SG",krs:"Korg KROSS 2",s90es:"Yamaha S90 ES",motif:"Yamaha Motif ES"},pt={Copyrite:"Copyright","Cmn.Text":"Text","C.Lyrics":"Lyrics","C.Marker":"Marker",CuePoint:"Cue Point",Instrmnt:"Instrument","Kar.Info":"Kar Info","Kar.Mode":"Karaoke","Kar.Lang":"Language",KarTitle:"Kar Title",KarLyric:"Kar Lyrics","Kar.Ver.":"Kar Version",SGLyrics:"SG Lyrics",TrkTitle:"Title",XfSngDte:"XF Date",XfSngRgn:"XF Region",XfSngCat:"XF Category",XfSongBt:"XF Beat",XfSngIns:"XF Instr.",XfSngVoc:"XF Vocalist",XfSngCmp:"XF Composer",XfSngLrc:"XF Lyricist",XfSngArr:"XF Arranger",XfSngPer:"XF Perform.",XfSngPrg:"XF Program.",XfSngTag:"XF Tags",XfKarLng:"XF Lang.",XfKarNme:"XF Name",XfKarCmp:"XK Composer",XfKarLrc:"XK Lyricist",XfKarArr:"XK Arranger",XfKarPer:"XK Perform.",XfKarPrg:"XK Program."},bt=["XfSongBt","XfSngIns"],oe=[[],[12,8],[6,3]],gt=[{l:0,t:0},{l:0,t:416},{l:960,t:0},{l:960,t:416}],Xe={none:{font4:[0,0],font7:[0,0]},macos:{font4:[2,0],font7:[0,0]}},E=function(e,t,c={}){let o=document.createElement(e);t?.forEach(s=>{o.classList.add(s)});let{t:h,l:u,w:m,h:r,i,a:n}=c;return h?.constructor&&(o.style.top=h?.length?h:`${h}px`),u?.constructor&&(o.style.left=u?.length?u:`${u}px`),m?.constructor&&(o.style.width=m?.length?m:`${m}px`),r?.constructor&&(o.style.height=r?.length?r:`${r}px`),i?.constructor&&o.appendChild(document.createTextNode(i)),n?.constructor&&(o.style.textAlign=n),o},M=function(e,t){let c=document.createElementNS("http://www.w3.org/2000/svg",e);for(let o in t)c.setAttribute(o,t[o]);return c},T=function(e,t){t?.forEach(c=>{e.appendChild(c)})},L=function(e,t){t.forEach(c=>{e.classList.contains(c)&&e.classList.remove(c)})},N=function(e,t){t.forEach(c=>{e.classList.contains(c)||e.classList.add(c)})},Fe=new Array(128).fill(0);Fe.forEach((e,t,c)=>{c[t]=Math.floor(24*t/12.7)/10});var de=new Array(128).fill(0);de.forEach((e,t,c)=>{c[t]=Math.abs(Math.round(48*(t-64)/12.7)/10)});var Ve=new Array(11).fill(null);Ve.forEach((e,t,c)=>{c[t]=`${Math.round(t*12/.0128)/100}%`});var mt=new Array(128).fill(null);mt.forEach((e,t,c)=>{c[t]=`${Math.round(t/1.27)/100}`});var P=function(e,t){let c=Fe[t];e.setAttribute("height",c),e.setAttribute("y",24-c)},_e=function(e,t){e.innerText=t,e.rNew=!0;let c=e.measureText(t);e.rWidth=c.width},da=class extends Be{#t=128;#h=!1;#E="";#o;#m=0;#w=0;#u=0;#s=0;#e=1;#d=0;#n=new Uint8Array(1280);#l=new Uint8Array(1280);#p=new Uint8Array(1280);#b=new Uint8Array(512);#v=new Uint8Array(512);#D=new Uint8Array(512);#C;#H;#r;#i;#I;#x="fcdaff";#a={};#$={};#c=[];#y={};#S={};#T=[];#G=[];#O="block";glyphs=new He;#M(e,t,c,o=0,h=0){let u=this,{width:m,height:r}=e.canvas,i,n,s,a,l=u.#e,f=o>3,d=ht.indexOf(t%12)>-1;switch(u.#O){case"block":case"comb":{i=Math.round(t*m/128),n=Math.round((t+1)*m/128),s=n-i,a=l==1?2:1;break}case"piano":{i=Math.round((Math.floor(t/12)*7+Ge[t%12])*m/75*1.0044642857142856),n=Math.round((Math.floor(t/12)*7+Ge[t%12]+1)*m/75*1.0044642857142856)-1,s=n-i,a=l==1?3:1;break}case"line":{let p=t-h;Math.abs(h)>2&&(p=t-Math.sign(h)*2),n=Math.round((t+.5)*m/128),i=Math.round((p+.5)*m/128)}default:}switch(e.fillStyle=`#${d?u.#x:"ffffff"}${(c<<1|c>>6).toString(16).padStart(2,"0")}`,e.strokeStyle=e.fillStyle,e.lineWidth=l==1?4:2,e.lineDashOffset=0,u.#O){case"block":{let p=e.canvas.height-1;e.fillRect(i,1,s,p),f&&e.clearRect(i+a,a+1,s-(a<<1),p-(a<<1));break}case"comb":{let p=(d?Math.round((e.canvas.height<<1)/3):e.canvas.height)-1;e.fillRect(i,1,s,p),f&&e.clearRect(i+a,a+1,s-(a<<1),p-(a<<1));break}case"piano":{let p=(d?0:e.canvas.height>>1)+1,g=(e.canvas.height>>1)-1;e.fillRect(i,p,s,g),f&&e.clearRect(i+a,p+a,s-(a<<1),g-(a<<1));break}case"line":{if(f)switch(l){case 4:{e.setLineDash(oe[2]);break}default:e.setLineDash(oe[1])}else e.setLineDash(oe[0]),l!=4&&self?.document?.mozFullScreen&&(i+=.5,n+=.5);e.beginPath(),e.moveTo(i,(l==4||!f)&&self?.document?.mozFullScreen?2:1),e.lineTo(n,(r>>1)+2),e.lineTo(i,r+2),e.stroke();break}default:}}#f(e,t){let c=this;(e?.chInUse||t).forEach((o,h)=>{if(o){let u=c.#c[h>>4][h&15].cxt;u.clearRect(0,0,u.canvas.width,u.canvas.height),e.chKeyPr[h].forEach(({v:m,s:r},i)=>{c.#M(u,i,m,r,c.device.getPitchShift(h))})}})}#X(e){let t=this;Date.now()-t.#m>4e3&&(t.#w=0,t.#u=142-t.#y.view.clientHeight,(t.#o?.clientWidth||0)>840&&(t.#w=840-t.#o.clientWidth),t.#y.view.style.transform=`translateX(${t.#w}px) translateY(${t.#u}px)`,e&&(t.#m=0))}#z(){let e=self.innerWidth/self.innerHeight,t=1,c=self.innerWidth,o=self.innerHeight;e>=W?(t=Math.round(self.innerHeight/1080*1e4)/1e4,c=Math.ceil(self.innerHeight*W)):e<W&&(t=Math.round(self.innerWidth/1920*1e4)/1e4,o=Math.ceil(self.innerWidth/W)),this.#r.style.width=`${c}px`,this.#r.style.height=`${o}px`,this.#i.style.transform=`scale(${t})`}#U;#_(){let e=this,t=e.#C?.currentTime||0,c=e.render(t),o=Date.now(),h=c.curPoly+c.extraPoly;e.#s<h&&(e.#s=h),e.#a.events.innerText=`${c.eventCount}`.padStart(3,"0"),e.#a.curPoly.innerText=`${h}`.padStart(3,"0"),e.#a.maxPoly.innerText=`${e.#s}`.padStart(3,"0"),e.#C?.realtime?(e.#a.barCount.innerText="LIVE",e.#a.barNote.innerText="0"):(e.#a.barCount.innerText=c.noteBar+1,e.#a.barNote.innerText=Math.floor(c.noteBeat)+1),e.#X(!0);let u=e.#d+e.#e;for(let a=0;a<y.ch;a++){let l=a>>4,f=a*y.cc,d=e.#c[l][a&15];if(c.chInUse[a]&&l>=e.#d&&l<u){if(P(d.vol,c.chContr[f+b[7]]),P(d.exp,c.chContr[f+b[11]]),P(d.mod,c.chContr[f+b[1]]),P(d.rev,c.chContr[f+b[91]]),P(d.cho,c.chContr[f+b[93]]),P(d.var,c.chContr[f+b[94]]),P(d.brt,c.chContr[f+b[74]]),P(d.por,c.chContr[f+b[5]]),P(d.cea,c.ace[0]?c.chContr[f+b[c.ace[0]]]:0),P(d.ceb,c.ace[1]?c.chContr[f+b[c.ace[1]]]:0),d.metre.clearRect(0,0,121,25),d.metre.globalCompositeOperation="source-over",d.metre.rWidth>d.metre.canvas.width){d.metre.rNew&&(d.metre.rNew=!1,d.metre.rOffset=t);let g=t-(d.metre.rOffset||0),v=32,k=d.metre.rWidth-d.metre.canvas.width+v,$=g*-25%(d.metre.rWidth+v+48)+48;$>0&&($=0),d.metre.fillText(d.metre.innerText,$,3+e.#I.font4[0]),Math.abs($)>k&&d.metre.fillText(d.metre.innerText,$+d.metre.rWidth+v,3+e.#I.font4[0])}else d.metre.fillText(d.metre.innerText,0,3+e.#I.font4[0]);d.metre.globalCompositeOperation="xor",d.metre.fillRect(0,0,c.strength[a]*121/255,25);let p=c.chContr[f+b[10]];d.pan.setAttribute("width",`${de[p]||0}`),p<64?d.pan.setAttribute("x",`${84-de[p]}`):p>127?(d.pan.setAttribute("x","60"),d.pan.setAttribute("width","48")):d.pan.setAttribute("x","84")}}let m=new Set,r=new Set,i=new Array(y.ch),n={};if(e.#c.forEach((a,l)=>{a.forEach((f,d)=>{f.refresh&&(f.refresh=!1,i[l<<7|d]=!0)})}),["line"].indexOf(e.#O)>-1)for(;e.#G.length>0;){let a=e.#G.shift();i[a.part]=!0}for(;e.#T.length>0;){let a=e.#T.shift(),{part:l,note:f,velo:d,state:p}=a,g=l<<7|f;i[l]=!0,p==0?m.has(g)&&(r.add(g),e.#c[l>>4][l&15].refresh=!0):(m.add(g),n[g]=a)}e.#f(c,i),r.forEach(a=>{let{part:l,note:f,velo:d,state:p}=n[a],g=e.#c[l>>4][l&15].cxt;e.#M(g,f,d,p,e.device.getPitchShift(l))});let s=e.#S.cxt;o>c.bitmap.expire?e.#D.fill(0):c.bitmap.bitmap.length>256?c.bitmap.bitmap.forEach((a,l)=>{e.#D[l]=a?255:0}):c.bitmap.bitmap.forEach((a,l)=>{e.#D[l<<1]=a?255:0,e.#D[l<<1|1]=a?255:0}),e.#p.fill(0),o<=c.letter.expire&&e.glyphs.getStr(c.letter.text).forEach((a,l)=>{let f=(l&15)*5,d=l>>4<<3;a.forEach((p,g)=>{let v=f+g%5,k=d+Math.floor(g/5);e.#p[k*80+v]=p?255:0})}),e.#b.forEach((a,l,f)=>{let d=e.#D[l];d>a?f[l]+=Math.min(d-a,Q):d<a&&(f[l]-=Math.min(a-d,Q))}),e.#n.forEach((a,l,f)=>{let d=e.#p[l];d>a?f[l]+=Math.min(d-a,Q):d<a&&(f[l]-=Math.min(a-d,Q))}),e.#b.forEach((a,l)=>{let f=l>>5,d=l&31;e.#v[l]!=a?(s.clearRect(252+(d<<2),f<<2,3,3),a&&(s.fillStyle=`#ffffff${a.toString(16).padStart(2,"0")}`,s.fillRect(252+(d<<2),f<<2,3,3))):self.debugMode&&(s.clearRect(252+(d<<2),f<<2,3,3),a&&(s.fillStyle=`#ff0000${a.toString(16).padStart(2,"0")}`,s.fillRect(252+(d<<2),f<<2,3,3)))}),e.#n.forEach((a,l)=>{let f=Math.floor(l/80),d=l%80;d+=Math.floor(d/5),e.#l[l]!=a?(s.clearRect(d<<2,(f|16)<<2,3,3),a&&(s.fillStyle=`#ffffff${a.toString(16).padStart(2,"0")}`,s.fillRect(d<<2,(f|16)<<2,3,3))):self.debugMode&&(s.clearRect(d<<2,(f|16)<<2,3,3),a&&(s.fillStyle=`#ff0000${a.toString(16).padStart(2,"0")}`,s.fillRect(d<<2,(f|16)<<2,3,3)))}),e.#v.forEach((a,l,f)=>{f[l]=e.#b[l]}),e.#l.forEach((a,l,f)=>{f[l]=e.#n[l]})}#N;#q;get style(){return this.#O}set style(e){let t=this;t.#O=e,t.#f(t.render(t.#C?.currentTime||0)),L(t.#i,["cambiare-style-block","cambiare-style-comb","cambiare-style-piano","cambiare-style-line"]),N(t.#i,[`cambiare-style-${e}`])}setClockSource(e){this.#C=e}setPixelProfile(e){let t=this;if(Xe[e]){let c=Xe[e];t.#I=c,t.#i&&(t.#i.style.setProperty("--pcp-font4",`translate(${c.font4[1]}px, ${c.font4[0]}px)`),t.#i.style.setProperty("--pcp-font7",`translate(${c.font7[1]}px, ${c.font7[0]}px)`))}else throw new Error(`"${e}" is not a valid pixel correction profile`)}setMode(e){let t=this;L(t.#i,["cambiare-mode-gm","cambiare-mode-xg","cambiare-mode-gs","cambiare-mode-ns5r","cambiare-mode-05rw","cambiare-mode-x5d","cambiare-mode-k11","cambiare-mode-sg","cambiare-mode-g2","cambiare-mode-mt32","cambiare-mode-sd","cambiare-mode-krs","cambiare-mode-s90es","cambiare-mode-motif"]),e!="?"&&N(t.#i,[`cambiare-mode-${e}`]),t.#x={xg:"9efaa0",ns5r:"9efaa0",x5d:"9efaa0","05rw":"9efaa0",k11:"9efaa0",s90es:"9efaa0",motif:"9efaa0",gm:"a1f3ff",g2:"a1f3ff",krs:"a1f3ff",gs:"ffe1a5",mt32:"ffe1a5",sd:"ffe1a5",sg:"ffdddd"}[e]||"fcdaff"}#F(e){let t=this,c=t.#e,o=t.#d;t.#c.forEach((h,u)=>{if(u>=o&&u<o+c){N(h.root,["port-active"]);let m=u-o,{l:r,t:i}=gt[m*(4/c)];h.root.style.top=`${i}px`,h.root.style.left=`${r}px`,h.forEach((n,s)=>{n.root.style.top=`${s*(c>2?26:52)}px`})}else L(h.root,["port-active"]),h.root.style.top="",h.root.style.left="",h.forEach((m,r)=>{m.root.style.top=""});e&&h.forEach((m,r)=>{m.cxt.canvas.width=t.#e==1?1193:495,m.cxt.canvas.height=t.#e==4?26:52})})}setPort(e){let t=this;L(t.#i,["cambiare-start0","cambiare-start1","cambiare-start2","cambiare-start3","cambiare-start4","cambiare-start5","cambiare-start6","cambiare-start7"]),N(t.#i,[`cambiare-start${e}`]),t.#d=e,t.#F(!1)}setRange(e){let t=this;L(t.#i,["cambiare-port1","cambiare-port2","cambiare-port4","cambiare-compact"]),N(t.#i,[`cambiare-${e}`]),t.#e=parseInt(e.slice(4))||1,t.#F(!0)}attach(e){let t=this;t.#H=e;let c=E("div",["cambiare-container"]);e.appendChild(c),t.#r=c;let o=E("div",["cambiare-canvas","cambiare-port1","cambiare-start0","cambiare-style-block"]);c.appendChild(o),t.#i=o,self.addEventListener("resize",t.#U),t.#U(),t.#q=setInterval(t.#N,20),t.#a.root=E("div",["sect-info"]),t.#a.events=E("span",["field","pcp-font4"],{t:1,l:0,w:35,h:33}),t.#a.curPoly=E("span",["field","pcp-font4"],{t:1,l:52,w:35,h:33}),t.#a.maxPoly=E("span",["field","pcp-font4"],{t:1,l:98,w:35,h:33}),t.#a.sigN=E("span",["field","pcp-font4"],{t:1,l:194,w:23,h:33,a:"right"}),t.#a.sigD=E("span",["field","pcp-font4"],{t:1,l:232,w:23,h:33}),t.#a.barCount=E("span",["field","pcp-font4"],{t:1,l:304,w:35,h:33,a:"right"}),t.#a.barNote=E("span",["field","pcp-font4"],{t:1,l:354,w:23,h:33}),t.#a.tempo=E("span",["field","pcp-font4"],{t:1,l:454,w:64,h:33,a:"right"}),t.#a.volume=E("span",["field","pcp-font4"],{t:1,l:562,w:63,h:33,a:"right"}),t.#a.mode=E("span",["field","pcp-font4"],{t:1,l:708,w:152,h:33}),t.#a.reverb=E("span",["field","pcp-font4"],{t:1,l:1e3,w:190,h:33}),t.#a.chorus=E("span",["field","pcp-font4"],{t:1,l:1240,w:190,h:33}),t.#a.delay=E("span",["field","pcp-font4"],{t:1,l:1475,w:190,h:33}),t.#a.insert=E("span",["field","pcp-font4"],{t:1,l:1706,w:190,h:33}),t.#a.title=E("span",["field","pcp-font4"],{t:35,l:50,w:810,h:33}),o.appendChild(t.#a.root),T(t.#a.root,[t.#a.events,t.#a.curPoly,E("span",["field","field-label","pcp-font4"],{t:1,l:89,w:5,h:33,i:":"}),t.#a.maxPoly,E("span",["field","field-key","pcp-font7"],{t:1,l:148,w:41,h:33,i:"TSig"}),t.#a.sigN,E("span",["field","field-label","pcp-font4"],{t:0,l:221,w:8,h:33,i:"/"}),t.#a.sigD,E("span",["field","field-key","pcp-font7"],{t:1,l:268,w:30,h:33,i:"Bar"}),t.#a.barCount,E("span",["field","field-label","pcp-font4"],{t:0,l:343,w:8,h:33,i:"/"}),t.#a.barNote,E("span",["field","field-key","pcp-font7"],{t:1,l:390,w:61,h:33,i:"Tempo",a:"right"}),t.#a.tempo,E("span",["field","field-key","pcp-font7"],{t:1,l:528,w:29,h:33,i:"Vol"}),t.#a.volume,E("span",["field","field-label","pcp-font4"],{t:1,l:626,w:17,h:33,i:"%"}),E("span",["field","field-key","pcp-font7"],{t:1,l:652,w:52,h:33,i:"Mode"}),t.#a.mode,E("span",["field","field-key","pcp-font7"],{t:1,l:960,w:34,h:33,i:"Rev"}),t.#a.reverb,E("span",["field","field-key","pcp-font7"],{t:1,l:1198,w:36,h:33,i:"Cho"}),t.#a.chorus,E("span",["field","field-key","pcp-font7"],{t:1,l:1438,w:31,h:33,i:"Var"}),t.#a.delay,E("span",["field","field-key","pcp-font7"],{t:1,l:1673,w:27,h:33,i:"Ins"}),t.#a.insert,E("span",["field","field-key","pcp-font7"],{t:35,l:0,w:44,h:33,i:"Title"}),t.#a.title]),t.#$.root=E("div",["sect-mark"]),t.#$.left=E("div",["sect-mark-left","boundary"],{t:0,l:0}),t.#$.right=E("div",["sect-mark-right","boundary"],{t:0,l:960}),o.appendChild(t.#$.root),T(t.#$.root,[t.#$.left,t.#$.right]),T(t.#$.left,[E("span",["field","field-key"],{t:0,l:0,w:26,h:33,i:"CH"}),E("span",["field","field-key"],{t:0,l:30,w:49,h:33,i:"Voice"}),E("span",["field","field-key","mark-send-title"],{t:2,l:164,w:25,h:18,i:"Send"}),E("span",["field","field-label","mark-send-param"],{t:16,l:146,w:58,h:16,i:"VEMRCDBP12",a:"center"}),E("span",["field","field-key"],{t:0,l:212,w:35,h:33,i:"Pan"}),E("span",["field","field-key"],{t:0,l:256,w:45,h:33,i:"Note"})]),T(t.#$.right,[E("span",["field","field-key"],{t:0,l:0,w:26,h:33,i:"CH"}),E("span",["field","field-key"],{t:0,l:30,w:49,h:33,i:"Voice"}),E("span",["field","field-key","mark-send-title"],{t:2,l:164,w:25,h:18,i:"Send"}),E("span",["field","field-label","mark-send-param"],{t:16,l:146,w:58,h:16,i:"VEMRCDBP12",a:"center"}),E("span",["field","field-key"],{t:0,l:212,w:35,h:33,i:"Pan"}),E("span",["field","field-key"],{t:0,l:256,w:45,h:33,i:"Note"})]),t.#c.root=E("div",["sect-part"]);for(let h=0;h<y.ch>>4;h++){let u=h<<4;t.#c[h]=[],t.#c[h].root=E("div",["boundary",`part-port-${h}`]);for(let m=0;m<16;m++){let r=(u|m)+1;r>=100?r=`${Math.floor(r/10).toString(16)}${r%10}`:r=`${r}`.padStart(2,"0"),t.#c[h][m]={root:E("div",["boundary","part-channel"]),major:E("div",["boundary","part-info-major"]),minor:E("div",["boundary","part-info-minor"],{t:26}),keys:E("div",["boundary","part-keys"]),notes:E("div",["boundary","part-keyboard"]),cxt:E("canvas",["field"]).getContext("2d"),number:E("span",["field","field-label","pcp-font4"],{t:1,w:18,h:25,i:r}),voice:E("span",["field"],{l:22,t:1,w:121,h:25}),metre:E("canvas",["field"]).getContext("2d"),type:E("span",["field","field-label","pcp-font4"],{t:1,w:18,h:25}),std:E("span",["field","pcp-font4"],{l:22,t:1,w:20,h:25,a:"center"}),msb:E("span",["field","pcp-font4"],{l:48,t:1,w:27,h:25}),prg:E("span",["field","pcp-font4"],{l:81,t:1,w:27,h:25}),lsb:E("span",["field","pcp-font4"],{l:114,t:1,w:27,h:25}),cc:M("svg",{viewBox:"0 0 108 24",width:108,style:"left: 146px; top: 1px; position: absolute;"}),vol:M("rect",{fill:"var(--accent-color)",width:4,height:24,x:0}),exp:M("rect",{fill:"var(--accent-color)",width:4,height:24,x:6}),mod:M("rect",{fill:"var(--accent-color)",width:4,height:24,x:12}),rev:M("rect",{fill:"var(--accent-color)",width:4,height:24,x:18}),cho:M("rect",{fill:"var(--accent-color)",width:4,height:24,x:24}),var:M("rect",{fill:"var(--accent-color)",width:4,height:24,x:30}),brt:M("rect",{fill:"var(--accent-color)",width:4,height:24,x:36}),por:M("rect",{fill:"var(--accent-color)",width:4,height:24,x:42}),cea:M("rect",{fill:"var(--accent-color)",width:4,height:24,x:48}),ceb:M("rect",{fill:"var(--accent-color)",width:4,height:24,x:54}),pan:M("rect",{fill:"var(--accent-color)",width:0,height:24,x:84})};let i=t.#c[h][m];Ve.forEach(n=>{i.notes.appendChild(E("span",["field","part-csplit"],{l:n}))}),i.notes.appendChild(E("span",["field","part-csplit","part-cdive"],{l:0,w:"100%",h:1})),i.metre.canvas.width=121,i.metre.canvas.height=25,i.metre.fillStyle="#fff",i.metre.textBaseline="top",i.metre.font="20px 'PT Sans Narrow'",T(i.notes,[i.cxt.canvas]),T(i.keys,[i.notes]),T(i.voice,[i.metre.canvas]),T(i.cc,[i.vol,i.exp,i.mod,i.rev,i.cho,i.var,i.brt,i.por,i.cea,i.ceb,i.pan,M("rect",{x:83,y:0,width:1,height:24,fill:"var(--foreground-color)"})]),T(i.major,[i.number,i.voice,i.cc]),T(i.minor,[i.type,i.std,i.msb,i.prg,i.lsb]),T(i.root,[i.major,i.minor,i.keys]),T(t.#c[h].root,[i.root])}t.#c.root.appendChild(t.#c[h].root)}o.appendChild(t.#c.root),t.#y.root=E("div",["sect-meta"]),t.#y.view=E("div",["boundary"]),o.appendChild(t.#y.root),T(t.#y.root,[t.#y.view]),t.#S.root=E("div",["sect-pix","boundary"],{l:1529,t:950,w:379,h:127}),t.#S.cxt=E("canvas",["field"]).getContext("2d"),t.#S.cxt.canvas.width=379,t.#S.cxt.canvas.height=127,T(t.#S.root,[t.#S.cxt.canvas]),o.appendChild(t.#S.root),t.addEventListener("mode",h=>{t.#a.mode.innerText=`${ut[h.data]}`,t.setMode(h.data)}),t.addEventListener("mastervolume",h=>{let u=Math.round(h.data*100)/100;t.#a.volume.innerText=`${Math.floor(u)}.${`${Math.floor(u%1*100)}`.padStart(2,"0")}`}),t.addEventListener("tempo",h=>{let u=Math.round(h.data*100);t.#a.tempo.innerText=`${Math.floor(u/100)}.${`${Math.floor(u%100)}`.padStart(2,"0")}`}),t.addEventListener("tsig",h=>{[t.#a.sigN.innerText,t.#a.sigD.innerText]=h.data}),t.addEventListener("title",h=>{t.#a.title.innerText=h.data||"No Title"}),t.addEventListener("voice",({data:h})=>{let u=t.getChVoice(h.part),m=t.#c[h.part>>4][h.part&15];_e(m.metre,t.getMapped(u.name)),m.type.innerText=ft[t.device.getChType()[h.part]],m.std.innerText=u.standard,m.msb.innerText=`${u.sid[0]}`.padStart(3,"0"),m.prg.innerText=`${u.sid[1]}`.padStart(3,"0"),m.lsb.innerText=`${u.sid[2]}`.padStart(3,"0")}),t.addEventListener("pitch",h=>{let{part:u,pitch:m}=h.data;t.#c[u>>4][u&15].notes.style.transform=`translateX(${m/1.28}%)`}),t.addEventListener("efxreverb",h=>{t.#a.reverb.innerText=t.getEfx(h.data)}),t.addEventListener("efxchorus",h=>{t.#a.chorus.innerText=t.getEfx(h.data)}),t.addEventListener("efxdelay",h=>{t.#a.delay.innerText=t.getEfx(h.data)}),t.addEventListener("efxinsert0",h=>{t.#a.insert.innerText=t.getEfx(h.data)}),t.addEventListener("partefxtoggle",h=>{let{part:u,active:m}=h.data;[L,N][m](t.#c[u>>4][u&15].number,["part-efx"])}),t.addEventListener("channeltoggle",h=>{let{part:u,active:m}=h.data;[L,N][m](t.#c[u>>4][u&15].root,["part-active"])}),t.addEventListener("metacommit",h=>{let u=h.data;if(t.#h&&u.type==t.#E&&t.#o)switch(u.type){case"C.Lyrics":case"KarLyric":case"SGLyrics":{T(t.#o,[E("span",["meta-slice"],{i:u.data})]);break}default:t.#o.childNodes[0].data+=u.data}else if(u.data?.length&&bt.indexOf(u.type)==-1){let m=E("div",["meta-line"]),r=E("span",["field","field-key","meta-type"],{i:pt[u.type]||u.type});switch(u.mask&&(r.style.display="none"),u.type){case"C.Lyrics":case"KarLyric":case"SGLyrics":{t.#o=E("span",["field","meta-data"]),T(t.#o,[E("span",["meta-slice"],{i:u.data})]);break}default:t.#o=E("span",["field","meta-data"],{i:u.data})}for(t.#y.view.appendChild(m),T(m,[r,t.#o]);t.#y.view.children.length>t.#t;)t.#y.view.children[0].remove()}t.#h=u.amend||!1,t.#E=u.type||"",t.#X()}),t.#y.view.style.transform="translateX(0px) translateY(140px)",t.dispatchEvent("mode","?"),t.dispatchEvent("mastervolume",100),t.dispatchEvent("tempo",120),t.dispatchEvent("tsig",[4,4]),t.dispatchEvent("title",""),t.dispatchEvent("efxreverb",t.device.getEffectType(0)),t.dispatchEvent("efxchorus",t.device.getEffectType(1)),t.dispatchEvent("efxdelay",t.device.getEffectType(2)),t.dispatchEvent("efxinsert0",t.device.getEffectType(3)),t.#F(!0)}detach(e){let t=this;self.removeEventListener("resize",t.#U),t.#i.remove(),t.#i=void 0,t.#r.remove(),t.#r=void 0,t.#H=void 0,clearInterval(t.#q)}constructor(e,t){super(new Ae,.1,.75);let c=this;c.#U=c.#z.bind(this),c.#N=c.#_.bind(this),e&&c.attach(e),t&&c.setClockSource(t),c.setPixelProfile("none"),c.addEventListener("reset",()=>{c.#s=0,c.#h=!1,c.#E="",c.#o=null;try{let o=c.#y.view.children;for(let h=o.length-1;h>=0;h--)o[h].remove();c.#y.view.style.transform="translateX(0px) translateY(140px)";for(let h=0;h<y.ch;h++){let u=c.#c[h>>4][h&15];L(u.root,["part-active"]),L(u.number,["part-efx"]),_e(u.metre,""),u.type.innerText="",u.std.innerText="",u.msb.innerText="",u.prg.innerText="",u.lsb.innerText="",u.notes.style.transform=""}}catch{}}),c.addEventListener("note",({data:o})=>{c.#T.push(o)}),c.addEventListener("pitch",({data:o})=>{c.#G.push(o)})}};export{da as Cambiare};
