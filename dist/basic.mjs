var F=Object.create;var L=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var q=Object.getPrototypeOf,Q=Object.prototype.hasOwnProperty;var Y=(t,s)=>()=>(s||t((s={exports:{}}).exports,s),s.exports);var j=(t,s,o,e)=>{if(s&&typeof s=="object"||typeof s=="function")for(let n of z(s))!Q.call(t,n)&&n!==o&&L(t,n,{get:()=>s[n],enumerable:!(e=K(s,n))||e.enumerable});return t};var W=(t,s,o)=>(o=t!=null?F(q(t)):{},j(s||!t||!t.__esModule?L(o,"default",{value:t,enumerable:!0}):o,t));var _=Y((Je,R)=>{(function(){"use strict";let t={fatal:!0},s=[new TextDecoder("iso-8859-15",t),new TextDecoder("sjis",t),new TextDecoder("euc-jp",t),new TextDecoder("utf-8",t),new TextDecoder("utf-16",t),new TextDecoder("ascii")],o={debug:!1,parse:function(e,n){if(e instanceof Uint8Array)return o.Uint8(e);if(typeof e=="string")return o.Base64(e);if(e instanceof HTMLElement&&e.type==="file")return o.addListener(e,n);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(e,n){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(e===void 0||!(e instanceof HTMLElement)||e.tagName!=="INPUT"||e.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;n=n||function(){},e.addEventListener("change",function(r){if(!r.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let c=new FileReader;c.readAsArrayBuffer(r.target.files[0]),c.onload=function(f){n(o.Uint8(new Uint8Array(f.target.result)))}})},Base64:function(e){let n=function(f){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(f=f.replace(/^.*?base64,/,""),f=String(f).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(f))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");f+="==".slice(2-(3&f.length));let u,h="",a,i,l=0;for(;l<f.length;)u=b.indexOf(f.charAt(l++))<<18|b.indexOf(f.charAt(l++))<<12|(a=b.indexOf(f.charAt(l++)))<<6|(i=b.indexOf(f.charAt(l++))),h+=a===64?String.fromCharCode(u>>16&255):i===64?String.fromCharCode(u>>16&255,u>>8&255):String.fromCharCode(u>>16&255,u>>8&255,255&u);return h}(e=String(e));var r=n.length;let c=new Uint8Array(new ArrayBuffer(r));for(let f=0;f<r;f++)c[f]=n.charCodeAt(f);return o.Uint8(c)},Uint8:function(c){let n={data:null,pointer:0,movePointer:function(a){return this.pointer+=a,this.pointer},readInt:function(a){if((a=Math.min(a,this.data.byteLength-this.pointer))<1)return-1;let i=0;if(1<a)for(let l=1;l<=a-1;l++)i+=this.data.getUint8(this.pointer)*Math.pow(256,a-l),this.pointer++;return i+=this.data.getUint8(this.pointer),this.pointer++,i},readStr:function(a){let i=new Uint8Array(a),l=!1,d;i.forEach((g,p)=>{i[p]=this.readInt(1)});for(let g=0;g<s.length;g++)if(!l)try{if(d=s[g].decode(i),g==0)for(let p=0;p<d.length;p++){let v=d.charCodeAt(p);if(v>191||v>127&&v<160)throw new RangeError(`Invalid code point: ${v}`)}l=!0,console.debug(`String byte sequence in ${s[g].encoding}`)}catch(p){console.debug(`SMF string ${p}`)}return d||"String byte sequence read failed."},backOne:function(){this.pointer--},readIntVLV:function(){let a=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)a=this.readInt(1);else{let l=[];for(;128<=this.data.getUint8(this.pointer);)l.push(this.readInt(1)-128);var i=this.readInt(1);for(let d=1;d<=l.length;d++)a+=l[l.length-d]*Math.pow(128,d);a+=i}return a}};if(n.data=new DataView(c.buffer,c.byteOffset,c.byteLength),n.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;n.readInt(4);let r={};r.formatType=n.readInt(2),r.tracks=n.readInt(2),r.track=[];var c=n.readInt(1),f=n.readInt(1);128<=c?(r.timeDivision=[],r.timeDivision[0]=c-128,r.timeDivision[1]=f):r.timeDivision=256*c+f;for(let a=1;a<=r.tracks;a++){r.track[a-1]={event:[]};var b,u=n.readInt(4);if(u===-1)break;if(u!==1297379947)return!1;n.readInt(4);let i=0,l=!1,d,g;for(;!l&&(i++,r.track[a-1].event[i-1]={},r.track[a-1].event[i-1].deltaTime=n.readIntVLV(),(d=n.readInt(1))!==-1);)if(128<=d?g=d:(d=g,n.movePointer(-1)),d===255){r.track[a-1].event[i-1].type=255,r.track[a-1].event[i-1].metaType=n.readInt(1);var h=n.readIntVLV();switch(r.track[a-1].event[i-1].metaType){case 47:case-1:l=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:r.track[a-1].event[i-1].data=n.readStr(h);break;case 33:case 89:case 81:r.track[a-1].event[i-1].data=n.readInt(h);break;case 84:r.track[a-1].event[i-1].data=[],r.track[a-1].event[i-1].data[0]=n.readInt(1),r.track[a-1].event[i-1].data[1]=n.readInt(1),r.track[a-1].event[i-1].data[2]=n.readInt(1),r.track[a-1].event[i-1].data[3]=n.readInt(1),r.track[a-1].event[i-1].data[4]=n.readInt(1);break;case 88:r.track[a-1].event[i-1].data=[],r.track[a-1].event[i-1].data[0]=n.readInt(1),r.track[a-1].event[i-1].data[1]=n.readInt(1),r.track[a-1].event[i-1].data[2]=n.readInt(1),r.track[a-1].event[i-1].data[3]=n.readInt(1);break;default:this.customInterpreter!==null&&(r.track[a-1].event[i-1].data=this.customInterpreter(r.track[a-1].event[i-1].metaType,n,h)),this.customInterpreter!==null&&r.track[a-1].event[i-1].data!==!1||(n.readInt(h),r.track[a-1].event[i-1].data=n.readInt(h),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch((d=d.toString(16).split(""))[1]||d.unshift("0"),r.track[a-1].event[i-1].type=parseInt(d[0],16),r.track[a-1].event[i-1].channel=parseInt(d[1],16),r.track[a-1].event[i-1].type){case 15:this.customInterpreter!==null&&(r.track[a-1].event[i-1].data=this.customInterpreter(r.track[a-1].event[i-1].type,n,!1)),this.customInterpreter!==null&&r.track[a-1].event[i-1].data!==!1||(b=n.readIntVLV(),r.track[a-1].event[i-1].data=n.readInt(b),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:r.track[a-1].event[i-1].data=[],r.track[a-1].event[i-1].data[0]=n.readInt(1),r.track[a-1].event[i-1].data[1]=n.readInt(1);break;case 12:case 13:r.track[a-1].event[i-1].data=n.readInt(1);break;case-1:l=!0;break;default:if(this.customInterpreter!==null&&(r.track[a-1].event[i-1].data=this.customInterpreter(r.track[a-1].event[i-1].metaType,n,!1)),this.customInterpreter===null||r.track[a-1].event[i-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return r},customInterpreter:null};if(typeof R<"u")R.exports=o;else{let e=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;e.MidiParser=o}})()});var T=class{#e={};addEventListener(t,s){this.#e[t]||(this.#e[t]=[]),this.#e[t].unshift(s)}removeEventListener(t,s){if(this.#e[t]){let o=this.#e[t].indexOf(s);o>-1&&this.#e[t].splice(o,1),this.#e[t].length<1&&delete this.#e[t]}}dispatchEvent(t,s){let o=new Event(t),e=this;o.data=s,this.#e[t]?.length>0&&this.#e[t].forEach(function(n){try{n?.call(e,o)}catch(r){console.error(r)}}),this[`on${t}`]&&this[`on${t}`](o)}};var P=class{#e={};context;set(t,s){this.#e[t]=s}has(t){return!!this.#e[t]}async read(t,s){if(!this.has(t))throw new Error(`No decoder registered for "${t}"`);return await this.#e[t].call(this.context||this,s)}};var Z=function(t,s){let o=!0;return s.forEach((e,n)=>{o=o&&t[n]==e}),o},U=function(t){let s=0;return t.forEach(o=>{s*=256,s+=o}),s},w=new TextDecoder,N=new P;N.set("s7e",async function(t){let s=new Uint8Array(await t.slice(0,65536).arrayBuffer()),o="MSB	LSB	PRG	NME",e=[0,0,0,0],n=32,r=0,c=0,f=!0,b=[],u=0;for(;f;){let h=s.subarray(r);([()=>{w.decode(h.subarray(0,4))=="YSFC"?(r+=80,c=1):r++},()=>{if(Z(h.subarray(0,4),e))b.forEach((a,i,l)=>{let d=U(s.subarray(a.start+4,a.start+8));a.length=d}),c=2;else{let a=w.decode(h.subarray(0,4)),i=U(h.subarray(4,8));b.push({type:a,start:i}),r+=8}},()=>{let a=b[u],i=s.subarray(a.start,a.start+a.length),l=32;switch(a.type){case"ENVC":{let d=n;for(;d<i.length;){let g=i.subarray(d,d+l),p=w.decode(g.subarray(0,10)).trimEnd();p.slice(0,5)=="Init "&&(p=""),p&&(o+=`
063	${(g[17]+13).toString().padStart(3,"0")}	${g[19].toString().padStart(3,"0")}	${p}`),d+=l}break}case"EDVC":{let d=n;for(;d<i.length;){let g=i.subarray(d,d+l),p=w.decode(g.subarray(0,10)).trimEnd();p.slice(0,5)=="Init "&&(p=""),p&&(o+=`
063	024	${g[19].toString().padStart(3,"0")}	${p}`),d+=l}break}case"EPVC":{let d=32,g=n;for(;g<i.length;){let p=i.subarray(g,g+d),v=w.decode(p.subarray(0,10)).trimEnd();v=="----------"&&(v=""),v&&(o+=`
063	${(p[17]+1).toString().padStart(3,"0")}	${p[19].toString().padStart(3,"0")}	${v}`),g+=d}break}}u++,u>=b.length&&(c=3,f=!1)}][c]||(()=>{f=!1}))()}return o});var J=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]);var ee=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),te={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,うぃ
we,うぇ
wo,を
nga,ガ
ngi,ギ
ngu,グ
nge,ゲ
ngo,ゴ
ngy,ギ!
ng,
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,いぇ
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(t=>{let s=t.split(",");te[s[0]]=s[1]});var B=function(t,s,o){let e=[],n=o==!1?s.readIntVLV():o;t==0||t==127;for(let r=0;r<n;r++){let c=s.readInt(1);if(e.push(c),c!=247){if(c!=240){if(c>127)return console.debug(`Early termination: ${e}`),e.pop(),s.backOne(),s.backOne(),new Uint8Array(e)}}}return new Uint8Array(e)};var ae=["?","gm","gs","xg","g2","mt32","ns5r","x5d","05rw","sd","k11","sg","krs","s90es","motif"];var re=["melodic","drum","menu"];var C=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65];var M=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,128,12,13,16,17,18,19,14,15,20,21,26,28,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157];var se={};ae.forEach((t,s)=>{se[t]=s});var x={length:M.length};M.forEach((t,s)=>{x[t]=s});var H={length:C.length};C.forEach((t,s)=>{H[t]=s});var ie={};re.forEach((t,s)=>{ie[t]=s});var We={ch:128,cc:M.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,ace:8,drm:8,dpn:C.length,dnc:128,ext:2,efx:7,cvn:12,redir:32};var A=W(_(),1);var G=class{#e=!1;constructor(t,s,o,e){this.#e=t,this.start=s,this.end=o,this.data=e}get duration(){return this.ranged?this.end-this.start:0}get ranged(){return this.#e}},D=class extends G{constructor(t,s,o){super(!0,t,s,o)}},X=class extends G{constructor(t,s){super(!1,t,t,s)}},O=class extends Array{#e=-1;constructor(){super(...arguments)}resetIndex(t){this.#e=-1}fresh(){this.sort(function(t,s){return t.start==s.start?0:(+(t.start>s.start)<<1)-1}),this.forEach(function(t,s){t.index=s})}step(t,s=!1){let o=[];if(s)for(let e=0;e<this.length&&!(this[e].start>t);e++){if(this[e].end<t)continue;o.push(this[e])}else{let e=this.getRange(this.#e==-1?0:t-1,t),n=this;e.forEach(function(r){r.index>n.#e&&(o.push(r),n.#e=r.index)})}return o}getRange(t,s){t>s&&([t,s]=[s,t]);let o=[],e=-1,n=Math.ceil(Math.sqrt(this.length)),r=!0;for(let c=0;c<this.length;c+=n)this[c+n]?e<0&&this[c+n].start>=t&&(e=c):e=e<0?c:e;for(;r;)this[e]?.end<s?this[e].start>=t&&o.push(this[e]):r=!1,e++;return o}};var ne=0xffffffffffff,V=function(t){let s=new O,o=this,e=t.timeDivision,n=120,r=new O,c=0,f=0;r.push(new D(0,ne,[120,0])),t.track.forEach(function(a){c=0,a.event.forEach(function(i){c+=i.deltaTime,i.type==255&&i?.metaType==81&&(n=6e7/i.data,r[r.length-1]&&r.push(new D(c,0xffffffffffff,[n,0])))})}),r.fresh(),r.forEach(function(a,i,l){i>0&&(l[i-1].end=a.start)});let b=120;r.forEach(function(a,i,l){i>0&&(a.end==a.start?l.splice(l.indexOf(a),1):b==a.data[0]&&(l[i-1].end=a.end,l.splice(l.indexOf(a),1)),b=a.data[0])});let u=0,h=120;return r.forEach(function(a){let i=a.start,l=i/h/e*60+u;h=a.data[0],u=l-i/h/e*60,a.data[1]=u}),console.debug("All tempo changes: ",r),n=120,c=0,f=0,t.track.forEach(function(a,i){c=0,f=0;let l=i+1;a.event.forEach(function(d,g){c+=d.deltaTime;let p=r.step(c,!0)[0];p&&(n=p.data[0],f=p.data[1]);let v={type:d.type,data:d.data,track:l,part:0};d.type>14?v.meta=d.metaType:v.part=d.channel,s.push(new X(c/n/e*60+f,v))})}),s.fresh(),self.midiEvents=s,console.debug(`Parsed a type ${t.formatType} MIDI sequence.`),s};A.default.customInterpreter=B;var E=function(t,s,o){t.addEventListener(o,e=>{s.dispatchEvent(o,e.data)})},ft=class extends T{device;#e;#n={};#f=[];#a="";#c=[];#h=[];#o=new Uint8ClampedArray(128);#u=new Uint8ClampedArray(128);#s=.5;#i=120;#t=4;#l=4;#r=0;#d=0;smoothingAtk=0;smoothingDcy=0;reset(){let t=this;t.dispatchEvent("reset"),t.#e?.resetIndex(),t.device.init(),t.#a="",t.#s=.5,t.#i=120,t.#t=4,t.#l=4,t.#r=0,t.#d=0,t.dispatchEvent("tempo",t.#i),t.dispatchEvent("title",t.#a)}init(){this.reset(),this.#e=void 0}async loadFile(t){this.#e=V(A.default.parse(new Uint8Array(await t.arrayBuffer())))}async loadMap(t,s){let o=this,e=0,n=0,r=0,c,f;t.split(`
`).forEach((b,u)=>{if(!b)return;let h=b.split("	");if(u){if(!r)return;let a="",i="";h.forEach((l,d)=>{switch(d){case c:{a=l;break}case f:{i=l;break}}}),!o.#n[a]||s?(o.#n[a]=i,e++):self.debugMode&&console.debug(`Voice "${i}" (${a}) seems to be in conflict with (${o.#n[a]}).`),n++}else h.forEach((a,i)=>{switch(a){case"ID":{c=i,r++;break}case"Name":{f=i,r++;break}default:console.debug(`Unknown map field: ${a}`)}})}),console.debug(`Voice names: ${n} total, ${e} loaded.`),o?.device.forceVoiceRefresh()}async loadEfx(t,s){let o=this,e=0,n=0,r,c,f;t.split(`
`).forEach((b,u)=>{if(b)if(u){let h=0,a;b.split("	").forEach((i,l)=>{switch(l){case r:{h|=parseInt(i,16)<<8;break}case c:{h|=parseInt(i,16);break}case f:{a=i;break}}}),!o.#f[h]||s?(o.#f[h]=a,e++):self.debugMode&&console.debug(`EFX ID 0x${h.toString(16).padStart(4,"0")} (${a}) seems to be in conflict.`),n++}else b.split("	").forEach((h,a)=>{switch(h){case"MSB":{r=a;break}case"LSB":{c=a;break}case"Name":{f=a;break}default:console.debug(`Unknown EFX field: ${h}`)}})}),console.debug(`EFX: ${n} total, ${e} loaded.`),o.dispatchEvent("efxreverb",o.device.getEffectType(0)),o.dispatchEvent("efxchorus",o.device.getEffectType(1)),o.dispatchEvent("efxdelay",o.device.getEffectType(2)),o.dispatchEvent("efxinsert0",o.device.getEffectType(3)),o.dispatchEvent("efxinsert1",o.device.getEffectType(4)),o.dispatchEvent("efxinsert2",o.device.getEffectType(5)),o.dispatchEvent("efxinsert3",o.device.getEffectType(6))}switchMode(t,s=!1){this.device.switchMode(t,s)}getMode(){return this.device.getMode()}getVoice(){return this.device.getVoice(...arguments)}getChVoice(t){return this.device.getChVoice(t)}getMapped(t){return this.#n[t]||t}getEfx([t,s]){let o=t<<8|s;return this.#f[o]||`0x${o.toString(16).padStart(4,"0")}`}get noteProgress(){return this.#d/this.#s}get noteOverall(){return this.noteProgress-this.#r}get noteBar(){return Math.floor(this.noteOverall/this.#t)}get noteBeat(){let t=this.noteOverall%this.#t;return t<0&&(t+=this.#t),t}getTimeSig(){return[this.#t,this.#l]}getTempo(){return this.#i}sendCmd(t){this.device.runJson(t)}render(t){t>this.#d&&(this.#d=t);let s=this.#e?.step(t)||[],o=0,e=new Set,n={},r=[],c=this,f=[];for(c.device.getStrength().forEach((m,y)=>{c.#u[y]=m}),c.device.newStrength(),s.forEach(function(m){let y=m.data,$=c.device.runJson(y);switch($?.reply){case"meta":{f.push($);break}}$?.reply&&delete $.reply});c.#h.length>0;){let m=c.#h.shift(),y=m.part<<7|m.note;m.state?(e.add(y),n[y]=m.velo):e.has(y)&&(r.push({part:m.part,note:m.note,velo:n[y],state:c.device.NOTE_SUSTAIN}),o++)}f?.length>0&&c.dispatchEvent("meta",f);let b=c.device.getActive(),u=[],h=c.device.getPitch(),a=c.device.getCcAll(),i=c.device.getProgram(),l=c.device.getChType(),d=[],g=c.device.getStrength();g.forEach(function(m,y,$){$[y]=Math.max(c.#u[y],m);let k=$[y]-c.#o[y],I=x.length*y;if(k>=0){let S=4*.25**(a[I+x[73]]/64);c.#o[y]+=Math.ceil(k-k*c.smoothingAtk**S)}else{let S=4*.25**(a[I+x[72]]/64);c.#o[y]+=Math.floor(k-k*c.smoothingDcy**S)}});let p=0;return b.forEach(function(m,y){m&&(u[y]=c.device.getVel(y),d[y]=c.device.getExt(y),p+=u[y].size)}),{extraPoly:o,extraNotes:r,curPoly:p,chInUse:b,chKeyPr:u,chPitch:h,chProgr:i,chContr:a,chType:l,chExt:d,eventCount:s.length,title:c.#a,bitmap:c.device.getBitmap(),letter:c.device.getLetter(),texts:c.device.getTexts(),master:c.device.getMaster(),mode:c.device.getMode(),strength:c.#o.slice(),velo:g,rpn:c.device.getRpn(),tSig:c.getTimeSig(),tempo:c.getTempo(),noteBar:c.noteBar,noteBeat:c.noteBeat,ace:c.device.getAce(),rawVelo:c.device.getStrength(),rawPitch:c.device.getRawPitch(),efxSink:c.device.getEffectSink()}}constructor(t,s=.5,o=.5){super();let e=this;e.smoothingAtk=s,e.smoothingDcy=o,e.device=t,e.addEventListener("meta",function(n){n?.data?.forEach(function(r){(e.#c[r.meta]||console.debug).call(e,r.meta,r.data)})}),E(e.device,e,"mode"),E(e.device,e,"mastervolume"),E(e.device,e,"channelactive"),E(e.device,e,"channelmin"),E(e.device,e,"channelmax"),E(e.device,e,"channelreset"),E(e.device,e,"channeltoggle"),E(e.device,e,"screen"),E(e.device,e,"metacommit"),E(e.device,e,"voice"),E(e.device,e,"pitch"),E(e.device,e,"note"),E(e.device,e,"reset"),E(e.device,e,"efxreverb"),E(e.device,e,"efxchorus"),E(e.device,e,"efxdelay"),E(e.device,e,"efxinsert0"),E(e.device,e,"efxinsert1"),E(e.device,e,"efxinsert2"),E(e.device,e,"efxinsert3"),E(e.device,e,"partefxtoggle"),e.addEventListener("note",function({data:n}){e.#h.push(n)}),e.#c[3]=function(n,r){e.#a?.length<1&&(e.#a=r,e.dispatchEvent("title",e.#a))},e.#c[81]=function(n,r){let c=e.noteProgress,f=e.#s||.5;e.#i=6e7/r,e.#s=r/1e6,e.#r+=c*(f/e.#s)-c,e.dispatchEvent("tempo",e.#i)},e.#c[88]=function(n,r){let c=e.noteProgress,f=e.noteOverall,b=e.noteBar,u=e.noteBeat,h=e.#t,a=e.#l;e.#t=r[0],e.#l=1<<r[1];let i=24*(32/r[3])/r[2];if(h!=e.#t){let l=b;e.#r-=l*(e.#t-h),u+1>=h&&(h<e.#t?e.#r-=Math.ceil(e.#t-u-1):e.#r+=e.#t)}e.dispatchEvent("tsig",e.getTimeSig())}}};export{ft as RootDisplay,x as ccToPos,H as dnToPos};
