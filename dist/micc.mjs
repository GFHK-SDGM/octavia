var _=Object.defineProperty;var I=(c,u,w)=>u in c?_(c,u,{enumerable:!0,configurable:!0,writable:!0,value:w}):c[u]=w;var T=(c,u,w)=>(I(c,typeof u!="symbol"?u+"":u,w),w);var L=["utf-8","utf-16","utf-16be"],E=(c,u)=>{c.unsent=!1,c.enqueue(u)},R,o=(R=class{static lineRaw(c,u=0){if(u?.constructor!=Number||u<0||u>=L.length)throw new TypeError("Invalid split mode");if(u)throw new Error("UTF-16LE/BE currently not implemented");if(!c||c?.constructor!=ReadableStream)throw new TypeError("Not a readable stream");let w=c.getReader(),e,a=!1,i=[],h=0,b=0,S=0;return new ReadableStream({pull:async $=>{for($.unsent=!0;$.unsent;){if(!e||h>=e.length){h>b&&(i.push(e.subarray(b)),b=0);let{value:k,done:p}=await w.read();e=k,a=p,h=0}if(e){let k=e[h],p=!1;switch(k){case 10:{S==13?b++:p=!0;break}case 13:{p=!0;break}}if(p){if(i.length){i.push(e.subarray(b,h));let t=0;for(let g=0;g<i.length;g++)t+=i[g].length;let m=new Uint8Array(t),y=0;for(let g=0;g<i.length;g++)m.set(i[g],y),y+=i[g].length;E($,m),i=[]}else E($,e.subarray(b,h));b=h+1}S=k}if(a){if(b!=h&&i.push(e.subarray(b,h)),i.length){let k=0;for(let m=0;m<i.length;m++)k+=i[m].length;let p=new Uint8Array(k),t=0;for(let m=0;m<i.length;m++)p.set(i[m],t),t+=i[m].length;E($,p)}$.unsent=!1,$.close()}h++}}},new ByteLengthQueuingStrategy({highWaterMark:256}))}static line(c,u=0,w){let e=this.lineRaw(c,u).getReader(),a=new TextDecoder(w||L[u]);return new ReadableStream({pull:async i=>{let{value:h,done:b}=await e.read();h&&i.enqueue(a.decode(h)),b&&i.close()}})}},T(R,"SPLIT_UTF_8",0),T(R,"SPLIT_UTF_16_LE",1),T(R,"SPLIT_UTF_16_BE",2),R),B=o;var s=new TextEncoder;var d=(c,u)=>{c.unsent=!1,c.enqueue(u)},A=function(c){let u=c.getReader(),w=0,e=0,a=0,i,h=0,b=0,S=!1,r=0,$="",k=0,p=0,t=0,m=0,y=!1,g=0,x=0;return new ReadableStream({pull:async n=>{for(n.unsent=!0;n.unsent;){if(!i||e>=i.length){let{value:f,done:U}=await u.read();if(i&&(w+=i.length),e=0,i=f,U){n.close();return}}let P=w+e,l=i[e];switch(r>4&&S&&P-h>=b&&(n.enqueue(s.encode(`
`)),r=0,h=0,b=0,S=!1),r){case 0:{switch($+=String.fromCharCode(l),$){case"MThd":{d(n,s.encode(`:hd
`)),r=1,k=3,p=4,a=e+1,$="",S=!1;break}case"MTrk":{x++,d(n,s.encode(`:tr#${x}
`)),r=1,k=3,p=5,a=e+1,$="",S=!1;break}default:$.length>=4&&($=$.substring(1,4))}break}case 1:{let f=e-a;f||(t=0),t=t<<8,t|=l,f>=3&&(t<0&&(t+=4294967296),r=k,e--);break}case 2:{let f=e-a;f||(t=0),t=t<<7,t|=l&127,(l<128||f>=3)&&(f&&e++,r=k,y&&(a=e+1,y=!1),e--);break}case 3:{d(n,s.encode(`	ln ${t}
`)),r=p,a=e+1,h=a+w,b=t,S=!0;break}case 4:{let f=e-a;if(f&1||(t=0),t=t<<8,t|=l,f&1)switch(f>>1){case 0:{d(n,s.encode(`	ft ${t}
`));break}case 1:{d(n,s.encode(`	tc ${t}
`));break}case 2:{t<32768?d(n,s.encode(`	dv ${t}
`)):d(n,s.encode(`	td ${t}
`)),r=0,a=e+1,t=0;break}}break}case 5:{r=2,k=6,e--;break}case 6:{if(e-a)switch(t&&(d(n,s.encode(`	dt ${t}
`)),t=0),l){case 240:{r=15;break}case 247:{r=16;break}case 255:{r=7;break}default:r=l>>4,g=l&15,a=e+1}else t&&d(n,s.encode(`	dt ${t}
`)),t=0;break}case 7:{d(n,s.encode(`	mt ${l}`)),r=2,k=17,y=!0,a=e+1;break}case 15:{d(n,s.encode("	se")),r=2,k=17,e--,y=!0,a=e+1;break}case 16:{d(n,s.encode("	sc")),r=2,k=17,e--,y=!0,a=e+1;break}case 17:{let f=e-a;f==0&&(m=t,d(n,s.encode(` (${m})`))),f<0||(f<m?d(n,s.encode(` ${l.toString(16).padStart(2,"0")}`)):(d(n,s.encode(`
`)),e--,r=5,a=e+1));break}case 8:{e-a?(d(n,s.encode(` ${l}
`)),r=5,a=e+1):d(n,s.encode(`	of ${`${g}`.padStart(2,"0")} ${l}`));break}case 9:{e-a?(d(n,s.encode(` ${l}
`)),r=5,a=e+1):d(n,s.encode(`	on ${`${g}`.padStart(2,"0")} ${l}`));break}case 10:{e-a?(d(n,s.encode(` ${l}
`)),r=5,a=e+1):d(n,s.encode(`	pa ${`${g}`.padStart(2,"0")} ${l}`));break}case 11:{e-a?(d(n,s.encode(` ${l}
`)),r=5,a=e+1):d(n,s.encode(`	cc ${`${g}`.padStart(2,"0")} ${l}`));break}case 12:{d(n,s.encode(`	pc ${`${g}`.padStart(2,"0")} ${l}
`)),r=5,a=e+1;break}case 13:{d(n,s.encode(`	ca ${`${g}`.padStart(2,"0")} ${l}
`)),r=5,a=e+1;break}case 14:{let f=e-a;f||(t=0),t|=l<<(f<<3),f&&(d(n,s.encode(`	pb ${`${g}`.padStart(2,"0")} ${t-8192}
`)),r=5,a=e+1);break}default:n.close()}e++}}},new ByteLengthQueuingStrategy({highWaterMark:256}))},C=function(c){let u=B.line(c).getReader(),w=0,e,a=!1;return new ReadableStream({pull:async i=>{let{value:h,done:b}=await u.read();b?i.close():w++}})};export{C as streamAssemble,A as streamDisassemble};
