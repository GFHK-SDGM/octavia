var hr=Object.create;var ia=Object.defineProperty;var ur=Object.getOwnPropertyDescriptor;var pr=Object.getOwnPropertyNames;var gr=Object.getPrototypeOf,br=Object.prototype.hasOwnProperty;var yr=(p,e,a)=>e in p?ia(p,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):p[e]=a;var Sa=(p,e)=>()=>(p&&(e=p(p=0)),e);var mr=(p,e)=>()=>(e||p((e={exports:{}}).exports,e),e.exports);var Er=(p,e,a,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of pr(e))!br.call(p,n)&&n!==a&&ia(p,n,{get:()=>e[n],enumerable:!(o=ur(e,n))||o.enumerable});return p};var xa=(p,e,a)=>(a=p!=null?hr(gr(p)):{},Er(e||!p||!p.__esModule?ia(a,"default",{value:p,enumerable:!0}):a,p));var P=(p,e,a)=>(yr(p,typeof e!="symbol"?e+"":e,a),a),Ta=(p,e,a)=>{if(!e.has(p))throw TypeError("Cannot "+a)};var r=(p,e,a)=>(Ta(p,e,"read from private field"),a?a.call(p):e.get(p)),M=(p,e,a)=>{if(e.has(p))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(p):e.set(p,a)},T=(p,e,a,o)=>(Ta(p,e,"write to private field"),o?o.call(p,a):e.set(p,a),a),qt=(p,e,a,o)=>({set _(n){T(p,e,n,a)},get _(){return r(p,e,o)}});var Ma=(p,e,a)=>(e=p[Symbol.asyncIterator],a=(o,n)=>(n=p[o])&&(e[o]=h=>new Promise((b,m,y)=>(h=n.call(p,h),y=h.done,Promise.resolve(h.value).then(k=>b({value:k,done:y}),m)))),e?e.call(p):(p=p[Symbol.iterator](),e={},a("next"),a("return"),e));var Pa=Sa(()=>{"use strict";B();(function(){var p=function(m,y,k){var x,t;if(self.MessageEvent)switch(m){case"message":{t=new MessageEvent(m,{data:y,ports:k==null?void 0:k.ports}),Object.defineProperty(t,"source",{value:k==null?void 0:k.source});break}default:t=new Event(m)}else t=document.createEvent("Event"),t.initEvent(m,!1,!1),k&&m=="message"&&(t.data=y,k.source&&Object.defineProperty(t,"source",{value:k.source}),(x=k.ports)!=null&&x.length&&Object.defineProperty(t,"ports",{value:k.ports}));return t};self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),a=[],o={},n=function(m){var y,k=this;if((this==null?void 0:this.constructor)!=n)throw new TypeError("Illegal constructor");a.push(this),(y=o[m])!=null&&y.constructor||(o[m]=[]),o[m].push(this);var x=Math.floor(Math.random()*281474976710656),t=[],s=0,f=[],i=!0,l=!1;Object.defineProperty(this,"id",{get:function(){return x}}),Object.defineProperty(this,"name",{value:m}),this.close=function(){var c,g=a.indexOf(k);g>-1?(e.postMessage({t:"d",c:m,i:x}),a.splice(g,1),(c=o[m])!=null&&c.constructor&&(g=o[m].indexOf(k),g>-1&&o[m].splice(g,1)),o[m].length||delete o[m],console.debug("[Snowy] BroadcastChannel closed."),l=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(c){if(e){if(l)throw new Error("Channel already closed");e.postMessage({t:"m",c:m,i:x,m:s,d:c}),s++,s>4294967295&&(s=0)}else f.push(c),console.debug("[Snowy] Message is cached.")},this.flush=function(){if(e){if(i){for(e.postMessage({t:"r",c:m,i:x}),console.debug("[Snowy] ".concat(f.length," message(s) in cache."));f.length;){var c=f.shift();k.postMessage(c)}i=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(c){c.c==m?c.i!=x&&k.dispatchEvent(p("message",c.d,{source:k})):console.debug("[Snowy] Channel ID mismatch. Instance ".concat(x," receives from ").concat(m,", not ").concat(c.c,"."))};var d={};this.dispatchEvent=function(c){var g,u;if(Object.defineProperty(c,"target",{value:k}),Object.defineProperty(c,"currentTarget",{value:k}),(g=d[c.type])!=null&&g.length)for(var E=d[c.type],w=0;w<E.length;w++)((u=E[w])==null?void 0:u.constructor)==Function&&E[w].call(k,c);k["on".concat(c.type)]&&k["on".concat(c.type)].constructor==Function&&k["on".concat(c.type)].call(k,c)},this.addEventListener=function(c,g){var u;(u=d[c])!=null&&u.constructor||(d[c]=[]);var E=d[c].indexOf(g);E==-1&&d[c].push(g)},this.removeEventListener=function(c,g){var u,E;if((u=d[c])!=null&&u.length){var w=d[c].indexOf(g);w>-1&&d[c].splice(w,1)}!((E=d[c])!=null&&E.length)&&d[c].constructor&&delete d[c]}},self.BroadcastChannel=n,h=function(){if(e){e.addEventListener("message",function(y){var k=y.data,x=!1;switch(k.t){case"k":{x=!1,e.postMessage({t:"k"});break}case"m":{var t=o[k.c];if(t!=null&&t.length)for(var s=0;s<t.length;s++)t[s].receiveMessage(k);break}case"c":{for(var f=[],i=0;i<a.length;i++){var l=a[i].name;f.indexOf(l)<0&&f.push(l)}e.postMessage({t:"k",c:f});break}default:x=!0}x&&console.info("ReceiveBroadcast",k)});for(var m=0;m<a.length;m++)a[m].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},b=function(){if(!e){var m=new SharedWorker(self.SNOWY_PATH||"/snowy.js");m.port.start();var y=function(k){k.data.t=="swc"&&(m.port.removeEventListener("message",y),e=m.port,e.postMessage({t:"k"}),h())};m.port.addEventListener("message",y)}},b());var e,a,o,n,h,b})()});var B=Sa(()=>{"use strict";Pa();{let p=function(e,a){let o=new FileReader;return new Promise((n,h)=>{switch(o.addEventListener("abort",()=>{h(new Error("Blob read aborted"))}),o.addEventListener("error",b=>{h(o.error||b.data||new Error("Blob read error"))}),o.addEventListener("load",()=>{n(o.result)}),a.toLowerCase()){case"arraybuffer":case"buffer":{o.readAsArrayBuffer(e);break}case"string":case"text":{o.readAsText(e);break}default:h(new Error(`Unknown target ${a}`))}})};Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||function(){return p(this,"buffer")},Blob.prototype.text=Blob.prototype.text||function(){return p(this,"text")}}String.prototype.replaceAll=String.prototype.replaceAll||function(p,e){let a=0,o=16,n=this,h=[];for(;a<o&&n.lastIndexOf(p)>-1;){let b=n.lastIndexOf(p);h.unshift(n.slice(b+p.length)),n=n.slice(0,b),b==0&&h.unshift(""),a++}return n.length&&h.unshift(n),h.join(e)||""},String.prototype.padStart=String.prototype.padStart||function(p,e){if(e){let a=this;for(;a.length<p;)a=`${e}${a}`;return a}},String.prototype.padEnd=String.prototype.padEnd||function(p,e){if(e){let a=this;for(;a.length<p;)a+=e;return a}}});var ua=mr((ws,ha)=>{B();(function(){"use strict";let p={fatal:!0},e=[new TextDecoder("iso-8859-15",p),new TextDecoder("utf-8",p),new TextDecoder("sjis",p),new TextDecoder("euc-jp",p),new TextDecoder("ascii")],a={debug:!1,parse:function(o,n){if(o instanceof Uint8Array)return a.Uint8(o);if(typeof o=="string")return a.Base64(o);if(o instanceof HTMLElement&&o.type==="file")return a.addListener(o,n);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(o,n){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(o===void 0||!(o instanceof HTMLElement)||o.tagName!=="INPUT"||o.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;n=n||function(){},o.addEventListener("change",function(h){if(!h.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let b=new FileReader;b.readAsArrayBuffer(h.target.files[0]),b.onload=function(m){n(a.Uint8(new Uint8Array(m.target.result)))}})},Base64:function(o){let n=function(m){var y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(m=m.replace(/^.*?base64,/,""),m=String(m).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(m))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");m+="==".slice(2-(3&m.length));let k,x="",t,s,f=0;for(;f<m.length;)k=y.indexOf(m.charAt(f++))<<18|y.indexOf(m.charAt(f++))<<12|(t=y.indexOf(m.charAt(f++)))<<6|(s=y.indexOf(m.charAt(f++))),x+=t===64?String.fromCharCode(k>>16&255):s===64?String.fromCharCode(k>>16&255,k>>8&255):String.fromCharCode(k>>16&255,k>>8&255,255&k);return x}(o=String(o));var h=n.length;let b=new Uint8Array(new ArrayBuffer(h));for(let m=0;m<h;m++)b[m]=n.charCodeAt(m);return a.Uint8(b)},Uint8:function(b){let n={data:null,pointer:0,movePointer:function(t){return this.pointer+=t,this.pointer},readInt:function(t){if((t=Math.min(t,this.data.byteLength-this.pointer))<1)return-1;let s=0;if(1<t)for(let f=1;f<=t-1;f++)s+=this.data.getUint8(this.pointer)*Math.pow(256,t-f),this.pointer++;return s+=this.data.getUint8(this.pointer),this.pointer++,s},readStr:function(t){let s=new Uint8Array(t),f=!1,i;s.forEach((l,d)=>{s[d]=this.readInt(1)});for(let l=0;l<e.length;l++)if(!f)try{if(i=e[l].decode(s),l===0)for(let d=0;d<i.length;d++){let c=i.charCodeAt(d);if(c>191||c>127&&c<160)throw new RangeError(`Invalid code point: ${c}`)}f=!0,console.debug(`String byte sequence in ${e[l].encoding}`)}catch(d){console.debug(`SMF string ${d}`)}return i||"String byte sequence read failed."},backOne:function(){this.pointer--},readIntVLV:function(){let t=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)t=this.readInt(1);else{let f=[];for(;128<=this.data.getUint8(this.pointer);)f.push(this.readInt(1)-128);var s=this.readInt(1);for(let i=1;i<=f.length;i++)t+=f[f.length-i]*Math.pow(128,i);t+=s}return t}};if(n.data=new DataView(b.buffer,b.byteOffset,b.byteLength),n.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;n.readInt(4);let h={};h.formatType=n.readInt(2),h.tracks=n.readInt(2),h.track=[];var b=n.readInt(1),m=n.readInt(1);128<=b?(h.timeDivision=[],h.timeDivision[0]=b-128,h.timeDivision[1]=m):h.timeDivision=256*b+m;for(let t=1;t<=h.tracks;t++){h.track[t-1]={event:[]};var y,k=n.readInt(4);if(k===-1)break;if(k!==1297379947)return!1;n.readInt(4);let s=0,f=!1,i,l;for(;!f&&(s++,h.track[t-1].event[s-1]={},h.track[t-1].event[s-1].deltaTime=n.readIntVLV(),(i=n.readInt(1))!==-1);)if(128<=i?l=i:(i=l,n.movePointer(-1)),i===255){h.track[t-1].event[s-1].type=255,h.track[t-1].event[s-1].metaType=n.readInt(1);var x=n.readIntVLV();switch(h.track[t-1].event[s-1].metaType){case 47:case-1:f=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:h.track[t-1].event[s-1].data=n.readStr(x);break;case 33:case 89:case 81:h.track[t-1].event[s-1].data=n.readInt(x);break;case 84:h.track[t-1].event[s-1].data=[],h.track[t-1].event[s-1].data[0]=n.readInt(1),h.track[t-1].event[s-1].data[1]=n.readInt(1),h.track[t-1].event[s-1].data[2]=n.readInt(1),h.track[t-1].event[s-1].data[3]=n.readInt(1),h.track[t-1].event[s-1].data[4]=n.readInt(1);break;case 88:h.track[t-1].event[s-1].data=[],h.track[t-1].event[s-1].data[0]=n.readInt(1),h.track[t-1].event[s-1].data[1]=n.readInt(1),h.track[t-1].event[s-1].data[2]=n.readInt(1),h.track[t-1].event[s-1].data[3]=n.readInt(1);break;default:this.customInterpreter!==null&&(h.track[t-1].event[s-1].data=this.customInterpreter(h.track[t-1].event[s-1].metaType,n,x)),this.customInterpreter!==null&&h.track[t-1].event[s-1].data!==!1||(n.readInt(x),h.track[t-1].event[s-1].data=n.readInt(x),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch((i=i.toString(16).split(""))[1]||i.unshift("0"),h.track[t-1].event[s-1].type=parseInt(i[0],16),h.track[t-1].event[s-1].channel=parseInt(i[1],16),h.track[t-1].event[s-1].type){case 15:this.customInterpreter!==null&&(h.track[t-1].event[s-1].data=this.customInterpreter(h.track[t-1].event[s-1].type,n,!1)),this.customInterpreter!==null&&h.track[t-1].event[s-1].data!==!1||(y=n.readIntVLV(),h.track[t-1].event[s-1].data=n.readInt(y),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:h.track[t-1].event[s-1].data=[],h.track[t-1].event[s-1].data[0]=n.readInt(1),h.track[t-1].event[s-1].data[1]=n.readInt(1);break;case 12:case 13:h.track[t-1].event[s-1].data=n.readInt(1);break;case-1:f=!0;break;default:if(this.customInterpreter!==null&&(h.track[t-1].event[s-1].data=this.customInterpreter(h.track[t-1].event[s-1].metaType,n,!1)),this.customInterpreter===null||h.track[t-1].event[s-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return h},customInterpreter:null};if(typeof ha<"u")ha.exports=a;else{let o=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;o.MidiParser=a}})()});B();B();var he,Aa,Qt=(Aa=class{constructor(){M(this,he,{})}addEventListener(p,e){r(this,he)[p]||(r(this,he)[p]=[]),r(this,he)[p].unshift(e)}removeEventListener(p,e){if(r(this,he)[p]){let a=r(this,he)[p].indexOf(e);a>-1&&r(this,he)[p].splice(a,1),r(this,he)[p].length<1&&delete r(this,he)[p]}}dispatchEvent(p,e){var n;let a=new Event(p),o=this;a.data=e,((n=r(this,he)[p])==null?void 0:n.length)>0&&r(this,he)[p].forEach(function(h){try{h==null||h.call(o,a)}catch(b){console.error(b)}}),this[`on${p}`]&&this[`on${p}`](a)}},he=new WeakMap,Aa);B();B();var Ra=function(p,e){let a=Math.min(p.length,e.length),o=p.slice(0,a),n=e.slice(0,a),h=0,b=0;for(;b<a&&h==0;)h=Math.sign(o[b]-n[b]),b++;return h},ke=function(p=""){this.name=p,this.pool=[],this.point=function(e,a=!1){if(this.pool.length>0){let o=this.pool.length,n=1<<Math.floor(Math.log2(o)),h=n,b=64;for(;n>=1&&b>=0;){if(b<=0)throw new Error("TTL reached.");if(h==o)h-=n;else{let y=Ra(e,this.pool[h]);switch(y){case 0:{b=0;break}case 1:{h+n<=o&&(h+=n);break}case-1:{h!=0&&(h-=n);break}default:console.warn(`Unexpected result ${y}.`)}}n=n>>1,b--}let m=!0;if(h>=this.pool.length)m=!1;else{let y=this;this.pool[h].forEach(function(k,x,t){m&&k!=e[x]&&(m=!1)}),!m&&Ra(e,this.pool[h])>0&&h++}return m||a?h:-1}else return a?0:-1},this.add=function(e,a){return e.data=a,this.pool.splice(this.point(e,!0),0,e),this},this.default=function(e){console.warn(`No match in "${this.name||"(unknown)"}" for "${e}". Default action not defined.`)},this.get=function(e){let a=this.point(e);if(a>-1)return this.pool[a].data;this.default(e)},this.run=function(e,...a){let o=this.point(e);o>-1?e.subarray?this.pool[o].data(e.subarray(this.pool[o].length),...a):this.pool[o].data(e.slice(this.pool[o].length),...a):this.default(e,...a)}};B();var Cr=["MSB","PRG","LSB","NME","ELC","DRM","LVL","VXP"],wr={krs:"KR",s90es:"ES",motif:"ES"},kr={krs:"Kr",s90es:"SE",motif:"ME"},na=function(p){let e=Math.floor(p/10),a=p%10;return`${e.toString(16)}${a}`},se,Ia,oa=(Ia=class{constructor(...p){M(this,se,void 0);P(this,"strictMode",!1);this.loadFiles(...p)}get bankInfo(){return r(this,se)}get(p=0,e=0,a=0,o,n=0){var w,A,R;let h=[p,e,a],b,m=1,y=0,k,x,t,s=Array.from(arguments);switch(o){case"xg":{switch(p){case 0:{a===126?s[2]=125:a===127&&(s[2]=0);break}case 16:{a===126&&(s[2]=0);break}case 32:{a>125&&(s[2]=0),s[2]+=4;break}case 33:{(a>125||a===3)&&(s[2]=0),s[2]+=5;break}case 34:case 35:case 36:{a>125&&(s[2]=0),s[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:s[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{a===126&&(s[2]=0);break}case 48:case 64:case 126:case 127:{a===126&&(p===127&&e===0||(s[2]=0));break}case 121:{switch(a){case 126:{s[2]=0;break}case 16:{s[2]=15;break}default:s[2]=s[2]&15}break}}break}case"gs":case"sc":{p===0&&a<5?s[0]=49:p<128&&p>125&&a<5&&a!==2&&(s[2]=p,s[0]=49);break}case"mt32":{p===0&&(s[0]=49);break}case"sd":{switch(p){case 121:{s[0]=96;break}case 120:{s[0]=104;break}}s[0]>>1===40?s[2]|=16:s[0]>95&&s[0]<100&&(s[2]|=16,e>>4===7&&(s[0]=96));break}case"pa":{switch(p){case 120:{a==64?s[2]=2:s[2]=1;break}case 121:{switch(a){case 127:{s[2]=79;break}default:s[2]=(s[2]&63)+32}break}}break}case"g2":{p>>1===40?s[2]|=16:p>95&&p<100&&(s[2]|=16,e>>4===7&&(s[0]=96));break}case"sg":{p===8&&a===0&&(s[2]=5);break}case"05rw":case"x5d":{p&&p<56&&(s[0]=56);break}case"s90es":case"motif":case"an1x":case"cs1x":case"cs6x":{if(p===0)break;switch(p){case 63:{switch(o){case"s90es":{a<8?s[2]+=17:a<32?s[2]+=13:s[2]=(s[2]>>3)+19;break}case"motif":{a<8?s[2]+=28:a<32?s[2]+=13:s[2]=(s[2]>>3)+19;break}case"cs1x":{switch(a>>1){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:{s[2]+=34;break}case 32:{s[2]=34+((a&1)<<2);break}case 33:{s[2]=47+((a&1)<<2);break}case 61:{s[2]=34+((a&1)<<2);break}case 62:{s[2]=47+((a&1)<<2);break}}break}}break}case 32:{a>125&&(s[2]=0),s[2]+=4;break}case 33:{(a>125||a===3)&&(s[2]=0),s[2]+=5;break}case 34:case 35:case 36:{a>125&&(s[2]=0),s[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:s[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{a===126&&(s[2]=0);break}}break}}let f=" ",i="M",l="",d=0,c=0;switch(s[0]){case 0:{switch(s[2]){case 127:{i="GM-a";break}case 126:{i="GM-n";break}case 7:{i="GM-k",l="GLX";break}case 5:{i="SG-a",l="000";break}case 4:{o==="gs"||o==="sc"?(i="GM-a",l="000"):(i="SP-l",l="C/M");break}case 3:case 2:case 1:{(o==="gs"||o==="sc")&&(i="GM-a",l="000");break}case 0:{i="GM-a";break}default:i="y",d=3}break}case 8:{o==="sg"?i="GM-s":i="r:";break}case 32:case 33:case 34:case 35:case 36:{o==="xg"&&(i=`${["AP","VL","PF","DX","AN"][p&7]}-${"abcdefgh"[a]}`,d=3);break}case 48:{l=`M${(s[2]>>3).toString().padStart(2,"0")}`,i=`y${l}`,d=1;break}case 49:{s[2]>>1===63?(i=`MT-${"ba"[s[2]&1]}`,l=`C${"-/"[s[2]&1]}M`):(i="GM-a",l="000");break}case 56:{i="GM-b";break}case 57:i=["yDOC","QY10","QY20"][s[2]-112]||"yMxv",l=["DOC","QY1","QY2"][s[2]-112]||"057";case 61:case 128:{i="rDrm";break}case 120:{i="gDrm";break}case 62:{i="kDrm";break}case 63:{if(s[2]<17){let I=s[2];i=I<10?"kP:":"kC:",i+=I%10}else if(s[2]<34)i=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][s[2]-17];else if(s[2]<55){let I=s[2]-34;switch(I>12&&I--,a>>1){case 32:case 33:{i=`Pr${a-63}U`;break}case 61:case 62:{i=`Pr${a-121}U`;break}default:i=s[2]===46?"PrDr":`Pr${(I>>2)+1}${String.fromCharCode(65+(I&3))}`}}else i="Ds";d=1;break}case 64:{i="ySFX",l="SFX";break}case 67:{i="DX:S";break}case 80:case 81:case 82:case 83:{i=`Prg${"UABC"[s[0]-80]}`;break}case 88:case 89:case 90:case 91:{i=`Cmb${"UABC"[s[0]-88]}`;break}case 95:{i=`${["DR","PC"][s[2]]}-d`;break}case 96:{i=s[2]===106?"AP-a":s[2]>>4===1?"SDg":"PF",s[2]>63?c=63:s[2]>>4===1&&(c=16),d=3;break}case 97:{i=s[2]>>4===1?"SDa":"VL:",d=3,s[2]>>4===1?c=16:c=112;break}case 98:{i=s[2]>>4===1?"SDb":"SG-a",d=3,c=16;break}case 99:{i=s[2]>>4===1?"SDc":"DX",s[2]>63?c=63:s[2]>>4===1&&(c=16),d=3;break}case 100:{i="AN",s[2]>63?c=63:s[2]>>4===1&&(c=16),d=3;break}case 104:case 105:case 106:case 107:{i="SDd",c=104;break}case 121:{i=`GM${s[2]?"":"-a"}`,d=1;break}case 122:{i="lDrm";break}case 126:{i="yDrS";break}case 127:{s[2]===127?i="rDrm":i="yDrm";break}default:s[0]<48?i="r:":i="M"}i.length<4&&(i+=`${[p,a,s[0],s[2]][d]-c}`.padStart(4-i.length,"0")),l.length<3&&(l+=`${[p,a,p,a][d]}`.padStart(3-l.length,"0")),o==="xg"&&(p===0?s[2]<100?i=i.replace("y0","y:"):s[2]===125&&(i="y126"):p===16?(b=`Voice${((s[2]<<7)+s[1]+1).toString().padStart(3,"0")}`,f=" "):p===35&&a>>1===2&&(b=`DXCH_${(((s[2]&1)<<7)+e+1).toString().padStart(3,"0")}`,f=" "));let g=[s[0],s[1],s[2]];for(;!((b==null?void 0:b.length)>=0);)if(b=(w=r(this,se)[s[1]||0][(s[0]<<8)+s[2]])==null?void 0:w.name,b){let I=r(this,se)[s[1]||0][(s[0]<<8)+s[2]];m=(I==null?void 0:I.poly)||m,y=(I==null?void 0:I.type)||y,k=I==null?void 0:I.drum,x=I==null?void 0:I.level,t=I==null?void 0:I.voice}else if(this.strictMode)b="",f="?";else if(s[0]===0&&s[1]===0&&s[2]===0)b="Unloaded";else if(r(this,se)[s[1]||0][s[0]<<8])s[0]===0?(s[2]=0,f="^"):s[2]<1?(s[0]=0,f="*"):(s[2]--,f="^");else if(p===48)s[0]=0,s[2]=0,f="!";else if(p===62)s[1]--,f=" ",s[1]<1&&!(b!=null&&b.length)&&(s[0]=0,f="!");else if(p<63)s[0]===0?(s[2]=0,f="^"):s[2]<1?(s[0]=0,f="*"):s[2]--;else if(p===80)b=`PrgU:${e.toString().padStart(3,"0")}`,f="!";else if(p===88)b=`CmbU:${e.toString().padStart(3,"0")}`,f="!";else if(p===121)b=`GM2Vox0${a}`,f="#";else if(p===122){if(s[1]===32?s[1]:s[1]%=7,b=(A=r(this,se)[s[1]||0][(s[0]<<8)+s[2]])==null?void 0:A.name,b){f=" ";let I=r(this,se)[s[1]||0][(s[0]<<8)+s[2]];m=(I==null?void 0:I.poly)||m,y=(I==null?void 0:I.type)||y,k=I==null?void 0:I.drum,x=I==null?void 0:I.level}else b="",f="*";}else s[1]===0?(b=`${p.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")} ${a.toString().padStart(3,"0")}`,f="!"):s[0]===0?(s[2]=0,f="^"):s[2]>0?s[2]--:s[1]>0?(s[1]=0,f="!"):(s[0]=0,f="?");let u=[s[0],s[1],s[2]];switch(f){case"^":{switch(o){case"gs":case"sc":case"ns5r":{f=" ";break}case"xg":{a===126&&(f=" ");break}}p===127&&(f=" ");break}case"*":break;case"!":break;case"?":break}let E="??";switch(s[0]){case 0:{s[2]===0?E="GM":s[2]===5||s[2]===7?E="KG":s[2]<126&&(E="XG");break}case 32:case 33:case 35:case 36:{s[2]>4?E=["AP","VL","PF","DX","AN"][s[0]-32]:E="GS";break}case 48:{E="MU";break}case 49:{s[2]>>1===63?E="MT":s[2]<5&&(E="GM");break}case 56:{E="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{E="AI";break}case 62:case 82:case 90:{E="XD";break}case 63:{s[2]<17?E="KR":s[2]<34?E="ES":s[2]<55?E="CS":E="DS";break}case 64:case 126:{E="XG";break}case 67:case 99:{E=s[2]>>4===1?"SD":"DX";break}case 81:{E="RW";break}case 95:{E=["DR","PC"][s[2]];break}case 96:{E=s[2]===106?"AP":s[2]>>4===1?"SD":"PF";break}case 97:{E=s[2]>>4===1?"SD":"VL";break}case 98:{E=s[2]>>4===1?"SD":"SG";break}case 100:{E="AN";break}case 104:case 105:case 106:case 107:{E="SD";break}case 120:{E=e===0?"GM":(R=["G2","PA","PA"][s[2]])!=null?R:"G2";break}case 128:{E=e===0?"GM":"GS";break}case 121:{E=s[2]?["G2","XG","PA","PA","PA"][s[2]>>4]:"GM";break}case 122:{E="KG";break}case 127:{E=s[2]===127?"MT":e===0?"GM":"XG";break}default:s[0]<48&&(s[0]===16&&o==="xg"?E="XG":E="GS")}if(f!==" ")switch(o){case"krs":case"s90es":case"motif":{b="",E=wr[o],f="?";break}case"g2":{b="GM2 Ext?",f="?";break}case"pa":{f==="^"&&(b="Unknown",f="?");break}default:self.debugMode&&(b="",f="?")}return{name:b||`${kr[o]||o.toUpperCase()}${na(p||0)}${na(e||0)}${na(a||0)}`,poly:m,type:y,drum:k,level:x,voice:t,iid:g,eid:u,sid:h,ending:f,sect:i,bank:l,standard:E,mode:o}}async load(p,e,a="(internal)",o){let n=this,h=[],b=0,m=0,y=0;p.split(`
`).forEach(function(k,x){var f;let t=k.split("\t"),s=[];if(x===0){if(t.forEach(function(i,l){h[Cr.indexOf(i)]=l}),h.length<4){console.debug("Debugger launched.");debugger}}else{let i=0,l=0,d=0,c,g=1,u=0,E,w,A;t.forEach(function(Y,sa){switch(sa){case h[0]:{i=parseInt(Y);break}case h[1]:{l=parseInt(Y);break}case h[2]:{d=parseInt(Y);break}case h[3]:{c=Y;break}case h[4]:{Y=parseInt(Y),Y<16?g=Y+1:(u=(Y&15)+1,g=u);break}case h[5]:{w=Y;break}case h[6]:{typeof Y=="string"&&(E=parseInt(Y));break}case h[7]:{A=Y;break}}}),r(n,se)[l]=r(n,se)[l]||[];let R=r(n,se)[l],I={msb:i,prg:l,lsb:d,name:c,poly:g,type:u,drum:w,level:E,voice:A,priority:o},re=!1;o<((f=R[i<<8|d])==null?void 0:f.priority)&&(re=!0,y++),(!R[i<<8|d]||re||e)&&(R[i<<8|d]=I,b++),m++}}),e||console.debug(`Map: From "${a}", ${m} total, ${b} loaded (${b-y} + ${y}).`)}clearRange(p){let e=p.prg!==void 0?p.prg.constructor===Array?p.prg:[p.prg,p.prg]:[0,127],a=p.msb!==void 0?p.msb.constructor===Array?p.msb:[p.msb,p.msb]:[0,127],o=p.lsb!==void 0?p.lsb.constructor===Array?p.lsb:[p.lsb,p.lsb]:[0,127];for(let n=a[0];n<=a[1];n++){let h=n<<8;for(let b=o[0];b<=o[1];b++){let m=h+b;for(let y=e[0];y<=e[1];y++)delete r(this,se)[y][m]}}}init(){T(this,se,[]);for(let p=0;p<128;p++)r(this,se).push([""])}async loadFiles(...p){this.init();let e=this;p.forEach(async function(a,o){try{e.load(await(await fetch(`./data/bank/${a}.tsv`)).text(),!1,a,o)}catch(n){console.error(`Failed loading "${a}.tsv".`)}})}},se=new WeakMap,Ia);B();B();var Ct,Da,La=(Da=class{constructor(){M(this,Ct,{});P(this,"context")}set(p,e){r(this,Ct)[p]=e}has(p){return!!r(this,Ct)[p]}async read(p,e){if(!this.has(p))throw new Error(`No decoder registered for "${p}"`);return await r(this,Ct)[p].call(this.context||this,e)}},Ct=new WeakMap,Da);var vr=function(p,e){let a=!0;return e.forEach((o,n)=>{a=a&&p[n]===o}),a},Ot=function(p){let e=0;return p.forEach(a=>{e*=256,e+=a}),e},Re=new TextDecoder,Ut=new La;Ut.set("s7e",async function(p){let e=new Uint8Array(await p.slice(0,65536).arrayBuffer()),a="MSB\tLSB\tPRG\tNME",o=[0,0,0,0],n=32,h=0,b=0,m=!0,y=[],k=0;for(;m;){let x=e.subarray(h);([()=>{Re.decode(x.subarray(0,4))==="YSFC"?(h+=80,b=1):h++},()=>{if(vr(x.subarray(0,4),o))y.forEach((t,s,f)=>{let i=Ot(e.subarray(t.start+4,t.start+8));t.length=i}),b=2;else{let t=Re.decode(x.subarray(0,4)),s=Ot(x.subarray(4,8));y.push({type:t,start:s}),h+=8}},()=>{let t=y[k],s=e.subarray(t.start,t.start+t.length),f=32;switch(t.type){case"ENVC":{let i=n;for(;i<s.length;){let l=s.subarray(i,i+f),d=Re.decode(l.subarray(0,10)).trimEnd();d.slice(0,5)==="Init "&&(d=""),d&&(a+=`
063	${(l[17]+13).toString().padStart(3,"0")}	${l[19].toString().padStart(3,"0")}	${d}`),i+=f}break}case"EDVC":{let i=n;for(;i<s.length;){let l=s.subarray(i,i+f),d=Re.decode(l.subarray(0,10)).trimEnd();d.slice(0,5)==="Init "&&(d=""),d&&(a+=`
063	024	${l[19].toString().padStart(3,"0")}	${d}`),i+=f}break}case"EPVC":{let i=32,l=n;for(;l<s.length;){let d=s.subarray(l,l+i),c=Re.decode(d.subarray(0,10)).trimEnd();c==="----------"&&(c=""),c&&(a+=`
063	${(d[17]+1).toString().padStart(3,"0")}	${d[19].toString().padStart(3,"0")}	${c}`),l+=i}break}}k++,k>=y.length&&(b=3,m=!1)}][b]||(()=>{m=!1}))()}return a});Ut.set("pcg",async function(p){let e=new Uint8Array(await p.arrayBuffer()),a="MSB\tLSB\tPRG\tNME",o=100,n=0,h=0,b=!0,m=[],y=0;for(;b;){let k=e.subarray(o);([()=>{b=Re.decode(k.subarray(0,4))==="INI2",h=k[15],o+=16,n=1},()=>{let x=Re.decode(k.subarray(0,4)),t=k[5],s=k[7],f=k[11],i=Ot(k.subarray(12,16)),l=Ot(k.subarray(16,20)),d=Ot(k.subarray(36,40)),c=Re.decode(k.subarray(44,44+f));m.push({type:x,tipMsb:t,tipLsb:s,nameLen:f,length:i,start:l,entryLen:d,name:c}),o+=64,h--,h<1&&(n=2)},()=>{let x=m[y],t=e.subarray(x.start,x.start+x.length);switch(x.type){case"PRG1":break;case"PBK1":{let s=63,f=(x.tipMsb?6:0)+x.tipLsb;for(let i=0;i<128;i++){let l=i*x.entryLen,d=t.subarray(l,l+x.entryLen),c=Re.decode(d.subarray(0,24)).trimEnd().replace("InitProg","");c.length&&f>5&&(a+=`
${s.toString().padStart(3,"0")}	${f.toString().padStart(3,"0")}	${i.toString().padStart(3,"0")}	${c}`)}break}case"CBK1":{let s=63,f=(x.tipMsb?3:0)+x.tipLsb+10;for(let i=0;i<128;i++){let l=i*x.entryLen,d=t.subarray(l,l+x.entryLen),c=Re.decode(d.subarray(0,24)).trimEnd().replace("InitCombi","");c.length&&f>12&&(a+=`
${s.toString().padStart(3,"0")}	${f.toString().padStart(3,"0")}	${i.toString().padStart(3,"0")}	${c}`)}break}}y++,y>=m.length&&(n=3,b=!1)}][n]||(()=>{b=!1}))()}return a});B();var Bt=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),Nt=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],$r=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],wt=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],Oa=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],Ua=function(p){let e=.1,a=-.3;return p>66?(e=5,a=315):p>56?(e=1,a=47):p>46&&(e=.5,a=18.5),e*p-a},Ba=function(p){return p>105?$r[p-106]:p>100?p*1.1-100:p/10},Na=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),ca={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,ㇺ
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,ゐ
we,ゑ
wo,を
nga,か゚
ngi,き゚
ngu,く゚
nge,け゚
ngo,こ゚
ngy,き゚!
ng,ン
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,𛀁
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(p=>{let e=p.split(",");ca[e[0]]=e[1]});var _a=function(p){let e=p;p[0]=="*"&&(e=e.slice(1)),["aa","ii","uu","ee","oo"].forEach(o=>{for(;e.indexOf(o)>-1;)e=e.replace(o,o[0])});for(let o in ca)e=e.replaceAll(o,ca[o]);e.indexOf("\u3093")==0&&e.length>1&&(e=e.slice(1));let a=e.indexOf("!");return a>-1&&e.length>1&&(e=e.slice(a+1)),e},Ha=function(p){return p?p<96?`cc${p}`:["aftertouch","velocity","pitch bend"][p-96]:"off"},Ga={u8:["utf-8","Unicode"],l1:["l9","Pan-Latin"],jp:["sjis","Japanese"],kr:["iso-2022-kr","Korean"],hz:["gb18030","Simplified Chinese"],b5:["big5","Traditional Chinese"],cy:["koi8-ru","Cyrillic"],vn:["tcvn-5773-1993","Vietnamese"]},Xa={m:"Male",f:"Female",c:"Chorus",s:"Solo",p:"Plural",w:"Words",x:"Non-vocal"};B();var la=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],Va=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],Fa=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var Sr={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},xr={66307:["drive"],66309:["vowel",p=>"aiueo"[p]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",p=>["off","LPF","HPF"][p]],94984:["noise type",p=>["white","pink"][p]],94987:["disc type",p=>["LP","SP","EP","RND"]],94990:["hum type",p=>`${p+5}0Hz`],94993:["M/S",p=>["mono","stereo"][p]]},da=function(p){return Sr[(p[0]-32<<8)+p[1]]||`0x${p[0].toString(16).padStart(2,"0")}${p[1].toString(16).padStart(2,"0")}`},Ka=function(p,e,a){let o=(p[0]-32<<16)+(p[1]<<8)+e,n=xr[o]||{},h=n[0];if(h!=null&&h.length)return h+=`: ${(n[1]||function(){})(a)||a}`,h},fa=[68,48,95,78,41,3,110,122,0];B();var Ya=(p,e)=>{let a=Math.min(p.length,e.length),o=0;for(let n=0;n<a;n++)if(o=p[n]-e[n],o!==0)return[n,o];return p.length!==e.length?[a,p.length-e.length]:[0,0]},ue=function(p=64){return Math.round(2e3*Math.log10(p/64))/100},za=function(p,e,a){let o=[],n=a==!1?e.readIntVLV():a;p==0||p==127;for(let h=0;h<n;h++){let b=e.readInt(1);if(o.push(b),b!=247){if(b!=240){if(b>127)return console.debug(`Early termination: ${o}`),o.pop(),e.backOne(),e.backOne(),new Uint8Array(o)}}}return new Uint8Array(o)},et=function(p){let e=0;return p.forEach(a=>{e+=a,e=e&127}),~e+1&127},ve=function(p,e){let a=0,o=0;for(let n=0;n<p.length;n++){let h=(n&7)-1,b=(o>>h&1)<<7,m=p[n];m+=b,n&7?(e(m,a,p),a++):o=p[n]}};var Tr=function(p,e){let a=0;for(let o=0;o<p.length;o++)if(o&1){a=a<<4|p[o]&15;let n=o>>1;e(a,n,p)}else a=p[o]&15},Wa=function(p){let e=p.length>>1,a=new Uint8Array(e);return Tr(p,(o,n)=>{a[n]=o}),a},_t=function(p){let e=Math.floor(p*14.2);return e<128?e:0},O=function(){var p;return self.Bun?!0:(p=self.debugMode)!=null?p:!1},qa=function(p){let e=(p.length+1)*3>>2,a=new Uint8Array(e),o=p.length+3>>2;for(let n=0;n<o;n++){let h=n<<2,b=n*3,m=0;for(let y=0;y<4;y++)m<<=6,m|=p.charCodeAt(h+y)-32&63;a[b]=m>>16,a[b+1]=m>>8&255,a[b+2]=m&255}return a};var ms="\u266D\uD834\uDD2B,\uD834\uDD2B,\u266D,,\u266F,\uD834\uDD2A,\uD834\uDD2A\u266F".split(",");var Bs=xa(ua(),1);var W=["?","gm","gs","sc","xg","g2","mt32","doc","qy10","qy20","ns5r","x5d","05rw","k11","sg","sd","pa","krs","s90es","motif","cs6x","trin","an1x","cs1x"],Mr={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es",trinity:"trin","tr-rack":"trin"},Pr=["melodic","drum","menu"],Ht={"?":[0,0,120,0,0],gm:[0,0,120,0,0],gs:[0,0,128,0,0],sc:[0,0,128,0,0],xg:[0,0,127,0,0],g2:[0,0,120,0,0],mt32:[0,127,127,0,127],doc:[57,112,127,57,112],qy10:[57,113,127,57,113],qy20:[57,114,127,57,114],ns5r:[0,0,61,0,0],x5d:[82,0,62,56,0],"05rw":[81,0,62,56,0],k11:[0,0,122,0,0],sg:[0,0,122,0,0],sd:[97,0,105,0,0],pa:[0,0,120,121,0],krs:[121,0,120,0,0],s90es:[0,0,127,0,0],motif:[0,0,127,0,0],cs6x:[0,0,127,0,0],trin:[0,0,61,0,0],an1x:[36,3,127,0,0],cs1x:[0,0,127,63,0],cs2x:[0,0,127,63,0]},Ar=[9,25,41,57,73,89,105,121],Rr=[0,3,81,84,88],Qa={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},Jt={0:0,1:1,2:3,5:4},Ja={0:0,1:1,2:2,5:3},Za=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],ga=[36,37,48,49,52,53],ta=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],ja={26:127,29:0,30:0,31:0,52:12,53:54},tt=[0,1,2,4,5,6,7,8,10,11,12,13,14,15,16,17,18,19,20,21,22,26,28,32,38,40,41,42,43,44,45,46,47,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,80,81,82,83,84,91,92,93,94,95,98,99,100,101,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],Ir=[2,4,12,13,14,15,16,17,18,19,20,21,40,41,42,43,44,45,46,47,80,81,83,136,130,131,132,133,134,135,137,138,139,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],Dr=[33,102,99,32,100,8,9,10],er=[0,16,25,40,32,64,24,48],Gt="reverb,chorus,delay,insert0,insert1,insert2,insert3,insert4".split(","),$e=[["VL",32,8,1],["SG",8,1,1],["DX",16,1,16],["AN",16,2,5],["PF",2,1,64],["DR",2,1,32],["PC",2,1,32],["AP",2,1,64]],$={};W.forEach((p,e)=>{$[p]=e});var S=[];tt.forEach((p,e)=>{S[p]=e});var ye={length:ta.length};ta.forEach((p,e)=>{ye[p]=e});var Lr={};Pr.forEach((p,e)=>{Lr[p]=e});var Or=function(p){let e=[],a=0;return p==null||p.forEach(function(o,n){o===247?e.push(p.subarray(a,n)):o===240&&(a=n+1)}),e.length||e.push(p.subarray(0)),O()&&console.debug(e),e};var pa=8,C={port:pa,ch:pa<<4,chShift:Math.ceil(Math.log2(pa))+4,cc:tt.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,nrpn:ga.length,ace:8,drm:8,dpn:ta.length,dnc:128,ext:3,efx:8,cvn:12,redir:32,vxPrim:3,invalidCh:255};C.chcc=C.cc*C.ch;var Ae={bank0:255},Ur=new TextDecoder("l9"),G=new Uint16Array(C.ch),kt=new Uint16Array(C.ch),Br=new Uint16Array(C.ch),Zt=new Uint16Array(C.ch),Nr=new Uint16Array(C.ch),vt=new Uint16Array(C.ch),tr=new Array(C.drm);for(let p=0;p<C.ch;p++)G[p]=p*C.cc,kt[p]=p*C.rpn,Br[p]=p*C.nrpn,Zt[p]=p*C.ace,Nr[p]=p*C.ext,vt[p]=p*C.cvn;for(let p=0;p<C.drm;p++){tr[p]=new Uint16Array(C.dpn);let e=p*C.dpn*C.dnc;for(let a=0;a<C.dpn;a++)tr[p][a]=e+a*C.dnc}var H,ie,Se,xe,He,$t,_r,pe,X,D,v,ae,N,j,ne,J,F,Ne,Ie,at,oe,L,_,St,de,Te,ge,rt,st,q,xt,it,me,nt,Tt,Xe,Me,Mt,Ve,Z,U,De,Xt,z,ot,Pt,ba,ya,ma,Ea,Fe,Ke,Vt,At,Le,K,jt,Ft,Q,Rt,ct,be,_e,Ye,ce,lt,ee,Kt,ea,dt,ft,te,Ee,Pe,ht,ut,pt,ar,_s=(ar=class extends Qt{constructor(){super();M(this,He);P(this,"NOTE_IDLE",0);P(this,"NOTE_ATTACK",1);P(this,"NOTE_DECAY",2);P(this,"NOTE_SUSTAIN",3);P(this,"NOTE_HELD",4);P(this,"NOTE_RELEASE",5);P(this,"NOTE_SOSTENUTO_ATTACK",8);P(this,"NOTE_SOSTENUTO_DECAY",9);P(this,"NOTE_SOSTENUTO_SUSTAIN",10);P(this,"NOTE_SOSTENUTO_HELD",11);P(this,"NOTE_MUTED_RECOVERABLE",16);P(this,"CH_MELODIC",0);P(this,"CH_DRUMS",1);P(this,"CH_DRUM1",2);P(this,"CH_DRUM2",3);P(this,"CH_DRUM3",4);P(this,"CH_DRUM4",5);P(this,"CH_DRUM5",6);P(this,"CH_DRUM6",7);P(this,"CH_DRUM7",8);P(this,"CH_DRUM8",9);P(this,"DUMP_ALL",0);P(this,"DUMP_ONCE",1);P(this,"DUMP_MODE",2);P(this,"EXT_NONE",0);P(this,"EXT_VL",1);P(this,"EXT_DX",3);P(this,"VLBC_SYSTEM",0);P(this,"VLBC_BRTHEXPR",1);P(this,"VLBC_VELOINIT",2);P(this,"VLBC_VELOALL",3);P(this,"CH_INACTIVE",0);P(this,"CH_ACTIVE",1);P(this,"CH_DISABLED",2);P(this,"KARAOKE_NONE",0);P(this,"KARAOKE_TEXT",1);P(this,"KARAOKE_XF",2);M(this,H,0);M(this,ie,0);M(this,Se,0);M(this,xe,new Array(11));M(this,pe,new Uint8Array(C.ch));M(this,X,new Uint8Array(C.ch));M(this,D,new Uint8Array(C.ch));M(this,v,new Uint8Array(C.chcc<<1));M(this,ae,new Uint8Array(C.ch*C.ace));M(this,N,new Uint8Array(C.ch*C.vxPrim));M(this,j,new Uint8Array(C.ch*C.nn));M(this,ne,new Uint8Array(C.ch));M(this,J,new Uint16Array(C.pl));M(this,F,new Uint8Array(C.pl));M(this,Ne,new Int16Array(C.ch));M(this,Ie,new Uint8Array(C.ch));M(this,at,new Uint8Array(C.ch));M(this,oe,new Uint8Array(C.ch*C.ext));M(this,L,new Uint8Array(C.ch*C.rpn));M(this,_,new Uint8Array(C.ch*C.rpnt));M(this,St,new Int8Array(C.ch*ga.length));M(this,de,new Uint8Array(C.drm*C.dpn*C.dnc));M(this,Te,new Uint8Array(C.drm*2));M(this,ge,new Uint8Array(C.efx*3));M(this,rt,new Uint8Array(C.ch));M(this,st,new Uint8Array(C.ch*C.redir));M(this,q,new Uint8Array(C.port));M(this,xt,new Uint8Array(C.port));M(this,it,new Uint8Array(C.ch));M(this,me,new Uint8Array(C.ch));M(this,nt,new Uint8Array(C.ch*C.cvn));M(this,Tt,new Uint8Array(C.ch));M(this,Xe,new Uint8Array(128));M(this,Me,new Uint8Array(C.cmt*8));M(this,Mt,new Uint8Array(1024));M(this,Ve,new Uint8Array(C.cmt*64));M(this,Z,{});P(this,"modelEx",{xg:{varSys:!1,insPart:new Uint8Array(5)},yPlg:[],sc:{showBar:!0,invBar:!1,invDisp:!1,peakHold:1},cs1x:{perfCh:0},kross:{chToggle:!1},sg:{convLastSyll:0,runLineLen:0,maxLineLen:32,splitMask:!1}});M(this,U,void 0);M(this,De,void 0);M(this,Xt,void 0);M(this,z,100);M(this,ot,0);M(this,Pt,500);M(this,ba,0);M(this,ya,0);M(this,ma,32);M(this,Ea,!1);M(this,Fe,"");M(this,Ke,0);M(this,Vt,0);M(this,At,0);M(this,Le,!0);M(this,K,0);M(this,jt,1);M(this,Ft,void 0);M(this,Q,!1);M(this,Rt,0);M(this,ct,new Array(C.ch));M(this,be,[]);M(this,_e,new Uint8Array(C.ch));M(this,Ye,new Uint8Array(C.tr));P(this,"baseBank",new oa("gm2","ns5r","xg","gs","sd","gmega","plg-vl","plg-pf","plg-dx","plg-an","plg-dr","plg-sg","kross","s90es","cs2x","pa"));P(this,"userBank",new oa("gm2"));P(this,"initOnReset",!1);P(this,"aiEfxName","");P(this,"polyIndexShrink",!0);P(this,"polyIndexLatest",0);P(this,"polyIndexLast",0);M(this,ce,[]);M(this,lt,void 0);M(this,ee,{nOff:(e,a)=>{let o=e*128+a,n=r(this,J).lastIndexOf(o);if(n>-1)if(this.getChCc(e,64)>>6)r(this,F)[n]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:a,velo:r(this,j)[o],state:this.NOTE_HELD});else if(this.getChCc(e,66)>>6&&r(this,F)[n]===this.NOTE_SOSTENUTO_SUSTAIN)r(this,F)[n]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:a,velo:r(this,j)[o],state:this.NOTE_SOSTENUTO_HELD});else{r(this,J)[n]=0,r(this,j)[o]=0,r(this,F)[n]=this.NOTE_IDLE;let h=this.getExt(e)[1];(h===this.VLBC_VELOINIT||h===this.VLBC_VELOALL)&&this.setChCc(e,129,0),this.dispatchEvent("note",{part:e,note:a,velo:0,state:this.NOTE_IDLE})}if(r(this,ne)[e]){for(let h=this.polyIndexLast;h>=0;h--)if(r(this,J)[h]>>7===e&&r(this,F)[h]!==0){r(this,F)[h]===this.NOTE_MUTED_RECOVERABLE&&(r(this,F)[h]=this.NOTE_SUSTAIN);break}}if(this.polyIndexShrink&&this.polyIndexLast>0){let b=!1,m=this.polyIndexLast-8,y=this.polyIndexLast;for(;y>m&&r(this,F)[y]===0;y--)b=!0;b&&(this.polyIndexLast=y,r(this,F)[y+1]!==0&&console.error("Polyphonic slot shrinking edge case."))}},nOn:(e,a,o)=>{let n=e*128+a,h=0;if(r(this,ne)[e])for(let b=0;b<=this.polyIndexLast;b++)r(this,J)[b]>>7===e&&r(this,F)[b]!==0&&(r(this,F)[b]=this.NOTE_MUTED_RECOVERABLE);for(;r(this,F)[h]>0&&r(this,J)[h]!==n;)h++;if(h<C.pl){r(this,J)[h]=n,r(this,j)[n]=o,r(this,F)[h]=this.NOTE_SUSTAIN,r(this,Ie)[e]<o&&(r(this,Ie)[e]=o);let b=this.getExt(e)[1];(b===this.VLBC_VELOINIT||b===this.VLBC_VELOALL)&&this.setChCc(e,129,o),this.dispatchEvent("note",{part:e,note:a,velo:o,state:this.NOTE_SUSTAIN}),this.polyIndexLatest=h+1,h>this.polyIndexLast&&(this.polyIndexLast=h)}else console.error("Polyphony exceeded.")},nAt:(e,a,o)=>{},cAt:(e,a)=>{},hoOf:e=>{r(this,F).forEach((a,o)=>{if(a===this.NOTE_HELD){let n=r(this,J)[o],h=n>>7;e===h&&(r(this,F)[o]=this.NOTE_IDLE,r(this,J)[o]=0,r(this,j)[n]=0,this.dispatchEvent("note",{part:e,note:n&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{r(this,F).forEach((a,o)=>{let n;switch(a){case this.NOTE_ATTACK:{n=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{n=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{n=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(n){r(this,F)[o]=n;let h=r(this,J)[o];this.dispatchEvent("note",{part:e,note:h&127,velo:r(this,j)[h],state:n})}})},soOf:e=>{r(this,F).forEach((a,o)=>{if(a===this.NOTE_SOSTENUTO_HELD){let n=r(this,J)[o],h=n>>7;e===h&&(r(this,F)[o]=this.NOTE_IDLE,r(this,J)[o]=0,r(this,j)[n]=0,this.dispatchEvent("note",{part:e,note:n&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{r(this,J).forEach(a=>{let o=a>>7,n=a&127;a===0&&r(this,j)[0]===0||o===e&&r(this,ee).nOff(o,n)})}});M(this,Kt,{8:function(e){let a=e.channel,o=e.data[0];r(this,ee).nOff(a,o)},9:function(e){let a=e.channel,o=this;if(o.getChModeId(a)===$.xg&&r(o,D)[a]>1){let b=o.getChDrumFirstWrite(a);b[0]&&b[1]!==C.invalidCh&&!r(o,pe)[a]&&(o.copyChSetup(b[1],a),o.pushChPrimitives(a),console.debug(`Part CH${a+1} copied from CH${b[1]+1}.`))}o.setChActive(a,1);let n=e.data[0],h=e.data[1];h>0?r(o,ee).nOn(a,n,h):r(o,ee).nOff(a,n)},10:function(e){let a=e.channel,o=a*128+e.data[0];r(this,J).indexOf(o)>-1&&(r(this,j)[o]=data[1],this.getExt(a)[1]===this.VLBC_VELOALL&&this.setChCc(a,129,data[1]),this.dispatchEvent("note",{part:a,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let a=e.channel,o=this,n=r(o,ct)[a],h=n[e.data[0]];h&&(e.data[0]=h),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(r(this,H)){case $.s90es:case $.motif:{if(e.data[0]===0){[0,63].indexOf(e.data[1])>-1&&o.setChActive(a,1);break}e.data[1]&&o.setChActive(a,1);break}default:break}})();let b=a*C.ext,m=o.getChModeId(a);switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{r(this,ee).ano(a),r(this,Ne)[a]=0,o.resetChCc(a,1,0),o.resetChCc(a,5,0),o.resetChCc(a,64,0),o.resetChCc(a,65,0),o.resetChCc(a,66,0),o.resetChCc(a,67,0),o.resetChCc(a,11,127),o.resetChCc(a,101,127),o.resetChCc(a,100,127),o.resetChCc(a,99,127),o.resetChCc(a,98,127);return}case 123:{r(this,ee).ano(a);return}case 124:{r(this,ee).ano(a);return}case 125:{r(this,ee).ano(a);return}case 126:{r(this,ne)[a]=1,r(this,ee).ano(a);return}case 127:{r(this,ne)[a]=0,r(this,ee).ano(a);return}}if(S[e.data[0]]===void 0)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(Ir.indexOf(e.data[0])>-1&&this.allocateAce(a,e.data[0]),e.data[0]){case 0:{switch(O()&&console.debug(`${W[r(this,H)]}, CH${a+1}: ${e.data[1]}`),r(this,H)===0?e.data[1]<48?(r(this,D)[a]>0&&(e.data[1]=this.getChPrimitive(a,1,!1),e.data[1]=Ht.gs[2],console.debug(`Forced channel ${a+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]===56?this.switchMode(r(this,U).x5===82?"x5d":"05rw"):e.data[1]===62?this.switchMode(r(this,U).x5===82?"x5d":"05rw"):e.data[1]===63?this.switchMode(W[r(this,U).ds]):e.data[1]===64||e.data[1]===127?this.switchMode("xg"):(e.data[1]===120||e.data[1]===121)&&this.switchMode("g2"):r(this,H)===$.gs||r(this,H)===$.sc?e.data[1]<56&&r(this,D)[a]>0&&(e.data[1]=this.getChPrimitive(a,1,!1),e.data[1]=Ht.gs[2],console.debug(`Forced channel ${a+1} to stay drums.`)):r(this,H)===$.gm&&(e.data[1]<48?r(this,D)[a]>0&&(e.data[1]=Ht.gs[2],this.switchMode("gs",!0),console.debug(`Forced channel ${a+1} to stay drums.`)):(e.data[1]===64||e.data[1]===127)&&this.switchMode("xg",!0)),r(this,H)){case $.xg:{[79,95,126,127].indexOf(e.data[1])>-1?r(this,D)[a]===0&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):r(this,D)[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?r(this,oe)[b]=this.EXT_VL:[35,67,83,99].indexOf(e.data[1])>-1?r(this,oe)[b]=this.EXT_DX:r(this,oe)[b]=this.EXT_NONE;break}case $["05rw"]:case $.x5d:case $.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?r(this,D)[a]===this.CH_MELODIC&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):[80,81,82,83].indexOf(e.data[1])>-1||r(this,D)[a]!==this.CH_MELODIC&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}case $.sd:{[104,105,106,107,120].indexOf(e.data[1])>-1?r(this,D)[a]===0&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):r(this,D)[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}case $.g2:{e.data[1]===120?r(this,D)[a]===0&&(this.setChType(a,this.CH_DRUMS),console.debug(`CH${a+1} set to drums by MSB.`)):r(this,D)[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}}break}case 2:{this.getExt(a)[1]===this.VLBC_BRTHEXPR&&this.setChCc(a,129,e.data[1]);break}case 6:{if(r(this,at)[a]){[$.xg,$.gs,$.sc,$.ns5r].indexOf(r(this,H))<0&&console.warn(`NRPN commits are not available under "${W[r(this,H)]}" mode, even when they are supported in Octavia.`);let y=this.getChCc(a,99),k=this.getChCc(a,98);if(y===1){let x=Dr.indexOf(k);if(x>-1)this.setChCc(a,71+x,e.data[1]),O()&&console.debug(`Redirected NRPN 1 ${k} to cc${71+x}.`),this.dispatchEvent("cc",{part:a,cc:71+x,data:e.data[1]});else{let t=ga.indexOf(k);t>-1?r(this,St)[a*10+t]=e.data[1]-64:console.warn(`NRPN 0x01${k.toString(16).padStart(2,"0")} is not supported.`),O()&&console.debug(`CH${a+1} voice NRPN ${k} commit`)}}else{if(ta.indexOf(y)<0){let t=`NRPN 0x${y.toString(16).padStart(2,"0")}${k.toString(16).padStart(2,"0")} `;console.warn(y===127?`${t}is not necessary. Consider removing it.`:`${t}is not supported.`)}else{let t=r(this,D)[a]-2;t<0?console.warn(`CH${a+1} cannot accept drum NRPN as type ${Nt[r(this,D)[a]]}.`):r(this,de)[(t*C.dpn+ye[y])*C.dnc+k]=e.data[1]}O()&&console.debug(`CH${a+1} (${Nt[r(this,D)[a]]}) drum NRPN ${y} commit`)}}else{let y=Jt[this.getChCc(a,100)],k=Ja[this.getChCc(a,100)];if(this.getChCc(a,101)===0&&y!==void 0)switch(O()&&console.debug(`CH${a+1} RPN 0 ${this.getChCc(a,100)} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],Za[y][0]),Za[y][1]),r(this,L)[a*C.rpn+y]=e.data[1],r(this,_)[a*C.rpnt+k]=1,m){case $.xg:case $.gs:case $.sc:case $.mt32:case $.s90es:case $.motif:case $.cs1x:case $.cs6x:{switch(this.getChCc(a,100)){case 1:case 2:{this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)});break}}break}default:this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)})}}break}case 32:{switch(O()&&console.debug(`${W[r(this,H)]}, CH${a+1} LSB: ${e.data[1]}`),r(this,H)){case $.s90es:case $.motif:{this.setChType(a,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,r(this,H),!0);break}}this.getExt(a)[0],this.EXT_DX;break}case 38:{if(!r(this,at)[a]){let y=Jt[this.getChCc(a,100)],k=Ja[this.getChCc(a,100)];this.getChCc(a,101)===0&&y!==void 0&&(r(this,L)[a*C.rpn+y+1]=e.data[1],r(this,_)[a*C.rpnt+k]=1)}break}case 64:{e.data[1]<64&&r(this,ee).hoOf(a);break}case 66:{e.data[1]>>6?r(this,ee).soOn(a):r(this,ee).soOf(a);break}case 98:case 99:{r(this,at)[a]=1;break}case 100:case 101:{r(this,at)[a]=0;break}}this.setChCc(a,e.data[0],e.data[1]),this.dispatchEvent("cc",{part:a,cc:e.data[0],data:e.data[1]})}o.getChModeId(a)===$.xg&&r(o,D)[a]&&o.setDrumFirstWrite(a)},12:function(e){let a=e.channel,o=this;switch(r(o,H)){case $.s90es:case $.motif:{e.data&&o.setChActive(a,1);break}default:o.setChActive(a,1)}let n=G[a];switch(o.getExt(a)[0]){case o.EXT_VL:break}r(o,N)[a]=e.data,r(o,me)[a]=0,o.pushChPrimitives(a),O()&&console.debug(`T:${e.track} C:${a} P:${e.data}`),o.getChModeId(a)===$.xg&&r(o,D)[a]&&o.setDrumFirstWrite(a)},13:function(e){let a=this,o=e.channel;r(this,J).forEach(function(n){let h=n>>7;o===h&&(r(a,j)[n]=e.data,a.dispatchEvent("note",{part:o,note:n&127,velo:e.data,state:a.NOTE_SUSTAIN}))})},14:function(e){let a=e.channel;r(this,Ne)[a]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)})},15:function(e){Or(e.data).forEach(a=>{let o=a[0],n=a[1];T(this,Rt,a.length),(r(this,ea)[o]||function(){console.debug(`Unknown manufacturer ${o}.`)})(n,a.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(r(this,ce)[e.meta]||function(o,n,h){}).call(this,e.data,e.track,e.meta),e.meta!==32&&T(this,ot,0);let a=Rr.indexOf(e.meta)>-1;if(O()&&console.debug(e),a)return e.reply="meta",e}});M(this,ea,{64:(e,a,o)=>{r(this,ht).run(a,o,e)},65:(e,a,o)=>{if(a[0]<16){if(a[1]===72){let n=a[a.length-1],h=et(a.subarray(3,a.length-1));n===h?r(this,Ee).run(a.subarray(0,a.length-1),o,e):console.warn(`Bad SD checksum ${n} - should be ${h}.`)}else r(this,Ee).run(a,o,e);}else{let n=a[a.length-1],h=et(a.subarray(2,a.length-1));n===h?r(this,Ee).run(a.subarray(0,a.length-1),o,e):console.warn(`Bad GS checksum ${n} - should be ${h}.`)}},66:(e,a,o)=>{r(this,Pe).run(a,o,e)},67:(e,a,o)=>{switch(e>>4){case 0:{let n=0;for(;a[n]===127&&n<4;)n++;let h=a[1+n]<<7|a[2+n];if(h+7+n!==a.length){console.warn(`Yamaha bulk dump length mismatch! Expected ${a.length-7-n}, received ${h}.`),console.debug(a);break}let b=et(a.subarray(1+n,a.length-1)),m=a[a.length-1];if(a[a.length-1]>>7)console.warn(`Yamaha bulk dump checksum invalid! Expected ${b}, received ${m}:
`),console.debug(a);else if(b!==m)console.warn(`Yamaha bulk dump checksum mismatch! Expected ${b}, received ${m}:
`),console.debug(a);else{let y=a.slice(2,a.length-1);for(let k=0;k<=n;k++)y[k]=a[k];r(this,te).run(y,o,e&15)}break}case 1:{r(this,te).run(a,o,e&15);break}case 2:{console.warn("Octavia doesn't yet support Yamaha bulk dump requests.");break}case 3:{console.warn("Octavia doesn't yet support Yamaha parameter requests.");break}case 7:{switch(e&15){case 14:{let n=new Uint8Array(a.length+1);n[0]=126,n.set(a,1),r(this,te).run(n,o,0);break}default:console.warn(`Unknown Yamaha special SysEx type: ${e}.`)}break}default:console.warn(`Unknown Yamaha SysEx type: ${e>>4}.`)}},68:(e,a,o)=>{r(this,pt).run(a,o,e)},71:(e,a,o)=>{r(this,ut).run(a,o,e)},126:(e,a,o)=>{r(this,dt).run(a,o,e)},127:(e,a,o)=>{this.switchMode("gm"),r(this,ft).run(a,o,e)}});M(this,dt,void 0);M(this,ft,void 0);M(this,te,void 0);M(this,Ee,void 0);M(this,Pe,void 0);M(this,ht,void 0);M(this,ut,void 0);M(this,pt,void 0);let e=this;for(let t=0;t<10;t++)r(e,xe)[t]=new Uint8Array(256);r(e,xe)[10]=new Uint8Array(512),T(e,lt,new ke),T(e,U,{x5:82,ds:$.krs,smotif:$.s90es,gs:4,sc:3,gm:$.gm,g2:$.g2}),T(e,De,{dumpLimit:e.DUMP_MODE}),T(e,Xt,new Proxy(r(e,De),{set:()=>{}}));for(let t in Ht){let s=$[t];s===void 0?console.debug(`SubDB build error: "${t}" does not exist`):r(e,Z)[s]=new Uint8Array(Ht[t])}for(let t of $e)e.modelEx.yPlg.push(new Uint8Array(t[1]));e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(t){var f,i;let{data:s}=t;((f=r(e,be)[0])==null?void 0:f.type)===s.type&&(i=r(e,be)[0])!=null&&i.amend?(r(e,be)[0].amend=s.amend,r(e,be)[0].data+=s.data):r(e,be).unshift(s)}),r(e,ce)[1]=function(t){var s,f,i,l;switch(t=t.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),t.substring(0,2)){case"@I":{T(e,K,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Info",data:(s=t.substring(2))==null?void 0:s.trimStart()});break}case"@K":{T(e,K,e.KARAOKE_TEXT);let d=t.substring(2);d!=="MIDI KARAOKE FILE"&&e.dispatchEvent("metacommit",{type:"Kar.Mode",data:d==null?void 0:d.trimStart()}),console.debug(`Karaoke mode active: ${d}`);break}case"@L":{T(e,K,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Lang",data:(f=t.substring(2))==null?void 0:f.trimStart()});break}case"@T":{T(e,K,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"KarTitle",data:(i=t.substring(2))==null?void 0:i.trimStart()});break}case"@V":{T(e,K,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Ver.",data:(l=t.substring(2))==null?void 0:l.trimStart()});break}case"Mi":{if(t.substring(2,16)==="dStamp-1.00: 0"){let d=t.length;for(let g=t.length;g>0;g--)if((t.charCodeAt(g-1)>>5)+1>>1===1){d=g;break}let c=t.substring(16,d);e.dispatchEvent("metacommit",{type:"MidStamp",data:qa(c)})}else t.split(`
`).forEach((d,c)=>{e.dispatchEvent("metacommit",{type:"Cmn.Text",data:d,mask:c!==0})});break}case"XF":{let d=t.slice(2).split(":");switch(d[0]){case"hd":{d.slice(1).forEach((c,g)=>{c.length&&e.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][g],data:c})});break}case"ln":{d.slice(1).forEach((c,g)=>{c.length&&e.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][g],data:c})});break}default:e.dispatchEvent("metacommit",{type:"XfUnData",data:t})}break}default:switch(r(e,K)){case e.KARAOKE_TEXT:{switch(t[0]){case"\\":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:t.substring(1),amend:!0});break}case"/":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:t.substring(1),mask:!0,amend:!0});break}default:e.dispatchEvent("metacommit",{type:"KarLyric",data:t,amend:!0})}break}default:t.split(`
`).forEach((d,c)=>{e.dispatchEvent("metacommit",{type:"Cmn.Text",data:d,mask:c!==0})})}}},r(e,ce)[2]=function(t){e.dispatchEvent("metacommit",{type:"Copyrite",data:t})},r(e,ce)[3]=function(t,s){s<1&&r(e,ot)<1&&e.dispatchEvent("metacommit",{type:"TrkTitle",data:t})},r(e,ce)[4]=function(t,s){e.dispatchEvent("metacommit",{type:"Instrmnt",data:t})},r(e,ce)[5]=function(t){switch(r(e,K)){case e.KARAOKE_XF:{let s="";for(let f of t)switch(f){case"^":case"%":{s+=" ";break}case">":{s+="\t";break}case"<":{e.dispatchEvent("metacommit",{type:"KarLyric",data:s,mask:r(e,Q),amend:!1}),s="",T(e,Q,!1);break}case"/":{e.dispatchEvent("metacommit",{type:"KarLyric",data:s,mask:!1,amend:!1}),s="",T(e,Q,!0);break}default:s+=f}s.length>0&&(e.dispatchEvent("metacommit",{type:"KarLyric",data:s,mask:r(e,Q),amend:!0}),T(e,Q,!1));break}default:{let s=0,f=!0,i=t.length-1;for(;f&&s<8;)switch(t.charCodeAt(s)){case 32:{s++;break}default:f=!1}switch(s>0&&(e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(0,s),amend:!0,mask:r(e,Q),untimed:!0}),T(e,Q,!1)),t.charCodeAt(i)){case 10:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(s,i),amend:!1,mask:r(e,Q)}),T(e,Q,!1);break}case 11:case 13:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(s,i),amend:!1,mask:r(e,Q)}),T(e,Q,!0);break}case 32:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t.substring(s,i),amend:!0,mask:r(e,Q)}),e.dispatchEvent("metacommit",{type:"C.Lyrics",data:" ",amend:!0,mask:!1,untimed:!0}),T(e,Q,!1);break}default:t.trim()===""?console.info("Blank line? Shouldn't happen."):e.dispatchEvent("metacommit",{type:"C.Lyrics",data:t,amend:!0,mask:r(e,Q)}),T(e,Q,!1)}break}}},r(e,ce)[6]=function(t){e.dispatchEvent("metacommit",{type:"C.Marker",data:t})},r(e,ce)[7]=function(t){switch(t[0]){case"$":{if(t.substring(1,5)==="Lyrc"){T(e,K,e.KARAOKE_XF);let s=t.substring(6).split(":"),f=s[0].replaceAll(" ","").split(",");f.forEach((l,d,c)=>{c[d]=parseInt(l)-1});let i=Ga[s[2].substring(0,2).toLowerCase()];e.dispatchEvent("metacommit",{type:"XfMeloCh",data:`CH${s[0].replaceAll(" ","").split(",").join(", CH")}`,parsed:f}),e.dispatchEvent("metacommit",{type:"XfLyrOff",data:s[1],parsed:parseInt(s[1])}),e.dispatchEvent("metacommit",{type:"XfLyrEnc",data:i[1],parsed:i[0]}),T(e,Q,!1)}else e.dispatchEvent("metacommit",{type:"CuePoint",data:t});break}case"#":{e.dispatchEvent("metacommit",{type:"XfScneNo",data:t.substring(1)});break}case"&":{t.length===2?(e.dispatchEvent("metacommit",{type:"XfSngPrt",data:Xa[t[1]]||`Unknown "${t[1]}"`}),T(e,Q,!1)):e.dispatchEvent("metacommit",{type:"CuePoint",data:t});break}default:e.dispatchEvent("metacommit",{type:"CuePoint",data:t})}},r(e,ce)[32]=function(t){T(e,ot,t[0]+1)},r(e,ce)[33]=function(t,s){O()&&console.debug(`Track ${s} requests getting assigned to port ${t}.`),r(e,Ye)[s]=t+1},r(e,ce)[81]=function(t,s){T(e,Pt,t/1e3)},r(e,ce)[127]=function(t,s){r(e,lt).run(t,s)},r(e,lt).default=function(t){let s=[];for(let f=0;f<8&&f<t.length;f++)s.push(t[f].toString(16).padStart(2,"0").toUpperCase());console.warn(`Unrecognized implementation-specific byte sequence: ${s.join(" ")}${t.length>8?" ...":""}
%o`,t)},r(e,lt).add([67,0,1],(t,s)=>{O()&&console.debug(`XGworks port assign requests assigning track ${s} to port ${t[0]}.`),r(e,Ye)[s]=t[0]+1}).add([67,123,1],(t,s)=>{let f=[];for(let i=0;i<t.length;i+=2){let l=t[i]>>4,d=t[i]&15;if(l<7&&d&&d<8){let c=new Uint8Array(5);c[0]=d-1,c[1]=l-3<<2,c[2]=t[i|1],f.push(c)}}e.dispatchEvent("metacommit",{type:"ChordCtl",src:"yxf",data:f}),console.debug("Yamaha XF chord data: %o",f)}).add([67,123,2],(t,s)=>{var i;let f=new Uint8Array(2);f[0]=t[0]&15,f[1]=t[0]>>4,e.dispatchEvent("metacommit",{type:"RhrslMrk",src:"yxf",data:f}),console.debug(`Yamaha XF rehearsal mark: ${(i=["Intro","Ending","Fill-in"][f[0]])!=null?i:String.fromCharCode(62+f[0])}${"'".repeat(f[1])} %o`,f)}).add([67,123,96],(t,s)=>{let f=[0,0];t.subarray(1,3).forEach(i=>{f[0]=f[0]<<7,f[0]|=i&127}),t.subarray(3,5).forEach(i=>{f[1]=f[1]<<7,f[1]|=i&127}),e.dispatchEvent("metacommit",{type:"YStyleId",data:f}),console.debug(`Yamaha style ID: model ${f[0].toString(16)}, style ${f[1]+1}`)}),T(e,dt,new ke("universal non-realtime")),T(e,ft,new ke("universal realtime")),T(e,te,new ke("Yamaha")),T(e,Ee,new ke("Roland")),T(e,Pe,new ke("Korg")),T(e,ht,new ke("Kawai")),T(e,ut,new ke("Akai")),T(e,pt,new ke("Casio"));let a=new ke("DX7+ Dump"),o=function(t){let s=[];for(let f=0;f<8&&f<t.length;f++)s.push(t[f].toString(16).padStart(2,"0").toUpperCase());console.info(`Unrecognized SysEx in "${this.name}" set: ${s.join(" ")}${t.length>8?" ...":""}
%o`,t)};r(e,dt).default=o,r(e,ft).default=o,r(e,te).default=o,r(e,Ee).default=o,r(e,Pe).default=o,r(e,ht).default=o,r(e,ut).default=o,r(e,pt).default=o,a.default=o,r(e,dt).add([9],(t,s,f)=>{e.switchMode(["gm","?","g2"][t[0]-1],!0),e.setPortMode(e.getTrackPort(s),1,[$.gm,$["?"],r(e,U).g2][t[0]-1]),T(e,K,r(e,K)||e.KARAOKE_NONE),console.info(`MIDI reset: ${["GM","Init","GM2"][t[0]-1]}`),t[0]===2&&e.init()}),r(e,ft).add([4,1],(t,s,f)=>{e.invokeSysExIndicator(),T(e,z,((t[1]<<7)+t[0])/16383*100),e.dispatchEvent("mastervolume",r(e,z))}).add([4,3],(t,s,f)=>((t[1]<<7)+t[0]-8192)/8192).add([4,4],(t,s,f)=>t[1]-64).add([4,5],(t,s,f)=>{e.invokeSysExIndicator();let i=t[0],l=t[1],d=t[2],c=3,g=c+(i<<1),u=g+l;if(i!==1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${i})!
`,t);return}let E=0,w=0,A=0;switch(t.subarray(c,g).forEach(R=>{E=E<<7,E|=R}),t.subarray(g,u).forEach((R,I)=>{w|=R<<I*7}),t.subarray(u).forEach((R,I)=>{A|=R<<I*7}),O()&&console.debug(`GM2 global parameter: (${t.subarray(3,g)}; p: ${w}, v: ${A})`),E){case 129:{w===0&&(e.setEffectType(0,52,A),e.pushEffectType(0));break}case 130:{w===0&&(e.setEffectType(1,52,A|16),e.pushEffectType(1));break}default:O()&&console.debug("GM2 global paramater slot path unknown.")}}),r(this,te).add([76,0,0],(t,s,f)=>{switch(t[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset on drum kit ${t[1]}.`);break}case 126:{e.switchMode("xg",!0),e.setPortMode(e.getTrackPort(s),4,$.xg),T(e,K,r(e,K)||e.KARAOKE_NONE),console.info("MIDI reset: XG");break}default:{e.invokeSysExIndicator();let i=[0,0,0,0],l=(d,c)=>{i[c]=d};if(t.subarray(1).forEach((d,c)=>{let g=c+t[0];([l,l,l,l,u=>{T(this,z,u*129/16383*100),e.dispatchEvent("mastervolume",r(e,z))},u=>{},u=>{}][g]||(()=>{}))(d,c)}),t[0]<4){let d=0;i.forEach(c=>{d=d<<4,d+=c}),d-=1024,console.debug(`Master tune: ${d}`)}}}}).add([76,2,1],(t,s,f)=>{e.invokeSysExIndicator();let i="XG ";t[0]<32?(i+="reverb ",t.subarray(1).forEach((l,d)=>{([c=>{e.setEffectTypeRaw(0,!1,c),console.info(`${i}main type: ${Bt[c]}`),e.pushEffectType(0)},c=>{e.setEffectTypeRaw(0,!0,c),console.debug(`${i}sub type: ${c+1}`),e.pushEffectType(0)},c=>{console.debug(`${i}time: ${Ua(c)}s`)},c=>{console.debug(`${i}diffusion: ${c}`)},c=>{console.debug(`${i}initial delay: ${c}`)},c=>{console.debug(`${i}HPF cutoff: ${wt[c]}Hz`)},c=>{console.debug(`${i}LPF cutoff: ${wt[c]}Hz`)},c=>{console.debug(`${i}width: ${c}`)},c=>{console.debug(`${i}height: ${c}`)},c=>{console.debug(`${i}depth: ${c}`)},c=>{console.debug(`${i}wall type: ${c}`)},c=>{console.debug(`${i}dry/wet: ${c}`)},c=>{console.debug(`${i}send: ${ue(c)}dB`)},c=>{console.debug(`${i}pan: ${c-64}`)},!1,!1,c=>{console.debug(`${i}delay: ${c}`)},c=>{console.debug(`${i}density: ${c}`)},c=>{console.debug(`${i}balance: ${c}`)},c=>{},c=>{console.debug(`${i}feedback: ${c}`)},c=>{}][t[0]+d]||function(){console.warn(`Unknown XG reverb address: ${t[0]}.`)})(l)})):t[0]<64?(i+="chorus ",t.subarray(1).forEach((l,d)=>{([c=>{e.setEffectTypeRaw(1,!1,c),console.info(`${i}main type: ${Bt[c]}`),e.pushEffectType(1)},c=>{e.setEffectTypeRaw(1,!0,c),console.debug(`${i}sub type: ${c+1}`),e.pushEffectType(1)},c=>{console.debug(`${i}LFO: ${Oa[c]}Hz`)},c=>{},c=>{console.debug(`${i}feedback: ${c}`)},c=>{console.debug(`${i}delay offset: ${Ba(c)}ms`)},c=>{},c=>{console.debug(`${i}low: ${wt[c]}Hz`)},c=>{console.debug(`${i}low: ${c-64}dB`)},c=>{console.debug(`${i}high: ${wt[c]}Hz`)},c=>{console.debug(`${i}high: ${c-64}dB`)},c=>{console.debug(`${i}dry/wet: ${c}`)},c=>{console.debug(`${i}send: ${ue(c)}dB`)},c=>{console.debug(`${i}pan: ${c-64}`)},c=>{console.debug(`${i}to reverb: ${ue(c)}dB`)},!1,c=>{},c=>{},c=>{},c=>{console.debug(`${i}LFO phase diff: ${(c-64)*3}deg`)},c=>{console.debug(`${i}input mode: ${c?"stereo":"mono"}`)},c=>{}][t[0]-32+d]||function(){console.warn(`Unknown XG chorus address: ${t[0]}.`)})(l)})):t[0]<86?(i+="variation ",t.subarray(1).forEach((l,d)=>{([c=>{e.setEffectTypeRaw(2,!1,c),console.info(`${i}main type: ${Bt[c]}`),e.pushEffectType(2)},c=>{e.setEffectTypeRaw(2,!0,c),console.debug(`${i}sub type: ${c+1}`),e.pushEffectType(2)}][t[0]-64+d]||function(){})(l)})):t[0]<97?(i+="variation ",t.subarray(1).forEach((l,d)=>{[c=>{console.debug(`${i}send: ${ue(c)}dB`)},c=>{console.debug(`${i}pan: ${c-64}`)},c=>{console.debug(`${i}to reverb: ${ue(c)}dB`)},c=>{console.debug(`${i}to chorus: ${ue(c)}dB`)},c=>{e.modelEx.xg.varSys=!!c,console.debug(`${i}connection: ${c?"system":"insertion"}`)},c=>{if(e.modelEx.xg.varSys){console.warn(`${i}effect is applied system-wide. Setting its effective channel to CH${c+1} will not have any effect.`);return}if(c<64){let g=e.chRedir(c,s,!0);e.setXgChEffectSink(g,2),console.debug(`${i}channel: CH${c+1} (CH${g+1})`)}else e.setXgChEffectSink(C.invalidCh,2),console.info(`${i}channel: CH${c+1} (unsupported)`)},c=>{console.debug(`${i}mod wheel: ${c-64}`)},c=>{console.debug(`${i}bend wheel: ${c-64}`)},c=>{console.debug(`${i}channel after touch: ${c-64}`)},c=>{console.debug(`${i}AC1: ${c-64}`)},c=>{console.debug(`${i}AC2: ${c-64}`)}][t[0]-86+d](l)})):t[0]>111&&t[0]<118?i+="variation ":console.warn(`Unknown XG variation address: ${t[0]}`)}).add([76,2,64],(t,s,f)=>{t.subarray(1).forEach((i,l)=>{let d=l+t[0];if(d===0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][i]}`);else{let c=d-1>>2,g=d-1&3,u=`XG EQ ${c} ${["gain","freq","Q","shape"][g]}: `;[()=>{console.debug(`${u}${i-64}dB`)},()=>{console.debug(`${u}${i} (raw)`)},()=>{console.debug(`${u}${i/10}`)},()=>{console.debug(`${u}${["shelf","peak"][+!!i]}`)}][g]()}})}).add([76,3],(t,s,f)=>{e.invokeSysExIndicator();let i=t[0],l=t[1],d=`XG Insertion ${t[0]+1} `;t.subarray(2).forEach((c,g)=>{([()=>{e.setEffectTypeRaw(3+i,!1,c),console.info(`${d}main type: ${Bt[c]}`),e.pushEffectType(3+i)},()=>{e.setEffectTypeRaw(3+i,!0,c),console.debug(`${d}sub type: ${c+1}`),e.pushEffectType(3+i)},!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,()=>{if(c<64){let u=e.chRedir(c,s,!0);e.setXgChEffectSink(u,3+i),console.debug(`${d}channel: CH${c+1} (CH${u+1})`)}else e.setXgChEffectSink(C.invalidCh,3+i),console.info(`${d}channel: CH${c+1} (unsupported)`)}][l+g]||function(){})(c)})}).add([76,6,0],(t,s,f)=>{let i=t[0];i<64?e.setLetterDisplay(t.subarray(1),"XG letter display",i):T(e,Ke,Date.now())}).add([76,7,0],(t,s,f)=>{let i=t[0];T(e,ie,0),T(e,Se,Date.now()+3200),t.subarray(1).forEach(function(d,c){let g=c+i,u=g>>4,E=g&15,w=(E*3+u)*7,A=7,R=0;for(w-=E*5,u===2&&(A=2);R<A;)r(e,He,$t)[w+R]=d>>6-R&1,R++})}).add([76,8],(t,s)=>{e.invokeSysExIndicator();let f=e.chRedir(t[0],s,!0),i=t[1],l=G[f],d=`XG CH${f+1} `,c=`Unknown XG part address ${i}.`,g=!0;t.subarray(2).forEach((u,E)=>{g=!0,i<1?console.debug(c):i<41?([()=>{e.setChCc(f,0,u),e.pushChPrimitives(f)},()=>{e.setChCc(f,32,u),e.pushChPrimitives(f)},()=>{r(e,N)[f]=u,e.pushChPrimitives(f)},()=>{g=!1;let w=e.chRedir(u,s,!0),A=r(e,X)[f];r(e,X)[f]=w,(f!==w||w!==A)&&(e.buildRchTree(),console.info(`${d}receives from CH${w+1}`)),r(e,pe)[f]||(e.copyChSetup(w,f,!0),console.debug(`${d}copied from CH${w+1}.`),e.setChActive(f,1),e.pushChPrimitives(f))},()=>{r(e,ne)[f]=+!u},()=>{},()=>{g=!1,e.setChType(f,u,$.xg),console.debug(`${d}type: ${Nt[u]||u}`),e.pushChPrimitives(f)},()=>{r(e,L)[C.rpn*f+3]=u,r(e,_)[C.rpnt*f+2]=1,e.dispatchEvent("pitch",{part:f,pitch:e.getPitchShift(f)})},!1,!1,()=>{e.setChCc(f,7,u)},!1,!1,()=>{e.setChCc(f,10,u||128)},!1,!1,()=>{e.setChCc(f,128,u),e.allocateAce(f,128)},()=>{e.setChCc(f,93,u)},()=>{e.setChCc(f,91,u)},()=>{e.setChCc(f,94,u)},()=>{e.setChCc(f,76,u)},()=>{e.setChCc(f,77,u)},()=>{e.setChCc(f,78,u)},()=>{e.setChCc(f,74,u)},()=>{e.setChCc(f,71,u)},()=>{e.setChCc(f,73,u)},()=>{e.setChCc(f,75,u)},()=>{e.setChCc(f,72,u)}][i+E-1]||(()=>{}))():i<48?console.debug(c):i<111?i>102&&i<105&&e.setChCc(f,[5,65][i&1],u):i<114?console.debug(c):i<116?console.debug(`${d}EQ ${["bass","treble"][i&1]} gain: ${u-64}dB`):i<118?console.debug(c):i<120?console.debug(`${d}EQ ${["bass","treble"][i&1]} freq: ${u}`):console.debug(c)}),g&&r(e,D)[f]>1&&e.setDrumFirstWrite(f)}).add([76,9],(t,s)=>{let f=e.chRedir(t[0],s,!0),i=t[1],l=G[f],d=`PLG-VL CH${f+1} `;t.subarray(2).forEach((c,g)=>{let u=g+i;switch(u){case 1:{console.info(`${d}breath mode: ${["system","breath","velocity","touch EG"][c]}`);break}case 0:case 27:case 28:break;default:if(u<27){let E=u-3>>1,w=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][E];u&1?u<23?(console.debug(`${d}${w} control source: ${Ha(c)}`),c&&c<96&&e.allocateAce(f,130+E),r(e,st)[C.redir*f+E+2]=c,e.buildRccMap()):console.debug(`${d}${w} scale break point: ${c}`):(console.debug(`${d}${w} depth: ${c-64}`),e.setChCc(f,130+E,c))}}})}).add([76,10],(t,s,f)=>{}).add([76,16],(t,s,f)=>{}).add([76,17,0,0],(t,s,f)=>{}).add([76,112],(t,s,f)=>{if(t[0]>=$e.length){console.error(`Supplied invalid plugin board ID: ${t[0]}`);return}if(t[1]>=$e[t[0]][1]){console.error(`Supplied invalid slot ID for board type "${$e[t[0]][0]}" (${t[0]}): ${t[1]} (#${t[1]+1}))`);return}switch(t[1]>=$e[t[0]][2]?console.warn(`While enabled in Octavia, slot #${t[1]+1} for board type "${$e[t[0]][0]}" (${t[0]}) may not function outside software recreation.`):t[2]>63?console.debug(`XG disable PLG-${$e[t[0]][0]} (${t[0]}) slot #${t[1]+1} as it's set to CH${t[2]+1}.`):console.debug(`XG enable PLG-${$e[t[0]][0]} (${t[0]}) slot #${t[1]+1} for CH${t[2]+1}.`),e.modelEx.yPlg[t[0]][t[1]]=t[2]<64?e.chRedir(t[2],s,!0):C.invalidCh,t[0]){case 0:{r(e,oe)[C.ext*t[2]]=e.EXT_VL;break}case 2:{r(e,oe)[C.ext*t[2]]=e.EXT_DX;break}default:r(e,oe)[C.ext*t[2]]=e.EXT_NONE}}).add([73,0,0],(t,s)=>{let f=t[0],i="MU1000 System - ";t.subarray(1).forEach((l,d)=>{let c=f+d;c===8?console.debug(`${i}LCD contrast: ${l}.`):c===18?(r(e,Z)[$.xg][1]=l?126:0,console.debug(`${i}default bank: ${l?"MU100 Native":"MU Basic"}.`),e.dispatchEvent("banklevel",{mode:"xg",data:+!!l}),e.forceVoiceRefresh()):c>=64&&c<69&&[()=>{e.dispatchEvent("channelactive",l)},()=>{l<8?(e.dispatchEvent("channelmin",l<<4),console.debug(`Octavia System: Minimum CH${(l<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{l<8?(e.dispatchEvent("channelmax",(l<<4)+15),console.debug(`Octavia System: Maximum CH${(l<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{T(e,Le,!!l),console.info(`Octavia System: RS receiving ${["dis","en"][l]}abled.`)}][c-64]()})}).add([73,10,0],(t,s)=>{let f=t[0],i=`MU1000 RS${r(e,Le)?"":" (ignored)"}: `;if(f<16)switch(f){case 2:{let l=e.chRedir(0,s,!0);r(e,Le)&&(e.dispatchEvent("portrange",4),e.dispatchEvent("portstart",l)),console.info(`${i}Show CH${l+1}~CH${l+64}`);break}case 3:{let l=e.chRedir(t[1]<<5,s,!0);r(e,Le)&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",l)),console.info(`${i}Show CH${l+1}~CH${l+32}`);break}default:console.debug(`${i}unknown switch ${f} invoked.`)}else if(f<32){if(r(e,Le)){let l=e.chRedir(f-16+(r(e,At)<<4),s,!0);e.dispatchEvent("channelactive",l)}}else if(f<36){let l=e.chRedir(f-32<<4,s,!0);r(e,Le)&&(e.dispatchEvent("portrange",1),e.dispatchEvent("portstart",l>>4),T(e,At,f-32)),console.info(`${i}Show CH${l+1}~CH${l+16}`)}}).add([73,11,0],(t,s)=>{let f="MU1000 System - channel ",i="Octavia System - channel ",l=t[0];t.subarray(1).forEach((d,c)=>{let g=l+c;([()=>{e.setChActive(d,1),e.dispatchEvent("channelactive",d),O()&&console.debug(`${f}current part: CH${d+1}`)},()=>{d<5?(e.dispatchEvent("portrange",1<<d),console.debug(`${f}port range: ${1<<d} port(s)`)):(e.dispatchEvent("portrange",0),console.debug(`${f}port range: reset`))},()=>{d<16?(e.dispatchEvent("portstart",d),console.debug(`${i}start port: ${"ABCDEFGHIJKLMNOP"[d]}`)):(e.dispatchEvent("portstart",255),console.debug(`${i}start port: reset`))}][g]||(()=>{console.debug(`${f}unknown address: ${g}`)}))()})}).add([93,3],(t,s)=>{let f=e.chRedir(t[0],s,!0),i=`PLG-SG CH${f+1} `,l=Date.now(),d=e.modelEx.sg;if(t[1]===0){let c="",g=0;t.subarray(2).forEach((u,E)=>{E%2===0?c+=Na[u]||u.toString().padStart("0"):g+=u*13}),(l>=d.convLastSyll||d.runLineLen>=d.maxLineLen)&&(e.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),d.splitMask=l<d.convLastSyll,d.runLineLen=0),e.dispatchEvent("metacommit",{type:"SGLyrics",data:`${_a(c)}`,amend:!0,mask:d.splitMask}),d.runLineLen++,d.splitMask=!1,d.convLastSyll=l+Math.ceil(g/2)+r(e,Pt),O()&&console.debug(`${i}vocals: ${c}`)}else console.warn(`Unknown PLG-SG data: ${t}`)}).add([98,96],(t,s,f,i)=>{let l=e.chRedir(t[0],s,!0),d=G[l],c=t[1];t.subarray(2).forEach((g,u)=>{let E=c+u;if(!(E<10)){if(E===10)e.resetAce();else if(E<27){let w=E+131;e.setChCc(l,w,g),!(i!=null&&i.noAce)&&g>0&&g!==64&&e.allocateAce(l,w),e.dispatchEvent("cc",{part:l,cc:w,data:g})}}})}).add([1,20],(t,s,f)=>{f===115?(e.switchMode("doc",!0),e.setPortMode(e.getTrackPort(s),1,$.doc),console.info("MIDI reset: DOC")):console.debug(`Unknown Yamaha SysEx: 67, ${f}, ${t.join(", ")}`)}).add([1,17,15,89],(t,s,f)=>{f===115?(e.setEffectType(0,24,t[0]|16),e.pushEffectType(0)):console.debug(`Unknown Yamaha SysEx: 67, ${f}, ${t.join(", ")}`)}).add([1,24],(t,s,f)=>{if(f===115){for(let i=0;i<16;i++){let l=e.chRedir(i,s,!0);e.setChCc(l,91,127)}console.info("DOC Global Reverb: on")}else console.debug(`Unknown Yamaha SysEx: 67, ${f}, ${t.join(", ")}`)}).add([126,0],(t,s,f)=>{var i,l,d;switch(t[1]){case 0:{e.dispatchEvent("metacommit",{type:"YMCSSect",data:"Disabled",raw:"Intro "}),console.debug("Yamaha Section Control is off.");break}case 127:{e.dispatchEvent("metacommit",{type:"YMCSSect",data:(i=["Intro","Main A","Main B","Fill-in AB","Fill-in BA","Ending","Blank"][t[0]-8])!=null?i:`invalid section ${t[0]}`,raw:(l=["Intro ","Main A","Main B","FillAB","FillBA","Ending","Blank "][t[0]-8])!=null?l:`ID: ${t[0]}`}),console.debug(`Yamaha Section Control switches to "${(d=["intro","main A","main B","fill-in AB","fill-in BA","ending","blank"][t[0]-8])!=null?d:`Invalid section ${t[0]}`}".`);break}default:console.debug(`Unknown YMCS section control: ${t[1]}`)}}).add([126,2],(t,s,f)=>{let i=[];for(let l=0;l<t.length;l+=2){let d=t[l]>>4,c=t[l]&15;if(d<7&&c&&c<8){let g=new Uint8Array(5);g[0]=c-1,g[1]=d-3<<2,g[2]=t[l|1],i.push(g)}}e.dispatchEvent("metacommit",{type:"ChordCtl",src:"ymcs",data:i}),console.debug("YMCS chord data: %o",i)});let n=function(t,s,f,i){},h=function(t,s){e.invokeSysExIndicator();let f=t*C.dpn,i=s[0],l=s[1];s.subarray(2).forEach((d,c)=>{let g=c+l,u=-1;g<16?([()=>{u=24},()=>{u=25},()=>{u=26},()=>{},()=>{u=28},()=>{u=29},()=>{u=30},()=>{u=31},()=>{},()=>{},()=>{},()=>{u=20},()=>{u=21},()=>{u=22},()=>{u=23},()=>{}][g]||(()=>{console.debug(`Unknown XG-style drum param ${g} on set ${t+1}.`)}))():g<32||(g<40?([()=>{u=48},()=>{u=49},!1,!1,()=>{u=52},()=>{u=53}][g-32]||(()=>{console.debug(`Unknown XG-style drum param ${g} on set ${t+1}.`)}))():g<80||([()=>{u=36}][g-80]||(()=>{console.debug(`Unknown XG-style drum param ${g} on set ${t+1}.`)}))()),u>=0?(O()&&console.debug(f,u,i,d),r(e,de)[(f+ye[u])*C.dnc+i]=d):O()&&console.debug(`XG-style drum param ${g} has no writes.`)})},b=function(t,s,f){e.invokeSysExIndicator();let i=t*C.dpn,l=(s<<7)+f[0];f.subarray(1).forEach((d,c)=>{let g=c+l,u=g&127,E=g>>7,w=-1;E>1&&([()=>{w=26},()=>{},()=>{w=28},()=>{w=29},()=>{w=30},()=>{},()=>{},()=>{w=31}][E-2]||(()=>{console.debug(`Unknown GS-style drum param ${E} on set ${t+1}.`)}))(),w>-1?(O()&&console.debug(i,w,u,d),r(e,de)[(i+ye[w])*C.dnc+u]=d):O()&&console.debug(`GS-style drum param ${E} has no writes.`)})};r(this,te).add([76,48],(t,s,f)=>{h(0,t)}).add([76,49],(t,s,f)=>{h(1,t)}).add([76,50],(t,s,f)=>{h(2,t)}).add([76,51],(t,s,f)=>{h(3,t)}).add([76,52],(t,s,f)=>{h(4,t)}).add([76,53],(t,s,f)=>{h(5,t)}).add([76,54],(t,s,f)=>{h(6,t)}).add([76,55],(t,s,f)=>{h(7,t)}),r(this,te).add([89,0],(t,s,f)=>{if(e.eprom){let i=t[0],l=(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);O()&&console.debug(`MU1000 EPROM trail to 0x${l.toString(16).padStart(6,"0")}, ${i} bytes.`);let d=e.eprom.data;t.subarray(4).forEach((c,g)=>{let u=g>>3,E=g&7;if(E===7)for(let w=0;w<7;w++)d[l+7*u+w]+=(c>>6-w&1)<<7;else d[l+7*u+E]=c})}}).add([89,1],(t,s,f)=>{let i=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3];O()&&console.debug(`MU1000 EPROM jump to 0x${i.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=i)}).add([89,2],(t,s,f)=>{if(e.eprom){let i=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);O()&&console.debug(`MU1000 EPROM write to 0x${i.toString(16).padStart(6,"0")}.`);let l=e.eprom.data;t.subarray(4).forEach((d,c)=>{let g=c>>3,u=c&7;if(u===7)for(let E=0;E<7;E++)l[i+7*g+E]+=(d>>6-E&1)<<7;else l[i+7*g+u]=d})}}).add([89,3],(t,s,f)=>{}),r(this,te).add([39,48],(t,s,f)=>{}).add([43,0,0],(t,s,f)=>{e.invokeSysExIndicator();let i=[0,0,0,0],l=(d,c)=>{i[c]=d};if(t.subarray(1).forEach((d,c)=>{let g=c+t[0];[l,l,l,l,()=>{T(this,z,d*129/16383*100),e.dispatchEvent("mastervolume",r(e,z))},()=>d-64,()=>d||128,()=>d,()=>d,()=>{console.debug(`TG300 variation on cc${d}.`)}][g](d,g)}),t[0]<4){let d=0;i.forEach(c=>{d=d<<4,d+=c}),d-=1024,console.debug(`Master tune: ${d}`)}}).add([43,1,0],(t,s,f)=>{e.invokeSysExIndicator()}).add([43,2],(t,s,f)=>{e.invokeSysExIndicator();let i=e.chRedir(t[0],s,!0),l=t[1],d=G[i],c=`TG300 CH${i+1} `;t.subarray(2).forEach((g,u)=>{u<5?([()=>{},()=>{e.setChCc(i,0,g),e.pushChPrimitives(i)},()=>{e.setChCc(i,32,g),e.pushChPrimitives(i)},()=>{r(e,N)[i]=g,e.pushChPrimitives(i)},()=>{let E=e.chRedir(g,s,!0),w=r(e,X)[i];r(e,X)[i]=E,(i!==E||E!==w)&&(e.buildRchTree(),console.info(`${c}receives from CH${E+1}`))}][u+l]||(()=>{}))(g,u+l):u<21||(u<47?([()=>{r(e,ne)[i]=+!g},()=>{},()=>{},()=>{r(e,L)[C.rpn*i+3]=g,r(e,_)[C.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{},()=>{e.setChCc(i,7,g)},!1,!1,()=>{e.setChCc(i,10,g||128)},!1,!1,()=>{console.debug(`${c} AC1 at cc${g}`)},()=>{console.debug(`${c} AC2 at cc${g}`)},()=>{r(e,v)[d+S[128]]=g,e.allocateAce(i,128)},()=>{r(e,v)[d+S[93]]=g},()=>{r(e,v)[d+S[91]]=g},()=>{r(e,v)[d+S[94]]=g},()=>{r(e,v)[d+S[76]]=g},()=>{r(e,v)[d+S[77]]=g},()=>{r(e,v)[d+S[74]]=g},()=>{r(e,v)[d+S[71]]=g},()=>{r(e,v)[d+S[73]]=g},()=>{r(e,v)[d+S[75]]=g},()=>{r(e,v)[d+S[72]]=g},()=>{r(e,v)[d+S[78]]=g}][u+l-21]||(()=>{}))(g,u+l):u<95||([()=>{r(e,v)[d+S[65]]=g},()=>{r(e,v)[d+S[5]]=g}][u+l-95]||(()=>{}))(g,u+l))})}).add([43,7,0],(t,s,f)=>{let i=t[0];e.setLetterDisplay(t.subarray(1),"TG300 letter display",i)}).add([43,7,1],(t,s,f)=>{T(e,ie,0),T(e,Se,Date.now()+3200),t.forEach(function(i,l){let d=l>>4,c=l&15,g=(c*3+d)*7,u=7,E=0;for(g-=c*5,d===2&&(u=2);E<u;)r(e,He,$t)[g+E]=i>>6-E&1,E++})}),r(this,Ee).add([66,18,0,0,127],(t,s,f)=>{e.switchMode("sc",!0),e.setPortMode(e.getTrackPort(s),2,$.sc),T(e,K,e.KARAOKE_NONE),r(e,_e).fill(0),console.info(`GS system to ${["single","dual"][t[0]]} mode.`)}).add([66,18,64,0],(t,s,f)=>{switch(t[0]){case 127:{e.switchMode("gs",!0),e.setPortMode(e.getTrackPort(s),4,$.gs),T(e,K,e.KARAOKE_NONE),r(e,_e).fill(0),console.info("MIDI reset: GS");break}default:{e.invokeSysExIndicator();let i=[0,0,0,0],l=(d,c)=>{i[c]=d};if(t.subarray(1).forEach((d,c)=>{let g=c+t[0];[l,l,l,l,u=>{T(this,z,u*129/16383*100),e.dispatchEvent("mastervolume",r(e,z))},u=>{},u=>{}][g](d,c)}),t[0]<4){let d=0;i.forEach(c=>{d=d<<4,d+=c}),d-=1024,console.debug(`Master tune: ${d}`)}}}}).add([66,18,64,1],(t,s,f)=>{e.invokeSysExIndicator();let i=t[0];if(i<16){let l="".padStart(i," ");t.subarray(1).forEach((d,c)=>{l+=String.fromCharCode(Math.max(32,d))}),l=l.padEnd(16," "),console.debug(`GS patch name: ${l}`)}else i<48||(i<65?t.subarray(1).forEach((l,d)=>{let c=`GS ${i+d>55?"chorus":"reverb"} `;([()=>{console.info(`${c}type: ${la[l]}`),e.setEffectType(0,40,l),e.pushEffectType(0)},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${c}predelay: ${l}ms`)},()=>{console.info(`${c}type: ${Va[l]}`),e.setEffectType(1,40,16+l),e.pushEffectType(1)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${c}to reverb: ${ue(l)}`)},()=>{console.debug(`${c}to delay: ${ue(l)}`)}][i+d-48]||(()=>{}))()}):i<80?console.debug(`Unknown GS patch address: ${i}`):i<91?t.subarray(1).forEach((l,d)=>{let c="GS delay ";([()=>{console.info(`${c}type: ${Fa[l]}`),e.setEffectType(2,40,32+l),e.pushEffectType(2)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${c}to reverb: ${ue(l)}`)}][i+d-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${i}`))}).add([66,18,64,2],(t,s,f)=>{let i="GS EQ ";t.subarray(1).forEach((l,d)=>{([()=>{console.debug(`${i}low freq: ${[200,400][l]}Hz`)},()=>{console.debug(`${i}low gain: ${l-64}dB`)},()=>{console.debug(`${i}high freq: ${[3e3,6e3][l]}Hz`)},()=>{console.debug(`${i}high gain: ${l-64}dB`)}][t[0]+d]||function(){console.warn(`Unknown GS EQ address: ${t[0]+d}`)})()})}).add([66,18,64,3],(t,s,f)=>{e.invokeSysExIndicator();let i="GS EFX ",l=function(d,c){let g=Ka(r(e,ge).subarray(10,12),c,d);g&&console.debug(`${i}${da(r(e,ge).subarray(10,12))} ${g}`)};t.subarray(1).forEach((d,c)=>{([()=>{e.setEffectTypeRaw(3,!1,32+d),e.pushEffectType(3)},()=>{e.setEffectTypeRaw(3,!0,d),console.info(`${i}type: ${da(r(e,ge).subarray(10,12))}`),e.pushEffectType(3)},!1,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,()=>{console.debug(`${i}to reverb: ${ue(d)}dB`)},()=>{console.debug(`${i}to chorus: ${ue(d)}dB`)},()=>{console.debug(`${i}to delay: ${ue(d)}dB`)},!1,()=>{console.debug(`${i}1 source: ${d}`),d&&d<96&&e.allocateAceAll(d)},()=>{console.debug(`${i}1 depth: ${d-64}`)},()=>{console.debug(`${i}2 source: ${d}`),d&&d<96&&e.allocateAceAll(d)},()=>{console.debug(`${i}2 depth: ${d-64}`)},()=>{console.debug(`${i}to EQ: ${d?"ON":"OFF"}`)}][t[0]+c]||function(g,u){console.warn(`Unknown GS EFX address: ${u}`)})(d,t[0]+c)})}).add([66,18,65],(t,s,f)=>{b((t[0]>>4)+1<<1,t[0]&15,t.subarray(1))}).add([66,18,72],(t,s,f)=>{let i=(t[0]&127)<<7|t[1]&127;console.debug(i,Wa(t.subarray(2)))}).add([69,18,16],(t,s,f)=>{var i;switch(t[0]){case 0:{let l=t[1];e.setLetterDisplay(t.subarray(2),"GS display text",l);break}case 8:{let l=t[1],d=e.modelEx.sc;t.subarray(2).forEach((c,g)=>{([()=>{d.showBar=!(c&1),d.invBar=c>>1&1,d.invDisp=c>>2&1},()=>{d.peakHold=c<4?c:1}][g+l]||(()=>{console.debug("Unsupported GS display type SysEx.")}))()});break}case 32:{T(e,Se,Date.now()+3200),t[1]===0&&(t[2]?(T(e,ie,Math.max(Math.min(t[2]-1,9),0)),O()&&console.debug(`GS switch display page ${t[2]-1}.`)):(T(e,ie,0),T(e,Se,Date.now()),O()&&console.debug("GS disable display page.")));break}default:if(t[0]<6){r(e,ie)>9&&T(e,ie,0);let l=t[0]-1<<1|t[1]>>6;r(e,ie)===l&&T(e,Se,Date.now()+3200),(i=r(e,xe)[l])!=null&&i.length||(r(e,xe)[l]=new Uint8Array(256));let d=r(e,xe)[l];O()&&console.debug(`GS frame draw page ${l}.`);let c=t[1]&63;t.subarray(2).forEach(function(u,E){let w=E+c,A=w>>4,R=w&15,I=(R*4+A)*5,re=5,Y=0;for(I-=R*4,A===3&&(re=1);Y<re;)d[I+Y]=u>>4-Y&1,Y++})}else console.warn(`Unknown GS display section: ${t[0]}`)}}).add([69,18,32],(t,s,f)=>{let i=t[0],l=t[1],d=t.subarray(2);if(i>>4){console.warn(`SC-8850 partial screen dump out of bounds: invalid bundle.
`,t);return}let c=l+d.length,g=l*6-(l*2428>>16<<1),u=c*6-(c*2428>>16<<1);if(g>640){console.warn(`SC-8850 partial screen dump out of bounds: invalid buffer range.
`,t);return}u>640&&(console.info(`SC-8850 partial screen dump out of bounds: invalid buffer end, automatically restricted.
`,t),u=640);let E=new Uint8Array(u-g);d.forEach((R,I)=>{let re=I+l,Y=(re*2428&65535)*27>>16===26,sa=re*6-(re*2428>>16<<1),Wt=Y?2:0;for(;Wt<6;)E[sa+(5-Wt)]=R>>Wt&1,Wt++});let w=i*108+l,A=w*6-(w*2428>>16<<1);e.dispatchEvent("screen",{type:"sc8850",offset:A,data:E}),O()&&console.debug(`SC-8850 screen dump: bundle ${i+1}, range ${g}~${u}`)});let m=function(t,s,f){e.invokeSysExIndicator();let i=t[0],l=G[s],d=kt[s],c=`GS CH${s+1} `;i<3?(t.subarray(1).forEach((g,u)=>{[()=>{r(e,v)[l+S[0]]=g,e.pushChPrimitives(s)},()=>{r(e,N)[s]=g},()=>{let E=0;g<16?E=e.chRedir(g,f,!0):E=C.ch;let w=r(e,X)[s];r(e,X)[s]=E,(s!==E||E!==w)&&(e.buildRchTree(),console.info(`${c}receives from CH${E+1}`))}][i+u]()}),e.pushChPrimitives(s)):i<19||(i<44?t.subarray(1).forEach((g,u)=>{([()=>{r(e,ne)[s]=+!g},!1,()=>{e.setChType(s,g<<1,$.gs),console.debug(`${c}type: ${g?"drum ":"melodic"}${g||""}`)},()=>{r(e,L)[d+3]=g,r(e,_)[C.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},!1,()=>{r(e,v)[l+S[7]]=g},!1,!1,()=>{r(e,v)[l+S[10]]=g||128},!1,!1,()=>{console.debug(`${c}CC 1: cc${g}`)},()=>{console.debug(`${c}CC 2: cc${g}`)},()=>{r(e,v)[l+S[93]]=g},()=>{r(e,v)[l+S[91]]=g},!1,!1,()=>{r(e,L)[d+1]=g,r(e,_)[C.rpnt*s+1]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{r(e,L)[d+2]=g,r(e,_)[C.rpnt*s+1]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{r(e,v)[l+S[94]]=g}][i+u-19]||(()=>{}))()}):i<76||console.debug(`Unknown GS part address: ${i}`))},y=function(t,s){let f=t[0],i=`GS CH${s+1} `;f<2?t.subarray(1).forEach((l,d)=>{[()=>{e.setChCc(s,32,l)},()=>{}][f+d]()}):f<32?console.warn(`Unknown GS misc address: ${f}`):f<35?t.subarray(1).forEach((l,d)=>{[()=>{console.debug(`${i}EQ: o${["ff","n"][l]}`)},()=>{},()=>{console.debug(`${i}EFX: o${["ff","n"][l]}`),e.setChEffectSink(s,l?3:0)}][f+d-32]()}):console.warn(`Unknown GS misc address: ${f}`)};r(this,Ee).add([66,18,64,16],(t,s)=>{m(t,e.chRedir(9,s,!0),s)}).add([66,18,64,17],(t,s)=>{m(t,e.chRedir(0,s,!0),s)}).add([66,18,64,18],(t,s)=>{m(t,e.chRedir(1,s,!0),s)}).add([66,18,64,19],(t,s)=>{m(t,e.chRedir(2,s,!0),s)}).add([66,18,64,20],(t,s)=>{m(t,e.chRedir(3,s,!0),s)}).add([66,18,64,21],(t,s)=>{m(t,e.chRedir(4,s,!0),s)}).add([66,18,64,22],(t,s)=>{m(t,e.chRedir(5,s,!0),s)}).add([66,18,64,23],(t,s)=>{m(t,e.chRedir(6,s,!0),s)}).add([66,18,64,24],(t,s)=>{m(t,e.chRedir(7,s,!0),s)}).add([66,18,64,25],(t,s)=>{m(t,e.chRedir(8,s,!0),s)}).add([66,18,64,26],(t,s)=>{m(t,e.chRedir(10,s,!0),s)}).add([66,18,64,27],(t,s)=>{m(t,e.chRedir(11,s,!0),s)}).add([66,18,64,28],(t,s)=>{m(t,e.chRedir(12,s,!0),s)}).add([66,18,64,29],(t,s)=>{m(t,e.chRedir(13,s,!0),s)}).add([66,18,64,30],(t,s)=>{m(t,e.chRedir(14,s,!0),s)}).add([66,18,64,31],(t,s)=>{m(t,e.chRedir(15,s,!0),s)}).add([66,18,64,64],(t,s)=>{y(t,e.chRedir(9,s,!0))}).add([66,18,64,65],(t,s)=>{y(t,e.chRedir(0,s,!0))}).add([66,18,64,66],(t,s)=>{y(t,e.chRedir(1,s,!0))}).add([66,18,64,67],(t,s)=>{y(t,e.chRedir(2,s,!0))}).add([66,18,64,68],(t,s)=>{y(t,e.chRedir(3,s,!0))}).add([66,18,64,69],(t,s)=>{y(t,e.chRedir(4,s,!0))}).add([66,18,64,70],(t,s)=>{y(t,e.chRedir(5,s,!0))}).add([66,18,64,71],(t,s)=>{y(t,e.chRedir(6,s,!0))}).add([66,18,64,72],(t,s)=>{y(t,e.chRedir(7,s,!0))}).add([66,18,64,73],(t,s)=>{y(t,e.chRedir(8,s,!0))}).add([66,18,64,74],(t,s)=>{y(t,e.chRedir(10,s,!0))}).add([66,18,64,75],(t,s)=>{y(t,e.chRedir(11,s,!0))}).add([66,18,64,76],(t,s)=>{y(t,e.chRedir(12,s,!0))}).add([66,18,64,77],(t,s)=>{y(t,e.chRedir(13,s,!0))}).add([66,18,64,78],(t,s)=>{y(t,e.chRedir(14,s,!0))}).add([66,18,64,79],(t,s)=>{y(t,e.chRedir(15,s,!0))}),r(this,Pe).add([54,65],(t,s)=>{let f=r(e,U).x5===81?"05rw":"x5d";e.switchMode(f,!0),e.setPortMode(e.getTrackPort(s),1,$[f]);let i=t[t.length-1],l=t.subarray(0,t.length-1),d=et(l);d!==i&&(console.info(`X5D multi parameters checksum mismatch! Expected ${d}, got ${i}.`),console.debug(t));let c=(t[1]<<7)+t[0],g=(t[3]<<7)+t[2],u=e.chRedir(c&15,s,!0),E=G[u];[()=>{g<1||(g<101?(e.setChType(u,e.CH_MELODIC,$.x5d),r(e,N)[u]=g-1,r(e,v)[E+S[0]]=r(e,U).x5):g<229?(e.setChType(u,e.CH_MELODIC,$.x5d),r(e,N)[u]=g-101,r(e,v)[E+S[0]]=56):(e.setChType(u,e.CH_DRUMS,$.x5d),r(e,N)[u]=er[g-229]||0,r(e,v)[E+S[0]]=62)),e.pushChPrimitives(u)},()=>{r(e,v)[E+S[7]]=g},()=>{g<31&&(r(e,v)[E+S[10]]=Math.round((g-15)*4.2+64))},()=>{r(e,v)[E+S[93]]=_t(g)},()=>{r(e,v)[E+S[91]]=_t(g)},()=>{r(e,L)[u*C.rpn+3]=g>8191?g-16320:64+g,r(e,_)[C.rpnt*u+2]=1,e.dispatchEvent("pitch",{part:u,pitch:e.getPitchShift(u)})},()=>{r(e,L)[u*C.rpn+1]=g>8191?g-16320:64+g,r(e,_)[C.rpnt*u+1]=1,e.dispatchEvent("pitch",{part:u,pitch:e.getPitchShift(u)})},()=>{g>0&&(r(e,L)[u*C.rpn]=g,r(e,_)[C.rpnt*u]=1,e.dispatchEvent("pitch",{part:u,pitch:e.getPitchShift(u)}))},()=>{}][c>>4]()}).add([54,76,0],(t,s)=>{e.invokeSysExIndicator();let f=r(e,U).x5===81?"05rw":"x5d";e.switchMode(f),e.setPortMode(e.getTrackPort(s),1,$[f]);let i="",l=r(e,U).x5,d=0,c=0,g="MSB\tPRG\tLSB\tNME";ve(t,function(u,E){if(E<16400){let w=E%164;switch(!0){case w<10:{u>31&&(i+=String.fromCharCode(u));break}case w===10:break;case w===11:{g+=`
${l}	${d}	${c}	${i.trim().replace("Init Voice","")}`,d++,i="";break}}d>99&&(l=90,d=0)}}),e.userBank.clearRange({msb:r(e,U).x5,prg:[0,99],lsb:0}),e.userBank.load(g),O()&&console.debug(g),e.forceVoiceRefresh()}).add([54,77,0],(t,s)=>{e.invokeSysExIndicator();let f=r(e,U).x5===81?"05rw":"x5d";e.switchMode(f),e.setPortMode(e.getTrackPort(s),1,$[f]);let i="",l=90,d=0,c=0,g="MSB\tPRG\tLSB\tNME";ve(t,function(u,E){if(E<13600){let w=E%136;switch(!0){case w<10:{u>31&&(i+=String.fromCharCode(u));break}case w===11:{g+=`
${l}	${d}	${c}	${i.trim().replace("Init Combi","")}`,d++,i="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(g),O()&&console.debug(g),e.forceVoiceRefresh()}).add([54,78],(t,s)=>{let f=r(e,U).x5===81?"05rw":"x5d";e.switchMode(f),e.setPortMode(e.getTrackPort(s),1,$[f]),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][t[0]]} mode.`)}).add([54,85],(t,s)=>{e.invokeSysExIndicator();let f=r(e,U).x5===81?"05rw":"x5d";e.switchMode(f),e.setPortMode(e.getTrackPort(s),1,$[f]),ve(t,(i,l)=>{l>0&&l<3&&(e.setEffectType(l-1,44,i),e.pushEffectType(l-1))})}).add([54,104],(t,s)=>{e.invokeSysExIndicator();let f=r(e,U).x5===81?"05rw":"x5d";e.switchMode(f,!0);let i=e.getTrackPort(s);if(r(e,q)[i]&&r(e,q)[i]!==$[f])if(r(e,De).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${s}. Port ${String.fromCharCode(65+i)} mode "${W[r(e,q)[i]]}" mismatch, should be "${f}".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);e.setPortMode(i,1,$[f]),ve(t,function(l,d,c,g){if(d<192){let u=e.chRedir(Math.floor(d/12),s,!0),E=G[u];switch(d%12){case 0:{l<128?(e.setChType(u,e.CH_MELODIC,$.x5d),r(e,v)[E+S[0]]=r(e,U).x5,r(e,N)[u]=l):(e.setChType(u,e.CH_DRUMS,$.x5d),r(e,v)[E+S[0]]=62,r(e,N)[u]=er[l-128]),l>0&&e.setChActive(u,1),e.pushChPrimitives(u);break}case 1:{r(e,v)[E+S[7]]=l;break}case 2:{r(e,L)[u*C.rpn+3]=l>127?l-192:64+l,r(e,_)[C.rpnt*u+2]=1,e.dispatchEvent("pitch",{part:u,pitch:e.getPitchShift(u)});break}case 3:{r(e,L)[u*C.rpn+1]=l>127?l-192:64+l,r(e,_)[C.rpnt*u+1]=1,e.dispatchEvent("pitch",{part:u,pitch:e.getPitchShift(u)});break}case 4:{l<31&&(r(e,v)[E+S[10]]=Math.round((l-15)*4.2+64));break}case 5:{let w=l>>4,A=l&15;r(e,v)[E+S[91]]=_t(A),r(e,v)[E+S[93]]=_t(w);break}case 10:{r(e,D)[u]||(r(e,v)[E+S[0]]=l>>6?56:r(e,U).x5,e.pushChPrimitives(u));break}case 11:{let w=e.chRedir(l&15,s,!0),A=l>>4;r(e,X)[u]=l,(w!==u||A)&&console.info(`X5D Part CH${u+1} receives from CH${w+1}.`)}}}else{let u=e.chRedir(d-192,s,!0)}}),e.buildRchTree()}),r(this,Ee).add([22,18,127],(t,s,f)=>{e.switchMode("mt32",!0),e.setPortMode(e.getTrackPort(s),1,$.mt32),T(e,K,e.KARAOKE_NONE),e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(t,s,f)=>{e.switchMode("mt32");let i=e.chRedir(f,s,!0),l=t[1];t.subarray(2).forEach((d,c)=>{let g=c+l;r(e,Xe)[g+(i-1)*16]=d,([!1,()=>{let u=r(e,Xe)[i-1<<4];if(u<3){if(r(e,me)[i]=1,u===2)for(let E=0;E<name.length;E++)r(e,Me)[(i-1)*C.cmt+E]=r(e,Ve)[d*C.cmt+E];else{let E=e.baseBank.get(0,d+(u<<6),127,"mt32").name;for(let w=0;w<E.length;w++)r(e,Me)[(i-1)*C.cmt+w]=E.charCodeAt(w)}e.pushChPrimitives(i)}},()=>{r(e,L)[i*C.rpn+3]=d+40,r(e,_)[C.rpnt*i+2]=1},()=>{r(e,L)[i*C.rpn+1]=d+14,r(e,_)[C.rpnt*i+1]=1},()=>{r(e,L)[i*C.rpn]=d,r(e,_)[C.rpnt*i]=1},!1,()=>{e.setChCc(i,91,d?127:0)},!1,()=>{e.setChCc(i,7,d)},()=>{e.setChCc(i,10,Math.ceil(d*9.05))}][g]||(()=>{}))()})}).add([22,18,1],(t,s,f)=>{e.switchMode("mt32");let i=f&7;console.debug(`MT-32 slot #${f+1} Drum: ${t}`);let l=t[0]<<7|t[1];t.subarray(2).forEach((d,c)=>{let g=c+l,u=(g>>2)+24,E=g&3,w=i*C.dpn;if(O()&&console.debug(`MT-32 temp drum note ${u} param ${E}: ${d}`),u<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${u}`);return}[()=>{},()=>{r(e,de)[(w+ye[26])*C.dnc+u]=Math.round(d*1.27)},()=>{r(e,de)[(w+ye[26])*C.dnc+u]=d*9+1&127},()=>{r(e,de)[(w+ye[26])*C.dnc+u]=d?127:0}][E]()})}).add([22,18,2],(t,s,f)=>{e.switchMode("mt32");let i=e.chRedir(f,s,!0),l=t[1]+(t[0]<<7);l<10&&(r(e,me)[i]=1),t.subarray(2).forEach((d,c)=>{let g=c+l;g<14&&(r(e,Me)[(i-1)*C.cmt+g]=d)}),e.pushChPrimitives(i)}).add([22,18,3],(t,s,f)=>{e.switchMode("mt32");let i=f&7;if(t[0]){let l=(t[0]-1<<7)+t[1]-16;t.subarray(2).forEach((d,c)=>{let g=c+l,u=(g>>2)+24,E=g&3,w=i*C.dpn;if(O()&&console.debug(`MT-32 dev drum note ${u} param ${E}: ${d}`),u<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${u}`);return}[()=>{},()=>{r(e,de)[(w+ye[26])*C.dnc+u]=Math.round(d*1.27)},()=>{r(e,de)[(w+ye[26])*C.dnc+u]=d*9+1&127},()=>{r(e,de)[(w+ye[26])*C.dnc+u]=d?127:0}][E]()})}else{let l=t[1];t.subarray(2).forEach((d,c)=>{let g=c+l;r(e,Xe)[g]=d;let u=e.chRedir(1+(g>>4),s,!0),E=g&15;([!1,()=>{let w=r(e,Xe)[u-1<<4];if(w<3)if(r(e,me)[u]=1,w===2)for(let A=0;A<name.length;A++)r(e,Me)[(u-1)*C.cmt+A]=r(e,Ve)[d*C.cmt+A];else{let A=e.baseBank.get(0,d+(w<<6),127,"mt32").name;for(let R=0;R<A.length;R++)r(e,Me)[(u-1)*C.cmt+R]=A.charCodeAt(R)}e.pushChPrimitives(u)},()=>{r(e,L)[u*C.rpn+3]=d+40,r(e,_)[C.rpnt*u+2]=1},()=>{r(e,L)[u*C.rpn+1]=d+14,r(e,_)[C.rpnt*u+1]=1},()=>{r(e,L)[u*C.rpn]=d,r(e,_)[C.rpnt*u]=1},!1,()=>{e.setChCc(u,91,d?127:0)},!1,()=>{e.setChCc(u,7,d)},()=>{e.setChCc(u,10,Math.ceil(d*9.05))}][E]||(()=>{}))()})}}).add([22,18,4],(t,s,f)=>{e.switchMode("mt32");let i=t[1]+(t[0]<<7),l=[];t.subarray(2).forEach((d,c)=>{let g=c+i,u=e.chRedir(Math.floor(g/246+1),s,!0),E=g%246;E<14&&(r(e,Me)[(u-1)*C.cmt+E]=d),E<10&&(r(e,me)[u]=1),l.indexOf(u)<0&&l.push(u)}),l.forEach(d=>{e.pushChPrimitives(d)})}).add([22,18,5],(t,s,f)=>{e.switchMode("mt32");let i=(t[0]<<7)+t[1];t.subarray(2).forEach((l,d)=>{let c=i+d,g=Math.floor(c/8),u=c&7,E=g*8;r(e,Mt)[c]=l,([!1,()=>{let w=r(e,Mt)[E];if(w<3){let A="";if(w===2){let I=C.cmt*g;A=`MT-m:${l.toString().padStart(3,"0")}`}else A=e.baseBank.get(0,l+(w<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:g});let R=`MSB	LSB	PRG	NME
49	127	${g}	${A}`;e.userBank.load(R,!0)}}][u]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(t,s,f)=>{e.switchMode("mt32");let i=((t[0]&1)<<7)+t[1],l=t[0]>>1,d=!1;if(t.subarray(2).forEach((c,g)=>{let u=i+g;u<C.cmt&&(r(e,Ve)[l*C.cmt+u]=c,d=!0)}),d){e.userBank.clearRange({msb:0,lsb:127,prg:l});let c=`MSB	LSB	PRG	NME
49	127	${l}	MT-m:${l}`;e.userBank.load(c,!0)}e.forceVoiceRefresh()}).add([22,18,16],(t,s,f)=>{e.switchMode("mt32");let i=t[1],l=!1,d=function(c,g){r(e,X)[g-12]=c,l=!0};t.subarray(2).forEach((c,g)=>{let u=g+i;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,d,d,d,d,d,d,d,d,d,()=>{T(e,z,c),e.dispatchEvent("mastervolume",r(e,z))}][u]||(()=>{}))(c,g)}),l&&e.buildRchTree()}).add([22,18,32],(t,s,f)=>{e.switchMode("mt32");let i=t[1],l=" ".repeat(i);t.subarray(2).forEach(d=>{d>31?l+=String.fromCharCode(d):l+=" "}),T(e,Fe,l.padStart(20," ")),T(e,Ke,Date.now()+3200)}).add([22,18,82],(t,s)=>{let f=e.chRedir(0,s,!0);for(let i=0;i<16;i++)r(e,ee).ano(f+i),i&&i<10&&(r(e,N)[f+i]=fa[i-1]);console.info("MT-32 alt reset complete.")}),r(this,Pe).add([66,0],(t,s)=>{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(s),2,$.ns5r),T(e,K,e.KARAOKE_NONE),console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][t[0]]} mode.`)}).add([66,1],(t,s)=>{let f=["ns5r","05rw"][t[0]];e.switchMode(f,!0),e.setPortMode(e.getTrackPort(s),2,$[f]),T(e,K,e.KARAOKE_NONE)}).add([66,18,0,0],(t,s)=>{let f=t[0];switch(f){case 124:case 126:case 127:{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(s),2,$.ns5r),T(e,K,e.KARAOKE_NONE);break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset on drum kit ${t[1]}.`);break}default:if(f<10){let i=[0,0,0,0],l=(d,c)=>{i[c]=d};if(t.subarray(1).forEach((d,c)=>{[l,l,l,l,()=>{T(e,z,d*129/16383*100),e.dispatchEvent("mastervolume",r(e,z))},()=>d-64,()=>d-64,()=>{},()=>{},()=>{}][f+c]()}),t[0]<4){let d=0;i.forEach(c=>{d=d<<4,d+=c}),d-=1024,console.debug(`Master tune: ${d}`)}}}}).add([66,18,0,1],(t,s)=>{}).add([66,18,0,2],(t,s)=>{}).add([66,18,1],(t,s)=>{e.invokeSysExIndicator();let f=e.chRedir(t[0],s,!0),i=G[f],l=t[1],d=`NS5R CH${f+1} `;t.subarray(2).forEach((c,g)=>{let u=l+g;u<3?([()=>{r(e,v)[i+S[0]]=c||Ae.bank0,e.pushChPrimitives(f)},()=>{r(e,v)[i+S[32]]=c,e.pushChPrimitives(f)},()=>{r(e,N)[f]=c}][u](),e.pushChPrimitives(f)):u<8||(u<14?[()=>{let E=e.chRedir(c,s,!0),w=r(e,X)[f];r(e,X)[f]=E,(f!==E||E!==w)&&(e.buildRchTree(),console.info(`${d}receives from CH${E+1}`))},()=>{r(e,ne)[f]=+!c},()=>{e.setChType(f,c,$.ns5r),console.debug(`${d}type: ${Nt[c]}`)},()=>{r(e,L)[C.rpn*f+3]=c,r(e,_)[C.rpnt*f+2]=1,e.dispatchEvent("pitch",{part:f,pitch:e.getPitchShift(f)})},()=>{},()=>{}][u-8]():u<16||(u<33?[()=>{r(e,v)[i+S[7]]=c},()=>{r(e,v)[i+S[11]]=c},()=>{},()=>{},()=>{r(e,v)[i+S[10]]=c||128},()=>{},()=>{},()=>{r(e,v)[i+S[93]]=c},()=>{r(e,v)[i+S[91]]=c},()=>{r(e,v)[i+S[76]]=c},()=>{r(e,v)[i+S[77]]=c},()=>{r(e,v)[i+S[78]]=c},()=>{r(e,v)[i+S[74]]=c},()=>{r(e,v)[i+S[71]]=c},()=>{r(e,v)[i+S[73]]=c},()=>{r(e,v)[i+S[75]]=c},()=>{r(e,v)[i+S[72]]=c}][u-16]():u<112||u<114&&[()=>{r(e,v)[i+S[5]]=c},()=>{r(e,v)[i+S[65]]=c}][u-112]()))})}).add([66,18,8,0],(t,s)=>{let f=t[0];if(f<32)e.setLetterDisplay(t.subarray(1,33),"NS5R letter display");else{let i=f-32;T(e,Se,Date.now()+3200),T(e,ie,10);let l=t.subarray(1),d=4;l.forEach(function(c,g){let u=g+i,E=u>>4,w=u&15;if(u<80){let A=E<d?c:c>>3,R=0,I=E<d?6:3;for(;A>0;)r(e,He,$t)[w*32+E*7+(I-R)]=A&1,A=A>>1,R++}})}}).add([66,18,48],(t,s,f)=>{h(0,t)}).add([66,18,49],(t,s,f)=>{h(1,t)}).add([66,18,50],(t,s,f)=>{h(2,t)}).add([66,18,51],(t,s,f)=>{h(3,t)}).add([66,18,52],(t,s,f)=>{h(4,t)}).add([66,18,53],(t,s,f)=>{h(5,t)}).add([66,18,54],(t,s,f)=>{h(6,t)}).add([66,18,55],(t,s,f)=>{h(7,t)}).add([66,52],(t,s)=>{e.switchMode("ns5r"),T(e,K,e.KARAOKE_NONE);let f="";ve(t,(i,l)=>{l<8?(i>31&&(f+=String.fromCharCode(i)),l===7&&(e.aiEfxName=f)):l<10&&(e.setEffectType(l-8,44,i),e.pushEffectType(l-8))})}).add([66,53],(t,s)=>{e.invokeSysExIndicator(),e.switchMode("ns5r"),T(e,K,e.KARAOKE_NONE);let f="",i=t[t.length-1],l=t.subarray(0,t.length-1),d=et(l);d!==i&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${d}, got ${i}.`),console.debug(t));let c=e.getTrackPort(s);if(r(e,q)[c]&&r(e,q)[c]!==$.ns5r)if(r(e,De).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${s}. Port ${String.fromCharCode(65+c)} mode "${W[r(e,q)[c]]}" mismatch, should be "ns5r".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+c)}.`);e.setPortMode(c,2,$.ns5r),ve(l,function(g,u){switch(!0){case u<2944:{let E=e.chRedir(Math.floor(u/92),s,!0),w=G[E];switch(u%92){case 0:{r(e,v)[w+S[0]]=g,e.pushChPrimitives(E),e.pushChPrimitives(E);break}case 1:{r(e,v)[w+S[32]]=g,!g&&!r(e,v)[w+S[0]]&&(r(e,v)[w+S[0]]=Ae.bank0),e.pushChPrimitives(E);break}case 2:{r(e,N)[E]=g,g>0&&e.setChActive(E,1);break}case 3:{let A=e.chRedir(g,s,!0);r(e,X)[E]=A,E!==A&&console.info(`NS5R CH${E+1} receives from CH${A+1}.`);break}case 7:{r(e,D)[E]=g,e.pushChPrimitives(E);break}case 8:{r(e,L)[E*C.rpn+3]=g<40||g>88?g+(g>63?-192:64):g,r(e,_)[C.rpnt*E+2]=1,e.dispatchEvent("pitch",{part:E,pitch:e.getPitchShift(E)});break}case 9:case 10:{r(e,v)[w+S[7]]=g;break}case 11:{r(e,v)[w+S[11]]=g;break}case 14:{r(e,v)[w+S[10]]=g||128;break}case 19:{r(e,v)[w+S[93]]=g;break}case 20:{r(e,v)[w+S[91]]=g;break}case 84:{r(e,v)[w+S[65]]=g;break}case 85:{r(e,v)[w+S[5]]=g;break}}break}case u<3096:break;case u<3134:{let E=u-3096;E<8?(g>31&&(f+=String.fromCharCode(g)),E===7&&(e.aiEfxName=f)):E<10&&(e.setEffectType(E-8,44,g),e.pushEffectType(E-8));break}case u<8566:break}}),e.buildRchTree()}).add([66,54],(t,s)=>{e.invokeSysExIndicator(),e.switchMode("ns5r");let f="",i=80,l=0,d=0,c="MSB\tPRG\tLSB\tNME";ve(t,function(g,u){let E=u%158;switch(!0){case E<10:{g>31&&(f+=String.fromCharCode(g));break}case E===10:break;case E===11:{i=g&127;break}case E===12:{d=g&127;break}case E===13:{c+=`
${i}	${l}	${d}	${f.trim().replace("Init Voice","")}`,l++,f="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(c),O()&&console.debug(c),e.forceVoiceRefresh()}).add([66,55],(t,s)=>{e.invokeSysExIndicator(),e.switchMode("ns5r");let f="",i=88,l=0,d=0,c="MSB\tPRG\tLSB\tNME";ve(t,function(g,u){let E=u%126;switch(!0){case E<10:{g>31&&(f+=String.fromCharCode(g));break}case E===11:break;case E===12:break;case E===13:{c+=`
${i}	${l}	${d}	${f.trim().replace("Init Combi","")}`,l++,f="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(c),O()&&console.debug(c),e.forceVoiceRefresh()}).add([66,125],(t,s,f)=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][t[0]]||"white")}).add([66,127],(t,s,f)=>{let i=t[t.length-1],l=t.subarray(0,t.length-1),d=et(l);d!==i&&(console.info(`NS5R screen dump checksum mismatch! Expected ${d}, got ${i}.`),console.debug(t));let c=new Uint8Array(5760);ve(t,(g,u,E)=>{if(u<720)for(let w=0;w<8;w++)c[u*8+w]=g>>7-w&1}),e.dispatchEvent("screen",{type:"ns5r",data:c})}).add([76],(t,s,f)=>{r(e,Pe).run([66,...t],s,f)}),r(e,ht).add([16,0,8,0],(t,s,f)=>{let i=(t[2]<<4)+t[3],l="K11 ";([()=>{e.switchMode("k11",!0),e.setPortMode(e.getTrackPort(s),2,$.k11),T(e,K,e.KARAOKE_NONE),r(e,Z)[$.k11][1]=i?4:0,console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,i),console.debug(`${l}reverb type: ${i}`),e.pushEffectType(0)},()=>{console.debug(`${l}reverb time: ${i}`)},()=>{console.debug(`${l}reverb time: ${i}`)},()=>{console.debug(`${l}reverb predelay: ${i}`)},()=>{console.debug(`${l}reverb predelay: ${i}`)},()=>{console.debug(`${l}depth high: ${i}`)},()=>{console.debug(`${l}depth high: ${i}`)},()=>{console.debug(`${l}depth low: ${i}`)},()=>{console.debug(`${l}depth low: ${i}`)}][t[0]]||(()=>{}))()}).add([16,0,8,1],(t,s,f)=>{e.invokeSysExIndicator();let i=e.chRedir(t[1],s,!0),l=G[i],d=kt[i],c=(t[3]<<4)+t[4],g=`GMega CH${i+1} `;([()=>{c<128?(e.setChType(i,e.CH_MELODIC,$.k11),r(e,v)[l+S[0]]=0,r(e,N)[i]=c):(e.setChType(i,e.CH_DRUMS,$.k11),r(e,N)[i]=c-128),e.pushChPrimitives(i)},()=>{let u=e.chRedir(c,s,!0),E=r(e,X)[i];r(e,X)[i]=u,(i!==u||u!==E)&&(e.buildRchTree(),console.info(`${g}receives from CH${u+1}`))},()=>{r(e,v)[l+S[7]]=c},()=>{uupThis.setChActive(i,c)},()=>{r(e,v)[l+S[10]]=c},()=>{r(e,L)[d+3]=c+40,r(e,_)[C.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{r(e,L)[d+1]=c>>1,r(e,L)[d+2]=c&1,r(e,_)[C.rpnt*i+1]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{r(e,v)[l+S[91]]=c?127:0},()=>{},()=>{r(e,v)[l+S[74]]=c},()=>{r(e,v)[l+S[73]]=c},()=>{r(e,v)[l+S[72]]=c}][t[0]]||(()=>{}))()}).add([16,0,9,0],(t,s,f)=>{e.invokeSysExIndicator();let i=(t[2]<<4)+t[3],l="GMLX ";([()=>{console.debug(`${l}reverb type: ${i}`)},()=>{console.debug(`${l}reverb time: ${i}`)},()=>{console.debug(`${l}reverb predelay: ${i}`)},()=>{console.debug(`${l}depth high: ${i}`)},()=>{console.debug(`${l}depth low: ${i}`)}][t[0]]||(()=>{}))()}).add([16,0,9,3],(t,s,f)=>{e.invokeSysExIndicator();let i=(t[2]<<4)+t[3],l=e.chRedir(t[1],s,!0),d=G[l],c=`GMLX CH${l+1} `;[()=>{i<128?(e.setChType(l,e.CH_MELODIC,$.k11),r(e,v)[d+S[0]]=0,r(e,v)[d+S[32]]=0,r(e,N)[l]=i):i<160?(e.setChType(l,e.CH_MELODIC,$.k11),r(e,v)[d+S[0]]=0,r(e,v)[d+S[32]]=7,r(e,N)[l]=i-100):(e.setChType(l,e.CH_DRUMS,$.k11),r(e,v)[d+S[0]]=122,r(e,v)[d+S[32]]=0,r(e,N)[l]=i-160),e.pushChPrimitives(l)},()=>{let g=e.chRedir(i,s,!0),u=r(e,X)[l];r(e,X)[l]=g,(l!==g||g!==u)&&(e.buildRchTree(),console.info(`${c}receives from CH${g+1}`))}][t[0]]()}).add([16,0,9,4],(t,s,f)=>{e.invokeSysExIndicator();let i=(t[2]<<4)+t[3],l=e.chRedir(t[1],s,!0),d=G[l],c=kt[l];[()=>{e.setChActive(l,i)},()=>{r(e,v)[d+S[7]]=i},()=>{r(e,v)[d+S[10]]=i},()=>{r(e,v)[d+S[91]]=i?127:0},()=>{r(e,L)[c+3]=i+40,r(e,_)[C.rpnt*l+2]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)})},()=>{r(e,L)[c+1]=i,r(e,_)[C.rpnt*l+1]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)})},()=>{r(e,L)[c]=i,r(e,_)[C.rpnt*l]=1,e.dispatchEvent("pitch",{part:l,pitch:e.getPitchShift(l)})},()=>{}][t[0]]()}),r(this,ut).add([66,93,64],(t,s,f)=>{let i=t[2];switch(t[0]){case 0:{switch(t[1]){case 4:{e.invokeSysExIndicator(),T(e,z,i*129/16383*100),e.dispatchEvent("mastervolume",r(e,z));break}case 5:{e.invokeSysExIndicator(),i-64;break}case 6:{e.invokeSysExIndicator(),console.debug(`SG global reverb: ${i?"on":"off"}`);break}case 127:{e.switchMode("sg",!0),e.setPortMode(e.getTrackPort(s),1,$.sg);break}}break}case 1:{switch(t[1]){case 48:{e.invokeSysExIndicator(),console.debug(`SG reverb type: ${la[i]}`);break}}break}default:if(t[0]>>4===1){e.invokeSysExIndicator();let l=e.chRedir(t[0]&15,s,!0);if(t[1]===2){let d=e.chRedir(i,s,!0),c=r(e,X)[l];r(e,X)[l]=d,(l!==d||d!==c)&&(e.buildRchTree(),console.info(`SG CH${l+1} receives from CH${d+1}`))}else t[1]===19&&e.setChCc(l,7,i)}else console.warn(`Unknown AKAI SG SysEx: ${t}`)}}),r(this,pt).add([9],(t,s,f)=>{e.invokeSysExIndicator(),console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremolo","phaser","rotary speaker","enhancer","flanger","EQ"][t[0]]||"off"}`)}),r(this,te).add([127,0],(t,s,f)=>{e.switchMode("motif");let i=new Uint8Array([127,1,...t]);r(e,te).run(i,s,f)}).add([127,1,0,0],(t,s,f)=>{e.switchMode("s90es");let i="S90/Motif ES system ",l=t[0];t.subarray(1).forEach((d,c)=>{([()=>{T(e,z,d*12900/16383),e.dispatchEvent("mastervolume",r(e,z))}][l+c]||(()=>{console.info(`Unrecognized ${i}ID: ${l+c}`)}))()})}).add([127,1,14],(t,s,f)=>{e.switchMode("s90es");let i="S90/Motif ES bulk header ",l=[];l[95]=(d,c,g)=>{console.debug(`${i}multi edit buffer: ${d[1]}`)},(l[t[0]]||(()=>{console.info(`Unrecognized ${i}ID: ${t[0]}.`)}))(t.subarray(1))}).add([127,1,15],(t,s,f)=>{e.switchMode("s90es");let i="S90/Motif ES bulk footer ",l=[];l[95]=(d,c,g)=>{console.debug(`${i}multi edit buffer: ${d[1]}`)},(l[t[0]]||(()=>{console.info(`Unrecognized ${i}ID: ${t[0]}.`)}))(t.subarray(1))}).add([127,1,54,1],(t,s,f)=>{e.switchMode("s90es");let i="S90/Motif ES reverb ",l=t[0];t.subarray(1).forEach((d,c)=>{([()=>{e.setEffectTypeRaw(0,!1,d&15|128)},()=>{e.setEffectTypeRaw(0,!0,d)}][l+c]||(()=>{}))()}),e.pushEffectType(0)}).add([127,1,54,2],(t,s,f)=>{e.switchMode("s90es");let i="S90/Motif ES chorus ",l=t[0];t.subarray(1).forEach((d,c)=>{([()=>{e.setEffectTypeRaw(1,!1,d&15|128)},()=>{e.setEffectTypeRaw(1,!0,d)}][l+c]||(()=>{}))()}),e.pushEffectType(1)}).add([127,1,54,3],(t,s,f)=>{e.switchMode("s90es");let i="S90/Motif ES insert 1 ",l=t[0];t.subarray(1).forEach((d,c)=>{([()=>{e.setEffectTypeRaw(3,!1,d&15|128)},()=>{e.setEffectTypeRaw(3,!0,d)}][l+c]||(()=>{}))()}),e.pushEffectType(3)}).add([127,1,54,4],(t,s,f)=>{e.switchMode("s90es");let i="S90/Motif ES insert 2 ",l=t[0];t.subarray(1).forEach((d,c)=>{([()=>{e.setEffectTypeRaw(4,!1,d&15|128)},()=>{e.setEffectTypeRaw(4,!0,d)}][l+c]||(()=>{}))()}),e.pushEffectType(4)}).add([127,1,54,16],(t,s,f)=>{e.switchMode("s90es");let i=t[0];t.subarray(1).forEach((l,d)=>{let g=`S90/Motif ES EQ${(d>>2)+1} `;([()=>{let u=l-64},()=>{let u=wt[l]},()=>{let u=l/10},()=>{let u=l}][i+d&3]||(()=>{}))()})}).add([127,1,54,17],(t,s,f)=>{e.switchMode("s90es");let i="S90/Motif ES variation ",l=t[0];t.subarray(1).forEach((d,c)=>{([()=>{e.setEffectTypeRaw(2,!1,d&15|128)},()=>{e.setEffectTypeRaw(2,!0,d)}][l+c]||(()=>{}))()}),e.pushEffectType(2)}).add([127,1,55],(t,s,f)=>{e.invokeSysExIndicator(),e.switchMode("s90es");let i=e.getTrackPort(s);if(r(e,q)[i]&&r(e,q)[i]!==r(e,U).smotif)if(r(e,De).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${s}. Port ${String.fromCharCode(65+i)} mode "${W[r(e,q)[i]]}" mismatch, should be "${W[r(e,U).smotif]}".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);let l=e.chRedir(t[0],s,!0),d=G[l],c=t[1];t[0]>15&&(l=t[0]+32);let g=`Track ${s} S90/Motif ES bulk CH${l<128?l+1:"U"+(l-127)} `;console.debug(g,t),!(t[0]>15)&&t.subarray(2).forEach((u,E)=>{([()=>{e.setChCc(l,0,u),e.pushChPrimitives(l)},()=>{u&&e.setChActive(l,1),e.setChCc(l,32,u),e.getChPrimitive(l,1)===63&&e.setChType(l,[32,40].indexOf(u)>-1?e.CH_DRUMS:e.CH_MELODIC,r(e,H),!0),e.pushChPrimitives(l)},()=>{u&&e.setChActive(l,1),r(e,N)[l]=u,e.pushChPrimitives(l)},()=>{let w=e.chRedir(u,s,!0),A=r(e,X)[l];r(e,X)[l]=w,(l!==w||w!==A)&&(e.buildRchTree(),console.info(`${g}receives from CH${w+1}`))},()=>{r(e,ne)[l]=u?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{u!==100&&e.setChActive(l,1),r(e,v)[d+S[7]]=u},()=>{u!==64&&e.setChActive(l,1),r(e,v)[d+S[10]]=u},!1,!1,!1,()=>{r(e,v)[d+S[91]]=u},()=>{u&&e.setChActive(l,1),r(e,v)[d+S[93]]=u},()=>{u&&e.setChActive(l,1),r(e,v)[d+S[94]]=u},()=>{e.setChCc(l,128,u),u!==127&&(e.setChActive(l,1),e.allocateAce(l,128))},()=>{},()=>{u!==64&&e.setChActive(l,1),r(e,v)[d+S[74]]=u},()=>{u!==64&&e.setChActive(l,1),r(e,v)[d+S[71]]=u},!1,()=>{r(e,v)[d+S[65]]=u},()=>{r(e,v)[d+S[5]]=u},()=>{}][c+E]||(()=>{}))()})}),r(e,te).add([100,14],(t,s,f)=>{var l;e.switchMode("cs6x"),e.setPortMode(e.getTrackPort(s),1,$.cs6x);let i=(l=["normal voice","plugin voice PLG","drums",,"performance",,"phrase clip"][t[0]>>4])!=null?l:"invalid";t[0]&!0?i+=" edit buffer":t[0]>>4==1?i+=`${(t[0]&1)+1}`:i+=` ${["INT","EXT"][t[0]&1]}`,console.debug(`CS6x bulk dump for ${i} started.`)}).add([100,15],(t,s,f)=>{var l;e.switchMode("cs6x");let i=(l=["normal voice","plugin voice PLG","drums",,"performance",,"phrase clip"][t[0]>>4])!=null?l:"invalid";t[0]&!0?i+=" edit buffer":t[0]>>4==1?i+=`${(t[0]&1)+1}`:i+=` ${["INT","EXT"][t[0]&1]}`,console.debug(`CS6x bulk dump for ${i} ended.`)}).add([100,76,112],(t,s,f)=>{e.switchMode("cs6x");let i=0,l=t[0];t.subarray(1).forEach((d,c)=>{let g=c+l;g<10?(e.setChCvnRegister(i,c,d&127),r(e,me)[i]=1):g<12||g<13&&console.debug(`Plugin voice type: ${d}`)}),e.pushChPrimitives(i)}).add([100,76,0],(t,s,f)=>{e.switchMode("cs6x"),e.setPortMode(e.getTrackPort(s),1,$.cs6x);let i=0,l=t[0];t.subarray(1).forEach((d,c)=>{let g=c+l;([()=>{e.setChCc(i,7,d),d!==100&&e.setChActive(i,1)},,,()=>{r(e,ne)[i]=d==0,e.setChCc(i,64,0),r(e,ee).ano(i),e.resetChAceAll(i)},,()=>{},,,()=>{e.setChCc(i,65,d?127:0)},()=>{e.setChCc(i,5,d)},,()=>{e.setChCc(i,91,d),d!==40&&e.setChActive(i,1)},()=>{e.setChCc(i,93,d),d&&e.setChActive(i,1)}][g]||(()=>{}))()})}).add([100,76,1],(t,s,f)=>{e.switchMode("cs6x");let i=0,l=t[0],d=!1;t.subarray(1).forEach((c,g)=>{let u=g+l;([()=>{e.setEffectTypeRaw(0,!1,c&15|128),d=!0},()=>{e.setEffectTypeRaw(0,!0,c),d=!0}][u]||(()=>{}))()}),d&&e.pushEffectType(0)}).add([100,76,2],(t,s,f)=>{e.switchMode("cs6x");let i=0,l=t[0],d=!1;t.subarray(1).forEach((c,g)=>{let u=g+l;([()=>{e.setEffectTypeRaw(1,!1,c&15|128),d=!0},()=>{e.setEffectTypeRaw(1,!0,c),d=!0}][u]||(()=>{}))()}),d&&e.pushEffectType(1)}).add([100,76,3],(t,s,f)=>{e.switchMode("cs6x");let i=0,l=t[0],d=!1;t.subarray(1).forEach((c,g)=>{let u=g+l;([()=>{e.setEffectTypeRaw(2,!1,c&15|128),d=!0},()=>{e.setEffectTypeRaw(2,!0,c),d=!0}][u]||(()=>{}))()}),d&&e.pushEffectType(2)}).add([100,76,5],(t,s,f)=>{e.switchMode("cs6x")}).add([100,76,16],(t,s,f)=>{e.switchMode("cs6x");let i=0,l=t[0],d=!1;if(t.subarray(1).forEach((c,g)=>{let u=g+l;([()=>{e.setChCc(i,0,c),d=!0},()=>{e.setChCc(i,32,c),d=!0,c&&e.setChActive(i,1)},()=>{r(e,N)[i]=c,d=!0,c&&e.setChActive(i,1)},()=>{r(e,_)[kt[i]+Jt[2]]=1,r(e,L)[kt[i]+Jt[2]]=c,c&&e.setChActive(i,1)}][u]||(()=>{}))()}),d){switch(e.pushChPrimitives(i),e.getChVoice(i).standard){case"DX":{r(e,oe)[i]=e.EXT_DX;break}case"VL":{r(e,oe)[i]=e.EXT_VL;break}}e.dispatchEvent("metacommit",{type:"OSysMeta",msg:"part.rename",data:{part:i}})}}).add([100,76,32],(t,s,f)=>{e.switchMode("cs6x");let i=0,l=t[0],d=r(e,oe)[i];switch(d){case e.EXT_DX:{t.length>2&&console.debug(t),t.subarray(1).forEach((c,g)=>{let u=g+l;if(u<6){let E=u+142;e.setChCc(i,E,c),c!==64&&e.allocateAce(i,E)}else if(u<12){let E=u+144;e.setChCc(i,E,c),c!==64&&e.allocateAce(i,E)}else([()=>{},()=>{},()=>{},()=>{}][u]||(()=>{}))()});break}case e.EXT_VL:{console.info(`Support for Modular System Plug-in writes is not yet present for plugin type ${d}.`);break}default:console.warn(`Unsupported plug-in type: ${d}`)}}),r(this,Ee).add([0,72,18,0,0,0,0],(t,s,f)=>{e.switchMode("sd",!0),e.setPortMode(e.getTrackPort(s),2,$.sd),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(t,s,f)=>{e.invokeSysExIndicator();let i=t[0]>>5,l=t[0]&31;switch(i){case 0:{let d=t[0]>>1,c=t[1];switch(d){case 1:{t.subarray(2).forEach((g,u,E)=>{let w=u+c;switch(w){case 0:{g&&(e.setEffectType(1,60,g-1),e.pushEffectType(1),console.debug(`SD MFX Cho: ${w} - ${g}`));break}}});break}case 2:{t.subarray(2).forEach((g,u)=>{let E=u+c;switch(E){case 0:{g&&(e.setEffectType(0,55+g,0),e.pushEffectType(0),console.debug(`SD MFX Rev: ${E} - ${g}`));break}}});break}case 3:case 4:case 5:{let g=d-1;t.subarray(2).forEach((u,E)=>{let w=E+c;switch(console.debug(`SD MFX ${g-2}: ${w} - ${u}`),w){case 0:{e.setEffectTypeRaw(g,62,u),e.pushEffectType(g);break}}}),console.debug(`SD MFX message:
%o`,t);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,t)}break}case 1:{let d=e.chRedir(l,s,!0),c=t[1],g=G[d];t.subarray(2).forEach((u,E)=>{let w=c+E;w<37?([()=>{},()=>{},0,()=>{},()=>{switch(u){case 104:case 105:case 106:case 107:case 120:case 128:{r(e,D)[d]||e.setChType(d,e.CH_DRUMS);break}default:r(e,D)[d]&&e.setChType(d,e.CH_MELODIC)}e.setChCc(d,0,u),e.pushChPrimitives(d)},()=>{r(e,v)[g+S[32]]=u,e.pushChPrimitives(d)},()=>{r(e,N)[d]=u},()=>{r(e,v)[g+S[7]]=u},()=>{r(e,v)[g+S[10]]=u},()=>{},()=>{},()=>{u<2&&(r(e,ne)[d]=u)},()=>{u<2&&(r(e,v)[g+S[68]]=u?127:0)},()=>{},()=>{u<2&&(r(e,v)[g+S[65]]=u?127:0)},()=>{r(e,v)[g+S[5]]=u&15<<4|r(e,v)[g+S[5]]&15},()=>{r(e,v)[g+S[5]]=u&15|(r(e,v)[g+S[5]]&240)>>4},()=>{r(e,v)[g+S[74]]=u},()=>{r(e,v)[g+S[71]]=u},()=>{r(e,v)[g+S[73]]=u},()=>{r(e,v)[g+S[72]]=u},0,0,0,0,0,0,0,()=>{r(e,v)[g+S[128]]=u,e.allocateAce(128)},()=>{r(e,v)[g+S[93]]=u},()=>{r(e,v)[g+S[91]]=u},0,0,()=>{r(e,v)[g+S[75]]=u},()=>{r(e,v)[g+S[76]]=u},()=>{r(e,v)[g+S[77]]=u},()=>{r(e,v)[g+S[78]]=u}][w]||(()=>{}))():w<63||(w<64?(r(e,D)[d]?(r(e,v)[g+S[0]]=104|u,e.pushChPrimitives(d)):(r(e,v)[g+S[0]]=96|u,e.pushChPrimitives(d)),e.pushChPrimitives(d)):console.debug(`Unknown SD-90 global CH${d+1} param setup message:
%o`,t))});break}case 2:{let d=e.chRedir(l,s,!0),c=t[1];console.debug(`Unknown SD-90 global CH${d+1} MIDI setup message:
%o`,t.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,t)}}),r(e,Pe).add([0,1,73,78],(t,s,f)=>{e.switchMode("krs"),e.setPortMode(e.getTrackPort(s),1,$.krs),console.debug("Might be KORG KROSS 2 mode reset... Not sure.")}).add([0,1,73,117,2,37],(t,s,f)=>{e.switchMode("krs");let i=e.getTrackPort(s);if(r(e,q)[i]&&r(e,q)[i]!==$.krs)if(r(e,De).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled. Port ${String.fromCharCode(65+i)} mode "${W[r(e,q)[i]]}" mismatch, should be "krs".`);return}else console.info(`Track ${s} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+i)}.`);e.setPortMode(e.getTrackPort(s),1,$.krs);let l="KROSS 2 BMT1 ",d="";ve(t,(c,g)=>{if(g<24)d+=String.fromCharCode(Math.max(32,c));else if(!(g<88)){if(g<468){let u=g-88,E=u*863>>16,w=u-E*76;([()=>{e.setEffectType(E+3,45,c),e.pushEffectType(E+3)},!1,()=>{console.debug(`${l}IFX${E+1} sends to ${c<=5&&c>0?`IFX${c}`:"direct out"}.`)}][w]||(()=>{}))()}else if(g<604){let u=g-468,E=u*964>>16,w=u-E*68;([()=>{e.setEffectType(1-E,45,c),e.dispatchEvent(["efxreverb","efxchorus"][1-E],{id:e.getEffectType(1-E)})},!1][w]||(()=>{}))()}else if(!(g<1276)){let u=g-1276,E=u*1490>>16,w=e.chRedir(E,s,!0),A=u-E*44;A<22?([()=>{c&&e.setChActive(w,1),r(e,N)[w]=c,e.pushChPrimitives(w)},()=>{c&&e.setChActive(w,1),c<10?(e.setChCc(w,0,63),e.setChCc(w,32,c)):c<20?(e.setChCc(w,0,121),e.setChCc(w,32,c-10)):c<24&&(e.setChCc(w,0,[120,0,56,62][c-20]),e.setChCc(w,32,0)),e.pushChPrimitives(w)},()=>{let R=e.chRedir(c&15,s,!0);r(e,X)[w]=R,R!==w&&console.info(`${l}CH${w+1} receives from CH${R+1}`);let I=c>>5&1;e.modelEx.kross.chToggle&&(e.setChActive(w,I),I||console.debug(`KORG KROSS 2 CH${w+1} is disabled.`))},!1,!1,()=>{e.setChCc(w,7,c)},!1,()=>{},()=>{},!1,!1,!1,!1,!1,()=>{e.setChCc(w,10,c||128)}][A]||(()=>{}))():A<36?([()=>{let R=c&7;c&8&&(R=1),R>1&&console.debug(`${l}CH${w+1} sends to ${R>1?`IFX${R-1}`:"direct out"} (${c.toString(16)}).`),e.setChEffectSink(w,c>1&&c<7?c+1:0)}][A-22]||(()=>{}))():([()=>{e.setChCc(w,74,(c+128&255)-64)},()=>{e.setChCc(w,71,(c+128&255)-64)},!1,!1,()=>{e.setChCc(w,73,(c+128&255)-64)},()=>{e.setChCc(w,75,(c+128&255)-64)},!1,()=>{e.setChCc(w,72,(c+128&255)-64)}][A-36]||(()=>{}))()}}}),d=d.trimEnd(),e.dispatchEvent("metacommit",{type:"EORTitle",data:d})});let k=function(t,s,f){let i=e.chRedir(t,s,!0);e.setChMode(i,$.an1x),e.pushChPrimitives(i),console.debug(`Yamaha AN1x slot ${f+1} receives from CH${i+1}(${t+1}).`),e.modelEx.yPlg[3][f]=i};r(e,te).add([92,0,0],(t,s,f)=>{let i=t[0];t.subarray(1).forEach((l,d)=>{let c=d+i;c<2||([!1,!1,!1,!1,!1,!1,()=>{k(l,s,0)},()=>{k(l,s,1)}][c-2]||(()=>{}))()})}),r(e,te).add([75,80,0],(t,s,f)=>{let i=t[0];t.subarray(1).forEach((l,d)=>{let c=d+i;([()=>{e.modelEx.cs1x.perfCh=l,e.pushChPrimitives(l),console.debug(`Yamaha CS1x performance on CH${l+1}.`)},!1,!1,!1,()=>{},!1,()=>{switch(l){case 1:{e.switchMode("xg",!0),e.setPortMode(e.getTrackPort(s),1,$.xg),console.debug("Yamaha CS1x set to XG mode.");break}case 3:{e.switchMode("cs1x",!0),e.setPortMode(e.getTrackPort(s),1,$.cs1x),console.debug("Yamaha CS1x set to performance mode.");break}default:console.warn(`Unknown Yamaha CS1x mode: ${l}`)}},()=>{}][c]||(()=>{}))()})}).add([75,96,0],(t,s,f)=>{let i=t[0],l=!1,d=e.modelEx.cs1x.perfCh;t.subarray(1).forEach((c,g)=>{let u=g+i;u<8?(l=!0,r(e,me)[d]=1,e.setChCvnRegister(d,u,c)):u<48?([!1,()=>{e.setChCc(d,7,c)}][u]||(()=>{}))():u<80?([()=>{e.setEffectTypeRaw(0,!1,c)},()=>{e.setEffectTypeRaw(0,!0,c),e.pushEffectType(0)},()=>{e.setEffectTypeRaw(1,!1,c)},()=>{e.setEffectTypeRaw(1,!0,c),e.pushEffectType(1)},()=>{e.setEffectTypeRaw(2,!1,c)},()=>{e.setEffectTypeRaw(2,!0,c),e.pushEffectType(2)}][u-48]||(()=>{}))():O()&&console.debug(`Unknown CS1x effect register: ${u}.`)}),l&&(e.setChActive(d,1),e.pushChPrimitives(d))});let x=(t,s,f)=>{let i=0;f.forEach((l,d)=>{([()=>{i=(l&1)<<7|i&127,e.setEffectTypeRaw(t,!1,28),e.setEffectTypeRaw(t,!0,i)},()=>{i=i&128|l&127,e.setEffectTypeRaw(t,!1,28),e.setEffectTypeRaw(t,!0,i),e.pushEffectType(t)}][d+s]||(()=>{}))()})};r(e,Pe).add([96,0,1],(t,s,f)=>{let i=t[0];switch(t[1]){case 0:{x(0,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}case 1:{x(1,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}case 2:{x(2,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}case 3:{x(3,t[2],t.subarray(3)),console.debug(`Partially parsed KORG PA EFX SysEX:
`,t);break}default:console.debug(`Unparsed KORG PA SysEX:
`,t)}})}get detect(){return structuredClone(r(this,U))}chRedir(e,a,o){let n=this;if(r(n,Ye)[a])return(r(n,Ye)[a]-1)*16+e;if(r(n,H)===$.sc||r(n,H)===$.sd){if(o===1)return e;let h=0,b=!0;for(;b;)r(n,_e)[e+h]===0?(r(n,_e)[e+h]=a,console.debug(`Assign track ${a} to channel ${e+h+1}.`),b=!1):r(this,_e)[e+h]===a?b=!1:(h+=16,h>=128&&(h=0,b=!1));return e+h}else return e}getTrackPort(e){return this.chRedir(0,e,!0)>>4}forceVoiceRefresh(){for(let e=0;e<C.ch;e++)r(this,pe)[e]&&this.dispatchEvent("voice",{part:e})}buildRchTree(){let e=[];r(this,X).forEach((a,o)=>{var n;a<C.ch&&((n=e[a])!=null&&n.constructor||(e[a]=[]),e[a].push(o))}),T(this,Ft,e)}buildRccMap(){let e=this;for(let a=0;a<C.ch;a++)r(e,ct)[a]={};r(e,st).forEach((a,o)=>{a&&(r(e,ct)[Math.floor(o/C.redir)][a]=o%C.redir|128)}),O()&&console.debug(r(e,ct))}invokeSysExIndicator(){this.dispatchEvent("mupromptex",r(this,Rt))}getActive(){return r(this,pe)}getChActive(e){return r(this,pe)[e]}getCc(e){if(typeof e!="number"||e<0||e>=C.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let a=this,o=G[e];return r(a,v).subarray(o,o+C.cc)}getChCc(e,a){let o=this;if(tt.indexOf(a)<0)throw new Error("CC number not accepted");return r(o,v)[G[e]+S[a]]}getChCcWritten(e,a){let o=this;if(tt.indexOf(a)<0)throw new Error("CC number not accepted");return r(o,v)[C.chcc+G[e]+S[a]]}setChCc(e=0,a,o){let n=this;if(tt.indexOf(a)<0)throw new Error("CC number not accepted");if((o==null?void 0:o.constructor)!==Number)throw new TypeError("Expected numbers for value");let h=o&255,b=G[e]+S[a];r(n,v)[b]=h,r(n,v)[b+C.chcc]=1,n.dispatchEvent("cc",{part:e,cc:a,data:h})}getCcAll(){return r(this,v).slice()}resetCc(e){let a=this,o=G[e]+C.chcc;r(a,v).fill(0,o,o+C.cc)}resetChCc(e,a,o){let n=this;o!=null&&o.constructor&&n.setChCc(e,a,o),r(n,v)[G[e]+S[a]+C.chcc]=0}resetCcAll(){r(this,v).fill(0,C.chcc,C.chcc<<1)}isChCcWritten(e,a){if(tt.indexOf(a)<0)throw new Error("CC number not accepted");return r(upThis,v)[G[e]+S[a]+C.chcc]}getChSource(){return r(this,X)}getChType(e=0){return r(this,D)[e]}getChTypes(){return r(this,D)}setChType(e,a,o=0,n=!1){a&=15;let h=this;o=o||h.getChModeId(e),r(h,D)[e]=a,a>0&&!n&&(h.setChCc(e,0,r(h,Z)[o][2]),h.pushChPrimitives(e))}setChActive(e,a=0){r(this,pe)[e]!==a&&this.dispatchEvent("channeltoggle",{part:e,active:a}),r(this,pe)[e]=a}getExt(e){let a=C.ext*e,o=r(this,oe).subarray(a,a+C.ext),n=new Uint8Array(o.length);return n.set(o),n[1]=n[1]||r(this,jt),n}getPitch(){return r(this,Ne)}getProgram(){return r(this,N)}getTexts(){return r(this,be).slice()}getVel(e){let a=new Map,o=this;return r(o,J).forEach(function(n,h){let b=n>>7,m=n&127;e===b&&r(o,j)[n]>0&&a.set(m,{v:r(o,j)[n],s:r(o,F)[h]})}),a}getBitmap(){return{bitmap:r(this,He,$t),expire:r(this,Se)}}getLetter(){return{text:r(this,Fe),set:r(this,Vt),expire:r(this,Ke)}}getMode(){return W[r(this,H)]}getMaster(){return{volume:r(this,z)}}getRpn(){return r(this,L)}getNrpn(){return r(this,St)}getSubDb(){return self==null?void 0:self.structuredClone(r(this,Z))}getDetect(){return self==null?void 0:self.structuredClone(r(this,U))}getVoice(e,a,o,n="?"){var t;let h=this;(t=$[n])!=null&&t.constructor||(n="?");let b=$[n],m=e||r(h,Z)[b][0],y=a,k=o||r(h,Z)[b][1];m===Ae.bank0&&(m=0),k===Ae.bank0&&(k=0),n==="ns5r"&&m>0&&m<56&&(k=3);let x=h.userBank.get(m,y,k,n);if(n==="mt32"&&x.name.indexOf("MT-m:")===0){let s=parseInt(x.name.slice(5)),f=s*C.cmt,i="";r(h,Ve).subarray(f,f+10).forEach(d=>{d>31&&(i+=String.fromCharCode(d))});let l=`MSB	LSB	PRG	NME
49	127	${y}	${i}`;h.userBank.load(l,!0),x.name=i,x.ending=" "}return(x.ending!==" "||!x.name.length)&&(x=h.baseBank.get(m,y,k,n)),x}getChPrimitive(e,a,o){if(a>=C.vxPrim||(a==null?void 0:a.constructor)!==Number)throw new RangeError(`Invalid voice primitive component "${a}"`);if(typeof e!="number"||e<0||e>=C.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let n=this,h=r(n,N)[a<<C.chShift|e];switch(a){case 1:case 2:{n.getChCcWritten(e,[255,0,32][a])||(h=h||r(n,Z)[n.getChModeId(e)][a+2]),o&&(h=h||r(n,Z)[n.getChModeId(e)][a-1]),h===Ae.bank0&&(h=0);break}}return h}getChPrimitives(e,a){let o=this,n=new Uint8Array(3);return n[1]=r(o,N)[e],n[0]=o.getChPrimitive(e,1,a),n[2]=o.getChPrimitive(e,2,a),n}pushChPrimitives(e){let a=this;r(a,N)[1<<C.chShift|e]=a.getChCc(e,0),r(a,N)[2<<C.chShift|e]=a.getChCc(e,32),a.dispatchEvent("voice",{part:e})}getChCvnBuffer(e,a=C.cvn){if(a>C.cvn||a<1)throw new RangeError("Invalid custom voice name buffer length");let o=vt[e];return r(this,nt).subarray(o,o+a)}getChCvnRegister(e,a){if(a>=C.cvn||a<0)throw new RangeError("Invalid custom voice name register");return r(this,nt)[vt[e]+a]}setChCvnRegister(e,a,o=32){if(a>=C.cvn||a<0)throw new RangeError("Invalid custom voice name register");r(this,Tt)[e]=1,r(this,nt)[vt[e]+a]=Math.max(32,o&255)}resetChCvn(e){r(this,nt).fill(32,vt[e],vt[e]+C.cvn),r(this,Tt)[e]=0}getChCvnString(e,a){let o=Ur.decode(this.getChCvnBuffer(e));return a||(o=o.trimEnd()),o}getChCvnIsWritten(e){return r(this,Tt)[e]}getChVoice(e){let a=this,o=a.getVoice(...a.getChPrimitives(e),a.getChMode(e));if(r(a,me)[e]){let n="";switch(r(a,H)){case $.mt32:{r(a,Me).subarray(C.cmt*(e-1),C.cmt*(e-1)+10).forEach(h=>{n+=String.fromCharCode(Math.max(h,32))}),n=n.trimEnd();break}default:n=a.getChCvnString(e)}n.length&&(o.ending="~",o.name=n)}return o}getRawPitch(){return r(this,Ne)}getPitchShift(e){let a=this,o=e*C.rpn,n=r(a,L)[o];return r(a,_)[e*C.rpnt]?n>>7&&(n-=256):r(a,H)===$.mt32&&(n=12),r(a,Ne)[e]/8192*n+(r(a,L)[o+3]-64)+((r(a,L)[o+1]<<7)+r(a,L)[o+2]-8192)/8192}getEffectType(e=0){let a=3*e+1;return r(this,ge).subarray(a,a+2)}getPolyState(e=0){return r(this,F)[e]}setEffectTypeRaw(e=0,a,o){let n=3*e;r(this,ge)[n]=1,r(this,ge)[n+1+ +a]=o}setEffectType(e=0,a,o){this.setEffectTypeRaw(e,!1,a),this.setEffectTypeRaw(e,!0,o)}pushEffectType(e=0,a=!1){if(e<0||e>=C.efx)throw new RangeError(`Invalid EFX slot ${e}`);let o=this.getEffectType(e);a||o[0]===0&&o[1]>>4===15&&(a=!0),this.dispatchEvent(`efx${Gt[e]}`,{id:o,hidden:a})}getEffectSink(){return r(this,rt)}getChEffectSink(e){return r(this,rt)[e]}setChEffectSink(e,a=0){let o=this;if(a<0||a>=C.efx)throw new RangeError(`Invalid EFX slot ${a}`);if(e<0||e>=C.ch)throw new RangeError(`Invalid CH${e+1}`);r(this,rt)[e]=a,this.dispatchEvent("partefxtoggle",{part:e,active:a})}setXgChEffectSink(e,a=0){let o=this,n=o.modelEx.xg,h=a-2;if(a<0||h>=n.insPart.length)throw new RangeError(`Invalid XG insertion slot ${h}`);let b=n.insPart[h];n.insPart[h]=e,b!==C.invalidCh&&o.setChEffectSink(b,0),e===C.invalidCh?b!==C.invalidCh&&o.setChEffectSink(b,0):o.setChEffectSink(e,a)}setLetterDisplay(e,a,o=0,n=3200){let h=this,b;T(h,Fe," ".repeat(o)),e.forEach(m=>{T(h,Fe,r(h,Fe)+String.fromCharCode(m>31?m:32)),m<32&&(b=b||new Set,b.add(m))}),T(h,Vt,Date.now()),T(h,Ke,Date.now()+n),h.dispatchEvent("letter"),b&&(b=Array.from(b),b.forEach((m,y,k)=>{k[y]=m.toString(16).padStart(2,"0")}),console.warn(`${a}${a?" ":""}invalid code point${b.length>1?"s":""}: 0x${b.join(", 0x")}`))}setDetectionTargets(e="?",a=0){let o=this,n=-1;switch(e.replaceAll(", ",",").split(",").forEach(h=>{h=h.toLowerCase();let b=W.indexOf(Mr[h]||h);O()&&console.debug(`Mapped mode "${h}" to ID "${b}".`),b>-1&&(n=b)}),O()&&console.debug(`Set detection target to ID "${n}".`),n>0&&(r(o,U).x5=82,r(o,U).ds=$.krs,r(o,U).gm=$.gm,r(o,U).g2=$.g2),n){case $["05rw"]:{r(o,U).x5=81;break}case $.s90es:{r(o,U).ds=$.s90es,r(o,U).smotif=$.s90es;break}case $.motif:{r(o,U).ds=$.motif,r(o,U).smotif=$.motif;break}case $.sd:{r(o,U).g2=$.sd;break}case $.pa:{r(o,U).g2=$.pa;break}}}setGsTargets(e=!1,a=4){if(!a)a=e?3:4;else{if(a>4||a<0)throw new Error(`Invalid GS level ${a}`);if(e&&a>>1!==1)throw new Error(`Invalid SC level ${a}`)}let o=this;r(o,U)[e?"sc":"gs"]=a,r(o,Z)[$[e?"sc":"gs"]][1]=a,o.forceVoiceRefresh()}getConfigs(){return r(this,Xt)}setDumpLimit(e){if(e>2||e<0)throw new RangeError("Invalid dump limit.");r(this,De).dumpLimit=e}allocateAce(e=0,a){let o=this;if(!a||a<128&&a>95){console.warn(`cc${a} cannot be allocated as an active custom effect.`);return}let n=!0,h=0,b=C.ace*e;for(;n&&h<C.ace;)r(o,ae)[h+b]===a?n=!1:r(o,ae)[h+b]||(n=!1,r(o,ae)[h+b]=a,console.debug(`Allocated cc${a} to ACE slot ${h} in CH${e+1}.`)),h++;h>=C.ace&&console.warn(`ACE slots are full in CH${e+1}.`)}allocateAceAll(e){let a=this;if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}for(let o=0;o<C.ch;o++){let n=!0,h=0,b=C.ace*o;for(;n&&h<C.ace;)r(a,ae)[h+b]===e?n=!1:r(a,ae)[h+b]||(n=!1,r(a,ae)[h+b]=e),h++;h>=C.ace&&console.warn(`ACE slots are full in CH${o+1}.`)}}resetAce(){r(this,ae).fill(0),console.info("All ACE slots have been reset.")}resetChAceAll(e=0){r(this,ae).subarray(Zt[e],Zt[e]+C.ace).fill(0)}resetChAce(e=0,a){let o=!0,n=Zt[e],h=n+C.ace;for(;o&&n<h;)r(this,ae)[n]===a&&(r(this,ae)[n]=0,o=!1),n++;o&&O()&&console.debug(`No ACE slot was allocated to cc${a} in CH${e+1}.`)}getAce(){return r(this,ae)}getChAce(e=0,a=0){if(a<0||a>=C.ace)throw new RangeError("No such ACE slot");let o=r(this,ae)[C.ace*e+a];if(o){if(tt.indexOf(o)>=0)return this.getChCc(e,o);throw new Error(`Invalid ACE source in CH${e+1}: ${o}`)}else return 0}initDrums(){let e=this;r(e,de).fill(64);for(let a=0;a<C.drm;a++){let o=a*C.dpn;for(let n in ja){let h=ja[n],b=(o+ye[n])*C.dnc;r(e,de).subarray(b,b+C.dnc).fill(h)}}}init(e=0){let a=this;T(a,ot,0),r(a,Z)[$.xg][1]=0,a.dispatchEvent("banklevel",{mode:"xg",data:0}),r(a,pe).fill(0),r(a,v).fill(0),r(a,ae).fill(0),r(a,N).fill(0),r(a,j).fill(0),r(a,J).fill(0),r(a,F).fill(0),r(a,ne).fill(0),r(a,Ie).fill(0),r(a,Ne).fill(0),r(a,St).fill(0),r(a,_).fill(0),r(a,oe).fill(0),r(a,q).fill(0),r(a,xt).fill(0),r(a,it).fill(0),r(a,st).fill(0),T(a,z,100),T(a,be,[]),T(a,Pt,500),a.modelEx.sg.convLastSyll=0,a.modelEx.sg.runLineLen=0,a.modelEx.sg.splitMask=!1,T(a,Se,0),T(a,ie,0);for(let o=0;o<r(a,xe).length;o++)r(a,He,$t).fill(0);T(a,K,a.KARAOKE_NONE),T(a,At,0),T(a,Le,!0),T(a,Q,!1),T(a,Rt,0),a.initDrums(),a.polyIndexLatest=0,a.polyIndexLast=0,r(a,X).forEach(function(o,n,h){h[n]=n}),e===0&&(a.dispatchEvent("mode","?"),T(a,H,0),r(a,_e).fill(0),r(a,Ye).fill(0),T(a,Ke,0),T(a,Fe,"")),Ar.forEach(o=>{a.setChCc(o,0,r(a,Z)[a.getChModeId(o)][2])}),r(a,D).fill(a.CH_MELODIC),r(a,D)[9]=a.CH_DRUM1,r(a,D)[25]=a.CH_DRUM3,r(a,D)[41]=a.CH_DRUMS,r(a,D)[57]=a.CH_DRUMS,r(a,D)[73]=a.CH_DRUM5,r(a,D)[89]=a.CH_DRUM7,r(a,D)[105]=a.CH_DRUMS,r(a,D)[121]=a.CH_DRUMS;for(let o=0;o<C.drm;o++)r(a,Te)[o<<1]=0,r(a,Te)[o<<1|1]=C.invalidCh;r(a,Mt).fill(0),r(a,Ve).fill(0),r(a,Xe).fill(0),r(a,Me).fill(0),r(a,me).fill(0),r(a,ge).fill(0),r(a,rt).fill(0),a.aiEfxName="",a.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),a.modelEx.xg.varSys=!1,a.modelEx.xg.insPart.fill(C.invalidCh);for(let o=0;o<$e.length;o++){let n=a.modelEx.yPlg[o];n.fill(0,0,$e[o][2]),n.fill(C.invalidCh,$e[o][2])}a.modelEx.sc.showBar=!0,a.modelEx.sc.invBar=!1,a.modelEx.sc.invDisp=!1,a.modelEx.sc.peakHold=1,a.modelEx.cs1x.perfCh=0;for(let o=0;o<C.ch;o++){a.resetChCvn(o);let n=G[o];r(a,v)[n+S[7]]=100,r(a,v)[n+S[11]]=127,r(a,v)[n+S[2]]=127,r(a,v)[n+S[10]]=64,r(a,v).subarray(n+S[71],n+S[71]+8).fill(64),r(a,v)[n+S[128]]=127,r(a,v).subarray(n+S[130],n+S[157]+1).fill(64),r(a,v)[n+S[91]]=40,r(a,v)[n+S[101]]=127,r(a,v)[n+S[100]]=127,r(a,v)[n+S[99]]=127,r(a,v)[n+S[98]]=127;let h=o*C.rpn;r(a,L)[h]=2,r(a,L)[h+1]=64,r(a,L)[h+2]=0,r(a,L)[h+3]=64,r(a,L)[h+4]=0,r(a,L)[h+5]=0;let b=o*C.ext;r(a,oe)[b+1]=a.VLBC_BRTHEXPR;let m=o*C.redir;r(a,st)[m+8]=13}a.buildRchTree(),a.buildRccMap(),a.dispatchEvent("mastervolume",r(a,z));for(let o=0;o<Gt.length;o++)a.pushEffectType(o);a.dispatchEvent("reset"),a.switchMode("?")}setChMode(e,a){let o=this;if(typeof e!="number"||e<0||e>=C.ch)throw new RangeError(`Invalid part number: CH${e+1}`);if(e<0||a>=W.length)throw new RangeError(`Invalid mode ID ${a}`);r(o,it)[e]=a,o.dispatchEvent("chmode",{part:e,id:a,mode:W[a]}),o.pushChPrimitives(e)}getChMode(e,a){return W[this.getChModeId(e,a)]}getChModeId(e,a){return a?r(this,it)[e]||r(this,q)[e>>4]:r(this,it)[e]||r(this,q)[e>>4]||r(this,H)}getPortMode(e,a){return W[this.getPortModeId(e,a)]}getPortModeId(e,a){return a?r(this,q)[e]:r(this,q)[e]||r(this,H)}setPortMode(e,a,o){let n=this;if(e<0||e>=C.ch>>4)throw new RangeError(`Invalid port ${e+1}`);if(a<1)throw new RangeError("Range must be a positive integer");if(e+a>=C.ch>>4)throw new RangeError("Range must be in bound");if(e<0||o>=W.length)throw new RangeError(`Invalid mode ID ${o}`);r(n,xt)[e]=o;for(let h=e;h<e+a;h++){let b=r(n,xt)[h];if(a>1&&b!==0&&b!==o)break;r(n,q)[h]=o;for(let m=h<<4;m<h+1<<4;m++)n.dispatchEvent("chmode",{part:m,id:o,mode:W[o]}),n.pushChPrimitives(m)}}copyChSetup(e,a,o){if(e===a){console.warn(`Failed attempt at overwriting CH${e+1} with its own data.`);return}let n=this;if(o&&r(n,pe)[a]){console.warn(`Failed attempt at copying setup data from CH${e+1} to CH${a+1}.`);return}let h=G[e],b=G[a];r(n,N)[a]=r(n,N)[e],r(n,v).set(r(n,v).subarray(h,h+C.cc),b),n.pushChPrimitives(a)}setDrumFirstWrite(e,a){let o=this,n=r(o,D)[e];if(n<2)return;let h=n-2;if(r(o,Te)[h<<1]){if(a)r(o,Te)[h<<1]=0,O()&&console.debug(`First write part for drum set ${h+1} has been reset.`);else return;}else a?console.warn(`First write part for drum set ${h+1} is already blank.`):(r(o,Te)[h<<1]=1,r(o,Te)[h<<1|1]=e,console.debug(`First write part for drum set ${h+1} is set to CH${e+1}.`))}getChDrumFirstWrite(e){let a=this,o=r(a,D)[e];if(o<2)return;let n=o-2;return r(a,Te).subarray(n<<1,n+1<<1)}getDrumFirstWrite(e){if(e>=0&&e<C.drm)return r(this,Te).subarray(e<<1,e+1<<1)}switchMode(e,a=!1,o=!1){let n=this,h=$[e];if(h>-1){if(r(n,H)===0||a){switch(n.initOnReset&&a&&n.init(1),T(n,ie,0),h){case $.gm:{h=r(n,U).gm;break}case $.g2:{h=r(n,U).g2;break}}switch(T(n,H,h),h){case $.gs:case $.sc:{r(n,Z)[$[e]][1]=r(n,U)[e];break}}for(let y=0;y<C.ch;y++){let k=n.getChModeId(y,!0);r(n,D)[y]>0&&k===$["?"]&&(n.setChCc(y,0,r(n,Z)[h][2]),O()&&console.debug(`CH${y+1} (${r(n,D)[y]}) (${n.getChMode(y)}), ${W[k]} (${r(n,Z)[k][2]}) -> ${W[h]} (${r(n,Z)[h][2]})`),n.pushChPrimitives(y))}switch(h){case $.mt32:{fa.forEach((y,k)=>{let x=k+1;r(n,pe)[x]||(r(n,N)[x]=y,n.setChCc(x,91,127),n.pushChPrimitives(x))});for(let y=1;y<10;y++)n.pushChPrimitives(y);break}}let b,m;switch(h){case $["?"]:case $.g2:{b=[52,4,52,18,0,255,0,255,0,255,0,255,0,255,0,255];break}case $.xg:case $.cs1x:{b=[1,0,65,0,5,0,64,0,64,0,64,0,64,0,0,255],m=[64,0];break}case $.gm:case $.gs:case $.sc:{b=[40,4,40,18,40,32,32,0,0,255,0,255,0,255,0,255],m=[32,0];break}case $.sd:{b=[58,0,60,0,61,0,61,0],m=[61,0];break}case $["05rw"]:case $.x5d:case $.ns5r:{b=[44,1,44,19,0,255,0,255,0,255,0,255,0,255,0,255];break}case $.k11:case $.sg:{b=[24,0,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case $.mt32:{b=[40,4,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case $.doc:{b=[24,16,0,255,0,255,0,255,0,255,0,255,0,255,0,255];break}case $.motif:case $.s90es:case $.cs6x:{b=[129,0,133,0,130,0,128,0,128,0,0,255,0,255,0,255],m=[128,0];break}case $.pa:{b=[28,52,28,16,28,0,28,0,0,255,0,255,0,255,0,255],m=[28,0];break}case $.krs:{b=[45,0,45,0,0,255,45,0,45,0,45,0,45,0,45,0],m=[45,0];break}default:b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}for(let y=0;y<C.efx;y++)if(!r(n,ge)[3*y]&&typeof b[y<<1]=="number"){r(n,ge)[3*y+1]=b[y<<1],r(n,ge)[3*y+2]=b[y<<1|1];let k=!1;(m==null?void 0:m.length)>0&&b[y<<1]===m[0]&&b[y<<1|1]===m[1]&&(k=!0),n.pushEffectType(y,k)}o&&n.setDetectionTargets(e),n.dispatchEvent("mode",W[h]),n.forceVoiceRefresh()}}else throw new Error(`Unknown mode ${e}`)}getRawStrength(){let e=this;return r(this,J).forEach(function(a){let o=a>>7;r(e,j)[a]>r(e,Ie)[o]&&(r(e,Ie)[o]=r(e,j)[a])}),r(this,Ie)}getStrength(){let e=[],a=this;return this.getRawStrength().forEach(function(o,n){e[n]=Math.floor(o*a.getChCc(n,7)*a.getChCc(n,11)*r(a,z)/803288)}),e}newStrength(){r(this,Ie).fill(0)}runJson(e){var a;if(e.type>14)return e.type===15&&e.data.constructor!==Uint8Array&&(e.data=Uint8Array.from(e.data)),r(this,Kt)[e.type].call(this,e);{let o=this.chRedir(e.part,e.track),n=!1;(a=r(this,Ft)[o])==null||a.forEach(h=>{e.channel=h,n=!0,r(this,Kt)[e.type].call(this,e)}),n||console.warn(`${Qa[e.type]?Qa[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!==void 0?e.data[0]:e.data).toString():""} event sent to CH${o+1} without any recipient.`)}r(this,be).length>100&&r(this,be).splice(100,r(this,be).length-99)}runRaw(e){}async loadBank(e,a){let o=this;switch(e=e.toLowerCase(),e){case"s7e":{o.userBank.clearRange({msb:63,lsb:[21,22]}),o.userBank.clearRange({msb:63,lsb:[24,27]});break}case"pcg":{o.userBank.clearRange({msb:63,lsb:[6,9]}),o.userBank.clearRange({msb:63,lsb:[13,16]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":case"pcg":{Ut.context=this,await o.userBank.load(await Ut.read(e,a),!1);break}}o.forceVoiceRefresh()}},H=new WeakMap,ie=new WeakMap,Se=new WeakMap,xe=new WeakMap,He=new WeakSet,$t=function(){return r(this,xe)[r(this,ie)]},_r=function(e){r(this,xe)[r(this,ie)]=e},pe=new WeakMap,X=new WeakMap,D=new WeakMap,v=new WeakMap,ae=new WeakMap,N=new WeakMap,j=new WeakMap,ne=new WeakMap,J=new WeakMap,F=new WeakMap,Ne=new WeakMap,Ie=new WeakMap,at=new WeakMap,oe=new WeakMap,L=new WeakMap,_=new WeakMap,St=new WeakMap,de=new WeakMap,Te=new WeakMap,ge=new WeakMap,rt=new WeakMap,st=new WeakMap,q=new WeakMap,xt=new WeakMap,it=new WeakMap,me=new WeakMap,nt=new WeakMap,Tt=new WeakMap,Xe=new WeakMap,Me=new WeakMap,Mt=new WeakMap,Ve=new WeakMap,Z=new WeakMap,U=new WeakMap,De=new WeakMap,Xt=new WeakMap,z=new WeakMap,ot=new WeakMap,Pt=new WeakMap,ba=new WeakMap,ya=new WeakMap,ma=new WeakMap,Ea=new WeakMap,Fe=new WeakMap,Ke=new WeakMap,Vt=new WeakMap,At=new WeakMap,Le=new WeakMap,K=new WeakMap,jt=new WeakMap,Ft=new WeakMap,Q=new WeakMap,Rt=new WeakMap,ct=new WeakMap,be=new WeakMap,_e=new WeakMap,Ye=new WeakMap,ce=new WeakMap,lt=new WeakMap,ee=new WeakMap,Kt=new WeakMap,ea=new WeakMap,dt=new WeakMap,ft=new WeakMap,te=new WeakMap,Ee=new WeakMap,Pe=new WeakMap,ht=new WeakMap,ut=new WeakMap,pt=new WeakMap,ar);var $a=xa(ua(),1);B();B();var Yt,rr,ir=(rr=class{constructor(p,e,a,o){M(this,Yt,!1);T(this,Yt,p),this.start=e,this.end=a,this.data=o}get duration(){return this.ranged?this.end-this.start:0}get ranged(){return r(this,Yt)}},Yt=new WeakMap,rr),Ca=class extends ir{constructor(p,e,a){super(!0,p,e,a)}},nr=class extends ir{constructor(p,e){super(!1,p,p,e)}},gt,sr,wa=(sr=class extends Array{constructor(){super(...arguments);M(this,gt,-1)}resetIndex(e){T(this,gt,-1)}fresh(){this.sort(function(e,a){return e.start==a.start?0:(+(e.start>a.start)<<1)-1}),this.forEach(function(e,a){e.index=a})}step(e,a=!1){let o=[];if(a)for(let n=0;n<this.length&&!(this[n].start>e);n++){if(this[n].end<e)continue;o.push(this[n])}else{let n=this.getRange(r(this,gt)==-1?0:e-1,e),h=this;n.forEach(function(b){b.index>r(h,gt)&&(o.push(b),T(h,gt,b.index))})}return o}getRange(e,a){var m;e>a&&([e,a]=[a,e]);let o=[],n=-1,h=Math.ceil(Math.sqrt(this.length)),b=!0;for(let y=0;y<this.length;y+=h)this[y+h]?n<0&&this[y+h].start>=e&&(n=y):n=n<0?y:n;for(;b;)((m=this[n])==null?void 0:m.end)<a?this[n].start>=e&&o.push(this[n]):b=!1,n++;return o}},gt=new WeakMap,sr);var Hr=0xffffffffffff,or=function(p){let e=new wa,a=this,o=p.timeDivision,n=120,h=new wa,b=0,m=0;h.push(new Ca(0,Hr,[120,0])),p.track.forEach(function(t){b=0,t.event.forEach(function(s){b+=s.deltaTime,s.type===255&&(s==null?void 0:s.metaType)===81&&(n=6e7/s.data,h[h.length-1]&&h.push(new Ca(b,0xffffffffffff,[n,0])))})}),h.fresh(),h.forEach(function(t,s,f){s>0&&(f[s-1].end=t.start)});let y=120;h.forEach(function(t,s,f){s>0&&(t.end===t.start?f.splice(f.indexOf(t),1):y===t.data[0]&&(f[s-1].end=t.end,f.splice(f.indexOf(t),1)),y=t.data[0])});let k=0,x=120;return h.forEach(function(t){let s=t.start,f=s/x/o*60+k;x=t.data[0],k=f-s/x/o*60,t.data[1]=k}),console.debug("All tempo changes: ",h),n=120,b=0,m=0,p.track.forEach(function(t,s){b=0,m=0;let f=s+1;t.event.forEach(function(i,l){b+=i.deltaTime;let d=h.step(b,!0)[0];d&&(n=d.data[0],m=d.data[1]);let c={type:i.type,data:i.data,track:f,part:0};i.type>14?c.meta=i.metaType:c.part=i.channel,e.push(new nr(b/n/o*60+m,c))})}),e.fresh(),self.midiEvents=e,console.debug(`Parsed a type ${p.formatType} MIDI sequence.`),e};B();var Gr={866:"cp866","utf-8":"utf-8",utf8:"utf-8","utf-16":"utf-16",utf16:"utf-16","utf-16le":"utf-16",utf16le:"utf-16",unicode:"utf-16",unicodefeff:"utf-16","ucs-2":"utf-16","utf-16be":"utf-16be",utf16be:"utf-16be","utf-24":"utf-24",utf24:"utf-24","utf-24le":"utf-24",utf24le:"utf-24","utf-24be":"utf-24be",utf24be:"utf-24be","utf-32":"utf-32",utf32:"utf-32","utf-32le":"utf-32",utf32le:"utf-32","utf-32be":"utf-32be",utf32be:"utf-32be",latin1:"latin1",l1:"latin1",ascii:"latin1","us-ascii":"latin1","iso-8859-1":"latin1","iso8859-1":"latin1",cp1252:"latin1","windows-1252":"latin1",cp819:"latin1",ibm819:"latin1",latin2:"latin2",l2:"latin2","iso-8859-2":"latin2","iso8859-2":"latin2",latin3:"latin3",l3:"latin3","iso-8859-3":"latin3","iso8859-3":"latin3",latin4:"latin4",l4:"latin4","iso-8859-4":"latin4","iso8859-4":"latin4",latin5:"latin5",l5:"latin5","iso-8859-9":"latin5","iso8859-9":"latin5",cp1254:"latin5","windows-1254":"latin5",latin6:"latin6",l6:"latin6","iso-8859-10":"latin6","iso8859-10":"latin6",latin9:"latin9",l9:"latin9","iso-8859-15":"latin9","iso8859-15":"latin9","iso-8859-5":"iso-8859-5","iso8859-5":"iso-8859-5",cyrillic:"iso-8859-5","iso-8859-6":"iso-8859-6","iso8859-6":"iso-8859-6","iso-8859-6-e":"iso-8859-6","iso8859-6e":"iso-8859-6","iso-8859-6-i":"iso-8859-6","iso8859-6i":"iso-8859-6","asmo-708":"iso-8859-6","ecma-114":"iso-8859-6",arabic:"iso-8859-6","iso-8859-7":"iso-8859-7","iso8859-7":"iso-8859-7","ecma-118":"iso-8859-7",greek:"iso-8859-7",greek8:"iso-8859-7","iso-8859-8":"iso-8859-8","iso8859-8":"iso-8859-8","iso-8859-8-e":"iso-8859-8","iso8859-8e":"iso-8859-8",hebrew:"iso-8859-8",visual:"iso-8859-8","iso-8859-8-i":"iso-8859-8-i","iso8859-8i":"iso-8859-8-i",logical:"iso-8859-8-i","iso-8859-11":"iso-8859-11","iso8859-11":"iso-8859-11","windows-874":"iso-8859-11","dos-874":"iso-8859-11",cp874:"iso-8859-11","tis-620":"iso-8859-11","iso-8859-13":"iso-8859-13","iso8859-13":"iso-8859-13",latin7:"iso-8859-13",l7:"iso-8859-13","iso-8859-14":"iso-8859-14","iso8859-14":"iso-8859-14",latin8:"iso-8859-14",l8:"iso-8859-14","iso-8859-16":"iso-8859-16","iso8859-16":"iso-8859-16",cp866:"cp866",ibm866:"cp866",cp1250:"cp1250","windows-1250":"cp1250",cp1251:"cp1251","windows-1251":"cp1251",cp1253:"cp1253","windows-1253":"cp1253",cp1255:"cp1255","windows-1255":"cp1255",cp1256:"cp1256","windows-1256":"cp1256",cp1257:"cp1257","windows-1257":"cp1257",cp1258:"cp1258","windows-1258":"cp1258","euc-jp":"euc-jp",cp954:"euc-jp","euc-kr":"euc-kr",koi8:"koi8",koi:"koi8","koi8-r":"koi8","koi8-u":"koi8-u","koi8-ru":"koi8-u",mac:"mac",macintosh:"mac","mac-cyrillic":"x-mac-cyrillic","x-mac-cyrillic":"x-mac-cyrillic","x-mac-ukrainian":"x-mac-cyrillic",gbk:"gbk",gb2312:"gbk",chinese:"gbk","euc-cn":"gbk",gb18030:"gb18030",big5:"big5","big5-hkscs":"big5",sjis:"sjis","shift-jis":"sjis",ms932:"sjis","windows-31j":"sjis"},Xr={"utf-8":1,"utf-16":2,"utf-16be":3,"utf-24":4,"utf-24be":5,"utf-32":6,"utf-32be":7,latin1:0,latin2:0,latin3:0,latin4:0,latin5:0,latin6:0,latin9:0,"iso-8859-5":0,"iso-8859-6":0,"iso-8859-7":0,"iso-8859-8":0,"iso-8859-8-i":0,"iso-8859-11":0,"iso-8859-13":0,"iso-8859-14":0,"iso-8859-16":0,cp866:0,cp1250:0,cp1251:0,cp1253:0,cp1255:0,cp1256:0,cp1257:0,cp1258:0,"euc-jp":1,"euc-kr":1,koi8:0,"koi8-u":0,mac:0,"x-mac-cyrillic":0,gbk:1,gb18030:1,big5:1,sjis:1},Oe,ze=(Oe=class{static getUnitSize(p){if(p>7)throw new RangeError("Cannot decode encodings with more than 4 bits per unit.");return(p>>1)+1}static isBigEndian(p){return(p&1)===1}static collapse(p){let e=Gr[p];if(typeof e!="string")throw new TypeError(`Provided label "${p}" is not supported.`);return e}static indicator(p){let e=Xr[p];if(typeof e!="number")throw new TypeError(`Provided collapsed label "${p}" is not supported.`);return e}},P(Oe,"BYTE_1",0),P(Oe,"BYTE_1_VL",1),P(Oe,"BYTE_2_LE",2),P(Oe,"BYTE_2_BE",3),P(Oe,"BYTE_3_LE",4),P(Oe,"BYTE_3_BE",5),P(Oe,"BYTE_4_LE",6),P(Oe,"BYTE_4_BE",7),Oe),fe=(p,e)=>{p.unsent=!1,p.enqueue(e)},aa=(p,e,a=1,o=!0)=>{if(typeof a!="number"||a<=0||a>4)throw new RangeError(`Invalid byte size ${a}.`);if(!(p instanceof Uint8Array||p instanceof Uint8ClampedArray))throw new TypeError("Input buffer is not Uint8Array.");if(typeof e!="number"||e<0||e>=p.length)throw new RangeError(`Provided offset ${e} is out of buffer range.`);if(a===1)return p[e];{let n=0;if(o)for(let h=0;h<a;h++)n<<=8,n|=p[e+h];else for(let h=0;h<a;h++)n|=p[e+h]<<(h<<3);return n<0?n+4294967296:n}},Vr=class{static lineRaw(p,e=0){if(typeof e!="number"||e<0||e>7)throw new TypeError("Invalid split mode.");if(!p||(p==null?void 0:p.constructor)!==ReadableStream)throw new TypeError("Not a readable stream.");let a=ze.getUnitSize(e),o=ze.isBigEndian(e),n=p.getReader(),h,b=!1,m=[],y=0,k=0,x=0;return new ReadableStream({pull:async t=>{for(t.unsent=!0;t.unsent;){if(!h||y>=h.length){y>k&&(m.push(h.subarray(k)),k=0);let s=await n.read();h=s.value,b=s.done,y=0}if(h){let s=0;if(a===1)s=h[y];else if(o)for(let i=0;i<a;i++)s<<=8,s|=h[y+i];else for(let i=0;i<a;i++)s|=h[y+i]<<(i<<3);let f=!1;switch(s){case 10:{x===13?k+=a:f=!0;break}case 13:{f=!0;break}}if(f){if(m.length){m.push(h.subarray(k,y));let i=0;for(let c=0;c<m.length;c++)i+=m[c].length;let l=new Uint8Array(i),d=0;for(let c=0;c<m.length;c++)l.set(m[c],d),d+=m[c].length;fe(t,l),m=[]}else fe(t,h.subarray(k,y));k=y+=a}x=s}if(b){if(k!==y&&h&&m.push(h.subarray(k,y)),m.length){let s=0;for(let l=0;l<m.length;l++)s+=m[l].length;let f=new Uint8Array(s),i=0;for(let l=0;l<m.length;l++)f.set(m[l],i),i+=m[l].length;fe(t,f)}t.unsent=!1,t.close()}y+=a}}},new ByteLengthQueuingStrategy({highWaterMark:256}))}static chunkRaw(p,e="utf-8"){if(!p||(p==null?void 0:p.constructor)!==ReadableStream)throw new TypeError("Not a readable stream.");let a=ze.indicator(e),o=ze.getUnitSize(a),n=ze.isBigEndian(a),h=p.getReader(),b;return new ReadableStream({pull:async m=>{m.unsent=!0;let{value:y,done:k}=await h.read();if(y){let x=0,t=y.length;if(a!==0&&typeof(b==null?void 0:b.length)=="number"){let s=!1;switch(e){case"big5":case"gbk":case"sjis":case"euc-kr":{x=1;let f=new Uint8Array(2);f[0]=b[0],f[1]=y[0],fe(m,f);break}case"euc-jp":{let f=3;b[0]===143?x=3-b.length:b[0]>127?(x=1,f=2):f=b.length;let i=new Uint8Array(3);i.set(b),i.set(y.subarray(0,x),b.length),fe(m,i.subarray(0,f));break}case"gb18030":{let f=new Uint8Array(4),i=4;f.set(b),f.set(y.subarray(0,4-b.length),b.length),f[0]<128?i=b.length:f[1]>=64?(x=1,i=2):x=4-b.length,fe(m,f.subarray(0,i));break}case"utf-8":{let f=4;b[0]>=240?x=4-b.length:b[0]>=224?(x=3-b.length,f=3):b[0]>=192?(x=1,f=2):f=b.length;let i=new Uint8Array(4);i.set(b),i.set(y.subarray(0,x),b.length),fe(m,i.subarray(0,f));break}case"utf-16":case"utf-16be":{let f=new Uint8Array(4);f.set(b),f.set(y.subarray(0,4-b.length)),x=4-b.length,aa(transientSize,0,2,n)>=55296&&aa(transientSize,2,2,n)>=55296?fe(m,f):(fe(m,f.subarray(0,2)),fe(m,f.subarray(2)));break}default:{let f=new Uint8Array(o);f.set(b),f.set(y.subarray(0,o-b.length),b.length),fe(m,f)}}}if(b=void 0,a===0)fe(m,y.subarray(x));else{switch(e){case"utf-24":case"utf-24be":{t=Math.floor((y.length-x)/o)*o+x;break}case"utf-32":case"utf-32be":{t=(y.length-x>>2<<2)+x;break}case"utf-8":{if(y[y.length-1]>127){let s=!0,f=y.length,i=y.length-8;for(;s&&f>i;)f--,y[f]<128?t=f+1:y[f]>192&&(t=f)}break}case"utf-16":case"utf-16be":{if(t=(y.length-x>>1<<1)+x,aa(y,t-2,2,n)>=55296){let s=!0,f=t,i=t-6;for(;s&&f>i;)f-=2,aa(y,f,2,n)>>10===54&&(t=f)}break}default:throw new TypeError("Maybe someday the rest of the decoders will be implemented")}fe(m,y.subarray(x,t))}t<y.length&&(b=y.subarray(t))}k&&(typeof(b==null?void 0:b.length)=="number"&&fe(m,b),m.unsent=!1,m.close())}},new ByteLengthQueuingStrategy({highWaterMark:256}))}static line(p,e="utf-8",a){let o=ze.collapse(e),n=ze.indicator(o),h=this.lineRaw(p,n).getReader(),b=new TextDecoder(o,onlostpointercapture);return new ReadableStream({pull:async m=>{let{value:y,done:k}=await h.read();y&&m.enqueue(b.decode(y)),k&&m.close()}})}static chunk(p,e="utf-8",a){let o=ze.collapse(e);if(self.TextDecoderStream){let n=new TextDecoderStream(o,a);return p.pipeTo(n.writable),n.readable}else{let n=this.chunkRaw(p,o).getReader(),h=new TextDecoder(o);return new ReadableStream({pull:async b=>{let{value:m,done:y}=await n.read();m&&(console.debug(m),b.enqueue(h.decode(m))),y&&b.close()}})}}},cr=Vr;B();var ka={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"\t",v:"\x0B","\\":"\\","'":"'","\"":"\""},va=new Uint8Array(128);va.fill(1,48,58);va.fill(1,65,71);va.fill(1,97,103);var It=new Uint8Array(256);It.fill(1,0,32);It.fill(1,128,160);It[127]=1;var Fr={};for(let p in ka){let e=ka[p];Fr[e]=`\\${p}`,It[e.charCodeAt(0)]=2}It[34]=3;It[39]=3;var lr=p=>{let e="",a=!1;for(let o=0;o<p.length;o++){let n=p[o];if(a){let h=0;switch(n){case"x":{h=2;break}case"u":{h=4;break}case"U":{h=8;break}default:{let b=ka[n];if(typeof b=="string")e+=b;else throw new Error(`Invalid escape identifier "${n}" at index ${o}`);a=!1;continue}}if(h>0){let b=o+1,m=p.substring(b,b+h);if(m.length<h)throw new RangeError(`Insufficient code point buffer "${m}" at index ${b}`);let y=parseInt(m,16);if(Number.isNaN(y))throw new RangeError(`Malformed code point representation "${m}" at index ${b}`);if(y>=1114112)throw new RangeError(`Code point "${m}" exceeds 0x10ffff at index ${b}`);e+=String.fromCodePoint(y),a=!1,o+=h}}else n==="\\"?a=!0:e+=n}return e},Kr=(p,e=0)=>{};self.TextEscape=Kr;var We,ra=(We=class{static parse(p,e){let a=p&this.MASK_TYPE,o=p&this.MASK_DATA,n=0,h=0,b,m=0,y,k=e.getReader();return new ReadableStream({pull:async x=>{let{value:t,done:s}=await k.read();if(typeof t=="string"){switch(a){case this.TYPE_TSV:{b=[];try{for(let f of t.split("\t"))switch(o){case this.DATA_TEXT:{b.push(lr(f));break}case this.DATA_JSON:{b.push(n===0?lr(f):JSON.parse(f));break}default:throw new TypeError(`Unknown DSV value type ${a}`)}}catch(f){console.debug(`The following error appeared when parsing on line ${n+1}.`),console.error(f)}break}case this.TYPE_CSV:{if(o!==this.DATA_TEXT)throw new TypeError(`Invalid type ${a} for CSV, only plain text is allowed`);break}default:throw new TypeError(`Unknown DSV type ${a}`)}x.enqueue(b),n++}s&&x.close()}})}static parseObjects(p,e){let a=0,o=this.parse(p,e).getReader(),n;return new ReadableStream({start:async h=>{let{value:b,done:m}=await o.read();typeof(b==null?void 0:b.length)=="number"&&(n=b),m&&h.close()},pull:async h=>{let{value:b,done:m}=await o.read();if(typeof(b==null?void 0:b.length)=="number"){let y={};for(let k=0;k<b.length;k++)b[k]&&(y[n[k]]=b[k]);h.enqueue(y)}m&&h.close()}})}},P(We,"MASK_TYPE",3),P(We,"MASK_DATA",12),P(We,"TYPE_TSV",0),P(We,"TYPE_CSV",1),P(We,"DATA_TEXT",0),P(We,"DATA_JSON",4),We);$a.default.customInterpreter=za;var V=(p,e,a)=>{p.addEventListener(a,o=>{e.dispatchEvent(a,o.data)})},dr=p=>{let e=p.split("/");return e[e.length-1]||e[e.length-2]||"(remote)"},bt,qe,Dt,Ge,Ce,yt,Lt,mt,zt,Qe,Je,we,le,Ue,Et,Be,Ze,je,fr,gi=(fr=class extends Qt{constructor(e,a=.5,o=.5){super();P(this,"device");M(this,bt,void 0);M(this,qe,{});M(this,Dt,[]);M(this,Ge,new Map);M(this,Ce,"");M(this,yt,[]);M(this,Lt,[]);M(this,mt,new Uint8ClampedArray(128));M(this,zt,new Uint8ClampedArray(128));M(this,Qe,.5);M(this,Je,120);M(this,we,4);M(this,le,4);M(this,Ue,0);M(this,Et,0);M(this,Be,new Array(C.ch));M(this,Ze,new Uint8Array(C.ch));M(this,je,0);P(this,"smoothAttack",0);P(this,"smoothDecay",0);let n=this;n.smoothAttack=a,n.smoothDecay=o,n.device=e,n.addEventListener("meta",function(h){var b;(b=h==null?void 0:h.data)==null||b.forEach(function(m){(r(n,yt)[m.meta]||console.debug).call(n,m.meta,m.data)})}),V(n.device,n,"mode"),V(n.device,n,"mastervolume"),V(n.device,n,"channelactive"),V(n.device,n,"channelmin"),V(n.device,n,"channelmax"),V(n.device,n,"portrange"),V(n.device,n,"portstart"),V(n.device,n,"channelreset"),V(n.device,n,"channeltoggle"),V(n.device,n,"screen"),V(n.device,n,"metacommit"),V(n.device,n,"voice"),V(n.device,n,"pitch"),V(n.device,n,"note"),V(n.device,n,"reset"),V(n.device,n,"banklevel"),V(n.device,n,"efxreverb"),V(n.device,n,"efxchorus"),V(n.device,n,"efxdelay"),V(n.device,n,"efxinsert0"),V(n.device,n,"efxinsert1"),V(n.device,n,"efxinsert2"),V(n.device,n,"efxinsert3"),V(n.device,n,"efxinsert4"),V(n.device,n,"partefxtoggle"),V(n.device,n,"chmode"),n.addEventListener("note",function({data:h}){r(n,Lt).push(h)}),n.addEventListener("voice",({data:h})=>{n.refreshCachedChVoice(h.part)}),n.addEventListener("reset",({data:h})=>{r(n,Ze).fill(1)}),r(n,Ze).fill(1),r(n,yt)[3]=function(h,b){var m;((m=r(n,Ce))==null?void 0:m.length)<1&&(T(n,Ce,b),n.dispatchEvent("title",r(n,Ce)))},r(n,yt)[81]=function(h,b){let m=n.noteProgress,y=r(n,Qe)||.5;T(n,Je,6e7/b),T(n,Qe,b/1e6),T(n,Ue,r(n,Ue)+(m*(y/r(n,Qe))-m)),n.dispatchEvent("tempo",r(n,Je))},r(n,yt)[88]=function(h,b){let m=n.noteBar,y=n.noteBeat,k=r(n,we),x=r(n,le);T(n,we,b[0]),T(n,le,1<<b[1]);let t=Math.round(m+y/k);k!==r(n,we)&&T(n,Ue,r(n,Ue)-t*(r(n,we)-k)*(4/r(n,le))),x!==r(n,le)&&(console.debug(`${m}/${y}`),x<r(n,le)?T(n,Ue,r(n,Ue)+t*(r(n,le)-x)*(x/r(n,le))):T(n,Ue,r(n,Ue)+t*(r(n,le)-x)*(r(n,le)/x))),n.dispatchEvent("tsig",n.getTimeSig())},n.addEventListener("metacommit",({data:h})=>{var b;switch(h.type){case"KarTitle":case"EORTitle":{((b=r(n,Ce))==null?void 0:b.length)<1&&(T(n,Ce,h.data),n.dispatchEvent("title",r(n,Ce)));break}}})}reset(){var a;let e=this;e.dispatchEvent("reset"),(a=r(e,bt))==null||a.resetIndex(),e.device.init(),T(e,Ce,""),T(e,Qe,.5),T(e,Je,120),T(e,we,4),T(e,le,4),T(e,Ue,0),T(e,Et,0),e.dispatchEvent("tempo",r(e,Je)),e.dispatchEvent("title",r(e,Ce)),e.dispatchEvent("tsig",e.getTimeSig())}init(){this.reset(),T(this,bt,void 0)}async loadFile(e){T(this,bt,or($a.default.parse(new Uint8Array(await e.arrayBuffer()))))}async loadMap(e,a,o,n="(internal)"){let h=this,b=0,m=0,y=0,k=0,x,t;e.split(`
`).forEach((s,f)=>{var l;if(!s)return;let i=s.split("\t");if(f){if(!k)return;let d="",c="";i.forEach((u,E)=>{switch(E){case x:{d=u;break}case t:{c=u;break}}});let g=!1;((l=r(h,qe)[d])==null?void 0:l.priority)>o&&(g=!0,y++),!r(h,qe)[d]||g||a?(r(h,qe)[d]={name:c,priority:o},b++):self.debugMode&&console.debug(`Voice "${c}" (${d}) seems to be in conflict with (${r(h,qe)[d]}).`),m++}else i.forEach((d,c)=>{switch(d){case"ID":{x=c,k++;break}case"Name":{t=c,k++;break}default:console.debug(`Unknown map field: ${d}`)}})}),console.debug(`Voice names: From "${n}", ${m} total, ${b} loaded (${b-y} + ${y}).`),h==null||h.device.forceVoiceRefresh()}async loadMapPaths(e){let a=this;e.forEach(async(o,n)=>{a.loadMap(await(await fetch(o)).text(),0,n,dr(o))})}async loadEfx(e,a){let o=this,n=0,h=0,b,m,y;e.split(`
`).forEach((k,x)=>{if(k)if(x){let t=0,s;k.split("\t").forEach((f,i)=>{switch(i){case b:{t|=(parseInt(f,16)&255)<<8;break}case m:{t|=parseInt(f,16)&255;break}case y:{s=f;break}}}),!r(o,Dt)[t]||a?(r(o,Dt)[t]=s,n++):self.debugMode&&console.debug(`EFX ID 0x${t.toString(16).padStart(4,"0")} (${s}) seems to be in conflict.`),h++}else k.split("\t").forEach((t,s)=>{switch(t){case"MSB":{b=s;break}case"LSB":{m=s;break}case"Name":{y=s;break}default:console.debug(`Unknown EFX field: ${t}`)}})}),console.debug(`EFX: ${h} total, ${n} loaded.`);for(let k=0;k<Gt.length;k++){let x=!1,t=o.device.getEffectType(k);t[0]===0&&t[1]>>4===15&&(x=!0),o.dispatchEvent(`efx${Gt[k]}`,{id:t,hidden:x})}}async loadModels(e,a){let o=this,n=0,h=0}async loadStyles(e,a){let o=this,n=0,h=0}async loadProps(e,a,o=0,n="(internal)"){var k,x;let h=this,b=0,m=0,y=0;try{for(var t=Ma(ra.parseObjects(ra.DATA_TEXT|ra.TYPE_TSV,cr.line(e))),s,f,i;s=!(f=await t.next()).done;s=!1){let l=f.value;if(typeof(l==null?void 0:l.voiceId)=="string")if(m++,!(r(h,Ge).has(l.voiceId)||((k=r(h,Ge).get(l.voiceId))==null?void 0:k.priority)<=o)||a){if(Object.keys(l).length<2)continue;((x=r(h,Ge).get(l.voiceId))==null?void 0:x.priority)>o&&y++,l.priority=o,h.handleProp&&(await h.handleProp(l)),r(h,Ge).set(l.voiceId,l),b++}else console.debug(`Tried to write a pre-existing entry "${l.voiceId}" on entry ${m}.`)}}catch(f){i=[f]}finally{try{s&&(f=t.return)&&(await f.call(t))}finally{if(i)throw i[0]}}console.debug(`Voice properties: From "${n}", ${m} total, ${b} loaded (${b-y} + ${y}).`)}async loadPropsPaths(e){let a=this;e.forEach(async(o,n)=>{let h=o.split("/");a.loadProps((await fetch(o)).body,0,n,dr(o))})}switchMode(e,a=!1){this.device.switchMode(e,a)}getMode(){return this.device.getMode()}getVoice(){return this.device.getVoice(...arguments)}getChVoice(e){return this.device.getChVoice(e)}refreshCachedChVoice(e,a){var m;let o=this,n=a!=null?a:o.device.getChVoice(e),h=r(o,Be)[e],b=!0;if(qt(o,je)._++,!a)switch(o.device.getChMode(e)){case"xg":{o.device.getChType(e)>0&&n.ending==="!"&&(b=!1,h.refreshFailure=!0,console.debug("Cached voice persisted due to invalid drum kit."));break}case"gs":case"sc":{n.ending!==" "&&(n.sid[2]===1?(n.name="Silence",n.refreshFailure=!0,console.debug("Cached voice nullified due to invalid SC-55 voice.")):(b=!1,h.refreshFailure=!0,console.debug("Cached voice persisted due to invalid GS voice.")));break}}return b?(r(o,Be)[e]=n,r(o,Ze)[e]=(m=n.poly)!=null?m:1,r(o,je)>1?console.debug(`Bubbling prevented at instance #${r(o,je)}.`):o.dispatchEvent("cachedvoice",{part:e}),qt(o,je)._--,n):(qt(o,je)._--,h)}getCachedChVoice(e){var h,b;let a=this,o=r(a,Be)[e],n=(h=a.device)==null?void 0:h.getChPrimitives(e,!0);if(o&&((b=a.device)==null?void 0:b.getChCvnIsWritten(e))===0)switch(o.ending){case"?":case"!":return a.refreshCachedChVoice(e,void 0);default:return Ya(o.sid,n)[1]!==0?a.refreshCachedChVoice(e):o}else return a.refreshCachedChVoice(e)}getChPrimitive(e,a,o){return this.device.getChPrimitive(e,a,o)}getChPrimitives(e,a){return this.device.getChPrimitives(e,a)}getMapped(e){var a;return((a=r(this,qe)[e])==null?void 0:a.name)||e}getEfx(e){let[a,o]=e,n=a<<8|o;return r(this,Dt)[n]||`0x${n.toString(16).padStart(4,"0")}`}getVoxBm(e){if(!e)throw new Error("Voice object must be valid");let a=this;if(!a.voxBm)throw new Error("Voice bitmap repository isn't yet initialized");let o=a.voxBm.getBm(e.name);if(!o)switch(e.mode){case"xg":{switch(e.sid[0]){case 0:case 80:case 81:case 83:case 84:case 96:case 97:case 99:case 100:{o=a.voxBm.getBm(a.getVoice(Ae.bank0,e.sid[1],Ae.bank0,e.mode).name);break}}break}case"g2":case"sd":{switch(e.sid[0]){case 96:case 97:case 98:case 99:{o=a.voxBm.getBm(a.getVoice(Ae.bank0,e.sid[1],Ae.bank0,e.mode).name);break}case 104:case 105:case 106:case 107:{o=a.voxBm.getBm(a.getVoice(120,e.sid[1],Ae.bank0,e.mode).name);break}}break}case"gs":case"sc":case"k11":case"sg":case"gm":{switch(e.sid[0]){case 120:break;case 122:case 127:{o=a.voxBm.getBm(a.getVoice(120,e.sid[1],0,e.mode).name);break}default:o=a.voxBm.getBm(a.getVoice(0,e.sid[1],0,e.mode).name)}break}default:switch(e.sid[0]){case 56:{o=a.voxBm.getBm(a.getVoice(0,e.sid[1],0,e.mode).name);break}}}return o||(o=a.voxBm.getBm(a.getVoice(e.sid[0],e.sid[1],0,e.mode).name)),o}getChBm(e,a){let o=this;a=a!=null?a:o.getChVoice(e);let n=o.getVoxBm(a);if(!n){if(!o.sysBm)return;switch(a.mode){case"xg":{switch(a.sid[0]){case 126:{a.sid[1]>>1===56&&(n=o.sysBm.getBm("cat_smpl"));break}case 16:{n=o.sysBm.getBm("cat_smpl");break}case 64:case 67:{n=o.sysBm.getBm("cat_sfx");break}case 32:case 33:case 34:case 35:case 36:case 48:case 82:{n=o.sysBm.getBm("cat_xg");break}}break}default:switch(a.sid[0]){case 63:case 32:case 33:case 34:case 35:case 36:case 48:case 82:{n=o.sysBm.getBm("cat_mex");break}}}}return n||(o.device.getChType(e)?n=o.sysBm.getBm("cat_drm"):n=o.sysBm.getBm("no_vox")),n}getProps(e){let a=this,o,n,h=0,b=e;for(;h<8&&o==null&&(!(n!=null&&n.constructor)||n instanceof Array&&(n[1]!==e.eid[1]||n[2]!==e.eid[2]));)n=e.eid,typeof e.voice=="string"&&(r(a,Ge).has(e.voice)?o=r(a,Ge).get(e.voice):e=a.getVoice(n[0],n[2]===0?0:n[1],n[2]===0?0:n[2]-1));return!o&&h===8&&console.info(`Voice property fetching failed for "${e.name}" (${e.eid.join(" ")}).`),o}get noteProgress(){return r(this,Et)/r(this,Qe)}get noteOverall(){return(this.noteProgress-r(this,Ue))*r(this,le)/4}get noteBar(){return Math.floor(this.noteOverall/r(this,we))}get noteBeat(){let e=this.noteOverall%r(this,we);return e<0&&(e+=r(this,we)),e}get noteOffset(){return r(this,Ue)}getTimeSig(){return[r(this,we),r(this,le)]}getTempo(){return r(this,Je)}getChCachedVoice(e){return r(this,Be)[e]}eachVoice(e,a=!1){var n;let o=this;for(let h=0;h<r(o,Be).length;h++)(a||(n=o.device)!=null&&n.getChActive(h))&&e(r(o,Be)[h],h,r(o,Be))}sendCmd(e){this.device.runJson(e)}render(e){var w;e>r(this,Et)&&T(this,Et,e);let a=((w=r(this,bt))==null?void 0:w.step(e))||[],o=0,n=0,h=new Set,b={},m=[],y=this,k=[];for(y.device.getStrength().forEach((A,R)=>{r(y,zt)[R]=A}),y.device.newStrength(),a.forEach(function(A){let R=A.data,I=y.device.runJson(R);switch(I==null?void 0:I.reply){case"meta":{k.push(I);break}}I!=null&&I.reply&&delete I.reply});r(y,Lt).length>0;){let A=r(y,Lt).shift(),R=A.part<<7|A.note;A.state?(h.add(R),b[R]=A.velo):h.has(R)&&(m.push({part:A.part,note:A.note,velo:b[R],state:y.device.NOTE_SUSTAIN}),o++,n+=r(y,Ze)[A.part])}(k==null?void 0:k.length)>0&&y.dispatchEvent("meta",k);let x=y.device.getActive(),t=[],s=y.device.getPitch(),f=y.device.getCcAll(),i=y.device.getProgram(),l=y.device.getChTypes(),d=[],c=y.device.getStrength();c.forEach(function(A,R,I){I[R]=Math.max(r(y,zt)[R],A);let re=I[R]-r(y,mt)[R];if(re>=0){let Y=4*.25**(y.device.getChCc(R,73)/64);r(y,mt)[R]+=Math.ceil(re-re*y.smoothAttack**Y)}else{let Y=4*.25**(y.device.getChCc(R,72)/64);r(y,mt)[R]+=Math.floor(re-re*y.smoothDecay**Y)}});let g=0,u=0;return x.forEach(function(A,R){A&&(t[R]=y.device.getVel(R),d[R]=y.device.getExt(R),g+=t[R].size,u+=t[R].size*r(y,Ze)[R])}),{extraPoly:o,extraPolyEC:n,extraNotes:m,curPoly:g,curPolyEC:u,chInUse:x,chKeyPr:t,chPitch:s,chProgr:i,chContr:f,chType:l,chExt:d,eventCount:a.length,title:r(y,Ce),bitmap:y.device.getBitmap(),letter:y.device.getLetter(),texts:y.device.getTexts(),master:y.device.getMaster(),mode:y.device.getMode(),strength:r(y,mt).slice(),velo:c,rpn:y.device.getRpn(),tSig:y.getTimeSig(),tempo:y.getTempo(),noteBar:y.noteBar,noteBeat:y.noteBeat,ace:y.device.getAce(),rawVelo:y.device.getStrength(),rawStrength:y.device.getRawStrength(),rawPitch:y.device.getRawPitch(),efxSink:y.device.getEffectSink()}}},bt=new WeakMap,qe=new WeakMap,Dt=new WeakMap,Ge=new WeakMap,Ce=new WeakMap,yt=new WeakMap,Lt=new WeakMap,mt=new WeakMap,zt=new WeakMap,Qe=new WeakMap,Je=new WeakMap,we=new WeakMap,le=new WeakMap,Ue=new WeakMap,Et=new WeakMap,Be=new WeakMap,Ze=new WeakMap,je=new WeakMap,fr);export{gi as RootDisplay,C as allocated,S as ccToPos,ye as dnToPos};