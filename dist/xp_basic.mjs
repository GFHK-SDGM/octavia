var Ka=Object.create;var zt=Object.defineProperty;var Fa=Object.getOwnPropertyDescriptor;var Ya=Object.getOwnPropertyNames;var za=Object.getPrototypeOf,Wa=Object.prototype.hasOwnProperty;var qa=(g,e,a)=>e in g?zt(g,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):g[e]=a;var ca=(g,e)=>()=>(g&&(e=g(g=0)),e);var Qa=(g,e)=>()=>(e||g((e={exports:{}}).exports,e),e.exports);var Za=(g,e,a,h)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Ya(e))!Wa.call(g,o)&&o!==a&&zt(g,o,{get:()=>e[o],enumerable:!(h=Fa(e,o))||h.enumerable});return g};var oa=(g,e,a)=>(a=g!=null?Ka(za(g)):{},Za(e||!g||!g.__esModule?zt(a,"default",{value:g,enumerable:!0}):a,g));var P=(g,e,a)=>(qa(g,typeof e!="symbol"?e+"":e,a),a),la=(g,e,a)=>{if(!e.has(g))throw TypeError("Cannot "+a)};var t=(g,e,a)=>(la(g,e,"read from private field"),a?a.call(g):e.get(g)),S=(g,e,a)=>{if(e.has(g))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(g):e.set(g,a)},$=(g,e,a,h)=>(la(g,e,"write to private field"),h?h.call(g,a):e.set(g,a),a),da=(g,e,a,h)=>({set _(o){$(g,e,o,a)},get _(){return t(g,e,h)}});var ha=ca(()=>{"use strict";N();(function(){var g=function(v,m,r){var d,i;if(self.MessageEvent)switch(v){case"message":{i=new MessageEvent(v,{data:m,ports:r==null?void 0:r.ports}),Object.defineProperty(i,"source",{value:r==null?void 0:r.source});break}default:i=new Event(v)}else i=document.createEvent("Event"),i.initEvent(v,!1,!1),r&&v=="message"&&(i.data=m,r.source&&Object.defineProperty(i,"source",{value:r.source}),(d=r.ports)!=null&&d.length&&Object.defineProperty(i,"ports",{value:r.ports}));return i};self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),a=[],h={},o=function(v){var m,r=this;if((this==null?void 0:this.constructor)!=o)throw new TypeError("Illegal constructor");a.push(this),(m=h[v])!=null&&m.constructor||(h[v]=[]),h[v].push(this);var d=Math.floor(Math.random()*281474976710656),i=[],s=0,n=[],c=!0,l=!1;Object.defineProperty(this,"id",{get:function(){return d}}),Object.defineProperty(this,"name",{value:v}),this.close=function(){var f,E=a.indexOf(r);E>-1?(e.postMessage({t:"d",c:v,i:d}),a.splice(E,1),(f=h[v])!=null&&f.constructor&&(E=h[v].indexOf(r),E>-1&&h[v].splice(E,1)),h[v].length||delete h[v],console.debug("[Snowy] BroadcastChannel closed."),l=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(f){if(e){if(l)throw new Error("Channel already closed");e.postMessage({t:"m",c:v,i:d,m:s,d:f}),s++,s>4294967295&&(s=0)}else n.push(f),console.debug("[Snowy] Message is cached.")},this.flush=function(){if(e){if(c){for(e.postMessage({t:"r",c:v,i:d}),console.debug("[Snowy] ".concat(n.length," message(s) in cache."));n.length;){var f=n.shift();r.postMessage(f)}c=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(f){f.c==v?f.i!=d&&r.dispatchEvent(g("message",f.d,{source:r})):console.debug("[Snowy] Channel ID mismatch. Instance ".concat(d," receives from ").concat(v,", not ").concat(f.c,"."))};var u={};this.dispatchEvent=function(f){var E,C;if(Object.defineProperty(f,"target",{value:r}),Object.defineProperty(f,"currentTarget",{value:r}),(E=u[f.type])!=null&&E.length)for(var T=u[f.type],D=0;D<T.length;D++)((C=T[D])==null?void 0:C.constructor)==Function&&T[D].call(r,f);r["on".concat(f.type)]&&r["on".concat(f.type)].constructor==Function&&r["on".concat(f.type)].call(r,f)},this.addEventListener=function(f,E){var C;(C=u[f])!=null&&C.constructor||(u[f]=[]);var T=u[f].indexOf(E);T==-1&&u[f].push(E)},this.removeEventListener=function(f,E){var C,T;if((C=u[f])!=null&&C.length){var D=u[f].indexOf(E);D>-1&&u[f].splice(D,1)}!((T=u[f])!=null&&T.length)&&u[f].constructor&&delete u[f]}},self.BroadcastChannel=o,p=function(){if(e){e.addEventListener("message",function(m){var r=m.data,d=!1;switch(r.t){case"k":{d=!1,e.postMessage({t:"k"});break}case"m":{var i=h[r.c];if(i!=null&&i.length)for(var s=0;s<i.length;s++)i[s].receiveMessage(r);break}case"c":{for(var n=[],c=0;c<a.length;c++){var l=a[c].name;n.indexOf(l)<0&&n.push(l)}e.postMessage({t:"k",c:n});break}default:d=!0}d&&console.info("ReceiveBroadcast",r)});for(var v=0;v<a.length;v++)a[v].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},y=function(){if(!e){var v=new SharedWorker(self.SNOWY_PATH||"/snowy.js");v.port.start();var m=function(r){r.data.t=="swc"&&(v.port.removeEventListener("message",m),e=v.port,e.postMessage({t:"k"}),p())};v.port.addEventListener("message",m)}},y());var e,a,h,o,p,y})()});var N=ca(()=>{"use strict";ha();{let g=function(e,a){let h=new FileReader;return new Promise((o,p)=>{switch(h.addEventListener("abort",()=>{p(new Error("Blob read aborted"))}),h.addEventListener("error",y=>{p(h.error||y.data||new Error("Blob read error"))}),h.addEventListener("load",()=>{o(h.result)}),a.toLowerCase()){case"arraybuffer":case"buffer":{h.readAsArrayBuffer(e);break}case"string":case"text":{h.readAsText(e);break}default:p(new Error(`Unknown target ${a}`))}})};Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||function(){return g(this,"buffer")},Blob.prototype.text=Blob.prototype.text||function(){return g(this,"text")}}String.prototype.replaceAll=String.prototype.replaceAll||function(g,e){let a=0,h=16,o=this,p=[];for(;a<h&&o.lastIndexOf(g)>-1;){let y=o.lastIndexOf(g);p.unshift(o.slice(y+g.length)),o=o.slice(0,y),y==0&&p.unshift(""),a++}return o.length&&p.unshift(o),p.join(e)||""},String.prototype.padStart=String.prototype.padStart||function(g,e){if(e){let a=this;for(;a.length<g;)a=`${e}${a}`;return a}},String.prototype.padEnd=String.prototype.padEnd||function(g,e){if(e){let a=this;for(;a.length<g;)a+=e;return a}}});var ta=Qa((Yr,ea)=>{N();(function(){"use strict";let g={fatal:!0},e=[new TextDecoder("iso-8859-15",g),new TextDecoder("utf-8",g),new TextDecoder("sjis",g),new TextDecoder("euc-jp",g),new TextDecoder("ascii")],a={debug:!1,parse:function(h,o){if(h instanceof Uint8Array)return a.Uint8(h);if(typeof h=="string")return a.Base64(h);if(h instanceof HTMLElement&&h.type==="file")return a.addListener(h,o);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(h,o){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(h===void 0||!(h instanceof HTMLElement)||h.tagName!=="INPUT"||h.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;o=o||function(){},h.addEventListener("change",function(p){if(!p.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let y=new FileReader;y.readAsArrayBuffer(p.target.files[0]),y.onload=function(v){o(a.Uint8(new Uint8Array(v.target.result)))}})},Base64:function(h){let o=function(v){var m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(v=v.replace(/^.*?base64,/,""),v=String(v).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(v))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");v+="==".slice(2-(3&v.length));let r,d="",i,s,n=0;for(;n<v.length;)r=m.indexOf(v.charAt(n++))<<18|m.indexOf(v.charAt(n++))<<12|(i=m.indexOf(v.charAt(n++)))<<6|(s=m.indexOf(v.charAt(n++))),d+=i===64?String.fromCharCode(r>>16&255):s===64?String.fromCharCode(r>>16&255,r>>8&255):String.fromCharCode(r>>16&255,r>>8&255,255&r);return d}(h=String(h));var p=o.length;let y=new Uint8Array(new ArrayBuffer(p));for(let v=0;v<p;v++)y[v]=o.charCodeAt(v);return a.Uint8(y)},Uint8:function(y){let o={data:null,pointer:0,movePointer:function(i){return this.pointer+=i,this.pointer},readInt:function(i){if((i=Math.min(i,this.data.byteLength-this.pointer))<1)return-1;let s=0;if(1<i)for(let n=1;n<=i-1;n++)s+=this.data.getUint8(this.pointer)*Math.pow(256,i-n),this.pointer++;return s+=this.data.getUint8(this.pointer),this.pointer++,s},readStr:function(i){let s=new Uint8Array(i),n=!1,c;s.forEach((l,u)=>{s[u]=this.readInt(1)});for(let l=0;l<e.length;l++)if(!n)try{if(c=e[l].decode(s),l===0)for(let u=0;u<c.length;u++){let f=c.charCodeAt(u);if(f>191||f>127&&f<160)throw new RangeError(`Invalid code point: ${f}`)}n=!0,console.debug(`String byte sequence in ${e[l].encoding}`)}catch(u){console.debug(`SMF string ${u}`)}return c||"String byte sequence read failed."},backOne:function(){this.pointer--},readIntVLV:function(){let i=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)i=this.readInt(1);else{let n=[];for(;128<=this.data.getUint8(this.pointer);)n.push(this.readInt(1)-128);var s=this.readInt(1);for(let c=1;c<=n.length;c++)i+=n[n.length-c]*Math.pow(128,c);i+=s}return i}};if(o.data=new DataView(y.buffer,y.byteOffset,y.byteLength),o.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;o.readInt(4);let p={};p.formatType=o.readInt(2),p.tracks=o.readInt(2),p.track=[];var y=o.readInt(1),v=o.readInt(1);128<=y?(p.timeDivision=[],p.timeDivision[0]=y-128,p.timeDivision[1]=v):p.timeDivision=256*y+v;for(let i=1;i<=p.tracks;i++){p.track[i-1]={event:[]};var m,r=o.readInt(4);if(r===-1)break;if(r!==1297379947)return!1;o.readInt(4);let s=0,n=!1,c,l;for(;!n&&(s++,p.track[i-1].event[s-1]={},p.track[i-1].event[s-1].deltaTime=o.readIntVLV(),(c=o.readInt(1))!==-1);)if(128<=c?l=c:(c=l,o.movePointer(-1)),c===255){p.track[i-1].event[s-1].type=255,p.track[i-1].event[s-1].metaType=o.readInt(1);var d=o.readIntVLV();switch(p.track[i-1].event[s-1].metaType){case 47:case-1:n=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:p.track[i-1].event[s-1].data=o.readStr(d);break;case 33:case 89:case 81:p.track[i-1].event[s-1].data=o.readInt(d);break;case 84:p.track[i-1].event[s-1].data=[],p.track[i-1].event[s-1].data[0]=o.readInt(1),p.track[i-1].event[s-1].data[1]=o.readInt(1),p.track[i-1].event[s-1].data[2]=o.readInt(1),p.track[i-1].event[s-1].data[3]=o.readInt(1),p.track[i-1].event[s-1].data[4]=o.readInt(1);break;case 88:p.track[i-1].event[s-1].data=[],p.track[i-1].event[s-1].data[0]=o.readInt(1),p.track[i-1].event[s-1].data[1]=o.readInt(1),p.track[i-1].event[s-1].data[2]=o.readInt(1),p.track[i-1].event[s-1].data[3]=o.readInt(1);break;default:this.customInterpreter!==null&&(p.track[i-1].event[s-1].data=this.customInterpreter(p.track[i-1].event[s-1].metaType,o,d)),this.customInterpreter!==null&&p.track[i-1].event[s-1].data!==!1||(o.readInt(d),p.track[i-1].event[s-1].data=o.readInt(d),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch((c=c.toString(16).split(""))[1]||c.unshift("0"),p.track[i-1].event[s-1].type=parseInt(c[0],16),p.track[i-1].event[s-1].channel=parseInt(c[1],16),p.track[i-1].event[s-1].type){case 15:this.customInterpreter!==null&&(p.track[i-1].event[s-1].data=this.customInterpreter(p.track[i-1].event[s-1].type,o,!1)),this.customInterpreter!==null&&p.track[i-1].event[s-1].data!==!1||(m=o.readIntVLV(),p.track[i-1].event[s-1].data=o.readInt(m),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:p.track[i-1].event[s-1].data=[],p.track[i-1].event[s-1].data[0]=o.readInt(1),p.track[i-1].event[s-1].data[1]=o.readInt(1);break;case 12:case 13:p.track[i-1].event[s-1].data=o.readInt(1);break;case-1:n=!0;break;default:if(this.customInterpreter!==null&&(p.track[i-1].event[s-1].data=this.customInterpreter(p.track[i-1].event[s-1].metaType,o,!1)),this.customInterpreter===null||p.track[i-1].event[s-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return p},customInterpreter:null};if(typeof ea<"u")ea.exports=a;else{let h=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;h.MidiParser=a}})()});N();N();var he,fa,_t=(fa=class{constructor(){S(this,he,{})}addEventListener(g,e){t(this,he)[g]||(t(this,he)[g]=[]),t(this,he)[g].unshift(e)}removeEventListener(g,e){if(t(this,he)[g]){let a=t(this,he)[g].indexOf(e);a>-1&&t(this,he)[g].splice(a,1),t(this,he)[g].length<1&&delete t(this,he)[g]}}dispatchEvent(g,e){var o;let a=new Event(g),h=this;a.data=e,((o=t(this,he)[g])==null?void 0:o.length)>0&&t(this,he)[g].forEach(function(p){try{p==null||p.call(h,a)}catch(y){console.error(y)}}),this[`on${g}`]&&this[`on${g}`](a)}},he=new WeakMap,fa);N();N();var ua=function(g,e){let a=Math.min(g.length,e.length),h=g.slice(0,a),o=e.slice(0,a),p=0,y=0;for(;y<a&&p==0;)p=Math.sign(h[y]-o[y]),y++;return p},Ce=function(g=""){this.name=g,this.pool=[],this.point=function(e,a=!1){if(this.pool.length>0){let h=this.pool.length,o=1<<Math.floor(Math.log2(h)),p=o,y=64;for(;o>=1&&y>=0;){if(y<=0)throw new Error("TTL reached.");if(p==h)p-=o;else{let m=ua(e,this.pool[p]);switch(m){case 0:{y=0;break}case 1:{p+o<=h&&(p+=o);break}case-1:{p!=0&&(p-=o);break}default:console.warn(`Unexpected result ${m}.`)}}o=o>>1,y--}let v=!0;if(p>=this.pool.length)v=!1;else{let m=this;this.pool[p].forEach(function(r,d,i){v&&r!=e[d]&&(v=!1)}),!v&&ua(e,this.pool[p])>0&&p++}return v||a?p:-1}else return a?0:-1},this.add=function(e,a){return e.data=a,this.pool.splice(this.point(e,!0),0,e),this},this.default=function(e){console.warn(`No match in "${this.name||"(unknown)"}" for "${e}". Default action not defined.`)},this.get=function(e){let a=this.point(e);if(a>-1)return this.pool[a].data;this.default(e)},this.run=function(e,...a){let h=this.point(e);h>-1?e.subarray?this.pool[h].data(e.subarray(this.pool[h].length),...a):this.pool[h].data(e.slice(this.pool[h].length),...a):this.default(e,...a)}};N();var Ja=["MSB","PRG","LSB","NME","ELC","DRM","LVL"],ja={krs:"KR",s90es:"ES",motif:"ES"},er={krs:"Kr",s90es:"SE",motif:"ME"},Wt=function(g){let e=Math.floor(g/10),a=g%10;return`${e.toString(16)}${a}`},re,pa,qt=(pa=class{constructor(...g){S(this,re,void 0);P(this,"strictMode",!1);this.loadFiles(...g)}get bankInfo(){return t(this,re)}get(g=0,e=0,a=0,h,o=0){var T,D;let p=[g,e,a],y,v=1,m=0,r,d,i=Array.from(arguments);switch(h){case"xg":{switch(g){case 0:{a===126?i[2]=125:a===127&&(i[2]=0);break}case 16:{a===126&&(i[2]=0);break}case 32:{a>125&&(i[2]=0),i[2]+=4;break}case 33:{(a>125||a===3)&&(i[2]=0),i[2]+=5;break}case 34:case 35:case 36:{a>125&&(i[2]=0),i[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:i[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{a===126&&(i[2]=0);break}case 48:case 64:case 126:case 127:{a===126&&(g===127&&e===0||(i[2]=0));break}}break}case"gs":case"sc":{g===0&&a<5?i[0]=49:g>125&&a<5&&a!==2&&(i[2]=g,i[0]=49);break}case"mt32":{g===0&&(i[0]=49);break}case"sd":{switch(g){case 121:{i[0]=96;break}case 120:{i[0]=104;break}}i[0]>>1===40?i[2]|=16:i[0]>95&&i[0]<100&&(i[2]|=16,e>>4===7&&(i[0]=96));break}case"g2":{g>>1===40?i[2]|=16:g>95&&g<100&&(i[2]|=16,e>>4===7&&(i[0]=96));break}case"sg":{g===8&&a===0&&(i[2]=5);break}case"05rw":case"x5d":{g&&g<56&&(i[0]=56);break}case"s90es":case"motif":case"an1x":case"cs1x":case"cs6x":{if(g===0)break;switch(g){case 63:{switch(h){case"s90es":{a<8?i[2]+=17:a<32?i[2]+=13:i[2]=(i[2]>>3)+19;break}case"motif":{a<8?i[2]+=28:a<32?i[2]+=13:i[2]=(i[2]>>3)+19;break}case"cs1x":{switch(a>>1){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:{i[2]+=34;break}case 32:{i[2]=34+((a&1)<<2);break}case 33:{i[2]=47+((a&1)<<2);break}case 61:{i[2]=34+((a&1)<<2);break}case 62:{i[2]=47+((a&1)<<2);break}}break}}break}case 32:{a>125&&(i[2]=0),i[2]+=4;break}case 33:{(a>125||a===3)&&(i[2]=0),i[2]+=5;break}case 34:case 35:case 36:{a>125&&(i[2]=0),i[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:i[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{a===126&&(i[2]=0);break}}break}}let s=" ",n="M",c="",l=0,u=0;switch(i[0]){case 0:{switch(i[2]){case 127:{n="GM-a";break}case 126:{n="GM-n";break}case 7:{n="GM-k",c="GLX";break}case 5:{n="SG-a",c="000";break}case 4:{h==="gs"||h==="sc"?(n="GM-a",c="000"):(n="SP-l",c="C/M");break}case 3:case 2:case 1:{(h==="gs"||h==="sc")&&(n="GM-a",c="000");break}case 0:{n="GM-a";break}default:n="y",l=3}break}case 8:{h==="sg"?n="GM-s":n="r:";break}case 32:case 33:case 34:case 35:case 36:{h==="xg"&&(n=`${["AP","VL","PF","DX","AN"][g&7]}-${"abcdefgh"[a]}`,l=3);break}case 48:{c=`M${(i[2]>>3).toString().padStart(2,"0")}`,n=`y${c}`,l=1;break}case 49:{i[2]>>1===63?(n=`MT-${"ba"[i[2]&1]}`,c=`C${"-/"[i[2]&1]}M`):(n="GM-a",c="000");break}case 56:{n="GM-b";break}case 57:n=["yDOC","QY10","QY20"][i[2]-112]||"yMxv",c=["DOC","QY1","QY2"][i[2]-112]||"057";case 61:case 120:{n="rDrm";break}case 62:{n="kDrm";break}case 63:{if(i[2]<17){let M=i[2];n=M<10?"kP:":"kC:",n+=M%10}else if(i[2]<34)n=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][i[2]-17];else if(i[2]<55){let M=i[2]-34;switch(M>12&&M--,a>>1){case 32:case 33:{n=`Pr${a-63}U`;break}case 61:case 62:{n=`Pr${a-121}U`;break}default:n=i[2]===46?"PrDr":`Pr${(M>>2)+1}${String.fromCharCode(65+(M&3))}`}}else n="Ds";l=1;break}case 64:{n="ySFX",c="SFX";break}case 67:{n="DX:S";break}case 80:case 81:case 82:case 83:{n=`Prg${"UABC"[i[0]-80]}`;break}case 88:case 89:case 90:case 91:{n=`Cmb${"UABC"[i[0]-88]}`;break}case 95:{n=`${["DR","PC"][i[2]]}-d`;break}case 96:{n=i[2]===106?"AP-a":i[2]>>4===1?"SDg":"PF",i[2]>63?u=63:i[2]>>4===1&&(u=16),l=3;break}case 97:{n=i[2]>>4===1?"SDa":"VL:",l=3,i[2]>>4===1?u=16:u=112;break}case 98:{n=i[2]>>4===1?"SDb":"SG-a",l=3,u=16;break}case 99:{n=i[2]>>4===1?"SDc":"DX",i[2]>63?u=63:i[2]>>4===1&&(u=16),l=3;break}case 100:{n="AN",i[2]>63?u=63:i[2]>>4===1&&(u=16),l=3;break}case 104:case 105:case 106:case 107:{n="SDd",u=104;break}case 121:{n=`GM-${i[2]?"":"a"}`,l=3;break}case 122:{n="lDrm";break}case 126:{n="yDrS";break}case 127:{i[2]===127?n="rDrm":n="yDrm";break}default:i[0]<48?n="r:":n="M"}n.length<4&&(n+=`${[g,a,i[0],i[2]][l]-u}`.padStart(4-n.length,"0")),c.length<3&&(c+=`${[g,a,g,a][l]}`.padStart(3-c.length,"0")),h==="xg"&&(g===0?i[2]<100?n=n.replace("y0","y:"):i[2]===125&&(n="y126"):g===16?(y=`Voice${((i[2]<<7)+i[1]+1).toString().padStart(3,"0")}`,s=" "):g===35&&a>>1===2&&(y=`DXCH_${(((i[2]&1)<<7)+e+1).toString().padStart(3,"0")}`,s=" "));let f=[i[0],i[1],i[2]];for(;!((y==null?void 0:y.length)>=0);)if(y=(T=t(this,re)[i[1]||0][(i[0]<<8)+i[2]])==null?void 0:T.name,y){let M=t(this,re)[i[1]||0][(i[0]<<8)+i[2]];v=(M==null?void 0:M.poly)||v,m=(M==null?void 0:M.type)||m,r=M==null?void 0:M.drum,d=M==null?void 0:M.level}else if(this.strictMode)y="",s="?";else if(i[0]===0&&i[1]===0&&i[2]===0)y="Unloaded";else if(t(this,re)[i[1]||0][i[0]<<8])i[0]===0?(i[2]=0,s="^"):i[2]<1?(i[0]=0,s="*"):(i[2]--,s="^");else if(g===48)i[0]=0,i[2]=0,s="!";else if(g===62)i[1]--,s=" ",i[1]<1&&!(y!=null&&y.length)&&(i[0]=0,s="!");else if(g<63)i[0]===0?(i[2]=0,s="^"):i[2]<1?(i[0]=0,s="*"):i[2]--;else if(g===80)y=`PrgU:${e.toString().padStart(3,"0")}`,s="!";else if(g===88)y=`CmbU:${e.toString().padStart(3,"0")}`,s="!";else if(g===121)y=`GM2Vox0${a}`,s="#";else if(g===122)if(i[1]===32?i[1]:i[1]%=7,y=(D=t(this,re)[i[1]||0][(i[0]<<8)+i[2]])==null?void 0:D.name,y){s=" ";let M=t(this,re)[i[1]||0][(i[0]<<8)+i[2]];v=(M==null?void 0:M.poly)||v,m=(M==null?void 0:M.type)||m,r=M==null?void 0:M.drum,d=M==null?void 0:M.level}else y="",s="*";else i[1]===0?(y=`${g.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")} ${a.toString().padStart(3,"0")}`,s="!"):i[0]===0?(i[2]=0,s="^"):i[2]>0?i[2]--:i[1]>0?(i[1]=0,s="!"):(i[0]=0,s="?");let E=[i[0],i[1],i[2]];switch(s){case"^":{switch(h){case"gs":case"sc":case"ns5r":{s=" ";break}}g===127&&s==="^"&&(s=" ");break}}let C="??";switch(i[0]){case 0:{i[2]===0?C="GM":i[2]===5||i[2]===7?C="KG":i[2]<126&&(C="XG");break}case 32:case 33:case 35:case 36:{i[2]>4?C=["AP","VL","PF","DX","AN"][i[0]-32]:C="GS";break}case 48:{C="MU";break}case 49:{i[2]>>1===63?C="MT":i[2]<5&&(C="GM");break}case 56:{C="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{C="AI";break}case 62:case 82:case 90:{C="XD";break}case 63:{i[2]<17?C="KR":i[2]<34?C="ES":i[2]<55?C="CS":C="DS";break}case 64:case 126:{C="XG";break}case 67:case 99:{C=i[2]>>4===1?"SD":"DX";break}case 81:{C="RW";break}case 95:{C=["DR","PC"][i[2]];break}case 96:{C=i[2]===106?"AP":i[2]>>4===1?"SD":"PF";break}case 97:{C=i[2]>>4===1?"SD":"VL";break}case 98:{C=i[2]>>4===1?"SD":"SG";break}case 100:{C="AN";break}case 104:case 105:case 106:case 107:{C="SD";break}case 120:{C=e===0?"GM":"GS";break}case 121:{C=i[2]?"G2":"GM";break}case 122:{C="KG";break}case 127:{C=i[2]===127?"MT":e===0?"GM":"XG";break}default:i[0]<48&&(i[0]===16&&h==="xg"?C="XG":C="GS")}if(s!==" ")switch(h){case"krs":case"s90es":case"motif":{y="",C=ja[h];break}default:self.debugMode&&(y="")}return{name:y||`${er[h]||h.toUpperCase()}${Wt(g||0)}${Wt(e||0)}${Wt(a||0)}`,poly:v,type:m,drum:r,level:d,iid:f,eid:E,sid:p,ending:s,sect:n,bank:c,standard:C,mode:h}}async load(g,e,a="(internal)",h){let o=this,p=[],y=0,v=0,m=0;g.split(`
`).forEach(function(r,d){var n;let i=r.split("	"),s=[];if(d===0){if(i.forEach(function(c,l){p[Ja.indexOf(c)]=l}),p.length<4){console.debug("Debugger launched.");debugger}}else{let c=0,l=0,u=0,f,E=1,C=0,T,D;i.forEach(function(Y,Te){switch(Te){case p[0]:{c=parseInt(Y);break}case p[1]:{l=parseInt(Y);break}case p[2]:{u=parseInt(Y);break}case p[3]:{f=Y;break}case p[4]:{Y=parseInt(Y),Y<16?E=Y+1:(C=(Y&15)+1,E=C);break}case p[5]:{D=Y;break}case p[6]:{Y!=null&&Y.constructor&&(T=parseInt(Y));break}}}),t(o,re)[l]=t(o,re)[l]||[];let M=t(o,re)[l],O={msb:c,prg:l,lsb:u,name:f,poly:E,type:C,drum:D,level:T,priority:h},z=!1;h<((n=M[c<<8|u])==null?void 0:n.priority)&&(z=!0,m++),(!M[c<<8|u]||z||e)&&(M[c<<8|u]=O,y++),v++}}),e||console.debug(`Map "${a}": ${v} total, ${y} loaded (${y-m} + ${m}).`)}clearRange(g){let e=g.prg!==void 0?g.prg.constructor===Array?g.prg:[g.prg,g.prg]:[0,127],a=g.msb!==void 0?g.msb.constructor===Array?g.msb:[g.msb,g.msb]:[0,127],h=g.lsb!==void 0?g.lsb.constructor===Array?g.lsb:[g.lsb,g.lsb]:[0,127];for(let o=a[0];o<=a[1];o++){let p=o<<8;for(let y=h[0];y<=h[1];y++){let v=p+y;for(let m=e[0];m<=e[1];m++)delete t(this,re)[m][v]}}}init(){$(this,re,[]);for(let g=0;g<128;g++)t(this,re).push([""])}async loadFiles(...g){this.init();let e=this;g.forEach(async function(a,h){try{e.load(await(await fetch(`./data/bank/${a}.tsv`)).text(),!1,a,h)}catch(o){console.error(`Failed loading "${a}.tsv".`)}})}},re=new WeakMap,pa);N();N();var gt,ga,ba=(ga=class{constructor(){S(this,gt,{});P(this,"context")}set(g,e){t(this,gt)[g]=e}has(g){return!!t(this,gt)[g]}async read(g,e){if(!this.has(g))throw new Error(`No decoder registered for "${g}"`);return await t(this,gt)[g].call(this.context||this,e)}},gt=new WeakMap,ga);var tr=function(g,e){let a=!0;return e.forEach((h,o)=>{a=a&&g[o]===h}),a},Tt=function(g){let e=0;return g.forEach(a=>{e*=256,e+=a}),e},Me=new TextDecoder,Mt=new ba;Mt.set("s7e",async function(g){let e=new Uint8Array(await g.slice(0,65536).arrayBuffer()),a="MSB	LSB	PRG	NME",h=[0,0,0,0],o=32,p=0,y=0,v=!0,m=[],r=0;for(;v;){let d=e.subarray(p);([()=>{Me.decode(d.subarray(0,4))==="YSFC"?(p+=80,y=1):p++},()=>{if(tr(d.subarray(0,4),h))m.forEach((i,s,n)=>{let c=Tt(e.subarray(i.start+4,i.start+8));i.length=c}),y=2;else{let i=Me.decode(d.subarray(0,4)),s=Tt(d.subarray(4,8));m.push({type:i,start:s}),p+=8}},()=>{let i=m[r],s=e.subarray(i.start,i.start+i.length),n=32;switch(i.type){case"ENVC":{let c=o;for(;c<s.length;){let l=s.subarray(c,c+n),u=Me.decode(l.subarray(0,10)).trimEnd();u.slice(0,5)==="Init "&&(u=""),u&&(a+=`
063	${(l[17]+13).toString().padStart(3,"0")}	${l[19].toString().padStart(3,"0")}	${u}`),c+=n}break}case"EDVC":{let c=o;for(;c<s.length;){let l=s.subarray(c,c+n),u=Me.decode(l.subarray(0,10)).trimEnd();u.slice(0,5)==="Init "&&(u=""),u&&(a+=`
063	024	${l[19].toString().padStart(3,"0")}	${u}`),c+=n}break}case"EPVC":{let c=32,l=o;for(;l<s.length;){let u=s.subarray(l,l+c),f=Me.decode(u.subarray(0,10)).trimEnd();f==="----------"&&(f=""),f&&(a+=`
063	${(u[17]+1).toString().padStart(3,"0")}	${u[19].toString().padStart(3,"0")}	${f}`),l+=c}break}}r++,r>=m.length&&(y=3,v=!1)}][y]||(()=>{v=!1}))()}return a});Mt.set("pcg",async function(g){let e=new Uint8Array(await g.arrayBuffer()),a="MSB	LSB	PRG	NME",h=100,o=0,p=0,y=!0,v=[],m=0;for(;y;){let r=e.subarray(h);([()=>{y=Me.decode(r.subarray(0,4))==="INI2",p=r[15],h+=16,o=1},()=>{let d=Me.decode(r.subarray(0,4)),i=r[5],s=r[7],n=r[11],c=Tt(r.subarray(12,16)),l=Tt(r.subarray(16,20)),u=Tt(r.subarray(36,40)),f=Me.decode(r.subarray(44,44+n));v.push({type:d,tipMsb:i,tipLsb:s,nameLen:n,length:c,start:l,entryLen:u,name:f}),h+=64,p--,p<1&&(o=2)},()=>{let d=v[m],i=e.subarray(d.start,d.start+d.length);switch(d.type){case"PRG1":break;case"PBK1":{let s=63,n=(d.tipMsb?6:0)+d.tipLsb;for(let c=0;c<128;c++){let l=c*d.entryLen,u=i.subarray(l,l+d.entryLen),f=Me.decode(u.subarray(0,24)).trimEnd().replace("InitProg","");f.length&&n>5&&(a+=`
${s.toString().padStart(3,"0")}	${n.toString().padStart(3,"0")}	${c.toString().padStart(3,"0")}	${f}`)}break}case"CBK1":{let s=63,n=(d.tipMsb?3:0)+d.tipLsb+10;for(let c=0;c<128;c++){let l=c*d.entryLen,u=i.subarray(l,l+d.entryLen),f=Me.decode(u.subarray(0,24)).trimEnd().replace("InitCombi","");f.length&&n>12&&(a+=`
${s.toString().padStart(3,"0")}	${n.toString().padStart(3,"0")}	${c.toString().padStart(3,"0")}	${f}`)}break}}m++,m>=v.length&&(o=3,y=!1)}][o]||(()=>{y=!1}))()}return a});N();var Pt=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),Rt=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],ar=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],bt=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],Ea=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],ya=function(g){let e=.1,a=-.3;return g>66?(e=5,a=315):g>56?(e=1,a=47):g>46&&(e=.5,a=18.5),e*g-a},ma=function(g){return g>105?ar[g-106]:g>100?g*1.1-100:g/10},va=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),Qt={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,ㇺ
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,ゐ
we,ゑ
wo,を
nga,か゚
ngi,き゚
ngu,く゚
nge,け゚
ngo,こ゚
ngy,き゚!
ng,ン
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,𛀁
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(g=>{let e=g.split(",");Qt[e[0]]=e[1]});var Ca=function(g){let e=g;g[0]=="*"&&(e=e.slice(1)),["aa","ii","uu","ee","oo"].forEach(h=>{for(;e.indexOf(h)>-1;)e=e.replace(h,h[0])});for(let h in Qt)e=e.replaceAll(h,Qt[h]);e.indexOf("ん")==0&&e.length>1&&(e=e.slice(1));let a=e.indexOf("!");return a>-1&&e.length>1&&(e=e.slice(a+1)),e},ka=function(g){return g?g<96?`cc${g}`:["aftertouch","velocity","pitch bend"][g-96]:"off"},wa={u8:["utf-8","Unicode"],l1:["l9","Pan-Latin"],jp:["sjis","Japanese"],kr:["iso-2022-kr","Korean"],hz:["gb18030","Simplified Chinese"],b5:["big5","Traditional Chinese"],cy:["koi8-ru","Cyrillic"],vn:["tcvn-5773-1993","Vietnamese"]},$a={m:"Male",f:"Female",c:"Chorus",s:"Solo",p:"Plural",w:"Words",x:"Non-vocal"};N();var Zt=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],xa=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],Sa=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var rr={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},sr={66307:["drive"],66309:["vowel",g=>"aiueo"[g]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",g=>["off","LPF","HPF"][g]],94984:["noise type",g=>["white","pink"][g]],94987:["disc type",g=>["LP","SP","EP","RND"]],94990:["hum type",g=>`${g+5}0Hz`],94993:["M/S",g=>["mono","stereo"][g]]},Jt=function(g){return rr[(g[0]-32<<8)+g[1]]||`0x${g[0].toString(16).padStart(2,"0")}${g[1].toString(16).padStart(2,"0")}`},Ta=function(g,e,a){let h=(g[0]-32<<16)+(g[1]<<8)+e,o=sr[h]||{},p=o[0];if(p!=null&&p.length)return p+=`: ${(o[1]||function(){})(a)||a}`,p},jt=[68,48,95,78,41,3,110,122,0];N();var fe=function(g=64){return Math.round(2e3*Math.log10(g/64))/100},Ma=function(g,e,a){let h=[],o=a==!1?e.readIntVLV():a;g==0||g==127;for(let p=0;p<o;p++){let y=e.readInt(1);if(h.push(y),y!=247){if(y!=240){if(y>127)return console.debug(`Early termination: ${h}`),h.pop(),e.backOne(),e.backOne(),new Uint8Array(h)}}}return new Uint8Array(h)},ze=function(g){let e=0;return g.forEach(a=>{e+=a,e=e&127}),~e+1&127},ke=function(g,e){let a=0,h=0;for(let o=0;o<g.length;o++){let p=o%8-1,y=(h>>p&1)<<7,v=g[o];v+=y,o%8!==0?(e(v,a,g),a++):h=g[o]}};var At=function(g){let e=Math.floor(g*14.2);return e<128?e:0},I=function(){var g;return self.Bun?!0:(g=self.debugMode)!=null?g:!1};var Vr="♭𝄫,𝄫,♭,,♯,𝄪,𝄪♯".split(",");var ns=oa(ta(),1);var Z=["?","gm","gs","sc","xg","g2","mt32","doc","qy10","qy20","ns5r","x5d","05rw","k11","sg","sd","pa","krs","s90es","motif","cs6x","trin","an1x","cs1x"],ir={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es",trinity:"trin","tr-rack":"trin"},nr=["melodic","drum","menu"],Pa={"?":[0,0,120,0,0],gm:[0,0,120,0,0],gs:[0,0,120,0,0],sc:[0,0,120,0,0],xg:[0,0,127,0,0],g2:[0,0,120,0,0],mt32:[0,127,127,0,127],doc:[57,112,127,57,112],qy10:[57,113,127,57,113],qy20:[57,114,127,57,114],ns5r:[0,0,61,0,0],x5d:[82,0,62,56,0],"05rw":[81,0,62,56,0],k11:[0,0,122,0,0],sg:[0,0,122,0,0],sd:[97,0,105,0,0],krs:[121,0,120,0,0],s90es:[0,0,127,0,0],motif:[0,0,127,0,0],cs6x:[0,0,127,0,0],trin:[0,0,61,0,0],an1x:[36,3,127,0,0],cs1x:[0,0,127,63,0]},cr=[9,25,41,57,73,89,105,121],or=[0,3,81,84,88],Ra={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},Ht={0:0,1:1,2:3,5:4},Aa={0:0,1:1,2:2,5:3},Da=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],ra=[36,37,48,49,52,53],Yt=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],Ia={26:127,29:0,30:0,31:0,52:12,53:54},We=[0,1,2,4,5,6,7,8,10,11,12,13,14,15,16,17,18,19,20,21,22,26,28,32,38,40,41,42,43,44,45,46,47,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,80,81,82,83,84,91,92,93,94,95,98,99,100,101,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],lr=[2,4,12,13,14,15,16,17,18,19,20,21,40,41,42,43,44,45,46,47,80,81,83,136,130,131,132,133,134,135,137,138,139,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],dr=[33,102,99,32,100,8,9,10],Oa=[0,16,25,40,32,64,24,48],x={};Z.forEach((g,e)=>{x[g]=e});var w=[];We.forEach((g,e)=>{w[g]=e});var Ee={length:Yt.length};Yt.forEach((g,e)=>{Ee[g]=e});var hr={};nr.forEach((g,e)=>{hr[g]=e});var fr=function(g){let e=[],a=0;return g==null||g.forEach(function(h,o){h===247?e.push(g.subarray(a,o)):h===240&&(a=o+1)}),e.length||e.push(g.subarray(0)),I()&&console.debug(e),e};var aa=8,b={port:aa,ch:aa<<4,chShift:Math.ceil(Math.log2(aa))+4,cc:We.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,nrpn:ra.length,ace:8,drm:8,dpn:Yt.length,dnc:128,ext:3,efx:7,cvn:12,redir:32,vxPrim:3,invalidCh:255};b.chcc=b.cc*b.ch;var Se={bank0:128},ur=new TextDecoder("l9"),_=new Uint16Array(b.ch),Et=new Uint16Array(b.ch),pr=new Uint16Array(b.ch),Gt=new Uint16Array(b.ch),gr=new Uint16Array(b.ch),Xt=new Uint16Array(b.ch),La=new Array(b.drm);for(let g=0;g<b.ch;g++)_[g]=g*b.cc,Et[g]=g*b.rpn,pr[g]=g*b.nrpn,Gt[g]=g*b.ace,gr[g]=g*b.ext,Xt[g]=g*b.cvn;for(let g=0;g<b.drm;g++){La[g]=new Uint16Array(b.dpn);let e=g*b.dpn*b.dnc;for(let a=0;a<b.dpn;a++)La[g][a]=e+a*b.dnc}var G,se,we,Oe,be,Ie,Ua,ue,H,R,k,ae,L,j,ie,q,K,Le,Pe,qe,ne,A,B,yt,de,$e,pe,mt,Qe,J,vt,Ze,ye,Je,Ne,xe,Ct,_e,Q,U,Re,Dt,F,je,kt,et,tt,Vt,at,He,Ge,It,wt,Ae,X,Kt,Ot,W,$t,rt,ge,Be,Xe,ce,st,ee,Lt,Ft,it,nt,te,me,De,ct,ot,lt,Ba,os=(Ba=class extends _t{constructor(){super();S(this,be);P(this,"NOTE_IDLE",0);P(this,"NOTE_ATTACK",1);P(this,"NOTE_DECAY",2);P(this,"NOTE_SUSTAIN",3);P(this,"NOTE_HELD",4);P(this,"NOTE_RELEASE",5);P(this,"NOTE_SOSTENUTO_ATTACK",8);P(this,"NOTE_SOSTENUTO_DECAY",9);P(this,"NOTE_SOSTENUTO_SUSTAIN",10);P(this,"NOTE_SOSTENUTO_HELD",11);P(this,"NOTE_MUTED_RECOVERABLE",16);P(this,"CH_MELODIC",0);P(this,"CH_DRUMS",1);P(this,"CH_DRUM1",2);P(this,"CH_DRUM2",3);P(this,"CH_DRUM3",4);P(this,"CH_DRUM4",5);P(this,"CH_DRUM5",6);P(this,"CH_DRUM6",7);P(this,"CH_DRUM7",8);P(this,"CH_DRUM8",9);P(this,"DUMP_ALL",0);P(this,"DUMP_ONCE",1);P(this,"DUMP_MODE",2);P(this,"EXT_NONE",0);P(this,"EXT_VL",1);P(this,"EXT_DX",3);P(this,"VLBC_SYSTEM",0);P(this,"VLBC_BRTHEXPR",1);P(this,"VLBC_VELOINIT",2);P(this,"VLBC_VELOALL",3);P(this,"CH_INACTIVE",0);P(this,"CH_ACTIVE",1);P(this,"CH_DISABLED",2);P(this,"KARAOKE_NONE",0);P(this,"KARAOKE_TEXT",1);P(this,"KARAOKE_XF",2);S(this,G,0);S(this,se,0);S(this,we,0);S(this,Oe,new Array(11));S(this,ue,new Uint8Array(b.ch));S(this,H,new Uint8Array(b.ch));S(this,R,new Uint8Array(b.ch));S(this,k,new Uint8Array(b.chcc<<1));S(this,ae,new Uint8Array(b.ch*b.ace));S(this,L,new Uint8Array(b.ch*b.vxPrim));S(this,j,new Uint8Array(b.ch*b.nn));S(this,ie,new Uint8Array(b.ch));S(this,q,new Uint16Array(b.pl));S(this,K,new Uint8Array(b.pl));S(this,Le,new Int16Array(b.ch));S(this,Pe,new Uint8Array(b.ch));S(this,qe,new Uint8Array(b.ch));S(this,ne,new Uint8Array(b.ch*b.ext));S(this,A,new Uint8Array(b.ch*b.rpn));S(this,B,new Uint8Array(b.ch*b.rpnt));S(this,yt,new Int8Array(b.ch*ra.length));S(this,de,new Uint8Array(b.drm*b.dpn*b.dnc));S(this,$e,new Uint8Array(b.drm*2));S(this,pe,new Uint8Array(b.efx*3));S(this,mt,new Uint8Array(b.ch));S(this,Qe,new Uint8Array(b.ch*b.redir));S(this,J,new Uint8Array(b.port));S(this,vt,new Uint8Array(b.port));S(this,Ze,new Uint8Array(b.ch));S(this,ye,new Uint8Array(b.ch));S(this,Je,new Uint8Array(b.ch*b.cvn));S(this,Ne,new Uint8Array(128));S(this,xe,new Uint8Array(b.cmt*8));S(this,Ct,new Uint8Array(1024));S(this,_e,new Uint8Array(b.cmt*64));S(this,Q,{});P(this,"modelEx",{sc:{showBar:!0,invBar:!1,invDisp:!1,peakHold:1},cs1x:{perfCh:0}});S(this,U,void 0);S(this,Re,void 0);S(this,Dt,void 0);S(this,F,100);S(this,je,0);S(this,kt,500);S(this,et,0);S(this,tt,0);S(this,Vt,32);S(this,at,!1);S(this,He,"");S(this,Ge,0);S(this,It,0);S(this,wt,0);S(this,Ae,!0);S(this,X,0);S(this,Kt,1);S(this,Ot,void 0);S(this,W,!1);S(this,$t,0);S(this,rt,new Array(b.ch));S(this,ge,[]);S(this,Be,new Uint8Array(b.ch));S(this,Xe,new Uint8Array(b.tr));P(this,"baseBank",new qt("gm2","ns5r","xg","gs","sd","gmega","plg-vl","plg-pf","plg-dx","plg-an","plg-dr","plg-sg","kross","s90es","cs2x"));P(this,"userBank",new qt("gm2"));P(this,"initOnReset",!1);P(this,"aiEfxName","");P(this,"polyIndexShrink",!0);P(this,"polyIndexLatest",0);P(this,"polyIndexLast",0);S(this,ce,[]);S(this,st,void 0);S(this,ee,{nOff:(e,a)=>{let h=e*128+a,o=t(this,q).lastIndexOf(h);if(o>-1)if(this.getChCc(e,64)>>6)t(this,K)[o]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:a,velo:t(this,j)[h],state:this.NOTE_HELD});else if(this.getChCc(e,66)>>6&&t(this,K)[o]===this.NOTE_SOSTENUTO_SUSTAIN)t(this,K)[o]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:a,velo:t(this,j)[h],state:this.NOTE_SOSTENUTO_HELD});else{t(this,q)[o]=0,t(this,j)[h]=0,t(this,K)[o]=this.NOTE_IDLE;let p=this.getExt(e)[1];(p===this.VLBC_VELOINIT||p===this.VLBC_VELOALL)&&this.setChCc(e,129,0),this.dispatchEvent("note",{part:e,note:a,velo:0,state:this.NOTE_IDLE})}if(t(this,ie)[e]){for(let p=this.polyIndexLast;p>=0;p--)if(t(this,q)[p]>>7===e&&t(this,K)[p]!==0){t(this,K)[p]===this.NOTE_MUTED_RECOVERABLE&&(t(this,K)[p]=this.NOTE_SUSTAIN);break}}this.polyIndexShrink&&this.polyIndexLast>0&&t(this,K)[this.polyIndexLast]===0&&this.polyIndexLast--},nOn:(e,a,h)=>{let o=e*128+a,p=0;if(t(this,ie)[e])for(let y=0;y<=this.polyIndexLast;y++)t(this,q)[y]>>7===e&&t(this,K)[y]!==0&&(t(this,K)[y]=this.NOTE_MUTED_RECOVERABLE);for(;t(this,K)[p]>0&&t(this,q)[p]!==o;)p++;if(p<b.pl){t(this,q)[p]=o,t(this,j)[o]=h,t(this,K)[p]=this.NOTE_SUSTAIN,t(this,Pe)[e]<h&&(t(this,Pe)[e]=h);let y=this.getExt(e)[1];(y===this.VLBC_VELOINIT||y===this.VLBC_VELOALL)&&this.setChCc(e,129,h),this.dispatchEvent("note",{part:e,note:a,velo:h,state:this.NOTE_SUSTAIN}),this.polyIndexLatest=p+1,p>this.polyIndexLast&&(this.polyIndexLast=p)}else console.error("Polyphony exceeded.")},nAt:(e,a,h)=>{},cAt:(e,a)=>{},hoOf:e=>{t(this,K).forEach((a,h)=>{if(a===this.NOTE_HELD){let o=t(this,q)[h],p=o>>7;e===p&&(t(this,K)[h]=this.NOTE_IDLE,t(this,q)[h]=0,t(this,j)[o]=0,this.dispatchEvent("note",{part:e,note:o&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{t(this,K).forEach((a,h)=>{let o;switch(a){case this.NOTE_ATTACK:{o=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{o=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{o=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(o){t(this,K)[h]=o;let p=t(this,q)[h];this.dispatchEvent("note",{part:e,note:p&127,velo:t(this,j)[p],state:o})}})},soOf:e=>{t(this,K).forEach((a,h)=>{if(a===this.NOTE_SOSTENUTO_HELD){let o=t(this,q)[h],p=o>>7;e===p&&(t(this,K)[h]=this.NOTE_IDLE,t(this,q)[h]=0,t(this,j)[o]=0,this.dispatchEvent("note",{part:e,note:o&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{t(this,q).forEach(a=>{let h=a>>7,o=a&127;a===0&&t(this,j)[0]===0||h===e&&t(this,ee).nOff(h,o)})}});S(this,Lt,{8:function(e){let a=e.channel,h=e.data[0];t(this,ee).nOff(a,h)},9:function(e){let a=e.channel,h=this;if(h.getChModeId(a)===x.xg&&t(h,R)[a]>1){let y=h.getChDrumFirstWrite(a);y[0]&&y[1]!==b.invalidCh&&!t(h,ue)[a]&&(h.copyChSetup(y[1],a),h.dispatchEvent("voice",{part:a}),console.debug(`Part CH${a+1} copied from CH${y[1]+1}.`))}h.setChActive(a,1);let o=e.data[0],p=e.data[1];p>0?t(h,ee).nOn(a,o,p):t(h,ee).nOff(a,o)},10:function(e){let a=e.channel,h=a*128+e.data[0];t(this,q).indexOf(h)>-1&&(t(this,j)[h]=data[1],this.getExt(a)[1]===this.VLBC_VELOALL&&this.setChCc(a,129,data[1]),this.dispatchEvent("note",{part:a,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let a=e.channel,h=this,o=t(h,rt)[a],p=o[e.data[0]];p&&(e.data[0]=p),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(t(this,G)){case x.s90es:case x.motif:{if(e.data[0]===0){[0,63].indexOf(e.data[1])>-1&&h.setChActive(a,1);break}e.data[1]&&h.setChActive(a,1);break}default:break}})();let y=a*b.ext,v=h.getChModeId(a);switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{t(this,ee).ano(a),t(this,Le)[a]=0,h.resetChCc(a,1,0),h.resetChCc(a,5,0),h.resetChCc(a,64,0),h.resetChCc(a,65,0),h.resetChCc(a,66,0),h.resetChCc(a,67,0),h.resetChCc(a,11,127),h.resetChCc(a,101,127),h.resetChCc(a,100,127),h.resetChCc(a,99,127),h.resetChCc(a,98,127);return}case 123:{t(this,ee).ano(a);return}case 124:{t(this,ee).ano(a);return}case 125:{t(this,ee).ano(a);return}case 126:{t(this,ie)[a]=1,t(this,ee).ano(a);return}case 127:{t(this,ie)[a]=0,t(this,ee).ano(a);return}}if(w[e.data[0]]===void 0)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(lr.indexOf(e.data[0])>-1&&this.allocateAce(a,e.data[0]),e.data[0]){case 0:{switch(I()&&console.debug(`${Z[t(this,G)]}, CH${a+1}: ${e.data[1]}`),t(this,G)===0?e.data[1]<48?(t(this,R)[a]>0&&(e.data[1]=this.getChPrimitive(a,1,!1),e.data[1]=120,console.debug(`Forced channel ${a+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]===56?this.switchMode(t(this,U).x5===82?"x5d":"05rw"):e.data[1]===62?this.switchMode(t(this,U).x5===82?"x5d":"05rw"):e.data[1]===63?this.switchMode(Z[t(this,U).ds]):(e.data[1]===64||e.data[1]===127)&&this.switchMode("xg"):t(this,G)===x.gs||t(this,G)===x.sc?e.data[1]<56&&t(this,R)[a]>0&&(e.data[1]=this.getChPrimitive(a,1,!1),e.data[1]=120,console.debug(`Forced channel ${a+1} to stay drums.`)):t(this,G)===x.gm&&(e.data[1]<48?t(this,R)[a]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${a+1} to stay drums.`)):(e.data[1]===64||e.data[1]===127)&&this.switchMode("xg",!0)),t(this,G)){case x.xg:{[79,95,126,127].indexOf(e.data[1])>-1?t(this,R)[a]===0&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):t(this,R)[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?t(this,ne)[y]=this.EXT_VL:[35,67,83,99].indexOf(e.data[1])>-1?t(this,ne)[y]=this.EXT_DX:t(this,ne)[y]=this.EXT_NONE;break}case x["05rw"]:case x.x5d:case x.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?t(this,R)[a]===this.CH_MELODIC&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):[80,81,82,83].indexOf(e.data[1])>-1||t(this,R)[a]!==this.CH_MELODIC&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}case x.sd:{[104,105,106,107].indexOf(e.data[1])>-1?t(this,R)[a]===0&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):t(this,R)[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}case x.g2:{e.data[1]===120?t(this,R)[a]===0&&(this.setChType(a,this.CH_DRUMS),console.debug(`CH${a+1} set to drums by MSB.`)):t(this,R)[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}}break}case 2:{this.getExt(a)[1]===this.VLBC_BRTHEXPR&&this.setChCc(a,129,e.data[1]);break}case 6:{if(t(this,qe)[a]){[x.xg,x.gs,x.sc,x.ns5r].indexOf(t(this,G))<0&&console.warn(`NRPN commits are not available under "${Z[t(this,G)]}" mode, even when they are supported in Octavia.`);let m=this.getChCc(a,99),r=this.getChCc(a,98);if(m===1){let d=dr.indexOf(r);if(d>-1)this.setChCc(a,71+d,e.data[1]),I()&&console.debug(`Redirected NRPN 1 ${r} to cc${71+d}.`),this.dispatchEvent("cc",{part:a,cc:71+d,data:e.data[1]});else{let i=ra.indexOf(r);i>-1?t(this,yt)[a*10+i]=e.data[1]-64:console.warn(`NRPN 0x01${r.toString(16).padStart(2,"0")} is not supported.`),I()&&console.debug(`CH${a+1} voice NRPN ${r} commit`)}}else{if(Yt.indexOf(m)<0){let i=`NRPN 0x${m.toString(16).padStart(2,"0")}${r.toString(16).padStart(2,"0")} `;console.warn(m===127?`${i}is not necessary. Consider removing it.`:`${i}is not supported.`)}else{let i=t(this,R)[a]-2;i<0?console.warn(`CH${a+1} cannot accept drum NRPN as type ${Rt[t(this,R)[a]]}.`):t(this,de)[(i*b.dpn+Ee[m])*b.dnc+r]=e.data[1]}I()&&console.debug(`CH${a+1} (${Rt[t(this,R)[a]]}) drum NRPN ${m} commit`)}}else{let m=Ht[this.getChCc(a,100)],r=Aa[this.getChCc(a,100)];if(this.getChCc(a,101)===0&&m!==void 0)switch(I()&&console.debug(`CH${a+1} RPN 0 ${this.getChCc(a,100)} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],Da[m][0]),Da[m][1]),t(this,A)[a*b.rpn+m]=e.data[1],t(this,B)[a*b.rpnt+r]=1,v){case x.xg:case x.gs:case x.sc:case x.mt32:case x.s90es:case x.motif:case x.cs1x:case x.cs6x:{switch(this.getChCc(a,100)){case 1:case 2:{this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)});break}}break}default:this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)})}}break}case 32:{switch(I()&&console.debug(`${Z[t(this,G)]}, CH${a+1} LSB: ${e.data[1]}`),t(this,G)){case x.s90es:case x.motif:{this.setChType(a,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,t(this,G),!0);break}}this.getExt(a)[0],this.EXT_DX;break}case 38:{if(!t(this,qe)[a]){let m=Ht[this.getChCc(a,100)],r=Aa[this.getChCc(a,100)];this.getChCc(a,101)===0&&m!==void 0&&(t(this,A)[a*b.rpn+m+1]=e.data[1],t(this,B)[a*b.rpnt+r]=1)}break}case 64:{e.data[1]<64&&t(this,ee).hoOf(a);break}case 66:{e.data[1]>>6?t(this,ee).soOn(a):t(this,ee).soOf(a);break}case 98:case 99:{t(this,qe)[a]=1;break}case 100:case 101:{t(this,qe)[a]=0;break}}this.setChCc(a,e.data[0],e.data[1]),this.dispatchEvent("cc",{part:a,cc:e.data[0],data:e.data[1]})}h.getChModeId(a)===x.xg&&t(h,R)[a]&&h.setDrumFirstWrite(a)},12:function(e){let a=e.channel,h=this;switch(t(h,G)){case x.s90es:case x.motif:{e.data&&h.setChActive(a,1);break}default:h.setChActive(a,1)}let o=_[a];switch(h.getExt(a)[0]){case h.EXT_VL:break}t(h,L)[a]=e.data,t(h,ye)[a]=0,h.pushChPrimitives(a),I()&&console.debug(`T:${e.track} C:${a} P:${e.data}`),h.dispatchEvent("voice",{part:a}),h.getChModeId(a)===x.xg&&t(h,R)[a]&&h.setDrumFirstWrite(a)},13:function(e){let a=this,h=e.channel;t(this,q).forEach(function(o){let p=o>>7;h===p&&(t(a,j)[o]=e.data,a.dispatchEvent("note",{part:h,note:o&127,velo:e.data,state:a.NOTE_SUSTAIN}))})},14:function(e){let a=e.channel;t(this,Le)[a]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)})},15:function(e){fr(e.data).forEach(a=>{let h=a[0],o=a[1];$(this,$t,a.length),(t(this,Ft)[h]||function(){console.debug(`Unknown manufacturer ${h}.`)})(o,a.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(t(this,ce)[e.meta]||function(h,o,p){}).call(this,e.data,e.track,e.meta),e.meta!==32&&$(this,je,0);let a=or.indexOf(e.meta)>-1;if(I()&&console.debug(e),a)return e.reply="meta",e}});S(this,Ft,{64:(e,a,h)=>{t(this,ct).run(a,h,e)},65:(e,a,h)=>{if(a[0]<16)if(a[1]===72){let o=a[a.length-1],p=ze(a.subarray(3,a.length-1));o===p?t(this,me).run(a.subarray(0,a.length-1),h,e):console.warn(`Bad SD checksum ${o} - should be ${p}.`)}else t(this,me).run(a,h,e);else{let o=a[a.length-1],p=ze(a.subarray(2,a.length-1));o===p?t(this,me).run(a.subarray(0,a.length-1),h,e):console.warn(`Bad GS checksum ${o} - should be ${p}.`)}},66:(e,a,h)=>{t(this,De).run(a,h,e)},67:(e,a,h)=>{switch(e>>4){case 0:{let o=0;for(;a[o]===127&&o<4;)o++;let p=a[1+o]<<7|a[2+o];if(p+7+o!==a.length){console.warn(`Yamaha bulk dump length mismatch! Expected ${a.length-7-o}, received ${p}.`),console.debug(a);break}let y=ze(a.subarray(1+o,a.length-1)),v=a[a.length-1];if(a[a.length-1]>>7)console.warn(`Yamaha bulk dump checksum invalid! Expected ${y}, received ${v}:
`),console.debug(a);else if(y!==v)console.warn(`Yamaha bulk dump checksum mismatch! Expected ${y}, received ${v}:
`),console.debug(a);else{let m=a.slice(2,a.length-1);for(let r=0;r<=o;r++)m[r]=a[r];t(this,te).run(m,h,e&15)}break}case 1:{t(this,te).run(a,h,e&15);break}case 2:{console.warn("Octavia doesn't yet support Yamaha bulk dump requests.");break}case 3:{console.warn("Octavia doesn't yet support Yamaha parameter requests.");break}case 7:{switch(e&15){case 14:{let o=new Uint8Array(a.length+1);o[0]=126,o.set(a,1),t(this,te).run(o,h,0);break}default:console.warn(`Unknown Yamaha special SysEx type: ${e}.`)}break}default:console.warn(`Unknown Yamaha SysEx type: ${e>>4}.`)}},68:(e,a,h)=>{t(this,lt).run(a,h,e)},71:(e,a,h)=>{t(this,ot).run(a,h,e)},126:(e,a,h)=>{t(this,it).run(a,h,e)},127:(e,a,h)=>{this.switchMode("gm"),t(this,nt).run(a,h,e)}});S(this,it,void 0);S(this,nt,void 0);S(this,te,void 0);S(this,me,void 0);S(this,De,void 0);S(this,ct,void 0);S(this,ot,void 0);S(this,lt,void 0);let e=this;$(e,be,new Uint8Array(256),Ua),t(e,Oe)[10]=new Uint8Array(512),$(e,st,new Ce),$(e,U,{x5:82,ds:x.krs,smotif:x.s90es,gs:4,sc:3}),$(e,Re,{dumpLimit:e.DUMP_MODE}),$(e,Dt,new Proxy(t(e,Re),{set:()=>{}}));for(let r in Pa){let d=x[r];d===void 0?console.debug(`SubDB build error: "${r}" does not exist`):t(e,Q)[d]=new Uint8Array(Pa[r])}e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(r){var i,s;let{data:d}=r;((i=t(e,ge)[0])==null?void 0:i.type)===d.type&&((s=t(e,ge)[0])!=null&&s.amend)?(t(e,ge)[0].amend=d.amend,t(e,ge)[0].data+=d.data):t(e,ge).unshift(d)}),t(e,ce)[1]=function(r){var d,i,s,n;switch(r=r.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),r.substring(0,2)){case"@I":{$(e,X,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Info",data:(d=r.substring(2))==null?void 0:d.trimLeft()});break}case"@K":{$(e,X,e.KARAOKE_TEXT);let c=r.substring(2);c!=="MIDI KARAOKE FILE"&&e.dispatchEvent("metacommit",{type:"Kar.Mode",data:c==null?void 0:c.trimLeft()}),console.debug(`Karaoke mode active: ${c}`);break}case"@L":{$(e,X,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Lang",data:(i=r.substring(2))==null?void 0:i.trimLeft()});break}case"@T":{$(e,X,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"KarTitle",data:(s=r.substring(2))==null?void 0:s.trimLeft()});break}case"@V":{$(e,X,e.KARAOKE_TEXT),e.dispatchEvent("metacommit",{type:"Kar.Ver.",data:(n=r.substring(2))==null?void 0:n.trimLeft()});break}case"XF":{let c=r.slice(2).split(":");switch(c[0]){case"hd":{c.slice(1).forEach((l,u)=>{l.length&&e.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][u],data:l})});break}case"ln":{c.slice(1).forEach((l,u)=>{l.length&&e.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][u],data:l})});break}default:e.dispatchEvent("metacommit",{type:"XfUnData",data:r})}break}default:switch(t(e,X)){case e.KARAOKE_TEXT:{switch(r[0]){case"\\":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:r.substring(1),amend:!0});break}case"/":{e.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),e.dispatchEvent("metacommit",{type:"KarLyric",data:r.substring(1),mask:!0,amend:!0});break}default:e.dispatchEvent("metacommit",{type:"KarLyric",data:r,amend:!0})}break}default:r.split(`
`).forEach((c,l)=>{e.dispatchEvent("metacommit",{type:"Cmn.Text",data:c,mask:l!==0})})}}},t(e,ce)[2]=function(r){e.dispatchEvent("metacommit",{type:"Copyrite",data:r})},t(e,ce)[3]=function(r,d){d<1&&t(e,je)<1&&e.dispatchEvent("metacommit",{type:"TrkTitle",data:r})},t(e,ce)[4]=function(r,d){e.dispatchEvent("metacommit",{type:"Instrmnt",data:r})},t(e,ce)[5]=function(r){switch(t(e,X)){case e.KARAOKE_XF:{let d="";for(let i of r)switch(i){case"^":case"%":{d+=" ";break}case">":{d+="	";break}case"<":{e.dispatchEvent("metacommit",{type:"KarLyric",data:d,mask:t(e,W),amend:!1}),d="",$(e,W,!1);break}case"/":{e.dispatchEvent("metacommit",{type:"KarLyric",data:d,mask:!1,amend:!1}),d="",$(e,W,!0);break}default:d+=i}d.length>0&&(e.dispatchEvent("metacommit",{type:"KarLyric",data:d,mask:t(e,W),amend:!0}),$(e,W,!1));break}default:{let d=0,i=!0,s=r.length-1;for(;i&&d<8;)switch(r.charCodeAt(d)){case 32:{d++;break}default:i=!1}switch(d>0&&(e.dispatchEvent("metacommit",{type:"C.Lyrics",data:r.substring(0,d),amend:!0,mask:t(e,W),untimed:!0}),$(e,W,!1)),r.charCodeAt(s)){case 10:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:r.substring(d,s),amend:!1,mask:t(e,W)}),$(e,W,!1);break}case 11:case 13:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:r.substring(d,s),amend:!1,mask:t(e,W)}),$(e,W,!0);break}case 32:{e.dispatchEvent("metacommit",{type:"C.Lyrics",data:r.substring(d,s),amend:!0,mask:t(e,W)}),e.dispatchEvent("metacommit",{type:"C.Lyrics",data:" ",amend:!0,mask:!1,untimed:!0}),$(e,W,!1);break}default:r.trim()===""?console.info("Blank line? Shouldn't happen."):e.dispatchEvent("metacommit",{type:"C.Lyrics",data:r,amend:!0,mask:t(e,W)}),$(e,W,!1)}break}}},t(e,ce)[6]=function(r){e.dispatchEvent("metacommit",{type:"C.Marker",data:r})},t(e,ce)[7]=function(r){switch(r[0]){case"$":{if(r.substring(1,5)==="Lyrc"){$(e,X,e.KARAOKE_XF);let d=r.substring(6).split(":"),i=d[0].replaceAll(" ","").split(",");i.forEach((n,c,l)=>{l[c]=parseInt(n)-1});let s=wa[d[2].substring(0,2).toLowerCase()];e.dispatchEvent("metacommit",{type:"XfMeloCh",data:`CH${d[0].replaceAll(" ","").split(",").join(", CH")}`,parsed:i}),e.dispatchEvent("metacommit",{type:"XfLyrOff",data:d[1],parsed:parseInt(d[1])}),e.dispatchEvent("metacommit",{type:"XfLyrEnc",data:s[1],parsed:s[0]}),$(e,W,!1)}else e.dispatchEvent("metacommit",{type:"CuePoint",data:r});break}case"#":{e.dispatchEvent("metacommit",{type:"XfScneNo",data:r.substring(1)});break}case"&":{r.length===2?(e.dispatchEvent("metacommit",{type:"XfSngPrt",data:$a[r[1]]||`Unknown "${r[1]}"`}),$(e,W,!1)):e.dispatchEvent("metacommit",{type:"CuePoint",data:r});break}default:e.dispatchEvent("metacommit",{type:"CuePoint",data:r})}},t(e,ce)[32]=function(r){$(e,je,r[0]+1)},t(e,ce)[33]=function(r,d){I()&&console.debug(`Track ${d} requests getting assigned to port ${r}.`),t(e,Xe)[d]=r+1},t(e,ce)[81]=function(r,d){$(e,kt,r/1e3)},t(e,ce)[127]=function(r,d){t(e,st).run(r,d)},t(e,st).default=function(r){let d=[];for(let i=0;i<8&&i<r.length;i++)d.push(r[i].toString(16).padStart(2,"0").toUpperCase());console.warn(`Unrecognized implementation-specific byte sequence: ${d.join(" ")}${r.length>8?" ...":""}
%o`,r)},t(e,st).add([67,0,1],(r,d)=>{I()&&console.debug(`XGworks port assign requests assigning track ${d} to port ${r[0]}.`),t(e,Xe)[d]=r[0]+1}).add([67,123,1],(r,d)=>{let i=[];for(let s=0;s<r.length;s+=2){let n=r[s]>>4,c=r[s]&15;if(n<7&&c&&c<8){let l=new Uint8Array(5);l[0]=c-1,l[1]=n-3<<2,l[2]=r[s|1],i.push(l)}}e.dispatchEvent("metacommit",{type:"ChordCtl",src:"yxf",data:i}),console.debug("Yamaha XF chord data: %o",i)}).add([67,123,2],(r,d)=>{var s;let i=new Uint8Array(2);i[0]=r[0]&15,i[1]=r[0]>>4,e.dispatchEvent("metacommit",{type:"RhrslMrk",src:"yxf",data:i}),console.debug(`Yamaha XF rehearsal mark: ${(s=["Intro","Ending","Fill-in"][i[0]])!=null?s:String.fromCharCode(62+i[0])}${"'".repeat(i[1])} %o`,i)}).add([67,123,96],(r,d)=>{let i=[0,0];r.subarray(1,3).forEach(s=>{i[0]=i[0]<<7,i[0]|=s&127}),r.subarray(3,5).forEach(s=>{i[1]=i[1]<<7,i[1]|=s&127}),e.dispatchEvent("metacommit",{type:"YStyleId",data:i}),console.debug(`Yamaha style ID: model ${i[0].toString(16)}, style ${i[1]+1}`)}),$(e,it,new Ce("universal non-realtime")),$(e,nt,new Ce("universal realtime")),$(e,te,new Ce("Yamaha")),$(e,me,new Ce("Roland")),$(e,De,new Ce("Korg")),$(e,ct,new Ce("Kawai")),$(e,ot,new Ce("Akai")),$(e,lt,new Ce("Casio"));let a=new Ce("DX7+ Dump"),h=function(r){let d=[];for(let i=0;i<8&&i<r.length;i++)d.push(r[i].toString(16).padStart(2,"0").toUpperCase());console.info(`Unrecognized SysEx in "${this.name}" set: ${d.join(" ")}${r.length>8?" ...":""}
%o`,r)};t(e,it).default=h,t(e,nt).default=h,t(e,te).default=h,t(e,me).default=h,t(e,De).default=h,t(e,ct).default=h,t(e,ot).default=h,t(e,lt).default=h,a.default=h,t(e,it).add([9],(r,d,i)=>{e.switchMode(["gm","?","g2"][r[0]-1],!0),e.setPortMode(e.getTrackPort(d),1,x[["gm","?","g2"][r[0]-1]]),$(e,X,t(e,X)||e.KARAOKE_NONE),console.info(`MIDI reset: ${["GM","Init","GM2"][r[0]-1]}`),r[0]===2&&e.init()}),t(e,nt).add([4,1],(r,d,i)=>{e.invokeSysExIndicator(),$(e,F,((r[1]<<7)+r[0])/16383*100),e.dispatchEvent("mastervolume",t(e,F))}).add([4,3],(r,d,i)=>((r[1]<<7)+r[0]-8192)/8192).add([4,4],(r,d,i)=>r[1]-64).add([4,5],(r,d,i)=>{e.invokeSysExIndicator();let s=r[0],n=r[1],c=r[2],l=3,u=l+(s<<1),f=u+n;if(s!==1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${s})!
`,r);return}let E=0,C=0,T=0;switch(r.subarray(l,u).forEach(D=>{E=E<<7,E|=D}),r.subarray(u,f).forEach((D,M)=>{C|=D<<M*7}),r.subarray(f).forEach((D,M)=>{T|=D<<M*7}),I()&&console.debug(`GM2 global parameter: (${r.subarray(3,u)}; p: ${C}, v: ${T})`),E){case 129:{C===0&&(e.setEffectType(0,52,T),e.dispatchEvent("efxreverb",e.getEffectType(0)));break}case 130:{C===0&&(e.setEffectType(1,52,T|16),e.dispatchEvent("efxchorus",e.getEffectType(1)));break}default:I()&&console.debug("GM2 global paramater slot path unknown.")}}),t(this,te).add([76,0,0],(r,d,i)=>{switch(r[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset on drum kit ${r[1]}.`);break}case 126:{e.switchMode("xg",!0),e.setPortMode(e.getTrackPort(d),4,x.xg),$(e,X,t(e,X)||e.KARAOKE_NONE),console.info("MIDI reset: XG");break}default:{e.invokeSysExIndicator();let s=[0,0,0,0],n=(c,l)=>{s[l]=c};if(r.subarray(1).forEach((c,l)=>{let u=l+r[0];([n,n,n,n,f=>{$(this,F,f*129/16383*100),e.dispatchEvent("mastervolume",t(e,F))},f=>{},f=>{}][u]||(()=>{}))(c,l)}),r[0]<4){let c=0;s.forEach(l=>{c=c<<4,c+=l}),c-=1024,console.debug(`Master tune: ${c}`)}}}}).add([76,2,1],(r,d,i)=>{e.invokeSysExIndicator();let s="XG ";r[0]<32?(s+="reverb ",r.subarray(1).forEach((n,c)=>{([l=>{e.setEffectTypeRaw(0,!1,l),console.info(`${s}main type: ${Pt[l]}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},l=>{e.setEffectTypeRaw(0,!0,l),console.debug(`${s}sub type: ${l+1}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},l=>{console.debug(`${s}time: ${ya(l)}s`)},l=>{console.debug(`${s}diffusion: ${l}`)},l=>{console.debug(`${s}initial delay: ${l}`)},l=>{console.debug(`${s}HPF cutoff: ${bt[l]}Hz`)},l=>{console.debug(`${s}LPF cutoff: ${bt[l]}Hz`)},l=>{console.debug(`${s}width: ${l}`)},l=>{console.debug(`${s}height: ${l}`)},l=>{console.debug(`${s}depth: ${l}`)},l=>{console.debug(`${s}wall type: ${l}`)},l=>{console.debug(`${s}dry/wet: ${l}`)},l=>{console.debug(`${s}send: ${fe(l)}dB`)},l=>{console.debug(`${s}pan: ${l-64}`)},!1,!1,l=>{console.debug(`${s}delay: ${l}`)},l=>{console.debug(`${s}density: ${l}`)},l=>{console.debug(`${s}balance: ${l}`)},l=>{},l=>{console.debug(`${s}feedback: ${l}`)},l=>{}][r[0]+c]||function(){console.warn(`Unknown XG reverb address: ${r[0]}.`)})(n)})):r[0]<64?(s+="chorus ",r.subarray(1).forEach((n,c)=>{([l=>{e.setEffectTypeRaw(1,!1,l),console.info(`${s}main type: ${Pt[l]}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},l=>{e.setEffectTypeRaw(1,!0,l),console.debug(`${s}sub type: ${l+1}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},l=>{console.debug(`${s}LFO: ${Ea[l]}Hz`)},l=>{},l=>{console.debug(`${s}feedback: ${l}`)},l=>{console.debug(`${s}delay offset: ${ma(l)}ms`)},l=>{},l=>{console.debug(`${s}low: ${bt[l]}Hz`)},l=>{console.debug(`${s}low: ${l-64}dB`)},l=>{console.debug(`${s}high: ${bt[l]}Hz`)},l=>{console.debug(`${s}high: ${l-64}dB`)},l=>{console.debug(`${s}dry/wet: ${l}`)},l=>{console.debug(`${s}send: ${fe(l)}dB`)},l=>{console.debug(`${s}pan: ${l-64}`)},l=>{console.debug(`${s}to reverb: ${fe(l)}dB`)},!1,l=>{},l=>{},l=>{},l=>{console.debug(`${s}LFO phase diff: ${(l-64)*3}deg`)},l=>{console.debug(`${s}input mode: ${l?"stereo":"mono"}`)},l=>{}][r[0]-32+c]||function(){console.warn(`Unknown XG chorus address: ${r[0]}.`)})(n)})):r[0]<86?(s+="variation ",r.subarray(1).forEach((n,c)=>{([l=>{e.setEffectTypeRaw(2,!1,l),console.info(`${s}main type: ${Pt[l]}`),e.dispatchEvent("efxdelay",e.getEffectType(2))},l=>{e.setEffectTypeRaw(2,!0,l),console.debug(`${s}sub type: ${l+1}`),e.dispatchEvent("efxdelay",e.getEffectType(2))}][r[0]-64+c]||function(){})(n)})):r[0]<97?(s+="variation ",r.subarray(1).forEach((n,c)=>{[l=>{console.debug(`${s}send: ${fe(l)}dB`)},l=>{console.debug(`${s}pan: ${l-64}`)},l=>{console.debug(`${s}to reverb: ${fe(l)}dB`)},l=>{console.debug(`${s}to chorus: ${fe(l)}dB`)},l=>{console.debug(`${s}connection: ${l?"system":"insertion"}`)},l=>{console.debug(`${s}channel: CH${l+1}`)},l=>{console.debug(`${s}mod wheel: ${l-64}`)},l=>{console.debug(`${s}bend wheel: ${l-64}`)},l=>{console.debug(`${s}channel after touch: ${l-64}`)},l=>{console.debug(`${s}AC1: ${l-64}`)},l=>{console.debug(`${s}AC2: ${l-64}`)}][r[0]-86+c](n)})):r[0]>111&&r[0]<118?s+="variation ":console.warn(`Unknown XG variation address: ${r[0]}`)}).add([76,2,64],(r,d,i)=>{r.subarray(1).forEach((s,n)=>{let c=n+r[0];if(c===0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][s]}`);else{let l=c-1>>2,u=c-1&3,f=`XG EQ ${l} ${["gain","freq","Q","shape"][u]}: `;[()=>{console.debug(`${f}${s-64}dB`)},()=>{console.debug(`${f}${s} (raw)`)},()=>{console.debug(`${f}${s/10}`)},()=>{console.debug(`${f}${["shelf","peak"][+!!s]}`)}][u]()}})}).add([76,3],(r,d,i)=>{e.invokeSysExIndicator();let s=r[0],n=r[1],c=`XG Insertion ${r[0]+1} `;r.subarray(2).forEach((l,u)=>{([f=>{e.setEffectTypeRaw(3+s,!1,f),console.info(`${c}main type: ${Pt[f]}`),e.dispatchEvent(`efxinsert${s}`,e.getEffectType(3+s))},f=>{e.setEffectTypeRaw(3+s,!0,f),console.debug(`${c}sub type: ${f+1}`),e.dispatchEvent(`efxinsert${s}`,e.getEffectType(3+s))}][n+u]||function(){})(l)})}).add([76,6,0],(r,d,i)=>{let s=r[0];s<64?e.setLetterDisplay(r.subarray(1),"XG letter display",s):$(e,Ge,Date.now())}).add([76,7,0],(r,d,i)=>{let s=r[0];$(e,se,0),$(e,we,Date.now()+3200),t(e,be,Ie).fill(0);let n=r.subarray(1);for(let c=0;c<s;c++)n.unshift(0);n.forEach(function(c,l){let u=Math.floor(l/16),f=l%16,E=(f*3+u)*7,C=7,T=0;for(E-=f*5,u===2&&(C=2);T<C;)t(e,be,Ie)[E+T]=c>>6-T&1,T++})}).add([76,8],(r,d)=>{e.invokeSysExIndicator();let i=e.chRedir(r[0],d,!0),s=r[1],n=_[i],c=`XG CH${i+1} `,l=`Unknown XG part address ${s}.`,u=!0;r.subarray(2).forEach((f,E)=>{u=!0,s<1?console.debug(l):s<41?([()=>{e.setChCc(i,0,f),e.pushChPrimitives(i),e.dispatchEvent("voice",{part:i})},()=>{e.setChCc(i,32,f),e.pushChPrimitives(i),e.dispatchEvent("voice",{part:i})},()=>{t(e,L)[i]=f,e.dispatchEvent("voice",{part:i})},()=>{u=!1;let C=e.chRedir(f,d,!0),T=t(e,H)[i];t(e,H)[i]=C,(i!==C||C!==T)&&(e.buildRchTree(),console.info(`${c}receives from CH${C+1}`)),t(e,ue)[i]||(e.copyChSetup(C,i,!0),console.debug(`${c}copied from CH${C+1}.`),e.setChActive(i,1),e.dispatchEvent("voice",{part:i}))},()=>{t(e,ie)[i]=+!f},()=>{},()=>{u=!1,e.setChType(i,f,x.xg),console.debug(`${c}type: ${Rt[f]||f}`),e.dispatchEvent("voice",{part:i})},()=>{t(e,A)[b.rpn*i+3]=f,t(e,B)[b.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},!1,!1,()=>{e.setChCc(i,7,f)},!1,!1,()=>{e.setChCc(i,10,f||128)},!1,!1,()=>{e.setChCc(i,128,f),e.allocateAce(i,128)},()=>{e.setChCc(i,93,f)},()=>{e.setChCc(i,91,f)},()=>{e.setChCc(i,94,f)},()=>{e.setChCc(i,76,f)},()=>{e.setChCc(i,77,f)},()=>{e.setChCc(i,78,f)},()=>{e.setChCc(i,74,f)},()=>{e.setChCc(i,71,f)},()=>{e.setChCc(i,73,f)},()=>{e.setChCc(i,75,f)},()=>{e.setChCc(i,72,f)}][s+E-1]||(()=>{}))():s<48?console.debug(l):s<111?s>102&&s<105&&e.setChCc(i,[5,65][s&1],f):s<114?console.debug(l):s<116?console.debug(`${c}EQ ${["bass","treble"][s&1]} gain: ${f-64}dB`):s<118?console.debug(l):s<120?console.debug(`${c}EQ ${["bass","treble"][s&1]} freq: ${f}`):console.debug(l)}),u&&t(e,R)[i]>1&&e.setDrumFirstWrite(i)}).add([76,9],(r,d)=>{let i=e.chRedir(r[0],d,!0),s=r[1],n=_[i],c=`PLG-VL CH${i+1} `;r.subarray(2).forEach((l,u)=>{let f=u+s;switch(f){case 1:{console.info(`${c}breath mode: ${["system","breath","velocity","touch EG"][l]}`);break}case 0:case 27:case 28:break;default:if(f<27){let E=f-3>>1,C=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][E];f&1?f<23?(console.debug(`${c}${C} control source: ${ka(l)}`),l&&l<96&&e.allocateAce(i,130+E),t(e,Qe)[b.redir*i+E+2]=l,e.buildRccMap()):console.debug(`${c}${C} scale break point: ${l}`):(console.debug(`${c}${C} depth: ${l-64}`),e.setChCc(i,130+E,l))}}})}).add([76,10],(r,d,i)=>{}).add([76,16],(r,d,i)=>{}).add([76,17,0,0],(r,d,i)=>{}).add([76,112],(r,d,i)=>{switch(console.debug(`XG enable PLG-${["VL","SG","DX","AN","PF","DR","PC","AP"][r[0]]} for CH${r[2]+1}.`),r[0]){case 0:{t(e,ne)[b.ext*r[2]]=e.EXT_VL;break}case 2:{t(e,ne)[b.ext*r[2]]=e.EXT_DX;break}default:t(e,ne)[b.ext*r[2]]=e.EXT_NONE}}).add([73,0,0],(r,d)=>{let i=r[0],s="MU1000 System - ";r.subarray(1).forEach((n,c)=>{let l=i+c;l===8?console.debug(`${s}LCD contrast: ${n}.`):l===18?(t(e,Q)[x.xg][1]=n?126:0,console.debug(`${s}default bank: ${n?"MU100 Native":"MU Basic"}.`),e.dispatchEvent("banklevel",{mode:"xg",data:+!!n}),e.forceVoiceRefresh()):l>=64&&l<69&&[()=>{e.dispatchEvent("channelactive",n)},()=>{n<8?(e.dispatchEvent("channelmin",n<<4),console.debug(`Octavia System: Minimum CH${(n<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{n<8?(e.dispatchEvent("channelmax",(n<<4)+15),console.debug(`Octavia System: Maximum CH${(n<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{$(e,Ae,!!n),console.info(`Octavia System: RS receiving ${["dis","en"][n]}abled.`)}][l-64]()})}).add([73,10,0],(r,d)=>{let i=r[0],s=`MU1000 RS${t(e,Ae)?"":" (ignored)"}: `;if(i<16)switch(i){case 2:{let n=e.chRedir(0,d,!0);t(e,Ae)&&(e.dispatchEvent("portrange",4),e.dispatchEvent("portstart",n)),console.info(`${s}Show CH${n+1}~CH${n+64}`);break}case 3:{let n=e.chRedir(r[1]<<5,d,!0);t(e,Ae)&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",n)),console.info(`${s}Show CH${n+1}~CH${n+32}`);break}default:console.debug(`${s}unknown switch ${i} invoked.`)}else if(i<32){if(t(e,Ae)){let n=e.chRedir(i-16+(t(e,wt)<<4),d,!0);e.dispatchEvent("channelactive",n)}}else if(i<36){let n=e.chRedir(i-32<<4,d,!0);t(e,Ae)&&(e.dispatchEvent("portrange",1),e.dispatchEvent("portstart",n>>4),$(e,wt,i-32)),console.info(`${s}Show CH${n+1}~CH${n+16}`)}}).add([73,11,0],(r,d)=>{let i="MU1000 System - channel ",s="Octavia System - channel ",n=r[0];r.subarray(1).forEach((c,l)=>{let u=n+l;([()=>{e.setChActive(c,1),e.dispatchEvent("channelactive",c),I()&&console.debug(`${i}current part: CH${c+1}`)},()=>{c<5?(e.dispatchEvent("portrange",1<<c),console.debug(`${i}port range: ${1<<c} port(s)`)):(e.dispatchEvent("portrange",0),console.debug(`${i}port range: reset`))},()=>{c<16?(e.dispatchEvent("portstart",c),console.debug(`${s}start port: ${"ABCDEFGHIJKLMNOP"[c]}`)):(e.dispatchEvent("portstart",255),console.debug(`${s}start port: reset`))}][u]||(()=>{console.debug(`${i}unknown address: ${u}`)}))()})}).add([93,3],(r,d)=>{let i=e.chRedir(r[0],d,!0),s=`PLG-SG CH${i+1} `,n=Date.now();if(r[1]===0){let c="",l=0;r.subarray(2).forEach((u,f)=>{f%2===0?c+=va[u]||u.toString().padStart("0"):l+=u*13}),(n>=t(e,et)||t(e,tt)>=t(e,Vt))&&(e.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),$(e,at,n<t(e,et)),$(e,tt,0)),e.dispatchEvent("metacommit",{type:"SGLyrics",data:`${Ca(c)}`,amend:!0,mask:t(e,at)}),da(e,tt)._++,$(e,at,!1),$(e,et,n+Math.ceil(l/2)+t(e,kt)),I()&&console.debug(`${s}vocals: ${c}`)}else console.warn(`Unknown PLG-SG data: ${r}`)}).add([98,96],(r,d,i,s)=>{let n=e.chRedir(r[0],d,!0),c=_[n],l=r[1];r.subarray(2).forEach((u,f)=>{let E=l+f;if(!(E<10)){if(E===10)e.resetAce();else if(E<27){let C=E+131;e.setChCc(n,C,u),!(s!=null&&s.noAce)&&u>0&&u!==64&&e.allocateAce(n,C),e.dispatchEvent("cc",{part:n,cc:C,data:u})}}})}).add([1,20],(r,d,i)=>{i===115?(e.switchMode("doc",!0),e.setPortMode(e.getTrackPort(d),1,x.doc),console.info("MIDI reset: DOC")):console.debug(`Unknown Yamaha SysEx: 67, ${i}, ${r.join(", ")}`)}).add([1,17,15,89],(r,d,i)=>{i===115?(e.setEffectType(0,24,r[0]|16),e.dispatchEvent("efxreverb",e.getEffectType(0))):console.debug(`Unknown Yamaha SysEx: 67, ${i}, ${r.join(", ")}`)}).add([1,24],(r,d,i)=>{if(i===115){for(let s=0;s<16;s++){let n=e.chRedir(s,d,!0);e.setChCc(n,91,127)}console.info("DOC Global Reverb: on")}else console.debug(`Unknown Yamaha SysEx: 67, ${i}, ${r.join(", ")}`)}).add([126,0],(r,d,i)=>{var s,n,c;switch(r[1]){case 0:{e.dispatchEvent("metacommit",{type:"YMCSSect",data:"Disabled",raw:"Intro "}),console.debug("Yamaha Section Control is off.");break}case 127:{e.dispatchEvent("metacommit",{type:"YMCSSect",data:(s=["Intro","Main A","Main B","Fill-in AB","Fill-in BA","Ending","Blank"][r[0]-8])!=null?s:`invalid section ${r[0]}`,raw:(n=["Intro ","Main A","Main B","FillAB","FillBA","Ending","Blank "][r[0]-8])!=null?n:`ID: ${r[0]}`}),console.debug(`Yamaha Section Control switches to "${(c=["intro","main A","main B","fill-in AB","fill-in BA","ending","blank"][r[0]-8])!=null?c:`Invalid section ${r[0]}`}".`);break}default:console.debug(`Unknown YMCS section control: ${r[1]}`)}}).add([126,2],(r,d,i)=>{let s=[];for(let n=0;n<r.length;n+=2){let c=r[n]>>4,l=r[n]&15;if(c<7&&l&&l<8){let u=new Uint8Array(5);u[0]=l-1,u[1]=c-3<<2,u[2]=r[n|1],s.push(u)}}e.dispatchEvent("metacommit",{type:"ChordCtl",src:"ymcs",data:s}),console.debug("YMCS chord data: %o",s)});let o=function(r,d,i,s){},p=function(r,d){e.invokeSysExIndicator();let i=r*b.dpn,s=d[0],n=d[1];d.subarray(2).forEach((c,l)=>{let u=l+n,f=-1;u<16?([()=>{f=24},()=>{f=25},()=>{f=26},()=>{},()=>{f=28},()=>{f=29},()=>{f=30},()=>{f=31},()=>{},()=>{},()=>{},()=>{f=20},()=>{f=21},()=>{f=22},()=>{f=23},()=>{}][u]||(()=>{console.debug(`Unknown XG-style drum param ${u} on set ${r+1}.`)}))():u<32||(u<40?([()=>{f=48},()=>{f=49},!1,!1,()=>{f=52},()=>{f=53}][u-32]||(()=>{console.debug(`Unknown XG-style drum param ${u} on set ${r+1}.`)}))():u<80||([()=>{f=36}][u-80]||(()=>{console.debug(`Unknown XG-style drum param ${u} on set ${r+1}.`)}))()),f>=0?(I()&&console.debug(i,f,s,c),t(e,de)[(i+Ee[f])*b.dnc+s]=c):I()&&console.debug(`XG-style drum param ${u} has no writes.`)})},y=function(r,d,i){e.invokeSysExIndicator();let s=r*b.dpn,n=(d<<7)+i[0];i.subarray(1).forEach((c,l)=>{let u=l+n,f=u&127,E=u>>7,C=-1;E>1&&([()=>{C=26},()=>{},()=>{C=28},()=>{C=29},()=>{C=30},()=>{},()=>{},()=>{C=31}][E-2]||(()=>{console.debug(`Unknown GS-style drum param ${E} on set ${r+1}.`)}))(),C>-1?(I()&&console.debug(s,C,f,c),t(e,de)[(s+Ee[C])*b.dnc+f]=c):I()&&console.debug(`GS-style drum param ${E} has no writes.`)})};t(this,te).add([76,48],(r,d,i)=>{p(0,r)}).add([76,49],(r,d,i)=>{p(1,r)}).add([76,50],(r,d,i)=>{p(2,r)}).add([76,51],(r,d,i)=>{p(3,r)}).add([76,52],(r,d,i)=>{p(4,r)}).add([76,53],(r,d,i)=>{p(5,r)}).add([76,54],(r,d,i)=>{p(6,r)}).add([76,55],(r,d,i)=>{p(7,r)}),t(this,te).add([89,0],(r,d,i)=>{if(e.eprom){let s=r[0],n=(r[1]<<14)+(r[2]<<7)+r[3]+(e.eprom.offset||0);I()&&console.debug(`MU1000 EPROM trail to 0x${n.toString(16).padStart(6,"0")}, ${s} bytes.`);let c=e.eprom.data;r.subarray(4).forEach((l,u)=>{let f=u>>3,E=u&7;if(E===7)for(let C=0;C<7;C++)c[n+7*f+C]+=(l>>6-C&1)<<7;else c[n+7*f+E]=l})}}).add([89,1],(r,d,i)=>{let s=(r[0]<<21)+(r[1]<<14)+(r[2]<<7)+r[3];I()&&console.debug(`MU1000 EPROM jump to 0x${s.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=s)}).add([89,2],(r,d,i)=>{if(e.eprom){let s=(r[0]<<21)+(r[1]<<14)+(r[2]<<7)+r[3]+(e.eprom.offset||0);I()&&console.debug(`MU1000 EPROM write to 0x${s.toString(16).padStart(6,"0")}.`);let n=e.eprom.data;r.subarray(4).forEach((c,l)=>{let u=l>>3,f=l&7;if(f===7)for(let E=0;E<7;E++)n[s+7*u+E]+=(c>>6-E&1)<<7;else n[s+7*u+f]=c})}}).add([89,3],(r,d,i)=>{}),t(this,te).add([39,48],(r,d,i)=>{}).add([43,0,0],(r,d,i)=>{e.invokeSysExIndicator();let s=[0,0,0,0],n=(c,l)=>{s[l]=c};if(r.subarray(1).forEach((c,l)=>{let u=l+r[0];[n,n,n,n,()=>{$(this,F,c*129/16383*100),e.dispatchEvent("mastervolume",t(e,F))},()=>c-64,()=>c||128,()=>c,()=>c,()=>{console.debug(`TG300 variation on cc${c}.`)}][u](c,u)}),r[0]<4){let c=0;s.forEach(l=>{c=c<<4,c+=l}),c-=1024,console.debug(`Master tune: ${c}`)}}).add([43,1,0],(r,d,i)=>{e.invokeSysExIndicator()}).add([43,2],(r,d,i)=>{e.invokeSysExIndicator();let s=e.chRedir(r[0],d,!0),n=r[1],c=_[s],l=`TG300 CH${s+1} `;r.subarray(2).forEach((u,f)=>{f<5?([()=>{},()=>{e.setChCc(s,0,u),e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{e.setChCc(s,32,u),e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{t(e,L)[s]=u,e.dispatchEvent("voice",{part:s})},()=>{let E=e.chRedir(u,d,!0),C=t(e,H)[s];t(e,H)[s]=E,(s!==E||E!==C)&&(e.buildRchTree(),console.info(`${l}receives from CH${E+1}`))}][f+n]||(()=>{}))(u,f+n):f<21||(f<47?([()=>{t(e,ie)[s]=+!u},()=>{},()=>{},()=>{t(e,A)[b.rpn*s+3]=u,t(e,B)[b.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{},()=>{e.setChCc(s,7,u)},!1,!1,()=>{e.setChCc(s,10,u||128)},!1,!1,()=>{console.debug(`${l} AC1 at cc${u}`)},()=>{console.debug(`${l} AC2 at cc${u}`)},()=>{t(e,k)[c+w[128]]=u,e.allocateAce(s,128)},()=>{t(e,k)[c+w[93]]=u},()=>{t(e,k)[c+w[91]]=u},()=>{t(e,k)[c+w[94]]=u},()=>{t(e,k)[c+w[76]]=u},()=>{t(e,k)[c+w[77]]=u},()=>{t(e,k)[c+w[74]]=u},()=>{t(e,k)[c+w[71]]=u},()=>{t(e,k)[c+w[73]]=u},()=>{t(e,k)[c+w[75]]=u},()=>{t(e,k)[c+w[72]]=u},()=>{t(e,k)[c+w[78]]=u}][f+n-21]||(()=>{}))(u,f+n):f<95||([()=>{t(e,k)[c+w[65]]=u},()=>{t(e,k)[c+w[5]]=u}][f+n-95]||(()=>{}))(u,f+n))})}).add([43,7,0],(r,d,i)=>{let s=r[0];e.setLetterDisplay(r.subarray(1),"TG300 letter display",s)}).add([43,7,1],(r,d,i)=>{$(e,se,0),$(e,we,Date.now()+3200),t(e,be,Ie).fill(0),r.forEach(function(s,n){let c=Math.floor(n/16),l=n%16,u=(l*3+c)*7,f=7,E=0;for(u-=l*5,c===2&&(f=2);E<f;)t(e,be,Ie)[u+E]=s>>6-E&1,E++})}),t(this,me).add([66,18,0,0,127],(r,d,i)=>{e.switchMode("sc",!0),e.setPortMode(e.getTrackPort(d),2,x.sc),t(e,Q)[x.sc][1]=t(e,U).sc,$(e,X,e.KARAOKE_NONE),t(e,Be).fill(0),console.info(`GS system to ${["single","dual"][r[0]]} mode.`)}).add([66,18,64,0],(r,d,i)=>{switch(r[0]){case 127:{e.switchMode("gs",!0),e.setPortMode(e.getTrackPort(d),4,x.gs),t(e,Q)[x.gs][1]=t(e,U).gs,$(e,X,e.KARAOKE_NONE),t(e,Be).fill(0),console.info("MIDI reset: GS");break}default:{e.invokeSysExIndicator();let s=[0,0,0,0],n=(c,l)=>{s[l]=c};if(r.subarray(1).forEach((c,l)=>{let u=l+r[0];[n,n,n,n,f=>{$(this,F,f*129/16383*100),e.dispatchEvent("mastervolume",t(e,F))},f=>{},f=>{}][u](c,l)}),r[0]<4){let c=0;s.forEach(l=>{c=c<<4,c+=l}),c-=1024,console.debug(`Master tune: ${c}`)}}}}).add([66,18,64,1],(r,d,i)=>{e.invokeSysExIndicator();let s=r[0];if(s<16){let n="".padStart(s," ");r.subarray(1).forEach((c,l)=>{n+=String.fromCharCode(Math.max(32,c))}),n=n.padEnd(16," "),console.debug(`GS patch name: ${n}`)}else s<48||(s<65?r.subarray(1).forEach((n,c)=>{let l=`GS ${s+c>55?"chorus":"reverb"} `;([()=>{console.info(`${l}type: ${Zt[n]}`),e.setEffectType(0,40,n),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${l}predelay: ${n}ms`)},()=>{console.info(`${l}type: ${xa[n]}`),e.setEffectType(1,40,16+n),e.dispatchEvent("efxchorus",e.getEffectType(1))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${l}to reverb: ${fe(n)}`)},()=>{console.debug(`${l}to delay: ${fe(n)}`)}][s+c-48]||(()=>{}))()}):s<80?console.debug(`Unknown GS patch address: ${s}`):s<91?r.subarray(1).forEach((n,c)=>{let l="GS delay ";([()=>{console.info(`${l}type: ${Sa[n]}`),e.setEffectType(2,40,32+n),e.dispatchEvent("efxdelay",e.getEffectType(2))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${l}to reverb: ${fe(n)}`)}][s+c-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${s}`))}).add([66,18,64,2],(r,d,i)=>{let s="GS EQ ";r.subarray(1).forEach((n,c)=>{([()=>{console.debug(`${s}low freq: ${[200,400][n]}Hz`)},()=>{console.debug(`${s}low gain: ${n-64}dB`)},()=>{console.debug(`${s}high freq: ${[3e3,6e3][n]}Hz`)},()=>{console.debug(`${s}high gain: ${n-64}dB`)}][r[0]+c]||function(){console.warn(`Unknown GS EQ address: ${r[0]+c}`)})()})}).add([66,18,64,3],(r,d,i)=>{e.invokeSysExIndicator();let s="GS EFX ",n=function(c,l){let u=Ta(t(e,pe).subarray(10,12),l,c);u&&console.debug(`${s}${Jt(t(e,pe).subarray(10,12))} ${u}`)};r.subarray(1).forEach((c,l)=>{([()=>{e.setEffectTypeRaw(3,!1,32+c),e.dispatchEvent("efxinsert0",e.getEffectType(3))},()=>{e.setEffectTypeRaw(3,!0,c),console.info(`${s}type: ${Jt(t(e,pe).subarray(10,12))}`),e.dispatchEvent("efxinsert0",e.getEffectType(3))},!1,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,()=>{console.debug(`${s}to reverb: ${fe(c)}dB`)},()=>{console.debug(`${s}to chorus: ${fe(c)}dB`)},()=>{console.debug(`${s}to delay: ${fe(c)}dB`)},!1,()=>{console.debug(`${s}1 source: ${c}`),c&&c<96&&e.allocateAceAll(c)},()=>{console.debug(`${s}1 depth: ${c-64}`)},()=>{console.debug(`${s}2 source: ${c}`),c&&c<96&&e.allocateAceAll(c)},()=>{console.debug(`${s}2 depth: ${c-64}`)},()=>{console.debug(`${s}to EQ: ${c?"ON":"OFF"}`)}][r[0]+l]||function(u,f){console.warn(`Unknown GS EFX address: ${f}`)})(c,r[0]+l)})}).add([66,18,65],(r,d,i)=>{y((r[0]>>4)+1<<1,r[0]&15,r.subarray(1))}).add([69,18,16],(r,d,i)=>{var s;switch(r[0]){case 0:{let n=r[1];e.setLetterDisplay(r.subarray(2),"GS display text",n);break}case 8:{let n=r[1],c=e.modelEx.sc;r.subarray(2).forEach((l,u)=>{([()=>{c.showBar=!(l&1),c.invBar=l>>1&1,c.invDisp=l>>2&1},()=>{c.peakHold=l<4?l:1}][u+n]||(()=>{console.debug("Unsupported GS display type SysEx.")}))()});break}case 32:{$(e,we,Date.now()+3200),r[1]===0&&(r[2]?($(e,se,Math.max(Math.min(r[2]-1,9),0)),I()&&console.debug(`GS switch display page ${r[2]-1}.`)):($(e,se,0),$(e,we,Date.now()),I()&&console.debug("GS disable display page.")));break}default:if(r[0]<6){t(e,se)>9&&$(e,se,0);let n=r[0]-1<<1|r[1]>>6;t(e,se)===n&&$(e,we,Date.now()+3200),(s=t(e,Oe)[n])!=null&&s.length||(t(e,Oe)[n]=new Uint8Array(256));let c=t(e,Oe)[n];I()&&console.debug(`GS frame draw page ${n}.`);let l=r[1]&63;c.fill(0),r.subarray(2).forEach(function(f,E){let C=E+l,T=Math.floor(C/16),D=C%16,M=(D*4+T)*5,O=5,z=0;for(M-=D*4,T===3&&(O=1);z<O;)c[M+z]=f>>4-z&1,z++})}else console.warn(`Unknown GS display section: ${r[0]}`)}}).add([69,18,32],(r,d,i)=>{let s=r[0],n=r[1],c=r.subarray(2);if(s>>4){console.warn(`SC-8850 partial screen dump out of bounds: invalid bundle.
`,r);return}let l=n+c.length,u=n*6-(n*2428>>16<<1),f=l*6-(l*2428>>16<<1);if(u>640){console.warn(`SC-8850 partial screen dump out of bounds: invalid buffer range.
`,r);return}f>640&&(console.info(`SC-8850 partial screen dump out of bounds: invalid buffer end, automatically restricted.
`,r),f=640);let E=new Uint8Array(f-u);c.forEach((D,M)=>{let O=M+n,z=(O*2428&65535)*27>>16===26,Y=O*6-(O*2428>>16<<1),Te=z?2:0;for(;Te<6;)E[Y+(5-Te)]=D>>Te&1,Te++});let C=s*108+n,T=C*6-(C*2428>>16<<1);e.dispatchEvent("screen",{type:"sc8850",offset:T,data:E}),I()&&console.debug(`SC-8850 screen dump: bundle ${s+1}, range ${u}~${f}`)});let v=function(r,d,i){e.invokeSysExIndicator();let s=r[0],n=_[d],c=Et[d],l=`GS CH${d+1} `;s<3?(r.subarray(1).forEach((u,f)=>{[()=>{t(e,k)[n+w[0]]=u,e.pushChPrimitives(d)},()=>{t(e,L)[d]=u},()=>{let E=0;u<16?E=e.chRedir(u,i,!0):E=b.ch,t(e,H)[d]=E;let C=t(e,H)[d];t(e,H)[d]=E,(d!==E||E!==C)&&(e.buildRchTree(),console.info(`${l}receives from CH${E+1}`))}][s+f]()}),e.dispatchEvent("voice",{part:d})):s<19||(s<44?r.subarray(1).forEach((u,f)=>{([()=>{t(e,ie)[d]=+!u},!1,()=>{e.setChType(d,u<<1,x.gs),console.debug(`${l}type: ${u?"drum ":"melodic"}${u||""}`)},()=>{t(e,A)[c+3]=u,t(e,B)[b.rpnt*d+2]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)})},!1,()=>{t(e,k)[n+w[7]]=u},!1,!1,()=>{t(e,k)[n+w[10]]=u||128},!1,!1,()=>{console.debug(`${l}CC 1: cc${u}`)},()=>{console.debug(`${l}CC 2: cc${u}`)},()=>{t(e,k)[n+w[93]]=u},()=>{t(e,k)[n+w[91]]=u},!1,!1,()=>{t(e,A)[c+1]=u,t(e,B)[b.rpnt*d+1]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)})},()=>{t(e,A)[c+2]=u,t(e,B)[b.rpnt*d+1]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)})},()=>{t(e,k)[n+w[94]]=u}][s+f-19]||(()=>{}))()}):s<76||console.debug(`Unknown GS part address: ${s}`))},m=function(r,d){let i=r[0],s=`GS CH${d+1} `;i<2?r.subarray(1).forEach((n,c)=>{[()=>{e.setChCc(d,32,n)},()=>{}][i+c]()}):i<32?console.warn(`Unknown GS misc address: ${i}`):i<35?r.subarray(1).forEach((n,c)=>{[()=>{console.debug(`${s}EQ: o${["ff","n"][n]}`)},()=>{},()=>{console.debug(`${s}EFX: o${["ff","n"][n]}`),t(e,mt)[d]=n,e.dispatchEvent("partefxtoggle",{part:d,active:n})}][i+c-32]()}):console.warn(`Unknown GS misc address: ${i}`)};t(this,me).add([66,18,64,16],(r,d)=>{v(r,e.chRedir(9,d,!0),d)}).add([66,18,64,17],(r,d)=>{v(r,e.chRedir(0,d,!0),d)}).add([66,18,64,18],(r,d)=>{v(r,e.chRedir(1,d,!0),d)}).add([66,18,64,19],(r,d)=>{v(r,e.chRedir(2,d,!0),d)}).add([66,18,64,20],(r,d)=>{v(r,e.chRedir(3,d,!0),d)}).add([66,18,64,21],(r,d)=>{v(r,e.chRedir(4,d,!0),d)}).add([66,18,64,22],(r,d)=>{v(r,e.chRedir(5,d,!0),d)}).add([66,18,64,23],(r,d)=>{v(r,e.chRedir(6,d,!0),d)}).add([66,18,64,24],(r,d)=>{v(r,e.chRedir(7,d,!0),d)}).add([66,18,64,25],(r,d)=>{v(r,e.chRedir(8,d,!0),d)}).add([66,18,64,26],(r,d)=>{v(r,e.chRedir(10,d,!0),d)}).add([66,18,64,27],(r,d)=>{v(r,e.chRedir(11,d,!0),d)}).add([66,18,64,28],(r,d)=>{v(r,e.chRedir(12,d,!0),d)}).add([66,18,64,29],(r,d)=>{v(r,e.chRedir(13,d,!0),d)}).add([66,18,64,30],(r,d)=>{v(r,e.chRedir(14,d,!0),d)}).add([66,18,64,31],(r,d)=>{v(r,e.chRedir(15,d,!0),d)}).add([66,18,64,64],(r,d)=>{m(r,e.chRedir(9,d,!0))}).add([66,18,64,65],(r,d)=>{m(r,e.chRedir(0,d,!0))}).add([66,18,64,66],(r,d)=>{m(r,e.chRedir(1,d,!0))}).add([66,18,64,67],(r,d)=>{m(r,e.chRedir(2,d,!0))}).add([66,18,64,68],(r,d)=>{m(r,e.chRedir(3,d,!0))}).add([66,18,64,69],(r,d)=>{m(r,e.chRedir(4,d,!0))}).add([66,18,64,70],(r,d)=>{m(r,e.chRedir(5,d,!0))}).add([66,18,64,71],(r,d)=>{m(r,e.chRedir(6,d,!0))}).add([66,18,64,72],(r,d)=>{m(r,e.chRedir(7,d,!0))}).add([66,18,64,73],(r,d)=>{m(r,e.chRedir(8,d,!0))}).add([66,18,64,74],(r,d)=>{m(r,e.chRedir(10,d,!0))}).add([66,18,64,75],(r,d)=>{m(r,e.chRedir(11,d,!0))}).add([66,18,64,76],(r,d)=>{m(r,e.chRedir(12,d,!0))}).add([66,18,64,77],(r,d)=>{m(r,e.chRedir(13,d,!0))}).add([66,18,64,78],(r,d)=>{m(r,e.chRedir(14,d,!0))}).add([66,18,64,79],(r,d)=>{m(r,e.chRedir(15,d,!0))}),t(this,De).add([54,65],(r,d)=>{let i=t(e,U).x5==="81"?"05rw":"x5d";e.switchMode(i,!0),e.setPortMode(e.getTrackPort(d),1,x[i]);let s=r[r.length-1],n=r.subarray(0,r.length-1),c=ze(n);c!==s&&(console.info(`X5D multi parameters checksum mismatch! Expected ${c}, got ${s}.`),console.debug(r));let l=(r[1]<<7)+r[0],u=(r[3]<<7)+r[2],f=e.chRedir(l&15,d,!0),E=_[f];[()=>{u<1||(u<101?(e.setChType(f,e.CH_MELODIC,x.x5d),t(e,L)[f]=u-1,t(e,k)[E+w[0]]=t(e,U).x5):u<229?(e.setChType(f,e.CH_MELODIC,x.x5d),t(e,L)[f]=u-101,t(e,k)[E+w[0]]=56):(e.setChType(f,e.CH_DRUMS,x.x5d),t(e,L)[f]=Oa[u-229]||0,t(e,k)[E+w[0]]=62)),e.pushChPrimitives(f),e.dispatchEvent("voice",{part:f})},()=>{t(e,k)[E+w[7]]=u},()=>{u<31&&(t(e,k)[E+w[10]]=Math.round((u-15)*4.2+64))},()=>{t(e,k)[E+w[93]]=At(u)},()=>{t(e,k)[E+w[91]]=At(u)},()=>{t(e,A)[f*b.rpn+3]=u>8191?u-16320:64+u,t(e,B)[b.rpnt*f+2]=1,e.dispatchEvent("pitch",{part:f,pitch:e.getPitchShift(f)})},()=>{t(e,A)[f*b.rpn+1]=u>8191?u-16320:64+u,t(e,B)[b.rpnt*f+1]=1,e.dispatchEvent("pitch",{part:f,pitch:e.getPitchShift(f)})},()=>{u>0&&(t(e,A)[f*b.rpn]=u,t(e,B)[b.rpnt*f]=1,e.dispatchEvent("pitch",{part:f,pitch:e.getPitchShift(f)}))},()=>{}][l>>4]()}).add([54,76,0],(r,d)=>{e.invokeSysExIndicator();let i=t(e,U).x5==="81"?"05rw":"x5d";e.switchMode(i),e.setPortMode(e.getTrackPort(d),1,x[i]);let s="",n=t(e,U).x5,c=0,l=0,u="MSB	PRG	LSB	NME";ke(r,function(f,E){if(E<16400){let C=E%164;switch(!0){case C<10:{f>31&&(s+=String.fromCharCode(f));break}case C===10:break;case C===11:{u+=`
${n}	${c}	${l}	${s.trim().replace("Init Voice","")}`,c++,s="";break}}c>99&&(n=90,c=0)}}),e.userBank.clearRange({msb:t(e,U).x5,prg:[0,99],lsb:0}),e.userBank.load(u),I()&&console.debug(u),e.forceVoiceRefresh()}).add([54,77,0],(r,d)=>{e.invokeSysExIndicator();let i=t(e,U).x5==="81"?"05rw":"x5d";e.switchMode(i),e.setPortMode(e.getTrackPort(d),1,x[i]);let s="",n=90,c=0,l=0,u="MSB	PRG	LSB	NME";ke(r,function(f,E){if(E<13600){let C=E%136;switch(!0){case C<10:{f>31&&(s+=String.fromCharCode(f));break}case C===11:{u+=`
${n}	${c}	${l}	${s.trim().replace("Init Combi","")}`,c++,s="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(u),I()&&console.debug(u),e.forceVoiceRefresh()}).add([54,78],(r,d)=>{let i=t(e,U).x5==="81"?"05rw":"x5d";e.switchMode(i),e.setPortMode(e.getTrackPort(d),1,x[i]),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][r[0]]} mode.`)}).add([54,85],(r,d)=>{e.invokeSysExIndicator();let i=t(e,U).x5==="81"?"05rw":"x5d";e.switchMode(i),e.setPortMode(e.getTrackPort(d),1,x[i]),ke(r,(s,n)=>{n>0&&n<3&&(e.setEffectType(n-1,44,s),e.dispatchEvent(`efx${["reverb","chorus"][n-1]}`,e.getEffectType(n-1)))})}).add([54,104],(r,d)=>{e.invokeSysExIndicator();let i=t(e,U).x5==="81"?"05rw":"x5d";e.switchMode(i,!0);let s=e.getTrackPort(d);if(t(e,J)[s]&&t(e,J)[s]!==x[i])if(t(e,Re).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${d}. Port ${String.fromCharCode(65+s)} mode "${Z[t(e,J)[s]]}" mismatch, should be "${i}".`);return}else console.info(`Track ${d} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);e.setPortMode(s,1,x[i]),ke(r,function(n,c,l,u){if(c<192){let f=e.chRedir(Math.floor(c/12),d,!0),E=_[f];switch(c%12){case 0:{n<128?(e.setChType(f,e.CH_MELODIC,x.x5d),t(e,k)[E+w[0]]=t(e,U).x5,t(e,L)[f]=n):(e.setChType(f,e.CH_DRUMS,x.x5d),t(e,k)[E+w[0]]=62,t(e,L)[f]=Oa[n-128]),n>0&&e.setChActive(f,1),e.pushChPrimitives(f),e.dispatchEvent("voice",{part:f});break}case 1:{t(e,k)[E+w[7]]=n;break}case 2:{t(e,A)[f*b.rpn+3]=n>127?n-192:64+n,t(e,B)[b.rpnt*f+2]=1,e.dispatchEvent("pitch",{part:f,pitch:e.getPitchShift(f)});break}case 3:{t(e,A)[f*b.rpn+1]=n>127?n-192:64+n,t(e,B)[b.rpnt*f+1]=1,e.dispatchEvent("pitch",{part:f,pitch:e.getPitchShift(f)});break}case 4:{n<31&&(t(e,k)[E+w[10]]=Math.round((n-15)*4.2+64));break}case 5:{let C=n>>4,T=n&15;t(e,k)[E+w[91]]=At(T),t(e,k)[E+w[93]]=At(C);break}case 10:{t(e,R)[f]||(t(e,k)[E+w[0]]=n>>6?56:t(e,U).x5,e.pushChPrimitives(f),e.dispatchEvent("voice",{part:f}));break}case 11:{let C=e.chRedir(n&15,d,!0),T=n>>4;t(e,H)[f]=n,(C!==f||T)&&console.info(`X5D Part CH${f+1} receives from CH${C+1}.`)}}}else{let f=e.chRedir(c-192,d,!0)}}),e.buildRchTree()}),t(this,me).add([22,18,127],(r,d,i)=>{e.switchMode("mt32",!0),e.setPortMode(e.getTrackPort(d),1,x.mt32),$(e,X,e.KARAOKE_NONE),e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(r,d,i)=>{e.switchMode("mt32");let s=e.chRedir(i,d,!0),n=r[1];r.subarray(2).forEach((c,l)=>{let u=l+n;t(e,Ne)[u+(s-1)*16]=c,([!1,()=>{let f=t(e,Ne)[s-1<<4];if(f<3){if(t(e,ye)[s]=1,f===2)for(let E=0;E<name.length;E++)t(e,xe)[(s-1)*b.cmt+E]=t(e,_e)[c*b.cmt+E];else{let E=e.baseBank.get(0,c+(f<<6),127,"mt32").name;for(let C=0;C<E.length;C++)t(e,xe)[(s-1)*b.cmt+C]=E.charCodeAt(C)}e.dispatchEvent("voice",{part:s})}},()=>{t(e,A)[s*b.rpn+3]=c+40,t(e,B)[b.rpnt*s+2]=1},()=>{t(e,A)[s*b.rpn+1]=c+14,t(e,B)[b.rpnt*s+1]=1},()=>{t(e,A)[s*b.rpn]=c,t(e,B)[b.rpnt*s]=1},!1,()=>{e.setChCc(s,91,c?127:0)},!1,()=>{e.setChCc(s,7,c)},()=>{e.setChCc(s,10,Math.ceil(c*9.05))}][u]||(()=>{}))()})}).add([22,18,1],(r,d,i)=>{e.switchMode("mt32");let s=i&7;console.debug(`MT-32 slot #${i+1} Drum: ${r}`);let n=r[0]<<7|r[1];r.subarray(2).forEach((c,l)=>{let u=l+n,f=(u>>2)+24,E=u&3,C=s*b.dpn;if(I()&&console.debug(`MT-32 temp drum note ${f} param ${E}: ${c}`),f<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${f}`);return}[()=>{},()=>{t(e,de)[(C+Ee[26])*b.dnc+f]=Math.round(c*1.27)},()=>{t(e,de)[(C+Ee[26])*b.dnc+f]=c*9+1&127},()=>{t(e,de)[(C+Ee[26])*b.dnc+f]=c?127:0}][E]()})}).add([22,18,2],(r,d,i)=>{e.switchMode("mt32");let s=e.chRedir(i,d,!0),n=r[1]+(r[0]<<7);n<10&&(t(e,ye)[s]=1),r.subarray(2).forEach((c,l)=>{let u=l+n;u<14&&(t(e,xe)[(s-1)*b.cmt+u]=c)}),e.dispatchEvent("voice",{part:s})}).add([22,18,3],(r,d,i)=>{e.switchMode("mt32");let s=i&7;if(r[0]){let n=(r[0]-1<<7)+r[1]-16;r.subarray(2).forEach((c,l)=>{let u=l+n,f=(u>>2)+24,E=u&3,C=s*b.dpn;if(I()&&console.debug(`MT-32 dev drum note ${f} param ${E}: ${c}`),f<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${f}`);return}[()=>{},()=>{t(e,de)[(C+Ee[26])*b.dnc+f]=Math.round(c*1.27)},()=>{t(e,de)[(C+Ee[26])*b.dnc+f]=c*9+1&127},()=>{t(e,de)[(C+Ee[26])*b.dnc+f]=c?127:0}][E]()})}else{let n=r[1];r.subarray(2).forEach((c,l)=>{let u=l+n;t(e,Ne)[u]=c;let f=e.chRedir(1+(u>>4),d,!0),E=u&15;([!1,()=>{let C=t(e,Ne)[f-1<<4];if(C<3)if(t(e,ye)[f]=1,C===2)for(let T=0;T<name.length;T++)t(e,xe)[(f-1)*b.cmt+T]=t(e,_e)[c*b.cmt+T];else{let T=e.baseBank.get(0,c+(C<<6),127,"mt32").name;for(let D=0;D<T.length;D++)t(e,xe)[(f-1)*b.cmt+D]=T.charCodeAt(D)}e.dispatchEvent("voice",{part:f})},()=>{t(e,A)[f*b.rpn+3]=c+40,t(e,B)[b.rpnt*f+2]=1},()=>{t(e,A)[f*b.rpn+1]=c+14,t(e,B)[b.rpnt*f+1]=1},()=>{t(e,A)[f*b.rpn]=c,t(e,B)[b.rpnt*f]=1},!1,()=>{e.setChCc(f,91,c?127:0)},!1,()=>{e.setChCc(f,7,c)},()=>{e.setChCc(f,10,Math.ceil(c*9.05))}][E]||(()=>{}))()})}}).add([22,18,4],(r,d,i)=>{e.switchMode("mt32");let s=r[1]+(r[0]<<7),n=[];r.subarray(2).forEach((c,l)=>{let u=l+s,f=e.chRedir(Math.floor(u/246+1),d,!0),E=u%246;E<14&&(t(e,xe)[(f-1)*b.cmt+E]=c),E<10&&(t(e,ye)[f]=1),n.indexOf(f)<0&&n.push(f)}),n.forEach(c=>{e.dispatchEvent("voice",{part:c})})}).add([22,18,5],(r,d,i)=>{e.switchMode("mt32");let s=(r[0]<<7)+r[1];r.subarray(2).forEach((n,c)=>{let l=s+c,u=Math.floor(l/8),f=l&7,E=u*8;t(e,Ct)[l]=n,([!1,()=>{let C=t(e,Ct)[E];if(C<3){let T="";if(C===2){let M=b.cmt*u;T=`MT-m:${n.toString().padStart(3,"0")}`}else T=e.baseBank.get(0,n+(C<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:u});let D=`MSB	LSB	PRG	NME
49	127	${u}	${T}`;e.userBank.load(D,!0)}}][f]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(r,d,i)=>{e.switchMode("mt32");let s=((r[0]&1)<<7)+r[1],n=r[0]>>1,c=!1;if(r.subarray(2).forEach((l,u)=>{let f=s+u;f<b.cmt&&(t(e,_e)[n*b.cmt+f]=l,c=!0)}),c){e.userBank.clearRange({msb:0,lsb:127,prg:n});let l=`MSB	LSB	PRG	NME
49	127	${n}	MT-m:${n}`;e.userBank.load(l,!0)}e.forceVoiceRefresh()}).add([22,18,16],(r,d,i)=>{e.switchMode("mt32");let s=r[1],n=!1,c=function(l,u){t(e,H)[u-12]=l,n=!0};r.subarray(2).forEach((l,u)=>{let f=u+s;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,c,c,c,c,c,c,c,c,c,()=>{$(e,F,l),e.dispatchEvent("mastervolume",t(e,F))}][f]||(()=>{}))(l,u)}),n&&e.buildRchTree()}).add([22,18,32],(r,d,i)=>{e.switchMode("mt32");let s=r[1],n=" ".repeat(s);r.subarray(2).forEach(c=>{c>31?n+=String.fromCharCode(c):n+=" "}),$(e,He,n.padStart(20," ")),$(e,Ge,Date.now()+3200)}).add([22,18,82],(r,d)=>{let i=e.chRedir(0,d,!0);for(let s=0;s<16;s++)t(e,ee).ano(i+s),s&&s<10&&(t(e,L)[i+s]=jt[s-1]);console.info("MT-32 alt reset complete.")}),t(this,De).add([66,0],(r,d)=>{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(d),2,x.ns5r),$(e,X,e.KARAOKE_NONE),console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][r[0]]} mode.`)}).add([66,1],(r,d)=>{let i=["ns5r","05rw"][r[0]];e.switchMode(i,!0),e.setPortMode(e.getTrackPort(d),2,x[i]),$(e,X,e.KARAOKE_NONE)}).add([66,18,0,0],(r,d)=>{let i=r[0];switch(i){case 124:case 126:case 127:{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(d),2,x.ns5r),$(e,X,e.KARAOKE_NONE);break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset on drum kit ${r[1]}.`);break}default:if(i<10){let s=[0,0,0,0],n=(c,l)=>{s[l]=c};if(r.subarray(1).forEach((c,l)=>{[n,n,n,n,()=>{$(e,F,c*129/16383*100),e.dispatchEvent("mastervolume",t(e,F))},()=>c-64,()=>c-64,()=>{},()=>{},()=>{}][i+l]()}),r[0]<4){let c=0;s.forEach(l=>{c=c<<4,c+=l}),c-=1024,console.debug(`Master tune: ${c}`)}}}}).add([66,18,0,1],(r,d)=>{}).add([66,18,0,2],(r,d)=>{}).add([66,18,1],(r,d)=>{e.invokeSysExIndicator();let i=e.chRedir(r[0],d,!0),s=_[i],n=r[1],c=`NS5R CH${i+1} `;r.subarray(2).forEach((l,u)=>{let f=n+u;f<3?([()=>{t(e,k)[s+w[0]]=l||Se.bank0,e.pushChPrimitives(i)},()=>{t(e,k)[s+w[32]]=l,e.pushChPrimitives(i)},()=>{t(e,L)[i]=l}][f](),e.dispatchEvent("voice",{part:i})):f<8||(f<14?[()=>{let E=e.chRedir(l,d,!0),C=t(e,H)[i];t(e,H)[i]=E,(i!==E||E!==C)&&(e.buildRchTree(),console.info(`${c}receives from CH${E+1}`))},()=>{t(e,ie)[i]=+!l},()=>{e.setChType(i,l,x.ns5r),console.debug(`${c}type: ${Rt[l]}`)},()=>{t(e,A)[b.rpn*i+3]=l,t(e,B)[b.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{},()=>{}][f-8]():f<16||(f<33?[()=>{t(e,k)[s+w[7]]=l},()=>{t(e,k)[s+w[11]]=l},()=>{},()=>{},()=>{t(e,k)[s+w[10]]=l||128},()=>{},()=>{},()=>{t(e,k)[s+w[93]]=l},()=>{t(e,k)[s+w[91]]=l},()=>{t(e,k)[s+w[76]]=l},()=>{t(e,k)[s+w[77]]=l},()=>{t(e,k)[s+w[78]]=l},()=>{t(e,k)[s+w[74]]=l},()=>{t(e,k)[s+w[71]]=l},()=>{t(e,k)[s+w[73]]=l},()=>{t(e,k)[s+w[75]]=l},()=>{t(e,k)[s+w[72]]=l}][f-16]():f<112||f<114&&[()=>{t(e,k)[s+w[5]]=l},()=>{t(e,k)[s+w[65]]=l}][f-112]()))})}).add([66,18,8,0],(r,d)=>{let i=r[0];if(i<32)e.setLetterDisplay(r.subarray(1,33),"NS5R letter display");else{let s=i-32;$(e,we,Date.now()+3200),$(e,se,10),t(e,be,Ie).fill(0);let n=r.subarray(1),c=4;n.forEach(function(l,u){let f=u+s,E=f>>4,C=f&15;if(f<80){let T=E<c?l:l>>3,D=0,M=E<c?6:3;for(;T>0;)t(e,be,Ie)[C*32+E*7+(M-D)]=T&1,T=T>>1,D++}})}}).add([66,18,48],(r,d,i)=>{p(0,r)}).add([66,18,49],(r,d,i)=>{p(1,r)}).add([66,18,50],(r,d,i)=>{p(2,r)}).add([66,18,51],(r,d,i)=>{p(3,r)}).add([66,18,52],(r,d,i)=>{p(4,r)}).add([66,18,53],(r,d,i)=>{p(5,r)}).add([66,18,54],(r,d,i)=>{p(6,r)}).add([66,18,55],(r,d,i)=>{p(7,r)}).add([66,52],(r,d)=>{e.switchMode("ns5r"),$(e,X,e.KARAOKE_NONE);let i="";ke(r,(s,n)=>{n<8?(s>31&&(i+=String.fromCharCode(s)),n===7&&(e.aiEfxName=i)):n<10&&(e.setEffectType(n-8,44,s),e.dispatchEvent(`efx${["reverb","chorus"][n-8]}`,e.getEffectType(n-8)))})}).add([66,53],(r,d)=>{e.invokeSysExIndicator(),e.switchMode("ns5r"),$(e,X,e.KARAOKE_NONE);let i="",s=r[r.length-1],n=r.subarray(0,r.length-1),c=ze(n);c!==s&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${c}, got ${s}.`),console.debug(r));let l=e.getTrackPort(d);if(t(e,J)[l]&&t(e,J)[l]!==x.ns5r)if(t(e,Re).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${d}. Port ${String.fromCharCode(65+l)} mode "${Z[t(e,J)[l]]}" mismatch, should be "ns5r".`);return}else console.info(`Track ${d} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+l)}.`);e.setPortMode(l,2,x.ns5r),ke(n,function(u,f){switch(!0){case f<2944:{let E=e.chRedir(Math.floor(f/92),d,!0),C=_[E];switch(f%92){case 0:{t(e,k)[C+w[0]]=u,e.pushChPrimitives(E),e.dispatchEvent("voice",{part:E});break}case 1:{t(e,k)[C+w[32]]=u,!u&&!t(e,k)[C+w[0]]&&(t(e,k)[C+w[0]]=Se.bank0),e.pushChPrimitives(E),e.dispatchEvent("voice",{part:E});break}case 2:{t(e,L)[E]=u,u>0&&e.setChActive(E,1),e.dispatchEvent("voice",{part:E});break}case 3:{let T=e.chRedir(u,d,!0);t(e,H)[E]=T,E!==T&&console.info(`NS5R CH${E+1} receives from CH${T+1}.`);break}case 7:{t(e,R)[E]=u,e.dispatchEvent("voice",{part:E});break}case 8:{t(e,A)[E*b.rpn+3]=u<40||u>88?u+(u>63?-192:64):u,t(e,B)[b.rpnt*E+2]=1,e.dispatchEvent("pitch",{part:E,pitch:e.getPitchShift(E)});break}case 9:case 10:{t(e,k)[C+w[7]]=u;break}case 11:{t(e,k)[C+w[11]]=u;break}case 14:{t(e,k)[C+w[10]]=u||128;break}case 19:{t(e,k)[C+w[93]]=u;break}case 20:{t(e,k)[C+w[91]]=u;break}case 84:{t(e,k)[C+w[65]]=u;break}case 85:{t(e,k)[C+w[5]]=u;break}}break}case f<3096:break;case f<3134:{let E=f-3096;E<8?(u>31&&(i+=String.fromCharCode(u)),E===7&&(e.aiEfxName=i)):E<10&&(e.setEffectType(E-8,44,u),e.dispatchEvent(`efx${["reverb","chorus"][E-8]}`,e.getEffectType(E-8)));break}case f<8566:break}}),e.buildRchTree()}).add([66,54],(r,d)=>{e.invokeSysExIndicator(),e.switchMode("ns5r");let i="",s=80,n=0,c=0,l="MSB	PRG	LSB	NME";ke(r,function(u,f){let E=f%158;switch(!0){case E<10:{u>31&&(i+=String.fromCharCode(u));break}case E===10:break;case E===11:{s=u&127;break}case E===12:{c=u&127;break}case E===13:{l+=`
${s}	${n}	${c}	${i.trim().replace("Init Voice","")}`,n++,i="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(l),I()&&console.debug(l),e.forceVoiceRefresh()}).add([66,55],(r,d)=>{e.invokeSysExIndicator(),e.switchMode("ns5r");let i="",s=88,n=0,c=0,l="MSB	PRG	LSB	NME";ke(r,function(u,f){let E=f%126;switch(!0){case E<10:{u>31&&(i+=String.fromCharCode(u));break}case E===11:break;case E===12:break;case E===13:{l+=`
${s}	${n}	${c}	${i.trim().replace("Init Combi","")}`,n++,i="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(l),I()&&console.debug(l),e.forceVoiceRefresh()}).add([66,125],(r,d,i)=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][r[0]]||"white")}).add([66,127],(r,d,i)=>{let s=r[r.length-1],n=r.subarray(0,r.length-1),c=ze(n);c!==s&&(console.info(`NS5R screen dump checksum mismatch! Expected ${c}, got ${s}.`),console.debug(r));let l=new Uint8Array(5760);ke(r,(u,f,E)=>{if(f<720)for(let C=0;C<8;C++)l[f*8+C]=u>>7-C&1}),e.dispatchEvent("screen",{type:"ns5r",data:l})}).add([76],(r,d,i)=>{t(e,De).run([66,...r],d,i)}),t(this,ct).add([16,0,8,0],(r,d,i)=>{let s=(r[2]<<4)+r[3],n="K11 ";([()=>{e.switchMode("k11",!0),e.setPortMode(e.getTrackPort(d),2,x.k11),$(e,X,e.KARAOKE_NONE),t(e,Q)[x.k11][1]=s?4:0,console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,s),console.debug(`${n}reverb type: ${s}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{console.debug(`${n}reverb time: ${s}`)},()=>{console.debug(`${n}reverb time: ${s}`)},()=>{console.debug(`${n}reverb predelay: ${s}`)},()=>{console.debug(`${n}reverb predelay: ${s}`)},()=>{console.debug(`${n}depth high: ${s}`)},()=>{console.debug(`${n}depth high: ${s}`)},()=>{console.debug(`${n}depth low: ${s}`)},()=>{console.debug(`${n}depth low: ${s}`)}][r[0]]||(()=>{}))()}).add([16,0,8,1],(r,d,i)=>{e.invokeSysExIndicator();let s=e.chRedir(r[1],d,!0),n=_[s],c=Et[s],l=(r[3]<<4)+r[4],u=`GMega CH${s+1} `;([()=>{l<128?(e.setChType(s,e.CH_MELODIC,x.k11),t(e,k)[n+w[0]]=0,t(e,L)[s]=l):(e.setChType(s,e.CH_DRUMS,x.k11),t(e,L)[s]=l-128),e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{let f=e.chRedir(l,d,!0),E=t(e,H)[s];t(e,H)[s]=f,(s!==f||f!==E)&&(e.buildRchTree(),console.info(`${u}receives from CH${f+1}`))},()=>{t(e,k)[n+w[7]]=l},()=>{uupThis.setChActive(s,l)},()=>{t(e,k)[n+w[10]]=l},()=>{t(e,A)[c+3]=l+40,t(e,B)[b.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{t(e,A)[c+1]=l>>1,t(e,A)[c+2]=l&1,t(e,B)[b.rpnt*s+1]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{t(e,k)[n+w[91]]=l?127:0},()=>{},()=>{t(e,k)[n+w[74]]=l},()=>{t(e,k)[n+w[73]]=l},()=>{t(e,k)[n+w[72]]=l}][r[0]]||(()=>{}))()}).add([16,0,9,0],(r,d,i)=>{e.invokeSysExIndicator();let s=(r[2]<<4)+r[3],n="GMLX ";([()=>{console.debug(`${n}reverb type: ${s}`)},()=>{console.debug(`${n}reverb time: ${s}`)},()=>{console.debug(`${n}reverb predelay: ${s}`)},()=>{console.debug(`${n}depth high: ${s}`)},()=>{console.debug(`${n}depth low: ${s}`)}][r[0]]||(()=>{}))()}).add([16,0,9,3],(r,d,i)=>{e.invokeSysExIndicator();let s=(r[2]<<4)+r[3],n=e.chRedir(r[1],d,!0),c=_[n],l=`GMLX CH${n+1} `;[()=>{s<128?(e.setChType(n,e.CH_MELODIC,x.k11),t(e,k)[c+w[0]]=0,t(e,k)[c+w[32]]=0,t(e,L)[n]=s):s<160?(e.setChType(n,e.CH_MELODIC,x.k11),t(e,k)[c+w[0]]=0,t(e,k)[c+w[32]]=7,t(e,L)[n]=s-100):(e.setChType(n,e.CH_DRUMS,x.k11),t(e,k)[c+w[0]]=122,t(e,k)[c+w[32]]=0,t(e,L)[n]=s-160),e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n})},()=>{let u=e.chRedir(s,d,!0),f=t(e,H)[n];t(e,H)[n]=u,(n!==u||u!==f)&&(e.buildRchTree(),console.info(`${l}receives from CH${u+1}`))}][r[0]]()}).add([16,0,9,4],(r,d,i)=>{e.invokeSysExIndicator();let s=(r[2]<<4)+r[3],n=e.chRedir(r[1],d,!0),c=_[n],l=Et[n];[()=>{e.setChActive(n,s)},()=>{t(e,k)[c+w[7]]=s},()=>{t(e,k)[c+w[10]]=s},()=>{t(e,k)[c+w[91]]=s?127:0},()=>{t(e,A)[l+3]=s+40,t(e,B)[b.rpnt*n+2]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{t(e,A)[l+1]=s,t(e,B)[b.rpnt*n+1]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{t(e,A)[l]=s,t(e,B)[b.rpnt*n]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{}][r[0]]()}),t(this,ot).add([66,93,64],(r,d,i)=>{let s=r[2];switch(r[0]){case 0:{switch(r[1]){case 4:{e.invokeSysExIndicator(),$(e,F,s*129/16383*100),e.dispatchEvent("mastervolume",t(e,F));break}case 5:{e.invokeSysExIndicator(),s-64;break}case 6:{e.invokeSysExIndicator(),console.debug(`SG global reverb: ${s?"on":"off"}`);break}case 127:{e.switchMode("sg",!0),e.setPortMode(e.getTrackPort(d),1,x.sg);break}}break}case 1:{switch(r[1]){case 48:{e.invokeSysExIndicator(),console.debug(`SG reverb type: ${Zt[s]}`);break}}break}default:if(r[0]>>4===1){e.invokeSysExIndicator();let n=e.chRedir(r[0]&15,d,!0);if(r[1]===2){let c=e.chRedir(s,d,!0),l=t(e,H)[n];t(e,H)[n]=c,(n!==c||c!==l)&&(e.buildRchTree(),console.info(`SG CH${n+1} receives from CH${c+1}`))}else r[1]===19&&e.setChCc(n,7,s)}else console.warn(`Unknown AKAI SG SysEx: ${r}`)}}),t(this,lt).add([9],(r,d,i)=>{e.invokeSysExIndicator(),console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremolo","phaser","rotary speaker","enhancer","flanger","EQ"][r[0]]||"off"}`)}),t(this,te).add([127,0],(r,d,i)=>{e.switchMode("motif");let s=new Uint8Array([127,1,...r]);t(e,te).run(s,d,i)}).add([127,1,0,0],(r,d,i)=>{e.switchMode("s90es");let s="S90/Motif ES system ",n=r[0];r.subarray(1).forEach((c,l)=>{([()=>{$(e,F,c*12900/16383),e.dispatchEvent("mastervolume",t(e,F))}][n+l]||(()=>{console.info(`Unrecognized ${s}ID: ${n+l}`)}))()})}).add([127,1,14],(r,d,i)=>{e.switchMode("s90es");let s="S90/Motif ES bulk header ",n=[];n[95]=(c,l,u)=>{console.debug(`${s}multi edit buffer: ${c[1]}`)},(n[r[0]]||(()=>{console.info(`Unrecognized ${s}ID: ${r[0]}.`)}))(r.subarray(1))}).add([127,1,15],(r,d,i)=>{e.switchMode("s90es");let s="S90/Motif ES bulk footer ",n=[];n[95]=(c,l,u)=>{console.debug(`${s}multi edit buffer: ${c[1]}`)},(n[r[0]]||(()=>{console.info(`Unrecognized ${s}ID: ${r[0]}.`)}))(r.subarray(1))}).add([127,1,54,1],(r,d,i)=>{e.switchMode("s90es");let s="S90/Motif ES reverb ",n=r[0];r.subarray(1).forEach((c,l)=>{([()=>{e.setEffectTypeRaw(0,!1,c&15|128)},()=>{e.setEffectTypeRaw(0,!0,c)}][n+l]||(()=>{}))()}),e.dispatchEvent("efxreverb",e.getEffectType(0))}).add([127,1,54,2],(r,d,i)=>{e.switchMode("s90es");let s="S90/Motif ES chorus ",n=r[0];r.subarray(1).forEach((c,l)=>{([()=>{e.setEffectTypeRaw(1,!1,c&15|128)},()=>{e.setEffectTypeRaw(1,!0,c)}][n+l]||(()=>{}))()}),e.dispatchEvent("efxchorus",e.getEffectType(1))}).add([127,1,54,3],(r,d,i)=>{e.switchMode("s90es");let s="S90/Motif ES insert 1 ",n=r[0];r.subarray(1).forEach((c,l)=>{([()=>{e.setEffectTypeRaw(3,!1,c&15|128)},()=>{e.setEffectTypeRaw(3,!0,c)}][n+l]||(()=>{}))()}),e.dispatchEvent("efxinsert0",e.getEffectType(3))}).add([127,1,54,4],(r,d,i)=>{e.switchMode("s90es");let s="S90/Motif ES insert 2 ",n=r[0];r.subarray(1).forEach((c,l)=>{([()=>{e.setEffectTypeRaw(4,!1,c&15|128)},()=>{e.setEffectTypeRaw(4,!0,c)}][n+l]||(()=>{}))()}),e.dispatchEvent("efxinsert1",e.getEffectType(4))}).add([127,1,54,16],(r,d,i)=>{e.switchMode("s90es");let s=r[0];r.subarray(1).forEach((n,c)=>{let u=`S90/Motif ES EQ${(c>>2)+1} `;([()=>{let f=n-64},()=>{let f=bt[n]},()=>{let f=n/10},()=>{let f=n}][s+c&3]||(()=>{}))()})}).add([127,1,54,17],(r,d,i)=>{e.switchMode("s90es");let s="S90/Motif ES variation ",n=r[0];r.subarray(1).forEach((c,l)=>{([()=>{e.setEffectTypeRaw(2,!1,c&15|128)},()=>{e.setEffectTypeRaw(2,!0,c)}][n+l]||(()=>{}))()}),e.dispatchEvent("efxdelay",e.getEffectType(2))}).add([127,1,55],(r,d,i)=>{e.invokeSysExIndicator(),e.switchMode("s90es");let s=e.getTrackPort(d);if(t(e,J)[s]&&t(e,J)[s]!==t(e,U).smotif)if(t(e,Re).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled for track ${d}. Port ${String.fromCharCode(65+s)} mode "${Z[t(e,J)[s]]}" mismatch, should be "${Z[t(e,U).smotif]}".`);return}else console.info(`Track ${d} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);let n=e.chRedir(r[0],d,!0),c=_[n],l=r[1];r[0]>15&&(n=r[0]+32);let u=`Track ${d} S90/Motif ES bulk CH${n<128?n+1:"U"+(n-127)} `;console.debug(u,r),!(r[0]>15)&&r.subarray(2).forEach((f,E)=>{([()=>{t(e,k)[c+w[0]]=f,e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n})},()=>{f&&e.setChActive(n,1),t(e,k)[c+w[32]]=f,e.getChPrimitive(n,1)===63&&e.setChType(n,[32,40].indexOf(f)>-1?e.CH_DRUMS:e.CH_MELODIC,t(e,G),!0),e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n})},()=>{f&&e.setChActive(n,1),t(e,L)[n]=f,e.dispatchEvent("voice",{part:n})},()=>{let C=e.chRedir(f,d,!0),T=t(e,H)[n];t(e,H)[n]=C,(n!==C||C!==T)&&(e.buildRchTree(),console.info(`${u}receives from CH${C+1}`))},()=>{t(e,ie)[n]=f?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{f!==100&&e.setChActive(n,1),t(e,k)[c+w[7]]=f},()=>{f!==64&&e.setChActive(n,1),t(e,k)[c+w[10]]=f},!1,!1,!1,()=>{t(e,k)[c+w[91]]=f},()=>{f&&e.setChActive(n,1),t(e,k)[c+w[93]]=f},()=>{f&&e.setChActive(n,1),t(e,k)[c+w[94]]=f},()=>{e.setChCc(n,128,f),f!==127&&(e.setChActive(n,1),e.allocateAce(n,128))},()=>{},()=>{f!==64&&e.setChActive(n,1),t(e,k)[c+w[74]]=f},()=>{f!==64&&e.setChActive(n,1),t(e,k)[c+w[71]]=f},!1,()=>{t(e,k)[c+w[65]]=f},()=>{t(e,k)[c+w[5]]=f},()=>{}][l+E]||(()=>{}))()})}),t(e,te).add([100,14],(r,d,i)=>{var n;e.switchMode("cs6x"),e.setPortMode(e.getTrackPort(d),1,x.cs6x);let s=(n=["normal voice","plugin voice PLG","drums",,"performance",,"phrase clip"][r[0]>>4])!=null?n:"invalid";r[0]&!0?s+=" edit buffer":r[0]>>4==1?s+=`${(r[0]&1)+1}`:s+=` ${["INT","EXT"][r[0]&1]}`,console.debug(`CS6x bulk dump for ${s} started.`)}).add([100,15],(r,d,i)=>{var n;e.switchMode("cs6x");let s=(n=["normal voice","plugin voice PLG","drums",,"performance",,"phrase clip"][r[0]>>4])!=null?n:"invalid";r[0]&!0?s+=" edit buffer":r[0]>>4==1?s+=`${(r[0]&1)+1}`:s+=` ${["INT","EXT"][r[0]&1]}`,console.debug(`CS6x bulk dump for ${s} ended.`)}).add([100,76,112],(r,d,i)=>{e.switchMode("cs6x");let s=0,n=r[0];r.subarray(1).forEach((c,l)=>{let u=l+n;u<10?(e.setChCvnRegister(s,l,c&127),t(e,ye)[s]=1):u<12||u<13&&console.debug(`Plugin voice type: ${c}`)}),e.dispatchEvent("voice",{part:s})}).add([100,76,0],(r,d,i)=>{e.switchMode("cs6x"),e.setPortMode(e.getTrackPort(d),1,x.cs6x);let s=0,n=r[0];r.subarray(1).forEach((c,l)=>{let u=l+n;([()=>{e.setChCc(s,7,c),c!==100&&e.setChActive(s,1)},,,()=>{t(e,ie)[s]=c==0,e.setChCc(s,64,0),t(e,ee).ano(s),e.resetChAceAll(s)},,()=>{},,,()=>{e.setChCc(s,65,c?127:0)},()=>{e.setChCc(s,5,c)},,()=>{e.setChCc(s,91,c),c!==40&&e.setChActive(s,1)},()=>{e.setChCc(s,93,c),c&&e.setChActive(s,1)}][u]||(()=>{}))()})}).add([100,76,1],(r,d,i)=>{e.switchMode("cs6x");let s=0,n=r[0],c=!1;r.subarray(1).forEach((l,u)=>{let f=u+n;([()=>{e.setEffectTypeRaw(0,!1,l&15|128),c=!0},()=>{e.setEffectTypeRaw(0,!0,l),c=!0}][f]||(()=>{}))()}),c&&e.dispatchEvent("efxreverb",e.getEffectType(0))}).add([100,76,2],(r,d,i)=>{e.switchMode("cs6x");let s=0,n=r[0],c=!1;r.subarray(1).forEach((l,u)=>{let f=u+n;([()=>{e.setEffectTypeRaw(1,!1,l&15|128),c=!0},()=>{e.setEffectTypeRaw(1,!0,l),c=!0}][f]||(()=>{}))()}),c&&e.dispatchEvent("efxchorus",e.getEffectType(1))}).add([100,76,3],(r,d,i)=>{e.switchMode("cs6x");let s=0,n=r[0],c=!1;r.subarray(1).forEach((l,u)=>{let f=u+n;([()=>{e.setEffectTypeRaw(2,!1,l&15|128),c=!0},()=>{e.setEffectTypeRaw(2,!0,l),c=!0}][f]||(()=>{}))()}),c&&e.dispatchEvent("efxdelay",e.getEffectType(2))}).add([100,76,5],(r,d,i)=>{e.switchMode("cs6x")}).add([100,76,16],(r,d,i)=>{var l;e.switchMode("cs6x");let s=0,n=r[0],c=!1;if(r.subarray(1).forEach((u,f)=>{let E=f+n;([()=>{e.setChCc(s,0,u),c=!0},()=>{e.setChCc(s,32,u),c=!0,u&&e.setChActive(s,1)},()=>{t(e,L)[s]=u,c=!0,u&&e.setChActive(s,1)},()=>{t(e,B)[Et[s]+Ht[2]]=1,t(e,A)[Et[s]+Ht[2]]=u,u&&e.setChActive(s,1)}][E]||(()=>{}))()}),c){switch(e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s}),e.getChVoice(s).standard){case"DX":{t(e,ne)[s]=e.EXT_DX;break}case"VL":{t(e,ne)[s]=e.EXT_VL;break}}e.dispatchEvent("metacommit",{type:"OSysMeta",data:`CH${s+1} was renamed from "${(l=e.getVoice(...e.getChPrimitives(s,!0),e.getChMode(s)))==null?void 0:l.name}" to "${e.getChCvnString(s)}".`})}}).add([100,76,32],(r,d,i)=>{e.switchMode("cs6x");let s=0,n=r[0],c=t(e,ne)[s];switch(c){case e.EXT_DX:{r.length>2&&console.debug(r),r.subarray(1).forEach((l,u)=>{let f=u+n;if(f<6){let E=f+142;e.setChCc(s,E,l),l!==64&&e.allocateAce(s,E)}else if(f<12){let E=f+144;e.setChCc(s,E,l),l!==64&&e.allocateAce(s,E)}else([()=>{},()=>{},()=>{},()=>{}][f]||(()=>{}))()});break}case e.EXT_VL:{console.info(`Support for Modular System Plug-in writes is not yet present for plugin type ${c}.`);break}default:console.warn(`Unsupported plug-in type: ${c}`)}}),t(this,me).add([0,72,18,0,0,0,0],(r,d,i)=>{e.switchMode("sd",!0),e.setPortMode(e.getTrackPort(d),2,x.sd),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(r,d,i)=>{e.invokeSysExIndicator();let s=r[0]>>5,n=r[0]&31;switch(s){case 0:{let c=r[0]>>1,l=r[1];switch(c){case 1:{r.subarray(2).forEach((u,f,E)=>{let C=f+l;switch(C){case 0:{u&&(e.setEffectType(1,60,u-1),e.dispatchEvent("efxchorus",e.getEffectType(1)),console.debug(`SD MFX Cho: ${C} - ${u}`));break}}});break}case 2:{r.subarray(2).forEach((u,f)=>{let E=f+l;switch(E){case 0:{u&&(e.setEffectType(0,55+u,0),e.dispatchEvent("efxreverb",e.getEffectType(0)),console.debug(`SD MFX Rev: ${E} - ${u}`));break}}});break}case 3:case 4:case 5:{let u=c-1;r.subarray(2).forEach((f,E)=>{let C=E+l;switch(console.debug(`SD MFX ${u-2}: ${C} - ${f}`),C){case 0:{e.setEffectTypeRaw(u,62,f),e.dispatchEvent(`efx${u>2?"delay":"insert"+(u-4)}`,e.getEffectType(u));break}}}),console.debug(`SD MFX message:
%o`,r);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,r)}break}case 1:{let c=e.chRedir(n,d,!0),l=r[1],u=_[c];r.subarray(2).forEach((f,E)=>{let C=l+E;C<37?([()=>{},()=>{},0,()=>{},()=>{switch(f){case 104:case 105:case 106:case 107:case 120:{t(e,R)[c]||e.setChType(c,e.CH_DRUMS);break}default:t(e,R)[c]&&e.setChType(c,e.CH_MELODIC)}e.setChCc(c,0,f),e.pushChPrimitives(c),e.dispatchEvent("voice",{part:c})},()=>{t(e,k)[u+w[32]]=f,e.pushChPrimitives(c),e.dispatchEvent("voice",{part:c})},()=>{t(e,L)[c]=f,e.dispatchEvent("voice",{part:c})},()=>{t(e,k)[u+w[7]]=f},()=>{t(e,k)[u+w[10]]=f},()=>{},()=>{},()=>{f<2&&(t(e,ie)[c]=f)},()=>{f<2&&(t(e,k)[u+w[68]]=f?127:0)},()=>{},()=>{f<2&&(t(e,k)[u+w[65]]=f?127:0)},()=>{t(e,k)[u+w[5]]=f&15<<4|t(e,k)[u+w[5]]&15},()=>{t(e,k)[u+w[5]]=f&15|(t(e,k)[u+w[5]]&240)>>4},()=>{t(e,k)[u+w[74]]=f},()=>{t(e,k)[u+w[71]]=f},()=>{t(e,k)[u+w[73]]=f},()=>{t(e,k)[u+w[72]]=f},0,0,0,0,0,0,0,()=>{t(e,k)[u+w[128]]=f,e.allocateAce(128)},()=>{t(e,k)[u+w[93]]=f},()=>{t(e,k)[u+w[91]]=f},0,0,()=>{t(e,k)[u+w[75]]=f},()=>{t(e,k)[u+w[76]]=f},()=>{t(e,k)[u+w[77]]=f},()=>{t(e,k)[u+w[78]]=f}][C]||(()=>{}))():C<63||(C<64?(t(e,R)[c]?(t(e,k)[u+w[0]]=104|f,e.pushChPrimitives(c),e.dispatchEvent("voice",{part:c})):(t(e,k)[u+w[0]]=96|f,e.pushChPrimitives(c),e.dispatchEvent("voice",{part:c})),e.dispatchEvent("voice",{part:c})):console.debug(`Unknown SD-90 global CH${c+1} param setup message:
%o`,r))});break}case 2:{let c=e.chRedir(n,d,!0),l=r[1];console.debug(`Unknown SD-90 global CH${c+1} MIDI setup message:
%o`,r.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,r)}}),t(e,De).add([0,1,73,78],(r,d,i)=>{e.switchMode("krs"),e.setPortMode(e.getTrackPort(d),1,x.krs),console.debug("Might be KORG KROSS 2 mode reset... Not sure.")}).add([0,1,73,117,2,37],(r,d,i)=>{e.switchMode("krs");let s=e.getTrackPort(d);if(t(e,J)[s]&&t(e,J)[s]!==x.krs)if(t(e,Re).dumpLimit===e.DUMP_MODE){console.warn(`Dump cancelled. Port ${String.fromCharCode(65+s)} mode "${Z[t(e,J)[s]]}" mismatch, should be "krs".`);return}else console.info(`Track ${d} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);e.setPortMode(e.getTrackPort(d),1,x.krs);let n="KROSS 2 BMT1 ",c="";ke(r,(l,u)=>{if(u<24)c+=String.fromCharCode(Math.max(32,l));else if(!(u<1276)){let f=u-1276,E=e.chRedir(Math.floor(f/44),d,!0),C=f%44,T=_[E];C<15?([()=>{l&&e.setChActive(E,1),t(e,L)[E]=l,e.dispatchEvent("voice",{part:E})},()=>{l&&e.setChActive(E,1),l<10?(t(e,k)[T+w[0]]=63,t(e,k)[T+w[32]]=l):l<20?(t(e,k)[T+w[0]]=121,t(e,k)[T+w[32]]=l-10):l<24&&(t(e,k)[T+w[0]]=[120,0,56,62][l-20],t(e,k)[T+w[32]]=0),e.pushChPrimitives(E),e.dispatchEvent("voice",{part:E})},()=>{let D=e.chRedir(l&15,d,!0);t(e,H)[E]=D,console.info(`${n}CH${E+1} receives from CH${D+1}`)},!1,!1,()=>{t(e,k)[T+w[7]]=l},!1,()=>{},()=>{},!1,!1,!1,!1,!1,()=>{t(e,k)[T+w[10]]=l||128}][C]||(()=>{}))():C<36||([()=>{t(e,k)[T+w[74]]=(l+128&255)-64},()=>{t(e,k)[T+w[71]]=(l+128&255)-64},!1,!1,()=>{t(e,k)[T+w[73]]=(l+128&255)-64},()=>{t(e,k)[T+w[75]]=(l+128&255)-64},!1,()=>{t(e,k)[T+w[72]]=(l+128&255)-64}][C]||(()=>{}))()}}),c=c.trimRight(),e.dispatchEvent("metacommit",{type:"EORTitle",data:c})}),t(e,te).add([92,0,0],(r,d,i)=>{let s=r[0];r.subarray(1).forEach((n,c)=>{let l=c+s;l<2||([!1,!1,!1,!1,!1,!1,()=>{e.setChMode(n,x.an1x),e.pushChPrimitives(n),console.debug(`Yamaha AN1x slot 1 receives from CH${n+1}`)},()=>{e.setChMode(n,x.an1x),e.pushChPrimitives(n),console.debug(`Yamaha AN1x slot 2 receives from CH${n+1}.`)}][l-2]||(()=>{}))()})}),t(e,te).add([75,80,0],(r,d,i)=>{let s=r[0];r.subarray(1).forEach((n,c)=>{let l=c+s;([()=>{e.modelEx.cs1x.perfCh=n,e.pushChPrimitives(n),console.debug(`Yamaha CS1x performance on CH${n+1}.`)},!1,!1,!1,()=>{},!1,()=>{switch(n){case 1:{e.switchMode("xg",!0),e.setPortMode(e.getTrackPort(d),1,x.xg),console.debug("Yamaha CS1x set to XG mode.");break}case 3:{e.switchMode("cs1x",!0),e.setPortMode(e.getTrackPort(d),1,x.cs1x),console.debug("Yamaha CS1x set to performance mode.");break}default:console.warn(`Unknown Yamaha CS1x mode: ${n}`)}},()=>{}][l]||(()=>{}))()})}).add([75,96,0],(r,d,i)=>{let s=r[0],n=!1,c=e.modelEx.cs1x.perfCh;r.subarray(1).forEach((l,u)=>{let f=u+s;f<8?(n=!0,t(e,ye)[c]=1,e.setChCvnRegister(c,f,l)):f<48?([!1,()=>{e.setChCc(c,7,l)}][f]||(()=>{}))():f<80?([()=>{e.setEffectTypeRaw(0,!1,l)},()=>{e.setEffectTypeRaw(0,!0,l),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{e.setEffectTypeRaw(1,!1,l)},()=>{e.setEffectTypeRaw(1,!0,l),e.dispatchEvent("efxchorus",e.getEffectType(1))},()=>{e.setEffectTypeRaw(2,!1,l)},()=>{e.setEffectTypeRaw(2,!0,l),e.dispatchEvent("efxdelay",e.getEffectType(2))}][f-48]||(()=>{}))():I()&&console.debug(`Unknown CS1x effect register: ${f}.`)}),n&&(e.setChActive(c,1),e.pushChPrimitives(c))})}chRedir(e,a,h){let o=this;if(t(o,Xe)[a])return(t(o,Xe)[a]-1)*16+e;if(t(o,G)===x.sc||t(o,G)===x.sd){if(h===1)return e;let p=0,y=!0;for(;y;)t(o,Be)[e+p]===0?(t(o,Be)[e+p]=a,console.debug(`Assign track ${a} to channel ${e+p+1}.`),y=!1):t(this,Be)[e+p]===a?y=!1:(p+=16,p>=128&&(p=0,y=!1));return e+p}else return e}getTrackPort(e){return this.chRedir(0,e,!0)>>4}forceVoiceRefresh(){for(let e=0;e<b.ch;e++)t(this,ue)[e]&&this.dispatchEvent("voice",{part:e})}buildRchTree(){let e=[];t(this,H).forEach((a,h)=>{var o;a<b.ch&&((o=e[a])!=null&&o.constructor||(e[a]=[]),e[a].push(h))}),$(this,Ot,e)}buildRccMap(){let e=this;for(let a=0;a<b.ch;a++)t(e,rt)[a]={};t(e,Qe).forEach((a,h)=>{a&&(t(e,rt)[Math.floor(h/b.redir)][a]=h%b.redir|128)}),I()&&console.debug(t(e,rt))}invokeSysExIndicator(){this.dispatchEvent("mupromptex",t(this,$t))}getActive(){return t(this,ue)}getChActive(e){return t(this,ue)[e]}getCc(e){if(typeof e!="number"||e<0||e>=b.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let a=this,h=_[e];return t(a,k).subarray(h,h+b.cc)}getChCc(e,a){let h=this;if(We.indexOf(a)<0)throw new Error("CC number not accepted");return t(h,k)[_[e]+w[a]]}getChCcWritten(e,a){let h=this;if(We.indexOf(a)<0)throw new Error("CC number not accepted");return t(h,k)[b.chcc+_[e]+w[a]]}setChCc(e=0,a,h){let o=this;if(We.indexOf(a)<0)throw new Error("CC number not accepted");if((h==null?void 0:h.constructor)!==Number)throw new TypeError("Expected numbers for value");let p=h&255,y=_[e]+w[a];t(o,k)[y]=p,t(o,k)[y+b.chcc]=1,o.dispatchEvent("cc",{part:e,cc:a,data:p})}getCcAll(){return t(this,k).slice()}resetCc(e){let a=this,h=_[e]+b.chcc;t(a,k).fill(0,h,h+b.cc)}resetChCc(e,a,h){let o=this;h!=null&&h.constructor&&o.setChCc(e,a,h),t(o,k)[_[e]+w[a]+b.chcc]=0}resetCcAll(){t(this,k).fill(0,b.chcc,b.chcc<<1)}isChCcWritten(e,a){if(We.indexOf(a)<0)throw new Error("CC number not accepted");return t(upThis,k)[_[e]+w[a]+b.chcc]}getChSource(){return t(this,H)}getChType(){return t(this,R)}setChType(e,a,h=0,o=!1){a&=15;let p=this;h=h||p.getChModeId(e),t(p,R)[e]=a,a>0&&!o&&(p.setChCc(e,0,t(p,Q)[h][2]),p.pushChPrimitives(e))}setChActive(e,a=0){t(this,ue)[e]!==a&&this.dispatchEvent("channeltoggle",{part:e,active:a}),t(this,ue)[e]=a}getExt(e){let a=b.ext*e,h=t(this,ne).subarray(a,a+b.ext),o=new Uint8Array(h.length);return o.set(h),o[1]=o[1]||t(this,Kt),o}getPitch(){return t(this,Le)}getProgram(){return t(this,L)}getTexts(){return t(this,ge).slice()}getVel(e){let a=new Map,h=this;return t(h,q).forEach(function(o,p){let y=o>>7,v=o&127;e===y&&t(h,j)[o]>0&&a.set(v,{v:t(h,j)[o],s:t(h,K)[p]})}),a}getBitmap(){return{bitmap:t(this,be,Ie),expire:t(this,we)}}getLetter(){return{text:t(this,He),set:t(this,It),expire:t(this,Ge)}}getMode(){return Z[t(this,G)]}getMaster(){return{volume:t(this,F)}}getRawStrength(){let e=this;return t(this,q).forEach(function(a){let h=a>>7;t(e,j)[a]>t(e,Pe)[h]&&(t(e,Pe)[h]=t(e,j)[a])}),t(this,Pe)}getStrength(){let e=[],a=this;return this.getRawStrength().forEach(function(h,o){e[o]=Math.floor(h*a.getChCc(o,7)*a.getChCc(o,11)*t(a,F)/803288)}),e}getRpn(){return t(this,A)}getNrpn(){return t(this,yt)}getSubDb(){return self==null?void 0:self.structuredClone(t(this,Q))}getDetect(){return self==null?void 0:self.structuredClone(t(this,U))}getVoice(e,a,h,o="?"){var i;let p=this;(i=x[o])!=null&&i.constructor||(o="?");let y=x[o],v=e||t(p,Q)[y][0],m=a,r=h||t(p,Q)[y][1];v===Se.bank0&&(v=0),r===Se.bank0&&(r=0),o==="ns5r"&&v>0&&v<56&&(r=3);let d=p.userBank.get(v,m,r,o);if(o==="mt32"&&d.name.indexOf("MT-m:")===0){let s=parseInt(d.name.slice(5)),n=s*b.cmt,c="";t(p,_e).subarray(n,n+10).forEach(u=>{u>31&&(c+=String.fromCharCode(u))});let l=`MSB	LSB	PRG	NME
49	127	${m}	${c}`;p.userBank.load(l,!0),d.name=c,d.ending=" "}return(d.ending!==" "||!d.name.length)&&(d=p.baseBank.get(v,m,r,o)),d}getChPrimitive(e,a,h){if(a>=b.vxPrim||(a==null?void 0:a.constructor)!==Number)throw new RangeError(`Invalid voice primitive component "${a}"`);if(typeof e!="number"||e<0||e>=b.ch)throw new RangeError(`Invalid part number: CH${e+1}`);let o=this,p=t(o,L)[a<<b.chShift|e];switch(a){case 1:case 2:{o.getChCcWritten(e,[255,0,32][a])||(p=p||t(o,Q)[o.getChModeId(e)][a+2]),h&&(p=p||t(o,Q)[o.getChModeId(e)][a-1]),p===Se.bank0&&(p=0);break}}return p}getChPrimitives(e,a){let h=this,o=new Uint8Array(3);return o[1]=t(h,L)[e],o[0]=h.getChPrimitive(e,1,a),o[2]=h.getChPrimitive(e,2,a),o}pushChPrimitives(e){let a=this;t(a,L)[1<<b.chShift|e]=a.getChCc(e,0),t(a,L)[2<<b.chShift|e]=a.getChCc(e,32),a.dispatchEvent("voice",{part:e})}getChCvnBuffer(e,a=b.cvn){if(a>b.cvn||a<1)throw new RangeError("Invalid custom voice name buffer length");let h=Xt[e];return t(this,Je).subarray(h,h+a)}getChCvnRegister(e,a){if(a>=b.cvn||a<0)throw new RangeError("Invalid custom voice name register");return t(this,Je)[Xt[e]+a]}setChCvnRegister(e,a,h=32){if(a>=b.cvn||a<0)throw new RangeError("Invalid custom voice name register");t(this,Je)[Xt[e]+a]=Math.max(32,h&255)}getChCvnString(e,a){let h=ur.decode(this.getChCvnBuffer(e));return a||(h=h.trimEnd()),h}getChVoice(e){let a=this,h=a.getVoice(...a.getChPrimitives(e),a.getChMode(e));if(t(a,ye)[e]){let o="";switch(t(a,G)){case x.mt32:{t(a,xe).subarray(b.cmt*(e-1),b.cmt*(e-1)+10).forEach(p=>{o+=String.fromCharCode(Math.max(p,32))}),o=o.trimEnd();break}default:o=a.getChCvnString(e)}o.length&&(h.ending="~",h.name=o)}return h}getRawPitch(){return t(this,Le)}getPitchShift(e){let a=this,h=e*b.rpn,o=t(a,A)[h];return t(a,B)[e*b.rpnt]?o>>7&&(o-=256):t(a,G)===x.mt32&&(o=12),t(a,Le)[e]/8192*o+(t(a,A)[h+3]-64)+((t(a,A)[h+1]<<7)+t(a,A)[h+2]-8192)/8192}getEffectType(e=0){let a=3*e+1;return t(this,pe).subarray(a,a+2)}getPolyState(e=0){return t(this,K)[e]}setEffectTypeRaw(e=0,a,h){let o=3*e;t(this,pe)[o]=1,t(this,pe)[o+1+ +a]=h}setEffectType(e=0,a,h){this.setEffectTypeRaw(e,!1,a),this.setEffectTypeRaw(e,!0,h)}getEffectSink(){return t(this,mt)}setLetterDisplay(e,a,h=0,o=3200){let p=this,y;$(p,He," ".repeat(h)),e.forEach(v=>{$(p,He,t(p,He)+String.fromCharCode(v>31?v:32)),v<32&&(y=y||new Set,y.add(v))}),$(p,It,Date.now()),$(p,Ge,Date.now()+o),p.dispatchEvent("letter"),y&&(y=Array.from(y),y.forEach((v,m,r)=>{r[m]=v.toString(16).padStart(2,"0")}),console.warn(`${a}${a?" ":""}invalid code point${y.length>1?"s":""}: 0x${y.join(", 0x")}`))}setDetectionTargets(e="?",a=0){let h=this,o=-1;switch(e.replaceAll(", ",",").split(",").forEach(p=>{p=p.toLowerCase();let y=Z.indexOf(ir[p]||p);I()&&console.debug(`Mapped mode "${p}" to ID "${y}".`),y>-1&&(o=y)}),I()&&console.debug(`Set detection target to ID "${o}".`),o>0&&(t(h,U).x5=82,t(h,U).ds=x.krs),o){case x["05rw"]:{t(h,U).x5=81;break}case x.s90es:t(h,U).ds=x.s90es,t(h,U).smotif=x.s90es;case x.motif:t(h,U).ds=x.motif,t(h,U).smotif=x.motif}}setGsTargets(e=!1,a=4){if(!a)a=e?3:4;else{if(a>4||a<0)throw new Error(`Invalid GS level ${a}`);if(e&&a>>1!==1)throw new Error(`Invalid SC level ${a}`)}let h=this;t(h,U)[e?"sc":"gs"]=a,t(h,Q)[x[e?"sc":"gs"]][1]=a,h.forceVoiceRefresh()}getConfigs(){return t(this,Dt)}setDumpLimit(e){if(e>2||e<0)throw new RangeError("Invalid dump limit.");t(this,Re).dumpLimit=e}allocateAce(e=0,a){let h=this;if(!a||a<128&&a>95){console.warn(`cc${a} cannot be allocated as an active custom effect.`);return}let o=!0,p=0,y=b.ace*e;for(;o&&p<b.ace;)t(h,ae)[p+y]===a?o=!1:t(h,ae)[p+y]||(o=!1,t(h,ae)[p+y]=a,console.debug(`Allocated cc${a} to ACE slot ${p} in CH${e+1}.`)),p++;p>=b.ace&&console.warn(`ACE slots are full in CH${e+1}.`)}allocateAceAll(e){let a=this;if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}for(let h=0;h<b.ch;h++){let o=!0,p=0,y=b.ace*h;for(;o&&p<b.ace;)t(a,ae)[p+y]===e?o=!1:t(a,ae)[p+y]||(o=!1,t(a,ae)[p+y]=e),p++;p>=b.ace&&console.warn(`ACE slots are full in CH${h+1}.`)}}resetAce(){t(this,ae).fill(0),console.info("All ACE slots have been reset.")}resetChAceAll(e=0){t(this,ae).subarray(Gt[e],Gt[e]+b.ace).fill(0)}resetChAce(e=0,a){let h=!0,o=Gt[e],p=o+b.ace;for(;h&&o<p;)t(this,ae)[o]===a&&(t(this,ae)[o]=0,h=!1),o++;h&&I()&&console.debug(`No ACE slot was allocated to cc${a} in CH${e+1}.`)}getAce(){return t(this,ae)}getChAce(e=0,a=0){if(a<0||a>=b.ace)throw new RangeError("No such ACE slot");let h=t(this,ae)[b.ace*e+a];if(h){if(We.indexOf(h)>=0)return this.getChCc(e,h);throw new Error(`Invalid ACE source in CH${e+1}: ${h}`)}else return 0}initDrums(){let e=this;t(e,de).fill(64);for(let a=0;a<b.drm;a++){let h=a*b.dpn;for(let o in Ia){let p=Ia[o],y=(h+Ee[o])*b.dnc;t(e,de).subarray(y,y+b.dnc).fill(p)}}}init(e=0){let a=this;$(a,je,0),t(a,Q)[x.xg][1]=0,a.dispatchEvent("banklevel",{mode:"xg",data:0}),t(a,ue).fill(0),t(a,k).fill(0),t(a,ae).fill(0),t(a,L).fill(0),t(a,j).fill(0),t(a,q).fill(0),t(a,K).fill(0),t(a,ie).fill(0),t(a,Pe).fill(0),t(a,Le).fill(0),t(a,yt).fill(0),t(a,B).fill(0),t(a,ne).fill(0),t(a,J).fill(0),t(a,vt).fill(0),t(a,Ze).fill(0),t(a,Qe).fill(0),$(a,F,100),$(a,ge,[]),$(a,kt,500),$(a,et,0),$(a,tt,0),$(a,at,!1),$(a,we,0),$(a,se,0),t(a,be,Ie).fill(0),$(a,X,a.KARAOKE_NONE),$(a,wt,0),$(a,Ae,!0),$(a,W,!1),$(a,$t,0),a.initDrums(),a.polyIndexLatest=0,a.polyIndexLast=0,t(a,H).forEach(function(h,o,p){p[o]=o}),e===0&&(a.dispatchEvent("mode","?"),$(a,G,0),t(a,Be).fill(0),t(a,Xe).fill(0),$(a,Ge,0),$(a,He,"")),cr.forEach(h=>{a.setChCc(h,0,t(a,Q)[a.getChModeId(h)][2])}),t(a,R).fill(a.CH_MELODIC),t(a,R)[9]=a.CH_DRUM1,t(a,R)[25]=a.CH_DRUM3,t(a,R)[41]=a.CH_DRUMS,t(a,R)[57]=a.CH_DRUMS,t(a,R)[73]=a.CH_DRUM5,t(a,R)[89]=a.CH_DRUM7,t(a,R)[105]=a.CH_DRUMS,t(a,R)[121]=a.CH_DRUMS;for(let h=0;h<b.drm;h++)t(a,$e)[h<<1]=0,t(a,$e)[h<<1|1]=b.invalidCh;t(a,Ct).fill(0),t(a,_e).fill(0),t(a,Ne).fill(0),t(a,xe).fill(0),t(a,ye).fill(0),t(a,Je).fill(32),t(a,pe).fill(0),t(a,mt).fill(0),a.aiEfxName="",a.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),a.modelEx.sc.showBar=!0,a.modelEx.sc.invBar=!1,a.modelEx.sc.invDisp=!1,a.modelEx.sc.peakHold=1,a.modelEx.cs1x.perfCh=0;for(let h=0;h<b.ch;h++){let o=_[h];t(a,k)[o+w[7]]=100,t(a,k)[o+w[11]]=127,t(a,k)[o+w[2]]=127,t(a,k)[o+w[10]]=64,t(a,k).subarray(o+w[71],o+w[71]+8).fill(64),t(a,k)[o+w[128]]=127,t(a,k).subarray(o+w[130],o+w[157]+1).fill(64),t(a,k)[o+w[91]]=40,t(a,k)[o+w[101]]=127,t(a,k)[o+w[100]]=127,t(a,k)[o+w[99]]=127,t(a,k)[o+w[98]]=127;let p=h*b.rpn;t(a,A)[p]=2,t(a,A)[p+1]=64,t(a,A)[p+2]=0,t(a,A)[p+3]=64,t(a,A)[p+4]=0,t(a,A)[p+5]=0;let y=h*b.ext;t(a,ne)[y+1]=a.VLBC_BRTHEXPR;let v=h*b.redir;t(a,Qe)[v+8]=13}a.buildRchTree(),a.buildRccMap(),a.dispatchEvent("mastervolume",t(a,F)),a.dispatchEvent("efxreverb",a.getEffectType(0)),a.dispatchEvent("efxchorus",a.getEffectType(1)),a.dispatchEvent("efxdelay",a.getEffectType(2)),a.dispatchEvent("efxinsert0",a.getEffectType(3)),a.dispatchEvent("efxinsert1",a.getEffectType(4)),a.dispatchEvent("efxinsert2",a.getEffectType(5)),a.dispatchEvent("efxinsert3",a.getEffectType(6)),a.dispatchEvent("reset"),a.switchMode("?")}setChMode(e,a){let h=this;if(typeof e!="number"||e<0||e>=b.ch)throw new RangeError(`Invalid part number: CH${e+1}`);if(e<0||a>=Z.length)throw new RangeError(`Invalid mode ID ${a}`);t(h,Ze)[e]=a,h.dispatchEvent("chmode",{part:e,id:a,mode:Z[a]}),h.dispatchEvent("voice",{part:e})}getChMode(e,a){return Z[this.getChModeId(e,a)]}getChModeId(e,a){return a?t(this,Ze)[e]||t(this,J)[e>>4]:t(this,Ze)[e]||t(this,J)[e>>4]||t(this,G)}setPortMode(e,a,h){let o=this;if(e<0||e>=b.ch>>4)throw new RangeError(`Invalid port ${e+1}`);if(a<1)throw new RangeError("Range must be a positive integer");if(e+a>=b.ch>>4)throw new RangeError("Range must be in bound");if(e<0||h>=Z.length)throw new RangeError(`Invalid mode ID ${h}`);t(o,vt)[e]=h;for(let p=e;p<e+a;p++){let y=t(o,vt)[p];if(a>1&&y!==0&&y!==h)break;t(o,J)[p]=h;for(let v=p<<4;v<p+1<<4;v++)o.dispatchEvent("chmode",{part:v,id:h,mode:Z[h]}),o.dispatchEvent("voice",{part:v})}}copyChSetup(e,a,h){if(e===a){console.warn(`Failed attempt at overwriting CH${e+1} with its own data.`);return}let o=this;if(h&&t(o,ue)[a]){console.warn(`Failed attempt at copying setup data from CH${e+1} to CH${a+1}.`);return}let p=_[e],y=_[a];t(o,L)[a]=t(o,L)[e],t(o,k).set(t(o,k).subarray(p,p+b.cc),y),o.pushChPrimitives(a)}setDrumFirstWrite(e,a){let h=this,o=t(h,R)[e];if(o<2)return;let p=o-2;if(t(h,$e)[p<<1])if(a)t(h,$e)[p<<1]=0,I()&&console.debug(`First write part for drum set ${p+1} has been reset.`);else return;else a?console.warn(`First write part for drum set ${p+1} is already blank.`):(t(h,$e)[p<<1]=1,t(h,$e)[p<<1|1]=e,console.debug(`First write part for drum set ${p+1} is set to CH${e+1}.`))}getChDrumFirstWrite(e){let a=this,h=t(a,R)[e];if(h<2)return;let o=h-2;return t(a,$e).subarray(o<<1,o+1<<1)}getDrumFirstWrite(e){if(e>=0&&e<b.drm)return t(this,$e).subarray(e<<1,e+1<<1)}switchMode(e,a=!1,h=!1){var y;let o=this,p=x[e];if(p>-1){if(t(o,G)===0||a){o.initOnReset&&a&&this.init(1),$(o,G,p),$(o,se,0);for(let m=0;m<b.ch;m++){let r=o.getChModeId(m,!0);t(o,R)[m]>0&&r===x["?"]&&(o.setChCc(m,0,t(o,Q)[p][2]),I()&&console.debug(`CH${m+1} (${t(o,R)[m]}) (${o.getChMode(m)}), ${Z[r]} (${t(o,Q)[r][2]}) -> ${Z[p]} (${t(o,Q)[p][2]})`),o.pushChPrimitives(m))}switch(p){case x.mt32:{jt.forEach((m,r)=>{let d=r+1;t(o,ue)[d]||(t(o,L)[d]=m,o.setChCc(d,91,127),o.pushChPrimitives(d))});for(let m=1;m<10;m++)o.dispatchEvent("voice",{part:m});break}}let v;switch(p){case x["?"]:case x.g2:{v=[52,4,52,18,0,255,0,255];break}case x.xg:case x.cs1x:{v=[1,0,65,0,5,0,64,0];break}case x.gm:case x.gs:case x.sc:{v=[40,4,40,18,40,32,32,0];break}case x.sd:{v=[58,0,60,0,61,0,61,0];break}case x["05rw"]:case x.x5d:case x.ns5r:{v=[44,1,44,19,0,255,0,255];break}case x.k11:case x.sg:{v=[24,0,0,255,0,255,0,255];break}case x.mt32:{v=[40,4,0,255,0,255,0,255];break}case x.doc:{v=[24,16,0,255,0,255,0,255];break}case x.motif:case x.s90es:case x.cs6x:{v=[129,0,133,0,130,0,0,0];break}default:v=[0,0,0,0,0,0,0,0]}for(let m=0;m<b.efx;m++)!t(o,pe)[3*m]&&((y=v[m<<1])!=null&&y.constructor)&&(t(o,pe)[3*m+1]=v[2*m],t(o,pe)[3*m+2]=v[2*m+1],o.dispatchEvent(`efx${["reverb","chorus","delay","insert0"][m]}`,o.getEffectType(m)));h&&o.setDetectionTargets(e),o.dispatchEvent("mode",e),o.forceVoiceRefresh()}}else throw new Error(`Unknown mode ${e}`)}newStrength(){t(this,Pe).fill(0)}runJson(e){var a;if(e.type>14)return e.type===15&&e.data.constructor!==Uint8Array&&(e.data=Uint8Array.from(e.data)),t(this,Lt)[e.type].call(this,e);{let h=this.chRedir(e.part,e.track),o=!1;(a=t(this,Ot)[h])==null||a.forEach(p=>{e.channel=p,o=!0,t(this,Lt)[e.type].call(this,e)}),o||console.warn(`${Ra[e.type]?Ra[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!==void 0?e.data[0]:e.data).toString():""} event sent to CH${h+1} without any recipient.`)}t(this,ge).length>100&&t(this,ge).splice(100,t(this,ge).length-99)}runRaw(e){}async loadBank(e,a){let h=this;switch(e=e.toLowerCase(),e){case"s7e":{h.userBank.clearRange({msb:63,lsb:[21,22]}),h.userBank.clearRange({msb:63,lsb:[24,27]});break}case"pcg":{h.userBank.clearRange({msb:63,lsb:[6,9]}),h.userBank.clearRange({msb:63,lsb:[13,16]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":case"pcg":{Mt.context=this,await h.userBank.load(await Mt.read(e,a),!1);break}}h.forceVoiceRefresh()}},G=new WeakMap,se=new WeakMap,we=new WeakMap,Oe=new WeakMap,be=new WeakSet,Ie=function(){return t(this,Oe)[t(this,se)]},Ua=function(e){t(this,Oe)[t(this,se)]=e},ue=new WeakMap,H=new WeakMap,R=new WeakMap,k=new WeakMap,ae=new WeakMap,L=new WeakMap,j=new WeakMap,ie=new WeakMap,q=new WeakMap,K=new WeakMap,Le=new WeakMap,Pe=new WeakMap,qe=new WeakMap,ne=new WeakMap,A=new WeakMap,B=new WeakMap,yt=new WeakMap,de=new WeakMap,$e=new WeakMap,pe=new WeakMap,mt=new WeakMap,Qe=new WeakMap,J=new WeakMap,vt=new WeakMap,Ze=new WeakMap,ye=new WeakMap,Je=new WeakMap,Ne=new WeakMap,xe=new WeakMap,Ct=new WeakMap,_e=new WeakMap,Q=new WeakMap,U=new WeakMap,Re=new WeakMap,Dt=new WeakMap,F=new WeakMap,je=new WeakMap,kt=new WeakMap,et=new WeakMap,tt=new WeakMap,Vt=new WeakMap,at=new WeakMap,He=new WeakMap,Ge=new WeakMap,It=new WeakMap,wt=new WeakMap,Ae=new WeakMap,X=new WeakMap,Kt=new WeakMap,Ot=new WeakMap,W=new WeakMap,$t=new WeakMap,rt=new WeakMap,ge=new WeakMap,Be=new WeakMap,Xe=new WeakMap,ce=new WeakMap,st=new WeakMap,ee=new WeakMap,Lt=new WeakMap,Ft=new WeakMap,it=new WeakMap,nt=new WeakMap,te=new WeakMap,me=new WeakMap,De=new WeakMap,ct=new WeakMap,ot=new WeakMap,lt=new WeakMap,Ba);var na=oa(ta(),1);N();N();var Bt,Na,Ha=(Na=class{constructor(g,e,a,h){S(this,Bt,!1);$(this,Bt,g),this.start=e,this.end=a,this.data=h}get duration(){return this.ranged?this.end-this.start:0}get ranged(){return t(this,Bt)}},Bt=new WeakMap,Na),sa=class extends Ha{constructor(g,e,a){super(!0,g,e,a)}},Ga=class extends Ha{constructor(g,e){super(!1,g,g,e)}},dt,_a,ia=(_a=class extends Array{constructor(){super(...arguments);S(this,dt,-1)}resetIndex(e){$(this,dt,-1)}fresh(){this.sort(function(e,a){return e.start==a.start?0:(+(e.start>a.start)<<1)-1}),this.forEach(function(e,a){e.index=a})}step(e,a=!1){let h=[];if(a)for(let o=0;o<this.length&&!(this[o].start>e);o++){if(this[o].end<e)continue;h.push(this[o])}else{let o=this.getRange(t(this,dt)==-1?0:e-1,e),p=this;o.forEach(function(y){y.index>t(p,dt)&&(h.push(y),$(p,dt,y.index))})}return h}getRange(e,a){var v;e>a&&([e,a]=[a,e]);let h=[],o=-1,p=Math.ceil(Math.sqrt(this.length)),y=!0;for(let m=0;m<this.length;m+=p)this[m+p]?o<0&&this[m+p].start>=e&&(o=m):o=o<0?m:o;for(;y;)((v=this[o])==null?void 0:v.end)<a?this[o].start>=e&&h.push(this[o]):y=!1,o++;return h}},dt=new WeakMap,_a);var br=0xffffffffffff,Xa=function(g){let e=new ia,a=this,h=g.timeDivision,o=120,p=new ia,y=0,v=0;p.push(new sa(0,br,[120,0])),g.track.forEach(function(i){y=0,i.event.forEach(function(s){y+=s.deltaTime,s.type===255&&(s==null?void 0:s.metaType)===81&&(o=6e7/s.data,p[p.length-1]&&p.push(new sa(y,0xffffffffffff,[o,0])))})}),p.fresh(),p.forEach(function(i,s,n){s>0&&(n[s-1].end=i.start)});let m=120;p.forEach(function(i,s,n){s>0&&(i.end===i.start?n.splice(n.indexOf(i),1):m===i.data[0]&&(n[s-1].end=i.end,n.splice(n.indexOf(i),1)),m=i.data[0])});let r=0,d=120;return p.forEach(function(i){let s=i.start,n=s/d/h*60+r;d=i.data[0],r=n-s/d/h*60,i.data[1]=r}),console.debug("All tempo changes: ",p),o=120,y=0,v=0,g.track.forEach(function(i,s){y=0,v=0;let n=s+1;i.event.forEach(function(c,l){y+=c.deltaTime;let u=p.step(y,!0)[0];u&&(o=u.data[0],v=u.data[1]);let f={type:c.type,data:c.data,track:n,part:0};c.type>14?f.meta=c.metaType:f.part=c.channel,e.push(new Ga(y/o/h*60+v,f))})}),e.fresh(),self.midiEvents=e,console.debug(`Parsed a type ${g.formatType} MIDI sequence.`),e};na.default.customInterpreter=Ma;var V=function(g,e,a){g.addEventListener(a,h=>{e.dispatchEvent(a,h.data)})},ht,Ve,xt,Ue,ft,St,ut,Ut,Ke,Fe,oe,le,ve,pt,Nt,Ye,Va,Ts=(Va=class extends _t{constructor(e,a=.5,h=.5){super();P(this,"device");S(this,ht,void 0);S(this,Ve,{});S(this,xt,[]);S(this,Ue,"");S(this,ft,[]);S(this,St,[]);S(this,ut,new Uint8ClampedArray(128));S(this,Ut,new Uint8ClampedArray(128));S(this,Ke,.5);S(this,Fe,120);S(this,oe,4);S(this,le,4);S(this,ve,0);S(this,pt,0);S(this,Nt,new Array(b.ch));S(this,Ye,new Uint8Array(b.ch));P(this,"smoothAttack",0);P(this,"smoothDecay",0);let o=this;o.smoothAttack=a,o.smoothDecay=h,o.device=e,o.addEventListener("meta",function(p){var y;(y=p==null?void 0:p.data)==null||y.forEach(function(v){(t(o,ft)[v.meta]||console.debug).call(o,v.meta,v.data)})}),V(o.device,o,"mode"),V(o.device,o,"mastervolume"),V(o.device,o,"channelactive"),V(o.device,o,"channelmin"),V(o.device,o,"channelmax"),V(o.device,o,"portrange"),V(o.device,o,"portstart"),V(o.device,o,"channelreset"),V(o.device,o,"channeltoggle"),V(o.device,o,"screen"),V(o.device,o,"metacommit"),V(o.device,o,"voice"),V(o.device,o,"pitch"),V(o.device,o,"note"),V(o.device,o,"reset"),V(o.device,o,"banklevel"),V(o.device,o,"efxreverb"),V(o.device,o,"efxchorus"),V(o.device,o,"efxdelay"),V(o.device,o,"efxinsert0"),V(o.device,o,"efxinsert1"),V(o.device,o,"efxinsert2"),V(o.device,o,"efxinsert3"),V(o.device,o,"partefxtoggle"),V(o.device,o,"chmode"),o.addEventListener("note",function({data:p}){t(o,St).push(p)}),o.addEventListener("voice",({data:p})=>{var v;let y=o.getChVoice(p.part);t(o,Nt)[p.part]=y,t(o,Ye)[p.part]=(v=y.poly)!=null?v:1}),o.addEventListener("reset",({data:p})=>{t(o,Ye).fill(1)}),t(o,Ye).fill(1),t(o,ft)[3]=function(p,y){var v;((v=t(o,Ue))==null?void 0:v.length)<1&&($(o,Ue,y),o.dispatchEvent("title",t(o,Ue)))},t(o,ft)[81]=function(p,y){let v=o.noteProgress,m=t(o,Ke)||.5;$(o,Fe,6e7/y),$(o,Ke,y/1e6),$(o,ve,t(o,ve)+(v*(m/t(o,Ke))-v)),o.dispatchEvent("tempo",t(o,Fe))},t(o,ft)[88]=function(p,y){let v=o.noteBar,m=o.noteBeat,r=t(o,oe),d=t(o,le);if($(o,oe,y[0]),$(o,le,1<<y[1]),r!==t(o,oe)){let i=v;$(o,ve,t(o,ve)-i*(t(o,oe)-r)*(4/t(o,le))),m+1>=r&&(r<t(o,oe)?$(o,ve,t(o,ve)-Math.ceil(t(o,oe)-m-1)):$(o,ve,t(o,ve)+t(o,oe)))}if(d!==t(o,le)){let i=v;console.debug(`${v}/${m}`),d<t(o,le)?$(o,ve,t(o,ve)+i*(t(o,le)-d)*(d/t(o,le))):$(o,ve,t(o,ve)+i*(t(o,le)-d)*(t(o,le)/d))}o.dispatchEvent("tsig",o.getTimeSig())}}reset(){var a;let e=this;e.dispatchEvent("reset"),(a=t(e,ht))==null||a.resetIndex(),e.device.init(),$(e,Ue,""),$(e,Ke,.5),$(e,Fe,120),$(e,oe,4),$(e,le,4),$(e,ve,0),$(e,pt,0),e.dispatchEvent("tempo",t(e,Fe)),e.dispatchEvent("title",t(e,Ue))}init(){this.reset(),$(this,ht,void 0)}async loadFile(e){$(this,ht,Xa(na.default.parse(new Uint8Array(await e.arrayBuffer()))))}async loadMap(e,a,h){let o=this,p=0,y=0,v=0,m=0,r,d;e.split(`
`).forEach((i,s)=>{var c;if(!i)return;let n=i.split("	");if(s){if(!m)return;let l="",u="";n.forEach((E,C)=>{switch(C){case r:{l=E;break}case d:{u=E;break}}});let f=!1;((c=t(o,Ve)[l])==null?void 0:c.priority)>h&&(f=!0,v++),!t(o,Ve)[l]||f||a?(t(o,Ve)[l]={name:u,priority:h},p++):self.debugMode&&console.debug(`Voice "${u}" (${l}) seems to be in conflict with (${t(o,Ve)[l]}).`),y++}else n.forEach((l,u)=>{switch(l){case"ID":{r=u,m++;break}case"Name":{d=u,m++;break}default:console.debug(`Unknown map field: ${l}`)}})}),console.debug(`Voice names: ${y} total, ${p} loaded (${p-v} + ${v}).`),o==null||o.device.forceVoiceRefresh()}async loadMapPaths(e){let a=this;e.forEach(async(h,o)=>{a.loadMap(await(await fetch(h)).text(),0,o)})}async loadEfx(e,a){let h=this,o=0,p=0,y,v,m;e.split(`
`).forEach((r,d)=>{if(r)if(d){let i=0,s;r.split("	").forEach((n,c)=>{switch(c){case y:{i|=(parseInt(n,16)&255)<<8;break}case v:{i|=parseInt(n,16)&255;break}case m:{s=n;break}}}),!t(h,xt)[i]||a?(t(h,xt)[i]=s,o++):self.debugMode&&console.debug(`EFX ID 0x${i.toString(16).padStart(4,"0")} (${s}) seems to be in conflict.`),p++}else r.split("	").forEach((i,s)=>{switch(i){case"MSB":{y=s;break}case"LSB":{v=s;break}case"Name":{m=s;break}default:console.debug(`Unknown EFX field: ${i}`)}})}),console.debug(`EFX: ${p} total, ${o} loaded.`),h.dispatchEvent("efxreverb",h.device.getEffectType(0)),h.dispatchEvent("efxchorus",h.device.getEffectType(1)),h.dispatchEvent("efxdelay",h.device.getEffectType(2)),h.dispatchEvent("efxinsert0",h.device.getEffectType(3)),h.dispatchEvent("efxinsert1",h.device.getEffectType(4)),h.dispatchEvent("efxinsert2",h.device.getEffectType(5)),h.dispatchEvent("efxinsert3",h.device.getEffectType(6))}async loadModels(e,a){let h=this,o=0,p=0}async loadStyles(e,a){let h=this,o=0,p=0}switchMode(e,a=!1){this.device.switchMode(e,a)}getMode(){return this.device.getMode()}getVoice(){return this.device.getVoice(...arguments)}getChVoice(e){return this.device.getChVoice(e)}getChPrimitive(e,a,h){return this.device.getChPrimitive(e,a,h)}getChPrimitives(e,a){return this.device.getChPrimitives(e,a)}getMapped(e){var a;return((a=t(this,Ve)[e])==null?void 0:a.name)||e}getEfx([e,a]){let h=e<<8|a;return t(this,xt)[h]||`0x${h.toString(16).padStart(4,"0")}`}getVoxBm(e){if(!e)throw new Error("Voice object must be valid");let a=this;if(!a.voxBm)throw new Error("Voice bitmap repository isn't yet initialized");let h=a.voxBm.getBm(e.name);if(!h)switch(e.mode){case"xg":{switch(e.sid[0]){case 0:case 80:case 81:case 83:case 84:case 96:case 97:case 99:case 100:{h=a.voxBm.getBm(a.getVoice(Se.bank0,e.sid[1],Se.bank0,e.mode).name);break}}break}case"g2":case"sd":{switch(e.sid[0]){case 96:case 97:case 98:case 99:{h=a.voxBm.getBm(a.getVoice(Se.bank0,e.sid[1],Se.bank0,e.mode).name);break}case 104:case 105:case 106:case 107:{h=a.voxBm.getBm(a.getVoice(120,e.sid[1],Se.bank0,e.mode).name);break}}break}case"gs":case"sc":case"k11":case"sg":case"gm":{switch(e.sid[0]){case 120:break;case 122:case 127:{h=a.voxBm.getBm(a.getVoice(120,e.sid[1],0,e.mode).name);break}default:h=a.voxBm.getBm(a.getVoice(0,e.sid[1],0,e.mode).name)}break}default:switch(e.sid[0]){case 56:{h=a.voxBm.getBm(a.getVoice(0,e.sid[1],0,e.mode).name);break}}}return h||(h=a.voxBm.getBm(a.getVoice(e.sid[0],e.sid[1],0,e.mode).name)),h}getChBm(e,a){let h=this;a=a||h.getChVoice(e);let o=h.getVoxBm(a);if(!o){if(!h.sysBm)return;switch(a.mode){case"xg":{switch(a.sid[0]){case 126:{a.sid[1]>>1===56&&(o=h.sysBm.getBm("cat_smpl"));break}case 16:{o=h.sysBm.getBm("cat_smpl");break}case 64:case 67:{o=h.sysBm.getBm("cat_sfx");break}case 32:case 33:case 34:case 35:case 36:case 48:case 82:{o=h.sysBm.getBm("cat_xg");break}}break}default:switch(a.sid[0]){case 63:case 32:case 33:case 34:case 35:case 36:case 48:case 82:{o=h.sysBm.getBm("cat_mex");break}}}}return o||(h.device.getChType()[e]?o=h.sysBm.getBm("cat_drm"):o=h.sysBm.getBm("no_vox")),o}get noteProgress(){return t(this,pt)/t(this,Ke)}get noteOverall(){return(this.noteProgress-t(this,ve))*t(this,le)/4}get noteBar(){return Math.floor(this.noteOverall/t(this,oe))}get noteBeat(){let e=this.noteOverall%t(this,oe);return e<0&&(e+=t(this,oe)),e}get noteOffset(){return t(this,ve)}getTimeSig(){return[t(this,oe),t(this,le)]}getTempo(){return t(this,Fe)}eachVoice(e){t(this,Nt).forEach(e)}sendCmd(e){this.device.runJson(e)}render(e){var D;e>t(this,pt)&&$(this,pt,e);let a=((D=t(this,ht))==null?void 0:D.step(e))||[],h=0,o=0,p=new Set,y={},v=[],m=this,r=[];for(m.device.getStrength().forEach((M,O)=>{t(m,Ut)[O]=M}),m.device.newStrength(),a.forEach(function(M){let O=M.data,z=m.device.runJson(O);switch(z==null?void 0:z.reply){case"meta":{r.push(z);break}}z!=null&&z.reply&&delete z.reply});t(m,St).length>0;){let M=t(m,St).shift(),O=M.part<<7|M.note;M.state?(p.add(O),y[O]=M.velo):p.has(O)&&(v.push({part:M.part,note:M.note,velo:y[O],state:m.device.NOTE_SUSTAIN}),h++,o+=t(m,Ye)[M.part])}(r==null?void 0:r.length)>0&&m.dispatchEvent("meta",r);let d=m.device.getActive(),i=[],s=m.device.getPitch(),n=m.device.getCcAll(),c=m.device.getProgram(),l=m.device.getChType(),u=[],f=m.device.getStrength();f.forEach(function(M,O,z){z[O]=Math.max(t(m,Ut)[O],M);let Y=z[O]-t(m,ut)[O];if(Y>=0){let Te=4*.25**(m.device.getChCc(O,73)/64);t(m,ut)[O]+=Math.ceil(Y-Y*m.smoothAttack**Te)}else{let Te=4*.25**(m.device.getChCc(O,72)/64);t(m,ut)[O]+=Math.floor(Y-Y*m.smoothDecay**Te)}});let E=0,C=0;return d.forEach(function(M,O){M&&(i[O]=m.device.getVel(O),u[O]=m.device.getExt(O),E+=i[O].size,C+=i[O].size*t(m,Ye)[O])}),{extraPoly:h,extraPolyEC:o,extraNotes:v,curPoly:E,curPolyEC:C,chInUse:d,chKeyPr:i,chPitch:s,chProgr:c,chContr:n,chType:l,chExt:u,eventCount:a.length,title:t(m,Ue),bitmap:m.device.getBitmap(),letter:m.device.getLetter(),texts:m.device.getTexts(),master:m.device.getMaster(),mode:m.device.getMode(),strength:t(m,ut).slice(),velo:f,rpn:m.device.getRpn(),tSig:m.getTimeSig(),tempo:m.getTempo(),noteBar:m.noteBar,noteBeat:m.noteBeat,ace:m.device.getAce(),rawVelo:m.device.getStrength(),rawStrength:m.device.getRawStrength(),rawPitch:m.device.getRawPitch(),efxSink:m.device.getEffectSink()}}},ht=new WeakMap,Ve=new WeakMap,xt=new WeakMap,Ue=new WeakMap,ft=new WeakMap,St=new WeakMap,ut=new WeakMap,Ut=new WeakMap,Ke=new WeakMap,Fe=new WeakMap,oe=new WeakMap,le=new WeakMap,ve=new WeakMap,pt=new WeakMap,Nt=new WeakMap,Ye=new WeakMap,Va);export{Ts as RootDisplay,b as allocated,w as ccToPos,Ee as dnToPos};
