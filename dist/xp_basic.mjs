var oa=Object.create;var ut=Object.defineProperty;var la=Object.getOwnPropertyDescriptor;var da=Object.getOwnPropertyNames;var fa=Object.getPrototypeOf,ha=Object.prototype.hasOwnProperty;var ua=(u,e,s)=>e in u?ut(u,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[e]=s;var Rt=(u,e)=>()=>(u&&(e=u(u=0)),e);var pa=(u,e)=>()=>(e||u((e={exports:{}}).exports,e),e.exports);var ba=(u,e,s,h)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of da(e))!ha.call(u,o)&&o!==s&&ut(u,o,{get:()=>e[o],enumerable:!(h=la(e,o))||h.enumerable});return u};var ga=(u,e,s)=>(s=u!=null?oa(fa(u)):{},ba(e||!u||!u.__esModule?ut(s,"default",{value:u,enumerable:!0}):s,u));var C=(u,e,s)=>(ua(u,typeof e!="symbol"?e+"":e,s),s),Ot=(u,e,s)=>{if(!e.has(u))throw TypeError("Cannot "+s)};var t=(u,e,s)=>(Ot(u,e,"read from private field"),s?s.call(u):e.get(u)),v=(u,e,s)=>{if(e.has(u))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(u):e.set(u,s)},E=(u,e,s,h)=>(Ot(u,e,"write to private field"),h?h.call(u,s):e.set(u,s),s);var Dt=Rt(()=>{"use strict";R();(function(){var u=function(c,n,i){var f,l;if(self.MessageEvent)switch(c){case"message":{l=new MessageEvent(c,{data:n,ports:i==null?void 0:i.ports}),Object.defineProperty(l,"source",{value:i==null?void 0:i.source});break}default:l=new Event(c)}else l=document.createEvent("Event"),l.initEvent(c,!1,!1),i&&c=="message"&&(l.data=n,i.source&&Object.defineProperty(l,"source",{value:i.source}),(f=i.ports)!=null&&f.length&&Object.defineProperty(l,"ports",{value:i.ports}));return l};self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),s=[],h={},o=function(c){var n,i=this;if((this==null?void 0:this.constructor)!=o)throw new TypeError("Illegal constructor");s.push(this),(n=h[c])!=null&&n.constructor||(h[c]=[]),h[c].push(this);var f=Math.floor(Math.random()*281474976710656),l=[],d=0,p=[],y=!0,$=!1;Object.defineProperty(this,"id",{get:function(){return f}}),Object.defineProperty(this,"name",{value:c}),this.close=function(){var w,T=s.indexOf(i);T>-1?(e.postMessage({t:"d",c,i:f}),s.splice(T,1),(w=h[c])!=null&&w.constructor&&(T=h[c].indexOf(i),T>-1&&h[c].splice(T,1)),h[c].length||delete h[c],console.debug("[Snowy] BroadcastChannel closed."),$=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(w){if(e){if($)throw new Error("Channel already closed");e.postMessage({t:"m",c,i:f,m:d,d:w}),d++,d>4294967295&&(d=0)}else p.push(w),console.debug("[Snowy] Message is cached.")},this.flush=function(){if(e){if(y){for(e.postMessage({t:"r",c,i:f}),console.debug("[Snowy] ".concat(p.length," message(s) in cache."));p.length;){var w=p.shift();i.postMessage(w)}y=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(w){w.c==c?w.i!=f&&i.dispatchEvent(u("message",w.d,{source:i})):console.debug("[Snowy] Channel ID mismatch. Instance ".concat(f," receives from ").concat(c,", not ").concat(w.c,"."))};var k={};this.dispatchEvent=function(w){var T,A;if(Object.defineProperty(w,"target",{value:i}),Object.defineProperty(w,"currentTarget",{value:i}),(T=k[w.type])!=null&&T.length)for(var V=k[w.type],ie=0;ie<V.length;ie++)((A=V[ie])==null?void 0:A.constructor)==Function&&V[ie].call(i,w);i["on".concat(w.type)]&&i["on".concat(w.type)].constructor==Function&&i["on".concat(w.type)].call(i,w)},this.addEventListener=function(w,T){var A;(A=k[w])!=null&&A.constructor||(k[w]=[]);var V=k[w].indexOf(T);V==-1&&k[w].push(T)},this.removeEventListener=function(w,T){var A,V;if((A=k[w])!=null&&A.length){var ie=k[w].indexOf(T);ie>-1&&k[w].splice(ie,1)}!((V=k[w])!=null&&V.length)&&k[w].constructor&&delete k[w]}},self.BroadcastChannel=o,a=function(){if(e){e.addEventListener("message",function(n){var i=n.data,f=!1;switch(i.t){case"k":{f=!1,e.postMessage({t:"k"});break}case"m":{var l=h[i.c];if(l!=null&&l.length)for(var d=0;d<l.length;d++)l[d].receiveMessage(i);break}case"c":{for(var p=[],y=0;y<s.length;y++){var $=s[y].name;p.indexOf($)<0&&p.push($)}e.postMessage({t:"k",c:p});break}default:f=!0}f&&console.info("ReceiveBroadcast",i)});for(var c=0;c<s.length;c++)s[c].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},r=function(){if(!e){var c=new SharedWorker(self.SNOWY_PATH||"/snowy.js");c.port.start();var n=function(i){i.data.t=="swc"&&(c.port.removeEventListener("message",n),e=c.port,e.postMessage({t:"k"}),a())};c.port.addEventListener("message",n)}},r());var e,s,h,o,a,r})()});var R=Rt(()=>{"use strict";Dt();{let u=function(e,s){let h=new FileReader;return new Promise((o,a)=>{switch(h.addEventListener("abort",()=>{a(new Error("Blob read aborted"))}),h.addEventListener("error",r=>{a(h.error||r.data||new Error("Blob read error"))}),h.addEventListener("load",()=>{o(h.result)}),s.toLowerCase()){case"arraybuffer":case"buffer":{h.readAsArrayBuffer(e);break}case"string":case"text":{h.readAsText(e);break}default:a(new Error(`Unknown target ${s}`))}})};Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||function(){return u(this,"buffer")},Blob.prototype.text=Blob.prototype.text||function(){return u(this,"text")}}String.prototype.replaceAll=String.prototype.replaceAll||function(u,e){let s=0,h=16,o=this,a=[];for(;s<h&&o.lastIndexOf(u)>-1;){let r=o.lastIndexOf(u);a.unshift(o.slice(r+u.length)),o=o.slice(0,r),r==0&&a.unshift(""),s++}return o.length&&a.unshift(o),a.join(e)||""},String.prototype.padStart=String.prototype.padStart||function(u,e){if(e){let s=this;for(;s.length<u;)s=`${e}${s}`;return s}},String.prototype.padEnd=String.prototype.padEnd||function(u,e){if(e){let s=this;for(;s.length<u;)s+=e;return s}}});var ta=pa((br,St)=>{R();(function(){"use strict";let u={fatal:!0},e=[new TextDecoder("iso-8859-15",u),new TextDecoder("sjis",u),new TextDecoder("euc-jp",u),new TextDecoder("utf-8",u),new TextDecoder("utf-16",u),new TextDecoder("ascii")],s={debug:!1,parse:function(h,o){if(h instanceof Uint8Array)return s.Uint8(h);if(typeof h=="string")return s.Base64(h);if(h instanceof HTMLElement&&h.type==="file")return s.addListener(h,o);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(h,o){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(h===void 0||!(h instanceof HTMLElement)||h.tagName!=="INPUT"||h.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;o=o||function(){},h.addEventListener("change",function(a){if(!a.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let r=new FileReader;r.readAsArrayBuffer(a.target.files[0]),r.onload=function(c){o(s.Uint8(new Uint8Array(c.target.result)))}})},Base64:function(h){let o=function(c){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(c=c.replace(/^.*?base64,/,""),c=String(c).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(c))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");c+="==".slice(2-(3&c.length));let i,f="",l,d,p=0;for(;p<c.length;)i=n.indexOf(c.charAt(p++))<<18|n.indexOf(c.charAt(p++))<<12|(l=n.indexOf(c.charAt(p++)))<<6|(d=n.indexOf(c.charAt(p++))),f+=l===64?String.fromCharCode(i>>16&255):d===64?String.fromCharCode(i>>16&255,i>>8&255):String.fromCharCode(i>>16&255,i>>8&255,255&i);return f}(h=String(h));var a=o.length;let r=new Uint8Array(new ArrayBuffer(a));for(let c=0;c<a;c++)r[c]=o.charCodeAt(c);return s.Uint8(r)},Uint8:function(r){let o={data:null,pointer:0,movePointer:function(l){return this.pointer+=l,this.pointer},readInt:function(l){if((l=Math.min(l,this.data.byteLength-this.pointer))<1)return-1;let d=0;if(1<l)for(let p=1;p<=l-1;p++)d+=this.data.getUint8(this.pointer)*Math.pow(256,l-p),this.pointer++;return d+=this.data.getUint8(this.pointer),this.pointer++,d},readStr:function(l){let d=new Uint8Array(l),p=!1,y;d.forEach(($,k)=>{d[k]=this.readInt(1)});for(let $=0;$<e.length;$++)if(!p)try{if(y=e[$].decode(d),$==0)for(let k=0;k<y.length;k++){let w=y.charCodeAt(k);if(w>191||w>127&&w<160)throw new RangeError(`Invalid code point: ${w}`)}p=!0,console.debug(`String byte sequence in ${e[$].encoding}`)}catch(k){console.debug(`SMF string ${k}`)}return y||"String byte sequence read failed."},backOne:function(){this.pointer--},readIntVLV:function(){let l=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)l=this.readInt(1);else{let p=[];for(;128<=this.data.getUint8(this.pointer);)p.push(this.readInt(1)-128);var d=this.readInt(1);for(let y=1;y<=p.length;y++)l+=p[p.length-y]*Math.pow(128,y);l+=d}return l}};if(o.data=new DataView(r.buffer,r.byteOffset,r.byteLength),o.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;o.readInt(4);let a={};a.formatType=o.readInt(2),a.tracks=o.readInt(2),a.track=[];var r=o.readInt(1),c=o.readInt(1);128<=r?(a.timeDivision=[],a.timeDivision[0]=r-128,a.timeDivision[1]=c):a.timeDivision=256*r+c;for(let l=1;l<=a.tracks;l++){a.track[l-1]={event:[]};var n,i=o.readInt(4);if(i===-1)break;if(i!==1297379947)return!1;o.readInt(4);let d=0,p=!1,y,$;for(;!p&&(d++,a.track[l-1].event[d-1]={},a.track[l-1].event[d-1].deltaTime=o.readIntVLV(),(y=o.readInt(1))!==-1);)if(128<=y?$=y:(y=$,o.movePointer(-1)),y===255){a.track[l-1].event[d-1].type=255,a.track[l-1].event[d-1].metaType=o.readInt(1);var f=o.readIntVLV();switch(a.track[l-1].event[d-1].metaType){case 47:case-1:p=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:a.track[l-1].event[d-1].data=o.readStr(f);break;case 33:case 89:case 81:a.track[l-1].event[d-1].data=o.readInt(f);break;case 84:a.track[l-1].event[d-1].data=[],a.track[l-1].event[d-1].data[0]=o.readInt(1),a.track[l-1].event[d-1].data[1]=o.readInt(1),a.track[l-1].event[d-1].data[2]=o.readInt(1),a.track[l-1].event[d-1].data[3]=o.readInt(1),a.track[l-1].event[d-1].data[4]=o.readInt(1);break;case 88:a.track[l-1].event[d-1].data=[],a.track[l-1].event[d-1].data[0]=o.readInt(1),a.track[l-1].event[d-1].data[1]=o.readInt(1),a.track[l-1].event[d-1].data[2]=o.readInt(1),a.track[l-1].event[d-1].data[3]=o.readInt(1);break;default:this.customInterpreter!==null&&(a.track[l-1].event[d-1].data=this.customInterpreter(a.track[l-1].event[d-1].metaType,o,f)),this.customInterpreter!==null&&a.track[l-1].event[d-1].data!==!1||(o.readInt(f),a.track[l-1].event[d-1].data=o.readInt(f),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch((y=y.toString(16).split(""))[1]||y.unshift("0"),a.track[l-1].event[d-1].type=parseInt(y[0],16),a.track[l-1].event[d-1].channel=parseInt(y[1],16),a.track[l-1].event[d-1].type){case 15:this.customInterpreter!==null&&(a.track[l-1].event[d-1].data=this.customInterpreter(a.track[l-1].event[d-1].type,o,!1)),this.customInterpreter!==null&&a.track[l-1].event[d-1].data!==!1||(n=o.readIntVLV(),a.track[l-1].event[d-1].data=o.readInt(n),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:a.track[l-1].event[d-1].data=[],a.track[l-1].event[d-1].data[0]=o.readInt(1),a.track[l-1].event[d-1].data[1]=o.readInt(1);break;case 12:case 13:a.track[l-1].event[d-1].data=o.readInt(1);break;case-1:p=!0;break;default:if(this.customInterpreter!==null&&(a.track[l-1].event[d-1].data=this.customInterpreter(a.track[l-1].event[d-1].metaType,o,!1)),this.customInterpreter===null||a.track[l-1].event[d-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return a},customInterpreter:null};if(typeof St<"u")St.exports=s;else{let h=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;h.MidiParser=s}})()});R();R();var K,Pt,ot=(Pt=class{constructor(){v(this,K,{})}addEventListener(u,e){t(this,K)[u]||(t(this,K)[u]=[]),t(this,K)[u].unshift(e)}removeEventListener(u,e){if(t(this,K)[u]){let s=t(this,K)[u].indexOf(e);s>-1&&t(this,K)[u].splice(s,1),t(this,K)[u].length<1&&delete t(this,K)[u]}}dispatchEvent(u,e){var o;let s=new Event(u),h=this;s.data=e,((o=t(this,K)[u])==null?void 0:o.length)>0&&t(this,K)[u].forEach(function(a){try{a==null||a.call(h,s)}catch(r){console.error(r)}}),this[`on${u}`]&&this[`on${u}`](s)}},K=new WeakMap,Pt);R();R();var It=function(u,e){let s=Math.min(u.length,e.length),h=u.slice(0,s),o=e.slice(0,s),a=0,r=0;for(;r<s&&a==0;)a=Math.sign(h[r]-o[r]),r++;return a},ne=function(u=""){this.name=u,this.pool=[],this.point=function(e,s=!1){if(this.pool.length>0){let h=this.pool.length,o=1<<Math.floor(Math.log2(h)),a=o,r=64;for(;o>=1&&r>=0;){if(r<=0)throw new Error("TTL reached.");if(a==h)a-=o;else{let n=It(e,this.pool[a]);switch(n){case 0:{r=0;break}case 1:{a+o<=h&&(a+=o);break}case-1:{a!=0&&(a-=o);break}default:console.warn(`Unexpected result ${n}.`)}}o=o>>1,r--}let c=!0;if(a>=this.pool.length)c=!1;else{let n=this;this.pool[a].forEach(function(i,f,l){c&&i!=e[f]&&(c=!1)}),!c&&It(e,this.pool[a])>0&&a++}return c||s?a:-1}else return s?0:-1},this.add=function(e,s){return e.data=s,this.pool.splice(this.point(e,!0),0,e),this},this.default=function(e){console.warn(`No match in "${this.name||"(unknown)"}" for "${e}". Default action not defined.`)},this.get=function(e){let s=this.point(e);if(s>-1)return this.pool[s].data;this.default(e)},this.run=function(e,...s){let h=this.point(e);h>-1?e.subarray?this.pool[h].data(e.subarray(this.pool[h].length),...s):this.pool[h].data(e.slice(this.pool[h].length),...s):this.default(e,...s)}};R();var ya=["MSB","PRG","LSB"],pt=function(u){let e=Math.floor(u/10),s=u%10;return`${e.toString(16)}${s}`},z,At,bt=(At=class{constructor(...u){v(this,z,void 0);C(this,"strictMode",!1);this.loadFiles(...u)}get(u=0,e=0,s=0,h){let o=[u,e,s],a,r=Array.from(arguments);switch(h){case"xg":{switch(u){case 0:{s==126?r[2]=125:s==127&&(r[2]=0);break}case 32:{r[2]+=4;break}case 33:case 35:case 36:{r[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:r[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{s==126&&(r[2]=0);break}case 48:case 64:case 126:case 127:{s==126&&(r[2]=0);break}}break}case"gs":{u==0&&s<5?r[2]=0:u>125&&s<5&&s!=2&&(r[2]=u,r[0]=0);break}case"g2":case"sd":{(u>>1==40||u>95&&u<100)&&(r[2]|=16);break}case"sg":{u==8&&s==0&&(r[2]=5);break}case"s90es":{s<8?r[2]+=17:s<32?r[2]+=13:r[2]=(r[2]>>3)+19;break}case"motif":{s<8?r[2]+=28:s<32?r[2]+=13:r[2]=(r[2]>>3)+19;break}}let c=" ",n="M",i=0,f=0;switch(r[0]){case 0:{r[2]==127?n="MT-a":r[2]==126?n="MT-b":r[2]==7?n="GM-k":r[2]==5?n="SG-a":r[2]==4?n="SP-l":r[2]==0||h=="gs"&&r[2]<5?n="GM-a":(n="y",i=3);break}case 8:{h=="sg"?n="GM-s":n="r:";break}case 48:{n=`yM${(r[2]>>3).toString().padStart(2,"0")}`,i=1;break}case 56:{n="GM-b";break}case 61:case 120:{n="rDrm";break}case 62:{n="kDrm";break}case 63:{if(r[2]<17){let y=r[2];n=y<10?"kP:":"kC:",n+=y%10}else r[2]<34?n=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][r[2]-17]:n="Ds";break}case 64:{n="ySFX";break}case 67:{n="DX:S";break}case 80:case 81:case 82:case 83:{n=`Prg${"UABC"[r[0]-80]}`;break}case 88:case 89:case 90:case 91:{n=`Cmb${"UABC"[r[0]-88]}`;break}case 95:{n=`${["DR","PC"][r[2]]}-d`;break}case 96:{n=r[2]==106?"AP-a":r[2]>>4==1?"SDg":"PF",r[2]>63?f=63:r[2]>>4==1&&(f=16),i=3;break}case 97:{n=r[2]>>4==1?"SDa":"VL:",i=3,r[2]>>4==1?f=16:f=112;break}case 98:{n=r[2]>>4==1?"SDb":"SG-a",i=3,f=16;break}case 99:{n=r[2]>>4==1?"SDc":"DX",r[2]>63?f=63:r[2]>>4==1&&(f=16),i=3;break}case 100:{n="AN",r[2]>63?f=63:r[2]>>4==1&&(f=16),i=3;break}case 104:case 105:case 106:case 107:{n="SDd",f=104;break}case 121:{n=`GM-${r[2]?"":"a"}`,i=3;break}case 122:{n="lDrm";break}case 126:{n="yDrS";break}case 127:{r[2]==127?n="rDrm":n="yDrm";break}default:r[0]<48?n="r:":n="M"}n.length<4&&(n+=`${[u,s,r[0],r[2]][i]-f}`.padStart(4-n.length,"0")),h=="xg"&&u==16&&(a=`Voice${(s*128+e+1).toString().padStart(3,"0")}`,c=" ");let l=[r[0],r[1],r[2]];for(;!((a==null?void 0:a.length)>=0);)a=t(this,z)[r[1]||0][(r[0]<<7)+r[2]],a||(this.strictMode?(a="",c="?"):t(this,z)[r[1]||0][r[0]<<7]?r[0]==0?(r[2]=0,c="^"):r[2]<1?(r[0]=0,c="*"):(r[2]--,c="^"):u==48?(r[0]=0,r[2]=0,c="!"):u==62?(r[1]--,c=" ",r[1]<1&&!(a!=null&&a.length)&&(r[0]=0,c="!")):u<63?r[0]==0?(r[2]=0,c="^"):r[2]<1?(r[0]=0,c="*"):r[2]--:u==80?(a=`PrgU:${e.toString().padStart(3,"0")}`,c="!"):u==88?(a=`CmbU:${e.toString().padStart(3,"0")}`,c="!"):u==121?(a=`GM2Vox0${s}`,c="#"):u==122?(r[1]==32?r[1]==0:r[1]%=7,a=t(this,z)[r[1]||0][(r[0]<<7)+r[2]],a?c=" ":(a="",c="*")):r[1]==0?(a=`${u.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")} ${s.toString().padStart(3,"0")}`,c="!"):r[0]==0?(r[2]=0,c="^"):r[2]>0?r[2]--:r[1]>0?(r[1]=0,c="!"):(r[0]=0,c="?"));let d=[r[0],r[1],r[2]];(h=="gs"||h=="ns5r")&&c=="^"&&(c=" "),u==127&&c=="^"&&(c=" "),c!=" "&&self.debugMode&&(a="");let p="??";switch(r[0]){case 0:{r[2]==0?p="GM":r[2]==5||r[2]==7?p="KG":r[2]<126?p="XG":r[2]==127&&(p="MT");break}case 48:{p="MU";break}case 56:{p="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{p="AI";break}case 62:case 82:case 90:{p="XD";break}case 63:{r[2]<17?p="KR":r[2]<34?p="ES":p="DS";break}case 64:case 126:{p="XG";break}case 67:case 99:{p=r[2]>>4==1?"SD":"DX";break}case 81:{p="RW";break}case 95:{p=["DR","PC"][r[2]];break}case 96:{p=r[2]==106?"AP":r[2]>>4==1?"SD":"PF";break}case 97:{p=r[2]>>4==1?"SD":"VL";break}case 98:{p=r[2]>>4==1?"SD":"SG";break}case 100:{p="AN";break}case 104:case 105:case 106:case 107:{p="SD";break}case 120:{p="GS";break}case 121:{p=r[2]?"G2":"GM";break}case 122:{p="KG";break}case 127:{p=r[2]==127?"MT":e==0?"GM":"XG";break}default:r[0]<48&&(r[0]==16&&h=="xg"?p="XG":p="GS")}return{name:a||`${pt(u||0)} ${pt(e||0)} ${pt(s||0)}`,iid:l,eid:d,sid:o,ending:c,sect:n,standard:p}}async load(u,e,s){let h=this,o=[],a=0,r=0;u.split(`
`).forEach(function(c,n){let i=c.split("	"),f=[];n==0?i.forEach(function(l,d){o[ya.indexOf(l)]=d}):i.forEach(async function(l,d){var p;d>2?(t(h,z)[f[o[1]]]=t(h,z)[f[o[1]]]||[],(!((p=t(h,z)[f[o[1]]][(f[o[0]]<<7)+f[o[2]]])!=null&&p.length)||e)&&(t(h,z)[f[o[1]]][(f[o[0]]<<7)+f[o[2]]]=i[3],a++),r++):f.push(parseInt(i[d]))})}),e||console.debug(`Map "${s||"(internal)"}": ${r} total, ${a} loaded.`)}clearRange(u){let e=u.prg!=null?u.prg.constructor==Array?u.prg:[u.prg,u.prg]:[0,127],s=u.msb!=null?u.msb.constructor==Array?u.msb:[u.msb,u.msb]:[0,127],h=u.lsb!=null?u.lsb.constructor==Array?u.lsb:[u.lsb,u.lsb]:[0,127];for(let o=s[0];o<=s[1];o++){let a=o<<7;for(let r=h[0];r<=h[1];r++){let c=a+r;for(let n=e[0];n<=e[1];n++)delete t(this,z)[n][c]}}}init(){E(this,z,[]);for(let u=0;u<128;u++)t(this,z).push([""])}async loadFiles(...u){this.init();let e=this;u.forEach(async function(s,h){try{await fetch(`./data/bank/${s}.tsv`).then(function(o){return o.text()}).then(o=>{e.load(o,!1,s)})}catch(o){console.error(`Failed loading "${s}.tsv".`)}})}},z=new WeakMap,At);R();R();var Xe,Ut,Lt=(Ut=class{constructor(){v(this,Xe,{});C(this,"context")}set(u,e){t(this,Xe)[u]=e}has(u){return!!t(this,Xe)[u]}async read(u,e){if(!this.has(u))throw new Error(`No decoder registered for "${u}"`);return await t(this,Xe)[u].call(this.context||this,e)}},Xe=new WeakMap,Ut);var ma=function(u,e){let s=!0;return e.forEach((h,o)=>{s=s&&u[o]==h}),s},Bt=function(u){let e=0;return u.forEach(s=>{e*=256,e+=s}),e},Ze=new TextDecoder,lt=new Lt;lt.set("s7e",async function(u){let e=new Uint8Array(await u.slice(0,65536).arrayBuffer()),s="MSB	LSB	PRG	NME",h=[0,0,0,0],o=32,a=0,r=0,c=!0,n=[],i=0;for(;c;){let f=e.subarray(a);([()=>{Ze.decode(f.subarray(0,4))=="YSFC"?(a+=80,r=1):a++},()=>{if(ma(f.subarray(0,4),h))n.forEach((l,d,p)=>{let y=Bt(e.subarray(l.start+4,l.start+8));l.length=y}),r=2;else{let l=Ze.decode(f.subarray(0,4)),d=Bt(f.subarray(4,8));n.push({type:l,start:d}),a+=8}},()=>{let l=n[i],d=e.subarray(l.start,l.start+l.length),p=32;switch(l.type){case"ENVC":{let y=o;for(;y<d.length;){let $=d.subarray(y,y+p),k=Ze.decode($.subarray(0,10)).trimEnd();k.slice(0,5)=="Init "&&(k=""),k&&(s+=`
063	${($[17]+13).toString().padStart(3,"0")}	${$[19].toString().padStart(3,"0")}	${k}`),y+=p}break}case"EDVC":{let y=o;for(;y<d.length;){let $=d.subarray(y,y+p),k=Ze.decode($.subarray(0,10)).trimEnd();k.slice(0,5)=="Init "&&(k=""),k&&(s+=`
063	024	${$[19].toString().padStart(3,"0")}	${k}`),y+=p}break}case"EPVC":{let y=32,$=o;for(;$<d.length;){let k=d.subarray($,$+y),w=Ze.decode(k.subarray(0,10)).trimEnd();w=="----------"&&(w=""),w&&(s+=`
063	${(k[17]+1).toString().padStart(3,"0")}	${k[19].toString().padStart(3,"0")}	${w}`),$+=y}break}}i++,i>=n.length&&(r=3,c=!1)}][r]||(()=>{c=!1}))()}return s});R();var Je=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),et=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],Ea=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],Fe=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],Nt=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],Ht=function(u){let e=.1,s=-.3;return u>66?(e=5,s=315):u>56?(e=1,s=47):u>46&&(e=.5,s=18.5),e*u-s},Gt=function(u){return u>105?Ea[u-106]:u>100?u*1.1-100:u/10},_t=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),gt={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,うぃ
we,うぇ
wo,を
nga,ガ
ngi,ギ
ngu,グ
nge,ゲ
ngo,ゴ
ngy,ギ!
ng,
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,いぇ
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(u=>{let e=u.split(",");gt[e[0]]=e[1]});var Xt=function(u){let e=u;u[0]=="*"&&(e=e.slice(1)),["aa","ii","uu","ee","oo"].forEach(h=>{for(;e.indexOf(h)>-1;)e=e.replace(h,h[0])});for(let h in gt)e=e.replaceAll(h,gt[h]);e.indexOf("ん")==0&&e.length>1&&(e=e.slice(1));let s=e.indexOf("!");return s>-1&&e.length>1&&(e=e.slice(s+1)),e},Ft=function(u){return u?u<96?`cc${u}`:["aftertouch","velocity","pitch bend"][u-96]:"off"};R();var yt=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],Vt=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],Kt=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var va={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},$a={66307:["drive"],66309:["vowel",u=>"aiueo"[u]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",u=>["off","LPF","HPF"][u]],94984:["noise type",u=>["white","pink"][u]],94987:["disc type",u=>["LP","SP","EP","RND"]],94990:["hum type",u=>`${u+5}0Hz`],94993:["M/S",u=>["mono","stereo"][u]]},mt=function(u){return va[(u[0]-32<<8)+u[1]]||`0x${u[0].toString(16).padStart(2,"0")}${u[1].toString(16).padStart(2,"0")}`},zt=function(u,e,s){let h=(u[0]-32<<16)+(u[1]<<8)+e,o=$a[h]||{},a=o[0];if(a!=null&&a.length)return a+=`: ${(o[1]||function(){})(s)||s}`,a},Et=[68,48,95,78,41,3,110,122,0];R();var q=function(u=64){return Math.round(2e3*Math.log10(u/64))/100},qt=function(u,e,s){let h=[],o=s==!1?e.readIntVLV():s;u==0||u==127;for(let a=0;a<o;a++){let r=e.readInt(1);if(h.push(r),r!=247){if(r!=240){if(r>127)return console.debug(`Early termination: ${h}`),h.pop(),e.backOne(),e.backOne(),new Uint8Array(h)}}}return new Uint8Array(h)},vt=function(u){let e=0;return u.forEach(s=>{e+=s,e=e&127}),~e+1&127},ce=function(u,e){let s=0,h=0;for(let o=0;o<u.length;o++){let a=o%8-1,r=(h>>a&1)<<7,c=u[o];c+=r,o%8!=0?(e(c,s,u),s++):h=u[o]}},tt=function(u){let e=Math.floor(u*14.2);return e<128?e:0};var he=["?","gm","gs","xg","g2","mt32","ns5r","x5d","05rw","sd","k11","sg","krs","s90es","motif"],jt=[[0,0,0,0,121,0,0,82,81,97,0,0,63,63,63],[0,0,4,0,0,127,0,0,0,0,0,0,0,0,0]],Me=[120,127,120,127,120,127,61,62,62,105,120,122,122,127],wa=[0,3,81,84,88],Qt={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},$t={0:0,1:1,2:3,5:4},Wt=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],Yt=[36,37],ft=[20,21,22,23,24,25,26,28,29,30,31,36,37,64,65],at=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,128,12,13,16,17,18,19],ka=[12,13,16,17,18,19],Sa=[33,99,100,32,102,8,9,10],Zt=[0,16,25,40,32,64,26,48],S={};he.forEach((u,e)=>{S[u]=e});var g={length:at.length};at.forEach((u,e)=>{g[u]=e});var kt={length:ft.length};ft.forEach((u,e)=>{kt[u]=e});var j=function(){return!!self.Bun||self.debugMode||!1},xa=function(u){let e=[],s=0;return u==null||u.forEach(function(h,o){h==247?e.push(u.subarray(s,o)):h==240&&(s=o+1)}),e.length||e.push(u.subarray(0)),j()&&console.debug(e),e};var m={ch:128,cc:at.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,ace:8,drm:8,dpn:ft.length,dnc:128,efx:7},O,Q,oe,pe,Z,ue,ea,U,H,M,b,be,D,L,J,B,G,ve,le,Re,x,Ve,rt,de,$e,re,Ke,we,W,ze,ke,ee,P,Oe,qe,je,fe,Se,Qe,se,I,st,wt,Y,ge,xe,_,De,N,it,dt,Pe,Ie,te,ae,ye,Ae,Ue,Le,Jt,dr=(Jt=class extends ot{constructor(){super();v(this,Z);C(this,"NOTE_IDLE",0);C(this,"NOTE_ATTACK",1);C(this,"NOTE_DECAY",2);C(this,"NOTE_SUSTAIN",3);C(this,"NOTE_HELD",4);C(this,"NOTE_RELEASE",5);C(this,"NOTE_SOSTENUTO_ATTACK",8);C(this,"NOTE_SOSTENUTO_DECAY",9);C(this,"NOTE_SOSTENUTO_SUSTAIN",10);C(this,"NOTE_SOSTENUTO_HELD",11);C(this,"CH_MELODIC",0);C(this,"CH_DRUMS",1);C(this,"CH_DRUM1",2);C(this,"CH_DRUM2",3);C(this,"CH_DRUM3",4);C(this,"CH_DRUM4",5);C(this,"CH_DRUM5",6);C(this,"CH_DRUM6",7);C(this,"CH_DRUM7",8);C(this,"CH_DRUM8",9);v(this,O,0);v(this,Q,0);v(this,oe,0);v(this,pe,new Array(11));v(this,U,new Uint8Array(m.ch));v(this,H,new Uint8Array(m.ch));v(this,M,new Uint8Array(m.ch));v(this,b,new Uint8Array(m.ch*m.cc));v(this,be,new Uint8Array(m.ace));v(this,D,new Uint8Array(m.ch));v(this,L,new Uint8Array(m.ch*m.nn));v(this,J,new Uint8Array(m.ch));v(this,B,new Uint16Array(m.pl));v(this,G,new Uint8Array(m.pl));v(this,ve,new Int16Array(m.ch));v(this,le,new Uint8Array(m.ch));v(this,Re,0);v(this,x,new Uint8Array(m.ch*m.rpn));v(this,Ve,new Int8Array(m.ch*Yt.length));v(this,rt,new Uint8Array(m.drm*m.dpn*m.dnc));v(this,de,new Uint8Array(m.ch));v(this,$e,new Uint8Array(128));v(this,re,new Uint8Array(m.cmt*8));v(this,Ke,new Uint8Array(1024));v(this,we,new Uint8Array(m.cmt*64));v(this,W,new Uint8Array(m.efx*3));v(this,ze,new Uint8Array(m.ch));v(this,ke,0);v(this,ee,0);v(this,P,100);v(this,Oe,0);v(this,qe,500);v(this,je,0);v(this,fe,"");v(this,Se,0);v(this,Qe,0);v(this,se,!0);v(this,I,!1);v(this,st,void 0);v(this,wt,new Uint8Array(2));v(this,Y,[]);v(this,ge,new Uint8Array(m.ch));v(this,xe,new Uint8Array(m.tr));C(this,"baseBank",new bt("gm","gm2","xg","gs","ns5r","sd","gmega","plg-150vl","plg-150pf","plg-150dx","plg-150an","plg-150dr","plg-100sg","kross","s90es"));C(this,"userBank",new bt("gm"));C(this,"initOnReset",!1);C(this,"aiEfxName","");v(this,_,[]);v(this,De,void 0);v(this,N,{nOff:(e,s)=>{let h=e*128+s,o=t(this,B).lastIndexOf(h);o>-1&&(t(this,b)[m.cc*e+g[64]]>63?(t(this,G)[o]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:s,velo:t(this,L)[h],state:this.NOTE_HELD})):t(this,b)[m.cc*e+g[66]]>63&&t(this,G)[o]==this.NOTE_SOSTENUTO_SUSTAIN?(t(this,G)[o]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:s,velo:t(this,L)[h],state:this.NOTE_SOSTENUTO_HELD})):(t(this,B)[o]=0,t(this,L)[h]=0,t(this,G)[o]=this.NOTE_IDLE,this.dispatchEvent("note",{part:e,note:s,velo:0,state:this.NOTE_IDLE})))},nOn:(e,s,h)=>{let o=e*128+s,a=0;for(t(this,J)[e]&&t(this,N).ano(e);t(this,G)[a]>0&&t(this,B)[a]!=o;)a++;a<m.pl?(t(this,B)[a]=o,t(this,L)[o]=h,t(this,G)[a]=this.NOTE_SUSTAIN,t(this,le)[e]<h&&(t(this,le)[e]=h),this.dispatchEvent("note",{part:e,note:s,velo:h,state:this.NOTE_SUSTAIN})):console.error("Polyphony exceeded.")},nAt:(e,s,h)=>{},cAt:(e,s)=>{},hoOf:e=>{t(this,G).forEach((s,h)=>{if(s==this.NOTE_HELD){let o=t(this,B)[h],a=o>>7;e==a&&(t(this,G)[h]=this.NOTE_IDLE,t(this,B)[h]=0,t(this,L)[o]=0,this.dispatchEvent("note",{part:e,note:o&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{t(this,G).forEach((s,h)=>{let o;switch(s){case this.NOTE_ATTACK:{o=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{o=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{o=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(o){t(this,G)[h]=o;let a=t(this,B)[h];this.dispatchEvent("note",{part:e,note:a&127,velo:t(this,L)[a],state:o})}})},soOf:e=>{t(this,G).forEach((s,h)=>{if(s==this.NOTE_SOSTENUTO_HELD){let o=t(this,B)[h],a=o>>7;e==a&&(t(this,G)[h]=this.NOTE_IDLE,t(this,B)[h]=0,t(this,L)[o]=0,this.dispatchEvent("note",{part:e,note:o&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{t(this,B).forEach((s,h,o)=>{let a=s>>7,r=s&127;s==0&&t(this,L)[0]==0||a==e&&t(this,N).nOff(a,r)})}});v(this,it,{8:function(e){let s=e.channel,h=e.data[0];t(this,N).nOff(s,h)},9:function(e){let s=e.channel;t(this,U)[s]=1;let h=e.data[0],o=e.data[1];o>0?t(this,N).nOn(s,h,o):t(this,N).nOff(s,h)},10:function(e){let s=e.channel,h=s*128+e.data[0];t(this,B).indexOf(h)>-1&&(t(this,L)[h]=data[1],this.dispatchEvent("note",{part:s,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let s=e.channel;[0,32].indexOf(e.data[0])>-1&&(()=>{switch(t(this,O)){case S.s90es:case S.motif:{if(e.data[0]==0){[0,63].indexOf(e.data[1])>-1&&(t(this,U)[s]=1);break}e.data[1]&&(t(this,U)[s]=1);break}default:{t(this,U)[s]=1;break}}})();let h=s*m.cc;switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{t(this,N).ano(s),t(this,ve)[s]=0;let o=s*m.cc;t(this,b)[o+g[1]]=0,t(this,b)[o+g[5]]=0,t(this,b)[o+g[64]]=0,t(this,b)[o+g[65]]=0,t(this,b)[o+g[66]]=0,t(this,b)[o+g[67]]=0,t(this,b)[o+g[11]]=127,t(this,b)[o+g[101]]=127,t(this,b)[o+g[100]]=127,t(this,b)[o+g[99]]=127,t(this,b)[o+g[98]]=127;return}case 123:{t(this,N).ano(s);return}case 124:{t(this,N).ano(s);return}case 125:{t(this,N).ano(s);return}case 126:{t(this,J)[s]=1,t(this,N).ano(s);return}case 127:{t(this,J)[s]=0,t(this,N).ano(s);return}}if(g[e.data[0]]==null)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(ka.indexOf(e.data[0])>-1&&this.allocateAce(e.data[0]),e.data[0]){case 0:{switch(j()&&console.debug(`${he[t(this,O)]}, CH${s+1}: ${e.data[1]}`),t(this,O)==0?e.data[1]<48?(t(this,M)[s]>0&&(e.data[1]=t(this,b)[h],e.data[1]=120,console.debug(`Forced channel ${s+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]==62?this.switchMode("x5d"):e.data[1]==63?this.switchMode("krs"):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg"):t(this,O)==S.gs?e.data[1]<56&&t(this,M)[s]>0&&(e.data[1]=t(this,b)[h],e.data[1]=120,console.debug(`Forced channel ${s+1} to stay drums.`)):t(this,O)==S.gm?e.data[1]<48?t(this,M)[s]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${s+1} to stay drums.`)):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg",!0):t(this,O)==S.x5d&&e.data[1]>0&&e.data[1]<8&&this.switchMode("05rw",!0),t(this,O)){case S.xg:{[126,127].indexOf(e.data[1])>-1?t(this,M)[s]==0&&(this.setChType(s,this.CH_DRUM2),console.debug(`CH${s+1} set to drums by MSB.`)):t(this,M)[s]>0&&(this.setChType(s,this.CH_MELODIC),console.debug(`CH${s+1} set to melodic by MSB.`));break}case S["05rw"]:case S.x5d:case S.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?t(this,M)[s]==0&&(this.setChType(s,this.CH_DRUM2),console.debug(`CH${s+1} set to drums by MSB.`)):t(this,M)[s]>0&&(this.setChType(s,this.CH_MELODIC),console.debug(`CH${s+1} set to melodic by MSB.`));break}case S.sd:{[104,105,106,107].indexOf(e.data[1])>-1?t(this,M)[s]==0&&(this.setChType(s,this.CH_DRUM2),console.debug(`CH${s+1} set to drums by MSB.`)):t(this,M)[s]>0&&(this.setChType(s,this.CH_MELODIC),console.debug(`CH${s+1} set to melodic by MSB.`));break}case S.g2:{e.data[1]==120?t(this,M)[s]==0&&(this.setChType(s,this.CH_DRUMS),console.debug(`CH${s+1} set to drums by MSB.`)):t(this,M)[s]>0&&(this.setChType(s,this.CH_MELODIC),console.debug(`CH${s+1} set to melodic by MSB.`));break}}this.dispatchEvent("voice",{part:s});break}case 6:{if(t(this,Re)){[S.xg,S.gs,S.ns5r].indexOf(t(this,O))<0&&console.warn(`NRPN commits are not available under "${he[t(this,O)]}" mode, even when they are supported in Octavia.`);let o=t(this,b)[h+g[99]],a=t(this,b)[h+g[98]];if(o==1){let r=Sa.indexOf(a);if(r>-1)t(this,b)[h+g[71+r]]=e.data[1],j()&&console.debug(`Redirected NRPN 1 ${a} to cc${71+r}.`),this.dispatchEvent("cc",{part:s,cc:71+r,data:e.data[1]});else{let c=Yt.indexOf(a);c>-1?t(this,Ve)[s*10+c]=e.data[1]-64:console.warn(`NRPN 0x01${a.toString(16).padStart(2,"0")} is not supported.`),j()&&console.debug(`CH${s+1} voice NRPN ${a} commit`)}}else{if(ft.indexOf(o)<0){let c=`NRPN 0x${o.toString(16).padStart(2,"0")}${a.toString(16).padStart(2,"0")} `;o==127?console.warn(`${c}is not necessary. Consider removing it.`):console.warn(`${c}is not supported.`)}else{let c=t(this,M)[s]-2;c<0?console.warn(`CH${s+1} cannot accept drum NRPN as type ${et[t(this,M)[s]]}.`):t(this,rt)[(c*m.dpn+kt[o])*m.dnc+a]=e.data[1]-64}j()&&console.debug(`CH${s+1} (${et[t(this,M)[s]]}) drum NRPN ${o} commit`)}}else{let o=$t[t(this,b)[h+g[100]]];t(this,b)[h+g[101]]==0&&o!=null&&(j()&&console.debug(`CH${s+1} RPN 0 ${t(this,b)[h+g[100]]} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],Wt[o][0]),Wt[o][1]),t(this,x)[s*m.rpn+o]=e.data[1])}break}case 32:{switch(j()&&console.debug(`${he[t(this,O)]}, CH${s+1} LSB: ${e.data[1]}`),t(this,O)){case S.s90es:case S.motif:{this.setChType(s,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,t(this,O),!0);break}}this.dispatchEvent("voice",{part:s});break}case 38:{t(this,Re)||t(this,b)[h+101]==0&&$t[t(this,b)[h+100]]!=null&&(t(this,x)[s*m.rpn+$t[t(this,b)[h+100]]+1]=e.data[1]);break}case 64:{e.data[1]<64&&t(this,N).hoOf(s);break}case 66:{e.data[1]>>6?t(this,N).soOn(s):t(this,N).soOf(s);break}case 98:case 99:{E(this,Re,1);break}case 100:case 101:{E(this,Re,0);break}}t(this,b)[h+g[e.data[0]]]=e.data[1],this.dispatchEvent("cc",{part:s,cc:e.data[0],data:e.data[1]})}},12:function(e){let s=e.channel;switch(t(this,O)){case S.s90es:case S.motif:{e.data&&(t(this,U)[s]=1);break}default:t(this,U)[s]=1}t(this,D)[s]=e.data,t(this,de)[s]=0,j()&&console.debug(`T:${e.track} C:${s} P:${e.data}`),this.dispatchEvent("voice",{part:s})},13:function(e){let s=this,h=e.channel;t(this,B).forEach(function(o){let a=o>>7;h==a&&(t(s,L)[o]=e.data,s.dispatchEvent("note",{part:h,note:o&127,velo:e.data,state:s.NOTE_SUSTAIN}))})},14:function(e){let s=e.channel;t(this,ve)[s]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:s,pitch:this.getPitchShift(s)})},15:function(e){xa(e.data).forEach(s=>{let h=s[0],o=s[1];(t(this,dt)[h]||function(){console.debug(`Unknown manufacturer ${h}.`)})(o,s.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(t(this,_)[e.meta]||function(h,o,a){}).call(this,e.data,e.track,e.meta),e.meta!=32&&E(this,Oe,0);let s=wa.indexOf(e.meta)>-1;if(j()&&console.debug(e),s)return e.reply="meta",e}});v(this,dt,{64:(e,s,h)=>{t(this,Ae).run(s,h,e)},65:(e,s,h)=>{if(s[0]<16)if(s[1]==72){let o=s[s.length-1],a=vt(s.subarray(3,s.length-1));o==a?t(this,ae).run(s.subarray(0,s.length-1),h,e):console.warn(`Bad SD checksum ${o}. Should be ${a}.`)}else t(this,ae).run(s,h,e);else{let o=s[s.length-1],a=vt(s.subarray(2,s.length-1));o==a?t(this,ae).run(s.subarray(0,s.length-1),h,e):console.warn(`Bad GS checksum ${o}. Should be ${a}.`)}},66:(e,s,h)=>{t(this,ye).run(s,h,e)},67:(e,s,h)=>{t(this,te).run(s,h,e)},68:(e,s,h)=>{t(this,Le).run(s,h,e)},71:(e,s,h)=>{t(this,Ue).run(s,h,e)},126:(e,s,h)=>{t(this,Pe).run(s,h,e)},127:(e,s,h)=>{this.switchMode("gm"),t(this,Ie).run(s,h,e)}});v(this,Pe,void 0);v(this,Ie,void 0);v(this,te,void 0);v(this,ae,void 0);v(this,ye,void 0);v(this,Ae,void 0);v(this,Ue,void 0);v(this,Le,void 0);let e=this;E(this,Z,new Uint8Array(256),ea),t(this,pe)[10]=new Uint8Array(512),E(this,De,new ne),this.userBank.strictMode=!0,this.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),this.addEventListener("metacommit",function(a){var c,n;let{data:r}=a;((c=t(e,Y)[0])==null?void 0:c.type)==r.type&&((n=t(e,Y)[0])!=null&&n.amend)?(t(e,Y)[0].amend=r.amend,t(e,Y)[0].data+=r.data):t(e,Y).unshift(r)}),t(this,_)[1]=function(a){var r,c,n,i,f;switch(a=a.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),a.slice(0,2)){case"@I":{E(this,I,!0),this.dispatchEvent("metacommit",{type:"Kar.Info",data:(r=a.slice(2))==null?void 0:r.trimLeft()});break}case"@K":{E(this,I,!0),this.dispatchEvent("metacommit",{type:"Kar.Mode",data:(c=a.slice(2))==null?void 0:c.trimLeft()}),console.debug(`Karaoke mode active: ${a.slice(2)}`);break}case"@L":{E(this,I,!0),this.dispatchEvent("metacommit",{type:"Kar.Lang",data:(n=a.slice(2))==null?void 0:n.trimLeft()});break}case"@T":{E(this,I,!0),this.dispatchEvent("metacommit",{type:"KarTitle",data:(i=a.slice(2))==null?void 0:i.trimLeft()});break}case"@V":{E(this,I,!0),this.dispatchEvent("metacommit",{type:"Kar.Ver.",data:(f=a.slice(2))==null?void 0:f.trimLeft()});break}case"XF":{let l=a.slice(2).split(":");switch(l[0]){case"hd":{l.slice(1).forEach((d,p)=>{d.length&&this.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][p],data:d})});break}case"ln":{l.slice(1).forEach((d,p)=>{d.length&&this.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][p],data:d})});break}default:this.dispatchEvent("metacommit",{type:"XfUnData",data:a})}break}default:t(this,I)?a[0]=="\\"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:a.slice(1),amend:!0})):a[0]=="/"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:a.slice(1),mask:!0,amend:!0})):this.dispatchEvent("metacommit",{type:"KarLyric",data:a,amend:!0}):a.split(`
`).forEach((l,d)=>{this.dispatchEvent("metacommit",{type:"Cmn.Text",data:l,mask:d!=0})})}},t(this,_)[2]=function(a){this.dispatchEvent("metacommit",{type:"Copyrite",data:a})},t(this,_)[3]=function(a,r){r<1&&t(this,Oe)<1&&this.dispatchEvent("metacommit",{type:"TrkTitle",data:a})},t(this,_)[4]=function(a,r){this.dispatchEvent("metacommit",{type:"Instrmnt",data:a})},t(this,_)[5]=function(a){a.trim()==""?this.dispatchEvent("metacommit",{type:"C.Lyrics",data:"",amend:!1}):this.dispatchEvent("metacommit",{type:"C.Lyrics",data:a,amend:!0})},t(this,_)[6]=function(a){this.dispatchEvent("metacommit",{type:"C.Marker",data:a})},t(this,_)[7]=function(a){this.dispatchEvent("metacommit",{type:"CuePoint",data:a})},t(this,_)[32]=function(a){E(this,Oe,a[0]+1)},t(this,_)[33]=function(a,r){t(e,xe)[r]=a+1},t(this,_)[81]=function(a,r){E(e,qe,a/1e3)},t(this,_)[127]=function(a,r){t(e,De).run(a,r)},t(this,De).default=function(a){console.warn(`Unrecognized sequencer-specific byte sequence: ${a}`)},t(this,De).add([67,0,1],function(a,r){t(e,xe)[r]=a[0]+1}),E(this,Pe,new ne("universal non-realtime")),E(this,Ie,new ne("universal realtime")),E(this,te,new ne("Yamaha")),E(this,ae,new ne("Roland")),E(this,ye,new ne("Korg")),E(this,Ae,new ne("Kawai")),E(this,Ue,new ne("Akai")),E(this,Le,new ne("Casio"));let s=function(a){console.info(`Unrecognized SysEx in "${this.name}" set.
%o`,a)};t(this,Pe).default=s,t(this,Ie).default=s,t(this,te).default=s,t(this,ae).default=s,t(this,ye).default=s,t(this,Ae).default=s,t(this,Ue).default=s,t(this,Le).default=s,t(this,Pe).add([9],a=>{e.switchMode(["gm","?","g2"][a[0]-1],!0),E(e,I,t(e,I)||!1),console.info(`MIDI reset: ${["GM","Init","GM2"][a[0]-1]}`),a[0]==2&&e.init()}),t(this,Ie).add([4,1],a=>{E(e,P,((a[1]<<7)+a[0])/16383*100),e.dispatchEvent("mastervolume",t(e,P))}).add([4,3],a=>((a[1]<<7)+a[0]-8192)/8192).add([4,4],a=>a[1]-64),t(this,te).add([76,0,0],a=>{switch(a[0]){case 125:{console.info(`XG drum setup reset: ${a}`);break}case 126:{e.switchMode("xg",!0),E(e,I,!1),console.info("MIDI reset: XG");break}default:{let r=[0,0,0,0],c=(n,i)=>{r[i]=n};if(a.subarray(1).forEach((n,i)=>{let f=i+a[0];([c,c,c,c,l=>{E(this,P,l*129/16383*100),e.dispatchEvent("mastervolume",t(e,P))},l=>{},l=>{}][f]||(()=>{}))(n,i)}),a[0]<4){let n=0;r.forEach(i=>{n=n<<4,n+=i}),n-=1024}}}}).add([76,2,1],a=>{let r="XG ";a[0]<32?(r+="reverb ",a.subarray(1).forEach((c,n)=>{([i=>{e.setEffectTypeRaw(0,!1,i),console.info(`${r}main type: ${Je[i]}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},i=>{e.setEffectTypeRaw(0,!0,i),console.debug(`${r}sub type: ${i+1}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},i=>{console.debug(`${r}time: ${Ht(i)}s`)},i=>{console.debug(`${r}diffusion: ${i}`)},i=>{console.debug(`${r}initial delay: ${i}`)},i=>{console.debug(`${r}HPF cutoff: ${Fe[i]}Hz`)},i=>{console.debug(`${r}LPF cutoff: ${Fe[i]}Hz`)},i=>{console.debug(`${r}width: ${i}`)},i=>{console.debug(`${r}height: ${i}`)},i=>{console.debug(`${r}depth: ${i}`)},i=>{console.debug(`${r}wall type: ${i}`)},i=>{console.debug(`${r}dry/wet: ${i}`)},i=>{console.debug(`${r}send: ${q(i)}dB`)},i=>{console.debug(`${r}pan: ${i-64}`)},!1,!1,i=>{console.debug(`${r}delay: ${i}`)},i=>{console.debug(`${r}density: ${i}`)},i=>{console.debug(`${r}balance: ${i}`)},i=>{},i=>{console.debug(`${r}feedback: ${i}`)},i=>{}][a[0]+n]||function(){console.warn(`Unknown XG reverb address: ${a[0]}.`)})(c)})):a[0]<64?(r+="chorus ",a.subarray(1).forEach((c,n)=>{([i=>{e.setEffectTypeRaw(1,!1,i),console.info(`${r}main type: ${Je[i]}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},i=>{e.setEffectTypeRaw(1,!0,i),console.debug(`${r}sub type: ${i+1}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},i=>{console.debug(`${r}LFO: ${Nt[i]}Hz`)},i=>{},i=>{console.debug(`${r}feedback: ${i}`)},i=>{console.debug(`${r}delay offset: ${Gt(i)}ms`)},i=>{},i=>{console.debug(`${r}low: ${Fe[i]}Hz`)},i=>{console.debug(`${r}low: ${i-64}dB`)},i=>{console.debug(`${r}high: ${Fe[i]}Hz`)},i=>{console.debug(`${r}high: ${i-64}dB`)},i=>{console.debug(`${r}dry/wet: ${i}`)},i=>{console.debug(`${r}send: ${q(i)}dB`)},i=>{console.debug(`${r}pan: ${i-64}`)},i=>{console.debug(`${r}to reverb: ${q(i)}dB`)},!1,i=>{},i=>{},i=>{},i=>{console.debug(`${r}LFO phase diff: ${(i-64)*3}deg`)},i=>{console.debug(`${r}input mode: ${i?"stereo":"mono"}`)},i=>{}][a[0]-32+n]||function(){console.warn(`Unknown XG chorus address: ${a[0]}.`)})(c)})):a[0]<86?(r+="variation ",a.subarray(1).forEach((c,n)=>{([i=>{e.setEffectTypeRaw(2,!1,i),console.info(`${r}main type: ${Je[i]}`),e.dispatchEvent("efxdelay",e.getEffectType(2))},i=>{e.setEffectTypeRaw(2,!0,i),console.debug(`${r}sub type: ${i+1}`),e.dispatchEvent("efxdelay",e.getEffectType(2))}][a[0]-64+n]||function(){})(c)})):a[0]<97?(r+="variation ",a.subarray(1).forEach((c,n)=>{[i=>{console.debug(`${r}send: ${q(i)}dB`)},i=>{console.debug(`${r}pan: ${i-64}`)},i=>{console.debug(`${r}to reverb: ${q(i)}dB`)},i=>{console.debug(`${r}to chorus: ${q(i)}dB`)},i=>{console.debug(`${r}connection: ${i?"system":"insertion"}`)},i=>{console.debug(`${r}channel: CH${i+1}`)},i=>{console.debug(`${r}mod wheel: ${i-64}`)},i=>{console.debug(`${r}bend wheel: ${i-64}`)},i=>{console.debug(`${r}channel after touch: ${i-64}`)},i=>{console.debug(`${r}AC1: ${i-64}`)},i=>{console.debug(`${r}AC2: ${i-64}`)}][a[0]-86+n](c)})):a[0]>111&&a[0]<118?r+="variation ":console.warn(`Unknown XG variation address: ${a[0]}`)}).add([76,2,64],a=>{a.subarray(1).forEach((r,c)=>{let n=c+a[0];if(n==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][r]}`);else{let i=n-1>>2,f=n-1&3,l=`XG EQ ${i} ${["gain","freq","Q","shape"][f]}: `;[()=>{console.debug(`${l}${r-64}dB`)},()=>{console.debug(`${l}${r} (raw)`)},()=>{console.debug(`${l}${r/10}`)},()=>{console.debug(`${l}${["shelf","peak"][+!!r]}`)}][f]()}})}).add([76,3],a=>{let r=a[0],c=a[1],n=`XG Insertion ${a[0]+1} `;a.subarray(2).forEach((i,f)=>{([l=>{e.setEffectTypeRaw(3+r,!1,l),console.info(`${n}main type: ${Je[l]}`),e.dispatchEvent(`efxinsert${r}`,e.getEffectType(3+r))},l=>{e.setEffectTypeRaw(3+r,!0,l),console.debug(`${n}sub type: ${l+1}`),e.dispatchEvent(`efxinsert${r}`,e.getEffectType(3+r))}][c+f]||function(){})(i)})}).add([76,6,0],a=>{let r=a[0];r<64?e.setLetterDisplay(a.subarray(1),"XG letter display",r):E(e,Se,Date.now())}).add([76,7,0],a=>{let r=a[0];E(e,Q,0),E(e,oe,Date.now()+3200),t(e,Z,ue).fill(0);let c=a.subarray(1);for(let n=0;n<r;n++)c.unshift(0);c.forEach(function(n,i){let f=Math.floor(i/16),l=i%16,d=(l*3+f)*7,p=7,y=0;for(d-=l*5,f==2&&(p=2);y<p;)t(e,Z,ue)[d+y]=n>>6-y&1,y++})}).add([76,8],(a,r)=>{let c=e.chRedir(a[0],r,!0),n=a[1],i=m.cc*c,f=`XG CH${c+1} `,l=`Unknown XG part address ${n}.`;a.subarray(2).forEach((d,p)=>{n<1?console.debug(l):n<41?([()=>{t(e,b)[i+g[0]]=d},()=>{t(e,b)[i+g[32]]=d},()=>{t(e,D)[c]=d},()=>{let y=e.chRedir(d,r,!0);t(e,H)[c]=y,c!=y&&(e.buildRchTree(),console.info(`${f}receives from CH${y+1}`))},()=>{t(e,J)[c]=+!d},()=>{},()=>{e.setChType(c,d,S.xg),console.debug(`${f}type: ${et[d]||d}`)},()=>{t(e,x)[m.rpn*c+3]=d},!1,!1,()=>{t(e,b)[i+g[7]]=d},!1,!1,()=>{t(e,b)[i+g[10]]=d||128},!1,!1,()=>{t(e,b)[i+g[128]]=d},()=>{t(e,b)[i+g[93]]=d},()=>{t(e,b)[i+g[91]]=d},()=>{t(e,b)[i+g[94]]=d},()=>{t(e,b)[i+g[76]]=d},()=>{t(e,b)[i+g[77]]=d},()=>{t(e,b)[i+g[78]]=d},()=>{t(e,b)[i+g[74]]=d},()=>{t(e,b)[i+g[71]]=d},()=>{t(e,b)[i+g[73]]=d},()=>{t(e,b)[i+g[75]]=d},()=>{t(e,b)[i+g[72]]=d}][n+p-1]||(()=>{}))():n<48?console.debug(l):n<111?n>102&&n<105&&(t(e,b)[i+g[[5,65][n&1]]]=d):n<114?console.debug(l):n<116?console.debug(`${f}EQ ${["bass","treble"][n&1]} gain: ${d-64}dB`):n<118?console.debug(l):n<120?console.debug(`${f}EQ ${["bass","treble"][n&1]} freq: ${d}`):console.debug(l)})}).add([76,9],(a,r)=>{let c=e.chRedir(a[0],r,!0),n=a[1],i=`PLG-150VL CH${c+1} `;a.subarray(2).forEach((f,l)=>{let d=l+n;switch(d){case 1:{console.info(`${i}breath mode: ${["system","breath","velocity","touch EG"][f]}`);break}case 0:case 27:case 28:break;default:if(d<27){let p=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][d-3>>1];d&1?d<23?(console.debug(`${i}${p} control source: ${Ft(f)}`),f&&f<96&&e.allocateAce(f)):console.debug(`${i}${p} scale break point: ${f}`):console.debug(`${i}${p} depth: ${f-64}`)}}})}).add([76,10],a=>{}).add([76,16],a=>{}).add([76,17,0,0],a=>{}).add([76,112],a=>{console.debug(`XG enable PLG-1${["50VL","00SG","50DX"][a[0]]} for CH${a[2]+1}.`)}).add([73,0,0],(a,r)=>{let c=a[0],n="MU1000 System: ";a.subarray(1).forEach((i,f)=>{let l=c+f;l==8?console.debug(`${n}LCD contrast set to ${i}.`):l==18?(E(e,ee,i?126:0),console.debug(`${n}bank defaults to ${i?"MU100 Native":"MU Basic"}.`)):l>=64&&l<69&&[()=>{e.dispatchEvent("channelactive",i)},()=>{i<8?(e.dispatchEvent("channelmin",i<<4),console.debug(`Octavia System: Minimum CH${(i<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{i<8?(e.dispatchEvent("channelmax",(i<<4)+15),console.debug(`Octavia System: Maximum CH${(i<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{E(e,se,!!i),console.info(`Octavia System: RS receiving ${["dis","en"][i]}abled.`)}][l-64]()})}).add([73,10,0],(a,r)=>{let c=a[0],n=`MU1000 RS${t(e,se)?"":" (ignored)"}: `;if(c<16)switch(c){case 2:{let i=e.chRedir(0,r,!0);t(e,se)&&(e.dispatchEvent("channelmin",i),e.dispatchEvent("channelmax",i+63)),console.info(`${n}Show CH1~64`);break}case 3:{let i=e.chRedir(a[1]<<5,r,!0);t(e,se)&&e.dispatchEvent("channelmin",i),t(e,se)&&e.dispatchEvent("channelmax",i+31),console.info(`${n}Show CH${i+1}~CH${i+32}`);break}default:console.debug(`${n}unknown switch ${c} invoked.`)}else if(c<32){if(t(e,se)){let i=e.chRedir(c-16+(t(e,Qe)<<4),r,!0);e.dispatchEvent("channelactive",i)}}else if(c<36){let i=e.chRedir(c-32<<4,r,!0);t(e,se)&&(e.dispatchEvent("channelmin",i),e.dispatchEvent("channelmax",i+15),E(e,Qe,c-32)),console.info(`${n}Show CH${i+1}~CH${i+16}`)}}).add([93,3],(a,r)=>{let c=e.chRedir(a[0],r,!0),n=`PLG-100SG CH${c+1} `,i=Date.now();if(a[1]==0){let f="",l=0;a.subarray(2).forEach((d,p)=>{p%2==0?f+=_t[d]||d.toString().padStart("0"):l+=d*13}),i>=t(e,je)&&this.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"SGLyrics",data:`${Xt(f)}`,amend:!0}),E(e,je,i+Math.ceil(l/2)+t(e,qe)),j()&&console.debug(`${n}vocals: ${f}`)}else console.warn(`Unknown PLG-100SG data: ${a}`)}),t(this,te).add([76,48],a=>{}).add([76,49],a=>{}).add([76,50],a=>{}).add([76,51],a=>{}),t(this,te).add([89,0],(a,r,c)=>{if(e.eprom){let n=a[0],i=(a[1]<<14)+(a[2]<<7)+a[3]+(e.eprom.offset||0);j()&&console.debug(`MU1000 EPROM trail to 0x${i.toString(16).padStart(6,"0")}, ${n} bytes.`);let f=e.eprom.data;a.subarray(4).forEach((l,d)=>{let p=d>>3,y=d&7;if(y==7)for(let $=0;$<7;$++)f[i+7*p+$]+=(l>>6-$&1)<<7;else f[i+7*p+y]=l})}}).add([89,1],(a,r,c)=>{let n=(a[0]<<21)+(a[1]<<14)+(a[2]<<7)+a[3];j()&&console.debug(`MU1000 EPROM jump to 0x${n.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=n)}).add([89,2],(a,r,c)=>{if(e.eprom){let n=(a[0]<<21)+(a[1]<<14)+(a[2]<<7)+a[3]+(e.eprom.offset||0);j()&&console.debug(`MU1000 EPROM write to 0x${n.toString(16).padStart(6,"0")}.`);let i=e.eprom.data;a.subarray(4).forEach((f,l)=>{let d=l>>3,p=l&7;if(p==7)for(let y=0;y<7;y++)i[n+7*d+y]+=(f>>6-y&1)<<7;else i[n+7*d+p]=f})}}).add([89,3],(a,r,c)=>{}),t(this,te).add([39,48],(a,r,c)=>{}).add([43,0,0],(a,r,c)=>{let n=[0,0,0,0],i=(f,l)=>{n[l]=f};if(a.subarray(1).forEach((f,l)=>{let d=l+a[0];[i,i,i,i,()=>{E(this,P,f*129/16383*100),e.dispatchEvent("mastervolume",t(e,P))},()=>f-64,()=>f||128,()=>f,()=>f,()=>{console.debug(`TG300 variation on cc${f}.`)}][d](f,d)}),a[0]<4){let f=0;n.forEach(l=>{f=f<<4,f+=l}),f-=1024}}).add([43,1,0],(a,r,c)=>{}).add([43,2],(a,r,c)=>{let n=e.chRedir(a[0],r,!0),i=a[1],f=m.cc*n,l=`TG300 CH${n+1} `;a.subarray(2).forEach((d,p)=>{p<5?([()=>{},()=>{t(e,b)[f+g[0]]=d},()=>{t(e,b)[f+g[32]]=d},()=>{t(e,D)[n]=d},()=>{let y=e.chRedir(d,r,!0);t(e,H)[n]=y,n!=y&&(e.buildRchTree(),console.info(`${l}receives from CH${y+1}`))}][p+i]||(()=>{}))(d,p+i):p<21||(p<47?([()=>{t(e,J)[n]=+!d},()=>{},()=>{},()=>{t(e,x)[m.rpn*n+3]=d},()=>{},()=>{t(e,b)[f+g[7]]=d},!1,!1,()=>{t(e,b)[f+g[10]]=d||128},!1,!1,()=>{console.debug(`${l} AC1 at cc${d}`)},()=>{console.debug(`${l} AC2 at cc${d}`)},()=>{t(e,b)[f+g[128]]=d},()=>{t(e,b)[f+g[93]]=d},()=>{t(e,b)[f+g[91]]=d},()=>{t(e,b)[f+g[94]]=d},()=>{t(e,b)[f+g[76]]=d},()=>{t(e,b)[f+g[77]]=d},()=>{t(e,b)[f+g[74]]=d},()=>{t(e,b)[f+g[71]]=d},()=>{t(e,b)[f+g[73]]=d},()=>{t(e,b)[f+g[75]]=d},()=>{t(e,b)[f+g[72]]=d},()=>{t(e,b)[f+g[78]]=d}][p+i-21]||(()=>{}))(d,p+i):p<95||([()=>{t(e,b)[f+g[65]]=d},()=>{t(e,b)[f+g[5]]=d}][p+i-95]||(()=>{}))(d,p+i))})}).add([43,7,0],(a,r,c)=>{let n=a[0];e.setLetterDisplay(a.subarray(1),"TG300 letter display",n)}).add([43,7,1],(a,r,c)=>{E(e,Q,0),E(e,oe,Date.now()+3200),t(e,Z,ue).fill(0),a.forEach(function(n,i){let f=Math.floor(i/16),l=i%16,d=(l*3+f)*7,p=7,y=0;for(d-=l*5,f==2&&(p=2);y<p;)t(e,Z,ue)[d+y]=n>>6-y&1,y++})}),t(this,ae).add([66,18,0,0,127],(a,r,c)=>{e.switchMode("gs",!0),t(e,b)[m.cc*9]=120,t(e,b)[m.cc*25]=120,t(e,b)[m.cc*41]=120,t(e,b)[m.cc*57]=120,E(e,ee,3),E(e,I,!1),t(e,ge).fill(0),console.info(`GS system to ${["single","dual"][a[0]]} mode.`)}).add([66,18,64,0],(a,r,c)=>{switch(a[0]){case 127:{e.switchMode("gs",!0),t(e,b)[m.cc*9]=120,t(e,b)[m.cc*25]=120,t(e,b)[m.cc*41]=120,t(e,b)[m.cc*57]=120,E(e,I,!1),t(e,ge).fill(0),console.info("MIDI reset: GS");break}default:{let n=[0,0,0,0],i=(f,l)=>{n[l]=f};if(a.subarray(1).forEach((f,l)=>{let d=l+a[0];[i,i,i,i,p=>{E(this,P,p*129/16383*100),e.dispatchEvent("mastervolume",t(e,P))},p=>{},p=>{}][d](f,l)}),a[0]<4){let f=0;n.forEach(l=>{f=f<<4,f+=l}),f-=1024}}}}).add([66,18,64,1],a=>{let r=a[0];if(r<16){let c="".padStart(r," ");a.subarray(1).forEach((n,i)=>{c+=String.fromCharCode(Math.max(32,n))}),c=c.padEnd(16," "),console.debug(`GS patch name: ${c}`)}else r<48||(r<65?a.subarray(1).forEach((c,n)=>{let i=`GS ${r+n>55?"chorus":"reverb"} `;([()=>{console.info(`${i}type: ${yt[c]}`),e.setEffectType(0,40,c),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${i}predelay: ${c}ms`)},()=>{console.info(`${i}type: ${Vt[c]}`),e.setEffectType(1,40,16+c),e.dispatchEvent("efxchorus",e.getEffectType(1))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${i}to reverb: ${q(c)}`)},()=>{console.debug(`${i}to delay: ${q(c)}`)}][r+n-48]||(()=>{}))()}):r<80?console.debug(`Unknown GS patch address: ${r}`):r<91?a.subarray(1).forEach((c,n)=>{let i="GS delay ";([()=>{console.info(`${i}type: ${Kt[c]}`),e.setEffectType(2,40,32+c),e.dispatchEvent("efxdelay",e.getEffectType(2))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${i}to reverb: ${q(c)}`)}][r+n-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${r}`))}).add([66,18,64,2],a=>{let r="GS EQ ";a.subarray(1).forEach((c,n)=>{([()=>{console.debug(`${r}low freq: ${[200,400][c]}Hz`)},()=>{console.debug(`${r}low gain: ${c-64}dB`)},()=>{console.debug(`${r}high freq: ${[3e3,6e3][c]}Hz`)},()=>{console.debug(`${r}high gain: ${c-64}dB`)}][a[0]+n]||function(){console.warn(`Unknown GS EQ address: ${a[0]+n}`)})()})}).add([66,18,64,3],a=>{let r="GS EFX ",c=function(n,i){let f=zt(t(e,W).subarray(10,12),i,n);f&&console.debug(`${r}${mt(t(e,W).subarray(10,12))} ${f}`)};a.subarray(1).forEach((n,i)=>{([()=>{e.setEffectTypeRaw(3,!1,32+n),e.dispatchEvent("efxinsert0",e.getEffectType(3))},()=>{e.setEffectTypeRaw(3,!0,n),console.info(`${r}type: ${mt(t(e,W).subarray(10,12))}`),e.dispatchEvent("efxinsert0",e.getEffectType(3))},!1,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,()=>{console.debug(`${r}to reverb: ${q(n)}dB`)},()=>{console.debug(`${r}to chorus: ${q(n)}dB`)},()=>{console.debug(`${r}to delay: ${q(n)}dB`)},!1,()=>{console.debug(`${r}1 source: ${n}`),n&&n<96&&e.allocateAce(n)},()=>{console.debug(`${r}1 depth: ${n-64}`)},()=>{console.debug(`${r}2 source: ${n}`),n&&n<96&&e.allocateAce(n)},()=>{console.debug(`${r}2 depth: ${n-64}`)},()=>{console.debug(`${r}to EQ: ${n?"ON":"OFF"}`)}][a[0]+i]||function(f,l){console.warn(`Unknown GS EFX address: ${l}`)})(n,a[0]+i)})}).add([66,18,65],a=>{}).add([69,18,16],a=>{var r;switch(a[0]){case 0:{let c=a[1];e.setLetterDisplay(a.subarray(2),"GS display text",c);break}case 32:{E(e,oe,Date.now()+3200),a[1]==0&&E(e,Q,Math.max(Math.min(a[2]-1,9),0));break}default:if(a[0]<11){t(e,Q)>9&&E(e,Q,0),E(e,oe,Date.now()+3200),(r=t(e,pe)[a[0]-1])!=null&&r.length||(t(e,pe)[a[0]-1]=new Uint8Array(256));let c=t(e,pe)[a[0]-1],n=a[1];c.fill(0);let i=a.subarray(2);for(let f=0;f<n;f++)i.unshift(0);i.forEach(function(f,l){let d=Math.floor(l/16),p=l%16,y=(p*4+d)*5,$=5,k=0;for(y-=p*4,d==3&&($=1);k<$;)c[y+k]=f>>4-k&1,k++})}else console.warn(`Unknown GS display section: ${a[0]}`)}});let h=function(a,r,c){let n=a[0],i=m.cc*r,f=m.rpn*r,l=`GS CH${r+1} `;n<3?a.subarray(1).forEach((d,p)=>{[()=>{t(e,b)[i+g[0]]=d},()=>{t(e,D)[r]=d},()=>{let y=e.chRedir(d,c,!0);t(e,H)[r]=y,r!=y&&(e.buildRchTree(),console.info(`${l}receives from CH${y+1}`))}][n+p]()}):n<19||(n<44?a.subarray(1).forEach((d,p)=>{([()=>{t(e,J)[r]=+!d},!1,()=>{e.setChType(r,d<<1,S.gs),console.debug(`${l}type: ${d?"drum ":"melodic"}${d||""}`)},()=>{t(e,x)[f+3]=d},!1,()=>{t(e,b)[i+g[7]]=d},!1,!1,()=>{t(e,b)[i+g[10]]=d||128},!1,!1,()=>{console.debug(`${l}CC 1: cc${d}`)},()=>{console.debug(`${l}CC 2: cc${d}`)},()=>{t(e,b)[i+g[93]]=d},()=>{t(e,b)[i+g[91]]=d},!1,!1,()=>{t(e,x)[f+1]=d},()=>{t(e,x)[f+2]=d},()=>{t(e,b)[i+g[94]]=d}][n+p-19]||(()=>{}))()}):n<76||console.debug(`Unknown GS part address: ${n}`))},o=function(a,r){let c=a[0],n=`GS CH${r+1} `;c<2?a.subarray(1).forEach((i,f)=>{[()=>{t(e,b)[m.cc*r+g[32]]=i},()=>{}][c+f]()}):c<32?console.warn(`Unknown GS misc address: ${c}`):c<35?a.subarray(1).forEach((i,f)=>{[()=>{console.debug(`${n}EQ: o${["ff","n"][i]}`)},()=>{},()=>{console.debug(`${n}EFX: o${["ff","n"][i]}`),t(e,ze)[r]=i}][c+f-32]()}):console.warn(`Unknown GS misc address: ${c}`)};t(this,ae).add([66,18,64,16],(a,r)=>{h(a,e.chRedir(9,r,!0),r)}).add([66,18,64,17],(a,r)=>{h(a,e.chRedir(0,r,!0),r)}).add([66,18,64,18],(a,r)=>{h(a,e.chRedir(1,r,!0),r)}).add([66,18,64,19],(a,r)=>{h(a,e.chRedir(2,r,!0),r)}).add([66,18,64,20],(a,r)=>{h(a,e.chRedir(3,r,!0),r)}).add([66,18,64,21],(a,r)=>{h(a,e.chRedir(4,r,!0),r)}).add([66,18,64,22],(a,r)=>{h(a,e.chRedir(5,r,!0),r)}).add([66,18,64,23],(a,r)=>{h(a,e.chRedir(6,r,!0),r)}).add([66,18,64,24],(a,r)=>{h(a,e.chRedir(7,r,!0),r)}).add([66,18,64,25],(a,r)=>{h(a,e.chRedir(8,r,!0),r)}).add([66,18,64,26],(a,r)=>{h(a,e.chRedir(10,r,!0),r)}).add([66,18,64,27],(a,r)=>{h(a,e.chRedir(11,r,!0),r)}).add([66,18,64,28],(a,r)=>{h(a,e.chRedir(12,r,!0),r)}).add([66,18,64,29],(a,r)=>{h(a,e.chRedir(13,r,!0),r)}).add([66,18,64,30],(a,r)=>{h(a,e.chRedir(14,r,!0),r)}).add([66,18,64,31],(a,r)=>{h(a,e.chRedir(15,r,!0),r)}).add([66,18,64,64],(a,r)=>{o(a,e.chRedir(9,r,!0))}).add([66,18,64,65],(a,r)=>{o(a,e.chRedir(0,r,!0))}).add([66,18,64,66],(a,r)=>{o(a,e.chRedir(1,r,!0))}).add([66,18,64,67],(a,r)=>{o(a,e.chRedir(2,r,!0))}).add([66,18,64,68],(a,r)=>{o(a,e.chRedir(3,r,!0))}).add([66,18,64,69],(a,r)=>{o(a,e.chRedir(4,r,!0))}).add([66,18,64,70],(a,r)=>{o(a,e.chRedir(5,r,!0))}).add([66,18,64,71],(a,r)=>{o(a,e.chRedir(6,r,!0))}).add([66,18,64,72],(a,r)=>{o(a,e.chRedir(7,r,!0))}).add([66,18,64,73],(a,r)=>{o(a,e.chRedir(8,r,!0))}).add([66,18,64,74],(a,r)=>{o(a,e.chRedir(10,r,!0))}).add([66,18,64,75],(a,r)=>{o(a,e.chRedir(11,r,!0))}).add([66,18,64,76],(a,r)=>{o(a,e.chRedir(12,r,!0))}).add([66,18,64,77],(a,r)=>{o(a,e.chRedir(13,r,!0))}).add([66,18,64,78],(a,r)=>{o(a,e.chRedir(14,r,!0))}).add([66,18,64,79],(a,r)=>{o(a,e.chRedir(15,r,!0))}),t(this,ye).add([54,65],(a,r)=>{e.switchMode("x5d");let c=(a[1]<<7)+a[0],n=(a[3]<<7)+a[2],i=e.chRedir(c&15,r,!0),f=m.cc*i;[()=>{n<1||(n<101?(e.setChType(i,e.CH_MELODIC,S.x5d),t(e,D)[i]=n-1,t(e,b)[f+g[0]]=82):n<229?(e.setChType(i,e.CH_MELODIC,S.x5d),t(e,D)[i]=n-101,t(e,b)[f+g[0]]=56):(e.setChType(i,e.CH_DRUMS,S.x5d),t(e,D)[i]=Zt[n-229]||0,t(e,b)[f+g[0]]=62))},()=>{t(e,b)[f+g[7]]=n},()=>{n<31&&(t(e,b)[f+g[10]]=Math.round((n-15)*4.2+64))},()=>{t(e,b)[f+g[93]]=tt(n)},()=>{t(e,b)[f+g[91]]=tt(n)},()=>{t(e,x)[i*m.rpn+3]=n>8191?n-16320:64+n},()=>{t(e,x)[i*m.rpn+1]=n>8191?n-16320:64+n},()=>{n>0&&(t(e,x)[i*m.rpn]=n)},()=>{}][c>>4]()}).add([54,76,0],(a,r)=>{e.switchMode("x5d",!0);let c="",n=82,i=0,f=0,l="MSB	PRG	LSB	NME";ce(a,function(d,p){if(p<16400){let y=p%164;switch(!0){case y<10:{d>31&&(c+=String.fromCharCode(d));break}case y==11:{l+=`
${n}	${i}	${f}	${c.trim().replace("Init Voice","")}`,i++,c="";break}}i>99&&(n=90,i=0)}}),e.userBank.clearRange({msb:82,prg:[0,99],lsb:0}),e.userBank.load(l)}).add([54,77,0],(a,r)=>{e.switchMode("x5d",!0);let c="",n=90,i=0,f=0,l="MSB	PRG	LSB	NME";ce(a,function(d,p){if(p<13600){let y=p%136;switch(!0){case y<10:{d>31&&(c+=String.fromCharCode(d));break}case y==11:{l+=`
${n}	${i}	${f}	${c.trim().replace("Init Combi","")}`,i++,c="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(l)}).add([54,78],(a,r)=>{e.switchMode("x5d",!0),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][a[0]]} mode.`)}).add([54,85],(a,r)=>{e.switchMode("x5d",!0),ce(a,(c,n)=>{n>0&&n<3&&(e.setEffectType(n-1,44,c),e.dispatchEvent(`efx${["reverb","chorus"][n-1]}`,e.getEffectType(n-1)))})}).add([54,104],(a,r)=>{e.switchMode("x5d",!0),ce(a,function(c,n,i,f){if(n<192){let l=e.chRedir(Math.floor(n/12),r,!0),d=l*m.cc;switch(n%12){case 0:{c<128?(e.setChType(l,e.CH_MELODIC,S.x5d),t(e,b)[d+g[0]]=82,t(e,D)[l]=c):(e.setChType(l,e.CH_DRUMS,S.x5d),t(e,b)[d+g[0]]=62,t(e,D)[l]=Zt[c-128]),c>0&&(t(e,U)[l]=1);break}case 1:{t(e,b)[d+g[7]]=c;break}case 2:{t(e,x)[l*m.rpn+3]=c>127?c-192:64+c;break}case 3:{t(e,x)[l*m.rpn+1]=c>127?c-192:64+c;break}case 4:{c<31&&(t(e,b)[d+g[10]]=Math.round((c-15)*4.2+64));break}case 5:{let p=c>>4,y=c&15;t(e,b)[d+g[91]]=tt(y),t(e,b)[d+g[93]]=tt(p);break}case 10:break;case 11:{let p=e.chRedir(c&15,r,!0),y=c>>4;t(e,H)[l]=c,(p!=l||y)&&(console.info(`X5D Part CH${l+1} receives from CH${p+1}.`),e.buildRchTree())}}}else{let l=e.chRedir(n-192,r,!0)}})}),t(this,ae).add([22,18,127],a=>{e.switchMode("mt32",!0),E(e,I,!1),e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(a,r,c)=>{e.switchMode("mt32");let n=e.chRedir(c,r,!0),i=a[1];a.subarray(2).forEach((f,l)=>{let d=l+i;t(e,$e)[d+(n-1)*16]=f,([!1,()=>{let p=t(e,$e)[n-1<<4];if(p<3)if(t(e,de)[n]=1,p==2)for(let y=0;y<name.length;y++)t(e,re)[(n-1)*m.cmt+y]=t(e,we)[f*m.cmt+y];else{let y=e.baseBank.get(0,f+(p<<6),127,"mt32").name;for(let $=0;$<y.length;$++)t(e,re)[(n-1)*m.cmt+$]=y.charCodeAt($)}},()=>{t(e,x)[n*m.rpn+3]=f+40},()=>{t(e,x)[n*m.rpn+1]=f+14},()=>{t(e,x)[n*m.rpn]=f},!1,()=>{t(e,b)[m.cc*n+g[91]]=f?127:0},!1,()=>{t(e,b)[m.cc*n+g[7]]=f},()=>{t(e,b)[m.cc*n+g[10]]=Math.ceil(f*9.05)}][d]||(()=>{}))()})}).add([22,18,1],(a,r,c)=>{e.switchMode("mt32");let n=e.chRedir(c,r,!0)}).add([22,18,2],(a,r,c)=>{e.switchMode("mt32");let n=e.chRedir(c,r,!0),i=a[1]+(a[0]<<7);i<10&&(t(e,de)[n]=1),a.subarray(2).forEach((f,l)=>{let d=l+i;d<14&&(t(e,re)[(n-1)*m.cmt+d]=f)})}).add([22,18,3],(a,r,c)=>{if(e.switchMode("mt32"),a[0]){let n=a[1]-16}else{let n=a[1];a.subarray(2).forEach((i,f)=>{let l=f+n;t(e,$e)[l]=i;let d=e.chRedir(1+l>>4,r,!0),p=l&15;([!1,()=>{let y=t(e,$e)[d-1<<4];if(y<3)if(t(e,de)[d]=1,y==2)for(let $=0;$<name.length;$++)t(e,re)[(d-1)*m.cmt+$]=t(e,we)[i*m.cmt+$];else{let $=e.baseBank.get(0,i+(y<<6),127,"mt32").name;for(let k=0;k<$.length;k++)t(e,re)[(d-1)*m.cmt+k]=$.charCodeAt(k)}},()=>{t(e,x)[d*m.rpn+3]=i+40},()=>{t(e,x)[d*m.rpn+1]=i+14},()=>{t(e,x)[d*m.rpn]=i},!1,()=>{t(e,b)[m.cc*d+g[91]]=i?127:0},!1,()=>{t(e,b)[m.cc*d+g[7]]=i},()=>{t(e,b)[m.cc*d+g[10]]=Math.ceil(i*9.05)}][p]||(()=>{}))()})}}).add([22,18,4],(a,r,c)=>{e.switchMode("mt32");let n=a[1]+(a[0]<<7);a.subarray(2).forEach((i,f)=>{let l=f+n,d=e.chRedir(Math.floor(l/246+1),r,!0),p=l%246;p<14&&(t(e,re)[(d-1)*m.cmt+p]=i),p<10&&(t(e,de)[d]=1)})}).add([22,18,5],(a,r,c)=>{e.switchMode("mt32");let n=(a[0]<<7)+a[1];a.subarray(2).forEach((i,f)=>{let l=n+f,d=Math.floor(l/8),p=l&7,y=d*8;t(e,Ke)[l]=i,([!1,()=>{let $=t(e,Ke)[y];if($<3){let k="";if($==2){let w=m.cmt*d;k=`MT-m:${i.toString().padStart(3,"0")}`}else k=e.baseBank.get(0,i+($<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:d}),e.userBank.load(`MSB	LSB	PRG	NME
000	127	${d}	${k}`,!0)}}][p]||(()=>{}))()})}).add([22,18,8],(a,r,c)=>{e.switchMode("mt32");let n=((a[0]&1)<<7)+a[1];a.subarray(2).forEach((i,f)=>{let l=n+f;l<m.cmt&&(t(e,we)[(a[0]>>1)*m.cmt+l]=i)})}).add([22,18,16],(a,r,c)=>{e.switchMode("mt32");let n=a[1],i=!1,f=function(l,d){t(e,H)[d-12]=l,i=!0};a.subarray(2).forEach((l,d)=>{let p=d+n;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,f,f,f,f,f,f,f,f,f,()=>{E(e,P,l),e.dispatchEvent("mastervolume",t(e,P))}][p]||(()=>{}))(l,d)}),i&&e.buildRchTree()}).add([22,18,32],a=>{e.switchMode("mt32");let r=a[1],c=" ".repeat(r);a.subarray(2).forEach(n=>{n>31&&(c+=String.fromCharCode(n))}),E(e,fe,c.padStart(20," ")),E(e,Se,Date.now()+3200)}).add([22,18,82],(a,r)=>{let c=e.chRedir(0,r,!0);for(let n=0;n<16;n++)t(e,N).ano(c+n),n&&n<10&&(t(e,D)[c+n]=Et[n-1]);console.info("MT-32 alt reset complete.")}),t(this,ye).add([66,0],(a,r)=>{e.switchMode("ns5r",!0),E(e,I,!1),console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][a[0]]} mode.`)}).add([66,1],(a,r)=>{e.switchMode(["ns5r","05rw"][a[0]],!0),E(e,I,!1)}).add([66,18,0,0],(a,r)=>{let c=a[0];switch(c){case 124:case 126:case 127:{e.switchMode("ns5r",!0),E(e,I,!1);break}case 125:{console.info(`NS5R drum setup reset: ${a}`);break}default:if(c<10){let n=[0,0,0,0],i=(f,l)=>{n[l]=f};if(a.subarray(1).forEach((f,l)=>{[i,i,i,i,()=>{E(e,P,f*129/16383*100),e.dispatchEvent("mastervolume",t(e,P))},()=>f-64,()=>f-64,()=>{},()=>{},()=>{}][c+l]()}),a[0]<4){let f=0;n.forEach(l=>{f=f<<4,f+=l}),f-=1024}}}}).add([66,18,0,1],(a,r)=>{}).add([66,18,0,2],(a,r)=>{}).add([66,18,1],(a,r)=>{let c=e.chRedir(a[0],r,!0),n=c*m.cc,i=a[1],f=`NS5R CH${c+1} `;a.subarray(2).forEach((l,d)=>{let p=i+d;p<3?[()=>{t(e,b)[n+g[0]]=l||121},()=>{t(e,b)[n+g[32]]=l},()=>{t(e,D)[c]=l}][p]():p<8||(p<14?[()=>{let y=e.chRedir(l,r,!0);t(e,H)[c]=y,c!=y&&(e.buildRchTree(),console.info(`${f}receives from CH${y+1}`))},()=>{t(e,J)[c]=+!l},()=>{e.setChType(c,l,S.ns5r),console.debug(`${f}type: ${et[l]}`)},()=>{t(e,x)[m.rpn*c+3]=l},()=>{},()=>{}][p-8]():p<16||(p<33?[()=>{t(e,b)[n+g[7]]=l},()=>{t(e,b)[n+g[11]]=l},()=>{},()=>{},()=>{t(e,b)[n+g[10]]=l||128},()=>{},()=>{},()=>{t(e,b)[n+g[93]]=l},()=>{t(e,b)[n+g[91]]=l},()=>{t(e,b)[n+g[76]]=l},()=>{t(e,b)[n+g[77]]=l},()=>{t(e,b)[n+g[78]]=l},()=>{t(e,b)[n+g[74]]=l},()=>{t(e,b)[n+g[71]]=l},()=>{t(e,b)[n+g[73]]=l},()=>{t(e,b)[n+g[75]]=l},()=>{t(e,b)[n+g[72]]=l}][p-16]():p<112||p<114&&[()=>{t(e,b)[n+g[5]]=l},()=>{t(e,b)[n+g[65]]=l}][p-112]()))})}).add([66,18,8,0],(a,r)=>{let c=a[0];if(c<32)e.setLetterDisplay(a.subarray(1,33),"NS5R letter display");else{let n=c-32;E(e,oe,Date.now()+3200),E(e,Q,10),t(e,Z,ue).fill(0);let i=a.subarray(1),f=4;i.forEach(function(l,d){let p=d+n,y=p>>4,$=p&15;if(p<80){let k=y<f?l:l>>3,w=0,T=y<f?6:3;for(;k>0;)t(e,Z,ue)[$*32+y*7+(T-w)]=k&1,k=k>>1,w++}})}}).add([66,52],(a,r)=>{e.switchMode("ns5r",!0),E(e,I,!1);let c="";ce(a,(n,i)=>{i<8?(n>31&&(c+=String.fromCharCode(n)),i==7&&(e.aiEfxName=c)):i<10&&(e.setEffectType(i-8,44,n),e.dispatchEvent(`efx${["reverb","chorus"][i-8]}`,e.getEffectType(i-8)))})}).add([66,53],(a,r)=>{e.switchMode("ns5r",!0),E(e,I,!1),ce(a,function(c,n){switch(!0){case n<2944:{let i=e.chRedir(Math.floor(n/92),r,!0),f=i*m.cc;switch(n%92){case 0:{t(e,b)[f+g[0]]=c||121;break}case 1:{t(e,b)[f+g[32]]=c;break}case 2:{t(e,D)[i]=c,c>0&&(t(e,U)[i]=1);break}case 3:{let l=e.chRedir(c,r,!0);t(e,H)[i]=l,i!=l&&(console.info(`NS5R CH${i+1} receives from CH${l+1}.`),e.buildRchTree())}case 7:break;case 8:{t(e,x)[i*m.rpn+3]=c<40||c>88?c+(c>63?-192:64):c;break}case 9:case 10:{t(e,b)[f+g[7]]=c;break}case 11:{t(e,b)[f+g[11]]=c;break}case 14:{t(e,b)[f+g[10]]=c||128;break}case 19:{t(e,b)[f+g[93]]=c;break}case 20:{t(e,b)[f+g[91]]=c;break}case 84:{t(e,b)[f+g[65]]=c;break}case 85:{t(e,b)[f+g[5]]=c;break}}break}case n<3096:break;case n<3134:break;case n<8566:break}})}).add([66,54],(a,r)=>{e.switchMode("ns5r",!0);let c="",n=80,i=0,f=0,l="MSB	PRG	LSB	NME";ce(a,function(d,p){let y=p%158;switch(!0){case y<10:{d>31&&(c+=String.fromCharCode(d));break}case y==11:{n=d&127;break}case y==12:{f=d&127;break}case y==13:{l+=`
${n}	${i}	${f}	${c.trim().replace("Init Voice","")}`,i++,c="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(l)}).add([66,55],(a,r)=>{e.switchMode("ns5r",!0);let c="",n=88,i=0,f=0,l="MSB	PRG	LSB	NME";ce(a,function(d,p){let y=p%126;switch(!0){case y<10:{d>31&&(c+=String.fromCharCode(d));break}case y==11:break;case y==12:break;case y==13:{l+=`
${n}	${i}	${f}	${c.trim().replace("Init Combi","")}`,i++,c="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(l)}).add([66,125],a=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][a[0]]||"white")}).add([66,127],a=>{let r=new Uint8Array(5760);ce(a,(c,n,i)=>{if(n<720)for(let f=0;f<8;f++)r[n*8+f]=c>>7-f&1}),e.dispatchEvent("screen",{type:"ns5r",data:r})}).add([76],(a,r,c)=>{t(e,ye).run([66,...a],r,c)}),t(this,Ae).add([16,0,8,0],(a,r,c)=>{let n=(a[2]<<4)+a[3],i="K11 ";([()=>{e.switchMode("k11",!0),E(e,I,!1),E(e,ee,n?4:0),console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,n),console.debug(`${i}reverb type: ${n}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{console.debug(`${i}reverb time: ${n}`)},()=>{console.debug(`${i}reverb time: ${n}`)},()=>{console.debug(`${i}reverb predelay: ${n}`)},()=>{console.debug(`${i}reverb predelay: ${n}`)},()=>{console.debug(`${i}depth high: ${n}`)},()=>{console.debug(`${i}depth high: ${n}`)},()=>{console.debug(`${i}depth low: ${n}`)},()=>{console.debug(`${i}depth low: ${n}`)}][a[0]]||(()=>{}))()}).add([16,0,8,1],(a,r,c)=>{let n=e.chRedir(a[1],r,!0),i=m.cc*n,f=m.rpn*n,l=(a[3]<<4)+a[4],d=`K11 CH${n+1} `;([()=>{l<128?(e.setChType(n,e.CH_MELODIC,S.k11),t(e,b)[i+g[0]]=0,t(e,D)[n]=l):(e.setChType(n,e.CH_DRUMS,S.k11),t(e,D)[n]=l-128)},()=>{let p=e.chRedir(l,r,!0);t(e,H)[n]=p,n!=p&&(e.buildRchTree(),console.info(`${d}receives from CH${p+1}`))},()=>{t(e,b)[i+g[7]]=l},()=>{t(e,U)[n]=l},()=>{t(e,b)[i+g[10]]=l},()=>{t(e,x)[f+3]=l+40},()=>{t(e,x)[f+1]=l>>1,t(e,x)[f+2]=l&1},()=>{t(e,b)[i+g[91]]=l?127:0},()=>{},()=>{t(e,b)[i+g[74]]=l},()=>{t(e,b)[i+g[73]]=l},()=>{t(e,b)[i+g[72]]=l}][a[0]]||(()=>{}))()}).add([16,0,9,0],(a,r,c)=>{let n=(a[2]<<4)+a[3],i="GMLX ";([()=>{console.debug(`${i}reverb type: ${n}`)},()=>{console.debug(`${i}reverb time: ${n}`)},()=>{console.debug(`${i}reverb predelay: ${n}`)},()=>{console.debug(`${i}depth high: ${n}`)},()=>{console.debug(`${i}depth low: ${n}`)}][a[0]]||(()=>{}))()}).add([16,0,9,3],(a,r,c)=>{let n=(a[2]<<4)+a[3],i=e.chRedir(a[1],r,!0),f=i*m.cc;[()=>{n<128?(e.setChType(i,e.CH_MELODIC,S.k11),t(e,b)[f+g[0]]=0,t(e,b)[f+g[32]]=0,t(e,D)[i]=n):n<160?(e.setChType(i,e.CH_MELODIC,S.k11),t(e,b)[f+g[0]]=0,t(e,b)[f+g[32]]=7,t(e,D)[i]=n-100):(e.setChType(i,e.CH_DRUMS,S.k11),t(e,b)[f+g[0]]=122,t(e,b)[f+g[32]]=0,t(e,D)[i]=n-160)},()=>{let l=e.chRedir(n,r,!0);t(e,H)[i]=l,i!=l&&(e.buildRchTree(),console.info(`GMLX CH${i+1} receives from CH${l+1}`))}][a[0]]()}).add([16,0,9,4],(a,r,c)=>{let n=(a[2]<<4)+a[3],i=e.chRedir(a[1],r,!0),f=i*m.cc,l=i*m.rpn,d=`GMLX CH${i+1} `;[()=>{t(e,U)[i]=n},()=>{t(e,b)[f+g[7]]=n},()=>{t(e,b)[f+g[10]]=n},()=>{t(e,b)[f+g[91]]=n?127:0},()=>{t(e,x)[l+3]=n+40},()=>{t(e,x)[l+1]=n},()=>{t(e,x)[l]=n},()=>{}][a[0]]()}),t(this,Ue).add([66,93,64],(a,r,c)=>{let n=a[2];switch(a[0]){case 0:{switch(a[1]){case 4:{E(e,P,n*129/16383*100),e.dispatchEvent("mastervolume",t(e,P));break}case 5:{n-64;break}case 6:{console.debug(`SG global reverb: ${n?"on":"off"}`);break}case 127:{e.switchMode("sg",!0);break}}break}case 1:{switch(a[1]){case 48:{console.debug(`SG reverb type: ${yt[n]}`);break}}break}default:if(a[0]>>4==1){let i=e.chRedir(a[0]&15,r,!0);if(a[1]==2){let f=e.chRedir(n,r,!0);t(e,H)[i]=f,i!=f&&(e.buildRchTree(),console.info(`SG CH${i+1} receives from CH${f+1}`))}else a[1]==19&&(t(e,b)[m.cc*i+g[7]]=n)}else console.warn(`Unknown AKAI SG SysEx: ${a}`)}}),t(this,Le).add([9],(a,r,c)=>{console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremelo","phaser","rotary speaker","enhancer","flanger","EQ"][a[0]]||"off"}`)}),t(this,te).add([127,0],(a,r,c)=>{e.switchMode("motif");let n=new Uint8Array([127,1,...a]);t(e,te).run(n,r,c)}).add([127,1,0,0],(a,r,c)=>{e.switchMode("s90es");let n="S90/Motif ES system ",i=a[0];a.subarray(1).forEach((f,l)=>{([()=>{E(e,P,f*12900/16383),e.dispatchEvent("mastervolume",t(e,P))}][i+l]||(()=>{console.info(`Unrecognized ${n}ID: ${i+l}`)}))()})}).add([127,1,0,0,14],(a,r,c)=>{e.switchMode("s90es");let n="S90/Motif ES bulk header ",i=[];i[95]=(f,l,d)=>{console.debug(`${n}multi edit buffer: ${f[1]}`)},(i[a[0]]||(()=>{console.info(`Unrecognized ${n}ID: ${a[0]}.`)}))(a.subarray(1))}).add([127,1,0,0,15],(a,r,c)=>{e.switchMode("s90es");let n="S90/Motif ES bulk footer ",i=[];i[95]=(f,l,d)=>{console.debug(`${n}multi edit buffer: ${f[1]}`)},(i[a[0]]||(()=>{console.info(`Unrecognized ${n}ID: ${a[0]}.`)}))(a.subarray(1))}).add([127,1,0,58,55],(a,r,c)=>{e.switchMode("s90es");let n=e.chRedir(a[0],r,!0),i=m.cc*n,f=a[1],l=`S90/Motif ES bulk CH${n<16?n+1:"U"+(n-95)} `;console.debug(l,a),!(a[0]>15)&&a.subarray(2).forEach((d,p)=>{([()=>{t(e,b)[i+g[0]]=d},()=>{d&&(t(e,U)[n]=1),t(e,b)[i+g[32]]=d,e.setChType(n,[32,40].indexOf(d)>-1?e.CH_DRUMS:e.CH_MELODIC,t(e,O),!0)},()=>{d&&(t(e,U)[n]=1),t(e,D)[n]=d},()=>{let y=e.chRedir(d,r,!0);t(e,H)[n]=y,n!=y&&(e.buildRchTree(),console.info(`${l}receives from CH${y+1}`))},()=>{t(e,J)[n]=d?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{t(e,b)[i+g[7]]=d},()=>{t(e,b)[i+g[10]]=d},!1,!1,!1,()=>{t(e,b)[i+g[91]]=d},()=>{t(e,b)[i+g[93]]=d},()=>{t(e,b)[i+g[94]]=d},()=>{t(e,b)[i+g[128]]=d},()=>{},()=>{t(e,b)[i+g[74]]=d},()=>{t(e,b)[i+g[71]]=d},!1,()=>{t(e,b)[i+g[65]]=d},()=>{t(e,b)[i+g[5]]=d},()=>{}][f+p]||(()=>{}))()})}).add([127,1,54,16],(a,r,c)=>{e.switchMode("s90es");let n=a[0];a.subarray(1).forEach((i,f)=>{let d=`S90/Motif ES EQ${(f>>2)+1} `;([()=>{let p=i-64},()=>{let p=Fe[i]},()=>{let p=i/10},()=>{let p=i}][n+f&3]||(()=>{}))()})}),t(this,ae).add([0,72,18,0,0,0,0],(a,r,c)=>{e.switchMode("sd",!0),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(a,r,c)=>{let n=a[0]>>5,i=a[0]&31;switch(n){case 0:{console.debug(`Unknown SD-90 global effects message:
%o`,a);break}case 1:{let f=e.chRedir(i,r,!0),l=a[1],d=f*m.cc;a.subarray(2).forEach((p,y)=>{let $=l+y;$<37?([()=>{},()=>{},0,()=>{},()=>{switch(t(e,b)[d+g[0]]=p,p){case 104:case 105:case 106:case 107:case 120:{t(e,M)[f]||e.setChType(f,e.CH_DRUMS);break}default:t(e,M)[f]&&e.setChType(f,e.CH_MELODIC)}},()=>{t(e,b)[d+g[32]]=p},()=>{t(e,D)[f]=p},()=>{t(e,b)[d+g[7]]=p},()=>{t(e,b)[d+g[10]]=p},()=>{},()=>{},()=>{p<2&&(t(e,J)[f]=p)},()=>{p<2&&(t(e,b)[d+g[68]]=p?127:0)},()=>{},()=>{p<2&&(t(e,b)[d+g[65]]=p?127:0)},()=>{t(e,b)[d+g[5]]=p&15<<4|t(e,b)[d+g[5]]&15},()=>{t(e,b)[d+g[5]]=p&15|(t(e,b)[d+g[5]]&240)>>4},()=>{t(e,b)[d+g[74]]=p},()=>{t(e,b)[d+g[71]]=p},()=>{t(e,b)[d+g[73]]=p},()=>{t(e,b)[d+g[72]]=p},0,0,0,0,0,0,0,()=>{t(e,b)[d+g[128]]=p},()=>{t(e,b)[d+g[93]]=p},()=>{t(e,b)[d+g[91]]=p},0,0,()=>{t(e,b)[d+g[75]]=p},()=>{t(e,b)[d+g[76]]=p},()=>{t(e,b)[d+g[77]]=p},()=>{t(e,b)[d+g[78]]=p}][$]||(()=>{}))():$<63||($<64?t(e,M)[f]?t(e,b)[d+g[0]]=104|p:t(e,b)[d+g[0]]=96|p:console.debug(`Unknown SD-90 global CH${f+1} param setup message:
%o`,a))});break}case 2:{let f=e.chRedir(i,r,!0),l=a[1];console.debug(`Unknown SD-90 global CH${f+1} MIDI setup message:
%o`,a.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,a)}})}chRedir(e,s,h){if(t(this,xe)[s])return(t(this,xe)[s]-1)*16+e;if([2,3].indexOf(t(this,ee))>-1){if(h==1)return e;let o=0,a=!0;for(;a;)t(this,ge)[e+o]==0?(t(this,ge)[e+o]=s,console.debug(`Assign track ${s} to channel ${e+o+1}.`),a=!1):t(this,ge)[e+o]==s?a=!1:(o+=16,o>=128&&(o=0,a=!1));return e+o}else return e}buildRchTree(){let e=[];t(this,H).forEach((s,h)=>{var o;(o=e[s])!=null&&o.constructor||(e[s]=[]),e[s].push(h)}),E(this,st,e)}getActive(){let e=t(this,U).slice();return t(this,O)==S.mt32,e}getCc(e){let s=e*m.cc,h=t(this,b).subarray(s,s+m.cc);return h[g[0]]=h[g[0]]||t(this,ke),h[g[32]]=h[g[32]]||t(this,ee),h}getCcCh(e,s){if(at.indexOf(s)<0)throw new Error("CC number not accepted");return t(this,b)[m.cc*e+g[s]]}getCcAll(){let e=t(this,b).slice();for(let s=0;s<m.ch;s++){let h=s*m.cc;e[h+g[0]]=e[h+g[0]]||t(this,ke),e[h+g[32]]=e[h+g[32]]||t(this,ee)}return e}getChSource(){return t(this,H)}getChType(){return t(this,M)}setChType(e,s,h=t(this,O),o=!1){s&=15,t(this,M)[e]=s,s>0&&!o&&(t(this,b)[e*m.cc+g[0]]=Me[h])}getPitch(){return t(this,ve)}getProgram(){return t(this,D)}getTexts(){return t(this,Y).slice()}getVel(e){let s=new Map,h=this;return t(h,B).forEach(function(o,a){let r=Math.floor(o/128),c=o%128;e==r&&t(h,L)[o]>0&&s.set(c,{v:t(h,L)[o],s:t(h,G)[a]})}),s}getBitmap(){return{bitmap:t(this,Z,ue),expire:t(this,oe)}}getLetter(){return{text:t(this,fe),expire:t(this,Se)}}getMode(){return he[t(this,O)]}getMaster(){return{volume:t(this,P)}}getRawStrength(){let e=this;return t(this,B).forEach(function(s){let h=Math.floor(s/128);t(e,L)[s]>t(e,le)[h]&&(t(e,le)[h]=t(e,L)[s])}),t(this,le)}getStrength(){let e=[],s=this;return this.getRawStrength().forEach(function(h,o){e[o]=Math.floor(h*t(s,b)[o*m.cc+g[7]]*t(s,b)[o*m.cc+g[11]]*t(s,P)/803288)}),e}getRpn(){return t(this,x)}getNrpn(){return t(this,Ve)}getVoice(e,s,h,o){let a=e||t(this,ke),r=s,c=h||t(this,ee);he[t(this,O)]=="ns5r"&&a>0&&a<56&&(c=3);let n=this.userBank.get(a,r,c,o);if(he[t(this,O)]=="mt32"&&n.name.indexOf("MT-m:")==0){let i=parseInt(n.name.slice(5)),f=i*m.cmt,l="";t(this,we).subarray(f,f+10).forEach(d=>{d>31&&(l+=String.fromCharCode(d))}),this.userBank.load(`MSB	LSB	PRG
0	127	${r}	${l}`,!0),n.name=l,n.ending=" "}return(n.ending!=" "||!n.name.length)&&(n=this.baseBank.get(a,r,c,o)),n}getChVoice(e){let s=this.getVoice(t(this,b)[e*m.cc+g[0]],t(this,D)[e],t(this,b)[e*m.cc+g[32]],he[t(this,O)]);if(t(this,de)[e])switch(t(this,O)){case S.mt32:s.ending="~",s.name="",t(this,re).subarray(14*(e-1),14*(e-1)+10).forEach(h=>{h>31&&(s.name+=String.fromCharCode(h))})}return s}getPitchShift(e){let s=e*m.rpn;return t(this,ve)[e]/8192*t(this,x)[s]+(t(this,x)[s+3]-64)+((t(this,x)[s+1]<<7)+t(this,x)[s+2]-8192)/8192}getEffectType(e=0){let s=3*e+1;return t(this,W).subarray(s,s+2)}setEffectTypeRaw(e=0,s,h){let o=3*e;t(this,W)[o]=1,t(this,W)[o+1+ +s]=h}setEffectType(e=0,s,h){this.setEffectTypeRaw(e,!1,s),this.setEffectTypeRaw(e,!0,h)}getEffectSink(){return t(this,ze)}setLetterDisplay(e,s,h=0,o=3200){let a=this,r;E(a,fe," ".repeat(h)),e.forEach(c=>{E(a,fe,t(a,fe)+String.fromCharCode(c>31?c:32)),c<32&&(r=r||new Set,r.add(c))}),E(a,Se,Date.now()+3200),E(a,fe,t(a,fe).padEnd(32," ")),r&&(r=Array.from(r),r.forEach((c,n,i)=>{i[n]=c.toString(16).padStart(2,"0")}),console.warn(`${s}${s?" ":""}invalid code point${r.length>1?"s":""}: 0x${r.join(", 0x")}`))}allocateAce(e){if(!e||e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}let s=!0,h=0;for(;s&&h<m.ace;)t(this,be)[h]==e?s=!1:t(this,be)[h]||(s=!1,t(this,be)[h]=e,console.info(`Allocated cc${e} to ACE slot ${h}.`)),h++;h>=m.ace&&console.warn("ACE slots are full.")}getAce(){return t(this,be)}getChAce(e,s){if(s<0||s>=m.ace)throw new RangeError("No such ACE slot");let h=t(this,be)[s];if(h){if(at.indexOf(h)>=0)return t(this,b)[e*m.cc+g[h]];throw new Error(`Invalid ACE source: ${h}`)}else return 0}init(e=0){let s=this;s.dispatchEvent("mode","?"),E(s,O,0),E(s,ke,0),E(s,ee,0),E(s,Oe,0),t(s,U).fill(0),t(s,b).fill(0),t(s,be).fill(0),t(s,D).fill(0),t(s,L).fill(0),t(s,B).fill(0),t(s,le).fill(0),t(s,ve).fill(0),t(s,Ve).fill(0),t(s,rt).fill(0),E(s,P,100),E(s,Y,[]),E(s,qe,500),E(s,je,0),E(s,Se,0),E(s,fe,""),E(s,oe,0),E(s,Q,0),t(s,Z,ue).fill(0),E(s,I,!1),E(s,Qe,0),E(s,se,!0),t(s,H).forEach(function(h,o,a){a[o]=o}),s.buildRchTree(),e==0&&(t(s,ge).fill(0),t(s,xe).fill(0)),t(s,b)[m.cc*9]=Me[0],t(s,b)[m.cc*25]=Me[0],t(s,b)[m.cc*41]=Me[0],t(s,b)[m.cc*57]=Me[0],t(s,M).fill(s.CH_MELODIC),t(s,M)[9]=s.CH_DRUM1,t(s,M)[25]=s.CH_DRUM3,t(s,M)[41]=s.CH_DRUMS,t(s,M)[57]=s.CH_DRUMS,t(s,M)[73]=s.CH_DRUM5,t(s,M)[89]=s.CH_DRUM7,t(s,M)[105]=s.CH_DRUMS,t(s,M)[121]=s.CH_DRUMS,t(s,Ke).fill(0),t(s,we).fill(0),t(s,$e).fill(0),t(s,re).fill(0),t(s,de).fill(0),t(s,W).fill(0),t(s,ze).fill(0),s.aiEfxName="",s.userBank.clearRange({msb:0,lsb:127,prg:[0,127]});for(let h=0;h<m.ch;h++){let o=h*m.cc;t(s,b)[o+g[7]]=100,t(s,b)[o+g[11]]=127,t(s,b)[o+g[10]]=64,t(s,b)[o+g[71]]=64,t(s,b)[o+g[72]]=64,t(s,b)[o+g[73]]=64,t(s,b)[o+g[74]]=64,t(s,b)[o+g[75]]=64,t(s,b)[o+g[76]]=64,t(s,b)[o+g[77]]=64,t(s,b)[o+g[78]]=64,t(s,b)[o+g[91]]=40,t(s,b)[o+g[101]]=127,t(s,b)[o+g[100]]=127,t(s,b)[o+g[99]]=127,t(s,b)[o+g[98]]=127;let a=h*m.rpn;t(s,x)[a]=2,t(s,x)[a+1]=64,t(s,x)[a+2]=0,t(s,x)[a+3]=64,t(s,x)[a+4]=0,t(s,x)[a+5]=0}s.dispatchEvent("mastervolume",t(s,P)),s.dispatchEvent("efxreverb",s.getEffectType(0)),s.dispatchEvent("efxchorus",s.getEffectType(1)),s.dispatchEvent("efxdelay",s.getEffectType(2)),s.dispatchEvent("efxinsert0",s.getEffectType(3)),s.dispatchEvent("efxinsert1",s.getEffectType(4)),s.dispatchEvent("efxinsert2",s.getEffectType(5)),s.dispatchEvent("efxinsert3",s.getEffectType(6)),s.switchMode("?")}switchMode(e,s=!1){let h=this,o=he.indexOf(e);if(o>-1){if(t(h,O)==0||s){let a=t(h,O);E(h,O,o),E(h,Q,0),E(h,ke,jt[0][o]),E(h,ee,jt[1][o]);for(let c=0;c<m.ch;c++)t(h,M)[c]>0&&t(h,b)[c*m.cc+g[0]]==Me[a]&&(t(h,b)[c*m.cc]=Me[o]);switch(h.initOnReset,o){case S.mt32:{Et.forEach((c,n)=>{let i=n+1;t(h,U)[i]||(t(h,D)[i]=c,t(h,b)[i*m.cc+g[91]]=127)});break}}let r;switch(o){case S["?"]:case S.xg:{r=[1,0,65,0,5,0,0,0];break}case S.gm:case S.gs:case S.g2:case S.sd:{r=[40,4,40,18,40,32,32,0];break}case S["05rw"]:case S.x5d:case S.ns5r:{r=[44,1,44,19,44,0,44,0];break}case S.k11:case S.sg:{r=[24,0,0,0,0,0,0,0];break}case S.mt32:{r=[40,4,0,0,0,0,0,0];break}default:r=[0,0,0,0,0,0,0,0]}for(let c=0;c<4;c++)t(h,W)[3*c]||(t(h,W)[3*c+1]=r[2*c],t(h,W)[3*c+2]=r[2*c+1],h.dispatchEvent(`efx${["reverb","chorus","delay","insert"][c]}`,h.getEffectType(c)));h.dispatchEvent("mode",e)}}else throw new Error(`Unknown mode ${e}`)}newStrength(){t(this,le).fill(0)}runJson(e){var s;if(e.type>14)return e.type==15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),t(this,it)[e.type].call(this,e);{let h=this.chRedir(e.part,e.track),o=!1;(s=t(this,st)[h])==null||s.forEach(a=>{e.channel=a,o=!0,t(this,it)[e.type].call(this,e)}),o||console.warn(`${Qt[e.type]?Qt[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${h+1} without any recipient.`)}t(this,Y).length>100&&t(this,Y).splice(100,t(this,Y).length-99)}runRaw(e){}async loadBank(e,s){switch(e=e.toLowerCase(),e){case"s7e":{this.userBank.clearRange({msb:63,lsb:[21,22]}),this.userBank.clearRange({msb:63,lsb:[24,27]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":{lt.context=this,this.userBank.load(await lt.read(e,s));break}}}},O=new WeakMap,Q=new WeakMap,oe=new WeakMap,pe=new WeakMap,Z=new WeakSet,ue=function(){return t(this,pe)[t(this,Q)]},ea=function(e){t(this,pe)[t(this,Q)]=e},U=new WeakMap,H=new WeakMap,M=new WeakMap,b=new WeakMap,be=new WeakMap,D=new WeakMap,L=new WeakMap,J=new WeakMap,B=new WeakMap,G=new WeakMap,ve=new WeakMap,le=new WeakMap,Re=new WeakMap,x=new WeakMap,Ve=new WeakMap,rt=new WeakMap,de=new WeakMap,$e=new WeakMap,re=new WeakMap,Ke=new WeakMap,we=new WeakMap,W=new WeakMap,ze=new WeakMap,ke=new WeakMap,ee=new WeakMap,P=new WeakMap,Oe=new WeakMap,qe=new WeakMap,je=new WeakMap,fe=new WeakMap,Se=new WeakMap,Qe=new WeakMap,se=new WeakMap,I=new WeakMap,st=new WeakMap,wt=new WeakMap,Y=new WeakMap,ge=new WeakMap,xe=new WeakMap,_=new WeakMap,De=new WeakMap,N=new WeakMap,it=new WeakMap,dt=new WeakMap,Pe=new WeakMap,Ie=new WeakMap,te=new WeakMap,ae=new WeakMap,ye=new WeakMap,Ae=new WeakMap,Ue=new WeakMap,Le=new WeakMap,Jt);var Mt=ga(ta(),1);R();R();var nt,aa,sa=(aa=class{constructor(u,e,s,h){v(this,nt,!1);E(this,nt,u),this.start=e,this.end=s,this.data=h}get duration(){return this.ranged?this.end-this.start:0}get ranged(){return t(this,nt)}},nt=new WeakMap,aa),xt=class extends sa{constructor(u,e,s){super(!0,u,e,s)}},ia=class extends sa{constructor(u,e){super(!1,u,u,e)}},Be,ra,Tt=(ra=class extends Array{constructor(){super(...arguments);v(this,Be,-1)}resetIndex(e){E(this,Be,-1)}fresh(){this.sort(function(e,s){return e.start==s.start?0:(+(e.start>s.start)<<1)-1}),this.forEach(function(e,s){e.index=s})}step(e,s=!1){let h=[];if(s)for(let o=0;o<this.length&&!(this[o].start>e);o++){if(this[o].end<e)continue;h.push(this[o])}else{let o=this.getRange(t(this,Be)==-1?0:e-1,e),a=this;o.forEach(function(r){r.index>t(a,Be)&&(h.push(r),E(a,Be,r.index))})}return h}getRange(e,s){var c;e>s&&([e,s]=[s,e]);let h=[],o=-1,a=Math.ceil(Math.sqrt(this.length)),r=!0;for(let n=0;n<this.length;n+=a)this[n+a]?o<0&&this[n+a].start>=e&&(o=n):o=o<0?n:o;for(;r;)((c=this[o])==null?void 0:c.end)<s?this[o].start>=e&&h.push(this[o]):r=!1,o++;return h}},Be=new WeakMap,ra);var Ta=0xffffffffffff,na=function(u){let e=new Tt,s=this,h=u.timeDivision,o=120,a=new Tt,r=0,c=0;a.push(new xt(0,Ta,[120,0])),u.track.forEach(function(l){r=0,l.event.forEach(function(d){r+=d.deltaTime,d.type==255&&(d==null?void 0:d.metaType)==81&&(o=6e7/d.data,a[a.length-1]&&a.push(new xt(r,0xffffffffffff,[o,0])))})}),a.fresh(),a.forEach(function(l,d,p){d>0&&(p[d-1].end=l.start)});let n=120;a.forEach(function(l,d,p){d>0&&(l.end==l.start?p.splice(p.indexOf(l),1):n==l.data[0]&&(p[d-1].end=l.end,p.splice(p.indexOf(l),1)),n=l.data[0])});let i=0,f=120;return a.forEach(function(l){let d=l.start,p=d/f/h*60+i;f=l.data[0],i=p-d/f/h*60,l.data[1]=i}),console.debug("All tempo changes: ",a),o=120,r=0,c=0,u.track.forEach(function(l,d){r=0,c=0;let p=d+1;l.event.forEach(function(y,$){r+=y.deltaTime;let k=a.step(r,!0)[0];k&&(o=k.data[0],c=k.data[1]);let w={type:y.type,data:y.data,track:p,part:0};y.type>14?w.meta=y.metaType:w.part=y.channel,e.push(new ia(r/o/h*60+c,w))})}),e.fresh(),self.midiEvents=e,console.debug(`Parsed a type ${u.formatType} MIDI sequence.`),e};Mt.default.customInterpreter=qt;var X=function(u,e,s){u.addEventListener(s,h=>{e.dispatchEvent(s,h.data)})},We,Ct,Ye,me,Ne,He,ct,Te,Ce,F,Ge,Ee,_e,ca,Dr=(ca=class extends ot{constructor(e,s=.5,h=.5){super();C(this,"device");v(this,We,void 0);v(this,Ct,void 0);v(this,Ye,[]);v(this,me,"");v(this,Ne,[]);v(this,He,new Uint8ClampedArray(128));v(this,ct,new Uint8ClampedArray(128));v(this,Te,.5);v(this,Ce,120);v(this,F,4);v(this,Ge,4);v(this,Ee,0);v(this,_e,0);C(this,"smoothingAtk",0);C(this,"smoothingDcy",0);let o=this;o.smoothingAtk=s,o.smoothingDcy=h,o.device=e,o.addEventListener("meta",function(a){var r;(r=a==null?void 0:a.data)==null||r.forEach(function(c){(t(o,Ne)[c.meta]||console.debug).call(o,c.meta,c.data)})}),X(o.device,o,"mode"),X(o.device,o,"mastervolume"),X(o.device,o,"channelactive"),X(o.device,o,"channelmin"),X(o.device,o,"channelmax"),X(o.device,o,"channelreset"),X(o.device,o,"screen"),X(o.device,o,"metacommit"),X(o.device,o,"efxreverb"),X(o.device,o,"efxchorus"),X(o.device,o,"efxdelay"),X(o.device,o,"efxinsert0"),X(o.device,o,"efxinsert1"),X(o.device,o,"efxinsert2"),X(o.device,o,"efxinsert3"),t(o,Ne)[3]=function(a,r){var c;((c=t(o,me))==null?void 0:c.length)<1&&(E(o,me,r),o.dispatchEvent("title",t(o,me)))},t(o,Ne)[81]=function(a,r){let c=o.noteProgress,n=t(o,Te)||.5;E(o,Ce,6e7/r),E(o,Te,r/1e6),E(o,Ee,t(o,Ee)+(c*(n/t(o,Te))-c)),o.dispatchEvent("tempo",t(o,Ce))},t(o,Ne)[88]=function(a,r){let c=o.noteProgress,n=o.noteOverall,i=o.noteBar,f=o.noteBeat,l=t(o,F),d=t(o,Ge);E(o,F,r[0]),E(o,Ge,1<<r[1]);let p=24*(32/r[3])/r[2];if(l!=t(o,F)){let y=i;E(o,Ee,t(o,Ee)-y*(t(o,F)-l)),f+1>=l&&(l<t(o,F)?E(o,Ee,t(o,Ee)-Math.ceil(t(o,F)-f-1)):E(o,Ee,t(o,Ee)+t(o,F)))}o.dispatchEvent("tsig",o.getTimeSig())}}reset(){var s;let e=this;e.dispatchEvent("reset"),(s=t(e,We))==null||s.resetIndex(),e.device.init(),E(e,me,""),E(e,Te,.5),E(e,Ce,120),E(e,F,4),E(e,Ge,4),E(e,Ee,0),E(e,_e,0),e.dispatchEvent("tempo",t(e,Ce)),e.dispatchEvent("title",t(e,me))}async loadFile(e){E(this,We,na(Mt.default.parse(new Uint8Array(await e.arrayBuffer()))))}async loadMap(e){}async loadEfx(e){let s=this,h=0,o=0,a,r,c;e.split(`
`).forEach((n,i)=>{if(i){let f=0,l;n.split("	").forEach((d,p)=>{switch(p){case a:{f|=parseInt(d,16)<<8;break}case r:{f|=parseInt(d,16);break}case c:{l=d;break}}}),t(s,Ye)[f]?console.debug(`EFX ID 0x${f.toString(16).padStart(4,"0")} (${l}) seems to be in conflict.`):(t(s,Ye)[f]=l,h++),o++}else n.split("	").forEach((f,l)=>{switch(f){case"MSB":{a=l;break}case"LSB":{r=l;break}case"Name":{c=l;break}default:console.warn(`Unknown EFX field: ${f}`)}})}),console.debug(`EFX: ${o} total, ${h} loaded.`),s.dispatchEvent("efxreverb",s.device.getEffectType(0)),s.dispatchEvent("efxchorus",s.device.getEffectType(1)),s.dispatchEvent("efxdelay",s.device.getEffectType(2)),s.dispatchEvent("efxinsert0",s.device.getEffectType(3)),s.dispatchEvent("efxinsert1",s.device.getEffectType(4)),s.dispatchEvent("efxinsert2",s.device.getEffectType(5)),s.dispatchEvent("efxinsert3",s.device.getEffectType(6))}switchMode(e,s=!1){this.device.switchMode(e,s)}getMode(){return this.device.getMode()}getVoice(){return this.device.getVoice(...arguments)}getChVoice(e){return this.device.getChVoice(e)}getMapped(e){}getEfx([e,s]){let h=e<<8|s;return t(this,Ye)[h]||`0x${h.toString(16).padStart(4,"0")}`}get noteProgress(){return t(this,_e)/t(this,Te)}get noteOverall(){return this.noteProgress-t(this,Ee)}get noteBar(){return Math.floor(this.noteOverall/t(this,F))}get noteBeat(){let e=this.noteOverall%t(this,F);return e<0&&(e+=t(this,F)),e}getTimeSig(){return[t(this,F),t(this,Ge)]}getTempo(){return t(this,Ce)}sendCmd(e){this.device.runJson(e)}render(e){var k;e>t(this,_e)&&E(this,_e,e);let s=((k=t(this,We))==null?void 0:k.step(e))||[],h=0,o=new Set,a=this,r=[];this.device.getStrength().forEach((w,T)=>{t(this,ct)[T]=w}),a.device.newStrength(),s.forEach(function(w){let T=w.data;T.type==9&&(T.data[1]>0?o.add(T.part*128+T.data[0]):o.has(T.part*128+T.data[0])&&h++),w.data.type==8&&o.has(T.part*128+T.data[0])&&h++;let A=a.device.runJson(T);switch(A==null?void 0:A.reply){case"meta":{r.push(A);break}}A!=null&&A.reply&&delete A.reply}),(r==null?void 0:r.length)>0&&this.dispatchEvent("meta",r);let c=this.device.getActive(),n=[],i=a.device.getPitch(),f=a.device.getCcAll(),l=a.device.getProgram(),d=a.device.getChType(),p=this.device.getStrength();p.forEach(function(w,T,A){A[T]=Math.max(t(a,ct)[T],w);let V=A[T]-t(a,He)[T],ie=g.length*T;if(V>=0){let ht=4*.25**(f[ie+g[73]]/64);t(a,He)[T]+=Math.ceil(V-V*a.smoothingAtk**ht)}else{let ht=4*.25**(f[ie+g[72]]/64);t(a,He)[T]+=Math.floor(V-V*a.smoothingDcy**ht)}});let y=0;return c.forEach(function(w,T){w&&(n[T]=a.device.getVel(T),y+=n[T].size)}),{extraPoly:h,curPoly:y,chInUse:c,chKeyPr:n,chPitch:i,chProgr:l,chContr:f,chType:d,eventCount:s.length,title:t(this,me),bitmap:this.device.getBitmap(),letter:this.device.getLetter(),texts:this.device.getTexts(),master:this.device.getMaster(),mode:this.device.getMode(),strength:t(this,He).slice(),velo:p,rpn:this.device.getRpn(),tSig:this.getTimeSig(),tempo:this.getTempo(),noteBar:this.noteBar,noteBeat:this.noteBeat,ace:this.device.getAce(),efxSink:this.device.getEffectSink()}}},We=new WeakMap,Ct=new WeakMap,Ye=new WeakMap,me=new WeakMap,Ne=new WeakMap,He=new WeakMap,ct=new WeakMap,Te=new WeakMap,Ce=new WeakMap,F=new WeakMap,Ge=new WeakMap,Ee=new WeakMap,_e=new WeakMap,ca);export{Dr as RootDisplay,g as ccToPos,kt as dnToPos};
