var Or=Object.create;var Ut=Object.defineProperty;var Ir=Object.getOwnPropertyDescriptor;var Br=Object.getOwnPropertyNames;var Lr=Object.getPrototypeOf,Ur=Object.prototype.hasOwnProperty;var Nr=(g,e,a)=>e in g?Ut(g,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):g[e]=a;var Zt=(g,e)=>()=>(g&&(e=g(g=0)),e);var Hr=(g,e)=>()=>(e||g((e={exports:{}}).exports,e),e.exports);var _r=(g,e,a,f)=>{if(e&&typeof e=="object"||typeof e=="function")for(let c of Br(e))!Ur.call(g,c)&&c!==a&&Ut(g,c,{get:()=>e[c],enumerable:!(f=Ir(e,c))||f.enumerable});return g};var Gr=(g,e,a)=>(a=g!=null?Or(Lr(g)):{},_r(e||!g||!g.__esModule?Ut(a,"default",{value:g,enumerable:!0}):a,g));var P=(g,e,a)=>(Nr(g,typeof e!="symbol"?e+"":e,a),a),Jt=(g,e,a)=>{if(!e.has(g))throw TypeError("Cannot "+a)};var t=(g,e,a)=>(Jt(g,e,"read from private field"),a?a.call(g):e.get(g)),C=(g,e,a)=>{if(e.has(g))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(g):e.set(g,a)},S=(g,e,a,f)=>(Jt(g,e,"write to private field"),f?f.call(g,a):e.set(g,a),a);var jt=Zt(()=>{"use strict";N();(function(){var g=function(w,$,r){var i,d;if(self.MessageEvent)switch(w){case"message":{d=new MessageEvent(w,{data:$,ports:r==null?void 0:r.ports}),Object.defineProperty(d,"source",{value:r==null?void 0:r.source});break}default:d=new Event(w)}else d=document.createEvent("Event"),d.initEvent(w,!1,!1),r&&w=="message"&&(d.data=$,r.source&&Object.defineProperty(d,"source",{value:r.source}),(i=r.ports)!=null&&i.length&&Object.defineProperty(d,"ports",{value:r.ports}));return d};self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),a=[],f={},c=function(w){var $,r=this;if((this==null?void 0:this.constructor)!=c)throw new TypeError("Illegal constructor");a.push(this),($=f[w])!=null&&$.constructor||(f[w]=[]),f[w].push(this);var i=Math.floor(Math.random()*281474976710656),d=[],s=0,n=[],o=!0,l=!1;Object.defineProperty(this,"id",{get:function(){return i}}),Object.defineProperty(this,"name",{value:w}),this.close=function(){var h,y=a.indexOf(r);y>-1?(e.postMessage({t:"d",c:w,i}),a.splice(y,1),(h=f[w])!=null&&h.constructor&&(y=f[w].indexOf(r),y>-1&&f[w].splice(y,1)),f[w].length||delete f[w],console.debug("[Snowy] BroadcastChannel closed."),l=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(h){if(e){if(l)throw new Error("Channel already closed");e.postMessage({t:"m",c:w,i,m:s,d:h}),s++,s>4294967295&&(s=0)}else n.push(h),console.debug("[Snowy] Message is cached.")},this.flush=function(){if(e){if(o){for(e.postMessage({t:"r",c:w,i}),console.debug("[Snowy] ".concat(n.length," message(s) in cache."));n.length;){var h=n.shift();r.postMessage(h)}o=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(h){h.c==w?h.i!=i&&r.dispatchEvent(g("message",h.d,{source:r})):console.debug("[Snowy] Channel ID mismatch. Instance ".concat(i," receives from ").concat(w,", not ").concat(h.c,"."))};var u={};this.dispatchEvent=function(h){var y,k;if(Object.defineProperty(h,"target",{value:r}),Object.defineProperty(h,"currentTarget",{value:r}),(y=u[h.type])!=null&&y.length)for(var T=u[h.type],M=0;M<T.length;M++)((k=T[M])==null?void 0:k.constructor)==Function&&T[M].call(r,h);r["on".concat(h.type)]&&r["on".concat(h.type)].constructor==Function&&r["on".concat(h.type)].call(r,h)},this.addEventListener=function(h,y){var k;(k=u[h])!=null&&k.constructor||(u[h]=[]);var T=u[h].indexOf(y);T==-1&&u[h].push(y)},this.removeEventListener=function(h,y){var k,T;if((k=u[h])!=null&&k.length){var M=u[h].indexOf(y);M>-1&&u[h].splice(M,1)}!((T=u[h])!=null&&T.length)&&u[h].constructor&&delete u[h]}},self.BroadcastChannel=c,p=function(){if(e){e.addEventListener("message",function($){var r=$.data,i=!1;switch(r.t){case"k":{i=!1,e.postMessage({t:"k"});break}case"m":{var d=f[r.c];if(d!=null&&d.length)for(var s=0;s<d.length;s++)d[s].receiveMessage(r);break}case"c":{for(var n=[],o=0;o<a.length;o++){var l=a[o].name;n.indexOf(l)<0&&n.push(l)}e.postMessage({t:"k",c:n});break}default:i=!0}i&&console.info("ReceiveBroadcast",r)});for(var w=0;w<a.length;w++)a[w].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},v=function(){if(!e){var w=new SharedWorker(self.SNOWY_PATH||"/snowy.js");w.port.start();var $=function(r){r.data.t=="swc"&&(w.port.removeEventListener("message",$),e=w.port,e.postMessage({t:"k"}),p())};w.port.addEventListener("message",$)}},v());var e,a,f,c,p,v})()});var N=Zt(()=>{"use strict";jt();{let g=function(e,a){let f=new FileReader;return new Promise((c,p)=>{switch(f.addEventListener("abort",()=>{p(new Error("Blob read aborted"))}),f.addEventListener("error",v=>{p(f.error||v.data||new Error("Blob read error"))}),f.addEventListener("load",()=>{c(f.result)}),a.toLowerCase()){case"arraybuffer":case"buffer":{f.readAsArrayBuffer(e);break}case"string":case"text":{f.readAsText(e);break}default:p(new Error(`Unknown target ${a}`))}})};Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||function(){return g(this,"buffer")},Blob.prototype.text=Blob.prototype.text||function(){return g(this,"text")}}String.prototype.replaceAll=String.prototype.replaceAll||function(g,e){let a=0,f=16,c=this,p=[];for(;a<f&&c.lastIndexOf(g)>-1;){let v=c.lastIndexOf(g);p.unshift(c.slice(v+g.length)),c=c.slice(0,v),v==0&&p.unshift(""),a++}return c.length&&p.unshift(c),p.join(e)||""},String.prototype.padStart=String.prototype.padStart||function(g,e){if(e){let a=this;for(;a.length<g;)a=`${e}${a}`;return a}},String.prototype.padEnd=String.prototype.padEnd||function(g,e){if(e){let a=this;for(;a.length<g;)a+=e;return a}}});var Cr=Hr((Za,qt)=>{N();(function(){"use strict";let g={fatal:!0},e=[new TextDecoder("iso-8859-15",g),new TextDecoder("sjis",g),new TextDecoder("euc-jp",g),new TextDecoder("utf-8",g),new TextDecoder("utf-16",g),new TextDecoder("ascii")],a={debug:!1,parse:function(f,c){if(f instanceof Uint8Array)return a.Uint8(f);if(typeof f=="string")return a.Base64(f);if(f instanceof HTMLElement&&f.type==="file")return a.addListener(f,c);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(f,c){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(f===void 0||!(f instanceof HTMLElement)||f.tagName!=="INPUT"||f.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;c=c||function(){},f.addEventListener("change",function(p){if(!p.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let v=new FileReader;v.readAsArrayBuffer(p.target.files[0]),v.onload=function(w){c(a.Uint8(new Uint8Array(w.target.result)))}})},Base64:function(f){let c=function(w){var $="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(w=w.replace(/^.*?base64,/,""),w=String(w).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(w))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");w+="==".slice(2-(3&w.length));let r,i="",d,s,n=0;for(;n<w.length;)r=$.indexOf(w.charAt(n++))<<18|$.indexOf(w.charAt(n++))<<12|(d=$.indexOf(w.charAt(n++)))<<6|(s=$.indexOf(w.charAt(n++))),i+=d===64?String.fromCharCode(r>>16&255):s===64?String.fromCharCode(r>>16&255,r>>8&255):String.fromCharCode(r>>16&255,r>>8&255,255&r);return i}(f=String(f));var p=c.length;let v=new Uint8Array(new ArrayBuffer(p));for(let w=0;w<p;w++)v[w]=c.charCodeAt(w);return a.Uint8(v)},Uint8:function(v){let c={data:null,pointer:0,movePointer:function(d){return this.pointer+=d,this.pointer},readInt:function(d){if((d=Math.min(d,this.data.byteLength-this.pointer))<1)return-1;let s=0;if(1<d)for(let n=1;n<=d-1;n++)s+=this.data.getUint8(this.pointer)*Math.pow(256,d-n),this.pointer++;return s+=this.data.getUint8(this.pointer),this.pointer++,s},readStr:function(d){let s=new Uint8Array(d),n=!1,o;s.forEach((l,u)=>{s[u]=this.readInt(1)});for(let l=0;l<e.length;l++)if(!n)try{if(o=e[l].decode(s),l==0)for(let u=0;u<o.length;u++){let h=o.charCodeAt(u);if(h>191||h>127&&h<160)throw new RangeError(`Invalid code point: ${h}`)}n=!0,console.debug(`String byte sequence in ${e[l].encoding}`)}catch(u){console.debug(`SMF string ${u}`)}return o||"String byte sequence read failed."},backOne:function(){this.pointer--},readIntVLV:function(){let d=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)d=this.readInt(1);else{let n=[];for(;128<=this.data.getUint8(this.pointer);)n.push(this.readInt(1)-128);var s=this.readInt(1);for(let o=1;o<=n.length;o++)d+=n[n.length-o]*Math.pow(128,o);d+=s}return d}};if(c.data=new DataView(v.buffer,v.byteOffset,v.byteLength),c.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;c.readInt(4);let p={};p.formatType=c.readInt(2),p.tracks=c.readInt(2),p.track=[];var v=c.readInt(1),w=c.readInt(1);128<=v?(p.timeDivision=[],p.timeDivision[0]=v-128,p.timeDivision[1]=w):p.timeDivision=256*v+w;for(let d=1;d<=p.tracks;d++){p.track[d-1]={event:[]};var $,r=c.readInt(4);if(r===-1)break;if(r!==1297379947)return!1;c.readInt(4);let s=0,n=!1,o,l;for(;!n&&(s++,p.track[d-1].event[s-1]={},p.track[d-1].event[s-1].deltaTime=c.readIntVLV(),(o=c.readInt(1))!==-1);)if(128<=o?l=o:(o=l,c.movePointer(-1)),o===255){p.track[d-1].event[s-1].type=255,p.track[d-1].event[s-1].metaType=c.readInt(1);var i=c.readIntVLV();switch(p.track[d-1].event[s-1].metaType){case 47:case-1:n=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:p.track[d-1].event[s-1].data=c.readStr(i);break;case 33:case 89:case 81:p.track[d-1].event[s-1].data=c.readInt(i);break;case 84:p.track[d-1].event[s-1].data=[],p.track[d-1].event[s-1].data[0]=c.readInt(1),p.track[d-1].event[s-1].data[1]=c.readInt(1),p.track[d-1].event[s-1].data[2]=c.readInt(1),p.track[d-1].event[s-1].data[3]=c.readInt(1),p.track[d-1].event[s-1].data[4]=c.readInt(1);break;case 88:p.track[d-1].event[s-1].data=[],p.track[d-1].event[s-1].data[0]=c.readInt(1),p.track[d-1].event[s-1].data[1]=c.readInt(1),p.track[d-1].event[s-1].data[2]=c.readInt(1),p.track[d-1].event[s-1].data[3]=c.readInt(1);break;default:this.customInterpreter!==null&&(p.track[d-1].event[s-1].data=this.customInterpreter(p.track[d-1].event[s-1].metaType,c,i)),this.customInterpreter!==null&&p.track[d-1].event[s-1].data!==!1||(c.readInt(i),p.track[d-1].event[s-1].data=c.readInt(i),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch((o=o.toString(16).split(""))[1]||o.unshift("0"),p.track[d-1].event[s-1].type=parseInt(o[0],16),p.track[d-1].event[s-1].channel=parseInt(o[1],16),p.track[d-1].event[s-1].type){case 15:this.customInterpreter!==null&&(p.track[d-1].event[s-1].data=this.customInterpreter(p.track[d-1].event[s-1].type,c,!1)),this.customInterpreter!==null&&p.track[d-1].event[s-1].data!==!1||($=c.readIntVLV(),p.track[d-1].event[s-1].data=c.readInt($),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:p.track[d-1].event[s-1].data=[],p.track[d-1].event[s-1].data[0]=c.readInt(1),p.track[d-1].event[s-1].data[1]=c.readInt(1);break;case 12:case 13:p.track[d-1].event[s-1].data=c.readInt(1);break;case-1:n=!0;break;default:if(this.customInterpreter!==null&&(p.track[d-1].event[s-1].data=this.customInterpreter(p.track[d-1].event[s-1].metaType,c,!1)),this.customInterpreter===null||p.track[d-1].event[s-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return p},customInterpreter:null};if(typeof qt<"u")qt.exports=a;else{let f=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;f.MidiParser=a}})()});N();N();var ie,er,At=(er=class{constructor(){C(this,ie,{})}addEventListener(g,e){t(this,ie)[g]||(t(this,ie)[g]=[]),t(this,ie)[g].unshift(e)}removeEventListener(g,e){if(t(this,ie)[g]){let a=t(this,ie)[g].indexOf(e);a>-1&&t(this,ie)[g].splice(a,1),t(this,ie)[g].length<1&&delete t(this,ie)[g]}}dispatchEvent(g,e){var c;let a=new Event(g),f=this;a.data=e,((c=t(this,ie)[g])==null?void 0:c.length)>0&&t(this,ie)[g].forEach(function(p){try{p==null||p.call(f,a)}catch(v){console.error(v)}}),this[`on${g}`]&&this[`on${g}`](a)}},ie=new WeakMap,er);N();N();var tr=function(g,e){let a=Math.min(g.length,e.length),f=g.slice(0,a),c=e.slice(0,a),p=0,v=0;for(;v<a&&p==0;)p=Math.sign(f[v]-c[v]),v++;return p},be=function(g=""){this.name=g,this.pool=[],this.point=function(e,a=!1){if(this.pool.length>0){let f=this.pool.length,c=1<<Math.floor(Math.log2(f)),p=c,v=64;for(;c>=1&&v>=0;){if(v<=0)throw new Error("TTL reached.");if(p==f)p-=c;else{let $=tr(e,this.pool[p]);switch($){case 0:{v=0;break}case 1:{p+c<=f&&(p+=c);break}case-1:{p!=0&&(p-=c);break}default:console.warn(`Unexpected result ${$}.`)}}c=c>>1,v--}let w=!0;if(p>=this.pool.length)w=!1;else{let $=this;this.pool[p].forEach(function(r,i,d){w&&r!=e[i]&&(w=!1)}),!w&&tr(e,this.pool[p])>0&&p++}return w||a?p:-1}else return a?0:-1},this.add=function(e,a){return e.data=a,this.pool.splice(this.point(e,!0),0,e),this},this.default=function(e){console.warn(`No match in "${this.name||"(unknown)"}" for "${e}". Default action not defined.`)},this.get=function(e){let a=this.point(e);if(a>-1)return this.pool[a].data;this.default(e)},this.run=function(e,...a){let f=this.point(e);f>-1?e.subarray?this.pool[f].data(e.subarray(this.pool[f].length),...a):this.pool[f].data(e.slice(this.pool[f].length),...a):this.default(e,...a)}};N();var Xr=["MSB","PRG","LSB","NME","ELC","DRM","LVL"],Vr={krs:"KR",s90es:"ES",motif:"ES"},Fr={krs:"Kr",s90es:"SE",motif:"ME"},Nt=function(g){let e=Math.floor(g/10),a=g%10;return`${e.toString(16)}${a}`},J,rr,Ht=(rr=class{constructor(...g){C(this,J,void 0);P(this,"strictMode",!1);this.loadFiles(...g)}get bankInfo(){return t(this,J)}get(g=0,e=0,a=0,f){var k,T;let c=[g,e,a],p,v=1,w=0,$,r,i=Array.from(arguments);switch(f){case"xg":{switch(g){case 0:{a==126?i[2]=125:a==127&&(i[2]=0);break}case 16:{a==126&&(i[2]=0);break}case 32:{a>125&&(i[2]=0),i[2]+=4;break}case 33:{(a>125||a==3)&&(i[2]=0),i[2]+=5;break}case 34:case 35:case 36:{a>125&&(i[2]=0),i[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:i[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{a==126&&(i[2]=0);break}case 48:case 64:case 126:case 127:{a==126&&(g==127&&e==0||(i[2]=0));break}}break}case"gs":case"sc":{g==0&&a<5?i[2]=0:g>125&&a<5&&a!=2&&(i[2]=g,i[0]=0);break}case"g2":case"sd":{g>>1==40?i[2]|=16:g>95&&g<100&&(i[2]|=16,e>>4==7&&(i[0]=96));break}case"sg":{g==8&&a==0&&(i[2]=5);break}case"05rw":case"x5d":{g&&g<56&&(i[0]=56);break}case"s90es":{if(g==0)break;a<8?i[2]+=17:a<32?i[2]+=13:i[2]=(i[2]>>3)+19;break}case"motif":{if(g==0)break;a<8?i[2]+=28:a<32?i[2]+=13:i[2]=(i[2]>>3)+19;break}}let d=" ",s="M",n="",o=0,l=0;switch(i[0]){case 0:{switch(i[2]){case 127:{f=="xg"?s="GM-a":(s="MT-a",n="C/M");break}case 126:{f=="xg"?s="GM-n":(s="MT-b",n="C/M");break}case 7:{s="GM-k",n="GLX";break}case 5:{s="SG-a",n="000";break}case 4:{f=="gs"||f=="sc"?(s="GM-a",n="000"):(s="SP-l",n="C/M");break}case 3:case 2:case 1:{(f=="gs"||f=="sc")&&(s="GM-a",n="000");break}case 0:{s="GM-a";break}default:s="y",o=3}break}case 8:{f=="sg"?s="GM-s":s="r:";break}case 32:case 33:case 34:case 35:case 36:{f=="xg"&&(s=`${["AP","VL","PF","DX","AN"][g&7]}-${"abcdefgh"[a]}`,o=3);break}case 48:{n=`M${(i[2]>>3).toString().padStart(2,"0")}`,s=`y${n}`,o=1;break}case 56:{s="GM-b";break}case 57:s=["yDOC","QY10","QY20"][i[2]-112]||"yMxv",n=["DOC","QY1","QY2"][i[2]-112]||"057";case 61:case 120:{s="rDrm";break}case 62:{s="kDrm";break}case 63:{if(i[2]<17){let M=i[2];s=M<10?"kP:":"kC:",s+=M%10}else i[2]<34?s=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][i[2]-17]:s="Ds";o=1;break}case 64:{s="ySFX",n="SFX";break}case 67:{s="DX:S";break}case 80:case 81:case 82:case 83:{s=`Prg${"UABC"[i[0]-80]}`;break}case 88:case 89:case 90:case 91:{s=`Cmb${"UABC"[i[0]-88]}`;break}case 95:{s=`${["DR","PC"][i[2]]}-d`;break}case 96:{s=i[2]==106?"AP-a":i[2]>>4==1?"SDg":"PF",i[2]>63?l=63:i[2]>>4==1&&(l=16),o=3;break}case 97:{s=i[2]>>4==1?"SDa":"VL:",o=3,i[2]>>4==1?l=16:l=112;break}case 98:{s=i[2]>>4==1?"SDb":"SG-a",o=3,l=16;break}case 99:{s=i[2]>>4==1?"SDc":"DX",i[2]>63?l=63:i[2]>>4==1&&(l=16),o=3;break}case 100:{s="AN",i[2]>63?l=63:i[2]>>4==1&&(l=16),o=3;break}case 104:case 105:case 106:case 107:{s="SDd",l=104;break}case 121:{s=`GM-${i[2]?"":"a"}`,o=3;break}case 122:{s="lDrm";break}case 126:{s="yDrS";break}case 127:{i[2]==127?s="rDrm":s="yDrm";break}default:i[0]<48?s="r:":s="M"}s.length<4&&(s+=`${[g,a,i[0],i[2]][o]-l}`.padStart(4-s.length,"0")),n.length<3&&(n+=`${[g,a,g,a][o]}`.padStart(3-n.length,"0")),f=="xg"&&(g==0?i[2]<100?s=s.replace("y0","y:"):i[2]==125&&(s="y126"):g==16?(p=`Voice${((i[2]<<7)+i[1]+1).toString().padStart(3,"0")}`,d=" "):g==35&&a>>1==2&&(p=`DXCH_${(((i[2]&1)<<7)+e+1).toString().padStart(3,"0")}`,d=" "));let u=[i[0],i[1],i[2]];for(;!((p==null?void 0:p.length)>=0);)if(p=(k=t(this,J)[i[1]||0][(i[0]<<8)+i[2]])==null?void 0:k.name,p){let M=t(this,J)[i[1]||0][(i[0]<<8)+i[2]];v=(M==null?void 0:M.poly)||v,w=(M==null?void 0:M.type)||w,$=M==null?void 0:M.drum,r=M==null?void 0:M.level}else if(this.strictMode)p="",d="?";else if(i[0]==0&&i[1]==0&&i[2]==0)p="Unloaded";else if(t(this,J)[i[1]||0][i[0]<<8])i[0]==0?(i[2]=0,d="^"):i[2]<1?(i[0]=0,d="*"):(i[2]--,d="^");else if(g==48)i[0]=0,i[2]=0,d="!";else if(g==62)i[1]--,d=" ",i[1]<1&&!(p!=null&&p.length)&&(i[0]=0,d="!");else if(g<63)i[0]==0?(i[2]=0,d="^"):i[2]<1?(i[0]=0,d="*"):i[2]--;else if(g==80)p=`PrgU:${e.toString().padStart(3,"0")}`,d="!";else if(g==88)p=`CmbU:${e.toString().padStart(3,"0")}`,d="!";else if(g==121)p=`GM2Vox0${a}`,d="#";else if(g==122)if(i[1]==32?i[1]==0:i[1]%=7,p=(T=t(this,J)[i[1]||0][(i[0]<<8)+i[2]])==null?void 0:T.name,p){d=" ";let M=t(this,J)[i[1]||0][(i[0]<<8)+i[2]];v=(M==null?void 0:M.poly)||v,w=(M==null?void 0:M.type)||w,$=M==null?void 0:M.drum,r=M==null?void 0:M.level}else p="",d="*";else i[1]==0?(p=`${g.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")} ${a.toString().padStart(3,"0")}`,d="!"):i[0]==0?(i[2]=0,d="^"):i[2]>0?i[2]--:i[1]>0?(i[1]=0,d="!"):(i[0]=0,d="?");let h=[i[0],i[1],i[2]];switch(d){case"^":{switch(f){case"gs":case"sc":case"ns5r":{d=" ";break}}g==127&&d=="^"&&(d=" ");break}}let y="??";switch(i[0]){case 0:{i[2]==0?y="GM":i[2]==5||i[2]==7?y="KG":i[2]<126?y="XG":i[2]==127&&(y="MT");break}case 32:case 33:case 35:case 36:{i[2]>4?y=["AP","VL","PF","DX","AN"][i[0]-32]:y="GS";break}case 48:{y="MU";break}case 56:{y="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{y="AI";break}case 62:case 82:case 90:{y="XD";break}case 63:{i[2]<17?y="KR":i[2]<34?y="ES":y="DS";break}case 64:case 126:{y="XG";break}case 67:case 99:{y=i[2]>>4==1?"SD":"DX";break}case 81:{y="RW";break}case 95:{y=["DR","PC"][i[2]];break}case 96:{y=i[2]==106?"AP":i[2]>>4==1?"SD":"PF";break}case 97:{y=i[2]>>4==1?"SD":"VL";break}case 98:{y=i[2]>>4==1?"SD":"SG";break}case 100:{y="AN";break}case 104:case 105:case 106:case 107:{y="SD";break}case 120:{y="GS";break}case 121:{y=i[2]?"G2":"GM";break}case 122:{y="KG";break}case 127:{y=i[2]==127?"MT":e==0?"GM":"XG";break}default:i[0]<48&&(i[0]==16&&f=="xg"?y="XG":y="GS")}if(d!=" ")switch(f){case"krs":case"s90es":case"motif":{p="",y=Vr[f];break}default:self.debugMode&&(p="")}return{name:p||`${Fr[f]||f.toUpperCase()}${Nt(g||0)}${Nt(e||0)}${Nt(a||0)}`,poly:v,type:w,drum:$,level:r,iid:u,eid:h,sid:c,ending:d,sect:s,bank:n,standard:y,mode:f}}async load(g,e,a="(internal)",f){let c=this,p=[],v=0,w=0,$=0;g.split(`
`).forEach(function(r,i){var n;let d=r.split("	"),s=[];if(i==0){if(d.forEach(function(o,l){p[Xr.indexOf(o)]=l}),p.length<4){console.debug("Debugger launched.");debugger}}else{let o=0,l=0,u=0,h,y=1,k=0,T,M;d.forEach(function(X,Pe){switch(Pe){case p[0]:{o=parseInt(X);break}case p[1]:{l=parseInt(X);break}case p[2]:{u=parseInt(X);break}case p[3]:{h=X;break}case p[4]:{X=parseInt(X),X<16?y=X+1:(k=(X&15)+1,y=k);break}case p[5]:{M=X;break}case p[6]:{X!=null&&X.constructor&&(T=parseInt(X));break}}}),t(c,J)[l]=t(c,J)[l]||[];let B=t(c,J)[l],O={msb:o,prg:l,lsb:u,name:h,poly:y,type:k,drum:M,level:T,priority:f},F=!1;f<((n=B[o<<8|u])==null?void 0:n.priority)&&(F=!0,$++),(!B[o<<8|u]||F||e)&&(B[o<<8|u]=O,v++),w++}}),e||console.debug(`Map "${a}": ${w} total, ${v} loaded (${v-$} + ${$}).`)}clearRange(g){let e=g.prg!=null?g.prg.constructor==Array?g.prg:[g.prg,g.prg]:[0,127],a=g.msb!=null?g.msb.constructor==Array?g.msb:[g.msb,g.msb]:[0,127],f=g.lsb!=null?g.lsb.constructor==Array?g.lsb:[g.lsb,g.lsb]:[0,127];for(let c=a[0];c<=a[1];c++){let p=c<<8;for(let v=f[0];v<=f[1];v++){let w=p+v;for(let $=e[0];$<=e[1];$++)delete t(this,J)[$][w]}}}init(){S(this,J,[]);for(let g=0;g<128;g++)t(this,J).push([""])}async loadFiles(...g){this.init();let e=this;g.forEach(async function(a,f){try{e.load(await(await fetch(`./data/bank/${a}.tsv`)).text(),!1,a,f)}catch(c){console.error(`Failed loading "${a}.tsv".`)}})}},J=new WeakMap,rr);N();N();var ot,ar,sr=(ar=class{constructor(){C(this,ot,{});P(this,"context")}set(g,e){t(this,ot)[g]=e}has(g){return!!t(this,ot)[g]}async read(g,e){if(!this.has(g))throw new Error(`No decoder registered for "${g}"`);return await t(this,ot)[g].call(this.context||this,e)}},ot=new WeakMap,ar);var Kr=function(g,e){let a=!0;return e.forEach((f,c)=>{a=a&&g[c]==f}),a},yt=function(g){let e=0;return g.forEach(a=>{e*=256,e+=a}),e},ke=new TextDecoder,Et=new sr;Et.set("s7e",async function(g){let e=new Uint8Array(await g.slice(0,65536).arrayBuffer()),a="MSB	LSB	PRG	NME",f=[0,0,0,0],c=32,p=0,v=0,w=!0,$=[],r=0;for(;w;){let i=e.subarray(p);([()=>{ke.decode(i.subarray(0,4))=="YSFC"?(p+=80,v=1):p++},()=>{if(Kr(i.subarray(0,4),f))$.forEach((d,s,n)=>{let o=yt(e.subarray(d.start+4,d.start+8));d.length=o}),v=2;else{let d=ke.decode(i.subarray(0,4)),s=yt(i.subarray(4,8));$.push({type:d,start:s}),p+=8}},()=>{let d=$[r],s=e.subarray(d.start,d.start+d.length),n=32;switch(d.type){case"ENVC":{let o=c;for(;o<s.length;){let l=s.subarray(o,o+n),u=ke.decode(l.subarray(0,10)).trimEnd();u.slice(0,5)=="Init "&&(u=""),u&&(a+=`
063	${(l[17]+13).toString().padStart(3,"0")}	${l[19].toString().padStart(3,"0")}	${u}`),o+=n}break}case"EDVC":{let o=c;for(;o<s.length;){let l=s.subarray(o,o+n),u=ke.decode(l.subarray(0,10)).trimEnd();u.slice(0,5)=="Init "&&(u=""),u&&(a+=`
063	024	${l[19].toString().padStart(3,"0")}	${u}`),o+=n}break}case"EPVC":{let o=32,l=c;for(;l<s.length;){let u=s.subarray(l,l+o),h=ke.decode(u.subarray(0,10)).trimEnd();h=="----------"&&(h=""),h&&(a+=`
063	${(u[17]+1).toString().padStart(3,"0")}	${u[19].toString().padStart(3,"0")}	${h}`),l+=o}break}}r++,r>=$.length&&(v=3,w=!1)}][v]||(()=>{w=!1}))()}return a});Et.set("pcg",async function(g){let e=new Uint8Array(await g.arrayBuffer()),a="MSB	LSB	PRG	NME",f=100,c=0,p=0,v=!0,w=[],$=0;for(;v;){let r=e.subarray(f);([()=>{v=ke.decode(r.subarray(0,4))=="INI2",p=r[15],f+=16,c=1},()=>{let i=ke.decode(r.subarray(0,4)),d=r[5],s=r[7],n=r[11],o=yt(r.subarray(12,16)),l=yt(r.subarray(16,20)),u=yt(r.subarray(36,40)),h=ke.decode(r.subarray(44,44+n));w.push({type:i,tipMsb:d,tipLsb:s,nameLen:n,length:o,start:l,entryLen:u,name:h}),f+=64,p--,p<1&&(c=2)},()=>{let i=w[$],d=e.subarray(i.start,i.start+i.length);switch(i.type){case"PRG1":break;case"PBK1":{let s=63,n=(i.tipMsb?6:0)+i.tipLsb;for(let o=0;o<128;o++){let l=o*i.entryLen,u=d.subarray(l,l+i.entryLen),h=ke.decode(u.subarray(0,24)).trimEnd().replace("InitProg","");h.length&&n>5&&(a+=`
${s.toString().padStart(3,"0")}	${n.toString().padStart(3,"0")}	${o.toString().padStart(3,"0")}	${h}`)}break}case"CBK1":{let s=63,n=(i.tipMsb?3:0)+i.tipLsb+10;for(let o=0;o<128;o++){let l=o*i.entryLen,u=d.subarray(l,l+i.entryLen),h=ke.decode(u.subarray(0,24)).trimEnd().replace("InitCombi","");h.length&&n>12&&(a+=`
${s.toString().padStart(3,"0")}	${n.toString().padStart(3,"0")}	${o.toString().padStart(3,"0")}	${h}`)}break}}$++,$>=w.length&&(c=3,v=!1)}][c]||(()=>{v=!1}))()}return a});N();var vt=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),wt=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],zr=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],lt=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],ir=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],nr=function(g){let e=.1,a=-.3;return g>66?(e=5,a=315):g>56?(e=1,a=47):g>46&&(e=.5,a=18.5),e*g-a},cr=function(g){return g>105?zr[g-106]:g>100?g*1.1-100:g/10},or=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),_t={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,ㇺ
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,うぃ
we,うぇ
wo,を
nga,か゚
ngi,き゚
ngu,く゚
nge,け゚
ngo,こ゚
ngy,き゚!
ng,ン
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,いぇ
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(g=>{let e=g.split(",");_t[e[0]]=e[1]});var lr=function(g){let e=g;g[0]=="*"&&(e=e.slice(1)),["aa","ii","uu","ee","oo"].forEach(f=>{for(;e.indexOf(f)>-1;)e=e.replace(f,f[0])});for(let f in _t)e=e.replaceAll(f,_t[f]);e.indexOf("ん")==0&&e.length>1&&(e=e.slice(1));let a=e.indexOf("!");return a>-1&&e.length>1&&(e=e.slice(a+1)),e},dr=function(g){return g?g<96?`cc${g}`:["aftertouch","velocity","pitch bend"][g-96]:"off"};N();var Gt=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],fr=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],hr=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var qr={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},Wr={66307:["drive"],66309:["vowel",g=>"aiueo"[g]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",g=>["off","LPF","HPF"][g]],94984:["noise type",g=>["white","pink"][g]],94987:["disc type",g=>["LP","SP","EP","RND"]],94990:["hum type",g=>`${g+5}0Hz`],94993:["M/S",g=>["mono","stereo"][g]]},Xt=function(g){return qr[(g[0]-32<<8)+g[1]]||`0x${g[0].toString(16).padStart(2,"0")}${g[1].toString(16).padStart(2,"0")}`},ur=function(g,e,a){let f=(g[0]-32<<16)+(g[1]<<8)+e,c=Wr[f]||{},p=c[0];if(p!=null&&p.length)return p+=`: ${(c[1]||function(){})(a)||a}`,p},Vt=[68,48,95,78,41,3,110,122,0];N();var ne=function(g=64){return Math.round(2e3*Math.log10(g/64))/100},pr=function(g,e,a){let f=[],c=a==!1?e.readIntVLV():a;g==0||g==127;for(let p=0;p<c;p++){let v=e.readInt(1);if(f.push(v),v!=247){if(v!=240){if(v>127)return console.debug(`Early termination: ${f}`),f.pop(),e.backOne(),e.backOne(),new Uint8Array(f)}}}return new Uint8Array(f)},Be=function(g){let e=0;return g.forEach(a=>{e+=a,e=e&127}),~e+1&127},me=function(g,e){let a=0,f=0;for(let c=0;c<g.length;c++){let p=c%8-1,v=(f>>p&1)<<7,w=g[c];w+=v,c%8!=0?(e(w,a,g),a++):f=g[c]}};var $t=function(g){let e=Math.floor(g*14.2);return e<128?e:0},A=function(){return!!self.Bun||self.debugMode||!1};var j=["?","gm","gs","sc","xg","g2","mt32","doc","qy10","qy20","ns5r","x5d","05rw","k11","sg","sd","krs","s90es","motif","trin"],Qr={gm2:"g2","mt-32":"mt32","c/m":"mt32",ag10:"05rw","ag-10":"05rw","05r/w":"05rw",x5:"05rw",x5dr:"x5d",gmega:"k11","kross 2":"krs","motif es":"motif","s90 es":"s90es",trinity:"trin","tr-rack":"trin"},Yr=["melodic","drum","menu"],gr={"?":[0,0,120,0,0],gm:[0,0,127,0,0],gs:[0,0,120,0,0],sc:[0,0,120,0,0],xg:[0,0,127,0,0],g2:[0,0,120,0,0],mt32:[0,127,127,0,127],doc:[57,112,127,57,112],qy10:[57,113,127,57,113],qy20:[57,114,127,57,114],ns5r:[0,0,61,0,0],x5d:[82,0,62,56,0],"05rw":[81,0,62,56,0],k11:[0,0,122,0,0],sg:[0,0,122,0,0],sd:[97,0,105,0,0],krs:[121,0,120,0,0],s90es:[0,0,127,0,0],motif:[0,0,127,0,0],trin:[0,0,127,0,0]},br=[9,25,41,57,73,89,105,121],Zr=[0,3,81,84,88],mr={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},yr={0:0,1:1,2:3,5:4},Er={0:0,1:1,2:2,5:3},vr=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],Kt=[36,37,48,49,52,53],Bt=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],wr={26:127,29:0,30:0,31:0,52:12,53:54},kt=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,128,12,13,16,17,18,19,14,15,20,21,26,28,22,80,81,82,83,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],Jr=[2,12,13,14,15,16,17,18,19,20,21,80,81,83,136,130,131,132,133,134,135,137,138,139,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157],jr=[33,102,99,32,100,8,9,10],$r=[0,16,25,32,40,64,24,48],x={};j.forEach((g,e)=>{x[g]=e});var E={length:kt.length};kt.forEach((g,e)=>{E[g]=e});var ue={length:Bt.length};Bt.forEach((g,e)=>{ue[g]=e});var ea={};Yr.forEach((g,e)=>{ea[g]=e});var ta=function(g){let e=[],a=0;return g==null||g.forEach(function(f,c){f==247?e.push(g.subarray(a,c)):f==240&&(a=c+1)}),e.length||e.push(g.subarray(0)),A()&&console.debug(e),e};var Ft=8,b={port:Ft,ch:Ft<<4,chShift:Math.ceil(Math.log2(Ft))+4,cc:kt.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,rpnt:4,nrpn:Kt.length,ace:8,drm:8,dpn:Bt.length,dnc:128,ext:3,efx:7,cvn:12,redir:32,vxPrim:3,invalidCh:255},$e={bank0:128},zt=new Uint16Array(b.ch),ra=new Uint16Array(b.ch),aa=new Uint16Array(b.ch),sa=new Uint16Array(b.ch),ia=new Uint16Array(b.ch),kr=new Array(b.drm);for(let g=0;g<b.ch;g++)zt[g]=g*b.cc,ra[g]=g*b.rpn,aa[g]=g*b.nrpn,sa[g]=g*b.ace,ia[g]=g*b.ext;for(let g=0;g<b.drm;g++){kr[g]=new Uint16Array(b.dpn);let e=g*b.dpn*b.dnc;for(let a=0;a<b.dpn;a++)kr[g][a]=e+a*b.dnc}var H,ee,ye,De,he,Re,Sr,pe,q,R,m,te,I,W,ce,Q,Z,Ae,xe,ze,oe,D,L,dt,se,Ee,le,ft,qe,K,Le,ve,xt,Ue,we,ht,Ne,Y,U,Se,St,G,We,ut,pt,He,_e,Ct,gt,Ce,V,Ot,Tt,Qe,de,Oe,Ge,re,Ye,z,Mt,It,Ze,Je,fe,ge,Te,je,et,tt,xr,za=(xr=class extends At{constructor(){super();C(this,he);P(this,"NOTE_IDLE",0);P(this,"NOTE_ATTACK",1);P(this,"NOTE_DECAY",2);P(this,"NOTE_SUSTAIN",3);P(this,"NOTE_HELD",4);P(this,"NOTE_RELEASE",5);P(this,"NOTE_SOSTENUTO_ATTACK",8);P(this,"NOTE_SOSTENUTO_DECAY",9);P(this,"NOTE_SOSTENUTO_SUSTAIN",10);P(this,"NOTE_SOSTENUTO_HELD",11);P(this,"CH_MELODIC",0);P(this,"CH_DRUMS",1);P(this,"CH_DRUM1",2);P(this,"CH_DRUM2",3);P(this,"CH_DRUM3",4);P(this,"CH_DRUM4",5);P(this,"CH_DRUM5",6);P(this,"CH_DRUM6",7);P(this,"CH_DRUM7",8);P(this,"CH_DRUM8",9);P(this,"DUMP_ALL",0);P(this,"DUMP_ONCE",1);P(this,"DUMP_MODE",2);P(this,"EXT_NONE",0);P(this,"EXT_VL",1);P(this,"EXT_DX",3);P(this,"VLBC_BRTHEXPR",1);P(this,"VLBC_VELOINIT",2);P(this,"VLBC_VELOALL",3);P(this,"CH_INACTIVE",0);P(this,"CH_ACTIVE",1);P(this,"CH_DISABLED",2);C(this,H,0);C(this,ee,0);C(this,ye,0);C(this,De,new Array(11));C(this,pe,new Uint8Array(b.ch));C(this,q,new Uint8Array(b.ch));C(this,R,new Uint8Array(b.ch));C(this,m,new Uint8Array(b.ch*b.cc));C(this,te,new Uint8Array(b.ch*b.ace));C(this,I,new Uint8Array(b.ch*b.vxPrim));C(this,W,new Uint8Array(b.ch*b.nn));C(this,ce,new Uint8Array(b.ch));C(this,Q,new Uint16Array(b.pl));C(this,Z,new Uint8Array(b.pl));C(this,Ae,new Int16Array(b.ch));C(this,xe,new Uint8Array(b.ch));C(this,ze,new Uint8Array(b.ch));C(this,oe,new Uint8Array(b.ch*b.ext));C(this,D,new Uint8Array(b.ch*b.rpn));C(this,L,new Uint8Array(b.ch*b.rpnt));C(this,dt,new Int8Array(b.ch*Kt.length));C(this,se,new Uint8Array(b.drm*b.dpn*b.dnc));C(this,Ee,new Uint8Array(b.drm*2));C(this,le,new Uint8Array(b.efx*3));C(this,ft,new Uint8Array(b.ch));C(this,qe,new Uint8Array(b.ch*b.redir));C(this,K,new Uint8Array(b.port));C(this,Le,new Uint8Array(b.ch));C(this,ve,new Uint8Array(b.ch));C(this,xt,new Uint8Array(b.ch*b.cvn));C(this,Ue,new Uint8Array(128));C(this,we,new Uint8Array(b.cmt*8));C(this,ht,new Uint8Array(1024));C(this,Ne,new Uint8Array(b.cmt*64));C(this,Y,{});P(this,"modelEx",{sc:{showBar:!0,invBar:!1,invDisp:!1,peakHold:1}});C(this,U,void 0);C(this,Se,void 0);C(this,St,void 0);C(this,G,100);C(this,We,0);C(this,ut,500);C(this,pt,0);C(this,He,"");C(this,_e,0);C(this,Ct,0);C(this,gt,0);C(this,Ce,!0);C(this,V,!1);C(this,Ot,1);C(this,Tt,void 0);C(this,Qe,new Array(b.ch));C(this,de,[]);C(this,Oe,new Uint8Array(b.ch));C(this,Ge,new Uint8Array(b.tr));P(this,"baseBank",new Ht("gm2","ns5r","xg","gs","sd","gmega","plg-vl","plg-pf","plg-dx","plg-an","plg-dr","plg-sg","kross","s90es"));P(this,"userBank",new Ht("gm"));P(this,"initOnReset",!1);P(this,"aiEfxName","");C(this,re,[]);C(this,Ye,void 0);C(this,z,{nOff:(e,a)=>{let f=e*128+a,c=t(this,Q).lastIndexOf(f);if(c>-1)if(t(this,m)[b.cc*e+E[64]]>63)t(this,Z)[c]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:a,velo:t(this,W)[f],state:this.NOTE_HELD});else if(t(this,m)[b.cc*e+E[66]]>63&&t(this,Z)[c]==this.NOTE_SOSTENUTO_SUSTAIN)t(this,Z)[c]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:a,velo:t(this,W)[f],state:this.NOTE_SOSTENUTO_HELD});else{t(this,Q)[c]=0,t(this,W)[f]=0,t(this,Z)[c]=this.NOTE_IDLE;let p=this.getExt(e)[1];(p==this.VLBC_VELOINIT||p==this.VLBC_VELOALL)&&(t(this,m)[b.cc*e+E[129]]=0),this.dispatchEvent("note",{part:e,note:a,velo:0,state:this.NOTE_IDLE})}},nOn:(e,a,f)=>{let c=e*128+a,p=0;for(t(this,ce)[e]&&t(this,z).ano(e);t(this,Z)[p]>0&&t(this,Q)[p]!=c;)p++;if(p<b.pl){t(this,Q)[p]=c,t(this,W)[c]=f,t(this,Z)[p]=this.NOTE_SUSTAIN,t(this,xe)[e]<f&&(t(this,xe)[e]=f);let v=this.getExt(e)[1];(v==this.VLBC_VELOINIT||v==this.VLBC_VELOALL)&&(t(this,m)[b.cc*e+E[129]]=f),this.dispatchEvent("note",{part:e,note:a,velo:f,state:this.NOTE_SUSTAIN})}else console.error("Polyphony exceeded.")},nAt:(e,a,f)=>{},cAt:(e,a)=>{},hoOf:e=>{t(this,Z).forEach((a,f)=>{if(a==this.NOTE_HELD){let c=t(this,Q)[f],p=c>>7;e==p&&(t(this,Z)[f]=this.NOTE_IDLE,t(this,Q)[f]=0,t(this,W)[c]=0,this.dispatchEvent("note",{part:e,note:c&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{t(this,Z).forEach((a,f)=>{let c;switch(a){case this.NOTE_ATTACK:{c=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{c=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{c=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(c){t(this,Z)[f]=c;let p=t(this,Q)[f];this.dispatchEvent("note",{part:e,note:p&127,velo:t(this,W)[p],state:c})}})},soOf:e=>{t(this,Z).forEach((a,f)=>{if(a==this.NOTE_SOSTENUTO_HELD){let c=t(this,Q)[f],p=c>>7;e==p&&(t(this,Z)[f]=this.NOTE_IDLE,t(this,Q)[f]=0,t(this,W)[c]=0,this.dispatchEvent("note",{part:e,note:c&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{t(this,Q).forEach((a,f,c)=>{let p=a>>7,v=a&127;a==0&&t(this,W)[0]==0||p==e&&t(this,z).nOff(p,v)})}});C(this,Mt,{8:function(e){let a=e.channel,f=e.data[0];t(this,z).nOff(a,f)},9:function(e){let a=e.channel,f=this;if(f.getChModeId(a)==x.xg&&t(f,R)[a]>1){let v=f.getChDrumFirstWrite(a);v[0]&&v[1]!=b.invalidCh&&!t(f,pe)[a]&&(f.copyChSetup(v[1],a),f.dispatchEvent("voice",{part:a}),console.debug(`Part CH${a+1} copied from CH${v[1]}.`))}f.setChActive(a,1);let c=e.data[0],p=e.data[1];p>0?t(f,z).nOn(a,c,p):t(f,z).nOff(a,c)},10:function(e){let a=e.channel,f=a*128+e.data[0];t(this,Q).indexOf(f)>-1&&(t(this,W)[f]=data[1],this.getExt(a)[1]==this.VLBC_VELOALL&&(t(this,m)[b.cc*a+E[129]]=data[1]),this.dispatchEvent("note",{part:a,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let a=e.channel,f=this,c=t(this,Qe)[a],p=c[e.data[0]];p&&(e.data[0]=p),[0,32].indexOf(e.data[0])>-1&&(()=>{switch(t(this,H)){case x.s90es:case x.motif:{if(e.data[0]==0){[0,63].indexOf(e.data[1])>-1&&this.setChActive(a,1);break}e.data[1]&&this.setChActive(a,1);break}default:{this.setChActive(a,1);break}}})();let v=a*b.cc,w=a*b.ext,$=this.getChModeId(a);switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{t(this,z).ano(a),t(this,Ae)[a]=0,t(this,m)[v+E[1]]=0,t(this,m)[v+E[5]]=0,t(this,m)[v+E[64]]=0,t(this,m)[v+E[65]]=0,t(this,m)[v+E[66]]=0,t(this,m)[v+E[67]]=0,t(this,m)[v+E[11]]=127,t(this,m)[v+E[101]]=127,t(this,m)[v+E[100]]=127,t(this,m)[v+E[99]]=127,t(this,m)[v+E[98]]=127;return}case 123:{t(this,z).ano(a);return}case 124:{t(this,z).ano(a);return}case 125:{t(this,z).ano(a);return}case 126:{t(this,ce)[a]=1,t(this,z).ano(a);return}case 127:{t(this,ce)[a]=0,t(this,z).ano(a);return}}if(E[e.data[0]]==null)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(Jr.indexOf(e.data[0])>-1&&this.allocateAce(a,e.data[0]),e.data[0]){case 0:{switch(A()&&console.debug(`${j[t(this,H)]}, CH${a+1}: ${e.data[1]}`),t(this,H)==0?e.data[1]<48?(t(this,R)[a]>0&&(e.data[1]=t(this,m)[v],e.data[1]=120,console.debug(`Forced channel ${a+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]==56?this.switchMode(t(this,U).x5==82?"x5d":"05rw"):e.data[1]==62?this.switchMode(t(this,U).x5==82?"x5d":"05rw"):e.data[1]==63?this.switchMode(j[t(this,U).ds]):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg"):t(this,H)==x.gs||t(this,H)==x.sc?e.data[1]<56&&t(this,R)[a]>0&&(e.data[1]=t(this,m)[v],e.data[1]=120,console.debug(`Forced channel ${a+1} to stay drums.`)):t(this,H)==x.gm&&(e.data[1]<48?t(this,R)[a]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${a+1} to stay drums.`)):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg",!0)),t(this,H)){case x.xg:{[79,95,126,127].indexOf(e.data[1])>-1?t(this,R)[a]==0&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):t(this,R)[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`)),[33,81,97].indexOf(e.data[1])>-1?t(this,oe)[w]=this.EXT_VL:[35,67,83,99].indexOf(e.data[1])>-1?t(this,oe)[w]=this.EXT_DX:t(this,oe)[w]=this.EXT_NONE;break}case x["05rw"]:case x.x5d:case x.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?t(this,R)[a]==this.CH_MELODIC&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):[80,81,82,83].indexOf(e.data[1])>-1||t(this,R)[a]!=this.CH_MELODIC&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}case x.sd:{[104,105,106,107].indexOf(e.data[1])>-1?t(this,R)[a]==0&&(this.setChType(a,this.CH_DRUM2),console.debug(`CH${a+1} set to drums by MSB.`)):t(this,R)[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}case x.g2:{e.data[1]==120?t(this,R)[a]==0&&(this.setChType(a,this.CH_DRUMS),console.debug(`CH${a+1} set to drums by MSB.`)):t(this,R)[a]>0&&(this.setChType(a,this.CH_MELODIC),console.debug(`CH${a+1} set to melodic by MSB.`));break}}break}case 2:{this.getExt(a)[1]==this.VLBC_BRTHEXPR&&(t(this,m)[v+E[129]]=e.data[1]);break}case 6:{if(t(this,ze)[a]){[x.xg,x.gs,x.sc,x.ns5r].indexOf(t(this,H))<0&&console.warn(`NRPN commits are not available under "${j[t(this,H)]}" mode, even when they are supported in Octavia.`);let r=t(this,m)[v+E[99]],i=t(this,m)[v+E[98]];if(r==1){let d=jr.indexOf(i);if(d>-1)t(this,m)[v+E[71+d]]=e.data[1],A()&&console.debug(`Redirected NRPN 1 ${i} to cc${71+d}.`),this.dispatchEvent("cc",{part:a,cc:71+d,data:e.data[1]});else{let s=Kt.indexOf(i);s>-1?t(this,dt)[a*10+s]=e.data[1]-64:console.warn(`NRPN 0x01${i.toString(16).padStart(2,"0")} is not supported.`),A()&&console.debug(`CH${a+1} voice NRPN ${i} commit`)}}else{if(Bt.indexOf(r)<0){let s=`NRPN 0x${r.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")} `;r==127?console.warn(`${s}is not necessary. Consider removing it.`):console.warn(`${s}is not supported.`)}else{let s=t(this,R)[a]-2;s<0?console.warn(`CH${a+1} cannot accept drum NRPN as type ${wt[t(this,R)[a]]}.`):t(this,se)[(s*b.dpn+ue[r])*b.dnc+i]=e.data[1]}A()&&console.debug(`CH${a+1} (${wt[t(this,R)[a]]}) drum NRPN ${r} commit`)}}else{let r=yr[t(this,m)[v+E[100]]],i=Er[t(this,m)[v+E[100]]];if(t(this,m)[v+E[101]]==0&&r!=null)switch(A()&&console.debug(`CH${a+1} RPN 0 ${t(this,m)[v+E[100]]} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],vr[r][0]),vr[r][1]),t(this,D)[a*b.rpn+r]=e.data[1],t(this,L)[a*b.rpnt+i]=1,$){case x.xg:case x.gs:case x.sc:case x.mt32:case x.s90es:case x.motif:{switch(t(this,m)[v+E[100]]){case 1:case 2:{this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)});break}}break}default:this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)})}}break}case 32:{switch(A()&&console.debug(`${j[t(this,H)]}, CH${a+1} LSB: ${e.data[1]}`),t(this,H)){case x.s90es:case x.motif:{this.setChType(a,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,t(this,H),!0);break}}this.getExt(a)[0]==this.EXT_DX;break}case 38:{if(!t(this,ze)[a]){let r=yr[t(this,m)[v+100]],i=Er[t(this,m)[v+100]];t(this,m)[v+101]==0&&r!=null&&(t(this,D)[a*b.rpn+r+1]=e.data[1],t(this,L)[a*b.rpnt+i]=1)}break}case 64:{e.data[1]<64&&t(this,z).hoOf(a);break}case 66:{e.data[1]>>6?t(this,z).soOn(a):t(this,z).soOf(a);break}case 98:case 99:{t(this,ze)[a]=1;break}case 100:case 101:{t(this,ze)[a]=0;break}}t(this,m)[v+E[e.data[0]]]=e.data[1],this.dispatchEvent("cc",{part:a,cc:e.data[0],data:e.data[1]})}f.getChModeId(a)==x.xg&&t(f,R)[a]&&f.setDrumFirstWrite(a)},12:function(e){let a=e.channel,f=this;switch(t(f,H)){case x.s90es:case x.motif:{e.data&&f.setChActive(a,1);break}default:f.setChActive(a,1)}if(f.getExt(a)[0]==f.EXT_DX){let c=b.cc*a}t(f,I)[a]=e.data,t(f,ve)[a]=0,f.pushChPrimitives(a),A()&&console.debug(`T:${e.track} C:${a} P:${e.data}`),f.dispatchEvent("voice",{part:a}),f.getChModeId(a)==x.xg&&t(f,R)[a]&&f.setDrumFirstWrite(a)},13:function(e){let a=this,f=e.channel;t(this,Q).forEach(function(c){let p=c>>7;f==p&&(t(a,W)[c]=e.data,a.dispatchEvent("note",{part:f,note:c&127,velo:e.data,state:a.NOTE_SUSTAIN}))})},14:function(e){let a=e.channel;t(this,Ae)[a]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:a,pitch:this.getPitchShift(a)})},15:function(e){ta(e.data).forEach(a=>{let f=a[0],c=a[1];(t(this,It)[f]||function(){console.debug(`Unknown manufacturer ${f}.`)})(c,a.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(t(this,re)[e.meta]||function(f,c,p){}).call(this,e.data,e.track,e.meta),e.meta!=32&&S(this,We,0);let a=Zr.indexOf(e.meta)>-1;if(A()&&console.debug(e),a)return e.reply="meta",e}});C(this,It,{64:(e,a,f)=>{t(this,je).run(a,f,e)},65:(e,a,f)=>{if(a[0]<16)if(a[1]==72){let c=a[a.length-1],p=Be(a.subarray(3,a.length-1));c==p?t(this,ge).run(a.subarray(0,a.length-1),f,e):console.warn(`Bad SD checksum ${c} - should be ${p}.`)}else t(this,ge).run(a,f,e);else{let c=a[a.length-1],p=Be(a.subarray(2,a.length-1));c==p?t(this,ge).run(a.subarray(0,a.length-1),f,e):console.warn(`Bad GS checksum ${c} - should be ${p}.`)}},66:(e,a,f)=>{t(this,Te).run(a,f,e)},67:(e,a,f)=>{t(this,fe).run(a,f,e)},68:(e,a,f)=>{t(this,tt).run(a,f,e)},71:(e,a,f)=>{t(this,et).run(a,f,e)},126:(e,a,f)=>{t(this,Ze).run(a,f,e)},127:(e,a,f)=>{this.switchMode("gm"),t(this,Je).run(a,f,e)}});C(this,Ze,void 0);C(this,Je,void 0);C(this,fe,void 0);C(this,ge,void 0);C(this,Te,void 0);C(this,je,void 0);C(this,et,void 0);C(this,tt,void 0);let e=this;S(e,he,new Uint8Array(256),Sr),t(e,De)[10]=new Uint8Array(512),S(e,Ye,new be),S(e,U,{x5:82,ds:x.krs,smotif:x.s90es,gs:4,sc:3}),S(e,Se,{dumpLimit:e.DUMP_MODE}),S(e,St,new Proxy(t(e,Se),{set:()=>{}}));for(let r in gr){let i=x[r];i==null?console.debug(`SubDB build error: "${r}" does not exist`):t(e,Y)[i]=new Uint8Array(gr[r])}e.userBank.strictMode=!0,e.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),e.addEventListener("metacommit",function(r){var d,s;let{data:i}=r;((d=t(e,de)[0])==null?void 0:d.type)==i.type&&((s=t(e,de)[0])!=null&&s.amend)?(t(e,de)[0].amend=i.amend,t(e,de)[0].data+=i.data):t(e,de).unshift(i)}),t(e,re)[1]=function(r){var i,d,s,n,o;switch(r=r.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),r.slice(0,2)){case"@I":{S(this,V,!0),this.dispatchEvent("metacommit",{type:"Kar.Info",data:(i=r.slice(2))==null?void 0:i.trimLeft()});break}case"@K":{S(this,V,!0),this.dispatchEvent("metacommit",{type:"Kar.Mode",data:(d=r.slice(2))==null?void 0:d.trimLeft()}),console.debug(`Karaoke mode active: ${r.slice(2)}`);break}case"@L":{S(this,V,!0),this.dispatchEvent("metacommit",{type:"Kar.Lang",data:(s=r.slice(2))==null?void 0:s.trimLeft()});break}case"@T":{S(this,V,!0),this.dispatchEvent("metacommit",{type:"KarTitle",data:(n=r.slice(2))==null?void 0:n.trimLeft()});break}case"@V":{S(this,V,!0),this.dispatchEvent("metacommit",{type:"Kar.Ver.",data:(o=r.slice(2))==null?void 0:o.trimLeft()});break}case"XF":{let l=r.slice(2).split(":");switch(l[0]){case"hd":{l.slice(1).forEach((u,h)=>{u.length&&this.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][h],data:u})});break}case"ln":{l.slice(1).forEach((u,h)=>{u.length&&this.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][h],data:u})});break}default:this.dispatchEvent("metacommit",{type:"XfUnData",data:r})}break}default:t(this,V)?r[0]=="\\"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:r.slice(1),amend:!0})):r[0]=="/"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:r.slice(1),mask:!0,amend:!0})):this.dispatchEvent("metacommit",{type:"KarLyric",data:r,amend:!0}):r.split(`
`).forEach((l,u)=>{this.dispatchEvent("metacommit",{type:"Cmn.Text",data:l,mask:u!=0})})}},t(e,re)[2]=function(r){this.dispatchEvent("metacommit",{type:"Copyrite",data:r})},t(e,re)[3]=function(r,i){i<1&&t(this,We)<1&&this.dispatchEvent("metacommit",{type:"TrkTitle",data:r})},t(e,re)[4]=function(r,i){this.dispatchEvent("metacommit",{type:"Instrmnt",data:r})},t(e,re)[5]=function(r){r.trim()==""?this.dispatchEvent("metacommit",{type:"C.Lyrics",data:"",amend:!1}):this.dispatchEvent("metacommit",{type:"C.Lyrics",data:r,amend:!0})},t(e,re)[6]=function(r){this.dispatchEvent("metacommit",{type:"C.Marker",data:r})},t(e,re)[7]=function(r){this.dispatchEvent("metacommit",{type:"CuePoint",data:r})},t(e,re)[32]=function(r){S(this,We,r[0]+1)},t(e,re)[33]=function(r,i){A()&&console.debug(`Track ${i} requests to get assigned to output ${r}.`),t(e,Ge)[i]=r+1},t(e,re)[81]=function(r,i){S(e,ut,r/1e3)},t(e,re)[127]=function(r,i){t(e,Ye).run(r,i)},t(e,Ye).default=function(r){console.warn(`Unrecognized sequencer-specific byte sequence: ${r}`)},t(e,Ye).add([67,0,1],function(r,i){A()&&console.debug(`XGworks requests assigning track ${i} to output ${r[0]}.`),t(e,Ge)[i]=r[0]+1}),S(e,Ze,new be("universal non-realtime")),S(e,Je,new be("universal realtime")),S(e,fe,new be("Yamaha")),S(e,ge,new be("Roland")),S(e,Te,new be("Korg")),S(e,je,new be("Kawai")),S(e,et,new be("Akai")),S(e,tt,new be("Casio"));let a=new be("DX7+ Dump"),f=function(r){console.info(`Unrecognized SysEx in "${this.name}" set.
%o`,r)};t(e,Ze).default=f,t(e,Je).default=f,t(e,fe).default=f,t(e,ge).default=f,t(e,Te).default=f,t(e,je).default=f,t(e,et).default=f,t(e,tt).default=f,a.default=f,t(e,Ze).add([9],(r,i,d)=>{e.switchMode(["gm","?","g2"][r[0]-1],!0),e.setPortMode(e.getTrackPort(i),1,x[["gm","?","g2"][r[0]-1]]),S(e,V,t(e,V)||!1),console.info(`MIDI reset: ${["GM","Init","GM2"][r[0]-1]}`),r[0]==2&&e.init()}),t(e,Je).add([4,1],(r,i,d)=>{e.dispatchEvent("mupromptex"),S(e,G,((r[1]<<7)+r[0])/16383*100),e.dispatchEvent("mastervolume",t(e,G))}).add([4,3],(r,i,d)=>((r[1]<<7)+r[0]-8192)/8192).add([4,4],(r,i,d)=>r[1]-64).add([4,5],(r,i,d)=>{e.dispatchEvent("mupromptex");let s=r[0],n=r[1],o=r[2],l=3,u=l+(s<<1),h=u+n;if(s!=1){console.error(`Unsupported GM2 global parameter set: slotpath length too long (${s})!
`,r);return}let y=0,k=0,T=0;switch(r.subarray(l,u).forEach(M=>{y=y<<7,y|=M}),r.subarray(u,h).forEach((M,B)=>{k|=M<<B*7}),r.subarray(h).forEach((M,B)=>{T|=M<<B*7}),A()&&console.debug(`GM2 global parameter: (${r.subarray(3,u)}; p: ${k}, v: ${T})`),y){case 129:{k==0&&(e.setEffectType(0,52,T),e.dispatchEvent("efxreverb",e.getEffectType(0)));break}case 130:{k==0&&(e.setEffectType(1,52,T|16),e.dispatchEvent("efxchorus",e.getEffectType(1)));break}default:A()&&console.debug("GM2 global paramater slot path unknown.")}}),t(this,fe).add([76,0,0],(r,i,d)=>{switch(r[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset: ${r}`);break}case 126:{e.switchMode("xg",!0),e.setPortMode(e.getTrackPort(i),4,x.xg),S(e,V,!1),console.info("MIDI reset: XG");break}default:{e.dispatchEvent("mupromptex");let s=[0,0,0,0],n=(o,l)=>{s[l]=o};if(r.subarray(1).forEach((o,l)=>{let u=l+r[0];([n,n,n,n,h=>{S(this,G,h*129/16383*100),e.dispatchEvent("mastervolume",t(e,G))},h=>{},h=>{}][u]||(()=>{}))(o,l)}),r[0]<4){let o=0;s.forEach(l=>{o=o<<4,o+=l}),o-=1024}}}}).add([76,2,1],(r,i,d)=>{e.dispatchEvent("mupromptex");let s="XG ";r[0]<32?(s+="reverb ",r.subarray(1).forEach((n,o)=>{([l=>{e.setEffectTypeRaw(0,!1,l),console.info(`${s}main type: ${vt[l]}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},l=>{e.setEffectTypeRaw(0,!0,l),console.debug(`${s}sub type: ${l+1}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},l=>{console.debug(`${s}time: ${nr(l)}s`)},l=>{console.debug(`${s}diffusion: ${l}`)},l=>{console.debug(`${s}initial delay: ${l}`)},l=>{console.debug(`${s}HPF cutoff: ${lt[l]}Hz`)},l=>{console.debug(`${s}LPF cutoff: ${lt[l]}Hz`)},l=>{console.debug(`${s}width: ${l}`)},l=>{console.debug(`${s}height: ${l}`)},l=>{console.debug(`${s}depth: ${l}`)},l=>{console.debug(`${s}wall type: ${l}`)},l=>{console.debug(`${s}dry/wet: ${l}`)},l=>{console.debug(`${s}send: ${ne(l)}dB`)},l=>{console.debug(`${s}pan: ${l-64}`)},!1,!1,l=>{console.debug(`${s}delay: ${l}`)},l=>{console.debug(`${s}density: ${l}`)},l=>{console.debug(`${s}balance: ${l}`)},l=>{},l=>{console.debug(`${s}feedback: ${l}`)},l=>{}][r[0]+o]||function(){console.warn(`Unknown XG reverb address: ${r[0]}.`)})(n)})):r[0]<64?(s+="chorus ",r.subarray(1).forEach((n,o)=>{([l=>{e.setEffectTypeRaw(1,!1,l),console.info(`${s}main type: ${vt[l]}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},l=>{e.setEffectTypeRaw(1,!0,l),console.debug(`${s}sub type: ${l+1}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},l=>{console.debug(`${s}LFO: ${ir[l]}Hz`)},l=>{},l=>{console.debug(`${s}feedback: ${l}`)},l=>{console.debug(`${s}delay offset: ${cr(l)}ms`)},l=>{},l=>{console.debug(`${s}low: ${lt[l]}Hz`)},l=>{console.debug(`${s}low: ${l-64}dB`)},l=>{console.debug(`${s}high: ${lt[l]}Hz`)},l=>{console.debug(`${s}high: ${l-64}dB`)},l=>{console.debug(`${s}dry/wet: ${l}`)},l=>{console.debug(`${s}send: ${ne(l)}dB`)},l=>{console.debug(`${s}pan: ${l-64}`)},l=>{console.debug(`${s}to reverb: ${ne(l)}dB`)},!1,l=>{},l=>{},l=>{},l=>{console.debug(`${s}LFO phase diff: ${(l-64)*3}deg`)},l=>{console.debug(`${s}input mode: ${l?"stereo":"mono"}`)},l=>{}][r[0]-32+o]||function(){console.warn(`Unknown XG chorus address: ${r[0]}.`)})(n)})):r[0]<86?(s+="variation ",r.subarray(1).forEach((n,o)=>{([l=>{e.setEffectTypeRaw(2,!1,l),console.info(`${s}main type: ${vt[l]}`),e.dispatchEvent("efxdelay",e.getEffectType(2))},l=>{e.setEffectTypeRaw(2,!0,l),console.debug(`${s}sub type: ${l+1}`),e.dispatchEvent("efxdelay",e.getEffectType(2))}][r[0]-64+o]||function(){})(n)})):r[0]<97?(s+="variation ",r.subarray(1).forEach((n,o)=>{[l=>{console.debug(`${s}send: ${ne(l)}dB`)},l=>{console.debug(`${s}pan: ${l-64}`)},l=>{console.debug(`${s}to reverb: ${ne(l)}dB`)},l=>{console.debug(`${s}to chorus: ${ne(l)}dB`)},l=>{console.debug(`${s}connection: ${l?"system":"insertion"}`)},l=>{console.debug(`${s}channel: CH${l+1}`)},l=>{console.debug(`${s}mod wheel: ${l-64}`)},l=>{console.debug(`${s}bend wheel: ${l-64}`)},l=>{console.debug(`${s}channel after touch: ${l-64}`)},l=>{console.debug(`${s}AC1: ${l-64}`)},l=>{console.debug(`${s}AC2: ${l-64}`)}][r[0]-86+o](n)})):r[0]>111&&r[0]<118?s+="variation ":console.warn(`Unknown XG variation address: ${r[0]}`)}).add([76,2,64],(r,i,d)=>{r.subarray(1).forEach((s,n)=>{let o=n+r[0];if(o==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][s]}`);else{let l=o-1>>2,u=o-1&3,h=`XG EQ ${l} ${["gain","freq","Q","shape"][u]}: `;[()=>{console.debug(`${h}${s-64}dB`)},()=>{console.debug(`${h}${s} (raw)`)},()=>{console.debug(`${h}${s/10}`)},()=>{console.debug(`${h}${["shelf","peak"][+!!s]}`)}][u]()}})}).add([76,3],(r,i,d)=>{e.dispatchEvent("mupromptex");let s=r[0],n=r[1],o=`XG Insertion ${r[0]+1} `;r.subarray(2).forEach((l,u)=>{([h=>{e.setEffectTypeRaw(3+s,!1,h),console.info(`${o}main type: ${vt[h]}`),e.dispatchEvent(`efxinsert${s}`,e.getEffectType(3+s))},h=>{e.setEffectTypeRaw(3+s,!0,h),console.debug(`${o}sub type: ${h+1}`),e.dispatchEvent(`efxinsert${s}`,e.getEffectType(3+s))}][n+u]||function(){})(l)})}).add([76,6,0],(r,i,d)=>{let s=r[0];s<64?e.setLetterDisplay(r.subarray(1),"XG letter display",s):S(e,_e,Date.now())}).add([76,7,0],(r,i,d)=>{let s=r[0];S(e,ee,0),S(e,ye,Date.now()+3200),t(e,he,Re).fill(0);let n=r.subarray(1);for(let o=0;o<s;o++)n.unshift(0);n.forEach(function(o,l){let u=Math.floor(l/16),h=l%16,y=(h*3+u)*7,k=7,T=0;for(y-=h*5,u==2&&(k=2);T<k;)t(e,he,Re)[y+T]=o>>6-T&1,T++})}).add([76,8],(r,i)=>{e.dispatchEvent("mupromptex");let d=e.chRedir(r[0],i,!0),s=r[1],n=b.cc*d,o=`XG CH${d+1} `,l=`Unknown XG part address ${s}.`,u=!0;r.subarray(2).forEach((h,y)=>{u=!0,s<1?console.debug(l):s<41?([()=>{t(e,m)[n+E[0]]=h,e.pushChPrimitives(d),e.dispatchEvent("voice",{part:d})},()=>{t(e,m)[n+E[32]]=h,e.pushChPrimitives(d),e.dispatchEvent("voice",{part:d})},()=>{t(e,I)[d]=h,e.dispatchEvent("voice",{part:d})},()=>{u=!1;let k=e.chRedir(h,i,!0);t(e,q)[d]=k,d!=k&&(e.buildRchTree(),console.info(`${o}receives from CH${k+1}`)),t(e,pe)[d]||(e.copyChSetup(k,d,!0),console.debug(`${o}copied from CH${k+1}.`),e.setChActive(d,1),e.dispatchEvent("voice",{part:d}))},()=>{t(e,ce)[d]=+!h},()=>{},()=>{u=!1,e.setChType(d,h,x.xg),console.debug(`${o}type: ${wt[h]||h}`),e.dispatchEvent("voice",{part:d})},()=>{t(e,D)[b.rpn*d+3]=h,t(e,L)[b.rpnt*d+2]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)})},!1,!1,()=>{t(e,m)[n+E[7]]=h},!1,!1,()=>{t(e,m)[n+E[10]]=h||128},!1,!1,()=>{t(e,m)[n+E[128]]=h,e.allocateAce(d,128)},()=>{t(e,m)[n+E[93]]=h},()=>{t(e,m)[n+E[91]]=h},()=>{t(e,m)[n+E[94]]=h},()=>{t(e,m)[n+E[76]]=h},()=>{t(e,m)[n+E[77]]=h},()=>{t(e,m)[n+E[78]]=h},()=>{t(e,m)[n+E[74]]=h},()=>{t(e,m)[n+E[71]]=h},()=>{t(e,m)[n+E[73]]=h},()=>{t(e,m)[n+E[75]]=h},()=>{t(e,m)[n+E[72]]=h}][s+y-1]||(()=>{}))():s<48?console.debug(l):s<111?s>102&&s<105&&(t(e,m)[n+E[[5,65][s&1]]]=h):s<114?console.debug(l):s<116?console.debug(`${o}EQ ${["bass","treble"][s&1]} gain: ${h-64}dB`):s<118?console.debug(l):s<120?console.debug(`${o}EQ ${["bass","treble"][s&1]} freq: ${h}`):console.debug(l)}),u&&t(e,R)[d]>1&&e.setDrumFirstWrite(d)}).add([76,9],(r,i)=>{let d=e.chRedir(r[0],i,!0),s=r[1],n=b.cc*d,o=`PLG-VL CH${d+1} `;r.subarray(2).forEach((l,u)=>{let h=u+s;switch(h){case 1:{console.info(`${o}breath mode: ${["system","breath","velocity","touch EG"][l]}`);break}case 0:case 27:case 28:break;default:if(h<27){let y=h-3>>1,k=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][y];h&1?h<23?(console.debug(`${o}${k} control source: ${dr(l)}`),l&&l<96&&e.allocateAce(d,130+y),t(e,qe)[b.redir*d+y+2]=l,e.buildRccMap()):console.debug(`${o}${k} scale break point: ${l}`):(console.debug(`${o}${k} depth: ${l-64}`),t(e,m)[n+E[130+y]]=l)}}})}).add([76,10],(r,i,d)=>{}).add([76,16],(r,i,d)=>{}).add([76,17,0,0],(r,i,d)=>{}).add([76,112],(r,i,d)=>{switch(console.debug(`XG enable PLG-${["VL","SG","DX","AN","PF","DR","PC","AP"][r[0]]} for CH${r[2]+1}.`),r[0]){case 0:{t(e,oe)[b.ext*r[2]]=e.EXT_VL;break}case 2:{t(e,oe)[b.ext*r[2]]=e.EXT_DX;break}default:t(e,oe)[b.ext*r[2]]=e.EXT_NONE}}).add([73,0,0],(r,i)=>{let d=r[0],s="MU1000 System - ";r.subarray(1).forEach((n,o)=>{let l=d+o;l==8?console.debug(`${s}LCD contrast: ${n}.`):l==18?(t(e,Y)[x.xg][1]=n?126:0,console.debug(`${s}default bank: ${n?"MU100 Native":"MU Basic"}.`),e.dispatchEvent("banklevel",{mode:"xg",data:+!!n}),e.forceVoiceRefresh()):l>=64&&l<69&&[()=>{e.dispatchEvent("channelactive",n)},()=>{n<8?(e.dispatchEvent("channelmin",n<<4),console.debug(`Octavia System: Minimum CH${(n<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{n<8?(e.dispatchEvent("channelmax",(n<<4)+15),console.debug(`Octavia System: Maximum CH${(n<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{S(e,Ce,!!n),console.info(`Octavia System: RS receiving ${["dis","en"][n]}abled.`)}][l-64]()})}).add([73,10,0],(r,i)=>{let d=r[0],s=`MU1000 RS${t(e,Ce)?"":" (ignored)"}: `;if(d<16)switch(d){case 2:{let n=e.chRedir(0,i,!0);t(e,Ce)&&(e.dispatchEvent("portrange",4),e.dispatchEvent("portstart",n)),console.info(`${s}Show CH${n+1}~CH${n+64}`);break}case 3:{let n=e.chRedir(r[1]<<5,i,!0);t(e,Ce)&&(e.dispatchEvent("portrange",2),e.dispatchEvent("portstart",n)),console.info(`${s}Show CH${n+1}~CH${n+32}`);break}default:console.debug(`${s}unknown switch ${d} invoked.`)}else if(d<32){if(t(e,Ce)){let n=e.chRedir(d-16+(t(e,gt)<<4),i,!0);e.dispatchEvent("channelactive",n)}}else if(d<36){let n=e.chRedir(d-32<<4,i,!0);t(e,Ce)&&(e.dispatchEvent("portrange",1),e.dispatchEvent("portstart",n>>4),S(e,gt,d-32)),console.info(`${s}Show CH${n+1}~CH${n+16}`)}}).add([73,11,0],(r,i)=>{let d="MU1000 System - channel ",s="Octavia System - channel ",n=r[0];r.subarray(1).forEach((o,l)=>{let u=n+l;([()=>{e.setChActive(o,1),e.dispatchEvent("channelactive",o),A()&&console.debug(`${d}current part: CH${o+1}`)},()=>{o<5?(e.dispatchEvent("portrange",1<<o),console.debug(`${d}port range: ${1<<o} port(s)`)):(e.dispatchEvent("portrange",0),console.debug(`${d}port range: reset`))},()=>{o<16?(e.dispatchEvent("portstart",o),console.debug(`${s}start port: ${"ABCDEFGHIJKLMNOP"[o]}`)):(e.dispatchEvent("portstart",255),console.debug(`${s}start port: reset`))}][u]||(()=>{console.debug(`${d}unknown address: ${u}`)}))()})}).add([93,3],(r,i)=>{let d=e.chRedir(r[0],i,!0),s=`PLG-SG CH${d+1} `,n=Date.now();if(r[1]==0){let o="",l=0;r.subarray(2).forEach((u,h)=>{h%2==0?o+=or[u]||u.toString().padStart("0"):l+=u*13}),n>=t(e,pt)&&this.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"SGLyrics",data:`${lr(o)}`,amend:!0}),S(e,pt,n+Math.ceil(l/2)+t(e,ut)),A()&&console.debug(`${s}vocals: ${o}`)}else console.warn(`Unknown PLG-SG data: ${r}`)}).add([98,0],(r,i,d)=>{e.dispatchEvent("mupromptex");let s=r[0],n=r.length-5,o=r.length-1;if(s!=n){console.info(`PLG-DX native dump size mismatch! Gave ${s} instead of ${r.length-5}.`);return}let l=Be(r.subarray(4,o));if(l!=r[o]){console.info(`Bad PLG-DX checksum ${r[o]} - should be ${l}.`);return}r[0]=98,t(e,fe).run(r.subarray(0,o),i,d,{noAce:!0})}).add([98,96],(r,i,d,s)=>{let n=e.chRedir(r[0],i,!0),o=b.cc*n,l=r[1];r.subarray(2).forEach((u,h)=>{let y=l+h;if(!(y<10)){if(y==10)e.resetAce();else if(y<27){let k=y+131;s!=null&&s.noAce||e.allocateAce(n,k),t(e,m)[o+E[k]]=u,e.dispatchEvent("cc",{part:n,cc:k,data:u})}}})}).add([100,0],(r,i,d)=>{let s=r.subarray(0,r.length-1);if(r[0]+5!=r.length){console.warn(`Yamaha DX7+ dump SysEx size mismatch! Expected ${r.length}, but got ${r[0]}:
`,r);return}let n=Be(s),o=r[r.length-1];if(n!=o){console.warn(`Yamaha DX7+ dump SysEx checksum mismatch! Expected ${n}, but got ${o}:
`,r);return}a.run(s.subarray(1))}).add([100,76],(r,i,d)=>{let s=r[0]>>4,n=r[0]&15,o=r[1];switch(s){case 2:{let l=e.chRedir(n,i,!0),u=b.cc*l;r.subarray(2).forEach((h,y)=>{let k=y+o;if(!(k<7)){if(k<23){let T=k+135;e.allocateAce(l,T),t(e,m)[u+E[T]]=h,e.dispatchEvent("cc",{part:l,cc:T,data:h})}}});break}default:console.info("Unknown DX7+ multipart: %o",r)}}).add([1,20],(r,i,d)=>{d==115?(e.switchMode("doc",!0),e.setPortMode(e.getTrackPort(i),1,x.doc),console.info("MIDI reset: DOC")):console.debug(`Unknown Yamaha SysEx: 67, ${d}, ${r.join(", ")}`)}).add([1,17,15,89],(r,i,d)=>{d==115?(e.setEffectType(0,24,r[0]|16),e.dispatchEvent("efxreverb",e.getEffectType(0))):console.debug(`Unknown Yamaha SysEx: 67, ${d}, ${r.join(", ")}`)}).add([1,24],(r,i,d)=>{if(d==115){for(let s=0;s<16;s++){let n=e.chRedir(s,i,!0);t(e,m)[n*b.cc+E[91]]=127}console.info("DOC Global Reverb: on")}else console.debug(`Unknown Yamaha SysEx: 67, ${d}, ${r.join(", ")}`)}),a.add([14,31],(r,i,d)=>{t(e,m)[b.cc*r[0]+E[64]]=0,t(e,z).ano(r[0]),e.switchMode("xg"),e.setPortMode(e.getTrackPort(i),1,x.xg),e.resetAce(),console.debug(`Yamaha DX7+ reset CH${r[0]+1}.`)}).add([76,112],async r=>{let i=r[0],d=b.cc*i,s=b.ext*i,n=b.cvn*i;t(e,oe)[s]=e.EXT_DX,t(e,ve)[i]=1;let o=t(e,xt).subarray(n,n+b.cvn);o.fill(32),r.subarray(1).forEach((l,u)=>{if(u<10)o[u]=Math.max(l,32);else if(!(u<40)){if(u<56){let h=u+102;t(e,m)[d+E[h]]=l,e.dispatchEvent("cc",{part:i,cc:h,data:l})}}}),t(e,I)[i]=i&127,t(e,m)[b.cc*i+E[0]]=35,t(e,m)[b.cc*i+E[32]]=i>>7|4,e.pushChPrimitives(i),e.dispatchEvent("voice",{part:i}),console.debug(`DX7+ CH${i+1} dump: %o`,r)});let c=function(r,i,d,s){},p=function(r,i){e.dispatchEvent("mupromptex");let d=r*b.dpn,s=i[0],n=i[1];i.subarray(2).forEach((o,l)=>{let u=l+n,h=-1;u<16?([()=>{h=24},()=>{h=25},()=>{h=26},()=>{},()=>{h=28},()=>{h=29},()=>{h=30},()=>{h=31},()=>{},()=>{},()=>{},()=>{h=20},()=>{h=21},()=>{h=22},()=>{h=23},()=>{}][u]||(()=>{console.debug(`Unknown XG-style drum param ${u} on set ${r+1}.`)}))():u<32||(u<40?([()=>{h=48},()=>{h=49},!1,!1,()=>{h=52},()=>{h=53}][u-32]||(()=>{console.debug(`Unknown XG-style drum param ${u} on set ${r+1}.`)}))():u<80||([()=>{h=36}][u-80]||(()=>{console.debug(`Unknown XG-style drum param ${u} on set ${r+1}.`)}))()),h>=0?(A()&&console.debug(d,h,s,o),t(e,se)[(d+ue[h])*b.dnc+s]=o):A()&&console.debug(`XG-style drum param ${u} has no writes.`)})},v=function(r,i,d){e.dispatchEvent("mupromptex");let s=r*b.dpn,n=(i<<7)+d[0];d.subarray(1).forEach((o,l)=>{let u=l+n,h=u&127,y=u>>7,k=-1;y>1&&([()=>{k=26},()=>{},()=>{k=28},()=>{k=29},()=>{k=30},()=>{},()=>{},()=>{k=31}][y-2]||(()=>{console.debug(`Unknown GS-style drum param ${y} on set ${r+1}.`)}))(),k>-1?(A()&&console.debug(s,k,h,o),t(e,se)[(s+ue[k])*b.dnc+h]=o):A()&&console.debug(`GS-style drum param ${y} has no writes.`)})};t(this,fe).add([76,48],(r,i,d)=>{p(0,r)}).add([76,49],(r,i,d)=>{p(1,r)}).add([76,50],(r,i,d)=>{p(2,r)}).add([76,51],(r,i,d)=>{p(3,r)}).add([76,52],(r,i,d)=>{p(4,r)}).add([76,53],(r,i,d)=>{p(5,r)}).add([76,54],(r,i,d)=>{p(6,r)}).add([76,55],(r,i,d)=>{p(7,r)}),t(this,fe).add([89,0],(r,i,d)=>{if(e.eprom){let s=r[0],n=(r[1]<<14)+(r[2]<<7)+r[3]+(e.eprom.offset||0);A()&&console.debug(`MU1000 EPROM trail to 0x${n.toString(16).padStart(6,"0")}, ${s} bytes.`);let o=e.eprom.data;r.subarray(4).forEach((l,u)=>{let h=u>>3,y=u&7;if(y==7)for(let k=0;k<7;k++)o[n+7*h+k]+=(l>>6-k&1)<<7;else o[n+7*h+y]=l})}}).add([89,1],(r,i,d)=>{let s=(r[0]<<21)+(r[1]<<14)+(r[2]<<7)+r[3];A()&&console.debug(`MU1000 EPROM jump to 0x${s.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=s)}).add([89,2],(r,i,d)=>{if(e.eprom){let s=(r[0]<<21)+(r[1]<<14)+(r[2]<<7)+r[3]+(e.eprom.offset||0);A()&&console.debug(`MU1000 EPROM write to 0x${s.toString(16).padStart(6,"0")}.`);let n=e.eprom.data;r.subarray(4).forEach((o,l)=>{let u=l>>3,h=l&7;if(h==7)for(let y=0;y<7;y++)n[s+7*u+y]+=(o>>6-y&1)<<7;else n[s+7*u+h]=o})}}).add([89,3],(r,i,d)=>{}),t(this,fe).add([39,48],(r,i,d)=>{}).add([43,0,0],(r,i,d)=>{e.dispatchEvent("mupromptex");let s=[0,0,0,0],n=(o,l)=>{s[l]=o};if(r.subarray(1).forEach((o,l)=>{let u=l+r[0];[n,n,n,n,()=>{S(this,G,o*129/16383*100),e.dispatchEvent("mastervolume",t(e,G))},()=>o-64,()=>o||128,()=>o,()=>o,()=>{console.debug(`TG300 variation on cc${o}.`)}][u](o,u)}),r[0]<4){let o=0;s.forEach(l=>{o=o<<4,o+=l}),o-=1024}}).add([43,1,0],(r,i,d)=>{e.dispatchEvent("mupromptex")}).add([43,2],(r,i,d)=>{e.dispatchEvent("mupromptex");let s=e.chRedir(r[0],i,!0),n=r[1],o=b.cc*s,l=`TG300 CH${s+1} `;r.subarray(2).forEach((u,h)=>{h<5?([()=>{},()=>{t(e,m)[o+E[0]]=u,e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{t(e,m)[o+E[32]]=u,e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{t(e,I)[s]=u,e.dispatchEvent("voice",{part:s})},()=>{let y=e.chRedir(u,i,!0);t(e,q)[s]=y,s!=y&&(e.buildRchTree(),console.info(`${l}receives from CH${y+1}`))}][h+n]||(()=>{}))(u,h+n):h<21||(h<47?([()=>{t(e,ce)[s]=+!u},()=>{},()=>{},()=>{t(e,D)[b.rpn*s+3]=u,t(e,L)[b.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{},()=>{t(e,m)[o+E[7]]=u},!1,!1,()=>{t(e,m)[o+E[10]]=u||128},!1,!1,()=>{console.debug(`${l} AC1 at cc${u}`)},()=>{console.debug(`${l} AC2 at cc${u}`)},()=>{t(e,m)[o+E[128]]=u,e.allocateAce(s,128)},()=>{t(e,m)[o+E[93]]=u},()=>{t(e,m)[o+E[91]]=u},()=>{t(e,m)[o+E[94]]=u},()=>{t(e,m)[o+E[76]]=u},()=>{t(e,m)[o+E[77]]=u},()=>{t(e,m)[o+E[74]]=u},()=>{t(e,m)[o+E[71]]=u},()=>{t(e,m)[o+E[73]]=u},()=>{t(e,m)[o+E[75]]=u},()=>{t(e,m)[o+E[72]]=u},()=>{t(e,m)[o+E[78]]=u}][h+n-21]||(()=>{}))(u,h+n):h<95||([()=>{t(e,m)[o+E[65]]=u},()=>{t(e,m)[o+E[5]]=u}][h+n-95]||(()=>{}))(u,h+n))})}).add([43,7,0],(r,i,d)=>{let s=r[0];e.setLetterDisplay(r.subarray(1),"TG300 letter display",s)}).add([43,7,1],(r,i,d)=>{S(e,ee,0),S(e,ye,Date.now()+3200),t(e,he,Re).fill(0),r.forEach(function(s,n){let o=Math.floor(n/16),l=n%16,u=(l*3+o)*7,h=7,y=0;for(u-=l*5,o==2&&(h=2);y<h;)t(e,he,Re)[u+y]=s>>6-y&1,y++})}),t(this,ge).add([66,18,0,0,127],(r,i,d)=>{e.switchMode("sc",!0),e.setPortMode(e.getTrackPort(i),2,x.sc),t(e,m)[b.cc*9]=120,t(e,m)[b.cc*25]=120,t(e,m)[b.cc*41]=120,t(e,m)[b.cc*57]=120,t(e,Y)[x.sc][1]=t(e,U).sc,S(e,V,!1),t(e,Oe).fill(0),console.info(`GS system to ${["single","dual"][r[0]]} mode.`)}).add([66,18,64,0],(r,i,d)=>{switch(r[0]){case 127:{e.switchMode("gs",!0),e.setPortMode(e.getTrackPort(i),2,x.gs),t(e,Y)[x.gs][1]=t(e,U).gs,t(e,m)[b.cc*9]=120,t(e,m)[b.cc*25]=120,t(e,m)[b.cc*41]=120,t(e,m)[b.cc*57]=120,S(e,V,!1),t(e,Oe).fill(0),console.info("MIDI reset: GS");break}default:{e.dispatchEvent("mupromptex");let s=[0,0,0,0],n=(o,l)=>{s[l]=o};if(r.subarray(1).forEach((o,l)=>{let u=l+r[0];[n,n,n,n,h=>{S(this,G,h*129/16383*100),e.dispatchEvent("mastervolume",t(e,G))},h=>{},h=>{}][u](o,l)}),r[0]<4){let o=0;s.forEach(l=>{o=o<<4,o+=l}),o-=1024}}}}).add([66,18,64,1],(r,i,d)=>{e.dispatchEvent("mupromptex");let s=r[0];if(s<16){let n="".padStart(s," ");r.subarray(1).forEach((o,l)=>{n+=String.fromCharCode(Math.max(32,o))}),n=n.padEnd(16," "),console.debug(`GS patch name: ${n}`)}else s<48||(s<65?r.subarray(1).forEach((n,o)=>{let l=`GS ${s+o>55?"chorus":"reverb"} `;([()=>{console.info(`${l}type: ${Gt[n]}`),e.setEffectType(0,40,n),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${l}predelay: ${n}ms`)},()=>{console.info(`${l}type: ${fr[n]}`),e.setEffectType(1,40,16+n),e.dispatchEvent("efxchorus",e.getEffectType(1))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${l}to reverb: ${ne(n)}`)},()=>{console.debug(`${l}to delay: ${ne(n)}`)}][s+o-48]||(()=>{}))()}):s<80?console.debug(`Unknown GS patch address: ${s}`):s<91?r.subarray(1).forEach((n,o)=>{let l="GS delay ";([()=>{console.info(`${l}type: ${hr[n]}`),e.setEffectType(2,40,32+n),e.dispatchEvent("efxdelay",e.getEffectType(2))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${l}to reverb: ${ne(n)}`)}][s+o-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${s}`))}).add([66,18,64,2],(r,i,d)=>{let s="GS EQ ";r.subarray(1).forEach((n,o)=>{([()=>{console.debug(`${s}low freq: ${[200,400][n]}Hz`)},()=>{console.debug(`${s}low gain: ${n-64}dB`)},()=>{console.debug(`${s}high freq: ${[3e3,6e3][n]}Hz`)},()=>{console.debug(`${s}high gain: ${n-64}dB`)}][r[0]+o]||function(){console.warn(`Unknown GS EQ address: ${r[0]+o}`)})()})}).add([66,18,64,3],(r,i,d)=>{e.dispatchEvent("mupromptex");let s="GS EFX ",n=function(o,l){let u=ur(t(e,le).subarray(10,12),l,o);u&&console.debug(`${s}${Xt(t(e,le).subarray(10,12))} ${u}`)};r.subarray(1).forEach((o,l)=>{([()=>{e.setEffectTypeRaw(3,!1,32+o),e.dispatchEvent("efxinsert0",e.getEffectType(3))},()=>{e.setEffectTypeRaw(3,!0,o),console.info(`${s}type: ${Xt(t(e,le).subarray(10,12))}`),e.dispatchEvent("efxinsert0",e.getEffectType(3))},!1,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,()=>{console.debug(`${s}to reverb: ${ne(o)}dB`)},()=>{console.debug(`${s}to chorus: ${ne(o)}dB`)},()=>{console.debug(`${s}to delay: ${ne(o)}dB`)},!1,()=>{console.debug(`${s}1 source: ${o}`),o&&o<96&&e.allocateAceAll(o)},()=>{console.debug(`${s}1 depth: ${o-64}`)},()=>{console.debug(`${s}2 source: ${o}`),o&&o<96&&e.allocateAceAll(o)},()=>{console.debug(`${s}2 depth: ${o-64}`)},()=>{console.debug(`${s}to EQ: ${o?"ON":"OFF"}`)}][r[0]+l]||function(u,h){console.warn(`Unknown GS EFX address: ${h}`)})(o,r[0]+l)})}).add([66,18,65],(r,i,d)=>{v((r[0]>>4)+1<<1,r[0]&15,r.subarray(1))}).add([69,18,16],(r,i,d)=>{var s;switch(r[0]){case 0:{let n=r[1];e.setLetterDisplay(r.subarray(2),"GS display text",n);break}case 8:{let n=r[1],o=e.modelEx.sc;r.subarray(2).forEach((l,u)=>{([()=>{o.showBar=!(l&1),o.invBar=l>>1&1,o.invDisp=l>>2&1},()=>{o.peakHold=l<4?l:1}][u+n]||(()=>{console.debug("Unsupported GS display type SysEx.")}))()});break}case 32:{S(e,ye,Date.now()+3200),r[1]==0&&(r[2]?(S(e,ee,Math.max(Math.min(r[2]-1,9),0)),A()&&console.debug(`GS switch display page ${r[2]-1}.`)):(S(e,ee,0),S(e,ye,Date.now()),A()&&console.debug("GS disable display page.")));break}default:if(r[0]<6){t(e,ee)>9&&S(e,ee,0);let n=r[0]-1<<1|r[1]>>6;t(e,ee)==n&&S(e,ye,Date.now()+3200),(s=t(e,De)[n])!=null&&s.length||(t(e,De)[n]=new Uint8Array(256));let o=t(e,De)[n];A()&&console.debug(`GS frame draw page ${n}.`);let l=r[1]&63;o.fill(0),r.subarray(2).forEach(function(h,y){let k=y+l,T=Math.floor(k/16),M=k%16,B=(M*4+T)*5,O=5,F=0;for(B-=M*4,T==3&&(O=1);F<O;)o[B+F]=h>>4-F&1,F++})}else console.warn(`Unknown GS display section: ${r[0]}`)}}).add([69,18,32],(r,i,d)=>{let s=r[0],n=r[1],o=r.subarray(2);if(s>>4){console.warn(`SC-8850 partial screen dump out of bounds: invalid bundle.
`,r);return}let l=n+o.length,u=n*6-(n*2428>>16<<1),h=l*6-(l*2428>>16<<1);if(u>640){console.warn(`SC-8850 partial screen dump out of bounds: invalid buffer range.
`,r);return}h>640&&(console.info(`SC-8850 partial screen dump out of bounds: invalid buffer end, automatically restricted.
`,r),h=640);let y=new Uint8Array(h-u);o.forEach((M,B)=>{let O=B+n,F=(O*2428&65535)*27>>16==26,X=O*6-(O*2428>>16<<1),Pe=F?2:0;for(;Pe<6;)y[X+(5-Pe)]=M>>Pe&1,Pe++});let k=s*108+n,T=k*6-(k*2428>>16<<1);e.dispatchEvent("screen",{type:"sc8850",offset:T,data:y}),A()&&console.debug(`SC-8850 screen dump: bundle ${s+1}, range ${u}~${h}`)});let w=function(r,i,d){e.dispatchEvent("mupromptex");let s=r[0],n=b.cc*i,o=b.rpn*i,l=`GS CH${i+1} `;s<3?(r.subarray(1).forEach((u,h)=>{[()=>{t(e,m)[n+E[0]]=u,e.pushChPrimitives(i)},()=>{t(e,I)[i]=u},()=>{let y=0;u<16?y=e.chRedir(u,d,!0):y=b.ch,t(e,q)[i]=y,i!=y&&(e.buildRchTree(),console.info(`${l}receives from CH${y+1}`))}][s+h]()}),e.dispatchEvent("voice",{part:i})):s<19||(s<44?r.subarray(1).forEach((u,h)=>{([()=>{t(e,ce)[i]=+!u},!1,()=>{e.setChType(i,u<<1,x.gs),console.debug(`${l}type: ${u?"drum ":"melodic"}${u||""}`)},()=>{t(e,D)[o+3]=u,t(e,L)[b.rpnt*i+2]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},!1,()=>{t(e,m)[n+E[7]]=u},!1,!1,()=>{t(e,m)[n+E[10]]=u||128},!1,!1,()=>{console.debug(`${l}CC 1: cc${u}`)},()=>{console.debug(`${l}CC 2: cc${u}`)},()=>{t(e,m)[n+E[93]]=u},()=>{t(e,m)[n+E[91]]=u},!1,!1,()=>{t(e,D)[o+1]=u,t(e,L)[b.rpnt*i+1]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{t(e,D)[o+2]=u,t(e,L)[b.rpnt*i+1]=1,e.dispatchEvent("pitch",{part:i,pitch:e.getPitchShift(i)})},()=>{t(e,m)[n+E[94]]=u}][s+h-19]||(()=>{}))()}):s<76||console.debug(`Unknown GS part address: ${s}`))},$=function(r,i){let d=r[0],s=`GS CH${i+1} `;d<2?r.subarray(1).forEach((n,o)=>{[()=>{t(e,m)[b.cc*i+E[32]]=n},()=>{}][d+o]()}):d<32?console.warn(`Unknown GS misc address: ${d}`):d<35?r.subarray(1).forEach((n,o)=>{[()=>{console.debug(`${s}EQ: o${["ff","n"][n]}`)},()=>{},()=>{console.debug(`${s}EFX: o${["ff","n"][n]}`),t(e,ft)[i]=n,e.dispatchEvent("partefxtoggle",{part:i,active:n})}][d+o-32]()}):console.warn(`Unknown GS misc address: ${d}`)};t(this,ge).add([66,18,64,16],(r,i)=>{w(r,e.chRedir(9,i,!0),i)}).add([66,18,64,17],(r,i)=>{w(r,e.chRedir(0,i,!0),i)}).add([66,18,64,18],(r,i)=>{w(r,e.chRedir(1,i,!0),i)}).add([66,18,64,19],(r,i)=>{w(r,e.chRedir(2,i,!0),i)}).add([66,18,64,20],(r,i)=>{w(r,e.chRedir(3,i,!0),i)}).add([66,18,64,21],(r,i)=>{w(r,e.chRedir(4,i,!0),i)}).add([66,18,64,22],(r,i)=>{w(r,e.chRedir(5,i,!0),i)}).add([66,18,64,23],(r,i)=>{w(r,e.chRedir(6,i,!0),i)}).add([66,18,64,24],(r,i)=>{w(r,e.chRedir(7,i,!0),i)}).add([66,18,64,25],(r,i)=>{w(r,e.chRedir(8,i,!0),i)}).add([66,18,64,26],(r,i)=>{w(r,e.chRedir(10,i,!0),i)}).add([66,18,64,27],(r,i)=>{w(r,e.chRedir(11,i,!0),i)}).add([66,18,64,28],(r,i)=>{w(r,e.chRedir(12,i,!0),i)}).add([66,18,64,29],(r,i)=>{w(r,e.chRedir(13,i,!0),i)}).add([66,18,64,30],(r,i)=>{w(r,e.chRedir(14,i,!0),i)}).add([66,18,64,31],(r,i)=>{w(r,e.chRedir(15,i,!0),i)}).add([66,18,64,64],(r,i)=>{$(r,e.chRedir(9,i,!0))}).add([66,18,64,65],(r,i)=>{$(r,e.chRedir(0,i,!0))}).add([66,18,64,66],(r,i)=>{$(r,e.chRedir(1,i,!0))}).add([66,18,64,67],(r,i)=>{$(r,e.chRedir(2,i,!0))}).add([66,18,64,68],(r,i)=>{$(r,e.chRedir(3,i,!0))}).add([66,18,64,69],(r,i)=>{$(r,e.chRedir(4,i,!0))}).add([66,18,64,70],(r,i)=>{$(r,e.chRedir(5,i,!0))}).add([66,18,64,71],(r,i)=>{$(r,e.chRedir(6,i,!0))}).add([66,18,64,72],(r,i)=>{$(r,e.chRedir(7,i,!0))}).add([66,18,64,73],(r,i)=>{$(r,e.chRedir(8,i,!0))}).add([66,18,64,74],(r,i)=>{$(r,e.chRedir(10,i,!0))}).add([66,18,64,75],(r,i)=>{$(r,e.chRedir(11,i,!0))}).add([66,18,64,76],(r,i)=>{$(r,e.chRedir(12,i,!0))}).add([66,18,64,77],(r,i)=>{$(r,e.chRedir(13,i,!0))}).add([66,18,64,78],(r,i)=>{$(r,e.chRedir(14,i,!0))}).add([66,18,64,79],(r,i)=>{$(r,e.chRedir(15,i,!0))}),t(this,Te).add([54,65],(r,i)=>{let d=t(e,U).x5=="81"?"05rw":"x5d";e.switchMode(d,!0),e.setPortMode(e.getTrackPort(i),1,x[d]);let s=r[r.length-1],n=r.subarray(0,r.length-1),o=Be(n);o!=s&&(console.info(`X5D multi parameters checksum mismatch! Expected ${o}, got ${s}.`),console.debug(r));let l=(r[1]<<7)+r[0],u=(r[3]<<7)+r[2],h=e.chRedir(l&15,i,!0),y=b.cc*h;[()=>{u<1||(u<101?(e.setChType(h,e.CH_MELODIC,x.x5d),t(e,I)[h]=u-1,t(e,m)[y+E[0]]=t(e,U).x5):u<229?(e.setChType(h,e.CH_MELODIC,x.x5d),t(e,I)[h]=u-101,t(e,m)[y+E[0]]=56):(e.setChType(h,e.CH_DRUMS,x.x5d),t(e,I)[h]=$r[u-229]||0,t(e,m)[y+E[0]]=62)),e.pushChPrimitives(h),e.dispatchEvent("voice",{part:h})},()=>{t(e,m)[y+E[7]]=u},()=>{u<31&&(t(e,m)[y+E[10]]=Math.round((u-15)*4.2+64))},()=>{t(e,m)[y+E[93]]=$t(u)},()=>{t(e,m)[y+E[91]]=$t(u)},()=>{t(e,D)[h*b.rpn+3]=u>8191?u-16320:64+u,t(e,L)[b.rpnt*h+2]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)})},()=>{t(e,D)[h*b.rpn+1]=u>8191?u-16320:64+u,t(e,L)[b.rpnt*h+1]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)})},()=>{u>0&&(t(e,D)[h*b.rpn]=u,t(e,L)[b.rpnt*h]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)}))},()=>{}][l>>4]()}).add([54,76,0],(r,i)=>{e.dispatchEvent("mupromptex");let d=t(e,U).x5=="81"?"05rw":"x5d";e.switchMode(d),e.setPortMode(e.getTrackPort(i),1,x[d]);let s="",n=t(e,U).x5,o=0,l=0,u="MSB	PRG	LSB	NME";me(r,function(h,y){if(y<16400){let k=y%164;switch(!0){case k<10:{h>31&&(s+=String.fromCharCode(h));break}case k==10:break;case k==11:{u+=`
${n}	${o}	${l}	${s.trim().replace("Init Voice","")}`,o++,s="";break}}o>99&&(n=90,o=0)}}),e.userBank.clearRange({msb:t(e,U).x5,prg:[0,99],lsb:0}),e.userBank.load(u),A()&&console.debug(u),e.forceVoiceRefresh()}).add([54,77,0],(r,i)=>{e.dispatchEvent("mupromptex");let d=t(e,U).x5=="81"?"05rw":"x5d";e.switchMode(d),e.setPortMode(e.getTrackPort(i),1,x[d]);let s="",n=90,o=0,l=0,u="MSB	PRG	LSB	NME";me(r,function(h,y){if(y<13600){let k=y%136;switch(!0){case k<10:{h>31&&(s+=String.fromCharCode(h));break}case k==11:{u+=`
${n}	${o}	${l}	${s.trim().replace("Init Combi","")}`,o++,s="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(u),A()&&console.debug(u),e.forceVoiceRefresh()}).add([54,78],(r,i)=>{let d=t(e,U).x5=="81"?"05rw":"x5d";e.switchMode(d),e.setPortMode(e.getTrackPort(i),1,x[d]),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][r[0]]} mode.`)}).add([54,85],(r,i)=>{e.dispatchEvent("mupromptex");let d=t(e,U).x5=="81"?"05rw":"x5d";e.switchMode(d),e.setPortMode(e.getTrackPort(i),1,x[d]),me(r,(s,n)=>{n>0&&n<3&&(e.setEffectType(n-1,44,s),e.dispatchEvent(`efx${["reverb","chorus"][n-1]}`,e.getEffectType(n-1)))})}).add([54,104],(r,i)=>{e.dispatchEvent("mupromptex");let d=t(e,U).x5=="81"?"05rw":"x5d";e.switchMode(d,!0);let s=e.getTrackPort(i);if(t(e,K)[s]&&t(e,K)[s]!=x[d])if(t(e,Se).dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${i}. Port ${String.fromCharCode(65+s)} mode "${j[t(e,K)[s]]}" mismatch, should be "${d}".`);return}else console.info(`Track ${i} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);e.setPortMode(s,1,x[d]),me(r,function(n,o,l,u){if(o<192){let h=e.chRedir(Math.floor(o/12),i,!0),y=h*b.cc;switch(o%12){case 0:{n<128?(e.setChType(h,e.CH_MELODIC,x.x5d),t(e,m)[y+E[0]]=t(e,U).x5,t(e,I)[h]=n):(e.setChType(h,e.CH_DRUMS,x.x5d),t(e,m)[y+E[0]]=62,t(e,I)[h]=$r[n-128]),n>0&&e.setChActive(h,1),e.pushChPrimitives(h),e.dispatchEvent("voice",{part:h});break}case 1:{t(e,m)[y+E[7]]=n;break}case 2:{t(e,D)[h*b.rpn+3]=n>127?n-192:64+n,t(e,L)[b.rpnt*h+2]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)});break}case 3:{t(e,D)[h*b.rpn+1]=n>127?n-192:64+n,t(e,L)[b.rpnt*h+1]=1,e.dispatchEvent("pitch",{part:h,pitch:e.getPitchShift(h)});break}case 4:{n<31&&(t(e,m)[y+E[10]]=Math.round((n-15)*4.2+64));break}case 5:{let k=n>>4,T=n&15;t(e,m)[y+E[91]]=$t(T),t(e,m)[y+E[93]]=$t(k);break}case 10:{t(e,R)[h]||(t(e,m)[y+E[0]]=n>>6?56:t(e,U).x5,e.pushChPrimitives(h),e.dispatchEvent("voice",{part:h}));break}case 11:{let k=e.chRedir(n&15,i,!0),T=n>>4;t(e,q)[h]=n,(k!=h||T)&&(console.info(`X5D Part CH${h+1} receives from CH${k+1}.`),e.buildRchTree())}}}else{let h=e.chRedir(o-192,i,!0)}})}),t(this,ge).add([22,18,127],(r,i,d)=>{e.switchMode("mt32",!0),e.setPortMode(e.getTrackPort(i),1,x.mt32),S(e,V,!1),e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(r,i,d)=>{e.switchMode("mt32");let s=e.chRedir(d,i,!0),n=r[1];r.subarray(2).forEach((o,l)=>{let u=l+n;t(e,Ue)[u+(s-1)*16]=o,([!1,()=>{let h=t(e,Ue)[s-1<<4];if(h<3){if(t(e,ve)[s]=1,h==2)for(let y=0;y<name.length;y++)t(e,we)[(s-1)*b.cmt+y]=t(e,Ne)[o*b.cmt+y];else{let y=e.baseBank.get(0,o+(h<<6),127,"mt32").name;for(let k=0;k<y.length;k++)t(e,we)[(s-1)*b.cmt+k]=y.charCodeAt(k)}e.dispatchEvent("voice",{part:s})}},()=>{t(e,D)[s*b.rpn+3]=o+40,t(e,L)[b.rpnt*s+2]=1},()=>{t(e,D)[s*b.rpn+1]=o+14,t(e,L)[b.rpnt*s+1]=1},()=>{t(e,D)[s*b.rpn]=o,t(e,L)[b.rpnt*s]=1},!1,()=>{t(e,m)[b.cc*s+E[91]]=o?127:0},!1,()=>{t(e,m)[b.cc*s+E[7]]=o},()=>{t(e,m)[b.cc*s+E[10]]=Math.ceil(o*9.05)}][u]||(()=>{}))()})}).add([22,18,1],(r,i,d)=>{e.switchMode("mt32");let s=d&7;console.debug(`MT-32 slot #${d+1} Drum: ${r}`);let n=r[0]<<7|r[1];r.subarray(2).forEach((o,l)=>{let u=l+n,h=(u>>2)+24,y=u&3,k=s*b.dpn;if(A()&&console.debug(`MT-32 temp drum note ${h} param ${y}: ${o}`),h<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${h}`);return}[()=>{},()=>{t(e,se)[(k+ue[26])*b.dnc+h]=Math.round(o*1.27)},()=>{t(e,se)[(k+ue[26])*b.dnc+h]=o*9+1&127},()=>{t(e,se)[(k+ue[26])*b.dnc+h]=o?127:0}][y]()})}).add([22,18,2],(r,i,d)=>{e.switchMode("mt32");let s=e.chRedir(d,i,!0),n=r[1]+(r[0]<<7);n<10&&(t(e,ve)[s]=1),r.subarray(2).forEach((o,l)=>{let u=l+n;u<14&&(t(e,we)[(s-1)*b.cmt+u]=o)}),e.dispatchEvent("voice",{part:s})}).add([22,18,3],(r,i,d)=>{e.switchMode("mt32");let s=d&7;if(r[0]){let n=(r[0]-1<<7)+r[1]-16;r.subarray(2).forEach((o,l)=>{let u=l+n,h=(u>>2)+24,y=u&3,k=s*b.dpn;if(A()&&console.debug(`MT-32 dev drum note ${h} param ${y}: ${o}`),h<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${h}`);return}[()=>{},()=>{t(e,se)[(k+ue[26])*b.dnc+h]=Math.round(o*1.27)},()=>{t(e,se)[(k+ue[26])*b.dnc+h]=o*9+1&127},()=>{t(e,se)[(k+ue[26])*b.dnc+h]=o?127:0}][y]()})}else{let n=r[1];r.subarray(2).forEach((o,l)=>{let u=l+n;t(e,Ue)[u]=o;let h=e.chRedir(1+(u>>4),i,!0),y=u&15;([!1,()=>{let k=t(e,Ue)[h-1<<4];if(k<3)if(t(e,ve)[h]=1,k==2)for(let T=0;T<name.length;T++)t(e,we)[(h-1)*b.cmt+T]=t(e,Ne)[o*b.cmt+T];else{let T=e.baseBank.get(0,o+(k<<6),127,"mt32").name;for(let M=0;M<T.length;M++)t(e,we)[(h-1)*b.cmt+M]=T.charCodeAt(M)}e.dispatchEvent("voice",{part:h})},()=>{t(e,D)[h*b.rpn+3]=o+40,t(e,L)[b.rpnt*h+2]=1},()=>{t(e,D)[h*b.rpn+1]=o+14,t(e,L)[b.rpnt*h+1]=1},()=>{t(e,D)[h*b.rpn]=o,t(e,L)[b.rpnt*h]=1},!1,()=>{t(e,m)[b.cc*h+E[91]]=o?127:0},!1,()=>{t(e,m)[b.cc*h+E[7]]=o},()=>{t(e,m)[b.cc*h+E[10]]=Math.ceil(o*9.05)}][y]||(()=>{}))()})}}).add([22,18,4],(r,i,d)=>{e.switchMode("mt32");let s=r[1]+(r[0]<<7),n=[];r.subarray(2).forEach((o,l)=>{let u=l+s,h=e.chRedir(Math.floor(u/246+1),i,!0),y=u%246;y<14&&(t(e,we)[(h-1)*b.cmt+y]=o),y<10&&(t(e,ve)[h]=1),n.indexOf(h)<0&&n.push(h)}),n.forEach(o=>{e.dispatchEvent("voice",{part:o})})}).add([22,18,5],(r,i,d)=>{e.switchMode("mt32");let s=(r[0]<<7)+r[1];r.subarray(2).forEach((n,o)=>{let l=s+o,u=Math.floor(l/8),h=l&7,y=u*8;t(e,ht)[l]=n,([!1,()=>{let k=t(e,ht)[y];if(k<3){let T="";if(k==2){let B=b.cmt*u;T=`MT-m:${n.toString().padStart(3,"0")}`}else T=e.baseBank.get(0,n+(k<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:u});let M=`MSB	LSB	PRG	NME
000	127	${u}	${T}`;e.userBank.load(M,!0)}}][h]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(r,i,d)=>{e.switchMode("mt32");let s=((r[0]&1)<<7)+r[1],n=r[0]>>1,o=!1;if(r.subarray(2).forEach((l,u)=>{let h=s+u;h<b.cmt&&(t(e,Ne)[n*b.cmt+h]=l,o=!0)}),o){e.userBank.clearRange({msb:0,lsb:127,prg:n});let l=`MSB	LSB	PRG	NME
000	127	${n}	MT-m:${n}`;e.userBank.load(l,!0)}e.forceVoiceRefresh()}).add([22,18,16],(r,i,d)=>{e.switchMode("mt32");let s=r[1],n=!1,o=function(l,u){t(e,q)[u-12]=l,n=!0};r.subarray(2).forEach((l,u)=>{let h=u+s;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,o,o,o,o,o,o,o,o,o,()=>{S(e,G,l),e.dispatchEvent("mastervolume",t(e,G))}][h]||(()=>{}))(l,u)}),n&&e.buildRchTree()}).add([22,18,32],(r,i,d)=>{e.switchMode("mt32");let s=r[1],n=" ".repeat(s);r.subarray(2).forEach(o=>{o>31?n+=String.fromCharCode(o):n+=" "}),S(e,He,n.padStart(20," ")),S(e,_e,Date.now()+3200)}).add([22,18,82],(r,i)=>{let d=e.chRedir(0,i,!0);for(let s=0;s<16;s++)t(e,z).ano(d+s),s&&s<10&&(t(e,I)[d+s]=Vt[s-1]);console.info("MT-32 alt reset complete.")}),t(this,Te).add([66,0],(r,i)=>{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(i),2,x.ns5r),S(e,V,!1),console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][r[0]]} mode.`)}).add([66,1],(r,i)=>{let d=["ns5r","05rw"][r[0]];e.switchMode(d,!0),e.setPortMode(e.getTrackPort(i),2,x[d]),S(e,V,!1)}).add([66,18,0,0],(r,i)=>{let d=r[0];switch(d){case 124:case 126:case 127:{e.switchMode("ns5r",!0),e.setPortMode(e.getTrackPort(i),2,x.ns5r),S(e,V,!1);break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset: ${r}`);break}default:if(d<10){let s=[0,0,0,0],n=(o,l)=>{s[l]=o};if(r.subarray(1).forEach((o,l)=>{[n,n,n,n,()=>{S(e,G,o*129/16383*100),e.dispatchEvent("mastervolume",t(e,G))},()=>o-64,()=>o-64,()=>{},()=>{},()=>{}][d+l]()}),r[0]<4){let o=0;s.forEach(l=>{o=o<<4,o+=l}),o-=1024}}}}).add([66,18,0,1],(r,i)=>{}).add([66,18,0,2],(r,i)=>{}).add([66,18,1],(r,i)=>{e.dispatchEvent("mupromptex");let d=e.chRedir(r[0],i,!0),s=d*b.cc,n=r[1],o=`NS5R CH${d+1} `;r.subarray(2).forEach((l,u)=>{let h=n+u;h<3?([()=>{t(e,m)[s+E[0]]=l||$e.bank0,e.pushChPrimitives(d)},()=>{t(e,m)[s+E[32]]=l,e.pushChPrimitives(d)},()=>{t(e,I)[d]=l}][h](),e.dispatchEvent("voice",{part:d})):h<8||(h<14?[()=>{let y=e.chRedir(l,i,!0);t(e,q)[d]=y,d!=y&&(e.buildRchTree(),console.info(`${o}receives from CH${y+1}`))},()=>{t(e,ce)[d]=+!l},()=>{e.setChType(d,l,x.ns5r),console.debug(`${o}type: ${wt[l]}`)},()=>{t(e,D)[b.rpn*d+3]=l,t(e,L)[b.rpnt*d+2]=1,e.dispatchEvent("pitch",{part:d,pitch:e.getPitchShift(d)})},()=>{},()=>{}][h-8]():h<16||(h<33?[()=>{t(e,m)[s+E[7]]=l},()=>{t(e,m)[s+E[11]]=l},()=>{},()=>{},()=>{t(e,m)[s+E[10]]=l||128},()=>{},()=>{},()=>{t(e,m)[s+E[93]]=l},()=>{t(e,m)[s+E[91]]=l},()=>{t(e,m)[s+E[76]]=l},()=>{t(e,m)[s+E[77]]=l},()=>{t(e,m)[s+E[78]]=l},()=>{t(e,m)[s+E[74]]=l},()=>{t(e,m)[s+E[71]]=l},()=>{t(e,m)[s+E[73]]=l},()=>{t(e,m)[s+E[75]]=l},()=>{t(e,m)[s+E[72]]=l}][h-16]():h<112||h<114&&[()=>{t(e,m)[s+E[5]]=l},()=>{t(e,m)[s+E[65]]=l}][h-112]()))})}).add([66,18,8,0],(r,i)=>{let d=r[0];if(d<32)e.setLetterDisplay(r.subarray(1,33),"NS5R letter display");else{let s=d-32;S(e,ye,Date.now()+3200),S(e,ee,10),t(e,he,Re).fill(0);let n=r.subarray(1),o=4;n.forEach(function(l,u){let h=u+s,y=h>>4,k=h&15;if(h<80){let T=y<o?l:l>>3,M=0,B=y<o?6:3;for(;T>0;)t(e,he,Re)[k*32+y*7+(B-M)]=T&1,T=T>>1,M++}})}}).add([66,18,48],(r,i,d)=>{p(0,r)}).add([66,18,49],(r,i,d)=>{p(1,r)}).add([66,18,50],(r,i,d)=>{p(2,r)}).add([66,18,51],(r,i,d)=>{p(3,r)}).add([66,18,52],(r,i,d)=>{p(4,r)}).add([66,18,53],(r,i,d)=>{p(5,r)}).add([66,18,54],(r,i,d)=>{p(6,r)}).add([66,18,55],(r,i,d)=>{p(7,r)}).add([66,52],(r,i)=>{e.switchMode("ns5r"),S(e,V,!1);let d="";me(r,(s,n)=>{n<8?(s>31&&(d+=String.fromCharCode(s)),n==7&&(e.aiEfxName=d)):n<10&&(e.setEffectType(n-8,44,s),e.dispatchEvent(`efx${["reverb","chorus"][n-8]}`,e.getEffectType(n-8)))})}).add([66,53],(r,i)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r"),S(e,V,!1);let d="",s=r[r.length-1],n=r.subarray(0,r.length-1),o=Be(n);o!=s&&(console.info(`NS5R current multi dump checksum mismatch! Expected ${o}, got ${s}.`),console.debug(r));let l=e.getTrackPort(i);if(t(e,K)[l]&&t(e,K)[l]!=x.ns5r)if(t(e,Se).dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${i}. Port ${String.fromCharCode(65+l)} mode "${j[t(e,K)[l]]}" mismatch, should be "ns5r".`);return}else console.info(`Track ${i} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+l)}.`);e.setPortMode(l,2,x.ns5r),me(n,function(u,h){switch(!0){case h<2944:{let y=e.chRedir(Math.floor(h/92),i,!0),k=y*b.cc;switch(h%92){case 0:{t(e,m)[k+E[0]]=u,e.pushChPrimitives(y),e.dispatchEvent("voice",{part:y});break}case 1:{t(e,m)[k+E[32]]=u,!u&&!t(e,m)[k+E[0]]&&(t(e,m)[k+E[0]]=$e.bank0),e.pushChPrimitives(y),e.dispatchEvent("voice",{part:y});break}case 2:{t(e,I)[y]=u,u>0&&e.setChActive(y,1),e.dispatchEvent("voice",{part:y});break}case 3:{let T=e.chRedir(u,i,!0);t(e,q)[y]=T,y!=T&&(console.info(`NS5R CH${y+1} receives from CH${T+1}.`),e.buildRchTree());break}case 7:{t(e,R)[y]=u,e.dispatchEvent("voice",{part:y});break}case 8:{t(e,D)[y*b.rpn+3]=u<40||u>88?u+(u>63?-192:64):u,t(e,L)[b.rpnt*y+2]=1,e.dispatchEvent("pitch",{part:y,pitch:e.getPitchShift(y)});break}case 9:case 10:{t(e,m)[k+E[7]]=u;break}case 11:{t(e,m)[k+E[11]]=u;break}case 14:{t(e,m)[k+E[10]]=u||128;break}case 19:{t(e,m)[k+E[93]]=u;break}case 20:{t(e,m)[k+E[91]]=u;break}case 84:{t(e,m)[k+E[65]]=u;break}case 85:{t(e,m)[k+E[5]]=u;break}}break}case h<3096:break;case h<3134:{let y=h-3096;y<8?(u>31&&(d+=String.fromCharCode(u)),y==7&&(e.aiEfxName=d)):y<10&&(e.setEffectType(y-8,44,u),e.dispatchEvent(`efx${["reverb","chorus"][y-8]}`,e.getEffectType(y-8)));break}case h<8566:break}})}).add([66,54],(r,i)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r");let d="",s=80,n=0,o=0,l="MSB	PRG	LSB	NME";me(r,function(u,h){let y=h%158;switch(!0){case y<10:{u>31&&(d+=String.fromCharCode(u));break}case y==10:break;case y==11:{s=u&127;break}case y==12:{o=u&127;break}case y==13:{l+=`
${s}	${n}	${o}	${d.trim().replace("Init Voice","")}`,n++,d="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(l),A()&&console.debug(l),e.forceVoiceRefresh()}).add([66,55],(r,i)=>{e.dispatchEvent("mupromptex"),e.switchMode("ns5r");let d="",s=88,n=0,o=0,l="MSB	PRG	LSB	NME";me(r,function(u,h){let y=h%126;switch(!0){case y<10:{u>31&&(d+=String.fromCharCode(u));break}case y==11:break;case y==12:break;case y==13:{l+=`
${s}	${n}	${o}	${d.trim().replace("Init Combi","")}`,n++,d="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(l),A()&&console.debug(l),e.forceVoiceRefresh()}).add([66,125],(r,i,d)=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][r[0]]||"white")}).add([66,127],(r,i,d)=>{let s=r[r.length-1],n=r.subarray(0,r.length-1),o=Be(n);o!=s&&(console.info(`NS5R screen dump checksum mismatch! Expected ${o}, got ${s}.`),console.debug(r));let l=new Uint8Array(5760);me(r,(u,h,y)=>{if(h<720)for(let k=0;k<8;k++)l[h*8+k]=u>>7-k&1}),e.dispatchEvent("screen",{type:"ns5r",data:l})}).add([76],(r,i,d)=>{t(e,Te).run([66,...r],i,d)}),t(this,je).add([16,0,8,0],(r,i,d)=>{let s=(r[2]<<4)+r[3],n="K11 ";([()=>{e.switchMode("k11",!0),e.setPortMode(e.getTrackPort(i),2,x.k11),S(e,V,!1),t(e,Y)[x.k11][1]=s?4:0,console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,s),console.debug(`${n}reverb type: ${s}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{console.debug(`${n}reverb time: ${s}`)},()=>{console.debug(`${n}reverb time: ${s}`)},()=>{console.debug(`${n}reverb predelay: ${s}`)},()=>{console.debug(`${n}reverb predelay: ${s}`)},()=>{console.debug(`${n}depth high: ${s}`)},()=>{console.debug(`${n}depth high: ${s}`)},()=>{console.debug(`${n}depth low: ${s}`)},()=>{console.debug(`${n}depth low: ${s}`)}][r[0]]||(()=>{}))()}).add([16,0,8,1],(r,i,d)=>{e.dispatchEvent("mupromptex");let s=e.chRedir(r[1],i,!0),n=b.cc*s,o=b.rpn*s,l=(r[3]<<4)+r[4],u=`K11 CH${s+1} `;([()=>{l<128?(e.setChType(s,e.CH_MELODIC,x.k11),t(e,m)[n+E[0]]=0,t(e,I)[s]=l):(e.setChType(s,e.CH_DRUMS,x.k11),t(e,I)[s]=l-128),e.pushChPrimitives(s),e.dispatchEvent("voice",{part:s})},()=>{let h=e.chRedir(l,i,!0);t(e,q)[s]=h,s!=h&&(e.buildRchTree(),console.info(`${u}receives from CH${h+1}`))},()=>{t(e,m)[n+E[7]]=l},()=>{uupThis.setChActive(s,l)},()=>{t(e,m)[n+E[10]]=l},()=>{t(e,D)[o+3]=l+40,t(e,L)[b.rpnt*s+2]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{t(e,D)[o+1]=l>>1,t(e,D)[o+2]=l&1,t(e,L)[b.rpnt*s+1]=1,e.dispatchEvent("pitch",{part:s,pitch:e.getPitchShift(s)})},()=>{t(e,m)[n+E[91]]=l?127:0},()=>{},()=>{t(e,m)[n+E[74]]=l},()=>{t(e,m)[n+E[73]]=l},()=>{t(e,m)[n+E[72]]=l}][r[0]]||(()=>{}))()}).add([16,0,9,0],(r,i,d)=>{e.dispatchEvent("mupromptex");let s=(r[2]<<4)+r[3],n="GMLX ";([()=>{console.debug(`${n}reverb type: ${s}`)},()=>{console.debug(`${n}reverb time: ${s}`)},()=>{console.debug(`${n}reverb predelay: ${s}`)},()=>{console.debug(`${n}depth high: ${s}`)},()=>{console.debug(`${n}depth low: ${s}`)}][r[0]]||(()=>{}))()}).add([16,0,9,3],(r,i,d)=>{e.dispatchEvent("mupromptex");let s=(r[2]<<4)+r[3],n=e.chRedir(r[1],i,!0),o=n*b.cc;[()=>{s<128?(e.setChType(n,e.CH_MELODIC,x.k11),t(e,m)[o+E[0]]=0,t(e,m)[o+E[32]]=0,t(e,I)[n]=s):s<160?(e.setChType(n,e.CH_MELODIC,x.k11),t(e,m)[o+E[0]]=0,t(e,m)[o+E[32]]=7,t(e,I)[n]=s-100):(e.setChType(n,e.CH_DRUMS,x.k11),t(e,m)[o+E[0]]=122,t(e,m)[o+E[32]]=0,t(e,I)[n]=s-160),e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n})},()=>{let l=e.chRedir(s,i,!0);t(e,q)[n]=l,n!=l&&(e.buildRchTree(),console.info(`GMLX CH${n+1} receives from CH${l+1}`))}][r[0]]()}).add([16,0,9,4],(r,i,d)=>{e.dispatchEvent("mupromptex");let s=(r[2]<<4)+r[3],n=e.chRedir(r[1],i,!0),o=n*b.cc,l=n*b.rpn,u=`GMLX CH${n+1} `;[()=>{e.setChActive(n,s)},()=>{t(e,m)[o+E[7]]=s},()=>{t(e,m)[o+E[10]]=s},()=>{t(e,m)[o+E[91]]=s?127:0},()=>{t(e,D)[l+3]=s+40,t(e,L)[b.rpnt*n+2]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{t(e,D)[l+1]=s,t(e,L)[b.rpnt*n+1]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{t(e,D)[l]=s,t(e,L)[b.rpnt*n]=1,e.dispatchEvent("pitch",{part:n,pitch:e.getPitchShift(n)})},()=>{}][r[0]]()}),t(this,et).add([66,93,64],(r,i,d)=>{let s=r[2];switch(r[0]){case 0:{switch(r[1]){case 4:{e.dispatchEvent("mupromptex"),S(e,G,s*129/16383*100),e.dispatchEvent("mastervolume",t(e,G));break}case 5:{e.dispatchEvent("mupromptex"),s-64;break}case 6:{e.dispatchEvent("mupromptex"),console.debug(`SG global reverb: ${s?"on":"off"}`);break}case 127:{e.switchMode("sg",!0),e.setPortMode(e.getTrackPort(i),1,x.sg);break}}break}case 1:{switch(r[1]){case 48:{e.dispatchEvent("mupromptex"),console.debug(`SG reverb type: ${Gt[s]}`);break}}break}default:if(r[0]>>4==1){e.dispatchEvent("mupromptex");let n=e.chRedir(r[0]&15,i,!0);if(r[1]==2){let o=e.chRedir(s,i,!0);t(e,q)[n]=o,n!=o&&(e.buildRchTree(),console.info(`SG CH${n+1} receives from CH${o+1}`))}else r[1]==19&&(t(e,m)[b.cc*n+E[7]]=s)}else console.warn(`Unknown AKAI SG SysEx: ${r}`)}}),t(this,tt).add([9],(r,i,d)=>{e.dispatchEvent("mupromptex"),console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremolo","phaser","rotary speaker","enhancer","flanger","EQ"][r[0]]||"off"}`)}),t(this,fe).add([127,0],(r,i,d)=>{e.switchMode("motif");let s=new Uint8Array([127,1,...r]);t(e,fe).run(s,i,d)}).add([127,1,0,0],(r,i,d)=>{e.switchMode("s90es");let s="S90/Motif ES system ",n=r[0];r.subarray(1).forEach((o,l)=>{([()=>{S(e,G,o*12900/16383),e.dispatchEvent("mastervolume",t(e,G))}][n+l]||(()=>{console.info(`Unrecognized ${s}ID: ${n+l}`)}))()})}).add([127,1,0,36,54,1],(r,i,d)=>{e.switchMode("s90es");let s="S90/Motif ES reverb ",n=r[0];r.subarray(1).forEach((o,l)=>{([()=>{e.setEffectTypeRaw(0,!1,o&15|112)},()=>{e.setEffectTypeRaw(0,!0,o)}][n+l]||(()=>{}))()}),e.dispatchEvent("efxreverb",e.getEffectType(0))}).add([127,1,0,37,54,2],(r,i,d)=>{e.switchMode("s90es");let s="S90/Motif ES chorus ",n=r[0];r.subarray(1).forEach((o,l)=>{([()=>{e.setEffectTypeRaw(1,!1,o&15|112)},()=>{e.setEffectTypeRaw(1,!0,o)}][n+l]||(()=>{}))()}),e.dispatchEvent("efxchorus",e.getEffectType(1))}).add([127,1,0,34,54,3],(r,i,d)=>{e.switchMode("s90es");let s="S90/Motif ES insert 1 ",n=r[0];r.subarray(1).forEach((o,l)=>{([()=>{e.setEffectTypeRaw(3,!1,o&15|112)},()=>{e.setEffectTypeRaw(3,!0,o)}][n+l]||(()=>{}))()}),e.dispatchEvent("efxinsert0",e.getEffectType(3))}).add([127,1,0,34,54,4],(r,i,d)=>{e.switchMode("s90es");let s="S90/Motif ES insert 2 ",n=r[0];r.subarray(1).forEach((o,l)=>{([()=>{e.setEffectTypeRaw(4,!1,o&15|112)},()=>{e.setEffectTypeRaw(4,!0,o)}][n+l]||(()=>{}))()}),e.dispatchEvent("efxinsert1",e.getEffectType(4))}).add([127,1,0,35,54,17],(r,i,d)=>{e.switchMode("s90es");let s="S90/Motif ES variation ",n=r[0];r.subarray(1).forEach((o,l)=>{([()=>{e.setEffectTypeRaw(2,!1,o&15|112)},()=>{e.setEffectTypeRaw(2,!0,o)}][n+l]||(()=>{}))()}),e.dispatchEvent("efxdelay",e.getEffectType(2))}).add([127,1,0,58,55],(r,i,d)=>{e.dispatchEvent("mupromptex"),e.switchMode("s90es");let s=e.getTrackPort(i);if(t(e,K)[s]&&t(e,K)[s]!=t(e,U).smotif)if(t(e,Se).dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled for track ${i}. Port ${String.fromCharCode(65+s)} mode "${j[t(e,K)[s]]}" mismatch, should be "${j[t(e,U).smotif]}".`);return}else console.info(`Track ${i} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);let n=e.chRedir(r[0],i,!0),o=b.cc*n,l=r[1];r[0]>15&&(n=r[0]+32);let u=`Track ${i} S90/Motif ES bulk CH${n<128?n+1:"U"+(n-127)} `;console.debug(u,r),!(r[0]>15)&&r.subarray(2).forEach((h,y)=>{([()=>{t(e,m)[o+E[0]]=h,e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n})},()=>{h&&e.setChActive(n,1),t(e,m)[o+E[32]]=h,e.getChPrimitive(n,1)==63&&e.setChType(n,[32,40].indexOf(h)>-1?e.CH_DRUMS:e.CH_MELODIC,t(e,H),!0),e.pushChPrimitives(n),e.dispatchEvent("voice",{part:n})},()=>{h&&e.setChActive(n,1),t(e,I)[n]=h,e.dispatchEvent("voice",{part:n})},()=>{let k=e.chRedir(h,i,!0);t(e,q)[n]=k,n!=k&&(e.buildRchTree(),console.info(`${u}receives from CH${k+1}`))},()=>{t(e,ce)[n]=h?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{h!=100&&e.setChActive(n,1),t(e,m)[o+E[7]]=h},()=>{h!=64&&e.setChActive(n,1),t(e,m)[o+E[10]]=h},!1,!1,!1,()=>{t(e,m)[o+E[91]]=h},()=>{h&&e.setChActive(n,1),t(e,m)[o+E[93]]=h},()=>{h&&e.setChActive(n,1),t(e,m)[o+E[94]]=h},()=>{h!=127&&e.setChActive(n,1),t(e,m)[o+E[128]]=h,e.allocateAce(n,128)},()=>{},()=>{h!=64&&e.setChActive(n,1),t(e,m)[o+E[74]]=h},()=>{h!=64&&e.setChActive(n,1),t(e,m)[o+E[71]]=h},!1,()=>{t(e,m)[o+E[65]]=h},()=>{t(e,m)[o+E[5]]=h},()=>{}][l+y]||(()=>{}))()})}).add([127,1,54,16],(r,i,d)=>{e.switchMode("s90es");let s=r[0];r.subarray(1).forEach((n,o)=>{let u=`S90/Motif ES EQ${(o>>2)+1} `;([()=>{let h=n-64},()=>{let h=lt[n]},()=>{let h=n/10},()=>{let h=n}][s+o&3]||(()=>{}))()})}),t(this,ge).add([0,72,18,0,0,0,0],(r,i,d)=>{e.switchMode("sd",!0),e.setPortMode(e.getTrackPort(i),2,x.sd),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(r,i,d)=>{e.dispatchEvent("mupromptex");let s=r[0]>>5,n=r[0]&31;switch(s){case 0:{let o=r[0]>>1,l=r[1];switch(o){case 1:{r.subarray(2).forEach((u,h,y)=>{let k=h+l;switch(k){case 0:{u&&(e.setEffectType(1,60,u-1),e.dispatchEvent("efxchorus",e.getEffectType(1)),console.debug(`SD MFX Cho: ${k} - ${u}`));break}}});break}case 2:{r.subarray(2).forEach((u,h)=>{let y=h+l;switch(y){case 0:{u&&(e.setEffectType(0,55+u,0),e.dispatchEvent("efxreverb",e.getEffectType(0)),console.debug(`SD MFX Rev: ${y} - ${u}`));break}}});break}case 3:case 4:case 5:{let u=o-1;r.subarray(2).forEach((h,y)=>{let k=y+l;switch(console.debug(`SD MFX ${u-2}: ${k} - ${h}`),k){case 0:{e.setEffectTypeRaw(u,62,h),e.dispatchEvent(`efx${u>2?"delay":"insert"+(u-4)}`,e.getEffectType(u));break}}}),console.debug(`SD MFX message:
%o`,r);break}default:console.debug(`Unknown SD-90 global effects message:
%o`,r)}break}case 1:{let o=e.chRedir(n,i,!0),l=r[1],u=o*b.cc;r.subarray(2).forEach((h,y)=>{let k=l+y;k<37?([()=>{},()=>{},0,()=>{},()=>{switch(t(e,m)[u+E[0]]=h,h){case 104:case 105:case 106:case 107:case 120:{t(e,R)[o]||e.setChType(o,e.CH_DRUMS);break}default:t(e,R)[o]&&e.setChType(o,e.CH_MELODIC)}e.pushChPrimitives(o),e.dispatchEvent("voice",{part:o})},()=>{t(e,m)[u+E[32]]=h,e.pushChPrimitives(o),e.dispatchEvent("voice",{part:o})},()=>{t(e,I)[o]=h,e.dispatchEvent("voice",{part:o})},()=>{t(e,m)[u+E[7]]=h},()=>{t(e,m)[u+E[10]]=h},()=>{},()=>{},()=>{h<2&&(t(e,ce)[o]=h)},()=>{h<2&&(t(e,m)[u+E[68]]=h?127:0)},()=>{},()=>{h<2&&(t(e,m)[u+E[65]]=h?127:0)},()=>{t(e,m)[u+E[5]]=h&15<<4|t(e,m)[u+E[5]]&15},()=>{t(e,m)[u+E[5]]=h&15|(t(e,m)[u+E[5]]&240)>>4},()=>{t(e,m)[u+E[74]]=h},()=>{t(e,m)[u+E[71]]=h},()=>{t(e,m)[u+E[73]]=h},()=>{t(e,m)[u+E[72]]=h},0,0,0,0,0,0,0,()=>{t(e,m)[u+E[128]]=h,e.allocateAce(128)},()=>{t(e,m)[u+E[93]]=h},()=>{t(e,m)[u+E[91]]=h},0,0,()=>{t(e,m)[u+E[75]]=h},()=>{t(e,m)[u+E[76]]=h},()=>{t(e,m)[u+E[77]]=h},()=>{t(e,m)[u+E[78]]=h}][k]||(()=>{}))():k<63||(k<64?(t(e,R)[o]?t(e,m)[u+E[0]]=104|h:t(e,m)[u+E[0]]=96|h,e.dispatchEvent("voice",{part:o})):console.debug(`Unknown SD-90 global CH${o+1} param setup message:
%o`,r))});break}case 2:{let o=e.chRedir(n,i,!0),l=r[1];console.debug(`Unknown SD-90 global CH${o+1} MIDI setup message:
%o`,r.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,r)}}),t(e,Te).add([0,1,73,78],(r,i,d)=>{e.switchMode("krs"),e.setPortMode(e.getTrackPort(i),1,x.krs),console.debug("Might be KORG KROSS 2 mode reset... Not sure.")}).add([0,1,73,117,2,37],(r,i,d)=>{e.switchMode("krs");let s=e.getTrackPort(i);if(t(e,K)[s]&&t(e,K)[s]!=x.krs)if(t(e,Se).dumpLimit==e.DUMP_MODE){console.warn(`Dump cancelled. Port ${String.fromCharCode(65+s)} mode "${j[t(e,K)[s]]}" mismatch, should be "krs".`);return}else console.info(`Track ${i} is trying to perform a mismached mode dump on port ${String.fromCharCode(65+s)}.`);e.setPortMode(e.getTrackPort(i),1,x.krs);let n="KROSS 2 BMT1 ",o="";me(r,(l,u)=>{if(u<24)o+=String.fromCharCode(Math.max(32,l));else if(!(u<1276)){let h=u-1276,y=e.chRedir(Math.floor(h/44),i,!0),k=h%44,T=b.cc*y;k<15?([()=>{l&&e.setChActive(y,1),t(e,I)[y]=l,e.dispatchEvent("voice",{part:y})},()=>{l&&e.setChActive(y,1),l<10?(t(e,m)[T+E[0]]=63,t(e,m)[T+E[32]]=l):l<20?(t(e,m)[T+E[0]]=121,t(e,m)[T+E[32]]=l-10):l<24&&(t(e,m)[T+E[0]]=[120,0,56,62][l-20],t(e,m)[T+E[32]]=0),e.pushChPrimitives(y),e.dispatchEvent("voice",{part:y})},()=>{let M=e.chRedir(l&15,i,!0);t(e,q)[y]=M,console.info(`${n}CH${y+1} receives from CH${M+1}`)},!1,!1,()=>{t(e,m)[T+E[7]]=l},!1,()=>{},()=>{},!1,!1,!1,!1,!1,()=>{t(e,m)[T+E[10]]=l||128}][k]||(()=>{}))():k<36||([()=>{t(e,m)[T+E[74]]=(l+128&255)-64},()=>{t(e,m)[T+E[71]]=(l+128&255)-64},!1,!1,()=>{t(e,m)[T+E[73]]=(l+128&255)-64},()=>{t(e,m)[T+E[75]]=(l+128&255)-64},!1,()=>{t(e,m)[T+E[72]]=(l+128&255)-64}][k]||(()=>{}))()}}),o=o.trimRight(),e.dispatchEvent("metacommit",{type:"EORTitle",data:o})})}chRedir(e,a,f){let c=this;if(t(c,Ge)[a])return(t(c,Ge)[a]-1)*16+e;if(t(c,H)==x.sc){if(f==1)return e;let p=0,v=!0;for(;v;)t(c,Oe)[e+p]==0?(t(c,Oe)[e+p]=a,console.debug(`Assign track ${a} to channel ${e+p+1}.`),v=!1):t(this,Oe)[e+p]==a?v=!1:(p+=16,p>=128&&(p=0,v=!1));return e+p}else return e}getTrackPort(e){return this.chRedir(0,e,!0)>>4}forceVoiceRefresh(){for(let e=0;e<b.ch;e++)t(this,pe)[e]&&this.dispatchEvent("voice",{part:e})}buildRchTree(){let e=[];t(this,q).forEach((a,f)=>{var c;a<b.ch&&((c=e[a])!=null&&c.constructor||(e[a]=[]),e[a].push(f))}),S(this,Tt,e)}buildRccMap(){let e=this;for(let a=0;a<b.ch;a++)t(e,Qe)[a]={};t(e,qe).forEach((a,f)=>{a&&(t(e,Qe)[Math.floor(f/b.redir)][a]=f%b.redir|128)}),A()&&console.debug(t(e,Qe))}getActive(){return t(this,pe)}getCc(e){let a=this,f=e*b.cc;return t(a,m).subarray(f,f+b.cc)}getCcCh(e,a){let f=this;if(kt.indexOf(a)<0)throw new Error("CC number not accepted");return t(f,m)[b.cc*e+E[a]]}getCcAll(){return t(this,m).slice()}getChSource(){return t(this,q)}getChType(){return t(this,R)}setChType(e,a,f=0,c=!1){a&=15;let p=this;f=f||p.getChModeId(e),t(p,R)[e]=a,a>0&&!c&&(t(p,m)[e*b.cc+E[0]]=t(p,Y)[f][2],p.pushChPrimitives(e))}setChActive(e,a=0){t(this,pe)[e]!=a&&this.dispatchEvent("channeltoggle",{part:e,active:a}),t(this,pe)[e]=a}getExt(e){let a=b.ext*e,f=t(this,oe).subarray(a,a+b.ext),c=new Uint8Array(f.length);return c.set(f),c[1]=c[1]||t(this,Ot),c}getPitch(){return t(this,Ae)}getProgram(){return t(this,I)}getTexts(){return t(this,de).slice()}getVel(e){let a=new Map,f=this;return t(f,Q).forEach(function(c,p){let v=c>>7,w=c&127;e==v&&t(f,W)[c]>0&&a.set(w,{v:t(f,W)[c],s:t(f,Z)[p]})}),a}getBitmap(){return{bitmap:t(this,he,Re),expire:t(this,ye)}}getLetter(){return{text:t(this,He),set:t(this,Ct),expire:t(this,_e)}}getMode(){return j[t(this,H)]}getMaster(){return{volume:t(this,G)}}getRawStrength(){let e=this;return t(this,Q).forEach(function(a){let f=a>>7;t(e,W)[a]>t(e,xe)[f]&&(t(e,xe)[f]=t(e,W)[a])}),t(this,xe)}getStrength(){let e=[],a=this;return this.getRawStrength().forEach(function(f,c){e[c]=Math.floor(f*t(a,m)[c*b.cc+E[7]]*t(a,m)[c*b.cc+E[11]]*t(a,G)/803288)}),e}getRpn(){return t(this,D)}getNrpn(){return t(this,dt)}getSubDb(){return self==null?void 0:self.structuredClone(t(this,Y))}getVoice(e,a,f,c="?"){var d;let p=this;(d=x[c])!=null&&d.constructor||(c="?");let v=x[c],w=e||t(p,Y)[v][0],$=a,r=f||t(p,Y)[v][1];w==$e.bank0&&(w=0),r==$e.bank0&&(r=0),c=="ns5r"&&w>0&&w<56&&(r=3);let i=p.userBank.get(w,$,r,c);if(c=="mt32"&&i.name.indexOf("MT-m:")==0){let s=parseInt(i.name.slice(5)),n=s*b.cmt,o="";t(p,Ne).subarray(n,n+10).forEach(u=>{u>31&&(o+=String.fromCharCode(u))});let l=`MSB	LSB	PRG	NME
0	127	${$}	${o}`;p.userBank.load(l,!0),i.name=o,i.ending=" "}return(i.ending!=" "||!i.name.length)&&(i=p.baseBank.get(w,$,r,c)),i}getChPrimitive(e,a,f){if(a>=b.vxPrim||(a==null?void 0:a.constructor)!=Number)throw new RangeError(`Invalid voice primitive component "${a}"`);if(e>=b.ch)throw new RangeError(`Invalid part "CH${e+1}"`);let c=this,p=t(c,I)[a<<b.chShift|e];switch(a){case 1:case 2:{f&&(p=p||t(c,Y)[c.getChModeId(e)][a-1]),p==$e.bank0&&(p=0);break}}return p}getChPrimitives(e,a){let f=this,c=new Uint8Array(3);return c[1]=t(f,I)[e],c[0]=f.getChPrimitive(e,1,a),c[2]=f.getChPrimitive(e,2,a),c}pushChPrimitives(e){let a=this;t(a,I)[1<<b.chShift|e]=t(a,m)[zt[e]+E[0]],t(a,I)[2<<b.chShift|e]=t(a,m)[zt[e]+E[32]]}getChVoice(e){let a=this,f=a.getVoice(...a.getChPrimitives(e),a.getChMode(e));if(t(a,ve)[e]){let c="";switch(t(a,H)){case x.mt32:{t(a,we).subarray(b.cmt*(e-1),b.cmt*(e-1)+10).forEach(p=>{c+=String.fromCharCode(Math.max(p,32))}),c=c.trimRight();break}default:{let p=b.cvn*e;t(a,xt).subarray(p,p+b.cvn).forEach(v=>{c+=String.fromCharCode(Math.max(v,32))}),c=c.trimRight()}}c.length&&(f.ending="~",f.name=c)}return f}getRawPitch(){return t(this,Ae)}getPitchShift(e){let a=this,f=e*b.rpn,c=t(a,D)[f];return t(a,L)[e*b.rpnt]||t(a,H)==x.mt32&&(c=12),t(a,Ae)[e]/8192*c+(t(a,D)[f+3]-64)+((t(a,D)[f+1]<<7)+t(a,D)[f+2]-8192)/8192}getEffectType(e=0){let a=3*e+1;return t(this,le).subarray(a,a+2)}setEffectTypeRaw(e=0,a,f){let c=3*e;t(this,le)[c]=1,t(this,le)[c+1+ +a]=f}setEffectType(e=0,a,f){this.setEffectTypeRaw(e,!1,a),this.setEffectTypeRaw(e,!0,f)}getEffectSink(){return t(this,ft)}setLetterDisplay(e,a,f=0,c=3200){let p=this,v;S(p,He," ".repeat(f)),e.forEach(w=>{S(p,He,t(p,He)+String.fromCharCode(w>31?w:32)),w<32&&(v=v||new Set,v.add(w))}),S(p,Ct,Date.now()),S(p,_e,Date.now()+c),v&&(v=Array.from(v),v.forEach((w,$,r)=>{r[$]=w.toString(16).padStart(2,"0")}),console.warn(`${a}${a?" ":""}invalid code point${v.length>1?"s":""}: 0x${v.join(", 0x")}`))}setDetectionTargets(e="?",a=0){let f=this,c=-1;switch(e.replaceAll(", ",",").split(",").forEach(p=>{p=p.toLowerCase();let v=j.indexOf(Qr[p]||p);A()&&console.debug(`Mapped mode "${p}" to ID "${v}".`),v>-1&&(c=v)}),A()&&console.debug(`Set detection target to ID "${c}".`),c>0&&(t(f,U).x5=82,t(f,U).ds=x.krs),c){case x["05rw"]:{t(f,U).x5=81;break}case x.s90es:t(f,U).ds=x.s90es,t(f,U).smotif=x.s90es;case x.motif:t(f,U).ds=x.motif,t(f,U).smotif=x.motif}}setGsTargets(e=!1,a=4){if(!a)a=e?3:4;else{if(a>4||a<0)throw new Error(`Invalid GS level ${a}`);if(e&&a>>1!=1)throw new Error(`Invalid SC level ${a}`)}let f=this;t(f,U)[e?"sc":"gs"]=a,t(f,Y)[x[e?"sc":"gs"]][1]=a,f.forceVoiceRefresh()}getConfigs(){return t(this,St)}setDumpLimit(e){if(e>2||e<0)throw new RangeError("Invalid dump limit.");t(this,Se).dumpLimit=e}allocateAce(e=0,a){let f=this;if(!a||a<128&&a>95){console.warn(`cc${a} cannot be allocated as an active custom effect.`);return}let c=!0,p=0,v=b.ace*e;for(;c&&p<b.ace;)t(f,te)[p+v]==a?c=!1:t(f,te)[p+v]||(c=!1,t(f,te)[p+v]=a,console.info(`Allocated cc${a} to ACE slot ${p} in CH${e+1}.`)),p++;p>=b.ace&&console.warn(`ACE slots are full in CH${e+1}.`)}allocateAceAll(e){let a=this;if(!e||e<128&&e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}for(let f=0;f<b.ch;f++){let c=!0,p=0,v=b.ace*f;for(;c&&p<b.ace;)t(a,te)[p+v]==e?c=!1:t(a,te)[p+v]||(c=!1,t(a,te)[p+v]=e),p++;p>=b.ace&&console.warn(`ACE slots are full in CH${f+1}.`)}}releaseAce(e=0,a){let f=!0,c=b.ace*e,p=c+b.ace;for(;f&&c<p;)t(this,te)[c]==a&&(t(this,te)[c]=0,f=!1),c++;f&&A()&&console.debug(`No ACE slot was allocated to cc${a} in CH${e+1}.`)}resetAce(){t(this,te).fill(0),console.info("All ACE slots have been reset.")}getAce(){return t(this,te)}getChAce(e=0,a=0){if(a<0||a>=b.ace)throw new RangeError("No such ACE slot");let f=t(this,te)[b.ace*e+a];if(f){if(kt.indexOf(f)>=0)return t(this,m)[e*b.cc+E[f]];throw new Error(`Invalid ACE source in CH${e+1}: ${f}`)}else return 0}initDrums(){let e=this;t(e,se).fill(64);for(let a=0;a<b.drm;a++){let f=a*b.dpn;for(let c in wr){let p=wr[c],v=(f+ue[c])*b.dnc;t(e,se).subarray(v,v+b.dnc).fill(p)}}}init(e=0){let a=this;S(a,We,0),t(a,Y)[x.xg][1]=0,a.dispatchEvent("banklevel",{mode:"xg",data:0}),t(a,pe).fill(0),t(a,m).fill(0),t(a,te).fill(0),t(a,I).fill(0),t(a,W).fill(0),t(a,Q).fill(0),t(a,ce).fill(0),t(a,xe).fill(0),t(a,Ae).fill(0),t(a,dt).fill(0),t(a,L).fill(0),t(a,oe).fill(0),t(a,K).fill(0),t(a,Le).fill(0),t(a,qe).fill(0),S(a,G,100),S(a,de,[]),S(a,ut,500),S(a,pt,0),S(a,ye,0),S(a,ee,0),t(a,he,Re).fill(0),S(a,V,!1),S(a,gt,0),S(a,Ce,!0),a.initDrums(),t(a,q).forEach(function(f,c,p){p[c]=c}),e==0&&(a.dispatchEvent("mode","?"),S(a,H,0),t(a,Oe).fill(0),t(a,Ge).fill(0),S(a,_e,0),S(a,He,"")),br.forEach(f=>{t(a,m)[b.cc*f]=t(a,Y)[a.getChModeId(f)][2]}),t(a,R).fill(a.CH_MELODIC),t(a,R)[9]=a.CH_DRUM1,t(a,R)[25]=a.CH_DRUM3,t(a,R)[41]=a.CH_DRUMS,t(a,R)[57]=a.CH_DRUMS,t(a,R)[73]=a.CH_DRUM5,t(a,R)[89]=a.CH_DRUM7,t(a,R)[105]=a.CH_DRUMS,t(a,R)[121]=a.CH_DRUMS;for(let f=0;f<b.drm;f++)t(a,Ee)[f<<1]=0,t(a,Ee)[f<<1|1]=b.invalidCh;t(a,ht).fill(0),t(a,Ne).fill(0),t(a,Ue).fill(0),t(a,we).fill(0),t(a,ve).fill(0),t(a,le).fill(0),t(a,ft).fill(0),a.aiEfxName="",a.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),a.modelEx.sc.showBar=!0,a.modelEx.sc.invBar=!1,a.modelEx.sc.invDisp=!1,a.modelEx.sc.peakHold=1;for(let f=0;f<b.ch;f++){let c=f*b.cc;t(a,m)[c+E[7]]=100,t(a,m)[c+E[11]]=127,t(a,m)[c+E[2]]=127,t(a,m)[c+E[10]]=64,t(a,m).subarray(c+E[71],c+E[71]+8).fill(64),t(a,m)[c+E[128]]=127,t(a,m).subarray(c+E[130],c+E[157]+1).fill(64),t(a,m)[c+E[91]]=40,t(a,m)[c+E[101]]=127,t(a,m)[c+E[100]]=127,t(a,m)[c+E[99]]=127,t(a,m)[c+E[98]]=127;let p=f*b.rpn;t(a,D)[p]=2,t(a,D)[p+1]=64,t(a,D)[p+2]=0,t(a,D)[p+3]=64,t(a,D)[p+4]=0,t(a,D)[p+5]=0;let v=f*b.ext;t(a,oe)[v+1]=a.VLBC_BRTHEXPR;let w=f*b.redir;t(a,qe)[w+8]=13}a.buildRchTree(),a.buildRccMap(),a.dispatchEvent("mastervolume",t(a,G)),a.dispatchEvent("efxreverb",a.getEffectType(0)),a.dispatchEvent("efxchorus",a.getEffectType(1)),a.dispatchEvent("efxdelay",a.getEffectType(2)),a.dispatchEvent("efxinsert0",a.getEffectType(3)),a.dispatchEvent("efxinsert1",a.getEffectType(4)),a.dispatchEvent("efxinsert2",a.getEffectType(5)),a.dispatchEvent("efxinsert3",a.getEffectType(6)),a.dispatchEvent("reset"),a.switchMode("?")}setChMode(e,a){let f=this;if(e<0||e>=b.ch)throw new RangeError(`Invalid CH${e+1}`);if(port<0||a>=j.length)throw new RangeError(`Invalid mode ID ${a}`);t(f,Le)[e]=a,f.dispatchEvent("voice",{part:e})}getChMode(e,a){return j[this.getChModeId(e,a)]}getChModeId(e,a){return a?t(this,Le)[e]||t(this,K)[e>>4]:t(this,Le)[e]||t(this,K)[e>>4]||t(this,H)}setPortMode(e,a,f){let c=this;if(e<0||e>=b.ch>>4)throw new RangeError(`Invalid port ${e+1}`);if(a<1)throw new RangeError("Range must be a positive integer");if(e+a>=b.ch>>4)throw new RangeError("Range must be in bound");if(e<0||f>=j.length)throw new RangeError(`Invalid mode ID ${f}`);for(let p=e;p<e+a;p++){t(c,K)[p]=f;for(let v=p<<4;v<p+1<<4;v++)c.dispatchEvent("voice",{part:v})}}copyChSetup(e,a,f){if(e==a){console.warn(`Failed attempt at overwriting CH${e+1} with its own data.`);return}let c=this;if(f&&t(c,pe)[a]){console.warn(`Failed attempt at copying setup data from CH${e+1} to CH${a+1}.`);return}let p=b.cc*e,v=b.cc*a;t(c,I)[a]=t(c,I)[e],t(c,m).set(t(c,m).subarray(p,p+b.cc),v),c.pushChPrimitives(a)}setDrumFirstWrite(e,a){let f=this,c=t(f,R)[e];if(c<2)return;let p=c-2;if(t(f,Ee)[p<<1])if(a)t(f,Ee)[p<<1]=0,A()&&console.debug(`First write part for drum set ${p+1} has been reset.`);else return;else a?console.warn(`First write part for drum set ${p+1} is already blank.`):(t(f,Ee)[p<<1]=1,t(f,Ee)[p<<1|1]=e,console.debug(`First write part for drum set ${p+1} is set to CH${e+1}.`))}getChDrumFirstWrite(e){let a=this,f=t(a,R)[e];if(f<2)return;let c=f-2;return t(a,Ee).subarray(c<<1,c+1<<1)}getDrumFirstWrite(e){if(e>=0&&e<b.drm)return t(this,Ee).subarray(e<<1,e+1<<1)}switchMode(e,a=!1,f=!1){var v;let c=this,p=x[e];if(p>-1){if(t(c,H)==0||a){let w=t(c,H);c.initOnReset&&a&&(this.init(1),w=x["?"]),S(c,H,p),S(c,ee,0);for(let r=0;r<b.ch;r++)t(c,R)[r]>0&&t(c,Le)[r]==0&&(t(c,m)[r*b.cc]=t(c,Y)[p][2],c.pushChPrimitives(r));switch(p){case x.mt32:{Vt.forEach((r,i)=>{let d=i+1;t(c,pe)[d]||(t(c,I)[d]=r,t(c,m)[d*b.cc+E[91]]=127,c.pushChPrimitives(d))});for(let r=1;r<10;r++)c.dispatchEvent("voice",{part:r});break}}let $;switch(p){case x["?"]:case x.g2:{$=[52,4,52,18,0,0,0,0];break}case x.xg:{$=[1,0,65,0,5,0,0,0];break}case x.gm:case x.gs:case x.sc:{$=[40,4,40,18,40,32,32,0];break}case x.sd:{$=[58,0,60,0,61,0,61,0];break}case x["05rw"]:case x.x5d:case x.ns5r:{$=[44,1,44,19,44,0,44,0];break}case x.k11:case x.sg:{$=[24,0,0,0,0,0,0,0];break}case x.mt32:{$=[40,4,0,0,0,0,0,0];break}case x.doc:{$=[24,16,0,0,0,0,0,0];break}case x.motif:case x.s90es:{$=[113,0,117,0,114,0,0,0];break}default:$=[0,0,0,0,0,0,0,0]}for(let r=0;r<b.efx;r++)!t(c,le)[3*r]&&((v=$[r<<1])!=null&&v.constructor)&&(t(c,le)[3*r+1]=$[2*r],t(c,le)[3*r+2]=$[2*r+1],c.dispatchEvent(`efx${["reverb","chorus","delay","insert0"][r]}`,c.getEffectType(r)));f&&c.setDetectionTargets(e),c.dispatchEvent("mode",e),c.forceVoiceRefresh(),br.forEach(r=>{c.dispatchEvent("voice",{part:r})})}}else throw new Error(`Unknown mode ${e}`)}newStrength(){t(this,xe).fill(0)}runJson(e){var a;if(e.type>14)return e.type==15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),t(this,Mt)[e.type].call(this,e);{let f=this.chRedir(e.part,e.track),c=!1;(a=t(this,Tt)[f])==null||a.forEach(p=>{e.channel=p,c=!0,t(this,Mt)[e.type].call(this,e)}),c||console.warn(`${mr[e.type]?mr[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${f+1} without any recipient.`)}t(this,de).length>100&&t(this,de).splice(100,t(this,de).length-99)}runRaw(e){}async loadBank(e,a){let f=this;switch(e=e.toLowerCase(),e){case"s7e":{f.userBank.clearRange({msb:63,lsb:[21,22]}),f.userBank.clearRange({msb:63,lsb:[24,27]});break}case"pcg":{f.userBank.clearRange({msb:63,lsb:[6,9]}),f.userBank.clearRange({msb:63,lsb:[13,16]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":case"pcg":{Et.context=this,await f.userBank.load(await Et.read(e,a),!1);break}}f.forceVoiceRefresh()}},H=new WeakMap,ee=new WeakMap,ye=new WeakMap,De=new WeakMap,he=new WeakSet,Re=function(){return t(this,De)[t(this,ee)]},Sr=function(e){t(this,De)[t(this,ee)]=e},pe=new WeakMap,q=new WeakMap,R=new WeakMap,m=new WeakMap,te=new WeakMap,I=new WeakMap,W=new WeakMap,ce=new WeakMap,Q=new WeakMap,Z=new WeakMap,Ae=new WeakMap,xe=new WeakMap,ze=new WeakMap,oe=new WeakMap,D=new WeakMap,L=new WeakMap,dt=new WeakMap,se=new WeakMap,Ee=new WeakMap,le=new WeakMap,ft=new WeakMap,qe=new WeakMap,K=new WeakMap,Le=new WeakMap,ve=new WeakMap,xt=new WeakMap,Ue=new WeakMap,we=new WeakMap,ht=new WeakMap,Ne=new WeakMap,Y=new WeakMap,U=new WeakMap,Se=new WeakMap,St=new WeakMap,G=new WeakMap,We=new WeakMap,ut=new WeakMap,pt=new WeakMap,He=new WeakMap,_e=new WeakMap,Ct=new WeakMap,gt=new WeakMap,Ce=new WeakMap,V=new WeakMap,Ot=new WeakMap,Tt=new WeakMap,Qe=new WeakMap,de=new WeakMap,Oe=new WeakMap,Ge=new WeakMap,re=new WeakMap,Ye=new WeakMap,z=new WeakMap,Mt=new WeakMap,It=new WeakMap,Ze=new WeakMap,Je=new WeakMap,fe=new WeakMap,ge=new WeakMap,Te=new WeakMap,je=new WeakMap,et=new WeakMap,tt=new WeakMap,xr);var Yt=Gr(Cr(),1);N();N();var Pt,Tr,Pr=(Tr=class{constructor(g,e,a,f){C(this,Pt,!1);S(this,Pt,g),this.start=e,this.end=a,this.data=f}get duration(){return this.ranged?this.end-this.start:0}get ranged(){return t(this,Pt)}},Pt=new WeakMap,Tr),Wt=class extends Pr{constructor(g,e,a){super(!0,g,e,a)}},Rr=class extends Pr{constructor(g,e){super(!1,g,g,e)}},rt,Mr,Qt=(Mr=class extends Array{constructor(){super(...arguments);C(this,rt,-1)}resetIndex(e){S(this,rt,-1)}fresh(){this.sort(function(e,a){return e.start==a.start?0:(+(e.start>a.start)<<1)-1}),this.forEach(function(e,a){e.index=a})}step(e,a=!1){let f=[];if(a)for(let c=0;c<this.length&&!(this[c].start>e);c++){if(this[c].end<e)continue;f.push(this[c])}else{let c=this.getRange(t(this,rt)==-1?0:e-1,e),p=this;c.forEach(function(v){v.index>t(p,rt)&&(f.push(v),S(p,rt,v.index))})}return f}getRange(e,a){var w;e>a&&([e,a]=[a,e]);let f=[],c=-1,p=Math.ceil(Math.sqrt(this.length)),v=!0;for(let $=0;$<this.length;$+=p)this[$+p]?c<0&&this[$+p].start>=e&&(c=$):c=c<0?$:c;for(;v;)((w=this[c])==null?void 0:w.end)<a?this[c].start>=e&&f.push(this[c]):v=!1,c++;return f}},rt=new WeakMap,Mr);var na=0xffffffffffff,Dr=function(g){let e=new Qt,a=this,f=g.timeDivision,c=120,p=new Qt,v=0,w=0;p.push(new Wt(0,na,[120,0])),g.track.forEach(function(d){v=0,d.event.forEach(function(s){v+=s.deltaTime,s.type==255&&(s==null?void 0:s.metaType)==81&&(c=6e7/s.data,p[p.length-1]&&p.push(new Wt(v,0xffffffffffff,[c,0])))})}),p.fresh(),p.forEach(function(d,s,n){s>0&&(n[s-1].end=d.start)});let $=120;p.forEach(function(d,s,n){s>0&&(d.end==d.start?n.splice(n.indexOf(d),1):$==d.data[0]&&(n[s-1].end=d.end,n.splice(n.indexOf(d),1)),$=d.data[0])});let r=0,i=120;return p.forEach(function(d){let s=d.start,n=s/i/f*60+r;i=d.data[0],r=n-s/i/f*60,d.data[1]=r}),console.debug("All tempo changes: ",p),c=120,v=0,w=0,g.track.forEach(function(d,s){v=0,w=0;let n=s+1;d.event.forEach(function(o,l){v+=o.deltaTime;let u=p.step(v,!0)[0];u&&(c=u.data[0],w=u.data[1]);let h={type:o.type,data:o.data,track:n,part:0};o.type>14?h.meta=o.metaType:h.part=o.channel,e.push(new Rr(v/c/f*60+w,h))})}),e.fresh(),self.midiEvents=e,console.debug(`Parsed a type ${g.formatType} MIDI sequence.`),e};Yt.default.customInterpreter=pr;var _=function(g,e,a){g.addEventListener(a,f=>{e.dispatchEvent(a,f.data)})},at,Xe,bt,Ie,st,mt,it,Rt,Ve,Fe,ae,nt,Me,ct,Dt,Ke,Ar,us=(Ar=class extends At{constructor(e,a=.5,f=.5){super();P(this,"device");C(this,at,void 0);C(this,Xe,{});C(this,bt,[]);C(this,Ie,"");C(this,st,[]);C(this,mt,[]);C(this,it,new Uint8ClampedArray(128));C(this,Rt,new Uint8ClampedArray(128));C(this,Ve,.5);C(this,Fe,120);C(this,ae,4);C(this,nt,4);C(this,Me,0);C(this,ct,0);C(this,Dt,new Array(b.ch));C(this,Ke,new Uint8Array(b.ch));P(this,"smoothingAtk",0);P(this,"smoothingDcy",0);let c=this;c.smoothingAtk=a,c.smoothingDcy=f,c.device=e,c.addEventListener("meta",function(p){var v;(v=p==null?void 0:p.data)==null||v.forEach(function(w){(t(c,st)[w.meta]||console.debug).call(c,w.meta,w.data)})}),_(c.device,c,"mode"),_(c.device,c,"mastervolume"),_(c.device,c,"channelactive"),_(c.device,c,"channelmin"),_(c.device,c,"channelmax"),_(c.device,c,"portrange"),_(c.device,c,"portstart"),_(c.device,c,"channelreset"),_(c.device,c,"channeltoggle"),_(c.device,c,"screen"),_(c.device,c,"metacommit"),_(c.device,c,"voice"),_(c.device,c,"pitch"),_(c.device,c,"note"),_(c.device,c,"reset"),_(c.device,c,"banklevel"),_(c.device,c,"efxreverb"),_(c.device,c,"efxchorus"),_(c.device,c,"efxdelay"),_(c.device,c,"efxinsert0"),_(c.device,c,"efxinsert1"),_(c.device,c,"efxinsert2"),_(c.device,c,"efxinsert3"),_(c.device,c,"partefxtoggle"),c.addEventListener("note",function({data:p}){t(c,mt).push(p)}),c.addEventListener("voice",({data:p})=>{var w;let v=c.getChVoice(p.part);t(c,Dt)[p.part]=v,t(c,Ke)[p.part]=(w=v.poly)!=null?w:1}),c.addEventListener("reset",({data:p})=>{t(c,Ke).fill(1)}),t(c,Ke).fill(1),t(c,st)[3]=function(p,v){var w;((w=t(c,Ie))==null?void 0:w.length)<1&&(S(c,Ie,v),c.dispatchEvent("title",t(c,Ie)))},t(c,st)[81]=function(p,v){let w=c.noteProgress,$=t(c,Ve)||.5;S(c,Fe,6e7/v),S(c,Ve,v/1e6),S(c,Me,t(c,Me)+(w*($/t(c,Ve))-w)),c.dispatchEvent("tempo",t(c,Fe))},t(c,st)[88]=function(p,v){let w=c.noteProgress,$=c.noteOverall,r=c.noteBar,i=c.noteBeat,d=t(c,ae),s=t(c,nt);S(c,ae,v[0]),S(c,nt,1<<v[1]);let n=24*(32/v[3])/v[2];if(d!=t(c,ae)){let o=r;S(c,Me,t(c,Me)-o*(t(c,ae)-d)),i+1>=d&&(d<t(c,ae)?S(c,Me,t(c,Me)-Math.ceil(t(c,ae)-i-1)):S(c,Me,t(c,Me)+t(c,ae)))}c.dispatchEvent("tsig",c.getTimeSig())}}reset(){var a;let e=this;e.dispatchEvent("reset"),(a=t(e,at))==null||a.resetIndex(),e.device.init(),S(e,Ie,""),S(e,Ve,.5),S(e,Fe,120),S(e,ae,4),S(e,nt,4),S(e,Me,0),S(e,ct,0),e.dispatchEvent("tempo",t(e,Fe)),e.dispatchEvent("title",t(e,Ie))}init(){this.reset(),S(this,at,void 0)}async loadFile(e){S(this,at,Dr(Yt.default.parse(new Uint8Array(await e.arrayBuffer()))))}async loadMap(e,a,f){let c=this,p=0,v=0,w=0,$=0,r,i;e.split(`
`).forEach((d,s)=>{var o;if(!d)return;let n=d.split("	");if(s){if(!$)return;let l="",u="";n.forEach((y,k)=>{switch(k){case r:{l=y;break}case i:{u=y;break}}});let h=!1;((o=t(c,Xe)[l])==null?void 0:o.priority)>f&&(h=!0,w++),!t(c,Xe)[l]||h||a?(t(c,Xe)[l]={name:u,priority:f},p++):self.debugMode&&console.debug(`Voice "${u}" (${l}) seems to be in conflict with (${t(c,Xe)[l]}).`),v++}else n.forEach((l,u)=>{switch(l){case"ID":{r=u,$++;break}case"Name":{i=u,$++;break}default:console.debug(`Unknown map field: ${l}`)}})}),console.debug(`Voice names: ${v} total, ${p} loaded (${p-w} + ${w}).`),c==null||c.device.forceVoiceRefresh()}async loadMapPaths(e){let a=this;e.forEach(async(f,c)=>{a.loadMap(await(await fetch(f)).text(),0,c)})}async loadEfx(e,a){let f=this,c=0,p=0,v,w,$;e.split(`
`).forEach((r,i)=>{if(r)if(i){let d=0,s;r.split("	").forEach((n,o)=>{switch(o){case v:{d|=parseInt(n,16)<<8;break}case w:{d|=parseInt(n,16);break}case $:{s=n;break}}}),!t(f,bt)[d]||a?(t(f,bt)[d]=s,c++):self.debugMode&&console.debug(`EFX ID 0x${d.toString(16).padStart(4,"0")} (${s}) seems to be in conflict.`),p++}else r.split("	").forEach((d,s)=>{switch(d){case"MSB":{v=s;break}case"LSB":{w=s;break}case"Name":{$=s;break}default:console.debug(`Unknown EFX field: ${d}`)}})}),console.debug(`EFX: ${p} total, ${c} loaded.`),f.dispatchEvent("efxreverb",f.device.getEffectType(0)),f.dispatchEvent("efxchorus",f.device.getEffectType(1)),f.dispatchEvent("efxdelay",f.device.getEffectType(2)),f.dispatchEvent("efxinsert0",f.device.getEffectType(3)),f.dispatchEvent("efxinsert1",f.device.getEffectType(4)),f.dispatchEvent("efxinsert2",f.device.getEffectType(5)),f.dispatchEvent("efxinsert3",f.device.getEffectType(6))}switchMode(e,a=!1){this.device.switchMode(e,a)}getMode(){return this.device.getMode()}getVoice(){return this.device.getVoice(...arguments)}getChVoice(e){return this.device.getChVoice(e)}getMapped(e){var a;return((a=t(this,Xe)[e])==null?void 0:a.name)||e}getEfx([e,a]){let f=e<<8|a;return t(this,bt)[f]||`0x${f.toString(16).padStart(4,"0")}`}getVoxBm(e){if(!e)throw new Error("Voice object must be valid");let a=this;if(!a.voxBm)throw new Error("Voice bitmap repository isn't yet initialized");let f=a.voxBm.getBm(e.name);if(!f)switch(e.mode){case"xg":{switch(e.sid[0]){case 0:case 80:case 81:case 83:case 84:case 96:case 97:case 99:case 100:{f=a.voxBm.getBm(a.getVoice($e.bank0,e.sid[1],$e.bank0,e.mode).name);break}}break}case"g2":case"sd":{switch(e.sid[0]){case 96:case 97:case 98:case 99:{f=a.voxBm.getBm(a.getVoice($e.bank0,e.sid[1],$e.bank0,e.mode).name);break}case 104:case 105:case 106:case 107:{f=a.voxBm.getBm(a.getVoice(120,e.sid[1],$e.bank0,e.mode).name);break}}break}case"gs":case"sc":case"k11":case"sg":case"gm":{switch(e.sid[0]){case 120:break;case 122:case 127:{f=a.voxBm.getBm(a.getVoice(120,e.sid[1],0,e.mode).name);break}default:f=a.voxBm.getBm(a.getVoice(0,e.sid[1],0,e.mode).name)}break}default:switch(e.sid[0]){case 56:{f=a.voxBm.getBm(a.getVoice(0,e.sid[1],0,e.mode).name);break}}}return f||(f=a.voxBm.getBm(a.getVoice(e.sid[0],e.sid[1],0,e.mode).name)),f}getChBm(e,a){let f=this;a=a||f.getChVoice(e);let c=f.getVoxBm(a);if(!c){if(!f.sysBm)return;switch(a.mode){case"xg":{switch(a.sid[0]){case 126:{a.sid[1]>>1==56&&(c=f.sysBm.getBm("cat_smpl"));break}case 16:{c=f.sysBm.getBm("cat_smpl");break}case 64:case 67:{c=f.sysBm.getBm("cat_sfx");break}case 32:case 33:case 34:case 35:case 36:case 48:case 82:{c=f.sysBm.getBm("cat_xg");break}}break}default:switch(a.sid[0]){case 63:case 32:case 33:case 34:case 35:case 36:case 48:case 82:{c=f.sysBm.getBm("cat_mex");break}}}}return c||(f.device.getChType()[e]?c=f.sysBm.getBm("cat_drm"):c=f.sysBm.getBm("no_vox")),c}get noteProgress(){return t(this,ct)/t(this,Ve)}get noteOverall(){return this.noteProgress-t(this,Me)}get noteBar(){return Math.floor(this.noteOverall/t(this,ae))}get noteBeat(){let e=this.noteOverall%t(this,ae);return e<0&&(e+=t(this,ae)),e}get noteOffset(){return t(this,Me)}getTimeSig(){return[t(this,ae),t(this,nt)]}getTempo(){return t(this,Fe)}eachVoice(e){t(this,Dt).forEach(e)}sendCmd(e){this.device.runJson(e)}render(e){var M;e>t(this,ct)&&S(this,ct,e);let a=((M=t(this,at))==null?void 0:M.step(e))||[],f=0,c=0,p=new Set,v={},w=[],$=this,r=[];for($.device.getStrength().forEach((B,O)=>{t($,Rt)[O]=B}),$.device.newStrength(),a.forEach(function(B){let O=B.data,F=$.device.runJson(O);switch(F==null?void 0:F.reply){case"meta":{r.push(F);break}}F!=null&&F.reply&&delete F.reply});t($,mt).length>0;){let B=t($,mt).shift(),O=B.part<<7|B.note;B.state?(p.add(O),v[O]=B.velo):p.has(O)&&(w.push({part:B.part,note:B.note,velo:v[O],state:$.device.NOTE_SUSTAIN}),f++,c+=t($,Ke)[B.part])}(r==null?void 0:r.length)>0&&$.dispatchEvent("meta",r);let i=$.device.getActive(),d=[],s=$.device.getPitch(),n=$.device.getCcAll(),o=$.device.getProgram(),l=$.device.getChType(),u=[],h=$.device.getStrength();h.forEach(function(B,O,F){F[O]=Math.max(t($,Rt)[O],B);let X=F[O]-t($,it)[O],Pe=E.length*O;if(X>=0){let Lt=4*.25**(n[Pe+E[73]]/64);t($,it)[O]+=Math.ceil(X-X*$.smoothingAtk**Lt)}else{let Lt=4*.25**(n[Pe+E[72]]/64);t($,it)[O]+=Math.floor(X-X*$.smoothingDcy**Lt)}});let y=0,k=0;return i.forEach(function(B,O){B&&(d[O]=$.device.getVel(O),u[O]=$.device.getExt(O),y+=d[O].size,k+=d[O].size*t($,Ke)[O])}),{extraPoly:f,extraPolyEC:c,extraNotes:w,curPoly:y,curPolyEC:k,chInUse:i,chKeyPr:d,chPitch:s,chProgr:o,chContr:n,chType:l,chExt:u,eventCount:a.length,title:t($,Ie),bitmap:$.device.getBitmap(),letter:$.device.getLetter(),texts:$.device.getTexts(),master:$.device.getMaster(),mode:$.device.getMode(),strength:t($,it).slice(),velo:h,rpn:$.device.getRpn(),tSig:$.getTimeSig(),tempo:$.getTempo(),noteBar:$.noteBar,noteBeat:$.noteBeat,ace:$.device.getAce(),rawVelo:$.device.getStrength(),rawStrength:$.device.getRawStrength(),rawPitch:$.device.getRawPitch(),efxSink:$.device.getEffectSink()}}},at=new WeakMap,Xe=new WeakMap,bt=new WeakMap,Ie=new WeakMap,st=new WeakMap,mt=new WeakMap,it=new WeakMap,Rt=new WeakMap,Ve=new WeakMap,Fe=new WeakMap,ae=new WeakMap,nt=new WeakMap,Me=new WeakMap,ct=new WeakMap,Dt=new WeakMap,Ke=new WeakMap,Ar);export{us as RootDisplay,b as allocated,E as ccToPos,ue as dnToPos};
