var la=Object.create;var bt=Object.defineProperty;var da=Object.getOwnPropertyDescriptor;var fa=Object.getOwnPropertyNames;var ha=Object.getPrototypeOf,ua=Object.prototype.hasOwnProperty;var pa=(b,e,r)=>e in b?bt(b,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):b[e]=r;var Rt=(b,e)=>()=>(b&&(e=b(b=0)),e);var ba=(b,e)=>()=>(e||b((e={exports:{}}).exports,e),e.exports);var ga=(b,e,r,d)=>{if(e&&typeof e=="object"||typeof e=="function")for(let c of fa(e))!ua.call(b,c)&&c!==r&&bt(b,c,{get:()=>e[c],enumerable:!(d=da(e,c))||d.enumerable});return b};var ya=(b,e,r)=>(r=b!=null?la(ha(b)):{},ga(e||!b||!b.__esModule?bt(r,"default",{value:b,enumerable:!0}):r,b));var M=(b,e,r)=>(pa(b,typeof e!="symbol"?e+"":e,r),r),Ot=(b,e,r)=>{if(!e.has(b))throw TypeError("Cannot "+r)};var t=(b,e,r)=>(Ot(b,e,"read from private field"),r?r.call(b):e.get(b)),S=(b,e,r)=>{if(e.has(b))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(b):e.set(b,r)},w=(b,e,r,d)=>(Ot(b,e,"write to private field"),d?d.call(b,r):e.set(b,r),r);var Dt=Rt(()=>{"use strict";O();(function(){var b=function(m,a,n){var l,i;if(self.MessageEvent)switch(m){case"message":{i=new MessageEvent(m,{data:a,ports:n==null?void 0:n.ports}),Object.defineProperty(i,"source",{value:n==null?void 0:n.source});break}default:i=new Event(m)}else i=document.createEvent("Event"),i.initEvent(m,!1,!1),n&&m=="message"&&(i.data=a,n.source&&Object.defineProperty(i,"source",{value:n.source}),(l=n.ports)!=null&&l.length&&Object.defineProperty(i,"ports",{value:n.ports}));return i};self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),r=[],d={},c=function(m){var a,n=this;if((this==null?void 0:this.constructor)!=c)throw new TypeError("Illegal constructor");r.push(this),(a=d[m])!=null&&a.constructor||(d[m]=[]),d[m].push(this);var l=Math.floor(Math.random()*281474976710656),i=[],s=0,o=[],f=!0,u=!1;Object.defineProperty(this,"id",{get:function(){return l}}),Object.defineProperty(this,"name",{value:m}),this.close=function(){var E,k=r.indexOf(n);k>-1?(e.postMessage({t:"d",c:m,i:l}),r.splice(k,1),(E=d[m])!=null&&E.constructor&&(k=d[m].indexOf(n),k>-1&&d[m].splice(k,1)),d[m].length||delete d[m],console.debug("[Snowy] BroadcastChannel closed."),u=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(E){if(e){if(u)throw new Error("Channel already closed");e.postMessage({t:"m",c:m,i:l,m:s,d:E}),s++,s>4294967295&&(s=0)}else o.push(E),console.debug("[Snowy] Message is cached.")},this.flush=function(){if(e){if(f){for(e.postMessage({t:"r",c:m,i:l}),console.debug("[Snowy] ".concat(o.length," message(s) in cache."));o.length;){var E=o.shift();n.postMessage(E)}f=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(E){E.c==m?E.i!=l&&n.dispatchEvent(b("message",E.d,{source:n})):console.debug("[Snowy] Channel ID mismatch. Instance ".concat(l," receives from ").concat(m,", not ").concat(E.c,"."))};var g={};this.dispatchEvent=function(E){var k,C;if(Object.defineProperty(E,"target",{value:n}),Object.defineProperty(E,"currentTarget",{value:n}),(k=g[E.type])!=null&&k.length)for(var A=g[E.type],_=0;_<A.length;_++)((C=A[_])==null?void 0:C.constructor)==Function&&A[_].call(n,E);n["on".concat(E.type)]&&n["on".concat(E.type)].constructor==Function&&n["on".concat(E.type)].call(n,E)},this.addEventListener=function(E,k){var C;(C=g[E])!=null&&C.constructor||(g[E]=[]);var A=g[E].indexOf(k);A==-1&&g[E].push(k)},this.removeEventListener=function(E,k){var C,A;if((C=g[E])!=null&&C.length){var _=g[E].indexOf(k);_>-1&&g[E].splice(_,1)}!((A=g[E])!=null&&A.length)&&g[E].constructor&&delete g[E]}},self.BroadcastChannel=c,p=function(){if(e){e.addEventListener("message",function(a){var n=a.data,l=!1;switch(n.t){case"k":{l=!1,e.postMessage({t:"k"});break}case"m":{var i=d[n.c];if(i!=null&&i.length)for(var s=0;s<i.length;s++)i[s].receiveMessage(n);break}case"c":{for(var o=[],f=0;f<r.length;f++){var u=r[f].name;o.indexOf(u)<0&&o.push(u)}e.postMessage({t:"k",c:o});break}default:l=!0}l&&console.info("ReceiveBroadcast",n)});for(var m=0;m<r.length;m++)r[m].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},h=function(){if(!e){var m=new SharedWorker(self.SNOWY_PATH||"/snowy.js");m.port.start();var a=function(n){n.data.t=="swc"&&(m.port.removeEventListener("message",a),e=m.port,e.postMessage({t:"k"}),p())};m.port.addEventListener("message",a)}},h());var e,r,d,c,p,h})()});var O=Rt(()=>{"use strict";Dt();{let b=function(e,r){let d=new FileReader;return new Promise((c,p)=>{switch(d.addEventListener("abort",()=>{p(new Error("Blob read aborted"))}),d.addEventListener("error",h=>{p(d.error||h.data||new Error("Blob read error"))}),d.addEventListener("load",()=>{c(d.result)}),r.toLowerCase()){case"arraybuffer":case"buffer":{d.readAsArrayBuffer(e);break}case"string":case"text":{d.readAsText(e);break}default:p(new Error(`Unknown target ${r}`))}})};Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||function(){return b(this,"buffer")},Blob.prototype.text=Blob.prototype.text||function(){return b(this,"text")}}String.prototype.replaceAll=String.prototype.replaceAll||function(b,e){let r=0,d=16,c=this,p=[];for(;r<d&&c.lastIndexOf(b)>-1;){let h=c.lastIndexOf(b);p.unshift(c.slice(h+b.length)),c=c.slice(0,h),h==0&&p.unshift(""),r++}return c.length&&p.unshift(c),p.join(e)||""},String.prototype.padStart=String.prototype.padStart||function(b,e){if(e){let r=this;for(;r.length<b;)r=`${e}${r}`;return r}},String.prototype.padEnd=String.prototype.padEnd||function(b,e){if(e){let r=this;for(;r.length<b;)r+=e;return r}}});var aa=ba((gr,xt)=>{O();(function(){"use strict";let b={fatal:!0},e=[new TextDecoder("iso-8859-15",b),new TextDecoder("sjis",b),new TextDecoder("euc-jp",b),new TextDecoder("utf-8",b),new TextDecoder("utf-16",b),new TextDecoder("ascii")],r={debug:!1,parse:function(d,c){if(d instanceof Uint8Array)return r.Uint8(d);if(typeof d=="string")return r.Base64(d);if(d instanceof HTMLElement&&d.type==="file")return r.addListener(d,c);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(d,c){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(d===void 0||!(d instanceof HTMLElement)||d.tagName!=="INPUT"||d.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;c=c||function(){},d.addEventListener("change",function(p){if(!p.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let h=new FileReader;h.readAsArrayBuffer(p.target.files[0]),h.onload=function(m){c(r.Uint8(new Uint8Array(m.target.result)))}})},Base64:function(d){let c=function(m){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(m=m.replace(/^.*?base64,/,""),m=String(m).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(m))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");m+="==".slice(2-(3&m.length));let n,l="",i,s,o=0;for(;o<m.length;)n=a.indexOf(m.charAt(o++))<<18|a.indexOf(m.charAt(o++))<<12|(i=a.indexOf(m.charAt(o++)))<<6|(s=a.indexOf(m.charAt(o++))),l+=i===64?String.fromCharCode(n>>16&255):s===64?String.fromCharCode(n>>16&255,n>>8&255):String.fromCharCode(n>>16&255,n>>8&255,255&n);return l}(d=String(d));var p=c.length;let h=new Uint8Array(new ArrayBuffer(p));for(let m=0;m<p;m++)h[m]=c.charCodeAt(m);return r.Uint8(h)},Uint8:function(h){let c={data:null,pointer:0,movePointer:function(i){return this.pointer+=i,this.pointer},readInt:function(i){if((i=Math.min(i,this.data.byteLength-this.pointer))<1)return-1;let s=0;if(1<i)for(let o=1;o<=i-1;o++)s+=this.data.getUint8(this.pointer)*Math.pow(256,i-o),this.pointer++;return s+=this.data.getUint8(this.pointer),this.pointer++,s},readStr:function(i){let s=new Uint8Array(i),o=!1,f;s.forEach((u,g)=>{s[g]=this.readInt(1)});for(let u=0;u<e.length;u++)if(!o)try{if(f=e[u].decode(s),u==0)for(let g=0;g<f.length;g++){let E=f.charCodeAt(g);if(E>191||E>127&&E<160)throw new RangeError(`Invalid code point: ${E}`)}o=!0,console.debug(`String byte sequence in ${e[u].encoding}`)}catch(g){console.debug(`SMF string ${g}`)}return f||"String byte sequence read failed."},backOne:function(){this.pointer--},readIntVLV:function(){let i=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)i=this.readInt(1);else{let o=[];for(;128<=this.data.getUint8(this.pointer);)o.push(this.readInt(1)-128);var s=this.readInt(1);for(let f=1;f<=o.length;f++)i+=o[o.length-f]*Math.pow(128,f);i+=s}return i}};if(c.data=new DataView(h.buffer,h.byteOffset,h.byteLength),c.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;c.readInt(4);let p={};p.formatType=c.readInt(2),p.tracks=c.readInt(2),p.track=[];var h=c.readInt(1),m=c.readInt(1);128<=h?(p.timeDivision=[],p.timeDivision[0]=h-128,p.timeDivision[1]=m):p.timeDivision=256*h+m;for(let i=1;i<=p.tracks;i++){p.track[i-1]={event:[]};var a,n=c.readInt(4);if(n===-1)break;if(n!==1297379947)return!1;c.readInt(4);let s=0,o=!1,f,u;for(;!o&&(s++,p.track[i-1].event[s-1]={},p.track[i-1].event[s-1].deltaTime=c.readIntVLV(),(f=c.readInt(1))!==-1);)if(128<=f?u=f:(f=u,c.movePointer(-1)),f===255){p.track[i-1].event[s-1].type=255,p.track[i-1].event[s-1].metaType=c.readInt(1);var l=c.readIntVLV();switch(p.track[i-1].event[s-1].metaType){case 47:case-1:o=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:p.track[i-1].event[s-1].data=c.readStr(l);break;case 33:case 89:case 81:p.track[i-1].event[s-1].data=c.readInt(l);break;case 84:p.track[i-1].event[s-1].data=[],p.track[i-1].event[s-1].data[0]=c.readInt(1),p.track[i-1].event[s-1].data[1]=c.readInt(1),p.track[i-1].event[s-1].data[2]=c.readInt(1),p.track[i-1].event[s-1].data[3]=c.readInt(1),p.track[i-1].event[s-1].data[4]=c.readInt(1);break;case 88:p.track[i-1].event[s-1].data=[],p.track[i-1].event[s-1].data[0]=c.readInt(1),p.track[i-1].event[s-1].data[1]=c.readInt(1),p.track[i-1].event[s-1].data[2]=c.readInt(1),p.track[i-1].event[s-1].data[3]=c.readInt(1);break;default:this.customInterpreter!==null&&(p.track[i-1].event[s-1].data=this.customInterpreter(p.track[i-1].event[s-1].metaType,c,l)),this.customInterpreter!==null&&p.track[i-1].event[s-1].data!==!1||(c.readInt(l),p.track[i-1].event[s-1].data=c.readInt(l),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch((f=f.toString(16).split(""))[1]||f.unshift("0"),p.track[i-1].event[s-1].type=parseInt(f[0],16),p.track[i-1].event[s-1].channel=parseInt(f[1],16),p.track[i-1].event[s-1].type){case 15:this.customInterpreter!==null&&(p.track[i-1].event[s-1].data=this.customInterpreter(p.track[i-1].event[s-1].type,c,!1)),this.customInterpreter!==null&&p.track[i-1].event[s-1].data!==!1||(a=c.readIntVLV(),p.track[i-1].event[s-1].data=c.readInt(a),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:p.track[i-1].event[s-1].data=[],p.track[i-1].event[s-1].data[0]=c.readInt(1),p.track[i-1].event[s-1].data[1]=c.readInt(1);break;case 12:case 13:p.track[i-1].event[s-1].data=c.readInt(1);break;case-1:o=!0;break;default:if(this.customInterpreter!==null&&(p.track[i-1].event[s-1].data=this.customInterpreter(p.track[i-1].event[s-1].metaType,c,!1)),this.customInterpreter===null||p.track[i-1].event[s-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return p},customInterpreter:null};if(typeof xt<"u")xt.exports=r;else{let d=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;d.MidiParser=r}})()});O();O();var j,At,dt=(At=class{constructor(){S(this,j,{})}addEventListener(b,e){t(this,j)[b]||(t(this,j)[b]=[]),t(this,j)[b].unshift(e)}removeEventListener(b,e){if(t(this,j)[b]){let r=t(this,j)[b].indexOf(e);r>-1&&t(this,j)[b].splice(r,1),t(this,j)[b].length<1&&delete t(this,j)[b]}}dispatchEvent(b,e){var c;let r=new Event(b),d=this;r.data=e,((c=t(this,j)[b])==null?void 0:c.length)>0&&t(this,j)[b].forEach(function(p){try{p==null||p.call(d,r)}catch(h){console.error(h)}}),this[`on${b}`]&&this[`on${b}`](r)}},j=new WeakMap,At);O();O();var Pt=function(b,e){let r=Math.min(b.length,e.length),d=b.slice(0,r),c=e.slice(0,r),p=0,h=0;for(;h<r&&p==0;)p=Math.sign(d[h]-c[h]),h++;return p},ce=function(b=""){this.name=b,this.pool=[],this.point=function(e,r=!1){if(this.pool.length>0){let d=this.pool.length,c=1<<Math.floor(Math.log2(d)),p=c,h=64;for(;c>=1&&h>=0;){if(h<=0)throw new Error("TTL reached.");if(p==d)p-=c;else{let a=Pt(e,this.pool[p]);switch(a){case 0:{h=0;break}case 1:{p+c<=d&&(p+=c);break}case-1:{p!=0&&(p-=c);break}default:console.warn(`Unexpected result ${a}.`)}}c=c>>1,h--}let m=!0;if(p>=this.pool.length)m=!1;else{let a=this;this.pool[p].forEach(function(n,l,i){m&&n!=e[l]&&(m=!1)}),!m&&Pt(e,this.pool[p])>0&&p++}return m||r?p:-1}else return r?0:-1},this.add=function(e,r){return e.data=r,this.pool.splice(this.point(e,!0),0,e),this},this.default=function(e){console.warn(`No match in "${this.name||"(unknown)"}" for "${e}". Default action not defined.`)},this.get=function(e){let r=this.point(e);if(r>-1)return this.pool[r].data;this.default(e)},this.run=function(e,...r){let d=this.point(e);d>-1?e.subarray?this.pool[d].data(e.subarray(this.pool[d].length),...r):this.pool[d].data(e.slice(this.pool[d].length),...r):this.default(e,...r)}};O();var va=["MSB","PRG","LSB"],gt=function(b){let e=Math.floor(b/10),r=b%10;return`${e.toString(16)}${r}`},Q,It,yt=(It=class{constructor(...b){S(this,Q,void 0);M(this,"strictMode",!1);this.loadFiles(...b)}get(b=0,e=0,r=0,d){let c=[b,e,r],p,h=Array.from(arguments);switch(d){case"xg":{switch(b){case 0:{r==126?h[2]=125:r==127&&(h[2]=0);break}case 16:{r==126&&(h[2]=0);break}case 32:{h[2]+=4;break}case 33:case 35:case 36:{h[2]+=5;break}case 79:case 80:case 81:case 82:case 83:case 84:h[0]+=16;case 95:case 96:case 97:case 98:case 99:case 100:{r==126&&(h[2]=0);break}case 48:case 64:case 126:case 127:{r==126&&(h[2]=0);break}}break}case"gs":{b==0&&r<5?h[2]=0:b>125&&r<5&&r!=2&&(h[2]=b,h[0]=0);break}case"g2":case"sd":{(b>>1==40||b>95&&b<100)&&(h[2]|=16);break}case"sg":{b==8&&r==0&&(h[2]=5);break}case"s90es":{r<8?h[2]+=17:r<32?h[2]+=13:h[2]=(h[2]>>3)+19;break}case"motif":{r<8?h[2]+=28:r<32?h[2]+=13:h[2]=(h[2]>>3)+19;break}}let m=" ",a="M",n=0,l=0;switch(h[0]){case 0:{h[2]==127?a="MT-a":h[2]==126?a="MT-b":h[2]==7?a="GM-k":h[2]==5?a="SG-a":h[2]==4?a="SP-l":h[2]==0||d=="gs"&&h[2]<5?a="GM-a":(a="y",n=3);break}case 8:{d=="sg"?a="GM-s":a="r:";break}case 48:{a=`yM${(h[2]>>3).toString().padStart(2,"0")}`,n=1;break}case 56:{a="GM-b";break}case 61:case 120:{a="rDrm";break}case 62:{a="kDrm";break}case 63:{if(h[2]<17){let f=h[2];a=f<10?"kP:":"kC:",a+=f%10}else h[2]<34?a=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][h[2]-17]:a="Ds";break}case 64:{a="ySFX";break}case 67:{a="DX:S";break}case 80:case 81:case 82:case 83:{a=`Prg${"UABC"[h[0]-80]}`;break}case 88:case 89:case 90:case 91:{a=`Cmb${"UABC"[h[0]-88]}`;break}case 95:{a=`${["DR","PC"][h[2]]}-d`;break}case 96:{a=h[2]==106?"AP-a":h[2]>>4==1?"SDg":"PF",h[2]>63?l=63:h[2]>>4==1&&(l=16),n=3;break}case 97:{a=h[2]>>4==1?"SDa":"VL:",n=3,h[2]>>4==1?l=16:l=112;break}case 98:{a=h[2]>>4==1?"SDb":"SG-a",n=3,l=16;break}case 99:{a=h[2]>>4==1?"SDc":"DX",h[2]>63?l=63:h[2]>>4==1&&(l=16),n=3;break}case 100:{a="AN",h[2]>63?l=63:h[2]>>4==1&&(l=16),n=3;break}case 104:case 105:case 106:case 107:{a="SDd",l=104;break}case 121:{a=`GM-${h[2]?"":"a"}`,n=3;break}case 122:{a="lDrm";break}case 126:{a="yDrS";break}case 127:{h[2]==127?a="rDrm":a="yDrm";break}default:h[0]<48?a="r:":a="M"}a.length<4&&(a+=`${[b,r,h[0],h[2]][n]-l}`.padStart(4-a.length,"0")),d=="xg"&&(b==0?h[2]<100?a=a.replace("y0","y:"):h[2]==125&&(a="y126"):b==16&&(p=`Voice${(h[2]*128+h[1]+1).toString().padStart(3,"0")}`,m=" "));let i=[h[0],h[1],h[2]];for(;!((p==null?void 0:p.length)>=0);)p=t(this,Q)[h[1]||0][(h[0]<<7)+h[2]],p||(this.strictMode?(p="",m="?"):t(this,Q)[h[1]||0][h[0]<<7]?h[0]==0?(h[2]=0,m="^"):h[2]<1?(h[0]=0,m="*"):(h[2]--,m="^"):b==48?(h[0]=0,h[2]=0,m="!"):b==62?(h[1]--,m=" ",h[1]<1&&!(p!=null&&p.length)&&(h[0]=0,m="!")):b<63?h[0]==0?(h[2]=0,m="^"):h[2]<1?(h[0]=0,m="*"):h[2]--:b==80?(p=`PrgU:${e.toString().padStart(3,"0")}`,m="!"):b==88?(p=`CmbU:${e.toString().padStart(3,"0")}`,m="!"):b==121?(p=`GM2Vox0${r}`,m="#"):b==122?(h[1]==32?h[1]==0:h[1]%=7,p=t(this,Q)[h[1]||0][(h[0]<<7)+h[2]],p?m=" ":(p="",m="*")):h[1]==0?(p=`${b.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")} ${r.toString().padStart(3,"0")}`,m="!"):h[0]==0?(h[2]=0,m="^"):h[2]>0?h[2]--:h[1]>0?(h[1]=0,m="!"):(h[0]=0,m="?"));let s=[h[0],h[1],h[2]];(d=="gs"||d=="ns5r")&&m=="^"&&(m=" "),b==127&&m=="^"&&(m=" "),m!=" "&&self.debugMode&&(p="");let o="??";switch(h[0]){case 0:{h[2]==0?o="GM":h[2]==5||h[2]==7?o="KG":h[2]<126?o="XG":h[2]==127&&(o="MT");break}case 48:{o="MU";break}case 56:{o="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{o="AI";break}case 62:case 82:case 90:{o="XD";break}case 63:{h[2]<17?o="KR":h[2]<34?o="ES":o="DS";break}case 64:case 126:{o="XG";break}case 67:case 99:{o=h[2]>>4==1?"SD":"DX";break}case 81:{o="RW";break}case 95:{o=["DR","PC"][h[2]];break}case 96:{o=h[2]==106?"AP":h[2]>>4==1?"SD":"PF";break}case 97:{o=h[2]>>4==1?"SD":"VL";break}case 98:{o=h[2]>>4==1?"SD":"SG";break}case 100:{o="AN";break}case 104:case 105:case 106:case 107:{o="SD";break}case 120:{o="GS";break}case 121:{o=h[2]?"G2":"GM";break}case 122:{o="KG";break}case 127:{o=h[2]==127?"MT":e==0?"GM":"XG";break}default:h[0]<48&&(h[0]==16&&d=="xg"?o="XG":o="GS")}return{name:p||`${gt(b||0)} ${gt(e||0)} ${gt(r||0)}`,iid:i,eid:s,sid:c,ending:m,sect:a,standard:o}}async load(b,e,r){let d=this,c=[],p=0,h=0;b.split(`
`).forEach(function(m,a){let n=m.split("	"),l=[];a==0?n.forEach(function(i,s){c[va.indexOf(i)]=s}):n.forEach(async function(i,s){var o;s>2?(t(d,Q)[l[c[1]]]=t(d,Q)[l[c[1]]]||[],(!((o=t(d,Q)[l[c[1]]][(l[c[0]]<<7)+l[c[2]]])!=null&&o.length)||e)&&(t(d,Q)[l[c[1]]][(l[c[0]]<<7)+l[c[2]]]=n[3],p++),h++):l.push(parseInt(n[s]))})}),e||console.debug(`Map "${r||"(internal)"}": ${h} total, ${p} loaded.`)}clearRange(b){let e=b.prg!=null?b.prg.constructor==Array?b.prg:[b.prg,b.prg]:[0,127],r=b.msb!=null?b.msb.constructor==Array?b.msb:[b.msb,b.msb]:[0,127],d=b.lsb!=null?b.lsb.constructor==Array?b.lsb:[b.lsb,b.lsb]:[0,127];for(let c=r[0];c<=r[1];c++){let p=c<<7;for(let h=d[0];h<=d[1];h++){let m=p+h;for(let a=e[0];a<=e[1];a++)delete t(this,Q)[a][m]}}}init(){w(this,Q,[]);for(let b=0;b<128;b++)t(this,Q).push([""])}async loadFiles(...b){this.init();let e=this;b.forEach(async function(r,d){try{await fetch(`./data/bank/${r}.tsv`).then(function(c){return c.text()}).then(c=>{e.load(c,!1,r)})}catch(c){console.error(`Failed loading "${r}.tsv".`)}})}},Q=new WeakMap,It);O();O();var Ke,Ut,Lt=(Ut=class{constructor(){S(this,Ke,{});M(this,"context")}set(b,e){t(this,Ke)[b]=e}has(b){return!!t(this,Ke)[b]}async read(b,e){if(!this.has(b))throw new Error(`No decoder registered for "${b}"`);return await t(this,Ke)[b].call(this.context||this,e)}},Ke=new WeakMap,Ut);var ma=function(b,e){let r=!0;return e.forEach((d,c)=>{r=r&&b[c]==d}),r},Bt=function(b){let e=0;return b.forEach(r=>{e*=256,e+=r}),e},tt=new TextDecoder,ft=new Lt;ft.set("s7e",async function(b){let e=new Uint8Array(await b.slice(0,65536).arrayBuffer()),r="MSB	LSB	PRG	NME",d=[0,0,0,0],c=32,p=0,h=0,m=!0,a=[],n=0;for(;m;){let l=e.subarray(p);([()=>{tt.decode(l.subarray(0,4))=="YSFC"?(p+=80,h=1):p++},()=>{if(ma(l.subarray(0,4),d))a.forEach((i,s,o)=>{let f=Bt(e.subarray(i.start+4,i.start+8));i.length=f}),h=2;else{let i=tt.decode(l.subarray(0,4)),s=Bt(l.subarray(4,8));a.push({type:i,start:s}),p+=8}},()=>{let i=a[n],s=e.subarray(i.start,i.start+i.length),o=32;switch(i.type){case"ENVC":{let f=c;for(;f<s.length;){let u=s.subarray(f,f+o),g=tt.decode(u.subarray(0,10)).trimEnd();g.slice(0,5)=="Init "&&(g=""),g&&(r+=`
063	${(u[17]+13).toString().padStart(3,"0")}	${u[19].toString().padStart(3,"0")}	${g}`),f+=o}break}case"EDVC":{let f=c;for(;f<s.length;){let u=s.subarray(f,f+o),g=tt.decode(u.subarray(0,10)).trimEnd();g.slice(0,5)=="Init "&&(g=""),g&&(r+=`
063	024	${u[19].toString().padStart(3,"0")}	${g}`),f+=o}break}case"EPVC":{let f=32,u=c;for(;u<s.length;){let g=s.subarray(u,u+f),E=tt.decode(g.subarray(0,10)).trimEnd();E=="----------"&&(E=""),E&&(r+=`
063	${(g[17]+1).toString().padStart(3,"0")}	${g[19].toString().padStart(3,"0")}	${E}`),u+=f}break}}n++,n>=a.length&&(h=3,m=!1)}][h]||(()=>{m=!1}))()}return r});O();var at=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),rt=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],Ea=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],ze=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],Nt=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],Ht=function(b){let e=.1,r=-.3;return b>66?(e=5,r=315):b>56?(e=1,r=47):b>46&&(e=.5,r=18.5),e*b-r},Gt=function(b){return b>105?Ea[b-106]:b>100?b*1.1-100:b/10},_t=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),vt={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,うぃ
we,うぇ
wo,を
nga,ガ
ngi,ギ
ngu,グ
nge,ゲ
ngo,ゴ
ngy,ギ!
ng,
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,いぇ
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(b=>{let e=b.split(",");vt[e[0]]=e[1]});var Xt=function(b){let e=b;b[0]=="*"&&(e=e.slice(1)),["aa","ii","uu","ee","oo"].forEach(d=>{for(;e.indexOf(d)>-1;)e=e.replace(d,d[0])});for(let d in vt)e=e.replaceAll(d,vt[d]);e.indexOf("ん")==0&&e.length>1&&(e=e.slice(1));let r=e.indexOf("!");return r>-1&&e.length>1&&(e=e.slice(r+1)),e},Ft=function(b){return b?b<96?`cc${b}`:["aftertouch","velocity","pitch bend"][b-96]:"off"};O();var mt=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],Vt=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],Kt=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var $a={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},wa={66307:["drive"],66309:["vowel",b=>"aiueo"[b]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",b=>["off","LPF","HPF"][b]],94984:["noise type",b=>["white","pink"][b]],94987:["disc type",b=>["LP","SP","EP","RND"]],94990:["hum type",b=>`${b+5}0Hz`],94993:["M/S",b=>["mono","stereo"][b]]},Et=function(b){return $a[(b[0]-32<<8)+b[1]]||`0x${b[0].toString(16).padStart(2,"0")}${b[1].toString(16).padStart(2,"0")}`},zt=function(b,e,r){let d=(b[0]-32<<16)+(b[1]<<8)+e,c=wa[d]||{},p=c[0];if(p!=null&&p.length)return p+=`: ${(c[1]||function(){})(r)||r}`,p},$t=[68,48,95,78,41,3,110,122,0];O();var W=function(b=64){return Math.round(2e3*Math.log10(b/64))/100},qt=function(b,e,r){let d=[],c=r==!1?e.readIntVLV():r;b==0||b==127;for(let p=0;p<c;p++){let h=e.readInt(1);if(d.push(h),h!=247){if(h!=240){if(h>127)return console.debug(`Early termination: ${d}`),d.pop(),e.backOne(),e.backOne(),new Uint8Array(d)}}}return new Uint8Array(d)},wt=function(b){let e=0;return b.forEach(r=>{e+=r,e=e&127}),~e+1&127},oe=function(b,e){let r=0,d=0;for(let c=0;c<b.length;c++){let p=c%8-1,h=(d>>p&1)<<7,m=b[c];m+=h,c%8!=0?(e(m,r,b),r++):d=b[c]}},st=function(b){let e=Math.floor(b*14.2);return e<128?e:0};var he=["?","gm","gs","xg","g2","mt32","ns5r","x5d","05rw","sd","k11","sg","krs","s90es","motif"],jt=[[0,0,0,0,121,0,0,82,81,97,0,0,63,63,63],[0,0,4,0,0,127,0,0,0,0,0,0,0,0,0]],Oe=[120,127,120,127,120,127,61,62,62,105,120,122,122,127],ka=[0,3,81,84,88],Qt={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},kt={0:0,1:1,2:3,5:4},Wt=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],Yt=[36,37,48,49,52,53],ut=[20,21,22,23,24,25,26,28,29,30,31,36,37,48,49,52,53,64,65],Zt={26:127,29:0,30:0,31:0,52:12,53:54},it=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,128,12,13,16,17,18,19],Sa=[12,13,16,17,18,19],xa=[33,99,100,32,102,8,9,10],Jt=[0,16,25,40,32,64,26,48],x={};he.forEach((b,e)=>{x[b]=e});var v={length:it.length};it.forEach((b,e)=>{v[b]=e});var ee={length:ut.length};ut.forEach((b,e)=>{ee[b]=e});var I=function(){return!!self.Bun||self.debugMode||!1},Ca=function(b){let e=[],r=0;return b==null||b.forEach(function(d,c){d==247?e.push(b.subarray(r,c)):d==240&&(r=c+1)}),e.length||e.push(b.subarray(0)),I()&&console.debug(e),e};var $={ch:128,cc:it.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,ace:8,drm:8,dpn:ut.length,dnc:128,efx:7},D,z,le,pe,J,ue,ta,be,X,R,y,ge,P,N,te,H,F,$e,de,De,T,qe,q,fe,we,ie,je,ke,Y,Qe,Se,ae,U,Ae,We,Ye,xe,Ce,Ze,ne,L,nt,St,Z,ye,Te,V,Pe,G,ct,ht,Ie,Ue,re,se,ve,Le,Be,Ne,ea,fr=(ea=class extends dt{constructor(){super();S(this,J);M(this,"NOTE_IDLE",0);M(this,"NOTE_ATTACK",1);M(this,"NOTE_DECAY",2);M(this,"NOTE_SUSTAIN",3);M(this,"NOTE_HELD",4);M(this,"NOTE_RELEASE",5);M(this,"NOTE_SOSTENUTO_ATTACK",8);M(this,"NOTE_SOSTENUTO_DECAY",9);M(this,"NOTE_SOSTENUTO_SUSTAIN",10);M(this,"NOTE_SOSTENUTO_HELD",11);M(this,"CH_MELODIC",0);M(this,"CH_DRUMS",1);M(this,"CH_DRUM1",2);M(this,"CH_DRUM2",3);M(this,"CH_DRUM3",4);M(this,"CH_DRUM4",5);M(this,"CH_DRUM5",6);M(this,"CH_DRUM6",7);M(this,"CH_DRUM7",8);M(this,"CH_DRUM8",9);S(this,D,0);S(this,z,0);S(this,le,0);S(this,pe,new Array(11));S(this,be,new Uint8Array($.ch));S(this,X,new Uint8Array($.ch));S(this,R,new Uint8Array($.ch));S(this,y,new Uint8Array($.ch*$.cc));S(this,ge,new Uint8Array($.ace));S(this,P,new Uint8Array($.ch));S(this,N,new Uint8Array($.ch*$.nn));S(this,te,new Uint8Array($.ch));S(this,H,new Uint16Array($.pl));S(this,F,new Uint8Array($.pl));S(this,$e,new Int16Array($.ch));S(this,de,new Uint8Array($.ch));S(this,De,0);S(this,T,new Uint8Array($.ch*$.rpn));S(this,qe,new Int8Array($.ch*Yt.length));S(this,q,new Uint8Array($.drm*$.dpn*$.dnc));S(this,fe,new Uint8Array($.ch));S(this,we,new Uint8Array(128));S(this,ie,new Uint8Array($.cmt*8));S(this,je,new Uint8Array(1024));S(this,ke,new Uint8Array($.cmt*64));S(this,Y,new Uint8Array($.efx*3));S(this,Qe,new Uint8Array($.ch));S(this,Se,0);S(this,ae,0);S(this,U,100);S(this,Ae,0);S(this,We,500);S(this,Ye,0);S(this,xe,"");S(this,Ce,0);S(this,Ze,0);S(this,ne,!0);S(this,L,!1);S(this,nt,void 0);S(this,St,new Uint8Array(2));S(this,Z,[]);S(this,ye,new Uint8Array($.ch));S(this,Te,new Uint8Array($.tr));M(this,"baseBank",new yt("gm","gm2","xg","gs","ns5r","sd","gmega","plg-150vl","plg-150pf","plg-150dx","plg-150an","plg-150dr","plg-100sg","kross","s90es"));M(this,"userBank",new yt("gm"));M(this,"initOnReset",!1);M(this,"aiEfxName","");S(this,V,[]);S(this,Pe,void 0);S(this,G,{nOff:(e,r)=>{let d=e*128+r,c=t(this,H).lastIndexOf(d);c>-1&&(t(this,y)[$.cc*e+v[64]]>63?(t(this,F)[c]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:r,velo:t(this,N)[d],state:this.NOTE_HELD})):t(this,y)[$.cc*e+v[66]]>63&&t(this,F)[c]==this.NOTE_SOSTENUTO_SUSTAIN?(t(this,F)[c]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:r,velo:t(this,N)[d],state:this.NOTE_SOSTENUTO_HELD})):(t(this,H)[c]=0,t(this,N)[d]=0,t(this,F)[c]=this.NOTE_IDLE,this.dispatchEvent("note",{part:e,note:r,velo:0,state:this.NOTE_IDLE})))},nOn:(e,r,d)=>{let c=e*128+r,p=0;for(t(this,te)[e]&&t(this,G).ano(e);t(this,F)[p]>0&&t(this,H)[p]!=c;)p++;p<$.pl?(t(this,H)[p]=c,t(this,N)[c]=d,t(this,F)[p]=this.NOTE_SUSTAIN,t(this,de)[e]<d&&(t(this,de)[e]=d),this.dispatchEvent("note",{part:e,note:r,velo:d,state:this.NOTE_SUSTAIN})):console.error("Polyphony exceeded.")},nAt:(e,r,d)=>{},cAt:(e,r)=>{},hoOf:e=>{t(this,F).forEach((r,d)=>{if(r==this.NOTE_HELD){let c=t(this,H)[d],p=c>>7;e==p&&(t(this,F)[d]=this.NOTE_IDLE,t(this,H)[d]=0,t(this,N)[c]=0,this.dispatchEvent("note",{part:e,note:c&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{t(this,F).forEach((r,d)=>{let c;switch(r){case this.NOTE_ATTACK:{c=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{c=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{c=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(c){t(this,F)[d]=c;let p=t(this,H)[d];this.dispatchEvent("note",{part:e,note:p&127,velo:t(this,N)[p],state:c})}})},soOf:e=>{t(this,F).forEach((r,d)=>{if(r==this.NOTE_SOSTENUTO_HELD){let c=t(this,H)[d],p=c>>7;e==p&&(t(this,F)[d]=this.NOTE_IDLE,t(this,H)[d]=0,t(this,N)[c]=0,this.dispatchEvent("note",{part:e,note:c&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{t(this,H).forEach((r,d,c)=>{let p=r>>7,h=r&127;r==0&&t(this,N)[0]==0||p==e&&t(this,G).nOff(p,h)})}});S(this,ct,{8:function(e){let r=e.channel,d=e.data[0];t(this,G).nOff(r,d)},9:function(e){let r=e.channel;this.setChActive(r,1);let d=e.data[0],c=e.data[1];c>0?t(this,G).nOn(r,d,c):t(this,G).nOff(r,d)},10:function(e){let r=e.channel,d=r*128+e.data[0];t(this,H).indexOf(d)>-1&&(t(this,N)[d]=data[1],this.dispatchEvent("note",{part:r,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let r=e.channel;[0,32].indexOf(e.data[0])>-1&&(()=>{switch(t(this,D)){case x.s90es:case x.motif:{if(e.data[0]==0){[0,63].indexOf(e.data[1])>-1&&this.setChActive(r,1);break}e.data[1]&&this.setChActive(r,1);break}default:{this.setChActive(r,1);break}}})();let d=r*$.cc;switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{t(this,G).ano(r),t(this,$e)[r]=0;let c=r*$.cc;t(this,y)[c+v[1]]=0,t(this,y)[c+v[5]]=0,t(this,y)[c+v[64]]=0,t(this,y)[c+v[65]]=0,t(this,y)[c+v[66]]=0,t(this,y)[c+v[67]]=0,t(this,y)[c+v[11]]=127,t(this,y)[c+v[101]]=127,t(this,y)[c+v[100]]=127,t(this,y)[c+v[99]]=127,t(this,y)[c+v[98]]=127;return}case 123:{t(this,G).ano(r);return}case 124:{t(this,G).ano(r);return}case 125:{t(this,G).ano(r);return}case 126:{t(this,te)[r]=1,t(this,G).ano(r);return}case 127:{t(this,te)[r]=0,t(this,G).ano(r);return}}if(v[e.data[0]]==null)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(Sa.indexOf(e.data[0])>-1&&this.allocateAce(e.data[0]),e.data[0]){case 0:{switch(I()&&console.debug(`${he[t(this,D)]}, CH${r+1}: ${e.data[1]}`),t(this,D)==0?e.data[1]<48?(t(this,R)[r]>0&&(e.data[1]=t(this,y)[d],e.data[1]=120,console.debug(`Forced channel ${r+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]==62?this.switchMode("x5d"):e.data[1]==63?this.switchMode("krs"):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg"):t(this,D)==x.gs?e.data[1]<56&&t(this,R)[r]>0&&(e.data[1]=t(this,y)[d],e.data[1]=120,console.debug(`Forced channel ${r+1} to stay drums.`)):t(this,D)==x.gm?e.data[1]<48?t(this,R)[r]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${r+1} to stay drums.`)):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg",!0):t(this,D)==x.x5d&&e.data[1]>0&&e.data[1]<8&&this.switchMode("05rw",!0),t(this,D)){case x.xg:{[126,127].indexOf(e.data[1])>-1?t(this,R)[r]==0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):t(this,R)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case x["05rw"]:case x.x5d:case x.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?t(this,R)[r]==0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):t(this,R)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case x.sd:{[104,105,106,107].indexOf(e.data[1])>-1?t(this,R)[r]==0&&(this.setChType(r,this.CH_DRUM2),console.debug(`CH${r+1} set to drums by MSB.`)):t(this,R)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}case x.g2:{e.data[1]==120?t(this,R)[r]==0&&(this.setChType(r,this.CH_DRUMS),console.debug(`CH${r+1} set to drums by MSB.`)):t(this,R)[r]>0&&(this.setChType(r,this.CH_MELODIC),console.debug(`CH${r+1} set to melodic by MSB.`));break}}this.dispatchEvent("voice",{part:r});break}case 6:{if(t(this,De)){[x.xg,x.gs,x.ns5r].indexOf(t(this,D))<0&&console.warn(`NRPN commits are not available under "${he[t(this,D)]}" mode, even when they are supported in Octavia.`);let c=t(this,y)[d+v[99]],p=t(this,y)[d+v[98]];if(c==1){let h=xa.indexOf(p);if(h>-1)t(this,y)[d+v[71+h]]=e.data[1],I()&&console.debug(`Redirected NRPN 1 ${p} to cc${71+h}.`),this.dispatchEvent("cc",{part:r,cc:71+h,data:e.data[1]});else{let m=Yt.indexOf(p);m>-1?t(this,qe)[r*10+m]=e.data[1]-64:console.warn(`NRPN 0x01${p.toString(16).padStart(2,"0")} is not supported.`),I()&&console.debug(`CH${r+1} voice NRPN ${p} commit`)}}else{if(ut.indexOf(c)<0){let m=`NRPN 0x${c.toString(16).padStart(2,"0")}${p.toString(16).padStart(2,"0")} `;c==127?console.warn(`${m}is not necessary. Consider removing it.`):console.warn(`${m}is not supported.`)}else{let m=t(this,R)[r]-2;m<0?console.warn(`CH${r+1} cannot accept drum NRPN as type ${rt[t(this,R)[r]]}.`):t(this,q)[(m*$.dpn+ee[c])*$.dnc+p]=e.data[1]}I()&&console.debug(`CH${r+1} (${rt[t(this,R)[r]]}) drum NRPN ${c} commit`)}}else{let c=kt[t(this,y)[d+v[100]]];t(this,y)[d+v[101]]==0&&c!=null&&(I()&&console.debug(`CH${r+1} RPN 0 ${t(this,y)[d+v[100]]} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],Wt[c][0]),Wt[c][1]),t(this,T)[r*$.rpn+c]=e.data[1])}break}case 32:{switch(I()&&console.debug(`${he[t(this,D)]}, CH${r+1} LSB: ${e.data[1]}`),t(this,D)){case x.s90es:case x.motif:{this.setChType(r,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,t(this,D),!0);break}}this.dispatchEvent("voice",{part:r});break}case 38:{t(this,De)||t(this,y)[d+101]==0&&kt[t(this,y)[d+100]]!=null&&(t(this,T)[r*$.rpn+kt[t(this,y)[d+100]]+1]=e.data[1]);break}case 64:{e.data[1]<64&&t(this,G).hoOf(r);break}case 66:{e.data[1]>>6?t(this,G).soOn(r):t(this,G).soOf(r);break}case 98:case 99:{w(this,De,1);break}case 100:case 101:{w(this,De,0);break}}t(this,y)[d+v[e.data[0]]]=e.data[1],this.dispatchEvent("cc",{part:r,cc:e.data[0],data:e.data[1]})}},12:function(e){let r=e.channel;switch(t(this,D)){case x.s90es:case x.motif:{e.data&&this.setChActive(r,1);break}default:this.setChActive(r,1)}t(this,P)[r]=e.data,t(this,fe)[r]=0,I()&&console.debug(`T:${e.track} C:${r} P:${e.data}`),this.dispatchEvent("voice",{part:r})},13:function(e){let r=this,d=e.channel;t(this,H).forEach(function(c){let p=c>>7;d==p&&(t(r,N)[c]=e.data,r.dispatchEvent("note",{part:d,note:c&127,velo:e.data,state:r.NOTE_SUSTAIN}))})},14:function(e){let r=e.channel;t(this,$e)[r]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:r,pitch:this.getPitchShift(r)})},15:function(e){Ca(e.data).forEach(r=>{let d=r[0],c=r[1];(t(this,ht)[d]||function(){console.debug(`Unknown manufacturer ${d}.`)})(c,r.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(t(this,V)[e.meta]||function(d,c,p){}).call(this,e.data,e.track,e.meta),e.meta!=32&&w(this,Ae,0);let r=ka.indexOf(e.meta)>-1;if(I()&&console.debug(e),r)return e.reply="meta",e}});S(this,ht,{64:(e,r,d)=>{t(this,Le).run(r,d,e)},65:(e,r,d)=>{if(r[0]<16)if(r[1]==72){let c=r[r.length-1],p=wt(r.subarray(3,r.length-1));c==p?t(this,se).run(r.subarray(0,r.length-1),d,e):console.warn(`Bad SD checksum ${c}. Should be ${p}.`)}else t(this,se).run(r,d,e);else{let c=r[r.length-1],p=wt(r.subarray(2,r.length-1));c==p?t(this,se).run(r.subarray(0,r.length-1),d,e):console.warn(`Bad GS checksum ${c}. Should be ${p}.`)}},66:(e,r,d)=>{t(this,ve).run(r,d,e)},67:(e,r,d)=>{t(this,re).run(r,d,e)},68:(e,r,d)=>{t(this,Ne).run(r,d,e)},71:(e,r,d)=>{t(this,Be).run(r,d,e)},126:(e,r,d)=>{t(this,Ie).run(r,d,e)},127:(e,r,d)=>{this.switchMode("gm"),t(this,Ue).run(r,d,e)}});S(this,Ie,void 0);S(this,Ue,void 0);S(this,re,void 0);S(this,se,void 0);S(this,ve,void 0);S(this,Le,void 0);S(this,Be,void 0);S(this,Ne,void 0);let e=this;w(this,J,new Uint8Array(256),ta),t(this,pe)[10]=new Uint8Array(512),w(this,Pe,new ce),this.userBank.strictMode=!0,this.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),this.addEventListener("metacommit",function(a){var l,i;let{data:n}=a;((l=t(e,Z)[0])==null?void 0:l.type)==n.type&&((i=t(e,Z)[0])!=null&&i.amend)?(t(e,Z)[0].amend=n.amend,t(e,Z)[0].data+=n.data):t(e,Z).unshift(n)}),t(this,V)[1]=function(a){var n,l,i,s,o;switch(a=a.replaceAll(`\r
`,`
`).replaceAll("\r",`
`),a.slice(0,2)){case"@I":{w(this,L,!0),this.dispatchEvent("metacommit",{type:"Kar.Info",data:(n=a.slice(2))==null?void 0:n.trimLeft()});break}case"@K":{w(this,L,!0),this.dispatchEvent("metacommit",{type:"Kar.Mode",data:(l=a.slice(2))==null?void 0:l.trimLeft()}),console.debug(`Karaoke mode active: ${a.slice(2)}`);break}case"@L":{w(this,L,!0),this.dispatchEvent("metacommit",{type:"Kar.Lang",data:(i=a.slice(2))==null?void 0:i.trimLeft()});break}case"@T":{w(this,L,!0),this.dispatchEvent("metacommit",{type:"KarTitle",data:(s=a.slice(2))==null?void 0:s.trimLeft()});break}case"@V":{w(this,L,!0),this.dispatchEvent("metacommit",{type:"Kar.Ver.",data:(o=a.slice(2))==null?void 0:o.trimLeft()});break}case"XF":{let f=a.slice(2).split(":");switch(f[0]){case"hd":{f.slice(1).forEach((u,g)=>{u.length&&this.dispatchEvent("metacommit",{type:["XfSngDte","XfSngRgn","XfSngCat","XfSongBt","XfSngIns","XfSngVoc","XfSngCmp","XfSngLrc","XfSngArr","XfSngPer","XfSngPrg","XfSngTag"][g],data:u})});break}case"ln":{f.slice(1).forEach((u,g)=>{u.length&&this.dispatchEvent("metacommit",{type:["XfKarLng","XfKarNme","XfKarCmp","XfKarLrc","XfKarArr","XfKarPer","XfKarPrg"][g],data:u})});break}default:this.dispatchEvent("metacommit",{type:"XfUnData",data:a})}break}default:t(this,L)?a[0]=="\\"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:a.slice(1),amend:!0})):a[0]=="/"?(this.dispatchEvent("metacommit",{type:"KarLyric",data:"",mask:!0,amend:!1}),this.dispatchEvent("metacommit",{type:"KarLyric",data:a.slice(1),mask:!0,amend:!0})):this.dispatchEvent("metacommit",{type:"KarLyric",data:a,amend:!0}):a.split(`
`).forEach((f,u)=>{this.dispatchEvent("metacommit",{type:"Cmn.Text",data:f,mask:u!=0})})}},t(this,V)[2]=function(a){this.dispatchEvent("metacommit",{type:"Copyrite",data:a})},t(this,V)[3]=function(a,n){n<1&&t(this,Ae)<1&&this.dispatchEvent("metacommit",{type:"TrkTitle",data:a})},t(this,V)[4]=function(a,n){this.dispatchEvent("metacommit",{type:"Instrmnt",data:a})},t(this,V)[5]=function(a){a.trim()==""?this.dispatchEvent("metacommit",{type:"C.Lyrics",data:"",amend:!1}):this.dispatchEvent("metacommit",{type:"C.Lyrics",data:a,amend:!0})},t(this,V)[6]=function(a){this.dispatchEvent("metacommit",{type:"C.Marker",data:a})},t(this,V)[7]=function(a){this.dispatchEvent("metacommit",{type:"CuePoint",data:a})},t(this,V)[32]=function(a){w(this,Ae,a[0]+1)},t(this,V)[33]=function(a,n){t(e,Te)[n]=a+1},t(this,V)[81]=function(a,n){w(e,We,a/1e3)},t(this,V)[127]=function(a,n){t(e,Pe).run(a,n)},t(this,Pe).default=function(a){console.warn(`Unrecognized sequencer-specific byte sequence: ${a}`)},t(this,Pe).add([67,0,1],function(a,n){t(e,Te)[n]=a[0]+1}),w(this,Ie,new ce("universal non-realtime")),w(this,Ue,new ce("universal realtime")),w(this,re,new ce("Yamaha")),w(this,se,new ce("Roland")),w(this,ve,new ce("Korg")),w(this,Le,new ce("Kawai")),w(this,Be,new ce("Akai")),w(this,Ne,new ce("Casio"));let r=function(a){console.info(`Unrecognized SysEx in "${this.name}" set.
%o`,a)};t(this,Ie).default=r,t(this,Ue).default=r,t(this,re).default=r,t(this,se).default=r,t(this,ve).default=r,t(this,Le).default=r,t(this,Be).default=r,t(this,Ne).default=r,t(this,Ie).add([9],a=>{e.switchMode(["gm","?","g2"][a[0]-1],!0),w(e,L,t(e,L)||!1),console.info(`MIDI reset: ${["GM","Init","GM2"][a[0]-1]}`),a[0]==2&&e.init()}),t(this,Ue).add([4,1],a=>{w(e,U,((a[1]<<7)+a[0])/16383*100),e.dispatchEvent("mastervolume",t(e,U))}).add([4,3],a=>((a[1]<<7)+a[0]-8192)/8192).add([4,4],a=>a[1]-64),t(this,re).add([76,0,0],a=>{switch(a[0]){case 125:{e.initDrums(),console.info(`XG drum setup reset: ${a}`);break}case 126:{e.switchMode("xg",!0),w(e,L,!1),console.info("MIDI reset: XG");break}default:{let n=[0,0,0,0],l=(i,s)=>{n[s]=i};if(a.subarray(1).forEach((i,s)=>{let o=s+a[0];([l,l,l,l,f=>{w(this,U,f*129/16383*100),e.dispatchEvent("mastervolume",t(e,U))},f=>{},f=>{}][o]||(()=>{}))(i,s)}),a[0]<4){let i=0;n.forEach(s=>{i=i<<4,i+=s}),i-=1024}}}}).add([76,2,1],a=>{let n="XG ";a[0]<32?(n+="reverb ",a.subarray(1).forEach((l,i)=>{([s=>{e.setEffectTypeRaw(0,!1,s),console.info(`${n}main type: ${at[s]}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},s=>{e.setEffectTypeRaw(0,!0,s),console.debug(`${n}sub type: ${s+1}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},s=>{console.debug(`${n}time: ${Ht(s)}s`)},s=>{console.debug(`${n}diffusion: ${s}`)},s=>{console.debug(`${n}initial delay: ${s}`)},s=>{console.debug(`${n}HPF cutoff: ${ze[s]}Hz`)},s=>{console.debug(`${n}LPF cutoff: ${ze[s]}Hz`)},s=>{console.debug(`${n}width: ${s}`)},s=>{console.debug(`${n}height: ${s}`)},s=>{console.debug(`${n}depth: ${s}`)},s=>{console.debug(`${n}wall type: ${s}`)},s=>{console.debug(`${n}dry/wet: ${s}`)},s=>{console.debug(`${n}send: ${W(s)}dB`)},s=>{console.debug(`${n}pan: ${s-64}`)},!1,!1,s=>{console.debug(`${n}delay: ${s}`)},s=>{console.debug(`${n}density: ${s}`)},s=>{console.debug(`${n}balance: ${s}`)},s=>{},s=>{console.debug(`${n}feedback: ${s}`)},s=>{}][a[0]+i]||function(){console.warn(`Unknown XG reverb address: ${a[0]}.`)})(l)})):a[0]<64?(n+="chorus ",a.subarray(1).forEach((l,i)=>{([s=>{e.setEffectTypeRaw(1,!1,s),console.info(`${n}main type: ${at[s]}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},s=>{e.setEffectTypeRaw(1,!0,s),console.debug(`${n}sub type: ${s+1}`),e.dispatchEvent("efxchorus",e.getEffectType(1))},s=>{console.debug(`${n}LFO: ${Nt[s]}Hz`)},s=>{},s=>{console.debug(`${n}feedback: ${s}`)},s=>{console.debug(`${n}delay offset: ${Gt(s)}ms`)},s=>{},s=>{console.debug(`${n}low: ${ze[s]}Hz`)},s=>{console.debug(`${n}low: ${s-64}dB`)},s=>{console.debug(`${n}high: ${ze[s]}Hz`)},s=>{console.debug(`${n}high: ${s-64}dB`)},s=>{console.debug(`${n}dry/wet: ${s}`)},s=>{console.debug(`${n}send: ${W(s)}dB`)},s=>{console.debug(`${n}pan: ${s-64}`)},s=>{console.debug(`${n}to reverb: ${W(s)}dB`)},!1,s=>{},s=>{},s=>{},s=>{console.debug(`${n}LFO phase diff: ${(s-64)*3}deg`)},s=>{console.debug(`${n}input mode: ${s?"stereo":"mono"}`)},s=>{}][a[0]-32+i]||function(){console.warn(`Unknown XG chorus address: ${a[0]}.`)})(l)})):a[0]<86?(n+="variation ",a.subarray(1).forEach((l,i)=>{([s=>{e.setEffectTypeRaw(2,!1,s),console.info(`${n}main type: ${at[s]}`),e.dispatchEvent("efxdelay",e.getEffectType(2))},s=>{e.setEffectTypeRaw(2,!0,s),console.debug(`${n}sub type: ${s+1}`),e.dispatchEvent("efxdelay",e.getEffectType(2))}][a[0]-64+i]||function(){})(l)})):a[0]<97?(n+="variation ",a.subarray(1).forEach((l,i)=>{[s=>{console.debug(`${n}send: ${W(s)}dB`)},s=>{console.debug(`${n}pan: ${s-64}`)},s=>{console.debug(`${n}to reverb: ${W(s)}dB`)},s=>{console.debug(`${n}to chorus: ${W(s)}dB`)},s=>{console.debug(`${n}connection: ${s?"system":"insertion"}`)},s=>{console.debug(`${n}channel: CH${s+1}`)},s=>{console.debug(`${n}mod wheel: ${s-64}`)},s=>{console.debug(`${n}bend wheel: ${s-64}`)},s=>{console.debug(`${n}channel after touch: ${s-64}`)},s=>{console.debug(`${n}AC1: ${s-64}`)},s=>{console.debug(`${n}AC2: ${s-64}`)}][a[0]-86+i](l)})):a[0]>111&&a[0]<118?n+="variation ":console.warn(`Unknown XG variation address: ${a[0]}`)}).add([76,2,64],a=>{a.subarray(1).forEach((n,l)=>{let i=l+a[0];if(i==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][n]}`);else{let s=i-1>>2,o=i-1&3,f=`XG EQ ${s} ${["gain","freq","Q","shape"][o]}: `;[()=>{console.debug(`${f}${n-64}dB`)},()=>{console.debug(`${f}${n} (raw)`)},()=>{console.debug(`${f}${n/10}`)},()=>{console.debug(`${f}${["shelf","peak"][+!!n]}`)}][o]()}})}).add([76,3],a=>{let n=a[0],l=a[1],i=`XG Insertion ${a[0]+1} `;a.subarray(2).forEach((s,o)=>{([f=>{e.setEffectTypeRaw(3+n,!1,f),console.info(`${i}main type: ${at[f]}`),e.dispatchEvent(`efxinsert${n}`,e.getEffectType(3+n))},f=>{e.setEffectTypeRaw(3+n,!0,f),console.debug(`${i}sub type: ${f+1}`),e.dispatchEvent(`efxinsert${n}`,e.getEffectType(3+n))}][l+o]||function(){})(s)})}).add([76,6,0],a=>{let n=a[0];n<64?e.setLetterDisplay(a.subarray(1),"XG letter display",n):w(e,Ce,Date.now())}).add([76,7,0],a=>{let n=a[0];w(e,z,0),w(e,le,Date.now()+3200),t(e,J,ue).fill(0);let l=a.subarray(1);for(let i=0;i<n;i++)l.unshift(0);l.forEach(function(i,s){let o=Math.floor(s/16),f=s%16,u=(f*3+o)*7,g=7,E=0;for(u-=f*5,o==2&&(g=2);E<g;)t(e,J,ue)[u+E]=i>>6-E&1,E++})}).add([76,8],(a,n)=>{let l=e.chRedir(a[0],n,!0),i=a[1],s=$.cc*l,o=`XG CH${l+1} `,f=`Unknown XG part address ${i}.`;a.subarray(2).forEach((u,g)=>{i<1?console.debug(f):i<41?([()=>{t(e,y)[s+v[0]]=u,e.dispatchEvent("voice",{part:l})},()=>{t(e,y)[s+v[32]]=u,e.dispatchEvent("voice",{part:l})},()=>{t(e,P)[l]=u,e.dispatchEvent("voice",{part:l})},()=>{let E=e.chRedir(u,n,!0);t(e,X)[l]=E,l!=E&&(e.buildRchTree(),console.info(`${o}receives from CH${E+1}`))},()=>{t(e,te)[l]=+!u},()=>{},()=>{e.setChType(l,u,x.xg),console.debug(`${o}type: ${rt[u]||u}`)},()=>{t(e,T)[$.rpn*l+3]=u},!1,!1,()=>{t(e,y)[s+v[7]]=u},!1,!1,()=>{t(e,y)[s+v[10]]=u||128},!1,!1,()=>{t(e,y)[s+v[128]]=u},()=>{t(e,y)[s+v[93]]=u},()=>{t(e,y)[s+v[91]]=u},()=>{t(e,y)[s+v[94]]=u},()=>{t(e,y)[s+v[76]]=u},()=>{t(e,y)[s+v[77]]=u},()=>{t(e,y)[s+v[78]]=u},()=>{t(e,y)[s+v[74]]=u},()=>{t(e,y)[s+v[71]]=u},()=>{t(e,y)[s+v[73]]=u},()=>{t(e,y)[s+v[75]]=u},()=>{t(e,y)[s+v[72]]=u}][i+g-1]||(()=>{}))():i<48?console.debug(f):i<111?i>102&&i<105&&(t(e,y)[s+v[[5,65][i&1]]]=u):i<114?console.debug(f):i<116?console.debug(`${o}EQ ${["bass","treble"][i&1]} gain: ${u-64}dB`):i<118?console.debug(f):i<120?console.debug(`${o}EQ ${["bass","treble"][i&1]} freq: ${u}`):console.debug(f)})}).add([76,9],(a,n)=>{let l=e.chRedir(a[0],n,!0),i=a[1],s=`PLG-150VL CH${l+1} `;a.subarray(2).forEach((o,f)=>{let u=f+i;switch(u){case 1:{console.info(`${s}breath mode: ${["system","breath","velocity","touch EG"][o]}`);break}case 0:case 27:case 28:break;default:if(u<27){let g=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][u-3>>1];u&1?u<23?(console.debug(`${s}${g} control source: ${Ft(o)}`),o&&o<96&&e.allocateAce(o)):console.debug(`${s}${g} scale break point: ${o}`):console.debug(`${s}${g} depth: ${o-64}`)}}})}).add([76,10],a=>{}).add([76,16],a=>{}).add([76,17,0,0],a=>{}).add([76,112],a=>{console.debug(`XG enable PLG-1${["50VL","00SG","50DX"][a[0]]} for CH${a[2]+1}.`)}).add([73,0,0],(a,n)=>{let l=a[0],i="MU1000 System: ";a.subarray(1).forEach((s,o)=>{let f=l+o;f==8?console.debug(`${i}LCD contrast set to ${s}.`):f==18?(w(e,ae,s?126:0),console.debug(`${i}bank defaults to ${s?"MU100 Native":"MU Basic"}.`)):f>=64&&f<69&&[()=>{e.dispatchEvent("channelactive",s)},()=>{s<8?(e.dispatchEvent("channelmin",s<<4),console.debug(`Octavia System: Minimum CH${(s<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{s<8?(e.dispatchEvent("channelmax",(s<<4)+15),console.debug(`Octavia System: Maximum CH${(s<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{w(e,ne,!!s),console.info(`Octavia System: RS receiving ${["dis","en"][s]}abled.`)}][f-64]()})}).add([73,10,0],(a,n)=>{let l=a[0],i=`MU1000 RS${t(e,ne)?"":" (ignored)"}: `;if(l<16)switch(l){case 2:{let s=e.chRedir(0,n,!0);t(e,ne)&&(e.dispatchEvent("channelmin",s),e.dispatchEvent("channelmax",s+63)),console.info(`${i}Show CH1~64`);break}case 3:{let s=e.chRedir(a[1]<<5,n,!0);t(e,ne)&&e.dispatchEvent("channelmin",s),t(e,ne)&&e.dispatchEvent("channelmax",s+31),console.info(`${i}Show CH${s+1}~CH${s+32}`);break}default:console.debug(`${i}unknown switch ${l} invoked.`)}else if(l<32){if(t(e,ne)){let s=e.chRedir(l-16+(t(e,Ze)<<4),n,!0);e.dispatchEvent("channelactive",s)}}else if(l<36){let s=e.chRedir(l-32<<4,n,!0);t(e,ne)&&(e.dispatchEvent("channelmin",s),e.dispatchEvent("channelmax",s+15),w(e,Ze,l-32)),console.info(`${i}Show CH${s+1}~CH${s+16}`)}}).add([93,3],(a,n)=>{let l=e.chRedir(a[0],n,!0),i=`PLG-100SG CH${l+1} `,s=Date.now();if(a[1]==0){let o="",f=0;a.subarray(2).forEach((u,g)=>{g%2==0?o+=_t[u]||u.toString().padStart("0"):f+=u*13}),s>=t(e,Ye)&&this.dispatchEvent("metacommit",{type:"SGLyrics",data:"",amend:!1}),this.dispatchEvent("metacommit",{type:"SGLyrics",data:`${Xt(o)}`,amend:!0}),w(e,Ye,s+Math.ceil(f/2)+t(e,We)),I()&&console.debug(`${i}vocals: ${o}`)}else console.warn(`Unknown PLG-100SG data: ${a}`)});let d=function(a,n,l,i){},c=function(a,n){let l=a*$.dpn,i=n[0],s=n[1];n.subarray(2).forEach((o,f)=>{let u=f+s,g=-1;u<16?([()=>{g=24},()=>{g=25},()=>{g=26},()=>{},()=>{g=28},()=>{g=29},()=>{g=30},()=>{g=31},()=>{},()=>{},()=>{},()=>{g=20},()=>{g=21},()=>{g=22},()=>{g=23},()=>{}][u]||(()=>{console.debug(`Unknown XG-style drum param ${u} on set ${a+1}.`)}))():u<32||(u<40?([()=>{g=48},()=>{g=49},!1,!1,()=>{g=52},()=>{g=53}][u-32]||(()=>{console.debug(`Unknown XG-style drum param ${u} on set ${a+1}.`)}))():u<80||([()=>{g=36}][u-80]||(()=>{console.debug(`Unknown XG-style drum param ${u} on set ${a+1}.`)}))()),g>=0?(I()&&console.debug(l,g,i,o),t(e,q)[(l+ee[g])*$.dnc+i]=o):I()&&console.debug(`XG-style drum param ${u} has no writes.`)})},p=function(a,n,l){let i=a*$.dpn,s=(n<<7)+l[0];l.subarray(1).forEach((o,f)=>{let u=f+s,g=u&127,E=u>>7,k=-1;E>1&&([()=>{k=26},()=>{},()=>{k=28},()=>{k=29},()=>{k=30},()=>{},()=>{},()=>{k=31}][E-2]||(()=>{console.debug(`Unknown GS-style drum param ${E} on set ${a+1}.`)}))(),k>-1?(I()&&console.debug(i,k,g,o),t(e,q)[(i+ee[k])*$.dnc+g]=o):I()&&console.debug(`GS-style drum param ${E} has no writes.`)})};t(this,re).add([76,48],(a,n,l)=>{c(0,a)}).add([76,49],(a,n,l)=>{c(1,a)}).add([76,50],(a,n,l)=>{c(2,a)}).add([76,51],(a,n,l)=>{c(3,a)}).add([76,52],(a,n,l)=>{c(4,a)}).add([76,53],(a,n,l)=>{c(5,a)}).add([76,54],(a,n,l)=>{c(6,a)}).add([76,55],(a,n,l)=>{c(7,a)}),t(this,re).add([89,0],(a,n,l)=>{if(e.eprom){let i=a[0],s=(a[1]<<14)+(a[2]<<7)+a[3]+(e.eprom.offset||0);I()&&console.debug(`MU1000 EPROM trail to 0x${s.toString(16).padStart(6,"0")}, ${i} bytes.`);let o=e.eprom.data;a.subarray(4).forEach((f,u)=>{let g=u>>3,E=u&7;if(E==7)for(let k=0;k<7;k++)o[s+7*g+k]+=(f>>6-k&1)<<7;else o[s+7*g+E]=f})}}).add([89,1],(a,n,l)=>{let i=(a[0]<<21)+(a[1]<<14)+(a[2]<<7)+a[3];I()&&console.debug(`MU1000 EPROM jump to 0x${i.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=i)}).add([89,2],(a,n,l)=>{if(e.eprom){let i=(a[0]<<21)+(a[1]<<14)+(a[2]<<7)+a[3]+(e.eprom.offset||0);I()&&console.debug(`MU1000 EPROM write to 0x${i.toString(16).padStart(6,"0")}.`);let s=e.eprom.data;a.subarray(4).forEach((o,f)=>{let u=f>>3,g=f&7;if(g==7)for(let E=0;E<7;E++)s[i+7*u+E]+=(o>>6-E&1)<<7;else s[i+7*u+g]=o})}}).add([89,3],(a,n,l)=>{}),t(this,re).add([39,48],(a,n,l)=>{}).add([43,0,0],(a,n,l)=>{let i=[0,0,0,0],s=(o,f)=>{i[f]=o};if(a.subarray(1).forEach((o,f)=>{let u=f+a[0];[s,s,s,s,()=>{w(this,U,o*129/16383*100),e.dispatchEvent("mastervolume",t(e,U))},()=>o-64,()=>o||128,()=>o,()=>o,()=>{console.debug(`TG300 variation on cc${o}.`)}][u](o,u)}),a[0]<4){let o=0;i.forEach(f=>{o=o<<4,o+=f}),o-=1024}}).add([43,1,0],(a,n,l)=>{}).add([43,2],(a,n,l)=>{let i=e.chRedir(a[0],n,!0),s=a[1],o=$.cc*i,f=`TG300 CH${i+1} `;a.subarray(2).forEach((u,g)=>{g<5?([()=>{},()=>{t(e,y)[o+v[0]]=u,e.dispatchEvent("voice",{part:i})},()=>{t(e,y)[o+v[32]]=u,e.dispatchEvent("voice",{part:i})},()=>{t(e,P)[i]=u,e.dispatchEvent("voice",{part:i})},()=>{let E=e.chRedir(u,n,!0);t(e,X)[i]=E,i!=E&&(e.buildRchTree(),console.info(`${f}receives from CH${E+1}`))}][g+s]||(()=>{}))(u,g+s):g<21||(g<47?([()=>{t(e,te)[i]=+!u},()=>{},()=>{},()=>{t(e,T)[$.rpn*i+3]=u},()=>{},()=>{t(e,y)[o+v[7]]=u},!1,!1,()=>{t(e,y)[o+v[10]]=u||128},!1,!1,()=>{console.debug(`${f} AC1 at cc${u}`)},()=>{console.debug(`${f} AC2 at cc${u}`)},()=>{t(e,y)[o+v[128]]=u},()=>{t(e,y)[o+v[93]]=u},()=>{t(e,y)[o+v[91]]=u},()=>{t(e,y)[o+v[94]]=u},()=>{t(e,y)[o+v[76]]=u},()=>{t(e,y)[o+v[77]]=u},()=>{t(e,y)[o+v[74]]=u},()=>{t(e,y)[o+v[71]]=u},()=>{t(e,y)[o+v[73]]=u},()=>{t(e,y)[o+v[75]]=u},()=>{t(e,y)[o+v[72]]=u},()=>{t(e,y)[o+v[78]]=u}][g+s-21]||(()=>{}))(u,g+s):g<95||([()=>{t(e,y)[o+v[65]]=u},()=>{t(e,y)[o+v[5]]=u}][g+s-95]||(()=>{}))(u,g+s))})}).add([43,7,0],(a,n,l)=>{let i=a[0];e.setLetterDisplay(a.subarray(1),"TG300 letter display",i)}).add([43,7,1],(a,n,l)=>{w(e,z,0),w(e,le,Date.now()+3200),t(e,J,ue).fill(0),a.forEach(function(i,s){let o=Math.floor(s/16),f=s%16,u=(f*3+o)*7,g=7,E=0;for(u-=f*5,o==2&&(g=2);E<g;)t(e,J,ue)[u+E]=i>>6-E&1,E++})}),t(this,se).add([66,18,0,0,127],(a,n,l)=>{e.switchMode("gs",!0),t(e,y)[$.cc*9]=120,t(e,y)[$.cc*25]=120,t(e,y)[$.cc*41]=120,t(e,y)[$.cc*57]=120,w(e,ae,3),w(e,L,!1),t(e,ye).fill(0),console.info(`GS system to ${["single","dual"][a[0]]} mode.`)}).add([66,18,64,0],(a,n,l)=>{switch(a[0]){case 127:{e.switchMode("gs",!0),t(e,y)[$.cc*9]=120,t(e,y)[$.cc*25]=120,t(e,y)[$.cc*41]=120,t(e,y)[$.cc*57]=120,w(e,L,!1),t(e,ye).fill(0),console.info("MIDI reset: GS");break}default:{let i=[0,0,0,0],s=(o,f)=>{i[f]=o};if(a.subarray(1).forEach((o,f)=>{let u=f+a[0];[s,s,s,s,g=>{w(this,U,g*129/16383*100),e.dispatchEvent("mastervolume",t(e,U))},g=>{},g=>{}][u](o,f)}),a[0]<4){let o=0;i.forEach(f=>{o=o<<4,o+=f}),o-=1024}}}}).add([66,18,64,1],a=>{let n=a[0];if(n<16){let l="".padStart(n," ");a.subarray(1).forEach((i,s)=>{l+=String.fromCharCode(Math.max(32,i))}),l=l.padEnd(16," "),console.debug(`GS patch name: ${l}`)}else n<48||(n<65?a.subarray(1).forEach((l,i)=>{let s=`GS ${n+i>55?"chorus":"reverb"} `;([()=>{console.info(`${s}type: ${mt[l]}`),e.setEffectType(0,40,l),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${s}predelay: ${l}ms`)},()=>{console.info(`${s}type: ${Vt[l]}`),e.setEffectType(1,40,16+l),e.dispatchEvent("efxchorus",e.getEffectType(1))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${s}to reverb: ${W(l)}`)},()=>{console.debug(`${s}to delay: ${W(l)}`)}][n+i-48]||(()=>{}))()}):n<80?console.debug(`Unknown GS patch address: ${n}`):n<91?a.subarray(1).forEach((l,i)=>{let s="GS delay ";([()=>{console.info(`${s}type: ${Kt[l]}`),e.setEffectType(2,40,32+l),e.dispatchEvent("efxdelay",e.getEffectType(2))},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${s}to reverb: ${W(l)}`)}][n+i-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${n}`))}).add([66,18,64,2],a=>{let n="GS EQ ";a.subarray(1).forEach((l,i)=>{([()=>{console.debug(`${n}low freq: ${[200,400][l]}Hz`)},()=>{console.debug(`${n}low gain: ${l-64}dB`)},()=>{console.debug(`${n}high freq: ${[3e3,6e3][l]}Hz`)},()=>{console.debug(`${n}high gain: ${l-64}dB`)}][a[0]+i]||function(){console.warn(`Unknown GS EQ address: ${a[0]+i}`)})()})}).add([66,18,64,3],a=>{let n="GS EFX ",l=function(i,s){let o=zt(t(e,Y).subarray(10,12),s,i);o&&console.debug(`${n}${Et(t(e,Y).subarray(10,12))} ${o}`)};a.subarray(1).forEach((i,s)=>{([()=>{e.setEffectTypeRaw(3,!1,32+i),e.dispatchEvent("efxinsert0",e.getEffectType(3))},()=>{e.setEffectTypeRaw(3,!0,i),console.info(`${n}type: ${Et(t(e,Y).subarray(10,12))}`),e.dispatchEvent("efxinsert0",e.getEffectType(3))},!1,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,()=>{console.debug(`${n}to reverb: ${W(i)}dB`)},()=>{console.debug(`${n}to chorus: ${W(i)}dB`)},()=>{console.debug(`${n}to delay: ${W(i)}dB`)},!1,()=>{console.debug(`${n}1 source: ${i}`),i&&i<96&&e.allocateAce(i)},()=>{console.debug(`${n}1 depth: ${i-64}`)},()=>{console.debug(`${n}2 source: ${i}`),i&&i<96&&e.allocateAce(i)},()=>{console.debug(`${n}2 depth: ${i-64}`)},()=>{console.debug(`${n}to EQ: ${i?"ON":"OFF"}`)}][a[0]+s]||function(o,f){console.warn(`Unknown GS EFX address: ${f}`)})(i,a[0]+s)})}).add([66,18,65],a=>{p((a[0]>>4)+1<<1,a[0]&15,a.subarray(1))}).add([69,18,16],a=>{var n;switch(a[0]){case 0:{let l=a[1];e.setLetterDisplay(a.subarray(2),"GS display text",l);break}case 32:{w(e,le,Date.now()+3200),a[1]==0&&(w(e,z,Math.max(Math.min(a[2]-1,9),0)),I()&&console.debug(`GS switch display page ${a[2]-1}.`));break}default:if(a[0]<6){t(e,z)>9&&w(e,z,0);let l=a[0]-1<<1|a[1]>>6;t(e,z)==l&&w(e,le,Date.now()+3200),(n=t(e,pe)[l])!=null&&n.length||(t(e,pe)[l]=new Uint8Array(256));let i=t(e,pe)[l];I()&&console.debug(`GS frame draw page ${l}.`);let s=a[1]&63;i.fill(0),a.subarray(2).forEach(function(f,u){let g=u+s,E=Math.floor(g/16),k=g%16,C=(k*4+E)*5,A=5,_=0;for(C-=k*4,E==3&&(A=1);_<A;)i[C+_]=f>>4-_&1,_++})}else console.warn(`Unknown GS display section: ${a[0]}`)}});let h=function(a,n,l){let i=a[0],s=$.cc*n,o=$.rpn*n,f=`GS CH${n+1} `;i<3?(a.subarray(1).forEach((u,g)=>{[()=>{t(e,y)[s+v[0]]=u},()=>{t(e,P)[n]=u},()=>{let E=e.chRedir(u,l,!0);t(e,X)[n]=E,n!=E&&(e.buildRchTree(),console.info(`${f}receives from CH${E+1}`))}][i+g]()}),e.dispatchEvent("voice",{part:n})):i<19||(i<44?a.subarray(1).forEach((u,g)=>{([()=>{t(e,te)[n]=+!u},!1,()=>{e.setChType(n,u<<1,x.gs),console.debug(`${f}type: ${u?"drum ":"melodic"}${u||""}`)},()=>{t(e,T)[o+3]=u},!1,()=>{t(e,y)[s+v[7]]=u},!1,!1,()=>{t(e,y)[s+v[10]]=u||128},!1,!1,()=>{console.debug(`${f}CC 1: cc${u}`)},()=>{console.debug(`${f}CC 2: cc${u}`)},()=>{t(e,y)[s+v[93]]=u},()=>{t(e,y)[s+v[91]]=u},!1,!1,()=>{t(e,T)[o+1]=u},()=>{t(e,T)[o+2]=u},()=>{t(e,y)[s+v[94]]=u}][i+g-19]||(()=>{}))()}):i<76||console.debug(`Unknown GS part address: ${i}`))},m=function(a,n){let l=a[0],i=`GS CH${n+1} `;l<2?a.subarray(1).forEach((s,o)=>{[()=>{t(e,y)[$.cc*n+v[32]]=s},()=>{}][l+o]()}):l<32?console.warn(`Unknown GS misc address: ${l}`):l<35?a.subarray(1).forEach((s,o)=>{[()=>{console.debug(`${i}EQ: o${["ff","n"][s]}`)},()=>{},()=>{console.debug(`${i}EFX: o${["ff","n"][s]}`),t(e,Qe)[n]=s,e.dispatchEvent("partefxtoggle",{part:n,active:s})}][l+o-32]()}):console.warn(`Unknown GS misc address: ${l}`)};t(this,se).add([66,18,64,16],(a,n)=>{h(a,e.chRedir(9,n,!0),n)}).add([66,18,64,17],(a,n)=>{h(a,e.chRedir(0,n,!0),n)}).add([66,18,64,18],(a,n)=>{h(a,e.chRedir(1,n,!0),n)}).add([66,18,64,19],(a,n)=>{h(a,e.chRedir(2,n,!0),n)}).add([66,18,64,20],(a,n)=>{h(a,e.chRedir(3,n,!0),n)}).add([66,18,64,21],(a,n)=>{h(a,e.chRedir(4,n,!0),n)}).add([66,18,64,22],(a,n)=>{h(a,e.chRedir(5,n,!0),n)}).add([66,18,64,23],(a,n)=>{h(a,e.chRedir(6,n,!0),n)}).add([66,18,64,24],(a,n)=>{h(a,e.chRedir(7,n,!0),n)}).add([66,18,64,25],(a,n)=>{h(a,e.chRedir(8,n,!0),n)}).add([66,18,64,26],(a,n)=>{h(a,e.chRedir(10,n,!0),n)}).add([66,18,64,27],(a,n)=>{h(a,e.chRedir(11,n,!0),n)}).add([66,18,64,28],(a,n)=>{h(a,e.chRedir(12,n,!0),n)}).add([66,18,64,29],(a,n)=>{h(a,e.chRedir(13,n,!0),n)}).add([66,18,64,30],(a,n)=>{h(a,e.chRedir(14,n,!0),n)}).add([66,18,64,31],(a,n)=>{h(a,e.chRedir(15,n,!0),n)}).add([66,18,64,64],(a,n)=>{m(a,e.chRedir(9,n,!0))}).add([66,18,64,65],(a,n)=>{m(a,e.chRedir(0,n,!0))}).add([66,18,64,66],(a,n)=>{m(a,e.chRedir(1,n,!0))}).add([66,18,64,67],(a,n)=>{m(a,e.chRedir(2,n,!0))}).add([66,18,64,68],(a,n)=>{m(a,e.chRedir(3,n,!0))}).add([66,18,64,69],(a,n)=>{m(a,e.chRedir(4,n,!0))}).add([66,18,64,70],(a,n)=>{m(a,e.chRedir(5,n,!0))}).add([66,18,64,71],(a,n)=>{m(a,e.chRedir(6,n,!0))}).add([66,18,64,72],(a,n)=>{m(a,e.chRedir(7,n,!0))}).add([66,18,64,73],(a,n)=>{m(a,e.chRedir(8,n,!0))}).add([66,18,64,74],(a,n)=>{m(a,e.chRedir(10,n,!0))}).add([66,18,64,75],(a,n)=>{m(a,e.chRedir(11,n,!0))}).add([66,18,64,76],(a,n)=>{m(a,e.chRedir(12,n,!0))}).add([66,18,64,77],(a,n)=>{m(a,e.chRedir(13,n,!0))}).add([66,18,64,78],(a,n)=>{m(a,e.chRedir(14,n,!0))}).add([66,18,64,79],(a,n)=>{m(a,e.chRedir(15,n,!0))}),t(this,ve).add([54,65],(a,n)=>{e.switchMode("x5d");let l=(a[1]<<7)+a[0],i=(a[3]<<7)+a[2],s=e.chRedir(l&15,n,!0),o=$.cc*s;[()=>{i<1||(i<101?(e.setChType(s,e.CH_MELODIC,x.x5d),t(e,P)[s]=i-1,t(e,y)[o+v[0]]=82):i<229?(e.setChType(s,e.CH_MELODIC,x.x5d),t(e,P)[s]=i-101,t(e,y)[o+v[0]]=56):(e.setChType(s,e.CH_DRUMS,x.x5d),t(e,P)[s]=Jt[i-229]||0,t(e,y)[o+v[0]]=62)),e.dispatchEvent("voice",{part:s})},()=>{t(e,y)[o+v[7]]=i},()=>{i<31&&(t(e,y)[o+v[10]]=Math.round((i-15)*4.2+64))},()=>{t(e,y)[o+v[93]]=st(i)},()=>{t(e,y)[o+v[91]]=st(i)},()=>{t(e,T)[s*$.rpn+3]=i>8191?i-16320:64+i},()=>{t(e,T)[s*$.rpn+1]=i>8191?i-16320:64+i},()=>{i>0&&(t(e,T)[s*$.rpn]=i)},()=>{}][l>>4]()}).add([54,76,0],(a,n)=>{e.switchMode("x5d",!0);let l="",i=82,s=0,o=0,f="MSB	PRG	LSB	NME";oe(a,function(u,g){if(g<16400){let E=g%164;switch(!0){case E<10:{u>31&&(l+=String.fromCharCode(u));break}case E==11:{f+=`
${i}	${s}	${o}	${l.trim().replace("Init Voice","")}`,s++,l="";break}}s>99&&(i=90,s=0)}}),e.userBank.clearRange({msb:82,prg:[0,99],lsb:0}),e.userBank.load(f),I()&&console.debug(f),e.forceVoiceRefresh()}).add([54,77,0],(a,n)=>{e.switchMode("x5d",!0);let l="",i=90,s=0,o=0,f="MSB	PRG	LSB	NME";oe(a,function(u,g){if(g<13600){let E=g%136;switch(!0){case E<10:{u>31&&(l+=String.fromCharCode(u));break}case E==11:{f+=`
${i}	${s}	${o}	${l.trim().replace("Init Combi","")}`,s++,l="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(f),I()&&console.debug(f),e.forceVoiceRefresh()}).add([54,78],(a,n)=>{e.switchMode("x5d",!0),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][a[0]]} mode.`)}).add([54,85],(a,n)=>{e.switchMode("x5d",!0),oe(a,(l,i)=>{i>0&&i<3&&(e.setEffectType(i-1,44,l),e.dispatchEvent(`efx${["reverb","chorus"][i-1]}`,e.getEffectType(i-1)))})}).add([54,104],(a,n)=>{e.switchMode("x5d",!0),oe(a,function(l,i,s,o){if(i<192){let f=e.chRedir(Math.floor(i/12),n,!0),u=f*$.cc;switch(i%12){case 0:{l<128?(e.setChType(f,e.CH_MELODIC,x.x5d),t(e,y)[u+v[0]]=82,t(e,P)[f]=l):(e.setChType(f,e.CH_DRUMS,x.x5d),t(e,y)[u+v[0]]=62,t(e,P)[f]=Jt[l-128]),l>0&&e.setChActive(f,1),e.dispatchEvent("voice",{part:f});break}case 1:{t(e,y)[u+v[7]]=l;break}case 2:{t(e,T)[f*$.rpn+3]=l>127?l-192:64+l;break}case 3:{t(e,T)[f*$.rpn+1]=l>127?l-192:64+l;break}case 4:{l<31&&(t(e,y)[u+v[10]]=Math.round((l-15)*4.2+64));break}case 5:{let g=l>>4,E=l&15;t(e,y)[u+v[91]]=st(E),t(e,y)[u+v[93]]=st(g);break}case 10:break;case 11:{let g=e.chRedir(l&15,n,!0),E=l>>4;t(e,X)[f]=l,(g!=f||E)&&(console.info(`X5D Part CH${f+1} receives from CH${g+1}.`),e.buildRchTree())}}}else{let f=e.chRedir(i-192,n,!0)}})}),t(this,se).add([22,18,127],a=>{e.switchMode("mt32",!0),w(e,L,!1),e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(a,n,l)=>{e.switchMode("mt32");let i=e.chRedir(l,n,!0),s=a[1];a.subarray(2).forEach((o,f)=>{let u=f+s;t(e,we)[u+(i-1)*16]=o,([!1,()=>{let g=t(e,we)[i-1<<4];if(g<3){if(t(e,fe)[i]=1,g==2)for(let E=0;E<name.length;E++)t(e,ie)[(i-1)*$.cmt+E]=t(e,ke)[o*$.cmt+E];else{let E=e.baseBank.get(0,o+(g<<6),127,"mt32").name;for(let k=0;k<E.length;k++)t(e,ie)[(i-1)*$.cmt+k]=E.charCodeAt(k)}e.dispatchEvent("voice",{part:i})}},()=>{t(e,T)[i*$.rpn+3]=o+40},()=>{t(e,T)[i*$.rpn+1]=o+14},()=>{t(e,T)[i*$.rpn]=o},!1,()=>{t(e,y)[$.cc*i+v[91]]=o?127:0},!1,()=>{t(e,y)[$.cc*i+v[7]]=o},()=>{t(e,y)[$.cc*i+v[10]]=Math.ceil(o*9.05)}][u]||(()=>{}))()})}).add([22,18,1],(a,n,l)=>{e.switchMode("mt32");let i=l&7;console.debug(`MT-32 slot #${l+1} Drum: ${a}`);let s=a[0]<<7|a[1];a.subarray(2).forEach((o,f)=>{let u=f+s,g=(u>>2)+24,E=u&3,k=i*$.dpn;if(I()&&console.debug(`MT-32 temp drum note ${g} param ${E}: ${o}`),g<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${g}`);return}[()=>{},()=>{t(e,q)[(k+ee[26])*$.dnc+g]=Math.round(o*1.27)},()=>{t(e,q)[(k+ee[26])*$.dnc+g]=o*9+1&127},()=>{t(e,q)[(k+ee[26])*$.dnc+g]=o?127:0}][E]()})}).add([22,18,2],(a,n,l)=>{e.switchMode("mt32");let i=e.chRedir(l,n,!0),s=a[1]+(a[0]<<7);s<10&&(t(e,fe)[i]=1),a.subarray(2).forEach((o,f)=>{let u=f+s;u<14&&(t(e,ie)[(i-1)*$.cmt+u]=o)}),e.dispatchEvent("voice",{part:i})}).add([22,18,3],(a,n,l)=>{e.switchMode("mt32");let i=l&7;if(a[0]){let s=(a[0]-1<<7)+a[1]-16;a.subarray(2).forEach((o,f)=>{let u=f+s,g=(u>>2)+24,E=u&3,k=i*$.dpn;if(I()&&console.debug(`MT-32 dev drum note ${g} param ${E}: ${o}`),g<24){console.warn(`MT-32 dev drum write attempted on an OOB note: ${g}`);return}[()=>{},()=>{t(e,q)[(k+ee[26])*$.dnc+g]=Math.round(o*1.27)},()=>{t(e,q)[(k+ee[26])*$.dnc+g]=o*9+1&127},()=>{t(e,q)[(k+ee[26])*$.dnc+g]=o?127:0}][E]()})}else{let s=a[1];a.subarray(2).forEach((o,f)=>{let u=f+s;t(e,we)[u]=o;let g=e.chRedir(1+(u>>4),n,!0),E=u&15;([!1,()=>{let k=t(e,we)[g-1<<4];if(k<3)if(t(e,fe)[g]=1,k==2)for(let C=0;C<name.length;C++)t(e,ie)[(g-1)*$.cmt+C]=t(e,ke)[o*$.cmt+C];else{let C=e.baseBank.get(0,o+(k<<6),127,"mt32").name;for(let A=0;A<C.length;A++)t(e,ie)[(g-1)*$.cmt+A]=C.charCodeAt(A)}e.dispatchEvent("voice",{part:g})},()=>{t(e,T)[g*$.rpn+3]=o+40},()=>{t(e,T)[g*$.rpn+1]=o+14},()=>{t(e,T)[g*$.rpn]=o},!1,()=>{t(e,y)[$.cc*g+v[91]]=o?127:0},!1,()=>{t(e,y)[$.cc*g+v[7]]=o},()=>{t(e,y)[$.cc*g+v[10]]=Math.ceil(o*9.05)}][E]||(()=>{}))()})}}).add([22,18,4],(a,n,l)=>{e.switchMode("mt32");let i=a[1]+(a[0]<<7),s=[];a.subarray(2).forEach((o,f)=>{let u=f+i,g=e.chRedir(Math.floor(u/246+1),n,!0),E=u%246;E<14&&(t(e,ie)[(g-1)*$.cmt+E]=o),E<10&&(t(e,fe)[g]=1),s.indexOf(g)<0&&s.push(g)}),s.forEach(o=>{e.dispatchEvent("voice",{part:o})})}).add([22,18,5],(a,n,l)=>{e.switchMode("mt32");let i=(a[0]<<7)+a[1];a.subarray(2).forEach((s,o)=>{let f=i+o,u=Math.floor(f/8),g=f&7,E=u*8;t(e,je)[f]=s,([!1,()=>{let k=t(e,je)[E];if(k<3){let C="";if(k==2){let A=$.cmt*u;C=`MT-m:${s.toString().padStart(3,"0")}`}else C=e.baseBank.get(0,s+(k<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:u}),e.userBank.load(`MSB	LSB	PRG	NME
000	127	${u}	${C}`,!0)}}][g]||(()=>{}))()}),e.forceVoiceRefresh()}).add([22,18,8],(a,n,l)=>{e.switchMode("mt32");let i=((a[0]&1)<<7)+a[1];a.subarray(2).forEach((s,o)=>{let f=i+o;f<$.cmt&&(t(e,ke)[(a[0]>>1)*$.cmt+f]=s)}),e.forceVoiceRefresh()}).add([22,18,16],(a,n,l)=>{e.switchMode("mt32");let i=a[1],s=!1,o=function(f,u){t(e,X)[u-12]=f,s=!0};a.subarray(2).forEach((f,u)=>{let g=u+i;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,o,o,o,o,o,o,o,o,o,()=>{w(e,U,f),e.dispatchEvent("mastervolume",t(e,U))}][g]||(()=>{}))(f,u)}),s&&e.buildRchTree()}).add([22,18,32],a=>{e.switchMode("mt32");let n=a[1],l=" ".repeat(n);a.subarray(2).forEach(i=>{i>31?l+=String.fromCharCode(i):l+=" "}),w(e,xe,l.padStart(20," ")),w(e,Ce,Date.now()+3200)}).add([22,18,82],(a,n)=>{let l=e.chRedir(0,n,!0);for(let i=0;i<16;i++)t(e,G).ano(l+i),i&&i<10&&(t(e,P)[l+i]=$t[i-1]);console.info("MT-32 alt reset complete.")}),t(this,ve).add([66,0],(a,n)=>{e.switchMode("ns5r",!0),w(e,L,!1),console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][a[0]]} mode.`)}).add([66,1],(a,n)=>{e.switchMode(["ns5r","05rw"][a[0]],!0),w(e,L,!1)}).add([66,18,0,0],(a,n)=>{let l=a[0];switch(l){case 124:case 126:case 127:{e.switchMode("ns5r",!0),w(e,L,!1);break}case 125:{e.initDrums(),console.info(`NS5R drum setup reset: ${a}`);break}default:if(l<10){let i=[0,0,0,0],s=(o,f)=>{i[f]=o};if(a.subarray(1).forEach((o,f)=>{[s,s,s,s,()=>{w(e,U,o*129/16383*100),e.dispatchEvent("mastervolume",t(e,U))},()=>o-64,()=>o-64,()=>{},()=>{},()=>{}][l+f]()}),a[0]<4){let o=0;i.forEach(f=>{o=o<<4,o+=f}),o-=1024}}}}).add([66,18,0,1],(a,n)=>{}).add([66,18,0,2],(a,n)=>{}).add([66,18,1],(a,n)=>{let l=e.chRedir(a[0],n,!0),i=l*$.cc,s=a[1],o=`NS5R CH${l+1} `;a.subarray(2).forEach((f,u)=>{let g=s+u;g<3?([()=>{t(e,y)[i+v[0]]=f||121},()=>{t(e,y)[i+v[32]]=f},()=>{t(e,P)[l]=f}][g](),e.dispatchEvent("voice",{part:l})):g<8||(g<14?[()=>{let E=e.chRedir(f,n,!0);t(e,X)[l]=E,l!=E&&(e.buildRchTree(),console.info(`${o}receives from CH${E+1}`))},()=>{t(e,te)[l]=+!f},()=>{e.setChType(l,f,x.ns5r),console.debug(`${o}type: ${rt[f]}`)},()=>{t(e,T)[$.rpn*l+3]=f},()=>{},()=>{}][g-8]():g<16||(g<33?[()=>{t(e,y)[i+v[7]]=f},()=>{t(e,y)[i+v[11]]=f},()=>{},()=>{},()=>{t(e,y)[i+v[10]]=f||128},()=>{},()=>{},()=>{t(e,y)[i+v[93]]=f},()=>{t(e,y)[i+v[91]]=f},()=>{t(e,y)[i+v[76]]=f},()=>{t(e,y)[i+v[77]]=f},()=>{t(e,y)[i+v[78]]=f},()=>{t(e,y)[i+v[74]]=f},()=>{t(e,y)[i+v[71]]=f},()=>{t(e,y)[i+v[73]]=f},()=>{t(e,y)[i+v[75]]=f},()=>{t(e,y)[i+v[72]]=f}][g-16]():g<112||g<114&&[()=>{t(e,y)[i+v[5]]=f},()=>{t(e,y)[i+v[65]]=f}][g-112]()))})}).add([66,18,8,0],(a,n)=>{let l=a[0];if(l<32)e.setLetterDisplay(a.subarray(1,33),"NS5R letter display");else{let i=l-32;w(e,le,Date.now()+3200),w(e,z,10),t(e,J,ue).fill(0);let s=a.subarray(1),o=4;s.forEach(function(f,u){let g=u+i,E=g>>4,k=g&15;if(g<80){let C=E<o?f:f>>3,A=0,_=E<o?6:3;for(;C>0;)t(e,J,ue)[k*32+E*7+(_-A)]=C&1,C=C>>1,A++}})}}).add([66,18,48],(a,n,l)=>{c(0,a)}).add([66,18,49],(a,n,l)=>{c(1,a)}).add([66,18,50],(a,n,l)=>{c(2,a)}).add([66,18,51],(a,n,l)=>{c(3,a)}).add([66,18,52],(a,n,l)=>{c(4,a)}).add([66,18,53],(a,n,l)=>{c(5,a)}).add([66,18,54],(a,n,l)=>{c(6,a)}).add([66,18,55],(a,n,l)=>{c(7,a)}).add([66,52],(a,n)=>{e.switchMode("ns5r",!0),w(e,L,!1);let l="";oe(a,(i,s)=>{s<8?(i>31&&(l+=String.fromCharCode(i)),s==7&&(e.aiEfxName=l)):s<10&&(e.setEffectType(s-8,44,i),e.dispatchEvent(`efx${["reverb","chorus"][s-8]}`,e.getEffectType(s-8)))})}).add([66,53],(a,n)=>{e.switchMode("ns5r",!0),w(e,L,!1),oe(a,function(l,i){switch(!0){case i<2944:{let s=e.chRedir(Math.floor(i/92),n,!0),o=s*$.cc;switch(i%92){case 0:{t(e,y)[o+v[0]]=l||121,e.dispatchEvent("voice",{part:s});break}case 1:{t(e,y)[o+v[32]]=l,e.dispatchEvent("voice",{part:s});break}case 2:{t(e,P)[s]=l,l>0&&e.setChActive(s,1),e.dispatchEvent("voice",{part:s});break}case 3:{let f=e.chRedir(l,n,!0);t(e,X)[s]=f,s!=f&&(console.info(`NS5R CH${s+1} receives from CH${f+1}.`),e.buildRchTree())}case 7:break;case 8:{t(e,T)[s*$.rpn+3]=l<40||l>88?l+(l>63?-192:64):l;break}case 9:case 10:{t(e,y)[o+v[7]]=l;break}case 11:{t(e,y)[o+v[11]]=l;break}case 14:{t(e,y)[o+v[10]]=l||128;break}case 19:{t(e,y)[o+v[93]]=l;break}case 20:{t(e,y)[o+v[91]]=l;break}case 84:{t(e,y)[o+v[65]]=l;break}case 85:{t(e,y)[o+v[5]]=l;break}}break}case i<3096:break;case i<3134:break;case i<8566:break}})}).add([66,54],(a,n)=>{e.switchMode("ns5r",!0);let l="",i=80,s=0,o=0,f="MSB	PRG	LSB	NME";oe(a,function(u,g){let E=g%158;switch(!0){case E<10:{u>31&&(l+=String.fromCharCode(u));break}case E==11:{i=u&127;break}case E==12:{o=u&127;break}case E==13:{f+=`
${i}	${s}	${o}	${l.trim().replace("Init Voice","")}`,s++,l="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(f),I()&&console.debug(f),e.forceVoiceRefresh()}).add([66,55],(a,n)=>{e.switchMode("ns5r",!0);let l="",i=88,s=0,o=0,f="MSB	PRG	LSB	NME";oe(a,function(u,g){let E=g%126;switch(!0){case E<10:{u>31&&(l+=String.fromCharCode(u));break}case E==11:break;case E==12:break;case E==13:{f+=`
${i}	${s}	${o}	${l.trim().replace("Init Combi","")}`,s++,l="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(f),I()&&console.debug(f),e.forceVoiceRefresh()}).add([66,125],a=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][a[0]]||"white")}).add([66,127],a=>{let n=new Uint8Array(5760);oe(a,(l,i,s)=>{if(i<720)for(let o=0;o<8;o++)n[i*8+o]=l>>7-o&1}),e.dispatchEvent("screen",{type:"ns5r",data:n})}).add([76],(a,n,l)=>{t(e,ve).run([66,...a],n,l)}),t(this,Le).add([16,0,8,0],(a,n,l)=>{let i=(a[2]<<4)+a[3],s="K11 ";([()=>{e.switchMode("k11",!0),w(e,L,!1),w(e,ae,i?4:0),console.info("MIDI reset: GMega/K11")},()=>{e.setEffectType(0,24,i),console.debug(`${s}reverb type: ${i}`),e.dispatchEvent("efxreverb",e.getEffectType(0))},()=>{console.debug(`${s}reverb time: ${i}`)},()=>{console.debug(`${s}reverb time: ${i}`)},()=>{console.debug(`${s}reverb predelay: ${i}`)},()=>{console.debug(`${s}reverb predelay: ${i}`)},()=>{console.debug(`${s}depth high: ${i}`)},()=>{console.debug(`${s}depth high: ${i}`)},()=>{console.debug(`${s}depth low: ${i}`)},()=>{console.debug(`${s}depth low: ${i}`)}][a[0]]||(()=>{}))()}).add([16,0,8,1],(a,n,l)=>{let i=e.chRedir(a[1],n,!0),s=$.cc*i,o=$.rpn*i,f=(a[3]<<4)+a[4],u=`K11 CH${i+1} `;([()=>{f<128?(e.setChType(i,e.CH_MELODIC,x.k11),t(e,y)[s+v[0]]=0,t(e,P)[i]=f):(e.setChType(i,e.CH_DRUMS,x.k11),t(e,P)[i]=f-128),e.dispatchEvent("voice",{part:i})},()=>{let g=e.chRedir(f,n,!0);t(e,X)[i]=g,i!=g&&(e.buildRchTree(),console.info(`${u}receives from CH${g+1}`))},()=>{t(e,y)[s+v[7]]=f},()=>{uupThis.setChActive(i,f)},()=>{t(e,y)[s+v[10]]=f},()=>{t(e,T)[o+3]=f+40},()=>{t(e,T)[o+1]=f>>1,t(e,T)[o+2]=f&1},()=>{t(e,y)[s+v[91]]=f?127:0},()=>{},()=>{t(e,y)[s+v[74]]=f},()=>{t(e,y)[s+v[73]]=f},()=>{t(e,y)[s+v[72]]=f}][a[0]]||(()=>{}))()}).add([16,0,9,0],(a,n,l)=>{let i=(a[2]<<4)+a[3],s="GMLX ";([()=>{console.debug(`${s}reverb type: ${i}`)},()=>{console.debug(`${s}reverb time: ${i}`)},()=>{console.debug(`${s}reverb predelay: ${i}`)},()=>{console.debug(`${s}depth high: ${i}`)},()=>{console.debug(`${s}depth low: ${i}`)}][a[0]]||(()=>{}))()}).add([16,0,9,3],(a,n,l)=>{let i=(a[2]<<4)+a[3],s=e.chRedir(a[1],n,!0),o=s*$.cc;[()=>{i<128?(e.setChType(s,e.CH_MELODIC,x.k11),t(e,y)[o+v[0]]=0,t(e,y)[o+v[32]]=0,t(e,P)[s]=i):i<160?(e.setChType(s,e.CH_MELODIC,x.k11),t(e,y)[o+v[0]]=0,t(e,y)[o+v[32]]=7,t(e,P)[s]=i-100):(e.setChType(s,e.CH_DRUMS,x.k11),t(e,y)[o+v[0]]=122,t(e,y)[o+v[32]]=0,t(e,P)[s]=i-160),e.dispatchEvent("voice",{part:s})},()=>{let f=e.chRedir(i,n,!0);t(e,X)[s]=f,s!=f&&(e.buildRchTree(),console.info(`GMLX CH${s+1} receives from CH${f+1}`))}][a[0]]()}).add([16,0,9,4],(a,n,l)=>{let i=(a[2]<<4)+a[3],s=e.chRedir(a[1],n,!0),o=s*$.cc,f=s*$.rpn,u=`GMLX CH${s+1} `;[()=>{e.setChActive(s,i)},()=>{t(e,y)[o+v[7]]=i},()=>{t(e,y)[o+v[10]]=i},()=>{t(e,y)[o+v[91]]=i?127:0},()=>{t(e,T)[f+3]=i+40},()=>{t(e,T)[f+1]=i},()=>{t(e,T)[f]=i},()=>{}][a[0]]()}),t(this,Be).add([66,93,64],(a,n,l)=>{let i=a[2];switch(a[0]){case 0:{switch(a[1]){case 4:{w(e,U,i*129/16383*100),e.dispatchEvent("mastervolume",t(e,U));break}case 5:{i-64;break}case 6:{console.debug(`SG global reverb: ${i?"on":"off"}`);break}case 127:{e.switchMode("sg",!0);break}}break}case 1:{switch(a[1]){case 48:{console.debug(`SG reverb type: ${mt[i]}`);break}}break}default:if(a[0]>>4==1){let s=e.chRedir(a[0]&15,n,!0);if(a[1]==2){let o=e.chRedir(i,n,!0);t(e,X)[s]=o,s!=o&&(e.buildRchTree(),console.info(`SG CH${s+1} receives from CH${o+1}`))}else a[1]==19&&(t(e,y)[$.cc*s+v[7]]=i)}else console.warn(`Unknown AKAI SG SysEx: ${a}`)}}),t(this,Ne).add([9],(a,n,l)=>{console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremelo","phaser","rotary speaker","enhancer","flanger","EQ"][a[0]]||"off"}`)}),t(this,re).add([127,0],(a,n,l)=>{e.switchMode("motif");let i=new Uint8Array([127,1,...a]);t(e,re).run(i,n,l)}).add([127,1,0,0],(a,n,l)=>{e.switchMode("s90es");let i="S90/Motif ES system ",s=a[0];a.subarray(1).forEach((o,f)=>{([()=>{w(e,U,o*12900/16383),e.dispatchEvent("mastervolume",t(e,U))}][s+f]||(()=>{console.info(`Unrecognized ${i}ID: ${s+f}`)}))()})}).add([127,1,0,0,14],(a,n,l)=>{e.switchMode("s90es");let i="S90/Motif ES bulk header ",s=[];s[95]=(o,f,u)=>{console.debug(`${i}multi edit buffer: ${o[1]}`)},(s[a[0]]||(()=>{console.info(`Unrecognized ${i}ID: ${a[0]}.`)}))(a.subarray(1))}).add([127,1,0,0,15],(a,n,l)=>{e.switchMode("s90es");let i="S90/Motif ES bulk footer ",s=[];s[95]=(o,f,u)=>{console.debug(`${i}multi edit buffer: ${o[1]}`)},(s[a[0]]||(()=>{console.info(`Unrecognized ${i}ID: ${a[0]}.`)}))(a.subarray(1))}).add([127,1,0,58,55],(a,n,l)=>{e.switchMode("s90es");let i=e.chRedir(a[0],n,!0),s=$.cc*i,o=a[1],f=`S90/Motif ES bulk CH${i<16?i+1:"U"+(i-95)} `;console.debug(f,a),!(a[0]>15)&&a.subarray(2).forEach((u,g)=>{([()=>{t(e,y)[s+v[0]]=u,e.dispatchEvent("voice",{part:i})},()=>{u&&e.setChActive(i,1),t(e,y)[s+v[32]]=u,e.setChType(i,[32,40].indexOf(u)>-1?e.CH_DRUMS:e.CH_MELODIC,t(e,D),!0),e.dispatchEvent("voice",{part:i})},()=>{u&&e.setChActive(i,1),t(e,P)[i]=u,e.dispatchEvent("voice",{part:i})},()=>{let E=e.chRedir(u,n,!0);t(e,X)[i]=E,i!=E&&(e.buildRchTree(),console.info(`${f}receives from CH${E+1}`))},()=>{t(e,te)[i]=u?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{t(e,y)[s+v[7]]=u},()=>{t(e,y)[s+v[10]]=u},!1,!1,!1,()=>{t(e,y)[s+v[91]]=u},()=>{t(e,y)[s+v[93]]=u},()=>{t(e,y)[s+v[94]]=u},()=>{t(e,y)[s+v[128]]=u},()=>{},()=>{t(e,y)[s+v[74]]=u},()=>{t(e,y)[s+v[71]]=u},!1,()=>{t(e,y)[s+v[65]]=u},()=>{t(e,y)[s+v[5]]=u},()=>{}][o+g]||(()=>{}))()})}).add([127,1,54,16],(a,n,l)=>{e.switchMode("s90es");let i=a[0];a.subarray(1).forEach((s,o)=>{let u=`S90/Motif ES EQ${(o>>2)+1} `;([()=>{let g=s-64},()=>{let g=ze[s]},()=>{let g=s/10},()=>{let g=s}][i+o&3]||(()=>{}))()})}),t(this,se).add([0,72,18,0,0,0,0],(a,n,l)=>{e.switchMode("sd",!0),console.info("MIDI reset: SD")}).add([0,72,18,16,0],(a,n,l)=>{let i=a[0]>>5,s=a[0]&31;switch(i){case 0:{console.debug(`Unknown SD-90 global effects message:
%o`,a);break}case 1:{let o=e.chRedir(s,n,!0),f=a[1],u=o*$.cc;a.subarray(2).forEach((g,E)=>{let k=f+E;k<37?([()=>{},()=>{},0,()=>{},()=>{switch(t(e,y)[u+v[0]]=g,g){case 104:case 105:case 106:case 107:case 120:{t(e,R)[o]||e.setChType(o,e.CH_DRUMS);break}default:t(e,R)[o]&&e.setChType(o,e.CH_MELODIC)}e.dispatchEvent("voice",{part:o})},()=>{t(e,y)[u+v[32]]=g,e.dispatchEvent("voice",{part:o})},()=>{t(e,P)[o]=g,e.dispatchEvent("voice",{part:o})},()=>{t(e,y)[u+v[7]]=g},()=>{t(e,y)[u+v[10]]=g},()=>{},()=>{},()=>{g<2&&(t(e,te)[o]=g)},()=>{g<2&&(t(e,y)[u+v[68]]=g?127:0)},()=>{},()=>{g<2&&(t(e,y)[u+v[65]]=g?127:0)},()=>{t(e,y)[u+v[5]]=g&15<<4|t(e,y)[u+v[5]]&15},()=>{t(e,y)[u+v[5]]=g&15|(t(e,y)[u+v[5]]&240)>>4},()=>{t(e,y)[u+v[74]]=g},()=>{t(e,y)[u+v[71]]=g},()=>{t(e,y)[u+v[73]]=g},()=>{t(e,y)[u+v[72]]=g},0,0,0,0,0,0,0,()=>{t(e,y)[u+v[128]]=g},()=>{t(e,y)[u+v[93]]=g},()=>{t(e,y)[u+v[91]]=g},0,0,()=>{t(e,y)[u+v[75]]=g},()=>{t(e,y)[u+v[76]]=g},()=>{t(e,y)[u+v[77]]=g},()=>{t(e,y)[u+v[78]]=g}][k]||(()=>{}))():k<63||(k<64?t(e,R)[o]?t(e,y)[u+v[0]]=104|g:t(e,y)[u+v[0]]=96|g:console.debug(`Unknown SD-90 global CH${o+1} param setup message:
%o`,a))});break}case 2:{let o=e.chRedir(s,n,!0),f=a[1];console.debug(`Unknown SD-90 global CH${o+1} MIDI setup message:
%o`,a.subarray(2));break}default:console.warn(`Unknown SD-90 global part setup message:
%o`,a)}})}chRedir(e,r,d){if(t(this,Te)[r])return(t(this,Te)[r]-1)*16+e;if([2,3].indexOf(t(this,ae))>-1){if(d==1)return e;let c=0,p=!0;for(;p;)t(this,ye)[e+c]==0?(t(this,ye)[e+c]=r,console.debug(`Assign track ${r} to channel ${e+c+1}.`),p=!1):t(this,ye)[e+c]==r?p=!1:(c+=16,c>=128&&(c=0,p=!1));return e+c}else return e}forceVoiceRefresh(){for(let e=0;e<$.ch;e++)t(this,be)[e]&&this.dispatchEvent("voice",{part:e})}buildRchTree(){let e=[];t(this,X).forEach((r,d)=>{var c;(c=e[r])!=null&&c.constructor||(e[r]=[]),e[r].push(d)}),w(this,nt,e)}getActive(){return t(this,be)}getCc(e){let r=e*$.cc,d=t(this,y).subarray(r,r+$.cc);return d[v[0]]=d[v[0]]||t(this,Se),d[v[32]]=d[v[32]]||t(this,ae),d}getCcCh(e,r){if(it.indexOf(r)<0)throw new Error("CC number not accepted");return t(this,y)[$.cc*e+v[r]]}getCcAll(){let e=t(this,y).slice();for(let r=0;r<$.ch;r++){let d=r*$.cc;e[d+v[0]]=e[d+v[0]]||t(this,Se),e[d+v[32]]=e[d+v[32]]||t(this,ae)}return e}getChSource(){return t(this,X)}getChType(){return t(this,R)}setChType(e,r,d=t(this,D),c=!1){r&=15,t(this,R)[e]=r,r>0&&!c&&(t(this,y)[e*$.cc+v[0]]=Oe[d])}setChActive(e,r=0){t(this,be)[e]!=r&&this.dispatchEvent("channeltoggle",{part:e,active:r}),t(this,be)[e]=r}getPitch(){return t(this,$e)}getProgram(){return t(this,P)}getTexts(){return t(this,Z).slice()}getVel(e){let r=new Map,d=this;return t(d,H).forEach(function(c,p){let h=Math.floor(c/128),m=c%128;e==h&&t(d,N)[c]>0&&r.set(m,{v:t(d,N)[c],s:t(d,F)[p]})}),r}getBitmap(){return{bitmap:t(this,J,ue),expire:t(this,le)}}getLetter(){return{text:t(this,xe),expire:t(this,Ce)}}getMode(){return he[t(this,D)]}getMaster(){return{volume:t(this,U)}}getRawStrength(){let e=this;return t(this,H).forEach(function(r){let d=Math.floor(r/128);t(e,N)[r]>t(e,de)[d]&&(t(e,de)[d]=t(e,N)[r])}),t(this,de)}getStrength(){let e=[],r=this;return this.getRawStrength().forEach(function(d,c){e[c]=Math.floor(d*t(r,y)[c*$.cc+v[7]]*t(r,y)[c*$.cc+v[11]]*t(r,U)/803288)}),e}getRpn(){return t(this,T)}getNrpn(){return t(this,qe)}getVoice(e,r,d,c){let p=e||t(this,Se),h=r,m=d||t(this,ae);he[t(this,D)]=="ns5r"&&p>0&&p<56&&(m=3);let a=this.userBank.get(p,h,m,c);if(he[t(this,D)]=="mt32"&&a.name.indexOf("MT-m:")==0){let n=parseInt(a.name.slice(5)),l=n*$.cmt,i="";t(this,ke).subarray(l,l+10).forEach(s=>{s>31&&(i+=String.fromCharCode(s))}),this.userBank.load(`MSB	LSB	PRG
0	127	${h}	${i}`,!0),a.name=i,a.ending=" "}return(a.ending!=" "||!a.name.length)&&(a=this.baseBank.get(p,h,m,c)),a}getChVoice(e){let r=this.getVoice(t(this,y)[e*$.cc+v[0]],t(this,P)[e],t(this,y)[e*$.cc+v[32]],he[t(this,D)]);if(t(this,fe)[e])switch(t(this,D)){case x.mt32:r.ending="~",r.name="",t(this,ie).subarray(14*(e-1),14*(e-1)+10).forEach(d=>{d>31&&(r.name+=String.fromCharCode(d))})}return r}getPitchShift(e){let r=e*$.rpn;return t(this,$e)[e]/8192*t(this,T)[r]+(t(this,T)[r+3]-64)+((t(this,T)[r+1]<<7)+t(this,T)[r+2]-8192)/8192}getEffectType(e=0){let r=3*e+1;return t(this,Y).subarray(r,r+2)}setEffectTypeRaw(e=0,r,d){let c=3*e;t(this,Y)[c]=1,t(this,Y)[c+1+ +r]=d}setEffectType(e=0,r,d){this.setEffectTypeRaw(e,!1,r),this.setEffectTypeRaw(e,!0,d)}getEffectSink(){return t(this,Qe)}setLetterDisplay(e,r,d=0,c=3200){let p=this,h;w(p,xe," ".repeat(d)),e.forEach(m=>{w(p,xe,t(p,xe)+String.fromCharCode(m>31?m:32)),m<32&&(h=h||new Set,h.add(m))}),w(p,Ce,Date.now()+c),h&&(h=Array.from(h),h.forEach((m,a,n)=>{n[a]=m.toString(16).padStart(2,"0")}),console.warn(`${r}${r?" ":""}invalid code point${h.length>1?"s":""}: 0x${h.join(", 0x")}`))}allocateAce(e){if(!e||e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}let r=!0,d=0;for(;r&&d<$.ace;)t(this,ge)[d]==e?r=!1:t(this,ge)[d]||(r=!1,t(this,ge)[d]=e,console.info(`Allocated cc${e} to ACE slot ${d}.`)),d++;d>=$.ace&&console.warn("ACE slots are full.")}getAce(){return t(this,ge)}getChAce(e,r){if(r<0||r>=$.ace)throw new RangeError("No such ACE slot");let d=t(this,ge)[r];if(d){if(it.indexOf(d)>=0)return t(this,y)[e*$.cc+v[d]];throw new Error(`Invalid ACE source: ${d}`)}else return 0}initDrums(){let e=this;t(e,q).fill(64);for(let r=0;r<$.drm;r++){let d=r*$.dpn;for(let c in Zt){let p=Zt[c],h=(d+ee[c])*$.dnc;t(e,q).subarray(h,h+$.dnc).fill(p)}}}init(e=0){let r=this;w(r,Se,0),w(r,ae,0),w(r,Ae,0),t(r,be).fill(0),t(r,y).fill(0),t(r,ge).fill(0),t(r,P).fill(0),t(r,N).fill(0),t(r,H).fill(0),t(r,de).fill(0),t(r,$e).fill(0),t(r,qe).fill(0),w(r,U,100),w(r,Z,[]),w(r,We,500),w(r,Ye,0),w(r,le,0),w(r,z,0),t(r,J,ue).fill(0),w(r,L,!1),w(r,Ze,0),w(r,ne,!0),r.initDrums(),t(r,X).forEach(function(d,c,p){p[c]=c}),r.buildRchTree(),e==0&&(r.dispatchEvent("mode","?"),w(r,D,0),t(r,ye).fill(0),t(r,Te).fill(0),w(r,Ce,0),w(r,xe,"")),t(r,y)[$.cc*9]=Oe[0],t(r,y)[$.cc*25]=Oe[0],t(r,y)[$.cc*41]=Oe[0],t(r,y)[$.cc*57]=Oe[0],t(r,R).fill(r.CH_MELODIC),t(r,R)[9]=r.CH_DRUM1,t(r,R)[25]=r.CH_DRUM3,t(r,R)[41]=r.CH_DRUMS,t(r,R)[57]=r.CH_DRUMS,t(r,R)[73]=r.CH_DRUM5,t(r,R)[89]=r.CH_DRUM7,t(r,R)[105]=r.CH_DRUMS,t(r,R)[121]=r.CH_DRUMS,t(r,je).fill(0),t(r,ke).fill(0),t(r,we).fill(0),t(r,ie).fill(0),t(r,fe).fill(0),t(r,Y).fill(0),t(r,Qe).fill(0),r.aiEfxName="",r.userBank.clearRange({msb:0,lsb:127,prg:[0,127]});for(let d=0;d<$.ch;d++){let c=d*$.cc;t(r,y)[c+v[7]]=100,t(r,y)[c+v[11]]=127,t(r,y)[c+v[10]]=64,t(r,y)[c+v[71]]=64,t(r,y)[c+v[72]]=64,t(r,y)[c+v[73]]=64,t(r,y)[c+v[74]]=64,t(r,y)[c+v[75]]=64,t(r,y)[c+v[76]]=64,t(r,y)[c+v[77]]=64,t(r,y)[c+v[78]]=64,t(r,y)[c+v[91]]=40,t(r,y)[c+v[101]]=127,t(r,y)[c+v[100]]=127,t(r,y)[c+v[99]]=127,t(r,y)[c+v[98]]=127;let p=d*$.rpn;t(r,T)[p]=2,t(r,T)[p+1]=64,t(r,T)[p+2]=0,t(r,T)[p+3]=64,t(r,T)[p+4]=0,t(r,T)[p+5]=0}r.dispatchEvent("mastervolume",t(r,U)),r.dispatchEvent("efxreverb",r.getEffectType(0)),r.dispatchEvent("efxchorus",r.getEffectType(1)),r.dispatchEvent("efxdelay",r.getEffectType(2)),r.dispatchEvent("efxinsert0",r.getEffectType(3)),r.dispatchEvent("efxinsert1",r.getEffectType(4)),r.dispatchEvent("efxinsert2",r.getEffectType(5)),r.dispatchEvent("efxinsert3",r.getEffectType(6)),r.dispatchEvent("reset"),r.switchMode("?")}switchMode(e,r=!1){let d=this,c=he.indexOf(e);if(c>-1){if(t(d,D)==0||r){let p=t(d,D);d.initOnReset&&r&&this.init(1),w(d,D,c),w(d,z,0),w(d,Se,jt[0][c]),w(d,ae,jt[1][c]);for(let m=0;m<$.ch;m++)t(d,R)[m]>0&&t(d,y)[m*$.cc+v[0]]==Oe[p]&&(t(d,y)[m*$.cc]=Oe[c]);switch(c){case x.mt32:{$t.forEach((m,a)=>{let n=a+1;t(d,be)[n]||(t(d,P)[n]=m,t(d,y)[n*$.cc+v[91]]=127)});for(let m=1;m<10;m++)d.dispatchEvent("voice",{part:m});break}}let h;switch(c){case x["?"]:case x.xg:{h=[1,0,65,0,5,0,0,0];break}case x.gm:case x.gs:case x.g2:case x.sd:{h=[40,4,40,18,40,32,32,0];break}case x["05rw"]:case x.x5d:case x.ns5r:{h=[44,1,44,19,44,0,44,0];break}case x.k11:case x.sg:{h=[24,0,0,0,0,0,0,0];break}case x.mt32:{h=[40,4,0,0,0,0,0,0];break}default:h=[0,0,0,0,0,0,0,0]}for(let m=0;m<4;m++)t(d,Y)[3*m]||(t(d,Y)[3*m+1]=h[2*m],t(d,Y)[3*m+2]=h[2*m+1],d.dispatchEvent(`efx${["reverb","chorus","delay","insert"][m]}`,d.getEffectType(m)));d.dispatchEvent("mode",e),d.forceVoiceRefresh()}}else throw new Error(`Unknown mode ${e}`)}newStrength(){t(this,de).fill(0)}runJson(e){var r;if(e.type>14)return e.type==15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),t(this,ct)[e.type].call(this,e);{let d=this.chRedir(e.part,e.track),c=!1;(r=t(this,nt)[d])==null||r.forEach(p=>{e.channel=p,c=!0,t(this,ct)[e.type].call(this,e)}),c||console.warn(`${Qt[e.type]?Qt[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${d+1} without any recipient.`)}t(this,Z).length>100&&t(this,Z).splice(100,t(this,Z).length-99)}runRaw(e){}async loadBank(e,r){let d=this;switch(e=e.toLowerCase(),e){case"s7e":{d.userBank.clearRange({msb:63,lsb:[21,22]}),d.userBank.clearRange({msb:63,lsb:[24,27]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":{ft.context=this,d.userBank.load(await ft.read(e,r));break}}d.forceVoiceRefresh()}},D=new WeakMap,z=new WeakMap,le=new WeakMap,pe=new WeakMap,J=new WeakSet,ue=function(){return t(this,pe)[t(this,z)]},ta=function(e){t(this,pe)[t(this,z)]=e},be=new WeakMap,X=new WeakMap,R=new WeakMap,y=new WeakMap,ge=new WeakMap,P=new WeakMap,N=new WeakMap,te=new WeakMap,H=new WeakMap,F=new WeakMap,$e=new WeakMap,de=new WeakMap,De=new WeakMap,T=new WeakMap,qe=new WeakMap,q=new WeakMap,fe=new WeakMap,we=new WeakMap,ie=new WeakMap,je=new WeakMap,ke=new WeakMap,Y=new WeakMap,Qe=new WeakMap,Se=new WeakMap,ae=new WeakMap,U=new WeakMap,Ae=new WeakMap,We=new WeakMap,Ye=new WeakMap,xe=new WeakMap,Ce=new WeakMap,Ze=new WeakMap,ne=new WeakMap,L=new WeakMap,nt=new WeakMap,St=new WeakMap,Z=new WeakMap,ye=new WeakMap,Te=new WeakMap,V=new WeakMap,Pe=new WeakMap,G=new WeakMap,ct=new WeakMap,ht=new WeakMap,Ie=new WeakMap,Ue=new WeakMap,re=new WeakMap,se=new WeakMap,ve=new WeakMap,Le=new WeakMap,Be=new WeakMap,Ne=new WeakMap,ea);var Mt=ya(aa(),1);O();O();var ot,ra,ia=(ra=class{constructor(b,e,r,d){S(this,ot,!1);w(this,ot,b),this.start=e,this.end=r,this.data=d}get duration(){return this.ranged?this.end-this.start:0}get ranged(){return t(this,ot)}},ot=new WeakMap,ra),Ct=class extends ia{constructor(b,e,r){super(!0,b,e,r)}},na=class extends ia{constructor(b,e){super(!1,b,b,e)}},He,sa,Tt=(sa=class extends Array{constructor(){super(...arguments);S(this,He,-1)}resetIndex(e){w(this,He,-1)}fresh(){this.sort(function(e,r){return e.start==r.start?0:(+(e.start>r.start)<<1)-1}),this.forEach(function(e,r){e.index=r})}step(e,r=!1){let d=[];if(r)for(let c=0;c<this.length&&!(this[c].start>e);c++){if(this[c].end<e)continue;d.push(this[c])}else{let c=this.getRange(t(this,He)==-1?0:e-1,e),p=this;c.forEach(function(h){h.index>t(p,He)&&(d.push(h),w(p,He,h.index))})}return d}getRange(e,r){var m;e>r&&([e,r]=[r,e]);let d=[],c=-1,p=Math.ceil(Math.sqrt(this.length)),h=!0;for(let a=0;a<this.length;a+=p)this[a+p]?c<0&&this[a+p].start>=e&&(c=a):c=c<0?a:c;for(;h;)((m=this[c])==null?void 0:m.end)<r?this[c].start>=e&&d.push(this[c]):h=!1,c++;return d}},He=new WeakMap,sa);var Ta=0xffffffffffff,ca=function(b){let e=new Tt,r=this,d=b.timeDivision,c=120,p=new Tt,h=0,m=0;p.push(new Ct(0,Ta,[120,0])),b.track.forEach(function(i){h=0,i.event.forEach(function(s){h+=s.deltaTime,s.type==255&&(s==null?void 0:s.metaType)==81&&(c=6e7/s.data,p[p.length-1]&&p.push(new Ct(h,0xffffffffffff,[c,0])))})}),p.fresh(),p.forEach(function(i,s,o){s>0&&(o[s-1].end=i.start)});let a=120;p.forEach(function(i,s,o){s>0&&(i.end==i.start?o.splice(o.indexOf(i),1):a==i.data[0]&&(o[s-1].end=i.end,o.splice(o.indexOf(i),1)),a=i.data[0])});let n=0,l=120;return p.forEach(function(i){let s=i.start,o=s/l/d*60+n;l=i.data[0],n=o-s/l/d*60,i.data[1]=n}),console.debug("All tempo changes: ",p),c=120,h=0,m=0,b.track.forEach(function(i,s){h=0,m=0;let o=s+1;i.event.forEach(function(f,u){h+=f.deltaTime;let g=p.step(h,!0)[0];g&&(c=g.data[0],m=g.data[1]);let E={type:f.type,data:f.data,track:o,part:0};f.type>14?E.meta=f.metaType:E.part=f.channel,e.push(new na(h/c/d*60+m,E))})}),e.fresh(),self.midiEvents=e,console.debug(`Parsed a type ${b.formatType} MIDI sequence.`),e};Mt.default.customInterpreter=qt;var B=function(b,e,r){b.addEventListener(r,d=>{e.dispatchEvent(r,d.data)})},Je,Ge,et,me,_e,Xe,lt,Me,Re,K,Fe,Ee,Ve,oa,Ar=(oa=class extends dt{constructor(e,r=.5,d=.5){super();M(this,"device");S(this,Je,void 0);S(this,Ge,{});S(this,et,[]);S(this,me,"");S(this,_e,[]);S(this,Xe,new Uint8ClampedArray(128));S(this,lt,new Uint8ClampedArray(128));S(this,Me,.5);S(this,Re,120);S(this,K,4);S(this,Fe,4);S(this,Ee,0);S(this,Ve,0);M(this,"smoothingAtk",0);M(this,"smoothingDcy",0);let c=this;c.smoothingAtk=r,c.smoothingDcy=d,c.device=e,c.addEventListener("meta",function(p){var h;(h=p==null?void 0:p.data)==null||h.forEach(function(m){(t(c,_e)[m.meta]||console.debug).call(c,m.meta,m.data)})}),B(c.device,c,"mode"),B(c.device,c,"mastervolume"),B(c.device,c,"channelactive"),B(c.device,c,"channelmin"),B(c.device,c,"channelmax"),B(c.device,c,"channelreset"),B(c.device,c,"channeltoggle"),B(c.device,c,"screen"),B(c.device,c,"metacommit"),B(c.device,c,"voice"),B(c.device,c,"pitch"),B(c.device,c,"note"),B(c.device,c,"reset"),B(c.device,c,"efxreverb"),B(c.device,c,"efxchorus"),B(c.device,c,"efxdelay"),B(c.device,c,"efxinsert0"),B(c.device,c,"efxinsert1"),B(c.device,c,"efxinsert2"),B(c.device,c,"efxinsert3"),B(c.device,c,"partefxtoggle"),t(c,_e)[3]=function(p,h){var m;((m=t(c,me))==null?void 0:m.length)<1&&(w(c,me,h),c.dispatchEvent("title",t(c,me)))},t(c,_e)[81]=function(p,h){let m=c.noteProgress,a=t(c,Me)||.5;w(c,Re,6e7/h),w(c,Me,h/1e6),w(c,Ee,t(c,Ee)+(m*(a/t(c,Me))-m)),c.dispatchEvent("tempo",t(c,Re))},t(c,_e)[88]=function(p,h){let m=c.noteProgress,a=c.noteOverall,n=c.noteBar,l=c.noteBeat,i=t(c,K),s=t(c,Fe);w(c,K,h[0]),w(c,Fe,1<<h[1]);let o=24*(32/h[3])/h[2];if(i!=t(c,K)){let f=n;w(c,Ee,t(c,Ee)-f*(t(c,K)-i)),l+1>=i&&(i<t(c,K)?w(c,Ee,t(c,Ee)-Math.ceil(t(c,K)-l-1)):w(c,Ee,t(c,Ee)+t(c,K)))}c.dispatchEvent("tsig",c.getTimeSig())}}reset(){var r;let e=this;e.dispatchEvent("reset"),(r=t(e,Je))==null||r.resetIndex(),e.device.init(),w(e,me,""),w(e,Me,.5),w(e,Re,120),w(e,K,4),w(e,Fe,4),w(e,Ee,0),w(e,Ve,0),e.dispatchEvent("tempo",t(e,Re)),e.dispatchEvent("title",t(e,me))}async loadFile(e){w(this,Je,ca(Mt.default.parse(new Uint8Array(await e.arrayBuffer()))))}async loadMap(e,r){let d=this,c=0,p=0,h=0,m,a;e.split(`
`).forEach((n,l)=>{if(!n)return;let i=n.split("	");if(l){if(!h)return;let s="",o="";i.forEach((f,u)=>{switch(u){case m:{s=f;break}case a:{o=f;break}}}),!t(d,Ge)[s]||r?(t(d,Ge)[s]=o,c++):self.debugMode&&console.debug(`Voice "${o}" (${s}) seems to be in conflict with (${t(d,Ge)[s]}).`),p++}else i.forEach((s,o)=>{switch(s){case"ID":{m=o,h++;break}case"Name":{a=o,h++;break}default:console.debug(`Unknown map field: ${s}`)}})}),console.debug(`Map: ${p} total, ${c} loaded.`),d==null||d.device.forceVoiceRefresh()}async loadEfx(e,r){let d=this,c=0,p=0,h,m,a;e.split(`
`).forEach((n,l)=>{if(n)if(l){let i=0,s;n.split("	").forEach((o,f)=>{switch(f){case h:{i|=parseInt(o,16)<<8;break}case m:{i|=parseInt(o,16);break}case a:{s=o;break}}}),!t(d,et)[i]||r?(t(d,et)[i]=s,c++):self.debugMode&&console.debug(`EFX ID 0x${i.toString(16).padStart(4,"0")} (${s}) seems to be in conflict.`),p++}else n.split("	").forEach((i,s)=>{switch(i){case"MSB":{h=s;break}case"LSB":{m=s;break}case"Name":{a=s;break}default:console.debug(`Unknown EFX field: ${i}`)}})}),console.debug(`EFX: ${p} total, ${c} loaded.`),d.dispatchEvent("efxreverb",d.device.getEffectType(0)),d.dispatchEvent("efxchorus",d.device.getEffectType(1)),d.dispatchEvent("efxdelay",d.device.getEffectType(2)),d.dispatchEvent("efxinsert0",d.device.getEffectType(3)),d.dispatchEvent("efxinsert1",d.device.getEffectType(4)),d.dispatchEvent("efxinsert2",d.device.getEffectType(5)),d.dispatchEvent("efxinsert3",d.device.getEffectType(6))}switchMode(e,r=!1){this.device.switchMode(e,r)}getMode(){return this.device.getMode()}getVoice(){return this.device.getVoice(...arguments)}getChVoice(e){return this.device.getChVoice(e)}getMapped(e){return t(this,Ge)[e]||e}getEfx([e,r]){let d=e<<8|r;return t(this,et)[d]||`0x${d.toString(16).padStart(4,"0")}`}get noteProgress(){return t(this,Ve)/t(this,Me)}get noteOverall(){return this.noteProgress-t(this,Ee)}get noteBar(){return Math.floor(this.noteOverall/t(this,K))}get noteBeat(){let e=this.noteOverall%t(this,K);return e<0&&(e+=t(this,K)),e}getTimeSig(){return[t(this,K),t(this,Fe)]}getTempo(){return t(this,Re)}sendCmd(e){this.device.runJson(e)}render(e){var g;e>t(this,Ve)&&w(this,Ve,e);let r=((g=t(this,Je))==null?void 0:g.step(e))||[],d=0,c=new Set,p=this,h=[];this.device.getStrength().forEach((E,k)=>{t(this,lt)[k]=E}),p.device.newStrength(),r.forEach(function(E){let k=E.data;k.type==9&&(k.data[1]>0?c.add(k.part*128+k.data[0]):c.has(k.part*128+k.data[0])&&d++),E.data.type==8&&c.has(k.part*128+k.data[0])&&d++;let C=p.device.runJson(k);switch(C==null?void 0:C.reply){case"meta":{h.push(C);break}}C!=null&&C.reply&&delete C.reply}),(h==null?void 0:h.length)>0&&this.dispatchEvent("meta",h);let m=this.device.getActive(),a=[],n=p.device.getPitch(),l=p.device.getCcAll(),i=p.device.getProgram(),s=p.device.getChType(),o=this.device.getStrength();o.forEach(function(E,k,C){C[k]=Math.max(t(p,lt)[k],E);let A=C[k]-t(p,Xe)[k],_=v.length*k;if(A>=0){let pt=4*.25**(l[_+v[73]]/64);t(p,Xe)[k]+=Math.ceil(A-A*p.smoothingAtk**pt)}else{let pt=4*.25**(l[_+v[72]]/64);t(p,Xe)[k]+=Math.floor(A-A*p.smoothingDcy**pt)}});let f=0;return m.forEach(function(E,k){E&&(a[k]=p.device.getVel(k),f+=a[k].size)}),{extraPoly:d,curPoly:f,chInUse:m,chKeyPr:a,chPitch:n,chProgr:i,chContr:l,chType:s,eventCount:r.length,title:t(this,me),bitmap:this.device.getBitmap(),letter:this.device.getLetter(),texts:this.device.getTexts(),master:this.device.getMaster(),mode:this.device.getMode(),strength:t(this,Xe).slice(),velo:o,rpn:this.device.getRpn(),tSig:this.getTimeSig(),tempo:this.getTempo(),noteBar:this.noteBar,noteBeat:this.noteBeat,ace:this.device.getAce(),efxSink:this.device.getEffectSink()}}},Je=new WeakMap,Ge=new WeakMap,et=new WeakMap,me=new WeakMap,_e=new WeakMap,Xe=new WeakMap,lt=new WeakMap,Me=new WeakMap,Re=new WeakMap,K=new WeakMap,Fe=new WeakMap,Ee=new WeakMap,Ve=new WeakMap,oa);export{Ar as RootDisplay,v as ccToPos,ee as dnToPos};
